import{a as W,_ as I}from"./AuthenticatedLayout-m1j3JS-L.js";import{r as l,z as V,B as Y,h as a,g as A,o,b as e,e as x,k as m,t as n,a as w,n as E,m as k,C as z,u as N,q as F,F as T,i as M,S as L}from"./app-Cftj8kez.js";import{_ as q}from"./NotesModal-Q6DfGcxU.js";import{P as H}from"./PrimaryButton-BNBWD5Jx.js";import"./ApplicationLogo-DHDHjUvD.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./SecondaryButton-CVyu_OeR.js";import"./InputError-Dysw4GLH.js";import"./TextInput-DItFCFfR.js";const O={class:"flex"},R={class:"flex-shrink-0"},G={key:0,class:"h-5 w-5 text-red-500",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},J={key:1,class:"h-5 w-5 text-indigo-500",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},K={class:"ml-3 flex-1 md:flex md:justify-between"},Q={key:0,class:"text-sm text-indigo-700"},X={key:1,class:"text-sm text-green-700"},Z={key:2,class:"text-sm text-red-700 font-medium"},ee={key:3,class:"text-sm text-green-700"},te={class:"mt-3 text-sm md:mt-0 md:ml-6"},se={__name:"AvailabilityPrompt",setup(P){const c=l(!1),h=l(!0),p=l([]),v=l(!1),y=l(""),u=l(!1),d=l(!1),r=l(null),_=l(!1),b=()=>{const s=localStorage.getItem("authToken");s&&!k.defaults.headers.common.Authorization&&(k.defaults.headers.common.Authorization=`Bearer ${s}`,console.log("Auth headers set in AvailabilityPrompt"))},g=async()=>{h.value=!0,y.value="";try{b();const s=await k.get("/api/availability-prompt");c.value=s.data.should_show_prompt,u.value=s.data.should_block_user,d.value=s.data.all_weekdays_covered,r.value=s.data.current_day,_.value=s.data.is_thursday_to_saturday,c.value&&C(s.data.next_week_start,s.data.next_week_end),localStorage.setItem("shouldBlockUser",u.value),localStorage.setItem("allWeekdaysCovered",d.value);const t=new CustomEvent("availability-status-updated",{detail:{shouldBlockUser:u.value,allWeekdaysCovered:d.value}});window.dispatchEvent(t)}catch(s){console.error("Error checking availability prompt:",s),c.value=!1,s.response&&s.response.status===401&&(s.value="Authentication error. Please refresh the page or log in again.")}finally{h.value=!1}},C=(s,t)=>{const i=[],B=new Date(s),U=new Date(t),f=new Date(B);for(;f<=U;)i.push({value:f.toISOString().split("T")[0],label:f.toLocaleDateString("en-US",{weekday:"long",month:"short",day:"numeric"})}),f.setDate(f.getDate()+1);p.value=i},D=()=>{v.value=!0},j=()=>{g()},S=()=>{document.visibilityState==="visible"&&z(()=>{g()})},$=s=>{(s.key==="shouldBlockUser"||s.key==="allWeekdaysCovered")&&z(()=>{g()})};return V(()=>{g(),document.addEventListener("visibilitychange",S),window.addEventListener("storage",$)}),Y(()=>{document.removeEventListener("visibilitychange",S),window.removeEventListener("storage",$)}),(s,t)=>c.value&&!h.value?(o(),a("div",{key:0,class:E(["border-l-4 p-4 mb-6 rounded-md shadow-sm",u.value?"bg-red-50 border-red-500":"bg-indigo-50 border-indigo-500"])},[e("div",O,[e("div",R,[u.value?(o(),a("svg",G,t[1]||(t[1]=[e("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"},null,-1)]))):(o(),a("svg",J,t[2]||(t[2]=[e("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z","clip-rule":"evenodd"},null,-1)])))]),e("div",K,[r.value===4&&!d.value?(o(),a("p",Q," Please submit your availability for next week. This helps in planning meetings and work schedules. ")):r.value===4&&d.value?(o(),a("p",X," Thank you for submitting your availability for next week! You can still update it if needed. ")):(r.value===5||r.value===6)&&!d.value?(o(),a("p",Z,[t[3]||(t[3]=e("span",{class:"font-bold"},"Action Required:",-1)),m(" You must submit your availability for all weekdays of next week. "+n(u.value?"Other features are currently blocked until you complete this task.":""),1)])):(r.value===5||r.value===6)&&d.value?(o(),a("p",ee," Thank you for submitting your availability for next week! You can still update it if needed. ")):A("",!0),e("p",te,[x(H,{onClick:D,class:E(["whitespace-nowrap",{"bg-red-600 hover:bg-red-700":u.value}])},{default:w(()=>[m(n(d.value?"Update Availability":"Submit Availability"),1)]),_:1},8,["class"])])])]),x(W,{show:v.value,"next-week-dates":p.value,date:p.value.length>0?p.value[0].value:"",onClose:t[0]||(t[0]=i=>v.value=!1),onAvailabilitySaved:j},null,8,["show","next-week-dates","date"])],2)):A("",!0)}},ae={class:"py-12"},oe={class:"mx-auto max-w-7xl sm:px-6 lg:px-8 space-y-6"},le={class:"overflow-hidden bg-white shadow-sm sm:rounded-lg"},ie={class:"p-6 text-gray-900"},ne={class:"flex justify-between items-center"},de={class:"mt-1 text-sm text-gray-600"},re={class:"font-bold"},ue={key:0,class:"mt-4"},ce={key:0,class:"text-sm text-gray-500"},pe={key:1,class:"text-sm text-red-500"},ve={key:2,class:"text-sm text-gray-500"},xe={key:3,class:"mt-3"},me={class:"min-w-full divide-y divide-gray-200"},he={class:"bg-white divide-y divide-gray-200"},ye={class:"px-3 py-2 whitespace-nowrap text-sm"},ge={class:"px-3 py-2 whitespace-nowrap text-sm capitalize"},_e={class:"px-3 py-2 whitespace-nowrap text-sm"},fe={class:"flex space-x-2"},we=["onClick"],ke={class:"overflow-hidden bg-white shadow-sm sm:rounded-lg"},be={class:"p-6 text-gray-900"},Ce={class:"flex justify-between items-center"},Se={class:"mt-1 text-sm text-gray-600"},$e={class:"font-bold"},Ae={key:0,class:"mt-4"},De={key:0,class:"text-sm text-gray-500"},je={key:1,class:"text-sm text-red-500"},Ne={key:2,class:"text-sm text-gray-500"},Te={key:3,class:"mt-3"},Pe={class:"min-w-full divide-y divide-gray-200"},Be={class:"bg-white divide-y divide-gray-200"},Ee={class:"px-3 py-2 whitespace-nowrap text-sm"},ze={class:"px-3 py-2 whitespace-nowrap text-sm"},Me={class:"px-3 py-2 whitespace-nowrap text-sm"},Le={class:"px-3 py-2 whitespace-nowrap text-sm"},Ve={class:"px-3 py-2 whitespace-nowrap text-sm"},Ue={class:"flex space-x-2"},Je={__name:"Dashboard",props:{projectCount:Number},setup(P){const c=l([]),h=l(!0),p=l(""),v=l(!1),y=l({total_due_tasks:0,projects:[]}),u=l(!1),d=l(""),r=l(!1),_=l(!1),b=l(null),g=async()=>{h.value=!0,p.value="";try{const s=await k.get("/api/projects-simplified");c.value=s.data}catch(s){p.value="Failed to load projects",console.error("Error fetching projects:",s)}finally{h.value=!1}},C=async()=>{u.value=!0,d.value="";try{const s=await k.get("/api/task-statistics");y.value=s.data}catch(s){d.value="Failed to load task statistics",console.error("Error fetching task statistics:",s)}finally{u.value=!1}},D=()=>{v.value=!v.value,v.value&&c.value.length===0&&g()},j=()=>{r.value=!r.value,r.value&&y.value.projects.length===0&&C()},S=s=>{b.value=s,_.value=!0},$=()=>{g()};return V(()=>{C()}),(s,t)=>(o(),a(T,null,[x(N(F),{title:"Dashboard"}),x(I,null,{header:w(()=>t[1]||(t[1]=[e("h2",{class:"text-xl font-semibold leading-tight text-gray-800"}," Dashboard ",-1)])),default:w(()=>[e("div",ae,[e("div",oe,[x(se),e("div",le,[e("div",ie,[e("div",ne,[t[2]||(t[2]=e("h3",{class:"text-lg font-medium text-gray-900"},"Projects",-1)),e("button",{onClick:D,class:"text-sm text-blue-600 hover:text-blue-800"},n(v.value?"Collapse":"Expand"),1)]),e("p",de,[t[3]||(t[3]=m(" You have access to ")),e("span",re,n(P.projectCount),1),t[4]||(t[4]=m(" project(s). "))]),v.value?(o(),a("div",ue,[h.value?(o(),a("div",ce,"Loading projects...")):p.value?(o(),a("div",pe,n(p.value),1)):c.value.length===0?(o(),a("div",ve,"No projects found.")):(o(),a("div",xe,[e("table",me,[t[6]||(t[6]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{scope:"col",class:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Name"),e("th",{scope:"col",class:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Status"),e("th",{scope:"col",class:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Actions")])],-1)),e("tbody",he,[(o(!0),a(T,null,M(c.value,i=>(o(),a("tr",{key:i.id},[e("td",ye,n(i.name),1),e("td",ge,n(i.status.replace("_"," ")),1),e("td",_e,[e("div",fe,[x(N(L),{href:`/projects/${i.id}`,class:"text-xs bg-blue-500 hover:bg-blue-700 text-white py-1 px-2 rounded"},{default:w(()=>t[5]||(t[5]=[m(" View ")])),_:2,__:[5]},1032,["href"]),e("button",{onClick:B=>S(i.id),class:"text-xs bg-purple-500 hover:bg-purple-700 text-white py-1 px-2 rounded"}," Notes ",8,we)])])]))),128))])])]))])):A("",!0)])]),e("div",ke,[e("div",be,[e("div",Ce,[t[7]||(t[7]=e("h3",{class:"text-lg font-medium text-gray-900"},"Due Tasks",-1)),e("button",{onClick:j,class:"text-sm text-blue-600 hover:text-blue-800"},n(r.value?"Collapse":"Expand"),1)]),e("p",Se,[t[8]||(t[8]=m(" You have ")),e("span",$e,n(y.value.total_due_tasks),1),t[9]||(t[9]=m(" task(s) due. "))]),r.value?(o(),a("div",Ae,[u.value?(o(),a("div",De,"Loading tasks...")):d.value?(o(),a("div",je,n(d.value),1)):y.value.projects.length===0?(o(),a("div",Ne,"No due tasks found.")):(o(),a("div",Te,[e("table",Pe,[t[11]||(t[11]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{scope:"col",class:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Project Name"),e("th",{scope:"col",class:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Due Tasks"),e("th",{scope:"col",class:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Due Today"),e("th",{scope:"col",class:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Assigned Me"),e("th",{scope:"col",class:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Actions")])],-1)),e("tbody",Be,[(o(!0),a(T,null,M(y.value.projects,i=>(o(),a("tr",{key:i.id},[e("td",Ee,n(i.name),1),e("td",ze,n(i.due_tasks),1),e("td",Me,n(i.due_today),1),e("td",Le,n(i.assigned_to_me),1),e("td",Ve,[e("div",Ue,[x(N(L),{href:`/projects/${i.id}`,class:"text-xs bg-blue-500 hover:bg-blue-700 text-white py-1 px-2 rounded"},{default:w(()=>t[10]||(t[10]=[m(" View ")])),_:2,__:[10]},1032,["href"])])])]))),128))])])]))])):A("",!0)])]),t[12]||(t[12]=e("div",{class:"overflow-hidden bg-white shadow-sm sm:rounded-lg"},[e("div",{class:"p-6 text-gray-900"},[e("h3",{class:"text-lg font-medium text-gray-900"},"Notice Board"),e("p",{class:"mt-1 text-sm text-gray-600"}," No new announcements at this time. ")])],-1))])]),x(q,{show:_.value,"project-id":b.value,onClose:t[0]||(t[0]=i=>_.value=!1),onNoteAdded:$},null,8,["show","project-id"])]),_:1})],64))}};export{Je as default};
