import{r,C as G,c as I,p as D,f as oe,e as ne,g as ie,o as V,w as q,b as l,a as h,t as F,j as Q,d as t,v as K,x as z,y as X,s as $,F as R,l as W,m as T,i as ue}from"./app-CH-gkOrV.js";import{_ as de}from"./Modal-C12bxVAA.js";import{_ as m}from"./InputLabel-BpNpVDJT.js";import{_ as b}from"./TextInput-3yC3sg_t.js";import{_ as v}from"./InputError-vhKQFypQ.js";import{_ as re}from"./PrimaryButton-C9Jy5EgI.js";import{_ as me}from"./SecondaryButton-hnhNpR9e.js";import{S as E}from"./SelectDropdown-BL5Egiyt.js";import{_ as ce}from"./MultiSelectDropdown-DFLGKLiP.js";function pe(){const U=r([]),P=r(!1),g=r(""),_=r(1),M=r(15),j=r(0),u=r(1),i=G({q:"",status:"",source:"",assigned_to_id:"",campaign_ids:[]}),x=r([]),o=async()=>{try{const{data:n}=await D.get("/api/users");x.value=n}catch(n){console.error("Failed to load users",n)}},p=async()=>{var n,c;P.value=!0,g.value="";try{const d={page:_.value,per_page:M.value};i.q&&(d.q=i.q),i.status&&(d.status=i.status),i.source&&(d.source=i.source),i.assigned_to_id&&(d.assigned_to_id=i.assigned_to_id),i.campaign_ids&&i.campaign_ids.length&&(d.campaign_ids=i.campaign_ids.join(","));const{data:B}=await D.get("/api/leads",{params:d});U.value=B.data??B;const A=B.meta??null;A?(_.value=A.current_page,M.value=A.per_page,j.value=A.total,u.value=A.last_page):(j.value=Array.isArray(U.value)?U.value.length:0,u.value=1)}catch(d){console.error("Error fetching leads",d),g.value=((c=(n=d==null?void 0:d.response)==null?void 0:n.data)==null?void 0:c.message)||"Failed to fetch leads.",d.response&&d.response.status===401&&(localStorage.removeItem("authToken"),window.location.href="/login")}finally{P.value=!1}},k=async n=>{n<1||n>u.value||(_.value=n,await p())},S=async()=>{i.q="",i.status="",i.source="",i.assigned_to_id="",i.campaign_ids=[],_.value=1,await p()},L=async n=>{g.value="";const{data:c}=await D.post("/api/leads",n);return await p(),c},C=async(n,c)=>{g.value="";const{data:d}=await D.put(`/api/leads/${n}`,c);return await p(),d},f=async n=>{g.value="",await D.delete(`/api/leads/${n}`),await p()},O=I(()=>{const n={new:[],contacted:[],qualified:[],converted:[],lost:[]};for(const c of U.value){const d=(c.status||"new").toLowerCase();n[d]||(n[d]=[]),n[d].push(c)}return n});return{leads:U,loading:P,generalError:g,currentPage:_,perPage:M,total:j,lastPage:u,filters:i,users:x,leadsByStatus:O,fetchUsers:o,fetchLeads:p,changePage:k,resetFilters:S,createLead:L,updateLead:C,deleteLead:f}}const ve={class:"p-6"},ge={class:"text-lg font-semibold mb-4"},fe={class:"mb-4 border-b border-gray-200"},_e={class:"-mb-px flex space-x-6","aria-label":"Tabs"},ye={key:0,class:"grid grid-cols-1 md:grid-cols-2 gap-4"},be={key:1,class:"space-y-6"},xe={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},we={class:"flex items-center mt-1"},Ve=["onKeydown"],ke={class:"mt-2 flex flex-wrap gap-2"},he=["onClick"],Ce={class:"flex items-center mt-1"},Ue=["onKeydown"],Se={class:"mt-2 flex flex-wrap gap-2"},Le=["onClick"],Ae={class:"grid grid-cols-1 md:grid-cols-3 gap-2 mt-1"},$e={class:"mt-2"},Oe={class:"mt-3 space-y-2"},Fe={class:"truncate"},Pe={class:"font-medium"},Me=["href"],je=["onClick"],Be={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ne={key:0,class:"text-xs text-gray-500 mt-1"},De={class:"mt-6 flex justify-end gap-2"},Te={__name:"LeadFormModal",props:{show:{type:Boolean,default:!1},lead:{type:Object,default:null},users:{type:Array,default:()=>[]},sourceOptions:{type:Array,default:()=>[]},statusOptions:{type:Array,default:()=>[]}},emits:["close","lead-created","lead-updated"],setup(U,{emit:P}){const g=U,_=P,{createLead:M,updateLead:j}=pe(),u=r({}),i=r(!1),x=r("basic"),o=G({id:null,first_name:"",last_name:"",email:"",phone:"",company:"",title:"",status:"new",source:"",pipeline_stage:"",assigned_to_id:null,campaign_id:null,estimated_value:"",currency:"USD",website:"",notes:"",metadata:{}}),p=r([]),k=r([]),S=r(""),L=r(""),C=r([]),f=G({label:"",url:""}),O=r([]),n=r(!1),c=r([]);oe(async()=>{try{n.value=!0;const{data:s}=await window.axios.get("/api/campaigns",{params:{per_page:1e3}}),e=(s==null?void 0:s.data)||s||[];O.value=e.map(a=>({label:a.name,value:a.id}))}catch(s){console.error("Failed to load campaigns",s),O.value=[]}finally{n.value=!1}});const d=I(()=>(g.users||[]).map(s=>({label:s.name,value:s.id}))),B=I(()=>g.statusOptions||[]),A=I(()=>g.sourceOptions||[]),Y=()=>{Object.assign(o,{id:null,first_name:"",last_name:"",email:"",phone:"",company:"",title:"",status:"new",source:"",pipeline_stage:"",assigned_to_id:null,campaign_id:null,estimated_value:"",currency:"USD",website:"",notes:"",metadata:{}}),p.value=[],k.value=[],S.value="",L.value="",C.value=[],f.label="",f.url="",c.value=[],u.value={},x.value="basic"},Z=s=>{if(!s){Y();return}Object.assign(o,{id:s.id,first_name:s.first_name||"",last_name:s.last_name||"",email:s.email||"",phone:s.phone||"",company:s.company||"",title:s.title||"",status:s.status||"new",source:s.source||"",pipeline_stage:s.pipeline_stage||"",assigned_to_id:s.assigned_to_id||null,campaign_id:s.campaign_id||null,estimated_value:s.estimated_value??"",currency:s.currency||"USD",website:s.website||"",notes:s.notes||"",metadata:s.metadata||{}});const e=o.metadata||{};p.value=Array.isArray(e.contexts)?[...e.contexts]:[],k.value=Array.isArray(e.potential_services)?[...e.potential_services]:[],C.value=Array.isArray(e.social_links)?e.social_links.map(a=>({label:a.label||"",url:a.url||""})):[],c.value=Array.isArray(e.additional_campaign_ids)?[...e.additional_campaign_ids]:[],u.value={},x.value="basic"};ne(()=>g.lead,s=>Z(s),{immediate:!0});const H=()=>{const s=(S.value||"").trim();s&&!k.value.includes(s)&&k.value.push(s),S.value=""},ee=s=>k.value.splice(s,1),J=()=>{const s=(L.value||"").trim();s&&!p.value.includes(s)&&p.value.push(s),L.value=""},ae=s=>p.value.splice(s,1),le=()=>{const s=(f.label||"").trim(),e=(f.url||"").trim();e&&(C.value.push({label:s,url:e}),f.label="",f.url="")},se=s=>C.value.splice(s,1),te=async()=>{var N;i.value=!0,u.value={};const s=(o.first_name||"").trim(),e=(o.last_name||"").trim();if(!s&&!e){u.value={first_name:"Please enter at least a first or last name."},i.value=!1;return}const a={...o.metadata||{}};a.contexts=p.value,a.potential_services=k.value,a.social_links=C.value;const w=Array.isArray(c.value)?c.value.filter(y=>y!==o.campaign_id):[];a.additional_campaign_ids=w,o.metadata=a;try{if(o.id){const y=await j(o.id,o);_("lead-updated",y)}else{const y=await M(o);_("lead-created",y)}_("close")}catch(y){((N=y==null?void 0:y.response)==null?void 0:N.status)===422?u.value=y.response.data.errors||{}:console.error("Save failed",y)}finally{i.value=!1}};return(s,e)=>(V(),ie(de,{show:g.show,onClose:e[23]||(e[23]=a=>_("close"))},{default:q(()=>[l("div",ve,[l("h3",ge,F(o.id?"Edit Lead":"Create Lead"),1),l("div",fe,[l("nav",_e,[l("button",{type:"button",onClick:e[0]||(e[0]=a=>x.value="basic"),class:Q(["py-2 px-1 border-b-2 text-sm font-medium",x.value==="basic"?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"])},"Basic",2),l("button",{type:"button",onClick:e[1]||(e[1]=a=>x.value="additional"),class:Q(["py-2 px-1 border-b-2 text-sm font-medium",x.value==="additional"?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"])},"Additional",2)])]),x.value==="basic"?(V(),h("div",ye,[l("div",null,[t(m,{value:"First Name"}),t(b,{modelValue:o.first_name,"onUpdate:modelValue":e[2]||(e[2]=a=>o.first_name=a),class:"mt-1 block w-full"},null,8,["modelValue"]),t(v,{message:u.value.first_name,class:"mt-1"},null,8,["message"])]),l("div",null,[t(m,{value:"Last Name"}),t(b,{modelValue:o.last_name,"onUpdate:modelValue":e[3]||(e[3]=a=>o.last_name=a),class:"mt-1 block w-full"},null,8,["modelValue"]),t(v,{message:u.value.last_name,class:"mt-1"},null,8,["message"])]),l("div",null,[t(m,{value:"Email"}),t(b,{modelValue:o.email,"onUpdate:modelValue":e[4]||(e[4]=a=>o.email=a),class:"mt-1 block w-full"},null,8,["modelValue"]),t(v,{message:u.value.email,class:"mt-1"},null,8,["message"])]),l("div",null,[t(m,{value:"Phone"}),t(b,{modelValue:o.phone,"onUpdate:modelValue":e[5]||(e[5]=a=>o.phone=a),class:"mt-1 block w-full"},null,8,["modelValue"]),t(v,{message:u.value.phone,class:"mt-1"},null,8,["message"])]),l("div",null,[t(m,{value:"Company"}),t(b,{modelValue:o.company,"onUpdate:modelValue":e[6]||(e[6]=a=>o.company=a),class:"mt-1 block w-full"},null,8,["modelValue"]),t(v,{message:u.value.company,class:"mt-1"},null,8,["message"])]),l("div",null,[t(m,{value:"Title"}),t(b,{modelValue:o.title,"onUpdate:modelValue":e[7]||(e[7]=a=>o.title=a),class:"mt-1 block w-full"},null,8,["modelValue"]),t(v,{message:u.value.title,class:"mt-1"},null,8,["message"])]),l("div",null,[t(m,{value:"Status"}),t(E,{options:B.value,modelValue:o.status,"onUpdate:modelValue":e[8]||(e[8]=a=>o.status=a),placeholder:"Select status"},null,8,["options","modelValue"]),t(v,{message:u.value.status,class:"mt-1"},null,8,["message"])]),l("div",null,[t(m,{value:"Source"}),t(E,{options:A.value,modelValue:o.source,"onUpdate:modelValue":e[9]||(e[9]=a=>o.source=a),placeholder:"Select source"},null,8,["options","modelValue"]),t(v,{message:u.value.source,class:"mt-1"},null,8,["message"])]),l("div",null,[t(m,{value:"Assigned To"}),t(E,{options:d.value,modelValue:o.assigned_to_id,"onUpdate:modelValue":e[10]||(e[10]=a=>o.assigned_to_id=a),placeholder:"Unassigned"},null,8,["options","modelValue"]),t(v,{message:u.value.assigned_to_id,class:"mt-1"},null,8,["message"])])])):(V(),h("div",be,[l("div",xe,[l("div",null,[t(m,{value:"Estimated Value"}),t(b,{modelValue:o.estimated_value,"onUpdate:modelValue":e[11]||(e[11]=a=>o.estimated_value=a),type:"number",step:"0.01",class:"mt-1 block w-full"},null,8,["modelValue"]),t(v,{message:u.value.estimated_value,class:"mt-1"},null,8,["message"])]),l("div",null,[t(m,{value:"Currency (ISO 4217)"}),t(b,{modelValue:o.currency,"onUpdate:modelValue":e[12]||(e[12]=a=>o.currency=a),maxlength:"3",class:"mt-1 block w-full uppercase",onInput:e[13]||(e[13]=a=>o.currency=(o.currency||"").toUpperCase().slice(0,3)),placeholder:"USD"},null,8,["modelValue"]),t(v,{message:u.value.currency,class:"mt-1"},null,8,["message"])]),l("div",null,[t(m,{value:"Website"}),t(b,{modelValue:o.website,"onUpdate:modelValue":e[14]||(e[14]=a=>o.website=a),class:"mt-1 block w-full"},null,8,["modelValue"]),t(v,{message:u.value.website,class:"mt-1"},null,8,["message"])])]),l("div",null,[t(m,{value:"Notes"}),K(l("textarea",{"onUpdate:modelValue":e[15]||(e[15]=a=>o.notes=a),class:"mt-1 block w-full border-gray-300 rounded-md",rows:"3"},null,512),[[z,o.notes]]),t(v,{message:u.value.notes,class:"mt-1"},null,8,["message"])]),l("div",null,[t(m,{value:"Potential Services"}),l("div",we,[K(l("input",{"onUpdate:modelValue":e[16]||(e[16]=a=>S.value=a),onKeydown:X($(H,["prevent"]),["enter"]),type:"text",class:"flex-grow rounded-l-md border-gray-300 shadow-sm",placeholder:"e.g., SEO, Web Design"},null,40,Ve),[[z,S.value]]),l("button",{onClick:$(H,["prevent"]),type:"button",class:"px-4 py-2 bg-gray-200 rounded-r-md text-sm font-medium hover:bg-gray-300"},"Add")]),l("div",ke,[(V(!0),h(R,null,W(k.value,(a,w)=>(V(),h("span",{key:w,class:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-indigo-100 text-indigo-800"},[T(F(a)+" ",1),l("button",{onClick:$(N=>ee(w),["prevent"]),class:"ml-1.5 flex-shrink-0 text-indigo-400 hover:text-indigo-500"},e[24]||(e[24]=[l("svg",{class:"h-2 w-2",stroke:"currentColor",fill:"none",viewBox:"0 0 8 8"},[l("path",{"stroke-linecap":"round","stroke-width":"1.5",d:"M1 1l6 6m0-6L1 7"})],-1)]),8,he)]))),128))])]),l("div",null,[t(m,{value:"Contexts"}),l("div",Ce,[K(l("input",{"onUpdate:modelValue":e[17]||(e[17]=a=>L.value=a),onKeydown:X($(J,["prevent"]),["enter"]),type:"text",class:"flex-grow rounded-l-md border-gray-300 shadow-sm",placeholder:"Add a context (e.g., Found on Upwork)"},null,40,Ue),[[z,L.value]]),l("button",{onClick:$(J,["prevent"]),type:"button",class:"px-4 py-2 bg-gray-200 rounded-r-md text-sm font-medium hover:bg-gray-300"},"Add")]),l("div",Se,[(V(!0),h(R,null,W(p.value,(a,w)=>(V(),h("span",{key:w,class:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-emerald-100 text-emerald-800"},[T(F(a)+" ",1),l("button",{onClick:$(N=>ae(w),["prevent"]),class:"ml-1.5 flex-shrink-0 text-emerald-400 hover:text-emerald-600"},e[25]||(e[25]=[l("svg",{class:"h-2 w-2",stroke:"currentColor",fill:"none",viewBox:"0 0 8 8"},[l("path",{"stroke-linecap":"round","stroke-width":"1.5",d:"M1 1l6 6m0-6L1 7"})],-1)]),8,Le)]))),128))])]),l("div",null,[t(m,{value:"Social Media Links"}),l("div",Ae,[t(b,{modelValue:f.label,"onUpdate:modelValue":e[18]||(e[18]=a=>f.label=a),placeholder:"Label (e.g., LinkedIn)"},null,8,["modelValue"]),t(b,{modelValue:f.url,"onUpdate:modelValue":e[19]||(e[19]=a=>f.url=a),placeholder:"URL",class:"md:col-span-2"},null,8,["modelValue"])]),l("div",$e,[l("button",{onClick:$(le,["prevent"]),type:"button",class:"px-3 py-1.5 bg-gray-200 rounded-md text-sm font-medium hover:bg-gray-300"},"Add Link")]),l("ul",Oe,[(V(!0),h(R,null,W(C.value,(a,w)=>(V(),h("li",{key:w,class:"flex items-center justify-between bg-gray-50 rounded px-3 py-2 text-sm"},[l("div",Fe,[l("span",Pe,F(a.label||"Link"),1),e[26]||(e[26]=T(": ",-1)),l("a",{href:a.url,target:"_blank",class:"text-indigo-600 hover:underline break-all"},F(a.url),9,Me)]),l("button",{class:"text-red-600 hover:underline",onClick:N=>se(w)},"Remove",8,je)]))),128))])]),l("div",Be,[l("div",null,[t(m,{value:"Primary Campaign"}),t(E,{options:O.value,modelValue:o.campaign_id,"onUpdate:modelValue":e[20]||(e[20]=a=>o.campaign_id=a),placeholder:"None"},null,8,["options","modelValue"]),n.value?(V(),h("p",Ne,"Loading campaigns…")):ue("",!0)]),l("div",null,[t(m,{value:"Additional Campaigns"}),t(ce,{options:O.value,modelValue:c.value,"onUpdate:modelValue":e[21]||(e[21]=a=>c.value=a),isMulti:!0,placeholder:"None"},null,8,["options","modelValue"])])])])),l("div",De,[t(me,{disabled:i.value,onClick:e[22]||(e[22]=a=>_("close"))},{default:q(()=>e[27]||(e[27]=[T("Cancel",-1)])),_:1,__:[27]},8,["disabled"]),t(re,{disabled:i.value,onClick:te},{default:q(()=>[T(F(i.value?"Saving...":o.id?"Update":"Create"),1)]),_:1},8,["disabled"])])])]),_:1},8,["show"]))}},Je=Object.freeze(Object.defineProperty({__proto__:null,default:Te},Symbol.toStringTag,{value:"Module"}));export{Je as L,Te as _,pe as u};
