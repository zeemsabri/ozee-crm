import{r as p,J as R,e as x,p as f,f as L,a as n,o as i,b as l,i as y,d as o,m as H,j as k,F as A,l as q,t as w}from"./app-Cwv55SD_.js";import{_ as I}from"./EmailList-DzrOYodm.js";import{_ as c}from"./InputLabel-OMGQcK3R.js";import{_ as D}from"./TextInput-BxeFDsxA.js";import{S as P}from"./SelectDropdown-CPtjdKsp.js";import"./SecondaryButton-Bt_aMFpq.js";import"./moment-BLMuvzoS.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const J={class:"mb-4 bg-gray-50 p-4 rounded-lg"},O={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},G={key:0},K={class:"mt-1 relative rounded-md shadow-sm"},Q={key:0,class:"text-center py-8 text-gray-500"},W={key:1,class:"mt-4 flex justify-center"},X={class:"relative z-0 inline-flex rounded-md shadow-sm -space-x-px","aria-label":"Pagination"},Y=["disabled"],Z=["onClick"],ee={key:1,class:"relative inline-flex items-center px-4 py-2 border border-gray-300 bg-white text-sm font-medium text-gray-700"},te=["disabled"],ae={key:2,class:"mt-2 text-sm text-gray-500 text-center"},pe={__name:"AllEmailsTab",props:{isActive:Boolean},emits:["view-email","filters-changed"],setup(E,{expose:T,emit:$}){const B=E,d=p([]),m=p(!0),_=p(""),r=p({currentPage:1,lastPage:1,perPage:15,total:0}),j=$,a=R({type:"",status:"",startDate:"",endDate:"",search:"",project_id:"",sender_id:""}),C=p([]),h=p([]),b=p(!0),U=async()=>{try{const s=await f.get("/api/projects-simplified");C.value=s.data.map(t=>({value:t.id,label:t.name}));const e=await f.get("/api/users");h.value=e.data.map(t=>({value:t.id,label:t.name}))}catch(s){console.error("Error fetching filter options:",s)}};let F=null;x(()=>a.type,s=>{b.value=s!=="received"}),x(a,s=>{j("filters-changed",{...s})},{deep:!0}),x(()=>a.project_id,async s=>{if(s)try{const e=await f.get(`/api/projects/${s}/users`);h.value=e.data.map(t=>({value:t.id,label:t.name}))}catch(e){console.error("Error fetching project users:",e)}else try{const e=await f.get("/api/users");h.value=e.data.map(t=>({value:t.id,label:t.name}))}catch(e){console.error("Error fetching users:",e)}a.sender_id=""});const v=async(s=1)=>{m.value=!0,_.value="";try{const e=new URLSearchParams;a.type&&e.append("type",a.type),a.status&&b.value&&e.append("status",a.status),a.startDate&&e.append("start_date",a.startDate),a.endDate&&e.append("end_date",a.endDate),a.search&&e.append("search",a.search),a.project_id&&e.append("project_id",a.project_id),a.sender_id&&e.append("sender_id",a.sender_id),e.append("page",s),e.append("per_page",r.value.perPage);const t=e.toString(),S=`/api/inbox/all-emails${t?`?${t}`:""}`,g=await f.get(S);d.value=g.data.data,r.value={currentPage:g.data.current_page,lastPage:g.data.last_page,perPage:g.data.per_page,total:g.data.total}}catch(e){console.error("Error fetching all emails:",e),_.value="Failed to load emails. Please try again."}finally{m.value=!1}},u=()=>{r.value.currentPage=1,v(1)},z=()=>{a.type="",a.status="",a.startDate="",a.endDate="",a.search="",a.project_id="",a.sender_id="",b.value=!0,r.value.currentPage=1,v(1)},V=s=>{v(s)},M=()=>{clearTimeout(F),F=setTimeout(()=>{u()},500)},N=s=>{j("view-email",s);const e=d.value.findIndex(t=>t.id===s.id);e!==-1&&(d.value[e].is_read=!0)};return x(()=>B.isActive,s=>{s&&v()},{immediate:!0}),T({refresh:v}),L(()=>{U()}),(s,e)=>(i(),n("div",null,[l("div",{class:"mb-4 flex items-center justify-between"},[e[10]||(e[10]=l("h3",{class:"text-xl font-medium text-gray-900"},"All Emails",-1)),l("button",{onClick:v,class:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"},e[9]||(e[9]=[l("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[l("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1),H(" Refresh ",-1)]))]),l("div",J,[l("div",O,[l("div",null,[o(c,{for:"typeFilter",value:"Type"}),o(P,{id:"typeFilter",modelValue:a.type,"onUpdate:modelValue":e[0]||(e[0]=t=>a.type=t),options:[{value:"",label:"All Types"},{value:"sent",label:"Sent"},{value:"received",label:"Received"}],placeholder:"All Types",onChange:u},null,8,["modelValue"])]),b.value?(i(),n("div",G,[o(c,{for:"statusFilter",value:"Status"}),o(P,{id:"statusFilter",modelValue:a.status,"onUpdate:modelValue":e[1]||(e[1]=t=>a.status=t),options:[{value:"",label:"All Statuses"},{value:"approved",label:"Approved"},{value:"sent",label:"Sent"}],placeholder:"All Statuses",onChange:u},null,8,["modelValue"])])):y("",!0),l("div",null,[o(c,{for:"projectFilter",value:"Project"}),o(P,{id:"projectFilter",modelValue:a.project_id,"onUpdate:modelValue":e[2]||(e[2]=t=>a.project_id=t),options:C.value,placeholder:"All Projects",onChange:u},null,8,["modelValue","options"])]),l("div",null,[o(c,{for:"senderFilter",value:"Sender"}),o(P,{id:"senderFilter",modelValue:a.sender_id,"onUpdate:modelValue":e[3]||(e[3]=t=>a.sender_id=t),options:h.value,placeholder:"All Senders",onChange:u},null,8,["modelValue","options"])]),l("div",null,[o(c,{for:"startDate",value:"From Date"}),o(D,{type:"date",id:"startDate",modelValue:a.startDate,"onUpdate:modelValue":e[4]||(e[4]=t=>a.startDate=t),class:"mt-1 block w-full",onChange:u},null,8,["modelValue"])]),l("div",null,[o(c,{for:"endDate",value:"To Date"}),o(D,{type:"date",id:"endDate",modelValue:a.endDate,"onUpdate:modelValue":e[5]||(e[5]=t=>a.endDate=t),class:"mt-1 block w-full",onChange:u},null,8,["modelValue"])]),l("div",null,[o(c,{for:"searchFilter",value:"Search Content"}),l("div",K,[o(D,{type:"text",id:"searchFilter",modelValue:a.search,"onUpdate:modelValue":e[6]||(e[6]=t=>a.search=t),class:"block w-full pr-10",placeholder:"Search in email content...",onInput:M},null,8,["modelValue"]),e[11]||(e[11]=l("div",{class:"absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none"},[l("svg",{class:"h-5 w-5 text-gray-400",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},[l("path",{"fill-rule":"evenodd",d:"M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z","clip-rule":"evenodd"})])],-1))])])]),l("div",{class:"mt-3 flex justify-end"},[l("button",{type:"button",class:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",onClick:z}," Reset Filters ")])]),d.value.length===0&&!m.value?(i(),n("div",Q,e[12]||(e[12]=[l("p",null,"No emails found matching your criteria.",-1)]))):y("",!0),o(I,{emails:d.value,loading:m.value,error:_.value,onView:N},null,8,["emails","loading","error"]),!m.value&&d.value.length>0?(i(),n("div",W,[l("nav",X,[l("button",{onClick:e[7]||(e[7]=t=>V(r.value.currentPage-1)),disabled:r.value.currentPage===1,class:k([r.value.currentPage===1?"cursor-not-allowed opacity-50":"hover:bg-gray-50","relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500"])},e[13]||(e[13]=[l("span",{class:"sr-only"},"Previous",-1),l("svg",{class:"h-5 w-5",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},[l("path",{"fill-rule":"evenodd",d:"M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z","clip-rule":"evenodd"})],-1)]),10,Y),(i(!0),n(A,null,q(r.value.lastPage,t=>(i(),n(A,{key:t},[t===1||t===r.value.lastPage||t>=r.value.currentPage-1&&t<=r.value.currentPage+1?(i(),n("button",{key:0,onClick:S=>V(t),class:k([t===r.value.currentPage?"z-10 bg-indigo-50 border-indigo-500 text-indigo-600":"bg-white border-gray-300 text-gray-500 hover:bg-gray-50","relative inline-flex items-center px-4 py-2 border text-sm font-medium"])},w(t),11,Z)):t===2||t===r.value.lastPage-1?(i(),n("span",ee," ... ")):y("",!0)],64))),128)),l("button",{onClick:e[8]||(e[8]=t=>V(r.value.currentPage+1)),disabled:r.value.currentPage===r.value.lastPage,class:k([r.value.currentPage===r.value.lastPage?"cursor-not-allowed opacity-50":"hover:bg-gray-50","relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500"])},e[14]||(e[14]=[l("span",{class:"sr-only"},"Next",-1),l("svg",{class:"h-5 w-5",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},[l("path",{"fill-rule":"evenodd",d:"M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z","clip-rule":"evenodd"})],-1)]),10,te)])])):y("",!0),!m.value&&d.value.length>0?(i(),n("div",ae," Showing "+w((r.value.currentPage-1)*r.value.perPage+1)+" to "+w(Math.min(r.value.currentPage*r.value.perPage,r.value.total))+" of "+w(r.value.total)+" emails ",1)):y("",!0)]))}};export{pe as default};
