import{B as we,r as u,s as q,D as he,p as ee,A as be,J as je,h as r,o as l,e as a,u as b,q as ke,a as d,b as s,f as g,k as v,K as A,t as c,F as E,i as z,c as I,g as x,d as te,v as G,m as se}from"./app-nF069t71.js";import{_ as Ce}from"./AuthenticatedLayout-ULslHgUe.js";import{_ as oe}from"./ProjectForm-B2hbRBn6.js";import{P as j}from"./PrimaryButton-C2nFB7gO.js";import{D as ae}from"./DangerButton-WCu87-Cp.js";import{_ as T,a as L}from"./SecondaryButton-D0waIAPf.js";import{_ as k,a as H}from"./TextInput-DG-3FSef.js";import{_ as C}from"./InputError-B1edzhK4.js";import{_ as Oe}from"./NotesModal-wrIWzHrz.js";import"./ApplicationLogo-DubHCp80.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./Checkbox-BLvqBK1z.js";const $e={class:"py-12"},Pe={class:"max-w-12xl mx-auto sm:px-6 lg:px-12"},De={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},Me={class:"p-6 text-gray-900"},Ae={class:"mb-6"},Te={key:0,class:"text-gray-600"},Ve={key:1,class:"text-red-600"},Re={key:2,class:"text-gray-600"},Ne={key:3},Se={class:"min-w-full divide-y divide-gray-200"},Ee={class:"bg-white divide-y divide-gray-200"},Ie={class:"px-6 py-4 whitespace-nowrap"},Ue={class:"px-6 py-4"},We={key:0},Fe={key:1,class:"text-gray-400"},Ye={class:"px-6 py-4 whitespace-nowrap capitalize"},Be={class:"px-6 py-4 whitespace-nowrap"},qe={class:"px-6 py-4"},ze={key:0},Ge={key:1,class:"text-gray-400"},Le={class:"px-6 py-4"},He={key:0},Je={key:1,class:"text-gray-400"},Ke={class:"px-6 py-4 whitespace-nowrap capitalize"},Qe={class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium"},Xe={class:"flex items-center space-x-2"},Ze={class:"p-6"},et={key:0,class:"mt-4 text-gray-800"},tt={key:0},st={key:1,class:"text-red-600 text-sm mb-4"},ot={class:"mt-6 flex justify-end"},at={class:"p-6"},nt={key:0,class:"text-red-600 text-sm mb-4"},lt={class:"mb-4"},rt={class:"mb-4"},it={class:"mb-4"},ut={key:0,class:"mb-4"},dt=["value"],pt={key:1,class:"mb-4"},ct={class:"mt-6 flex justify-end"},vt={class:"p-6"},mt={key:0,class:"text-red-600 text-sm mb-4"},_t={class:"mb-4"},ft=["value"],yt={class:"mt-6 flex justify-end"},At={__name:"Index",setup(gt){const O=we(),m=u([]),ne=u([]),le=u([]),U=u([]),W=u(!0),p=u({}),n=u(""),w=u(!1),h=u(!1),$=u(!1),P=u(!1),F=u(!1),V=u(!1),R=u({}),i=q({project_id:null,description:"",amount:"",user_id:null,hours_spent:"",type:"expense"}),Y=q({project_id:null,content:""}),D=q({project_id:null,payment_type:"one_off"}),y=u(null),re=u(null),{canDo:_,canView:ie}=he();ee(()=>O.value?O.value.role_data&&O.value.role_data.slug==="super-admin"||O.value.role==="super_admin"||O.value.role==="super-admin":!1),_("create_projects");const ue=ee(()=>ie("projects").value),de=_("manage_projects"),J=[{value:"active",label:"Active"},{value:"completed",label:"Completed"},{value:"on_hold",label:"On Hold"},{value:"archived",label:"Archived"}],K=[{value:"Website Designing",label:"Website Designing"},{value:"SEO",label:"SEO"},{value:"Social Media",label:"Social Media"},{value:"Content Writing",label:"Content Writing"},{value:"Graphic Design",label:"Graphic Design"}],Q=[{value:"UpWork",label:"UpWork"},{value:"Direct",label:"Direct Client"},{value:"Wix Marketplace",label:"Wix Marketplace"},{value:"Referral",label:"Referral"}],N=u([]),S=u([]),pe=async()=>{try{const o=await se.get("/api/roles?type=client");N.value=o.data.map(t=>({value:t.id,label:t.name}));const e=await se.get("/api/roles?type=project");S.value=e.data.map(t=>({value:t.id,label:t.name}))}catch(o){console.error("Error fetching roles:",o),N.value=[{value:1,label:"Client Admin"},{value:2,label:"Client User"},{value:3,label:"Client Viewer"}],S.value=[{value:1,label:"Project Manager"},{value:2,label:"Project Member"},{value:3,label:"Project Viewer"}]}},B=[{value:"one_off",label:"One-Off"},{value:"monthly",label:"Monthly"}],X=[{value:"website_design",label:"Website Design"},{value:"seo",label:"SEO"},{value:"social_media",label:"Social Media"},{value:"content_writing",label:"Content Writing"},{value:"graphic_design",label:"Graphic Design"}],M=async()=>{W.value=!0,n.value="";try{const o=await window.axios.get("/api/projects");if(m.value=o.data,de.value){const e=await window.axios.get("/api/clients");ne.value=e.data.data;const t=await window.axios.get("/api/users");le.value=t.data}}catch(o){n.value="Failed to load data.",console.error("Error fetching initial data:",o),o.response&&(o.response.status===401||o.response.status===403)&&(n.value="You are not authorized to view this content or your session expired. Please log in.")}finally{W.value=!1}},ce=()=>{if(!_("create_projects").value){alert("You do not have permission to create projects.");return}R.value={},w.value=!0},ve=o=>{if(!_("manage_projects").value){alert("You do not have permission to edit this project.");return}R.value=o,h.value=!0},Z=o=>{const e=m.value.findIndex(t=>t.id===o.id);e!==-1?m.value[e]=o:m.value.push(o),w.value=!1,h.value=!1,alert(o.id?"Project updated successfully!":"Project created successfully!"),M()},me=o=>{if(!_("delete_projects").value){alert("You do not have permission to delete this project.");return}y.value=o,$.value=!0},_e=async()=>{var e;n.value="";const o=(e=y.value)==null?void 0:e.id;if(!o){n.value="Invalid project.";return}if(!_("delete_projects").value){n.value="You do not have permission to delete this project.";return}try{await window.axios.delete(`/api/projects/${o}`),m.value=m.value.filter(t=>t.id!==o),$.value=!1,y.value=null,alert("Project deleted successfully!")}catch(t){n.value="Failed to delete project.",t.response&&t.response.data.message&&(n.value=t.response.data.message),console.error("Error deleting project:",t)}},fe=async o=>{if(!_("manage_project_transactions").value){alert("You do not have permission to add transactions to this project.");return}const e=o.id;if(!e){console.error("No project ID found in project object:",o);return}i.project_id=e,i.description="",i.amount="",i.user_id=null,i.hours_spent="",i.type="expense",p.value={},n.value="";try{const t=await window.axios.get(`/api/projects/${e}`);U.value=t.data.users||[]}catch(t){console.error("Error fetching project users:",t),U.value=[]}P.value=!0},ye=async()=>{p.value={},n.value="";const o=i.project_id;if(!o){n.value="Invalid project.";return}if(!_("manage_project_transactions").value){n.value="You do not have permission to add transactions to this project.";return}try{await window.axios.post(`/api/projects/${o}/expenses`,{expenses:[i]}),P.value=!1,alert("Transaction added successfully!"),M()}catch(e){e.response&&e.response.status===422?p.value=e.response.data.errors:e.response&&e.response.data.message?n.value=e.response.data.message:(n.value="Failed to add transaction.",console.error("Error adding transaction:",e))}},ge=o=>{if(!_("add_project_notes").value){alert("You do not have permission to add notes to this project.");return}const e=o.id;if(!e){console.error("No project ID found in project object:",o);return}Y.project_id=e,Y.content="",p.value={},n.value="",F.value=!0},xe=async()=>{n.value="";const o=D.project_id;if(!o){n.value="Invalid project.";return}if(!_("manage_project_services_and_payments").value){n.value="You do not have permission to convert payment type for this project.";return}try{await window.axios.post(`/api/projects/${o}/convert-payment-type`,{payment_type:D.payment_type});const e=m.value.findIndex(t=>t.id===o);e!==-1&&(m.value[e].payment_type=D.payment_type),V.value=!1,re.value=null,alert("Payment type converted successfully!"),M()}catch(e){n.value="Failed to convert payment type.",e.response&&e.response.data.message&&(n.value=e.response.data.message),console.error("Error converting payment type:",e)}};return be(()=>{if(!ue.value){window.location.href=route("dashboard");return}M(),pe();const o=document.querySelector("#app").__vue_app__;o&&je(o)}),(o,e)=>(l(),r(E,null,[a(b(ke),{title:"Projects"}),a(Ce,null,{header:d(()=>e[17]||(e[17]=[s("h2",{class:"font-semibold text-xl text-gray-800 leading-tight"},"Projects",-1)])),default:d(()=>[s("div",$e,[s("div",Pe,[s("div",De,[s("div",Me,[e[24]||(e[24]=s("h3",{class:"text-2xl font-bold mb-4"},"Project List",-1)),g((l(),r("div",Ae,[a(j,{onClick:ce},{default:d(()=>e[18]||(e[18]=[v(" Create New Project ")])),_:1,__:[18]})])),[[b(A),"create_projects"]]),W.value?(l(),r("div",Te,"Loading projects...")):n.value?(l(),r("div",Ve,c(n.value),1)):m.value.length===0?(l(),r("div",Re,"No projects found.")):(l(),r("div",Ne,[s("table",Se,[e[23]||(e[23]=s("thead",{class:"bg-gray-50"},[s("tr",null,[s("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Name"),s("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Clients"),s("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Status"),s("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Type"),s("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Departments"),s("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Assigned Users"),s("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Payment Type"),s("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Actions")])],-1)),s("tbody",Ee,[(l(!0),r(E,null,z(m.value,t=>(l(),r("tr",{key:t.id},[s("td",Ie,c(t.name),1),s("td",Ue,[t.clients&&t.clients.length?(l(),r("span",We,c(t.clients.map(f=>`${f.name} (${f.pivot.role})`).join(", ")),1)):(l(),r("span",Fe,"None"))]),s("td",Ye,c(t.status.replace("_"," ")),1),s("td",Be,c(t.project_type||"N/A"),1),s("td",qe,[t.departments&&t.departments.length?(l(),r("span",ze,c(t.departments.join(", ")),1)):(l(),r("span",Ge,"None"))]),s("td",Le,[t.users&&t.users.length?(l(),r("span",He,c(t.users.map(f=>`${f.name} (${f.pivot.role})`).join(", ")),1)):(l(),r("span",Je,"None"))]),s("td",Ke,c(t.payment_type.replace("_"," ")),1),s("td",Qe,[s("div",Xe,[g((l(),I(j,{onClick:f=>ve(t)},{default:d(()=>e[19]||(e[19]=[v("Edit")])),_:2,__:[19]},1032,["onClick"])),[[b(A),"manage_projects"]]),g((l(),I(j,{onClick:f=>fe(t)},{default:d(()=>e[20]||(e[20]=[v("Add Transactions")])),_:2,__:[20]},1032,["onClick"])),[[b(A),"manage_project_transactions"]]),g((l(),I(j,{onClick:f=>ge(t)},{default:d(()=>e[21]||(e[21]=[v("Add Note")])),_:2,__:[21]},1032,["onClick"])),[[b(A),"add_project_notes"]]),g((l(),I(ae,{onClick:f=>me(t)},{default:d(()=>e[22]||(e[22]=[v("Delete")])),_:2,__:[22]},1032,["onClick"])),[[b(A),"delete_projects"]])])])]))),128))])])]))])])])]),a(T,{show:w.value,onClose:e[1]||(e[1]=t=>w.value=!1)},{default:d(()=>[a(oe,{show:w.value,project:R.value,statusOptions:J,serviceOptions:X,departmentOptions:K,sourceOptions:Q,clientRoleOptions:N.value,userRoleOptions:S.value,paymentTypeOptions:B,onClose:e[0]||(e[0]=t=>w.value=!1),onSubmit:Z},null,8,["show","project","clientRoleOptions","userRoleOptions"])]),_:1},8,["show"]),a(T,{show:h.value,onClose:e[3]||(e[3]=t=>h.value=!1)},{default:d(()=>[a(oe,{show:h.value,project:R.value,statusOptions:J,serviceOptions:X,departmentOptions:K,sourceOptions:Q,clientRoleOptions:N.value,userRoleOptions:S.value,paymentTypeOptions:B,onClose:e[2]||(e[2]=t=>h.value=!1),onSubmit:Z},null,8,["show","project","clientRoleOptions","userRoleOptions"])]),_:1},8,["show"]),a(T,{show:$.value,onClose:e[5]||(e[5]=t=>$.value=!1)},{default:d(()=>[s("div",Ze,[e[28]||(e[28]=s("h2",{class:"text-lg font-medium text-gray-900"}," Are you sure you want to delete this project? ",-1)),e[29]||(e[29]=s("p",{class:"mt-1 text-sm text-gray-600"}," This action cannot be undone. All associated conversations and emails will also be deleted. ",-1)),y.value?(l(),r("div",et,[e[25]||(e[25]=s("strong",null,"Project:",-1)),v(" "+c(y.value.name)+" ",1),y.value.clients&&y.value.clients.length?(l(),r("span",tt," (Clients: "+c(y.value.clients.map(t=>`${t.name} (${t.pivot.role})`).join(", "))+") ",1)):x("",!0)])):x("",!0),n.value?(l(),r("div",st,c(n.value),1)):x("",!0),s("div",ot,[a(L,{onClick:e[4]||(e[4]=t=>$.value=!1)},{default:d(()=>e[26]||(e[26]=[v("Cancel")])),_:1,__:[26]}),a(ae,{class:"ms-3",onClick:_e},{default:d(()=>e[27]||(e[27]=[v("Delete Project")])),_:1,__:[27]})])])]),_:1},8,["show"]),a(T,{show:P.value,onClose:e[12]||(e[12]=t=>P.value=!1)},{default:d(()=>[s("div",at,[e[34]||(e[34]=s("h2",{class:"text-lg font-medium text-gray-900 mb-4"},"Add Transactions",-1)),n.value?(l(),r("div",nt,c(n.value),1)):x("",!0),s("form",{onSubmit:te(ye,["prevent"])},[s("div",lt,[a(k,{for:"transaction_type",value:"Type"}),g(s("select",{id:"transaction_type",class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full","onUpdate:modelValue":e[6]||(e[6]=t=>i.type=t)},e[30]||(e[30]=[s("option",{value:"income"},"Income",-1),s("option",{value:"expense"},"Expense",-1)]),512),[[G,i.type]]),a(C,{message:p.value["expenses.0.type"]?p.value["expenses.0.type"][0]:"",class:"mt-2"},null,8,["message"])]),s("div",rt,[a(k,{for:"transaction_description",value:"Description"}),a(H,{id:"transaction_description",type:"text",class:"mt-1 block w-full",modelValue:i.description,"onUpdate:modelValue":e[7]||(e[7]=t=>i.description=t),required:""},null,8,["modelValue"]),a(C,{message:p.value["expenses.0.description"]?p.value["expenses.0.description"][0]:"",class:"mt-2"},null,8,["message"])]),s("div",it,[a(k,{for:"transaction_amount",value:"Amount"}),a(H,{id:"transaction_amount",type:"number",step:"0.01",class:"mt-1 block w-full",modelValue:i.amount,"onUpdate:modelValue":e[8]||(e[8]=t=>i.amount=t),required:""},null,8,["modelValue"]),a(C,{message:p.value["expenses.0.amount"]?p.value["expenses.0.amount"][0]:"",class:"mt-2"},null,8,["message"])]),i.type==="expense"?(l(),r("div",ut,[a(k,{for:"transaction_user_id",value:"User (Optional)"}),g(s("select",{id:"transaction_user_id",class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full","onUpdate:modelValue":e[9]||(e[9]=t=>i.user_id=t)},[e[31]||(e[31]=s("option",{value:"",disabled:""},"Select User",-1)),(l(!0),r(E,null,z(U.value,t=>(l(),r("option",{key:t.id,value:t.id},c(t.name),9,dt))),128))],512),[[G,i.user_id]]),a(C,{message:p.value["expenses.0.user_id"]?p.value["expenses.0.user_id"][0]:"",class:"mt-2"},null,8,["message"])])):x("",!0),i.type==="expense"?(l(),r("div",pt,[a(k,{for:"transaction_hours_spent",value:"Hours Spent (Optional)"}),a(H,{id:"transaction_hours_spent",type:"number",step:"0.01",class:"mt-1 block w-full",modelValue:i.hours_spent,"onUpdate:modelValue":e[10]||(e[10]=t=>i.hours_spent=t)},null,8,["modelValue"]),a(C,{message:p.value["expenses.0.hours_spent"]?p.value["expenses.0.hours_spent"][0]:"",class:"mt-2"},null,8,["message"])])):x("",!0),s("div",ct,[a(L,{onClick:e[11]||(e[11]=t=>P.value=!1)},{default:d(()=>e[32]||(e[32]=[v("Cancel")])),_:1,__:[32]}),a(j,{class:"ms-3",type:"submit"},{default:d(()=>e[33]||(e[33]=[v("Add Transaction")])),_:1,__:[33]})])],32)])]),_:1},8,["show"]),a(Oe,{show:F.value,"project-id":Y.project_id,onClose:e[13]||(e[13]=t=>F.value=!1),onNoteAdded:M},null,8,["show","project-id"]),a(T,{show:V.value,onClose:e[16]||(e[16]=t=>V.value=!1)},{default:d(()=>[s("div",vt,[e[37]||(e[37]=s("h2",{class:"text-lg font-medium text-gray-900 mb-4"},"Convert Payment Type",-1)),n.value?(l(),r("div",mt,c(n.value),1)):x("",!0),s("form",{onSubmit:te(xe,["prevent"])},[s("div",_t,[a(k,{for:"convert_payment_type",value:"Payment Type"}),g(s("select",{id:"convert_payment_type",class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full","onUpdate:modelValue":e[14]||(e[14]=t=>D.payment_type=t),required:""},[(l(),r(E,null,z(B,t=>s("option",{key:t.value,value:t.value},c(t.label),9,ft)),64))],512),[[G,D.payment_type]]),a(C,{message:p.value.payment_type?p.value.payment_type[0]:"",class:"mt-2"},null,8,["message"])]),s("div",yt,[a(L,{onClick:e[15]||(e[15]=t=>V.value=!1)},{default:d(()=>e[35]||(e[35]=[v("Cancel")])),_:1,__:[35]}),a(j,{class:"ms-3",type:"submit"},{default:d(()=>e[36]||(e[36]=[v("Convert")])),_:1,__:[36]})])],32)])]),_:1},8,["show"])]),_:1})],64))}};export{At as default};
