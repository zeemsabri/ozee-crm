import{r as u,p as T,z as F,w as H,h as n,o as l,b as s,e as D,g as I,f as P,v as q,F as y,i as w,t as c,k as R,n as $,m as k,u as B,q as G,a as j}from"./app-BX-MO2gA.js";import{a as J,_ as K}from"./AuthenticatedLayout-n-kBzsPc.js";import"./ApplicationLogo-BSjX68Gr.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./PrimaryButton-cDVGy_SR.js";import"./SecondaryButton-BYiqSkqb.js";import"./InputError-Ds8wopg2.js";const Q={class:"bg-white rounded-lg shadow-md p-6","data-test":"availability-calendar"},X={class:"flex flex-col sm:flex-row justify-between items-center mb-6"},Y={class:"flex items-center space-x-4"},Z={key:0,class:"w-48"},ee=["value"],te={class:"flex items-center space-x-2"},se={class:"text-sm font-medium"},ae={key:0,class:"flex justify-center items-center py-12"},oe={key:1,class:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-md"},ne={key:2,class:"overflow-x-auto"},le={class:"min-w-full divide-y divide-gray-200"},re={class:"flex flex-col items-center"},ie={class:"text-lg font-bold"},de={class:"text-xs mt-1"},ue={class:"bg-white divide-y divide-gray-200"},ce={class:"min-h-[150px]"},ve={class:"mb-3 flex justify-center"},ge=["onClick"],me={key:0},pe={class:"flex items-center justify-between"},he={key:0},fe={key:1,class:"text-xs text-gray-600 mt-1"},xe={key:1,class:"flex items-center justify-center h-full text-gray-400 text-xs italic"},ye={__name:"AvailabilityCalendar",props:{userId:{type:Number,default:null},isAdmin:{type:Boolean,default:!1}},setup(S){const v=S,_=u([]),h=u([]),f=u(!1),g=u(""),r=u(""),i=u(""),d=u(v.userId);u("weekly");const b=u(!1),p=u(""),x=()=>{const e=localStorage.getItem("authToken");e&&!k.defaults.headers.common.Authorization&&(k.defaults.headers.common.Authorization=`Bearer ${e}`,console.log("Auth headers set in AvailabilityCalendar"))},m=async()=>{f.value=!0,g.value="";try{x();let e="/api/availabilities";const t={};r.value&&(t.start_date=r.value),i.value&&(t.end_date=i.value),d.value&&v.isAdmin&&(t.user_id=d.value);const a=await k.get(e,{params:t});_.value=a.data.availabilities,a.data.start_date&&(r.value=a.data.start_date),a.data.end_date&&(i.value=a.data.end_date),v.isAdmin&&h.value.length===0&&O()}catch(e){console.error("Error fetching availabilities:",e),e.response&&e.response.status===401?g.value="Authentication error. Please refresh the page or log in again.":g.value="Failed to load availabilities. Please try again."}finally{f.value=!1}},O=async()=>{try{x();const e=await k.get("/api/users");h.value=e.data}catch(e){console.error("Error fetching users:",e),e.response&&e.response.status===401&&(g.value="Authentication error. Please refresh the page or log in again.")}},A=T(()=>{if(!r.value)return[];const e=[],t=new Date(r.value);for(let a=0;a<7;a++){const o=new Date(t);o.setDate(t.getDate()+a),e.push({date:o.toISOString().split("T")[0],label:o.toLocaleDateString("en-US",{weekday:"short"}),fullLabel:o.toLocaleDateString("en-US",{weekday:"long",month:"short",day:"numeric"})})}return e}),C=T(()=>{const e={};return A.value.forEach(t=>{e[t.date]=_.value.filter(a=>a.date.split("T")[0]===t.date)}),e}),U=()=>{const e=new Date(r.value);e.setDate(e.getDate()-7),r.value=e.toISOString().split("T")[0];const t=new Date(i.value);t.setDate(t.getDate()-7),i.value=t.toISOString().split("T")[0],m()},M=()=>{const e=new Date(r.value);e.setDate(e.getDate()+7),r.value=e.toISOString().split("T")[0];const t=new Date(i.value);t.setDate(t.getDate()+7),i.value=t.toISOString().split("T")[0],m()},N=e=>{d.value=e.target.value?parseInt(e.target.value):null,m()},z=e=>{p.value=e,b.value=!0},L=()=>{m()},V=e=>`${e.start_time} - ${e.end_time}`;return F(()=>{if(x(),!r.value){const e=new Date,t=e.getDay(),a=new Date(e);a.setDate(e.getDate()-t),r.value=a.toISOString().split("T")[0];const o=new Date(e);o.setDate(e.getDate()+(6-t)),i.value=o.toISOString().split("T")[0]}setTimeout(()=>{m()},100)}),H(()=>v.userId,e=>{e!==d.value&&(d.value=e,m())}),(e,t)=>(l(),n("div",Q,[s("div",X,[t[5]||(t[5]=s("h2",{class:"text-2xl font-bold text-gray-800 mb-4 sm:mb-0"},"Weekly Availability",-1)),s("div",Y,[v.isAdmin?(l(),n("div",Z,[P(s("select",{"onUpdate:modelValue":t[0]||(t[0]=a=>d.value=a),onChange:N,class:"w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"},[t[2]||(t[2]=s("option",{value:null},"All Users",-1)),(l(!0),n(y,null,w(h.value,a=>(l(),n("option",{key:a.id,value:a.id},c(a.name),9,ee))),128))],544),[[q,d.value]])])):I("",!0),s("div",te,[s("button",{onClick:U,class:"p-2 rounded-full bg-gray-100 hover:bg-gray-200 transition-colors"},t[3]||(t[3]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])),s("span",se,c(new Date(r.value).toLocaleDateString("en-US",{month:"short",day:"numeric"}))+" - "+c(new Date(i.value).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})),1),s("button",{onClick:M,class:"p-2 rounded-full bg-gray-100 hover:bg-gray-200 transition-colors"},t[4]||(t[4]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)]))])])]),f.value?(l(),n("div",ae,t[6]||(t[6]=[s("svg",{class:"animate-spin h-8 w-8 text-indigo-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[s("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),s("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)]))):g.value?(l(),n("div",oe,c(g.value),1)):(l(),n("div",ne,[s("table",le,[s("thead",null,[s("tr",null,[(l(!0),n(y,null,w(A.value,a=>(l(),n("th",{key:a.date,class:"px-6 py-3 bg-gray-50 text-center text-xs font-medium text-gray-500 uppercase tracking-wider"},[s("div",re,[s("span",ie,c(a.label),1),s("span",de,c(a.date),1)])]))),128))])]),s("tbody",ue,[s("tr",null,[(l(!0),n(y,null,w(A.value,a=>(l(),n("td",{key:a.date,class:"px-2 py-4 whitespace-nowrap text-sm text-gray-500 border-r border-gray-100 align-top"},[s("div",ce,[s("div",ve,[s("button",{onClick:o=>z(a.date),class:"inline-flex items-center px-3 py-1 border border-transparent text-xs leading-4 font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-500 focus:outline-none focus:border-indigo-700 focus:shadow-outline-indigo active:bg-indigo-700 transition ease-in-out duration-150"},t[7]||(t[7]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})],-1),R(" Add ")]),8,ge)]),C.value[a.date]&&C.value[a.date].length>0?(l(),n("div",me,[(l(!0),n(y,null,w(C.value[a.date],o=>(l(),n("div",{key:o.id,class:$(["mb-2 p-2 rounded-md",o.is_available?"bg-green-50 border border-green-100":"bg-red-50 border border-red-100"])},[s("div",pe,[s("span",{class:$(["font-medium",o.is_available?"text-green-700":"text-red-700"])},c(o.user?o.user.name+" - ":"")+c(o.is_available?"Available":"Not Available"),3)]),o.is_available&&o.time_slots?(l(),n("div",he,[(l(!0),n(y,null,w(o.time_slots,(W,E)=>(l(),n("div",{key:E,class:"text-xs text-gray-600 mt-1"},c(V(W)),1))),128))])):I("",!0),!o.is_available&&o.reason?(l(),n("div",fe," Reason: "+c(o.reason),1)):I("",!0)],2))),128))])):(l(),n("div",xe," No availability set "))])]))),128))])])])])),D(J,{show:b.value,date:p.value,onClose:t[1]||(t[1]=a=>b.value=!1),onAvailabilitySaved:L},null,8,["show","date"])]))}},we={class:"py-12"},_e={class:"mx-auto max-w-7xl sm:px-6 lg:px-8"},be={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},ke={class:"p-6 text-gray-900"},Be={__name:"Index",props:{auth:Object},setup(S){var h,f,g,r,i,d;const v=S,_=((g=(f=(h=v.auth)==null?void 0:h.user)==null?void 0:f.role_data)==null?void 0:g.slug)==="super-admin"||((d=(i=(r=v.auth)==null?void 0:r.user)==null?void 0:i.role_data)==null?void 0:d.slug)==="manager";return(b,p)=>(l(),n(y,null,[D(B(G),{title:"Weekly Availability"}),D(K,null,{header:j(()=>p[0]||(p[0]=[s("h2",{class:"text-xl font-semibold leading-tight text-gray-800"}," Weekly Availability ",-1)])),default:j(()=>{var x,m;return[s("div",we,[s("div",_e,[s("div",be,[s("div",ke,[p[1]||(p[1]=s("p",{class:"mb-6 text-gray-600"}," View and manage your weekly availability. This helps in planning meetings and work schedules. ",-1)),D(ye,{"user-id":(m=(x=v.auth)==null?void 0:x.user)==null?void 0:m.id,"is-admin":B(_)},null,8,["user-id","is-admin"])])])])])]}),_:1})],64))}};export{Be as default};
