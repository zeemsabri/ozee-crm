import J from"./BaseModal-BU6yTLoc.js";import Q from"./LoadingOverlay-DCDAME0v.js";import R from"./Sidebar-CTfK4dDV.js";import W from"./HomeSection-DTzA3HrV.js";import X from"./TicketsSection-CsWzdNCZ.js";import Y from"./ApprovalsSection-IxyIJfMS.js";import Z from"./DocumentsSection-B0cZ7Cee.js";import _ from"./InvoicesSection-BMfwul2a.js";import ee from"./AnnouncementsSection-COkAQ6CM.js";import te from"./DeliverablViewerModal-BCt-V7p_.js";import{_ as ae,r as n,s as ne,B as oe,C as L,i as U,o as r,e as A,g as u,b as f,t as le,c as v,D as ie}from"./app-TPbKwKr-.js";import"./TicketNotesSidebar-DA6DFqEF.js";import"./CreateTaskModal-B4mtkvLc.js";const se={class:"bg-gray-100 flex min-h-screen font-sans"},re={key:0,class:"fixed inset-0 bg-red-100 bg-opacity-90 flex items-center justify-center z-50 p-4"},ce={class:"bg-white p-8 rounded-lg shadow-xl text-red-700 max-w-lg w-full text-center"},ue={class:"mb-6 whitespace-pre-line"},de={__name:"ClientDashboard",props:{initialAuthToken:{type:String,default:""},projectId:{type:[String,Number],required:!0}},setup(o){const c=o,b=n(!0),z=n("client-user"),l=n("home"),w=n(!1),C=n(null),x=n(!1),d=n(!1),O=n(""),$=n(""),B=n([]),D=n(null),y=n([]),p=n([]),E=n([]),m=n([]),k=n([]),M=n([]),g=n([]),i=n(null),S=n({}),P=ne(()=>({marginLeft:w.value?"16rem":"4rem"})),V=a=>{C.value=a,x.value=!0},j=async(a,t)=>{try{const e=await fetch(`/api/client-api/${a}`,{headers:{Authorization:`Bearer ${c.initialAuthToken}`,"Content-Type":"application/json",Accept:"application/json"}});if(!e.ok){const I=await e.json();throw new Error(I.message||`Failed to fetch data from ${a}.`)}const s=await e.json();t.value=s}catch(e){console.error(`Error fetching from ${a}:`,e),i.value=i.value?i.value+`
${e.message}`:e.message}},q=(a,t,e,s=null,I=null)=>{O.value=a,$.value=t,D.value=I;const T=[];e==="alert"?T.push({label:"OK",className:"bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700",onClick:()=>d.value=!1}):e==="confirm"&&T.push({label:"Cancel",className:"bg-gray-300 text-gray-800 py-2 px-4 rounded-lg hover:bg-gray-400",onClick:()=>d.value=!1},{label:"Confirm",className:"bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700",onClick:()=>{s&&s(),d.value=!1}}),B.value=T,d.value=!0},F=()=>{d.value=!1,D.value=null},h=async a=>{console.log("Simulating adding activity:",a);const t={id:Date.now(),description:a,date:new Date().toISOString()};y.value.unshift(t),y.value=y.value.slice(0,10)},H=async a=>{p.value.unshift(a),p.value.sort((t,e)=>new Date(e.date).getTime()-new Date(t.date).getTime())},N=async(a,t)=>{const e=g.value.findIndex(s=>s.id===a);e!==-1&&(g.value[e].status=t)},K=async a=>{console.log("Simulating adding document:",a),m.value.unshift(a),m.value.sort((t,e)=>new Date(e.uploadDate).getTime()-new Date(t.uploadDate).getTime())},G=async(a,t)=>{console.log(`Simulating updating invoice ${a} to ${t}`);const e=k.value.findIndex(s=>s.id===a);e!==-1&&(k.value[e].status=t)};return oe(async()=>{if(b.value=!0,i.value=null,!c.initialAuthToken||!c.projectId){i.value="Authentication token or Project ID missing. Cannot load dashboard.",b.value=!1;return}await Promise.all([j(`project/${c.projectId}/tasks`,p),j(`project/${c.projectId}/documents`,m),j(`project/${c.projectId}/deliverables`,g),j(`project/${c.projectId}`,S)]),b.value=!1}),L("modalService",{showModal:q}),L("activityService",{addActivity:h}),(a,t)=>(r(),U("div",se,[A(Q,{isLoading:b.value},null,8,["isLoading"]),i.value?(r(),U("div",re,[f("div",ce,[t[4]||(t[4]=f("h3",{class:"text-2xl font-bold mb-4"},"Error Loading Dashboard",-1)),f("p",ue,le(i.value),1),f("button",{onClick:t[0]||(t[0]=e=>i.value=null),class:"bg-red-600 text-white py-2 px-4 rounded-lg hover:bg-red-700"},"Dismiss")])])):u("",!0),A(R,{userId:z.value,activeSection:l.value,isExpanded:w.value,onSectionChange:t[1]||(t[1]=e=>l.value=e),"onUpdate:isExpanded":t[2]||(t[2]=e=>w.value=e)},null,8,["userId","activeSection","isExpanded"]),f("div",{class:"flex-1 p-8 overflow-y-auto main-content",style:ie(P.value)},[l.value==="home"?(r(),v(W,{key:0,activities:y.value,tickets:p.value,approvals:E.value,documents:m.value,invoices:k.value,announcements:M.value,deliverables:g.value,onOpenDeliverableViewer:V,"project-data":S.value},null,8,["activities","tickets","approvals","documents","invoices","announcements","deliverables","project-data"])):u("",!0),l.value==="tickets"?(r(),v(X,{key:1,"project-id":o.projectId,"initial-auth-token":o.initialAuthToken,tickets:p.value,onAddTicket:H,onAddActivity:h},null,8,["project-id","initial-auth-token","tickets"])):u("",!0),l.value==="approvals"?(r(),v(Y,{key:2,onOpenDeliverableViewer:V,deliverables:g.value,"initial-auth-token":o.initialAuthToken,"project-id":o.projectId,approvals:E.value,onUpdateApproval:N,onAddActivity:h},null,8,["deliverables","initial-auth-token","project-id","approvals"])):u("",!0),l.value==="documents"?(r(),v(Z,{key:3,"project-data":S.value,"project-id":o.projectId,"initial-auth-token":o.initialAuthToken,documents:m.value,onAddDocument:K,onAddActivity:h},null,8,["project-data","project-id","initial-auth-token","documents"])):u("",!0),l.value==="invoices"?(r(),v(_,{key:4,invoices:k.value,onUpdateInvoice:G,onAddActivity:h},null,8,["invoices"])):u("",!0),l.value==="announcements"?(r(),v(ee,{key:5,announcements:M.value},null,8,["announcements"])):u("",!0)],4),A(J,{isOpen:d.value,title:O.value,message:$.value,buttons:B.value,children:D.value,onClose:F},null,8,["isOpen","title","message","buttons","children"]),A(te,{isOpen:x.value,"onUpdate:isOpen":t[3]||(t[3]=e=>x.value=e),deliverable:C.value,initialAuthToken:o.initialAuthToken,projectId:o.projectId,onDeliverableActionSuccess:N},null,8,["isOpen","deliverable","initialAuthToken","projectId"])]))}},De=ae(de,[["__scopeId","data-v-b156d4c2"]]);export{De as default};
