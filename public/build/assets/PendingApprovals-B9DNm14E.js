import{c as A,E as J,r as p,C as U,f as K,a as n,o as d,d as o,u as Q,h as W,w as u,b as s,i as R,t as m,F as V,l as B,m as _,s as D,v as q,G as X,x as Z}from"./app-D1j92mid.js";import{_ as ee}from"./AuthenticatedLayout-CQl1tDqT.js";import{_ as k}from"./PrimaryButton-DKgcIZwH.js";import{_ as P}from"./SecondaryButton-Ba_LFbiX.js";import{_ as w}from"./InputLabel-DBtfOcRr.js";import{_ as se}from"./TextInput-BXe6p22v.js";import{_ as E}from"./InputError-DCNp6dZp.js";import{_ as L}from"./Modal-B1MgeQ1l.js";import{R as te}from"./RichTextEditor-C-DQRtkC.js";import"./index-DZskEl6X.js";import"./BaseFormModal-D1HySJI3.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./SelectDropdown-DUuuX2sh.js";/* empty css                                                                       */import"./debounce-C-hnF4Z3.js";import"./ApplicationLogo-DKKTvJsW.js";import"./createLucideIcon-Dx2LDjmw.js";import"./plus-BO7zRjwX.js";import"./DangerButton-C7ZQVatA.js";import"./moment-BLMuvzoS.js";import"./NoticeboardModal-C0wQpXH0.js";const oe={class:"py-12"},ae={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},re={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},le={class:"p-6 text-gray-900"},ie={key:0,class:"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative mb-4",role:"alert"},ne={class:"block sm:inline"},de={key:1,class:"text-gray-600"},pe={key:2,class:"text-red-600"},ue={key:3,class:"text-gray-600"},ce={key:4},me={class:"overflow-x-auto"},ve={class:"w-full divide-y divide-gray-200"},_e={class:"bg-white divide-y divide-gray-200"},fe={class:"px-4 py-4 whitespace-nowrap"},xe={class:"px-4 py-4 whitespace-nowrap"},ge={class:"px-4 py-4 truncate max-w-xs"},ye={class:"px-4 py-4 whitespace-nowrap"},be={class:"px-4 py-4 whitespace-nowrap"},we={class:"px-4 py-4 whitespace-nowrap flex space-x-2"},je={class:"p-6"},he={key:0},ke={class:"mb-4"},Ee=["value"],Ce={class:"mb-4"},$e={id:"client_name",class:"mt-1 p-2 border border-gray-300 rounded-md bg-gray-50"},Ae={class:"mb-4"},Re={class:"mb-6"},Ve={class:"mt-6 flex justify-end space-x-2"},Pe={class:"p-6"},Se={key:0},Me={class:"mb-6"},Ne={class:"mt-6 flex justify-end space-x-2"},os={__name:"PendingApprovals",setup(Fe){const S=A(()=>J().props.auth.user),C=p([]),j=p([]),T=p([]),$=p(!0),r=p(""),f=p(""),x=p(!1),g=p(!1),v=p(null),l=U({project_id:"",client_id:"",subject:"",body:""}),c=p({}),y=U({rejection_reason:""}),b=p({}),z=A(()=>S.value.role==="contractor"?j.value.filter(t=>t.users&&t.users.some(e=>e.id===S.value.id)):j.value);A(()=>{const t=j.value.find(e=>e.id===l.project_id);return t?T.value.find(e=>e.id===t.client_id):null});const h=async()=>{$.value=!0,r.value="";try{const t=await window.axios.get("/api/emails/pending-approval-simplified");C.value=t.data;const e=await window.axios.get("/api/projects");j.value=e.data}catch(t){r.value="Failed to load data.",console.error("Error fetching initial data:",t),t.response&&(t.response.status===401||t.response.status===403)&&(r.value="You are not authorized to view this content or your session expired. Please log in.")}finally{$.value=!1}},G=t=>{var e;v.value=t,l.project_id=(e=t.project)==null?void 0:e.id,l.subject=t.subject,l.body=t.body,c.value={},x.value=!0},I=async()=>{c.value={},r.value="";try{const t={project_id:l.project_id,subject:l.subject,body:l.body};await window.axios.post(`/api/emails/${v.value.id}/edit-and-approve`,t),f.value="Email updated and approved successfully!",x.value=!1,await h()}catch(t){t.response&&t.response.status===422?c.value=t.response.data.errors:t.response&&t.response.data.message?r.value=t.response.data.message:(r.value="Failed to update and approve email.",console.error("Error updating and approving email:",t))}},O=async t=>{r.value="";try{await window.axios.post(`/api/emails/${t.id}/approve`),f.value="Email approved successfully!",await h()}catch(e){e.response&&e.response.data.message?r.value=e.response.data.message:(r.value="Failed to approve email.",console.error("Error approving email:",e))}},Y=t=>{v.value=t,y.rejection_reason="",b.value={},g.value=!0},H=async()=>{b.value={},r.value="";try{await window.axios.post(`/api/emails/${v.value.id}/reject`,{rejection_reason:y.rejection_reason}),f.value="Email rejected successfully!",y.rejection_reason="",g.value=!1,await h()}catch(t){t.response&&t.response.status===422?b.value=t.response.data.errors:t.response&&t.response.data.message?r.value=t.response.data.message:(r.value="Failed to reject email.",console.error("Error rejecting email:",t))}};return K(()=>{h()}),(t,e)=>(d(),n(V,null,[o(Q(W),{title:"Pending Approvals"}),o(ee,null,{header:u(()=>e[8]||(e[8]=[s("h2",{class:"font-semibold text-xl text-gray-800 leading-tight"},"Pending Email Approvals",-1)])),default:u(()=>[s("div",oe,[s("div",ae,[s("div",re,[s("div",le,[e[13]||(e[13]=s("h3",{class:"text-2xl font-bold mb-4"},"Emails Pending Approval",-1)),f.value?(d(),n("div",ie,[s("span",ne,m(f.value),1)])):R("",!0),$.value?(d(),n("div",de,"Loading pending emails...")):r.value?(d(),n("div",pe,m(r.value),1)):C.value.length===0?(d(),n("div",ue,"No pending emails found.")):(d(),n("div",ce,[s("div",me,[s("table",ve,[e[12]||(e[12]=s("thead",{class:"bg-gray-50"},[s("tr",null,[s("th",{scope:"col",class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Project"),s("th",{scope:"col",class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Client"),s("th",{scope:"col",class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Subject"),s("th",{scope:"col",class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Sender"),s("th",{scope:"col",class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Submitted On"),s("th",{scope:"col",class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Actions")])],-1)),s("tbody",_e,[(d(!0),n(V,null,B(C.value,a=>{var i,M,N;return d(),n("tr",{key:a.id},[s("td",fe,m(((i=a.project)==null?void 0:i.name)||"N/A"),1),s("td",xe,m(((M=a.client)==null?void 0:M.name)||"N/A"),1),s("td",ge,m(a.subject),1),s("td",ye,m(((N=a.sender)==null?void 0:N.name)||"N/A"),1),s("td",be,m(new Date(a.created_at).toLocaleString()),1),s("td",we,[o(k,{onClick:F=>O(a),class:"text-xs px-2 py-1"},{default:u(()=>e[9]||(e[9]=[_("Approve",-1)])),_:2,__:[9]},1032,["onClick"]),o(k,{onClick:F=>G(a),class:"text-xs px-2 py-1"},{default:u(()=>e[10]||(e[10]=[_("Edit & Approve",-1)])),_:2,__:[10]},1032,["onClick"]),o(P,{onClick:F=>Y(a),class:"text-xs px-2 py-1"},{default:u(()=>e[11]||(e[11]=[_("Reject",-1)])),_:2,__:[11]},1032,["onClick"])])])}),128))])])])]))])])])]),o(L,{show:x.value,onClose:e[4]||(e[4]=a=>x.value=!1),"max-width":"3xl"},{default:u(()=>{var a;return[s("div",je,[e[17]||(e[17]=s("h2",{class:"text-2xl font-bold text-gray-900 mb-4"},"Edit and Approve Email",-1)),v.value?(d(),n("div",he,[s("form",{onSubmit:D(I,["prevent"])},[s("div",ke,[o(w,{for:"project_id",value:"Project"}),q(s("select",{id:"project_id",class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full","onUpdate:modelValue":e[0]||(e[0]=i=>l.project_id=i),required:""},[e[14]||(e[14]=s("option",{value:"",disabled:""},"Select a Project",-1)),(d(!0),n(V,null,B(z.value,i=>(d(),n("option",{key:i.id,value:i.id},m(i.name),9,Ee))),128))],512),[[X,l.project_id]]),o(E,{message:c.value.project_id?c.value.project_id[0]:"",class:"mt-2"},null,8,["message"])]),s("div",Ce,[o(w,{for:"client_name",value:"Client"}),s("div",$e,m(((a=v.value.client)==null?void 0:a.name)||"N/A"),1)]),s("div",Ae,[o(w,{for:"subject",value:"Subject"}),o(se,{id:"subject",type:"text",class:"mt-1 block w-full",modelValue:l.subject,"onUpdate:modelValue":e[1]||(e[1]=i=>l.subject=i),required:""},null,8,["modelValue"]),o(E,{message:c.value.subject?c.value.subject[0]:"",class:"mt-2"},null,8,["message"])]),s("div",Re,[o(w,{for:"body",value:"Email Body"}),o(te,{id:"body",modelValue:l.body,"onUpdate:modelValue":e[2]||(e[2]=i=>l.body=i),placeholder:"Edit your email here...",height:"300px"},null,8,["modelValue"]),o(E,{message:c.value.body?c.value.body[0]:"",class:"mt-2"},null,8,["message"])]),s("div",Ve,[o(P,{onClick:e[3]||(e[3]=i=>x.value=!1)},{default:u(()=>e[15]||(e[15]=[_("Cancel",-1)])),_:1,__:[15]}),o(k,{type:"submit"},{default:u(()=>e[16]||(e[16]=[_("Save & Approve",-1)])),_:1,__:[16]})])],32)])):R("",!0)])]}),_:1},8,["show"]),o(L,{show:g.value,onClose:e[7]||(e[7]=a=>g.value=!1),"max-width":"2xl"},{default:u(()=>[s("div",Pe,[e[20]||(e[20]=s("h2",{class:"text-2xl font-bold text-gray-900 mb-4"},"Reject Email",-1)),v.value?(d(),n("div",Se,[s("form",{onSubmit:D(H,["prevent"])},[s("div",Me,[o(w,{for:"rejection_reason",value:"Rejection Reason"}),q(s("textarea",{id:"rejection_reason",rows:"5",class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full","onUpdate:modelValue":e[5]||(e[5]=a=>y.rejection_reason=a),required:"",placeholder:"Please provide a reason for rejecting this email (minimum 10 characters)"},null,512),[[Z,y.rejection_reason]]),o(E,{message:b.value.rejection_reason?b.value.rejection_reason[0]:"",class:"mt-2"},null,8,["message"])]),s("div",Ne,[o(P,{onClick:e[6]||(e[6]=a=>g.value=!1)},{default:u(()=>e[18]||(e[18]=[_("Cancel",-1)])),_:1,__:[18]}),o(k,{type:"submit",class:"bg-red-600 hover:bg-red-700"},{default:u(()=>e[19]||(e[19]=[_("Reject Email",-1)])),_:1,__:[19]})])],32)])):R("",!0)])]),_:1},8,["show"])]),_:1})],64))}};export{os as default};
