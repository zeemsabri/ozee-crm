import{c as te,q as ae,r as d,f as P,e as se,p as f,a as r,o as n,d as g,u as o,h as le,w as _,b as a,i as S,s as O,v as c,x as v,y as oe,F as V,l as U,m as w,t as u,z as ie,A as re}from"./app-C_l5dlFM.js";import{_ as ne}from"./AuthenticatedLayout-C7ngEn3R.js";import{_ as R}from"./PrimaryButton-BeqOxdrm.js";import{_ as z}from"./SecondaryButton-CHg2i9M2.js";import{_ as de}from"./MultiSelectDropdown-DnDADvnF.js";import"./Modal-ernkAfjj.js";import"./InputLabel-CBCIfFNJ.js";import"./InputError-BkkNx5sB.js";import"./index-CXsQbk8n.js";import"./BaseFormModal-gnHL_btQ.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./TextInput-CoLtqwhj.js";import"./SelectDropdown-Duuae3KQ.js";/* empty css                                                                       */import"./debounce-C-hnF4Z3.js";import"./ApplicationLogo-Dq7BFhec.js";import"./createLucideIcon-kJjbaSbK.js";import"./plus-BLJjzuTJ.js";import"./DangerButton-DRwWv2nt.js";import"./moment-BLMuvzoS.js";import"./NoticeboardModal-BJAmCoaI.js";import"./ChevronDownIcon-BZ6pvb90.js";const ue={class:"flex items-center justify-between"},me={class:"font-semibold text-xl text-gray-800 leading-tight"},ce={class:"py-12"},pe={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},fe={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},ge={class:"grid grid-cols-1 md:grid-cols-3 gap-8"},ve={class:"md:col-span-1 space-y-6"},_e={class:"flex items-center mt-1"},ye=["onKeydown"],xe={class:"mt-2 flex flex-wrap gap-2"},he=["onClick"],we={class:"flex items-center gap-4"},be={class:"md:col-span-2 space-y-6 bg-gray-50 p-6 rounded-lg border"},ke={class:"bg-white border rounded-md p-4"},Ce={class:"flex items-center justify-between"},Se={key:0,class:"mt-3"},Ae={class:"mt-3 flex items-center gap-2"},Ne={key:0,class:"text-sm text-red-600 mt-2"},Oe={key:1,class:"text-sm text-green-600 mt-2"},Ve={class:"text-xs text-gray-500 mt-1"},$e={class:"space-y-6"},Fe={class:"flex items-center justify-end"},Ee={key:0,class:"mt-8 bg-white shadow-sm sm:rounded-lg"},Je={class:"p-6 md:p-8"},Le={class:"mb-6"},Ue={class:"relative mt-1"},Be={key:0,class:"absolute z-10 mt-1 w-full md:w-1/2 bg-white shadow-lg rounded-md border"},Me=["onClick"],Te={key:0},De={key:1,class:"text-sm text-gray-500"},Ie={key:2,class:"space-y-2"},Pe={class:"text-sm"},Re={class:"font-medium"},ze={class:"text-gray-500 ml-2"},Ze=["onClick"],pt={__name:"CreateEdit",props:{id:{type:Number,default:null},mode:{type:String,default:"create"}},setup(Z){const p=Z,m=te(()=>p.mode==="edit"||!!p.id),s=ae({name:"",target_audience:"",services_offered:[],goal:"",ai_persona:"",email_template:"",is_active:!0,shareable_resource_ids:[]}),A=d(""),B=()=>{const t=A.value.trim();t&&!s.services_offered.includes(t)&&s.services_offered.push(t),A.value=""},q=t=>{s.services_offered.splice(t,1)},M=d(!1),T=d(""),N=d(!1),b=d(""),y=d(""),x=d("");function D(t){return Array.isArray(t)?t:typeof t=="string"&&t.trim()?t.split(",").map(e=>e.trim()).filter(Boolean):[]}function K(t){let e=[];try{if(t&&typeof t=="object"){if(typeof t.name=="string"&&(s.name=t.name,e.push("name")),typeof t.goal=="string"&&(s.goal=t.goal,e.push("goal")),typeof t.target_audience=="string"&&(s.target_audience=t.target_audience,e.push("target_audience")),typeof t.ai_persona=="string"&&(s.ai_persona=t.ai_persona,e.push("ai_persona")),t.services_offered!==void 0){const i=D(t.services_offered);s.services_offered=i,e.push("services_offered")}const l=t.value_adds!==void 0||t.pricing_info!==void 0;if(t.email_template!==void 0||l){let i={};if(t.email_template!==void 0){if(t.email_template&&typeof t.email_template=="object")i={...t.email_template};else if(typeof t.email_template=="string")try{const h=JSON.parse(t.email_template);h&&typeof h=="object"?i=h:i={template:t.email_template}}catch{i={template:t.email_template}}}t.value_adds!==void 0&&(i.value_adds=Array.isArray(t.value_adds)?t.value_adds:D(t.value_adds)),t.pricing_info!==void 0&&(i.pricing_info=t.pricing_info);try{s.email_template=JSON.stringify(i,null,2)}catch{s.email_template=String(i)}e.push("email_template")}}}catch(l){console.error("Error applying JSON to form",l)}return e}function H(){if(y.value="",x.value="",!b.value.trim()){y.value="Please paste a JSON object first.";return}try{const t=JSON.parse(b.value),e=K(t);e.length?x.value=`Populated fields: ${e.join(", ")}`:x.value="JSON parsed but no matching fields were found to populate."}catch{y.value="Invalid JSON. Please check the structure and try again."}}function Q(){b.value="",y.value="",x.value=""}const $=d([]),F=d(!1),G=async()=>{F.value=!0;try{const{data:t}=await f.get("/api/shareable-resources",{params:{per_page:1e3}}),e=t.data??t;$.value=e.map(l=>({label:l.title,value:l.id}))}catch(t){console.error("Failed to load resources",t),$.value=[]}finally{F.value=!1}},W=async()=>{if(p.id){M.value=!0,T.value="";try{const{data:t}=await f.get(`/api/campaigns/${p.id}`);s.name=t.name||"",s.target_audience=t.target_audience||"",s.services_offered=Array.isArray(t.services_offered)?t.services_offered:[],s.goal=t.goal||"",s.ai_persona=t.ai_persona||"",s.email_template=t.email_template||"",s.is_active=!!t.is_active,s.shareable_resource_ids=Array.isArray(t.shareable_resource_ids)?t.shareable_resource_ids:[]}catch(t){console.error("Failed to load campaign",t),T.value="Failed to load campaign"}finally{M.value=!1}}};P(()=>{G(),m.value&&W()});const Y=async()=>{const t=m.value?`/api/campaigns/${p.id}`:"/api/campaigns",e=m.value?"put":"post";s.processing=!0;try{const l={name:s.name,target_audience:s.target_audience||null,services_offered:Array.isArray(s.services_offered)&&s.services_offered.length?s.services_offered:null,goal:s.goal||null,ai_persona:s.ai_persona||null,email_template:s.email_template||null,is_active:!!s.is_active,shareable_resource_ids:Array.isArray(s.shareable_resource_ids)?s.shareable_resource_ids:[]};e==="post"?(await f.post(t,l),window.location.href="/campaigns"):await f.put(t,l)}catch(l){console.error("Form submission error:",l),alert("Failed to save campaign")}finally{s.processing=!1}},E=d([]),J=d(!1),k=d(""),C=d([]),I=d(!1),L=async()=>{if(m.value){J.value=!0;try{const t=await f.get(`/api/campaigns/${p.id}/leads`);E.value=t.data.data||[]}catch(t){console.error("Failed to fetch leads:",t)}finally{J.value=!1}}};se(k,t=>{if(t.length<2){C.value=[];return}X()});const X=async()=>{I.value=!0;try{const t=await f.get(`/api/leads/search?q=${k.value}`);C.value=t.data}catch(t){console.error("Failed to search leads:",t)}finally{I.value=!1}},j=async t=>{try{await f.post(`/api/campaigns/${p.id}/leads`,{lead_id:t}),k.value="",C.value=[],await L()}catch(e){console.error("Failed to attach lead:",e),alert("Failed to attach lead. They may already be in another campaign.")}},ee=async t=>{try{await f.delete(`/api/campaigns/${p.id}/leads/${t}`),await L()}catch(e){console.error("Failed to detach lead:",e)}};return P(()=>{m.value&&L()}),(t,e)=>(n(),r(V,null,[g(o(le),{title:m.value?"Edit Campaign":"Create Campaign"},null,8,["title"]),g(ne,null,{header:_(()=>[a("div",ue,[a("h2",me,u(m.value?`Edit Campaign: ${o(s).name}`:"Create New Campaign"),1),a("div",null,[g(o(re),{href:"/campaigns"},{default:_(()=>[g(z,null,{default:_(()=>e[11]||(e[11]=[w("Back to Campaigns",-1)])),_:1,__:[11]})]),_:1})])])]),default:_(()=>[a("div",ce,[a("div",pe,[a("div",fe,[a("form",{onSubmit:O(Y,["prevent"]),class:"p-6 md:p-8 space-y-8"},[a("div",ge,[a("div",ve,[a("div",null,[e[12]||(e[12]=a("label",{for:"name",class:"block font-medium text-sm text-gray-700"},"Campaign Name",-1)),c(a("input",{id:"name","onUpdate:modelValue":e[0]||(e[0]=l=>o(s).name=l),type:"text",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm",required:""},null,512),[[v,o(s).name]]),e[13]||(e[13]=a("p",{class:"text-xs text-gray-500 mt-1"},"A descriptive name for internal use.",-1))]),a("div",null,[e[14]||(e[14]=a("label",{for:"goal",class:"block font-medium text-sm text-gray-700"},"Campaign Goal",-1)),c(a("input",{id:"goal","onUpdate:modelValue":e[1]||(e[1]=l=>o(s).goal=l),type:"text",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm"},null,512),[[v,o(s).goal]]),e[15]||(e[15]=a("p",{class:"text-xs text-gray-500 mt-1"},'e.g., "Book a discovery call".',-1))]),a("div",null,[e[17]||(e[17]=a("label",{class:"block font-medium text-sm text-gray-700"},"Services Offered",-1)),a("div",_e,[c(a("input",{"onUpdate:modelValue":e[2]||(e[2]=l=>A.value=l),onKeydown:oe(O(B,["prevent"]),["enter"]),type:"text",class:"flex-grow rounded-l-md border-gray-300 shadow-sm",placeholder:"e.g., SEO, Web Design"},null,40,ye),[[v,A.value]]),a("button",{onClick:O(B,["prevent"]),type:"button",class:"px-4 py-2 bg-gray-200 rounded-r-md text-sm font-medium hover:bg-gray-300"},"Add")]),a("div",xe,[(n(!0),r(V,null,U(o(s).services_offered,(l,i)=>(n(),r("span",{key:i,class:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-indigo-100 text-indigo-800"},[w(u(l)+" ",1),a("button",{onClick:O(h=>q(i),["prevent"]),class:"ml-1.5 flex-shrink-0 text-indigo-400 hover:text-indigo-500"},e[16]||(e[16]=[a("svg",{class:"h-2 w-2",stroke:"currentColor",fill:"none",viewBox:"0 0 8 8"},[a("path",{"stroke-linecap":"round","stroke-width":"1.5",d:"M1 1l6 6m0-6L1 7"})],-1)]),8,he)]))),128))])]),a("div",we,[e[18]||(e[18]=a("label",{for:"is_active",class:"font-medium text-sm text-gray-700"},"Campaign Active",-1)),c(a("input",{id:"is_active","onUpdate:modelValue":e[3]||(e[3]=l=>o(s).is_active=l),type:"checkbox",class:"h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"},null,512),[[ie,o(s).is_active]])])]),a("div",be,[e[28]||(e[28]=a("h3",{class:"text-lg font-semibold text-gray-900 flex items-center gap-2"},[a("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-indigo-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"})]),w(" OZ-E Configuration ")],-1)),a("div",ke,[a("div",Ce,[e[19]||(e[19]=a("label",{class:"block font-medium text-sm text-gray-700"},"Quick fill via JSON",-1)),a("button",{type:"button",onClick:e[4]||(e[4]=l=>N.value=!N.value),class:"text-indigo-600 hover:text-indigo-800 text-sm"},u(N.value?"Hide":"Show"),1)]),N.value?(n(),r("div",Se,[c(a("textarea",{"onUpdate:modelValue":e[5]||(e[5]=l=>b.value=l),rows:"10",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm font-mono text-sm",placeholder:"Paste campaign JSON here"},null,512),[[v,b.value]]),a("div",Ae,[g(R,{type:"button",onClick:H},{default:_(()=>e[20]||(e[20]=[w("Populate from JSON",-1)])),_:1,__:[20]}),g(z,{type:"button",onClick:Q},{default:_(()=>e[21]||(e[21]=[w("Clear",-1)])),_:1,__:[21]})]),y.value?(n(),r("p",Ne,u(y.value),1)):S("",!0),x.value?(n(),r("p",Oe,u(x.value),1)):S("",!0),e[22]||(e[22]=a("p",{class:"text-xs text-gray-500 mt-1"},"This will only fill the form fields. You still need to click Save to persist changes.",-1))])):S("",!0)]),a("div",null,[e[23]||(e[23]=a("label",{for:"target_audience",class:"block font-medium text-sm text-gray-700"},"Target Audience",-1)),c(a("textarea",{id:"target_audience","onUpdate:modelValue":e[6]||(e[6]=l=>o(s).target_audience=l),rows:"4",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm"},null,512),[[v,o(s).target_audience]]),e[24]||(e[24]=a("p",{class:"text-xs text-gray-500 mt-1"},"Describe the ideal client for OZ-E. Be specific.",-1))]),a("div",null,[e[25]||(e[25]=a("label",{for:"ai_persona",class:"block font-medium text-sm text-gray-700"},"AI Persona",-1)),c(a("textarea",{id:"ai_persona","onUpdate:modelValue":e[7]||(e[7]=l=>o(s).ai_persona=l),rows:"4",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm"},null,512),[[v,o(s).ai_persona]]),e[26]||(e[26]=a("p",{class:"text-xs text-gray-500 mt-1"},'Define the tone and style OZ-E should use. e.g., "Friendly and professional, focusing on benefits."',-1))]),a("div",null,[e[27]||(e[27]=a("label",{for:"email_template",class:"block font-medium text-sm text-gray-700"},"Base Email Template",-1)),c(a("textarea",{id:"email_template","onUpdate:modelValue":e[8]||(e[8]=l=>o(s).email_template=l),rows:"8",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm font-mono text-sm"},null,512),[[v,o(s).email_template]]),a("p",Ve,'The "seed text" OZ-E will personalize for each lead. Use placeholders like `'+u(t.first_name)+"` or `"+u(t.company)+"`.",1)])])]),a("div",$e,[a("div",null,[e[29]||(e[29]=a("label",{class:"block font-medium text-sm text-gray-700"},"Link Shareable Resources",-1)),g(de,{modelValue:o(s).shareable_resource_ids,"onUpdate:modelValue":e[9]||(e[9]=l=>o(s).shareable_resource_ids=l),options:$.value,isMulti:!0,placeholder:"Select resources to link"},null,8,["modelValue","options"]),e[30]||(e[30]=a("p",{class:"text-xs text-gray-500 mt-1"},"Choose one or more resources to associate with this campaign.",-1))]),a("div",Fe,[g(R,{disabled:o(s).processing||F.value},{default:_(()=>[w(u(m.value?"Save Changes":"Create Campaign"),1)]),_:1},8,["disabled"])])])],32)]),m.value?(n(),r("div",Ee,[a("div",Je,[e[32]||(e[32]=a("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"Manage Leads in this Campaign",-1)),a("div",Le,[e[31]||(e[31]=a("label",{for:"lead_search",class:"block font-medium text-sm text-gray-700"},"Attach New Lead",-1)),a("div",Ue,[c(a("input",{id:"lead_search","onUpdate:modelValue":e[10]||(e[10]=l=>k.value=l),type:"text",class:"block w-full md:w-1/2 rounded-md border-gray-300 shadow-sm",placeholder:"Search by name or email..."},null,512),[[v,k.value]]),C.value.length?(n(),r("div",Be,[a("ul",null,[(n(!0),r(V,null,U(C.value,l=>(n(),r("li",{key:l.id,onClick:i=>j(l.id),class:"px-4 py-2 hover:bg-gray-100 cursor-pointer text-sm"},u(l.full_name)+" ("+u(l.email)+") ",9,Me))),128))])])):S("",!0)])]),J.value?(n(),r("div",Te,"Loading leads...")):E.value.length===0?(n(),r("div",De,"No leads have been attached to this campaign yet.")):(n(),r("ul",Ie,[(n(!0),r(V,null,U(E.value,l=>(n(),r("li",{key:l.id,class:"flex items-center justify-between p-3 bg-gray-50 rounded-md"},[a("div",Pe,[a("span",Re,u(l.full_name),1),a("span",ze,u(l.email),1)]),a("button",{onClick:i=>ee(l.id),class:"text-sm text-red-600 hover:underline"},"Detach",8,Ze)]))),128))]))])])):S("",!0)])])]),_:1})],64))}};export{pt as default};
