import{p as de,r as k,I as O,s as be,e as ne,f as me,a as r,o,b as e,m as R,i as x,d as l,t as S,q as he,v as qe,g as ae,w as W,j as Q,M as se,c as J,F as ue,l as ce,x as ke,L as lt,C as Re,y as ot,Q as nt,n as $e,z as Ve,u as P,K as Ke,D as rt,aA as it,aW as dt,aX as ut,aY as ct,a0 as mt}from"./app-BXwNPRau.js";import{_ as A}from"./InputLabel-xP1ePHj0.js";import{_ as H}from"./TextInput-BpHbgyBH.js";import{_ as N}from"./InputError-C5PNSPQA.js";import{_ as le}from"./PrimaryButton-DDR27hXv.js";import{S as Z}from"./SelectDropdown-DM-nWwpK.js";import{k as vt,T as pt,l as gt}from"./AuthenticatedLayout-BMEcVAiY.js";import{P as yt}from"./ProjectTypeInput-CmrVzM6n.js";import{_ as fe}from"./SecondaryButton-DxVzHrUO.js";import{D as ft}from"./DangerButton-042f3578.js";import{_ as bt}from"./Modal-CyQll2yY.js";import{_ as wt}from"./NoticeboardModal-CztiEtks.js";import{_ as xt}from"./Checkbox-MWSF-P8H.js";import{d as ht}from"./debounce-C-hnF4Z3.js";import{_ as jt}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{b as oe,c as ye,d as He,f as ee,a as Se}from"./currency-DyDt3-WV.js";const _t=k([]),kt=k([]),Ee=k([]),Oe=k([]),Fe=async t=>{try{const j=(await de.get(`/api/roles?type=${t}`)).data.map(g=>({value:g.id,label:g.name}));return t==="client"?_t.value=j:t==="project"&&(kt.value=j),j}catch(w){return console.error(`Error fetching ${t} roles:`,w),O(`Failed to load ${t} roles. Please refresh the page.`),[]}},Pt=async(t,w)=>{try{let a;return w&&!t||t&&(a=await window.axios.get("/api/clients"),Ee.value=a.data.data||a.data),Ee.value}catch(a){return console.error("Error fetching clients:",a),O("Failed to load clients. Please try again."),[]}},$t=async(t,w)=>{try{let a;return w&&!t||t&&(a=await window.axios.get("/api/users"),Oe.value=a.data),Oe.value}catch(a){return console.error("Error fetching users:",a),O("Failed to load users. Please try again."),[]}},Pe=async(t,w,a)=>{let j="",g=null;try{switch(w){case"basic":j=`/api/projects/${t}/sections/basic`;break;case"client":(a.canViewProjectClients||a.canManageProjectClients||a.canViewProjectUsers||a.canManageProjectUsers)&&(j=`/api/projects/${t}/sections/clients-users`);break;case"services":(a.canViewProjectServicesAndPayments||a.canManageProjectServicesAndPayments)&&(j=`/api/projects/${t}/sections/services-payment`);break;case"documents":a.canViewProjectDocuments&&(j=`/api/projects/${t}/sections/documents`);break;case"notes":(a.canViewProjectNotes||a.canAddProjectNotes)&&(j=`/api/projects/${t}/sections/notes?type=private`);break;case"transactions":return null;default:return console.warn(`Attempted to fetch data for unknown tab: ${w}`),null}return j&&(g=(await window.axios.get(j)).data),g}catch(_){throw console.error(`Error fetching data for tab '${w}':`,_),O(`Failed to load data for ${w} section. Please try again.`),_}},St={class:"space-y-6 bg-white p-6 rounded-lg border border-gray-100 font-inter"},Vt={key:0,class:"text-center py-8 text-gray-500 text-lg"},Ct={key:1,class:"grid grid-cols-1 md:grid-cols-2 gap-6"},It={key:0},Dt={key:1},Ut={key:0,class:"mt-1 text-xs text-gray-500"},Mt={key:2},At=["disabled"],Nt={key:0,class:"mt-2"},Tt=["src"],Bt={class:"mt-6"},Rt=["disabled"],Et={class:"mt-6"},Ot={class:"mt-6"},Ft={class:"mt-6"},Lt={class:"mt-6 flex justify-end"},zt={key:0,class:"flex items-center"},qt={key:1},Kt={__name:"ProjectEditBasicInfo",props:{projectId:{type:[Number,String],required:!0},errors:{type:Object,default:()=>({})},statusOptions:{type:Array,required:!0,default:()=>[{value:"active",label:"Active"},{value:"completed",label:"Completed"},{value:"paid",label:"Paid"},{value:"on_hold",label:"On-hold"}]},sourceOptions:{type:Array,required:!0},canManageProjects:{type:Boolean,default:!1},canManageProjectBasicDetails:{type:Boolean,default:!1},isSaving:{type:Boolean,default:!1}},setup(t){const w=t,a=be({id:null,name:"",description:"",website:"",social_media_link:"",preferred_keywords:"",reporting_sites:"",google_chat_id:"",google_drive_link:"",logo:null,status:"active",project_type:"",source:"",tags:[],tags_data:[],timezone:null,project_tier_id:null,profit_margin_percentage:null}),j=k(!1),g=k(!0),_=k([]),D=async()=>{try{const n=await window.axios.get("/api/project-tiers");_.value=n.data}catch(n){console.error("Error fetching project tiers:",n),O("Failed to load project tiers.")}},U=n=>{const s=n.target.files[0];s?a.logo=s:a.logo=null},I=async()=>{j.value=!0;const n=new FormData,s=["id","tags","tags_data","logo"];if(a.project_tier_id!==null&&a.project_tier_id!==void 0){const i=String(a.project_tier_id);n.append("project_tier_id",i),console.log("Added project_tier_id:",i,"type:",typeof i)}else console.log("project_tier_id is null or undefined:",a.project_tier_id);a.profit_margin_percentage!==null&&a.profit_margin_percentage!==void 0&&(n.append("profit_margin_percentage",a.profit_margin_percentage),console.log("Added profit_margin_percentage:",a.profit_margin_percentage));for(const i in a)!s.includes(i)&&i!=="project_tier_id"&&i!=="profit_margin_percentage"&&a[i]!==null&&a[i]!==void 0&&n.append(i,a[i]);Array.isArray(a.tags)&&a.tags.forEach(i=>{const T=typeof i=="object"&&i!==null&&i.id?i.id:i;T!=null&&n.append("tags[]",T)}),a.logo instanceof File&&n.append("logo",a.logo),n.append("_method","PUT"),console.log("Form data contents:");for(let[i,T]of n.entries())console.log(`${i}: ${T}`);try{const i=await window.axios.post(`/api/projects/${w.projectId}/sections/basic`,n,{headers:{"Content-Type":"multipart/form-data"}});se("Project basic information updated successfully!"),i.data&&Object.assign(a,{name:i.data.name||a.name,description:i.data.description||a.description,website:i.data.website||a.website,social_media_link:i.data.social_media_link||a.social_media_link,preferred_keywords:i.data.preferred_keywords||a.preferred_keywords,reporting_sites:i.data.reporting_sites||a.reporting_sites,google_chat_id:i.data.google_chat_id||a.google_chat_id,google_drive_link:i.data.google_drive_link||a.google_drive_link,logo:i.data.logo||a.logo,status:i.data.status||a.status,project_type:i.data.project_type||a.project_type,source:i.data.source||a.source,tags:i.data.tags||a.tags,tags_data:i.data.tags_data||a.tags_data,timezone:i.data.timezone||a.timezone,project_tier_id:i.data.project_tier_id||a.project_tier_id,profit_margin_percentage:i.data.profit_margin_percentage||a.profit_margin_percentage})}catch(i){console.error("Error saving basic info:",i);let T="Failed to save basic information.";i.response&&i.response.data&&i.response.data.message&&(T=i.response.data.message),O(T)}finally{j.value=!1}},y=async()=>{if(!w.projectId){g.value=!1;return}g.value=!0;try{const n=await Pe(w.projectId,"basic",{});n&&Object.assign(a,{id:n.id||w.projectId,name:n.name||"",description:n.description||"",website:n.website||"",social_media_link:n.social_media_link||"",preferred_keywords:n.preferred_keywords||"",reporting_sites:n.reporting_sites||"",google_chat_id:n.google_chat_id||"",google_drive_link:n.google_drive_link||"",logo:n.logo||null,status:n.status||"active",project_type:n.project_type||"",source:n.source||"",tags:n.tags||[],tags_data:n.tags_data||[],timezone:n.timezone||null,project_tier_id:n.project_tier_id||null,profit_margin_percentage:n.profit_margin_percentage||null})}catch(n){console.error("Error fetching basic info:",n),O("Failed to load basic project information.")}finally{g.value=!1}};return ne(()=>w.projectId,async n=>{setTimeout(async()=>{n&&await y()},500)},{immediate:!0}),ne(()=>a.project_tier_id,n=>{console.log("project_tier_id changed:",n,"type:",typeof n)}),me(()=>{D()}),(n,s)=>(o(),r("div",St,[g.value?(o(),r("div",Vt,s[16]||(s[16]=[e("svg",{class:"animate-spin h-8 w-8 text-indigo-500 mx-auto mb-3",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),R(" Loading basic project information... ",-1)]))):(o(),r("div",Ct,[e("div",null,[l(A,{for:"name",value:"Project Name"}),l(H,{id:"name",type:"text",class:"mt-1 block w-full rounded-lg shadow-sm",modelValue:a.name,"onUpdate:modelValue":s[0]||(s[0]=i=>a.name=i),required:"",autofocus:"",disabled:!t.canManageProjects||j.value||t.isSaving},null,8,["modelValue","disabled"]),l(N,{message:t.errors.name?t.errors.name[0]:"",class:"mt-2"},null,8,["message"])]),e("div",null,[l(A,{for:"website",value:"Website"}),l(H,{id:"website",type:"url",class:"mt-1 block w-full rounded-lg shadow-sm",modelValue:a.website,"onUpdate:modelValue":s[1]||(s[1]=i=>a.website=i),disabled:!t.canManageProjects||j.value||t.isSaving},null,8,["modelValue","disabled"]),l(N,{message:t.errors.website?t.errors.website[0]:"",class:"mt-2"},null,8,["message"])]),e("div",null,[l(A,{for:"social_media_link",value:"Social Media Link"}),l(H,{id:"social_media_link",type:"url",class:"mt-1 block w-full rounded-lg shadow-sm",modelValue:a.social_media_link,"onUpdate:modelValue":s[2]||(s[2]=i=>a.social_media_link=i),disabled:!t.canManageProjects||j.value||t.isSaving},null,8,["modelValue","disabled"]),l(N,{message:t.errors.social_media_link?t.errors.social_media_link[0]:"",class:"mt-2"},null,8,["message"])]),t.canManageProjectBasicDetails?(o(),r("div",It,[l(A,{for:"google_chat_id",value:"Google Chat ID"}),l(H,{id:"google_chat_id",type:"text",class:"mt-1 block w-full rounded-lg shadow-sm",modelValue:a.google_chat_id,"onUpdate:modelValue":s[3]||(s[3]=i=>a.google_chat_id=i),disabled:!t.canManageProjects||j.value||t.isSaving},null,8,["modelValue","disabled"]),l(N,{message:t.errors.google_chat_id?t.errors.google_chat_id[0]:"",class:"mt-2"},null,8,["message"])])):x("",!0),t.canManageProjectBasicDetails?(o(),r("div",Dt,[l(A,{for:"google_drive_link",value:"Google Drive Link"}),l(H,{id:"google_drive_link",type:"text",class:"mt-1 block w-full rounded-lg shadow-sm",modelValue:a.google_drive_link,"onUpdate:modelValue":s[4]||(s[4]=i=>a.google_drive_link=i),disabled:!t.canManageProjects||j.value||t.isSaving},null,8,["modelValue","disabled"]),l(N,{message:t.errors.google_drive_link?t.errors.google_drive_link[0]:"",class:"mt-2"},null,8,["message"])])):x("",!0),e("div",null,[l(A,{for:"status",value:"Status"}),l(Z,{id:"status",modelValue:a.status,"onUpdate:modelValue":s[5]||(s[5]=i=>a.status=i),options:t.statusOptions,valueKey:"value",labelKey:"label",placeholder:"Select Project Status",disabled:!t.canManageProjects||j.value||t.isSaving,required:!0,class:"mt-1 block w-full"},null,8,["modelValue","options","disabled"]),l(N,{message:t.errors.status?t.errors.status[0]:"",class:"mt-2"},null,8,["message"])]),e("div",null,[l(yt,{id:"project_type",modelValue:a.project_type,"onUpdate:modelValue":s[6]||(s[6]=i=>a.project_type=i),disabled:!t.canManageProjects||j.value||t.isSaving,class:"mt-1 block w-full"},null,8,["modelValue","disabled"]),l(N,{message:t.errors.project_type?t.errors.project_type[0]:"",class:"mt-2"},null,8,["message"])]),e("div",null,[l(A,{for:"source",value:"Source"}),l(Z,{id:"source",modelValue:a.source,"onUpdate:modelValue":s[7]||(s[7]=i=>a.source=i),options:t.sourceOptions,valueKey:"value",labelKey:"label",placeholder:"Select a Source",disabled:!t.canManageProjects||j.value||t.isSaving,class:"mt-1 block w-full"},null,8,["modelValue","options","disabled"]),l(N,{message:t.errors.source?t.errors.source[0]:"",class:"mt-2"},null,8,["message"])]),e("div",null,[l(vt,{id:"timezone",modelValue:a.timezone,"onUpdate:modelValue":s[8]||(s[8]=i=>a.timezone=i),disabled:!t.canManageProjects||j.value||t.isSaving,class:"mt-1 block w-full"},null,8,["modelValue","disabled"]),l(N,{message:t.errors.timezone?t.errors.timezone[0]:"",class:"mt-2"},null,8,["message"])]),e("div",null,[l(A,{for:"project_tier_id",value:"Project Tier"}),l(Z,{id:"project_tier_id",modelValue:a.project_tier_id,"onUpdate:modelValue":s[9]||(s[9]=i=>a.project_tier_id=i),options:_.value,valueKey:"id",labelKey:"name",placeholder:"Select Project Tier",disabled:!t.canManageProjects||j.value||t.isSaving,class:"mt-1 block w-full",onChange:s[10]||(s[10]=i=>console.log("SelectDropdown change event:",i))},null,8,["modelValue","options","disabled"]),l(N,{message:t.errors.project_tier_id?t.errors.project_tier_id[0]:"",class:"mt-2"},null,8,["message"]),a.project_tier_id?(o(),r("div",Ut," Selected tier ID: "+S(a.project_tier_id)+" ("+S(typeof a.project_tier_id)+") ",1)):x("",!0)]),e("div",null,[l(A,{for:"profit_margin_percentage",value:"Profit Margin (%)"}),l(H,{id:"profit_margin_percentage",type:"number",step:"0.01",min:"0",max:"100",class:"mt-1 block w-full rounded-lg shadow-sm",modelValue:a.profit_margin_percentage,"onUpdate:modelValue":s[11]||(s[11]=i=>a.profit_margin_percentage=i),disabled:!t.canManageProjects||j.value||t.isSaving},null,8,["modelValue","disabled"]),l(N,{message:t.errors.profit_margin_percentage?t.errors.profit_margin_percentage[0]:"",class:"mt-2"},null,8,["message"])]),t.canManageProjectBasicDetails?(o(),r("div",Mt,[l(A,{for:"logo",value:"Project Logo"}),e("input",{type:"file",id:"logo",onChange:U,class:"mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100 cursor-pointer",accept:"image/*",disabled:!t.canManageProjectBasicDetails||j.value||t.isSaving},null,40,At),a.logo&&typeof a.logo=="string"?(o(),r("div",Nt,[s[17]||(s[17]=e("p",{class:"text-sm text-gray-600"},"Current Logo:",-1)),e("img",{src:a.logo,alt:"Project Logo",class:"h-20 w-20 object-contain rounded-lg shadow-md border border-gray-200"},null,8,Tt)])):x("",!0),l(N,{message:t.errors.logo?t.errors.logo[0]:"",class:"mt-2"},null,8,["message"])])):x("",!0)])),e("div",Bt,[l(A,{for:"description",value:"Description"}),he(e("textarea",{id:"description",class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-lg shadow-sm mt-1 block w-full","onUpdate:modelValue":s[12]||(s[12]=i=>a.description=i),disabled:!t.canManageProjects||j.value||t.isSaving,rows:"4"},null,8,Rt),[[qe,a.description]]),l(N,{message:t.errors.description?t.errors.description[0]:"",class:"mt-2"},null,8,["message"])]),e("div",Et,[l(A,{for:"preferred_keywords",value:"Client Preferred Keywords"}),l(H,{id:"preferred_keywords",type:"text",class:"mt-1 block w-full rounded-lg shadow-sm",modelValue:a.preferred_keywords,"onUpdate:modelValue":s[13]||(s[13]=i=>a.preferred_keywords=i),disabled:!t.canManageProjects||j.value||t.isSaving},null,8,["modelValue","disabled"]),l(N,{message:t.errors.preferred_keywords?t.errors.preferred_keywords[0]:"",class:"mt-2"},null,8,["message"])]),e("div",Ot,[l(A,{for:"reporting_sites",value:"Reporting Sites (comma separated)"}),l(H,{id:"reporting_sites",type:"text",class:"mt-1 block w-full rounded-lg shadow-sm",placeholder:"e.g. ahrefs.com, semrush.com, analytics.google.com",modelValue:a.reporting_sites,"onUpdate:modelValue":s[14]||(s[14]=i=>a.reporting_sites=i),disabled:!t.canManageProjects||j.value||t.isSaving},null,8,["modelValue","disabled"]),s[18]||(s[18]=e("p",{class:"mt-1 text-xs text-gray-500"},"Enter multiple site URLs separated by commas.",-1)),l(N,{message:t.errors.reporting_sites?t.errors.reporting_sites[0]:"",class:"mt-2"},null,8,["message"])]),e("div",Ft,[l(pt,{modelValue:a.tags,"onUpdate:modelValue":s[15]||(s[15]=i=>a.tags=i),initialTags:a.tags_data,label:"Associated Tags",placeholder:"Search or add tags",error:t.errors.tags?t.errors.tags[0]:"",disabled:!t.canManageProjects||j.value||t.isSaving},null,8,["modelValue","initialTags","error","disabled"])]),e("div",Lt,[t.canManageProjectBasicDetails?(o(),ae(le,{key:0,onClick:I,disabled:!t.canManageProjects||j.value||t.isSaving,class:Q([{"opacity-50 cursor-not-allowed":j.value||t.isSaving},"px-6 py-2 rounded-lg text-base shadow-md hover:shadow-lg transition-all"])},{default:W(()=>[j.value||t.isSaving?(o(),r("span",zt,s[19]||(s[19]=[e("svg",{class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),R(" Updating... ",-1)]))):(o(),r("span",qt," Update Basic Information "))]),_:1},8,["disabled","class"])):x("",!0)])]))}},Ht={class:"mb-4"},Gt={class:"mt-2"},Yt={key:0,class:"text-gray-500 text-sm mb-2"},Wt={class:"mb-4"},Jt={key:1,class:"space-y-3"},Xt={class:"flex-grow text-gray-800 font-medium"},Qt={class:"text-gray-600 text-sm"},Zt={class:"flex items-center space-x-2"},ea=["onClick"],ta={key:2,class:"p-4 bg-gray-50 rounded-lg text-gray-600 text-center border border-dashed border-gray-200"},Le={__name:"MultiSelectWithRoles",props:{label:{type:String,required:!0},items:{type:Array,default:()=>[]},endpoint:{type:String,default:""},selectedItems:{type:Array,default:()=>[]},itemText:{type:String,default:"name"},itemSubtext:{type:String,default:"email"},itemValue:{type:String,default:"id"},roleOptions:{type:Array,default:()=>[]},roleType:{type:String,default:"application"},defaultRoleId:{type:Number,default:null},error:{type:String,default:""},placeholder:{type:String,default:"Select an item"},showRemoveButton:{type:Boolean,default:!0},disabled:{type:Boolean,default:!1}},emits:["update:selectedItems"],setup(t,{emit:w}){const a=t,j=w,g=k([]),_=k([]),D=k([]),U=k([]),I=k(!1),y=async()=>{if(!(a.roleOptions.length>0))try{const f=(await de.get(`/api/roles?type=${a.roleType}`)).data;D.value=f.map(b=>({value:b.id,label:b.name}))}catch(m){console.error("Error fetching roles:",m)}},n=J(()=>D.value.length>0?D.value:a.roleOptions),s=()=>a.defaultRoleId?a.defaultRoleId:n.value.length>0?n.value[0].value:1,i=()=>{g.value=[],_.value=[],!(!a.selectedItems||a.selectedItems.length===0)&&a.selectedItems.forEach(m=>{const f=typeof m=="object"?m[a.itemValue]:m,b=typeof m=="object"&&m.role_id!==void 0?m.role_id:s();if(!g.value.includes(f))g.value.push(f),_.value.push({id:f,role_id:b});else{const L=_.value.find(B=>B.id===f);L&&L.role_id!==b&&(L.role_id=b)}})};ne(()=>a.selectedItems,(m,f)=>{JSON.stringify(m)!==JSON.stringify(f)&&i()},{deep:!0,immediate:!0}),ne(_,m=>{j("update:selectedItems",m)},{deep:!0});const T=m=>{a.disabled||m&&!g.value.includes(m)&&(g.value.push(m),_.value.push({id:m,role_id:s()}))},q=m=>{a.disabled||(g.value=g.value.filter(f=>f!==m),_.value=_.value.filter(f=>f.id!==m))},Y=(m,f)=>{if(a.disabled)return;const b=_.value.find(L=>L.id===m);b&&(b.role_id=parseInt(f))},E=m=>h.value.find(f=>f[a.itemValue]===m),v=m=>{const f=_.value.find(b=>b.id===m);return f?f.role_id:s()},d=async()=>{if(a.endpoint){I.value=!0;try{const m=await de.get(a.endpoint);m.data&&Array.isArray(m.data)?U.value=m.data:m.data&&m.data.data&&Array.isArray(m.data.data)&&(U.value=m.data.data)}catch(m){console.error("Error fetching items from endpoint:",m)}finally{I.value=!1}}},h=J(()=>a.endpoint&&U.value.length>0?U.value:a.items),F=J(()=>h.value.filter(m=>!g.value.includes(m[a.itemValue])).map(m=>({value:m[a.itemValue],label:`${m[a.itemText]} (${m[a.itemSubtext]})`})));return me(()=>{y(),a.endpoint&&d()}),(m,f)=>(o(),r("div",Ht,[l(A,{value:t.label},null,8,["value"]),e("div",Gt,[I.value?(o(),r("div",Yt,"Loading available items...")):x("",!0),e("div",Wt,[l(Z,{modelValue:m.selectedItemToAdd,"onUpdate:modelValue":f[0]||(f[0]=b=>m.selectedItemToAdd=b),options:F.value,valueKey:"value",labelKey:"label",placeholder:t.placeholder,disabled:I.value||t.disabled,onChange:T,class:"w-full"},null,8,["modelValue","options","placeholder","disabled"])]),g.value.length>0?(o(),r("div",Jt,[(o(!0),r(ue,null,ce(g.value,b=>{var L,B;return o(),r("div",{key:b,class:"flex items-center p-3 border border-gray-200 rounded-lg bg-gray-50 shadow-sm"},[e("div",Xt,[R(S((L=E(b))==null?void 0:L[t.itemText])+" ",1),e("span",Qt,"("+S((B=E(b))==null?void 0:B[t.itemSubtext])+")",1)]),e("div",Zt,[l(Z,{modelValue:v(b),"onUpdate:modelValue":V=>Y(b,V),options:n.value,valueKey:"value",labelKey:"label",placeholder:"Select Role",disabled:t.disabled,class:"w-32"},null,8,["modelValue","onUpdate:modelValue","options","disabled"]),t.showRemoveButton&&!t.disabled?(o(),r("button",{key:0,type:"button",class:"text-red-500 hover:text-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 rounded-full p-1 transition-colors duration-200",onClick:V=>q(b),"aria-label":"Remove item"},f[1]||(f[1]=[e("svg",{class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]),8,ea)):x("",!0)])])}),128))])):(o(),r("div",ta," No "+S(t.label.toLowerCase())+" selected. ",1))]),l(N,{message:t.error,class:"mt-2"},null,8,["message"])]))}},aa={class:"space-y-8"},sa={key:0,class:"bg-gray-50 p-6 rounded-lg shadow-inner border border-gray-200"},la={key:0,class:"mt-6 flex justify-end"},oa={key:0},na={key:1},ra={key:1,class:"mt-3 text-green-600 text-sm flex items-center"},ia={key:2,class:"mt-3 text-red-600 text-sm flex items-center"},da={key:1,class:"bg-gray-50 p-6 rounded-lg shadow-inner border border-gray-200"},ua={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},ca={key:0,class:"mt-6 flex justify-end"},ma={key:0},va={key:1},pa={key:1,class:"mt-3 text-green-600 text-sm flex items-center"},ga={key:2,class:"mt-3 text-red-600 text-sm flex items-center"},ya={key:2,class:"bg-gray-50 p-6 rounded-lg shadow-inner border border-gray-200"},fa={key:0,class:"mt-6 flex justify-end"},ba={key:0},wa={key:1},xa={key:1,class:"mt-3 text-green-600 text-sm flex items-center"},ha={key:2,class:"mt-3 text-red-600 text-sm flex items-center"},ja={__name:"ProjectFormClientsUsers",props:{projectId:{type:[Number,String],required:!0},errors:{type:Object,default:()=>({})},clientRoleOptions:{type:Array,default:()=>[]},userRoleOptions:{type:Array,default:()=>[]},clients:{type:Array,default:()=>[]},users:{type:Array,default:()=>[]},canViewProjectClients:{type:Boolean,default:!1},canManageProjectClients:{type:Boolean,default:!1},canViewProjectUsers:{type:Boolean,default:!1},canManageProjectUsers:{type:Boolean,default:!1},isSaving:{type:Boolean,default:!1}},setup(t){const w=t,a=be({client_ids:[],user_ids:[],contract_details:"",project_manager_id:null,project_admin_id:null}),j=k(!1),g=k(!1),_=k(""),D=k(!1),U=k(!1),I=k(""),y=k(!1),n=k(!1),s=k(""),i=async()=>{var E,v;if(w.projectId)try{const d=await Pe(w.projectId,"client",{canViewProjectClients:w.canViewProjectClients,canManageProjectClients:w.canManageProjectClients,canViewProjectUsers:w.canViewProjectUsers,canManageProjectUsers:w.canManageProjectUsers});d&&(a.client_ids=d.clients?d.clients.map(h=>{var F;return{id:h.id,role_id:((F=h.pivot)==null?void 0:F.role_id)||(w.clientRoleOptions.length>0?w.clientRoleOptions[0].value:null)}}):[],a.user_ids=d.users?d.users.map(h=>{var F;return{id:h.id,role_id:((F=h.pivot)==null?void 0:F.role_id)||(w.userRoleOptions.length>0?w.userRoleOptions[0].value:null)}}):[],a.contract_details=d.contract_details||"");try{const h=await window.axios.get(`/api/projects/${w.projectId}/sections/basic`);a.project_manager_id=((E=h.data)==null?void 0:E.project_manager_id)??null,a.project_admin_id=((v=h.data)==null?void 0:v.project_admin_id)??null}catch{}}catch(d){console.error("Error fetching clients/users data:",d),O("Failed to load clients and users data.")}},T=async()=>{var E,v;if(!w.projectId){O("Project ID is missing. Cannot save project leads.");return}y.value=!0,n.value=!1,s.value="";try{await window.axios.patch(`/api/projects/${w.projectId}/assign-leads`,{project_manager_id:a.project_manager_id,project_admin_id:a.project_admin_id}),se("Project leads updated successfully!"),n.value=!0}catch(d){console.error("Error saving project leads:",d),s.value=((v=(E=d.response)==null?void 0:E.data)==null?void 0:v.message)||"Failed to save project leads.",O(s.value)}finally{y.value=!1,setTimeout(()=>n.value=!1,3e3)}};ne(()=>w.projectId,async E=>{E&&await i()},{immediate:!0});const q=async()=>{var E,v;if(!w.projectId){O("Project ID is missing. Cannot save clients.");return}if(!a.client_ids||a.client_ids.length===0){O("Please select at least one client to save.");return}j.value=!0,g.value=!1,_.value="";try{await window.axios.post(`/api/projects/${w.projectId}/attach-clients`,{client_ids:a.client_ids}),se("Clients saved successfully!"),g.value=!0,await i()}catch(d){console.error("Error saving clients:",d),_.value=((v=(E=d.response)==null?void 0:E.data)==null?void 0:v.message)||"Failed to save clients.",O(_.value)}finally{j.value=!1,setTimeout(()=>g.value=!1,3e3)}},Y=async()=>{var E,v;if(!w.projectId){O("Project ID is missing. Cannot save users.");return}if(!a.user_ids||a.user_ids.length===0){O("Please select at least one user to save.");return}D.value=!0,U.value=!1,I.value="";try{await window.axios.post(`/api/projects/${w.projectId}/attach-users`,{user_ids:a.user_ids}),se("Users saved successfully!"),U.value=!0,await i()}catch(d){console.error("Error saving users:",d),I.value=((v=(E=d.response)==null?void 0:E.data)==null?void 0:v.message)||"Failed to save users.",O(I.value)}finally{D.value=!1,setTimeout(()=>U.value=!1,3e3)}};return me(()=>{}),(E,v)=>(o(),r("div",aa,[t.canViewProjectClients?(o(),r("div",sa,[v[6]||(v[6]=e("h3",{class:"text-xl font-semibold text-gray-800 mb-5"},"Project Clients",-1)),l(Le,{label:"Select Clients",items:t.clients,selectedItems:a.client_ids,"onUpdate:selectedItems":v[0]||(v[0]=d=>a.client_ids=d),roleOptions:t.clientRoleOptions,roleType:"client",error:t.errors.client_ids?t.errors.client_ids[0]:"",placeholder:"Search and select clients to add",disabled:!t.canManageProjectClients||t.isSaving||j.value,readonly:!t.canManageProjectClients&&t.canViewProjectClients,showRemoveButton:t.canManageProjectClients,class:"mb-4"},null,8,["items","selectedItems","roleOptions","error","disabled","readonly","showRemoveButton"]),t.canManageProjectClients?(o(),r("div",la,[l(le,{onClick:q,disabled:j.value||t.isSaving,class:"px-6 py-3 rounded-lg text-lg shadow-md hover:shadow-lg transition-all duration-200"},{default:W(()=>[j.value?(o(),r("span",oa,"Saving Clients...")):(o(),r("span",na,"Save Clients"))]),_:1},8,["disabled"])])):x("",!0),g.value?(o(),r("div",ra,v[4]||(v[4]=[e("svg",{class:"h-5 w-5 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1),R(" Clients saved successfully! ",-1)]))):x("",!0),_.value?(o(),r("div",ia,[v[5]||(v[5]=e("svg",{class:"h-5 w-5 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),R(" "+S(_.value),1)])):x("",!0)])):x("",!0),t.canViewProjectUsers?(o(),r("div",da,[v[9]||(v[9]=e("h3",{class:"text-xl font-semibold text-gray-800 mb-5"},"Project Leads",-1)),e("div",ua,[e("div",null,[l(A,{for:"project_manager_id",value:"Project Manager"}),l(Z,{id:"project_manager_id",modelValue:a.project_manager_id,"onUpdate:modelValue":v[1]||(v[1]=d=>a.project_manager_id=d),options:t.users,valueKey:"id",labelKey:"name",placeholder:"Select Project Manager",disabled:!t.canManageProjectUsers||t.isSaving||y.value,class:"mt-1 block w-full"},null,8,["modelValue","options","disabled"]),l(N,{message:t.errors.project_manager_id?t.errors.project_manager_id[0]:"",class:"mt-2"},null,8,["message"])]),e("div",null,[l(A,{for:"project_admin_id",value:"Project Admin"}),l(Z,{id:"project_admin_id",modelValue:a.project_admin_id,"onUpdate:modelValue":v[2]||(v[2]=d=>a.project_admin_id=d),options:t.users,valueKey:"id",labelKey:"name",placeholder:"Select Project Admin",disabled:!t.canManageProjectUsers||t.isSaving||y.value,class:"mt-1 block w-full"},null,8,["modelValue","options","disabled"]),l(N,{message:t.errors.project_admin_id?t.errors.project_admin_id[0]:"",class:"mt-2"},null,8,["message"])])]),t.canManageProjectUsers?(o(),r("div",ca,[l(le,{onClick:T,disabled:y.value||t.isSaving,class:"px-6 py-3 rounded-lg text-lg shadow-md hover:shadow-lg transition-all duration-200"},{default:W(()=>[y.value?(o(),r("span",ma,"Saving Leads...")):(o(),r("span",va,"Save Leads"))]),_:1},8,["disabled"])])):x("",!0),n.value?(o(),r("div",pa,v[7]||(v[7]=[e("svg",{class:"h-5 w-5 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1),R(" Project leads saved successfully! ",-1)]))):x("",!0),s.value?(o(),r("div",ga,[v[8]||(v[8]=e("svg",{class:"h-5 w-5 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),R(" "+S(s.value),1)])):x("",!0)])):x("",!0),t.canViewProjectUsers?(o(),r("div",ya,[v[12]||(v[12]=e("h3",{class:"text-xl font-semibold text-gray-800 mb-5"},"Assign Project Users",-1)),l(Le,{label:"Assign Users",items:t.users,selectedItems:a.user_ids,"onUpdate:selectedItems":v[3]||(v[3]=d=>a.user_ids=d),roleOptions:t.userRoleOptions,roleType:"project",defaultRoleId:2,error:t.errors.user_ids?t.errors.user_ids[0]:"",placeholder:"Search and assign users to this project",disabled:!t.canManageProjectUsers||t.isSaving||D.value,readonly:!t.canManageProjectUsers&&t.canViewProjectUsers,showRemoveButton:t.canManageProjectUsers,class:"mb-4"},null,8,["items","selectedItems","roleOptions","error","disabled","readonly","showRemoveButton"]),t.canManageProjectUsers?(o(),r("div",fa,[l(le,{onClick:Y,disabled:D.value||t.isSaving,class:"px-6 py-3 rounded-lg text-lg shadow-md hover:shadow-lg transition-all duration-200"},{default:W(()=>[D.value?(o(),r("span",ba,"Saving Users...")):(o(),r("span",wa,"Save Users"))]),_:1},8,["disabled"])])):x("",!0),U.value?(o(),r("div",xa,v[10]||(v[10]=[e("svg",{class:"h-5 w-5 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1),R(" Users saved successfully! ",-1)]))):x("",!0),I.value?(o(),r("div",ha,[v[11]||(v[11]=e("svg",{class:"h-5 w-5 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),R(" "+S(I.value),1)])):x("",!0)])):x("",!0)]))}},_a={class:"space-y-6"},ka={key:0,class:"bg-gray-50 p-6 rounded-lg shadow-inner border border-gray-200"},Pa={class:"mt-6"},$a={key:0},Sa={key:1},Va={key:0,class:"text-sm text-red-500 mt-3"},Ca={key:1,class:"mt-8 bg-white p-6 rounded-lg shadow-md border border-gray-200"},Ia={class:"space-y-3"},Da={class:"flex items-center"},Ua={class:"mr-3 text-indigo-500"},Ma={key:0,class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},Aa={key:1,class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},Na={key:2,class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},Ta={key:3,class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},Ba=["href"],Ra={key:1,class:"text-gray-700 font-medium break-all mr-4"},Ea=["onClick","disabled"],Oa={key:2,class:"p-6 bg-gray-50 rounded-lg text-gray-600 text-center border border-gray-200 shadow-sm"},Fa={__name:"ProjectFormDocuments",props:{projectId:{type:[Number,String],required:!0},errors:{type:Object,default:()=>({})},canUploadProjectDocuments:{type:Boolean,default:!1},canViewProjectDocuments:{type:Boolean,default:!1},isSaving:{type:Boolean,default:!1}},setup(t){const w=t,a=be({documents:[]}),j=k(null),g=k(!1),_=async()=>{if(w.projectId)try{const y=await Pe(w.projectId,"documents",{canViewProjectDocuments:w.canViewProjectDocuments});y&&(a.documents=y||[])}catch(y){console.error("Error fetching documents data:",y),O("Failed to load documents data.")}};ne(()=>w.projectId,async y=>{y&&await _()},{immediate:!0});const D=y=>{const n=Array.from(y.target.files);if(n.length>0){const s=Array.isArray(a.documents)?a.documents.filter(i=>typeof i=="object"&&"path"in i):[];a.documents=[...s,...n]}},U=async()=>{if(!w.projectId){O("Project ID is missing. Cannot upload documents.");return}const y=a.documents.filter(n=>n&&typeof n=="object"&&"name"in n&&"size"in n&&"type"in n);if(!y||y.length===0){O("Please select documents to upload.");return}g.value=!0;try{const n=new FormData;y.forEach((i,T)=>{n.append(`documents[${T}]`,i)});const s=await window.axios.post(`/api/projects/${w.projectId}/documents`,n,{headers:{"Content-Type":"multipart/form-data"}});a.documents=s.data.documents||[],se("Documents uploaded successfully!"),await _()}catch(n){O("Failed to upload documents."),console.error("Error uploading documents:",n)}finally{g.value=!1,j.value&&(j.value.value="")}},I=y=>{a.documents=a.documents.filter((n,s)=>s!==y)};return me(()=>{}),(y,n)=>(o(),r("div",_a,[t.canUploadProjectDocuments?(o(),r("div",ka,[l(A,{for:"documents-upload",value:"Upload New Documents",class:"mb-2 text-lg"}),e("input",{type:"file",id:"documents-upload",ref_key:"documentFileInput",ref:j,onChange:D,class:"mt-2 block w-full text-sm text-gray-600 file:mr-4 file:py-2.5 file:px-5 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100 transition-colors duration-200 cursor-pointer",multiple:"",accept:".pdf,.doc,.docx,.jpg,.jpeg,.png,.gif"},null,544),n[0]||(n[0]=e("p",{class:"text-sm text-gray-500 mt-2"},"Supported formats: PDF, DOC, DOCX, JPG, JPEG, PNG, GIF. Max file size: 5MB.",-1)),l(N,{message:t.errors.documents?t.errors.documents[0]:"",class:"mt-2"},null,8,["message"]),e("div",Pa,[l(le,{type:"button",onClick:U,disabled:!t.projectId||!a.documents||!a.documents.some(s=>s&&typeof s=="object"&&"name"in s&&"size"in s&&"type"in s)||g.value||t.isSaving,class:"px-6 py-3 rounded-lg text-lg shadow-md hover:shadow-lg transition-all duration-200"},{default:W(()=>[g.value?(o(),r("span",$a,"Uploading...")):(o(),r("span",Sa,"Upload Selected Documents"))]),_:1},8,["disabled"]),t.projectId?x("",!0):(o(),r("p",Va," Please save the project first before uploading documents. "))])])):x("",!0),t.canViewProjectDocuments&&a.documents&&a.documents.length>0?(o(),r("div",Ca,[n[7]||(n[7]=e("h3",{class:"text-xl font-semibold text-gray-800 mb-5"},"Existing Project Documents",-1)),e("ul",Ia,[(o(!0),r(ue,null,ce(a.documents,(s,i)=>(o(),r("li",{key:i,class:"flex items-center justify-between p-4 bg-gray-50 rounded-md border border-gray-100 shadow-sm transition-shadow hover:shadow-md duration-200"},[e("div",Da,[e("span",Ua,[typeof s=="object"&&"type"in s&&s.type.includes("image")?(o(),r("svg",Ma,n[1]||(n[1]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 002.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"},null,-1)]))):typeof s=="object"&&"type"in s&&s.type.includes("pdf")?(o(),r("svg",Aa,n[2]||(n[2]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"},null,-1)]))):typeof s=="object"&&"type"in s&&(s.type.includes("word")||s.type.includes("document"))?(o(),r("svg",Na,n[3]||(n[3]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"},null,-1)]))):(o(),r("svg",Ta,n[4]||(n[4]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"},null,-1)])))]),typeof s=="object"&&"path"in s?(o(),r("a",{key:0,href:`/storage/${s.path}`,target:"_blank",class:"text-blue-600 hover:text-blue-800 hover:underline font-medium break-all mr-4"},S(s.filename),9,Ba)):(o(),r("span",Ra,[R(S(s.name)+" ",1),n[5]||(n[5]=e("span",{class:"text-gray-500 text-sm"},"(Pending Upload)",-1))]))]),t.canUploadProjectDocuments?(o(),r("button",{key:0,type:"button",onClick:T=>I(i),class:"p-2 rounded-full text-red-500 hover:bg-red-100 hover:text-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 transition-colors duration-200",title:"Remove document",disabled:g.value||t.isSaving},n[6]||(n[6]=[e("svg",{class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]),8,Ea)):x("",!0)]))),128))])])):t.canViewProjectDocuments?(o(),r("div",Oa," No documents found for this project. ")):x("",!0),n[8]||(n[8]=e("div",{class:"mt-6 p-4 bg-blue-50 rounded-lg text-blue-700 text-sm border border-blue-200"},[e("p",null,"Note: Uploaded documents will be stored in the project's designated Google Drive folder.")],-1))]))}},La={class:"p-6 bg-white rounded-lg font-inter"},za={key:0,class:"p-6 bg-gray-50 rounded-lg text-gray-600 text-center border border-gray-200 shadow-sm"},qa={key:1},Ka={class:"mb-6 flex justify-between items-center"},Ha={key:0,class:"flex items-center"},Ga={key:1},Ya={key:0,class:"text-sm text-red-500 mb-4 bg-red-50 p-3 rounded-md border border-red-200"},Wa={key:1,class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6"},Ja={class:"flex justify-between items-start mb-3"},Xa=["onClick","disabled"],Qa=["onUpdate:modelValue","readonly"],Za={class:"mt-auto pt-3 border-t border-gray-100 text-xs text-gray-500 flex justify-between items-center"},es={class:"font-medium text-gray-700"},ts={key:2,class:"p-8 bg-gray-50 rounded-lg text-gray-600 text-center border border-gray-200 shadow-sm flex flex-col items-center justify-center h-64"},as={__name:"ProjectFormNotes",props:{projectId:{type:[Number,String],required:!0},errors:{type:Object,default:()=>({})},canAddProjectNotes:{type:Boolean,default:!1},canViewProjectNotes:{type:Boolean,default:!1},isSaving:{type:Boolean,default:!1}},setup(t){const w=t,a=be({notes:[]}),j=k(!1),g=async()=>{if(w.projectId)try{const y=await Pe(w.projectId,"notes",{canViewProjectNotes:w.canViewProjectNotes,canAddProjectNotes:w.canAddProjectNotes});y&&(a.notes=y.map(n=>{var s,i;return{id:n.id,content:n.content,created_at:n.created_at,creator_name:n.creator_name||((s=n.user)==null?void 0:s.name)||((i=n.creator)==null?void 0:i.name)||"Unknown"}})||[])}catch(y){console.error("Error fetching notes data:",y),O("Failed to load notes data.")}};ne(()=>w.projectId,async y=>{y&&await g()},{immediate:!0});const _=()=>{w.canAddProjectNotes&&a.notes.push({id:null,content:"",created_at:new Date().toISOString(),creator_name:"You"})},D=y=>{w.canAddProjectNotes&&a.notes.splice(y,1)},U=async()=>{if(!w.projectId){O("Project ID is missing. Cannot save notes.");return}j.value=!0;const y=a.notes.map(n=>({id:n.id||null,content:n.content}));try{const n=await window.axios.put(`/api/projects/${w.projectId}/sections/notes?type=private`,{notes:y});a.notes=n.data.notes.map(s=>{var i,T;return{id:s.id,content:s.content,created_at:s.created_at,creator_name:s.creator_name||((i=s.user)==null?void 0:i.name)||((T=s.creator)==null?void 0:T.name)||"Unknown"}})||[],se("Notes updated successfully!"),await g()}catch(n){console.error("Error updating notes:",n),O("Failed to update notes.")}finally{j.value=!1}},I=y=>y?new Date(y).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A";return me(()=>{}),(y,n)=>(o(),r("div",La,[t.canViewProjectNotes?(o(),r("div",qa,[e("div",Ka,[l(le,{onClick:_,type:"button",class:"px-5 py-2.5 rounded-lg text-base shadow-sm hover:shadow-md transition-all duration-200",disabled:!t.canAddProjectNotes||j.value||t.isSaving},{default:W(()=>n[0]||(n[0]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 4v16m8-8H4"})],-1),R(" Add New Note ",-1)])),_:1,__:[0]},8,["disabled"]),l(le,{onClick:U,disabled:!t.projectId||!t.canAddProjectNotes||j.value||t.isSaving,class:Q([{"opacity-50 cursor-not-allowed":j.value||t.isSaving},"px-6 py-3 rounded-lg text-lg shadow-md hover:shadow-lg transition-all duration-200"])},{default:W(()=>[j.value||t.isSaving?(o(),r("span",Ha,n[1]||(n[1]=[e("svg",{class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),R(" Saving... ",-1)]))):(o(),r("span",Ga,"Save All Notes"))]),_:1},8,["disabled","class"])]),t.projectId?x("",!0):(o(),r("p",Ya," Please save the project first before adding or editing notes. ")),a.notes&&a.notes.length>0?(o(),r("div",Wa,[(o(!0),r(ue,null,ce(a.notes,(s,i)=>(o(),r("div",{key:s.id||`new-note-${i}`,class:Q(["relative bg-white p-5 rounded-lg shadow-md border border-gray-200 flex flex-col h-64 transition-all duration-200 ease-in-out hover:shadow-lg",{"opacity-75 cursor-not-allowed":!t.canAddProjectNotes||j.value||t.isSaving}])},[e("div",Ja,[l(A,{value:`Note ${i+1}`,class:"text-sm font-semibold text-gray-700"},null,8,["value"]),t.canAddProjectNotes?(o(),r("button",{key:0,type:"button",onClick:T=>D(i),class:"p-1 rounded-full text-red-500 hover:bg-red-100 hover:text-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 transition-colors duration-200",title:"Remove note",disabled:j.value||t.isSaving},n[2]||(n[2]=[e("svg",{class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1)]),8,Xa)):x("",!0)]),he(e("textarea",{"onUpdate:modelValue":T=>s.content=T,readonly:!t.canAddProjectNotes||j.value||t.isSaving,placeholder:"Type your note content here...",class:"flex-grow border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-lg shadow-sm block w-full resize-none transition-colors duration-200 p-3 text-sm overflow-auto",rows:"6"},null,8,Qa),[[qe,s.content]]),l(N,{message:t.errors[`notes.${i}.content`]?t.errors[`notes.${i}.content`][0]:"",class:"mt-2"},null,8,["message"]),e("div",Za,[e("span",null,[n[3]||(n[3]=R("By: ",-1)),e("span",es,S(s.creator_name||"Unknown"),1)]),e("span",null,"Last updated: "+S(I(s.created_at)),1)])],2))),128))])):(o(),r("div",ts,n[4]||(n[4]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-16 w-16 text-gray-400 mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"1"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1),e("p",{class:"text-lg font-medium"},"No notes found for this project.",-1),e("p",{class:"text-sm mt-2"},'Click "Add New Note" to start creating your project notes.',-1)])))])):(o(),r("div",za," You do not have permission to view project notes. "))]))}},ss=["value","rows"],ls={__name:"TextareaInput",props:{modelValue:[String,Number],rows:{type:[String,Number],default:3}},emits:["update:modelValue"],setup(t){const w=k(null);return me(()=>{w.value.hasAttribute("autofocus")&&w.value.focus()}),(a,j)=>(o(),r("textarea",{class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full",value:t.modelValue,rows:t.rows,onInput:j[0]||(j[0]=g=>a.$emit("update:modelValue",g.target.value)),ref_key:"input",ref:w},null,40,ss))}},os={class:"p-6 bg-gray-50 rounded-xl shadow-lg"},ns={class:"flex justify-between items-center mb-6"},rs={key:0,class:"flex justify-center py-8"},is={key:1,class:"bg-white p-8 rounded-lg text-center border border-dashed border-gray-300"},ds={key:2,class:"space-y-6"},us={class:"flex justify-between items-start"},cs={class:"text-xl font-medium text-gray-900"},ms={class:"mt-2 flex items-center flex-wrap space-x-4 text-sm text-gray-500"},vs={key:0,class:"text-gray-700"},ps={key:1,class:"text-gray-700"},gs={key:0,class:"mt-4 text-base text-gray-600"},ys={key:0,class:"flex space-x-2"},fs={class:"p-6 bg-white rounded-lg"},bs={class:"text-2xl font-bold text-gray-900 mb-6"},ws={class:"p-4 bg-indigo-50 rounded-lg border border-indigo-200"},xs={class:"flex justify-end space-x-3 mt-6"},hs={__name:"ProjectDeliverables",props:{projectId:{type:[Number,String],required:!0},errors:{type:Object,default:()=>({})},isSaving:{type:Boolean,default:!1},canManageProjectDeliverables:{type:Boolean,default:!1},canViewProjectDeliverables:{type:Boolean,default:!0}},emits:["checklist-item-toggled"],setup(t,{emit:w}){const a=t,j=k([]),g=k([]),_=k(!0),D=k([]),U=k(!1),I=k("create"),y=k({id:null,name:"",description:"",milestone_id:null,status:"pending",due_date:"",details:{deliverable_type_key:null,checklist:[]}}),n=k({}),s=k(null),i=[{value:"pending",label:"Pending"},{value:"in_progress",label:"In Progress"},{value:"completed",label:"Completed"},{value:"cancelled",label:"Cancelled"}],T=J(()=>{const m=g.value.find(f=>{var b;return f.key===((b=y.value.details)==null?void 0:b.deliverable_type_key)});return(m==null?void 0:m.checklistItemPlaceholder)||"e.g., Task 1, Task 2, Task 3"});ne(()=>a.projectId,q,{immediate:!0});async function q(){if(a.projectId){_.value=!0;try{const m=await de.get(`/api/projects/${a.projectId}/project-deliverables`);j.value=m.data;const f=await de.get(`/api/projects/${a.projectId}/milestones`);D.value=f.data;const b=await de.get("/api/project-deliverable-types");g.value=b.data}catch(m){console.error("Error fetching data:",m),O("Failed to load project data")}finally{_.value=!1}}}function Y(){I.value="create",y.value={id:null,name:"",description:"",milestone_id:null,status:"pending",due_date:"",details:{deliverable_type_key:null,checklist:[{name:"",completed:!1}]}},n.value={},s.value=null,U.value=!0}function E(m){I.value="edit",y.value=JSON.parse(JSON.stringify(m)),y.value.details.checklist||(y.value.details.checklist=[]),(y.value.details.checklist.length===0||y.value.details.checklist[y.value.details.checklist.length-1].name!=="")&&y.value.details.checklist.push({name:"",completed:!1}),n.value={},s.value=y.value.details.deliverable_type_key??null,U.value=!0}async function v(m){var L;if(m===s.value)return;if((((L=y.value.details)==null?void 0:L.checklist)||[]).some(B=>((B==null?void 0:B.name)||"").trim()!=="")){if(!await lt("Changing the deliverable type may clear your existing checklist items. Do you want to proceed?",{confirmText:"Proceed",cancelText:"Cancel",type:"warning"})){y.value.details.deliverable_type_key=s.value;return}y.value.details.checklist=[{name:"",completed:!1}]}s.value=m}async function d(){n.value={};try{let m;const f=y.value.details.checklist.filter(L=>L.name.trim()!==""),b={...y.value,details:{...y.value.details,checklist:f}};I.value==="create"?(m=await de.post(`/api/projects/${a.projectId}/project-deliverables`,b),se("Project deliverable created successfully")):(m=await de.put(`/api/project-deliverables/${y.value.id}`,b),se("Project deliverable updated successfully")),await q(),U.value=!1}catch(m){console.error("Error saving deliverable:",m),m.response&&m.response.data&&m.response.data.errors?n.value=m.response.data.errors:O("Failed to save project deliverable")}}async function h(m){if(confirm("Are you sure you want to delete this deliverable?"))try{await de.delete(`/api/project-deliverables/${m}`),se("Project deliverable deleted successfully"),await q()}catch(f){console.error("Error deleting deliverable:",f),O("Failed to delete project deliverable")}}function F(m){return m?new Date(m).toLocaleDateString():"N/A"}return(m,f)=>(o(),r("div",os,[e("div",ns,[f[10]||(f[10]=e("h3",{class:"text-2xl font-bold text-gray-900"},"Project Deliverables",-1)),t.canManageProjectDeliverables?(o(),ae(le,{key:0,onClick:Y,disabled:t.isSaving||_.value},{default:W(()=>f[9]||(f[9]=[R(" Add Deliverable ",-1)])),_:1,__:[9]},8,["disabled"])):x("",!0)]),_.value?(o(),r("div",rs,f[11]||(f[11]=[e("div",{class:"animate-spin rounded-full h-10 w-10 border-b-2 border-indigo-600"},null,-1)]))):j.value.length===0?(o(),r("div",is,[f[13]||(f[13]=e("p",{class:"text-gray-600 text-lg"},"No deliverables have been added to this project yet.",-1)),t.canManageProjectDeliverables?(o(),ae(le,{key:0,onClick:Y,class:"mt-6"},{default:W(()=>f[12]||(f[12]=[R(" Add Your First Deliverable ",-1)])),_:1,__:[12]})):x("",!0)])):(o(),r("div",ds,[(o(!0),r(ue,null,ce(j.value,b=>{var L;return o(),r("div",{key:b.id,class:"bg-white border border-gray-200 rounded-xl p-6 shadow-sm hover:shadow-lg transition-all duration-300"},[e("div",us,[e("div",null,[e("h4",cs,S(b.name),1),e("div",ms,[e("span",{class:Q({"font-medium py-1 px-3 rounded-full text-white":!0,"bg-yellow-500":b.status==="pending","bg-blue-500":b.status==="in_progress","bg-green-500":b.status==="completed","bg-red-500":b.status==="cancelled"})},S(b.status.replace("_"," ").toUpperCase()),3),b.milestone?(o(),r("span",vs,[f[14]||(f[14]=e("span",{class:"font-semibold"},"Milestone:",-1)),R(" "+S(b.milestone.name),1)])):x("",!0),b.due_date?(o(),r("span",ps,[f[15]||(f[15]=e("span",{class:"font-semibold"},"Due:",-1)),R(" "+S(F(b.due_date)),1)])):x("",!0)]),b.description?(o(),r("p",gs,S(b.description),1)):x("",!0),(L=b.details)!=null&&L.checklist&&b.details.checklist.length>0?(o(),ae(wt,{key:1,items:b.details.checklist,"api-endpoint":`/api/project-deliverables/${b.id}`,title:"Deliverable Checklist:","payload-transformer":(B,V)=>({...b,details:{...b.details,checklist:B}}),onItemToggled:B=>m.$emit("checklist-item-toggled",{deliverable:b,index:B.index,completed:B.completed})},null,8,["items","api-endpoint","payload-transformer","onItemToggled"])):x("",!0)]),t.canManageProjectDeliverables?(o(),r("div",ys,[l(fe,{onClick:B=>E(b),size:"sm"},{default:W(()=>f[16]||(f[16]=[R(" Edit ",-1)])),_:2,__:[16]},1032,["onClick"]),l(ft,{onClick:B=>h(b.id),size:"sm"},{default:W(()=>f[17]||(f[17]=[R(" Delete ",-1)])),_:2,__:[17]},1032,["onClick"])])):x("",!0)])])}),128))])),l(bt,{show:U.value,onClose:f[8]||(f[8]=b=>U.value=!1),maxWidth:"2xl"},{default:W(()=>{var b,L,B,V,p;return[e("div",fs,[e("h3",bs,S(I.value==="create"?"Add New Deliverable":"Edit Deliverable"),1),e("form",{onSubmit:ke(d,["prevent"]),class:"space-y-6"},[e("div",null,[l(A,{for:"name",value:"Name"}),l(H,{id:"name",modelValue:y.value.name,"onUpdate:modelValue":f[0]||(f[0]=u=>y.value.name=u),type:"text",class:"mt-1 block w-full",required:""},null,8,["modelValue"]),l(N,{message:(b=n.value.name)==null?void 0:b[0],class:"mt-2"},null,8,["message"])]),e("div",null,[l(A,{for:"description",value:"Description"}),l(ls,{id:"description",modelValue:y.value.description,"onUpdate:modelValue":f[1]||(f[1]=u=>y.value.description=u),class:"mt-1 block w-full",rows:"3"},null,8,["modelValue"]),l(N,{message:(L=n.value.description)==null?void 0:L[0],class:"mt-2"},null,8,["message"])]),e("div",null,[l(A,{for:"milestone_id",value:"Milestone (Optional)"}),l(Z,{id:"milestone_id",modelValue:y.value.milestone_id,"onUpdate:modelValue":f[2]||(f[2]=u=>y.value.milestone_id=u),options:D.value,valueKey:"id",labelKey:"name",placeholder:"Select a milestone",class:"mt-1 block w-full"},null,8,["modelValue","options"]),l(N,{message:(B=n.value.milestone_id)==null?void 0:B[0],class:"mt-2"},null,8,["message"])]),e("div",null,[l(A,{for:"status",value:"Status"}),l(Z,{id:"status",modelValue:y.value.status,"onUpdate:modelValue":f[3]||(f[3]=u=>y.value.status=u),options:i,valueKey:"value",labelKey:"label",placeholder:"Select a Status",class:"mt-1 block w-full"},null,8,["modelValue"]),l(N,{message:(V=n.value.status)==null?void 0:V[0],class:"mt-2"},null,8,["message"])]),e("div",null,[l(A,{for:"due_date",value:"Due Date (Optional)"}),l(H,{id:"due_date",modelValue:y.value.due_date,"onUpdate:modelValue":f[4]||(f[4]=u=>y.value.due_date=u),type:"date",class:"mt-1 block w-full"},null,8,["modelValue"]),l(N,{message:(p=n.value.due_date)==null?void 0:p[0],class:"mt-2"},null,8,["message"])]),e("div",ws,[f[18]||(f[18]=e("h4",{class:"text-lg font-semibold text-indigo-800 mb-4"},"Deliverable Checklist",-1)),e("div",null,[l(A,{for:"deliverable_type_key",value:"Deliverable Type"}),l(Z,{id:"deliverable_type_key",modelValue:y.value.details.deliverable_type_key,"onUpdate:modelValue":[f[5]||(f[5]=u=>y.value.details.deliverable_type_key=u),v],options:g.value,valueKey:"key",labelKey:"name",placeholder:"Select a Deliverable Type",class:"mt-1 block w-full",required:""},null,8,["modelValue","options"])]),l(gt,{modelValue:y.value.details.checklist,"onUpdate:modelValue":f[6]||(f[6]=u=>y.value.details.checklist=u),placeholder:T.value,label:"Checklist Items",containerClass:"mt-4"},null,8,["modelValue","placeholder"])]),e("div",xs,[l(fe,{onClick:f[7]||(f[7]=u=>U.value=!1),disabled:t.isSaving},{default:W(()=>f[19]||(f[19]=[R(" Cancel ",-1)])),_:1,__:[19]},8,["disabled"]),l(le,{type:"submit",disabled:t.isSaving},{default:W(()=>[R(S(I.value==="create"?"Create":"Update"),1)]),_:1},8,["disabled"])])],32)])]}),_:1},8,["show"])]))}},js={class:"p-6 bg-white rounded-lg font-inter"},_s={key:0,class:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4",role:"alert"},ks={class:"block sm:inline ml-2"},Ps={key:1,class:"flex items-center justify-center py-8"},$s={key:2},Ss={key:0,class:"bg-gradient-to-r from-blue-500 to-indigo-600 text-white p-6 rounded-lg shadow-md mb-6"},Vs={class:"flex items-center justify-between"},Cs={class:"text-3xl font-bold mt-1"},Is={class:"text-sm opacity-90 mt-2"},Ds={class:"font-semibold"},Us={class:"font-semibold"},Ms={key:1,class:"bg-gray-100 text-gray-600 p-4 rounded-lg shadow-sm mb-6 text-center"},As={class:"bg-gray-50 p-6 rounded-lg shadow-sm mb-6 border border-gray-200"},Ns={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},Ts=["disabled"],Bs=["value"],Rs={class:"bg-gray-50 p-6 rounded-lg shadow-sm mb-6 border border-gray-200"},Es={class:"mb-4"},Os={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-1 gap-4"},Fs={class:"flex items-center justify-between"},Ls=["for"],zs={class:"ms-2 text-base font-medium text-gray-800"},qs=["onClick"],Ks={key:0,class:"mt-4 pt-4 border-t border-gray-200"},Hs={class:"grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4"},Gs={class:"grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4"},Ys=["id","onUpdate:modelValue","disabled"],Ws={key:0,class:"mt-4 p-4 bg-blue-50 rounded-lg border border-blue-200"},Js={class:"flex justify-between items-center mb-3"},Xs={class:"space-y-4"},Qs={class:"flex justify-between items-center mb-2"},Zs=["onClick"],el={class:"grid grid-cols-1 sm:grid-cols-2 gap-4"},tl=["onClick"],al={key:0},sl={class:"mt-6 pt-4 border-t border-gray-200"},ll={key:1,class:"mt-4 flex items-center"},ol={key:2,class:"mt-6 flex justify-end"},nl={__name:"ServicesAndPaymentForm",props:{projectId:{type:[Number,String],required:!0},paymentTypeOptions:{type:Array,required:!0},canManageProjectServicesAndPayments:{type:Boolean,required:!0},canViewProjectServicesAndPayments:{type:Boolean,required:!0}},emits:["updated"],setup(t,{emit:w}){const a=t,j=w,g=k({}),_=k(!1),D=[{value:"PKR",label:"PKR"},{value:"AUD",label:"AUD"},{value:"INR",label:"INR"},{value:"USD",label:"USD"},{value:"EUR",label:"EUR"},{value:"GBP",label:"GBP"}],I=k([...[{value:"Website Designing",label:"Website Designing"},{value:"SEO",label:"SEO"},{value:"Social Media",label:"Social Media"},{value:"Content Writing",label:"Content Writing"},{value:"Graphic Design",label:"Graphic Design"}]]),y=k(""),n=k(!1),s=be({services:[],service_details:[],payment_type:"one_off",currency:"AUD"}),i=be({}),T=J(()=>{let V=0;return s.services.forEach(p=>{const u=m(p);u&&u.amount&&(V+=parseFloat(u.amount))}),V.toFixed(2)}),q=J(()=>{let V=null,p=null;const u=new Date;return u.setHours(0,0,0,0),s.service_details.forEach(M=>{M.frequency==="one_off"&&M.payment_breakdown&&M.payment_breakdown.forEach(z=>{var K;if(z.due_date){const te=new Date(z.due_date);te.setHours(0,0,0,0),te>=u&&(!V||te<V.date)&&(V={date:te,serviceId:M.service_id,paymentLabel:z.label},p=((K=I.value.find(X=>X.value===M.service_id))==null?void 0:K.label)||M.service_id)}})}),V?{date:V.date.toLocaleDateString(),serviceLabel:p,paymentLabel:V.paymentLabel}:null}),Y=J(()=>{const V=s.services.filter(p=>{const u=m(p);return u&&u.frequency!=="monthly"});return V.length===0?!0:V.every(p=>f(p)===100)}),E=J(()=>!a.projectId||!a.canManageProjectServicesAndPayments||!Y.value),v=()=>{const V=y.value.trim();V&&!I.value.some(p=>p.label.toLowerCase()===V.toLowerCase())&&(I.value.push({value:V,label:V}),y.value="",n.value=!1)},d=async()=>{if(a.projectId){_.value=!0;try{const p=(await window.axios.get(`/api/projects/${a.projectId}/sections/services-payment`)).data;return s.services=p.services||[],s.service_details=p.service_details||[],s.payment_type=p.payment_type||"one_off",s.currency=p.currency||"AUD",s.services.forEach(u=>{I.value.some(M=>M.value===u)||I.value.push({value:u,label:u}),i[u]=!1}),s.service_details.forEach(u=>{if(u.payment_breakdown&&!Array.isArray(u.payment_breakdown)){const M=u.payment_breakdown;u.payment_breakdown=[{label:"First",percentage:parseInt(M.first)||30,due_date:null},{label:"Second",percentage:parseInt(M.second)||30,due_date:null},{label:"Third",percentage:parseInt(M.third)||40,due_date:null}]}else!u.payment_breakdown||u.payment_breakdown.length===0?u.payment_breakdown=[{label:"Payment 1",percentage:100,due_date:null}]:u.payment_breakdown.forEach(M=>{M.due_date===void 0&&(M.due_date=null)})}),p}catch(V){return console.error("Error fetching services and payment data:",V),g.value.general="Failed to fetch services and payment data.",null}finally{_.value=!1}}},h=async()=>{g.value={},_.value=!0;try{const V={services:s.services,service_details:s.service_details,total_amount:parseFloat(T.value),payment_type:s.payment_type,currency:s.currency},p=await window.axios.put(`/api/projects/${a.projectId}/sections/services-payment`,V);se("Services and payment information updated successfully!"),j("updated")}catch(V){V.response&&V.response.status===422?g.value=V.response.data.errors:V.response&&V.response.data.message?g.value.general=V.response.data.message:(g.value.general="Failed to update services and payment information.",console.error("Error:",V))}finally{_.value=!1}},F=(V,p)=>{p?(s.service_details.some(u=>u.service_id===V)||s.service_details.push({service_id:V,amount:"",frequency:"one_off",start_date:"",payment_breakdown:[{label:"Payment 1",percentage:100,due_date:null}],currency:s.currency}),i[V]=!0):(s.service_details=s.service_details.filter(u=>u.service_id!==V),i[V]=!1)},m=V=>{let p=s.service_details.find(u=>u.service_id===V);if(!p)p={service_id:V,amount:"",frequency:"one_off",start_date:"",payment_breakdown:[{label:"Payment 1",percentage:100,due_date:null}],currency:s.currency},s.service_details.push(p);else if(p.payment_breakdown&&!Array.isArray(p.payment_breakdown)){const u=p.payment_breakdown;p.payment_breakdown=[{label:"First",percentage:parseInt(u.first)||30,due_date:null},{label:"Second",percentage:parseInt(u.second)||30,due_date:null},{label:"Third",percentage:parseInt(u.third)||40,due_date:null}]}else!p.payment_breakdown||p.payment_breakdown.length===0?p.payment_breakdown=[{label:"Payment 1",percentage:100,due_date:null}]:p.payment_breakdown.forEach(u=>{u.due_date===void 0&&(u.due_date=null)});return p},f=V=>{const p=m(V);return!p.payment_breakdown||!Array.isArray(p.payment_breakdown)?0:p.payment_breakdown.reduce((u,M)=>u+(parseInt(M.percentage)||0),0)},b=V=>{const p=m(V);if(p.payment_breakdown||(p.payment_breakdown=[]),!Array.isArray(p.payment_breakdown)){const z=p.payment_breakdown;p.payment_breakdown=[{label:"First",percentage:parseInt(z.first)||30,due_date:null},{label:"Second",percentage:parseInt(z.second)||30,due_date:null},{label:"Third",percentage:parseInt(z.third)||40,due_date:null}]}const u=p.payment_breakdown.length;let M=0;if(u>0){const z=p.payment_breakdown[u-1];M=Math.floor(z.percentage/2),z.percentage-=M}else M=100;p.payment_breakdown.push({label:`Payment ${u+1}`,percentage:M,due_date:null})},L=(V,p)=>{const u=m(V);if(!u.payment_breakdown||!Array.isArray(u.payment_breakdown)||u.payment_breakdown.length<=1)return;const M=parseInt(u.payment_breakdown[p].percentage)||0;if(u.payment_breakdown.splice(p,1),M>0&&u.payment_breakdown.length>0){const z=p>0&&p<=u.payment_breakdown.length?p-1:0;u.payment_breakdown[z].percentage=(parseInt(u.payment_breakdown[z].percentage)||0)+M}u.payment_breakdown.forEach((z,K)=>{z.label=`Payment ${K+1}`})},B=V=>{i[V]=!i[V]};return ne(()=>a.projectId,V=>{V&&d()},{immediate:!0}),(V,p)=>(o(),r("div",js,[g.value.general?(o(),r("div",_s,[p[6]||(p[6]=e("strong",{class:"font-bold"},"Error!",-1)),e("span",ks,S(g.value.general),1)])):x("",!0),_.value?(o(),r("div",Ps,p[7]||(p[7]=[e("svg",{class:"animate-spin -ml-1 mr-3 h-8 w-8 text-blue-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),e("span",{class:"text-gray-600"},"Loading services and payment data...",-1)]))):(o(),r("div",$s,[q.value?(o(),r("div",Ss,[e("div",Vs,[e("div",null,[p[10]||(p[10]=e("p",{class:"text-sm opacity-90"},"Next Payment Due",-1)),e("p",Cs,S(q.value.date),1),e("p",Is,[p[8]||(p[8]=R(" For: ",-1)),e("span",Ds,S(q.value.serviceLabel),1),p[9]||(p[9]=R(" - ",-1)),e("span",Us,S(q.value.paymentLabel),1)])]),p[11]||(p[11]=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-12 w-12 opacity-70",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1))])])):(o(),r("div",Ms," No upcoming payment due dates found for one-off services. ")),e("div",As,[p[13]||(p[13]=e("h4",{class:"text-xl font-semibold text-gray-700 mb-4"},"Overall Project Payment Details",-1)),e("div",Ns,[e("div",null,[l(A,{for:"calculated_total_amount",value:"Calculated Total Amount"}),l(H,{id:"calculated_total_amount",type:"text",class:"mt-1 block w-full bg-gray-100 cursor-not-allowed",value:T.value,disabled:""},null,8,["value"]),p[12]||(p[12]=e("p",{class:"text-sm text-gray-500 mt-1"},"This amount is automatically calculated from selected services.",-1))]),e("div",null,[l(A,{for:"payment_type",value:"Payment Type"}),he(e("select",{id:"payment_type",class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full p-2.5","onUpdate:modelValue":p[0]||(p[0]=u=>s.payment_type=u),required:"",disabled:!t.canManageProjectServicesAndPayments},[(o(!0),r(ue,null,ce(t.paymentTypeOptions,u=>(o(),r("option",{key:u.value,value:u.value},S(u.label),9,Bs))),128))],8,Ts),[[Re,s.payment_type]]),l(N,{message:g.value.payment_type?g.value.payment_type[0]:"",class:"mt-2"},null,8,["message"])]),e("div",null,[l(A,{for:"overall_currency",value:"Overall Project Currency"}),l(Z,{id:"overall_currency",modelValue:s.currency,"onUpdate:modelValue":p[1]||(p[1]=u=>s.currency=u),options:D,"value-key":"value","label-key":"label",class:"w-full mt-1",disabled:!t.canManageProjectServicesAndPayments},null,8,["modelValue","disabled"]),l(N,{message:g.value.currency?g.value.currency[0]:"",class:"mt-2"},null,8,["message"])])])]),e("div",Rs,[p[20]||(p[20]=e("h4",{class:"text-xl font-semibold text-gray-700 mb-4"},"Manage Services",-1)),e("div",Es,[l(A,{for:"services",value:"Select Services",class:"mb-2"}),e("div",Os,[(o(!0),r(ue,null,ce(I.value,u=>(o(),r("div",{key:u.value,class:"bg-white p-4 rounded-lg shadow-sm border border-gray-200"},[e("div",Fs,[e("label",{for:`service_${u.value}`,class:"flex items-center cursor-pointer"},[l(xt,{id:`service_${u.value}`,value:u.value,checked:s.services,"onUpdate:checked":[p[2]||(p[2]=M=>s.services=M),M=>F(u.value,M)],disabled:!t.canManageProjectServicesAndPayments},null,8,["id","value","checked","onUpdate:checked","disabled"]),e("span",zs,S(u.label),1)],8,Ls),(s.services||[]).includes(u.value)?(o(),r("button",{key:0,onClick:M=>B(u.value),type:"button",class:Q(["text-gray-500 hover:text-gray-700 transition-transform duration-200",{"rotate-180":i[u.value]}])},p[14]||(p[14]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"})],-1)]),10,qs)):x("",!0)]),(s.services||[]).includes(u.value)&&i[u.value]?(o(),r("div",Ks,[e("div",Hs,[e("div",null,[l(A,{for:`service_amount_${u.value}`,value:"Amount"},null,8,["for"]),l(H,{id:`service_amount_${u.value}`,type:"number",step:"0.01",placeholder:"Service Amount",class:"w-full mt-1",modelValue:m(u.value).amount,"onUpdate:modelValue":M=>m(u.value).amount=M,disabled:!t.canManageProjectServicesAndPayments},null,8,["id","modelValue","onUpdate:modelValue","disabled"])]),e("div",null,[l(A,{for:`service_currency_${u.value}`,value:"Currency"},null,8,["for"]),l(Z,{id:`service_currency_${u.value}`,modelValue:m(u.value).currency,"onUpdate:modelValue":M=>m(u.value).currency=M,options:D,"value-key":"value","label-key":"label",class:"w-full mt-1",disabled:!t.canManageProjectServicesAndPayments},null,8,["id","modelValue","onUpdate:modelValue","disabled"])])]),e("div",Gs,[e("div",null,[l(A,{for:`service_frequency_${u.value}`,value:"Frequency"},null,8,["for"]),he(e("select",{id:`service_frequency_${u.value}`,class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full p-2.5","onUpdate:modelValue":M=>m(u.value).frequency=M,disabled:!t.canManageProjectServicesAndPayments},p[15]||(p[15]=[e("option",{value:"monthly"},"Monthly",-1),e("option",{value:"one_off"},"One off",-1)]),8,Ys),[[Re,m(u.value).frequency]])]),e("div",null,[l(A,{for:`service_start_date_${u.value}`,value:"Start Date"},null,8,["for"]),l(H,{id:`service_start_date_${u.value}`,type:"date",class:"w-full mt-1",modelValue:m(u.value).start_date,"onUpdate:modelValue":M=>m(u.value).start_date=M,disabled:!t.canManageProjectServicesAndPayments},null,8,["id","modelValue","onUpdate:modelValue","disabled"])])]),m(u.value).frequency!=="monthly"?(o(),r("div",Ws,[e("div",Js,[l(A,{value:"Payment Breakdown (%)",class:"text-base font-medium text-blue-800"}),t.canManageProjectServicesAndPayments?(o(),ae(le,{key:0,type:"button",onClick:M=>b(u.value),class:"px-4 py-2 text-sm"},{default:W(()=>p[16]||(p[16]=[R(" + Add Payment Step ",-1)])),_:2,__:[16]},1032,["onClick"])):x("",!0)]),e("div",Xs,[(o(!0),r(ue,null,ce(m(u.value).payment_breakdown,(M,z)=>(o(),r("div",{key:z,class:"bg-white p-4 rounded-md shadow-sm border border-blue-100"},[e("div",Qs,[l(A,{for:`payment_label_${z}_${u.value}`,value:M.label,class:"font-semibold"},null,8,["for","value"]),t.canManageProjectServicesAndPayments&&m(u.value).payment_breakdown.length>1?(o(),r("button",{key:0,type:"button",class:"text-red-500 hover:text-red-700 p-1 rounded-full hover:bg-red-100 transition-colors",onClick:K=>L(u.value,z),title:"Remove payment step"},p[17]||(p[17]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 011-1h4a1 1 0 110 2H8a1 1 0 01-1-1zm-1 3a1 1 0 100 2h8a1 1 0 100-2H6z","clip-rule":"evenodd"})],-1)]),8,Zs)):x("",!0)]),e("div",el,[e("div",null,[l(A,{for:`payment_percentage_${z}_${u.value}`,value:"Percentage (%)",class:"text-sm"},null,8,["for"]),l(H,{id:`payment_percentage_${z}_${u.value}`,type:"number",min:"0",max:"100",class:"w-full mt-1",modelValue:M.percentage,"onUpdate:modelValue":K=>M.percentage=K,modelModifiers:{number:!0},onInput:K=>{M.percentage=Math.max(0,Math.min(100,parseInt(K.target.value)||0))},disabled:!t.canManageProjectServicesAndPayments},null,8,["id","modelValue","onUpdate:modelValue","onInput","disabled"])]),e("div",null,[l(A,{for:`payment_due_date_${z}_${u.value}`,value:"Due Date (Optional)",class:"text-sm"},null,8,["for"]),l(H,{id:`payment_due_date_${z}_${u.value}`,type:"date",class:"w-full mt-1",modelValue:M.due_date,"onUpdate:modelValue":K=>M.due_date=K,disabled:!t.canManageProjectServicesAndPayments},null,8,["id","modelValue","onUpdate:modelValue","disabled"]),t.canManageProjectServicesAndPayments&&M.due_date?(o(),r("button",{key:0,type:"button",class:"text-xs text-red-500 hover:text-red-700 mt-1",onClick:K=>M.due_date=null}," Clear Date ",8,tl)):x("",!0)])])]))),128))]),e("div",{class:Q(["text-sm mt-4 p-2 rounded-md",{"bg-green-100 text-green-700":f(u.value)===100,"bg-red-100 text-red-700 font-bold":f(u.value)!==100}])},[R(" Total Percentage: "+S(f(u.value))+"% ",1),f(u.value)!==100?(o(),r("span",al," (Total must be 100%) ")):x("",!0)],2)])):x("",!0)])):x("",!0)]))),128))])]),e("div",sl,[t.canManageProjectServicesAndPayments&&!n.value?(o(),r("button",{key:0,type:"button",class:"inline-flex items-center px-4 py-2 bg-blue-600 border border-transparent rounded-md font-semibold text-xs text-white uppercase tracking-widest hover:bg-blue-700 active:bg-blue-900 focus:outline-none focus:border-blue-900 focus:ring ring-blue-300 disabled:opacity-25 transition ease-in-out duration-150 shadow-md",onClick:p[3]||(p[3]=u=>n.value=!0)},p[18]||(p[18]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 4v16m8-8H4"})],-1),R(" Add New Service/Department ",-1)]))):x("",!0),t.canManageProjectServicesAndPayments&&n.value?(o(),r("div",ll,[l(H,{type:"text",class:"flex-grow mr-2 border-gray-300 rounded-md shadow-sm p-2.5",modelValue:y.value,"onUpdate:modelValue":p[4]||(p[4]=u=>y.value=u),placeholder:"Enter new service/department name",onKeyup:ot(v,["enter"])},null,8,["modelValue"]),l(le,{onClick:v},{default:W(()=>p[19]||(p[19]=[R("Add",-1)])),_:1,__:[19]}),e("button",{type:"button",class:"ml-2 text-sm text-gray-500 hover:text-gray-700 px-3 py-2 rounded-md transition-colors",onClick:p[5]||(p[5]=u=>{n.value=!1,y.value=""})}," Cancel ")])):x("",!0)]),l(N,{message:g.value.services?g.value.services[0]:"",class:"mt-2"},null,8,["message"])]),t.canManageProjectServicesAndPayments?(o(),r("div",ol,[l(le,{onClick:h,disabled:E.value,class:Q([{"opacity-50 cursor-not-allowed":E.value},"px-6 py-3 text-base"])},{default:W(()=>p[21]||(p[21]=[R(" Update Services & Payment ",-1)])),_:1,__:[21]},8,["disabled","class"])])):x("",!0)]))]))}},rl={class:"relative"},il={class:"flex flex-wrap items-center gap-2 mb-2 p-2 border border-gray-300 rounded-lg bg-white min-h-[44px] focus-within:border-indigo-500 focus-within:ring-1 focus-within:ring-indigo-500 transition-all duration-150"},dl={key:0,class:"inline-flex items-center px-3 py-1 text-sm font-medium bg-indigo-100 text-indigo-800 rounded-full shadow-sm"},ul={key:0,class:"absolute z-20 w-full bg-white border border-gray-300 rounded-lg shadow-lg max-h-60 overflow-y-auto mt-1 transform-gpu basic-prop-suggestions"},cl=["onMousedown"],ml={key:1,class:"px-4 py-2 text-sm text-gray-500"},vl={__name:"BasicPropertyInput",props:{modelValue:{type:[String,Number,null],default:null},label:{type:String,default:"Type"},placeholder:{type:String,default:"Select or type a value"},error:{type:String,default:""},disabled:{type:Boolean,default:!1},required:{type:Boolean,default:!1},searchUrl:{type:String,required:!0}},emits:["update:modelValue","change"],setup(t,{emit:w}){const a=t,j=w,g=k(""),_=k(null),D=k(!1),U=k([]),I=k(null),n=ht(async v=>{try{const d=`${a.searchUrl}?query=${encodeURIComponent(v||"")}`,{data:h}=await de.get(d);U.value=Array.isArray(h)?h.map(F=>({value:F.id,label:F.name})):[],D.value=!0}catch{U.value=[],D.value=!1}},250);ne(()=>a.modelValue,v=>{if(!v){_.value=null;return}if(typeof v=="string"&&v.startsWith("new_")){const d=v.split("_");d.shift(),d.length>0&&d.pop();const h=d.join(" ").replace(/-/g," ");_.value={value:v,label:h}}else{const d=U.value.find(h=>String(h.value)===String(v));d&&(_.value=d)}},{immediate:!0});const s=v=>{a.disabled||(_.value=v,j("update:modelValue",v.value),j("change",v.value),g.value="",D.value=!1,$e(()=>{var d;return(d=I.value)==null?void 0:d.focus()}))},i=()=>{if(a.disabled)return;const v=g.value.trim();if(!v)return;const h={value:`new_${v.replace(/\s+/g,"-").toLowerCase()}_${Date.now()}`,label:v};_.value=h,j("update:modelValue",h.value),j("change",h.value),g.value="",D.value=!1,$e(()=>{var F;return(F=I.value)==null?void 0:F.focus()})},T=v=>{var d;(d=v==null?void 0:v.stopPropagation)==null||d.call(v),!a.disabled&&(_.value=null,j("update:modelValue",null),j("change",null),g.value="",D.value=!1,$e(()=>{var h;return(h=I.value)==null?void 0:h.focus()}))},q=v=>{var d,h;v.key==="Enter"?(v.preventDefault(),i()):v.key==="Escape"?(D.value=!1,g.value="",(h=(d=I.value)==null?void 0:d.blur)==null||h.call(d)):v.key==="Backspace"&&g.value===""&&_.value&&T(v)},Y=v=>{g.value=v.target.value,D.value=!0,n(g.value)},E=v=>{var h;const d=((h=I.value)==null?void 0:h.$el)||I.value;d&&!d.contains(v.target)&&!v.target.closest(".basic-prop-suggestions")&&(D.value=!1,g.value="")};return me(()=>{document.addEventListener("click",E),n("")}),nt(()=>{document.removeEventListener("click",E)}),(v,d)=>(o(),r("div",rl,[l(A,{value:t.label,class:"mb-1"},null,8,["value"]),e("div",il,[_.value?(o(),r("span",dl,[R(S(_.value.label)+" ",1),t.disabled?x("",!0):(o(),r("button",{key:0,type:"button",onClick:T,class:"ml-2 -mr-1 text-indigo-500 hover:text-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 rounded-full p-0.5","aria-label":"Remove selected"},d[2]||(d[2]=[e("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])))])):x("",!0),l(H,{ref_key:"inputRef",ref:I,type:"text",placeholder:_.value?"":t.placeholder,modelValue:g.value,"onUpdate:modelValue":d[0]||(d[0]=h=>g.value=h),onFocus:d[1]||(d[1]=h=>D.value=!0),onKeydown:q,onInput:Y,class:"flex-grow min-w-[150px] border-none focus:ring-0 shadow-none p-0 bg-transparent text-gray-900",disabled:t.disabled},null,8,["placeholder","modelValue","disabled"])]),D.value&&!t.disabled?(o(),r("div",ul,[(o(!0),r(ue,null,ce(U.value,h=>(o(),r("div",{key:h.value,onMousedown:ke(F=>s(h),["stop","prevent"]),class:Q(["px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 cursor-pointer transition-colors duration-100",{"bg-indigo-50 text-indigo-700":_.value&&h.value===_.value.value}])},S(h.label),43,cl))),128)),g.value.trim()!==""&&!U.value.some(h=>h.label.toLowerCase()===g.value.toLowerCase())?(o(),r("div",{key:0,onMousedown:ke(i,["stop","prevent"]),class:"px-4 py-2 text-sm text-indigo-700 bg-indigo-50 hover:bg-indigo-100 cursor-pointer border-t border-indigo-200 font-semibold transition-colors duration-100"},' Add new: "'+S(g.value.trim())+'" ',33)):x("",!0),U.value.length===0&&g.value.trim()===""&&!_.value?(o(),r("div",ml," Start typing to search or select an option. ")):x("",!0)])):x("",!0),l(N,{message:t.error,class:"mt-2"},null,8,["message"])]))}},pl=jt(vl,[["__scopeId","data-v-45b08a99"]]),gl={class:"p-6 bg-white rounded-lg"},yl={key:0,class:"text-red-600 text-sm mb-4"},fl={key:1,class:"mb-6 p-4 bg-gray-50 rounded-md"},bl={class:"mb-6"},wl={class:"flex justify-end items-center mb-4"},xl={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},hl={class:"p-3 bg-blue-100 rounded-md"},jl={class:"text-lg font-bold text-blue-800"},_l={class:"flex items-center justify-between"},kl={key:0,class:"mt-1"},Pl={class:"text-lg font-bold text-indigo-800"},$l={key:0,class:"text-xs text-gray-600"},Sl={key:1,class:"mt-2 space-y-2"},Vl={class:"p-3 bg-red-100 rounded-md"},Cl={class:"text-lg font-bold text-red-800"},Il={class:"text-xs text-gray-500"},Dl={class:"p-3 bg-purple-100 rounded-md"},Ul={class:"text-lg font-bold text-purple-800"},Ml={class:"p-3 bg-green-100 rounded-md"},Al={class:"text-lg font-bold text-green-800"},Nl={class:"p-3 bg-yellow-100 rounded-md col-span-full md:col-span-1"},Tl={class:"text-lg font-bold text-yellow-800"},Bl={class:"text-xs text-gray-500"},Rl={class:"p-3 bg-orange-100 rounded-md col-span-full md:col-span-1"},El={class:"text-lg font-bold text-orange-900 mt-1"},Ol={class:"text-xs text-gray-500"},Fl={class:"p-3 bg-gray-100 rounded-md col-span-full md:col-span-1"},Ll={class:"text-lg font-bold mt-1 text-green-400"},zl={class:"p-3 bg-gray-100 rounded-md col-span-full md:col-span-1"},ql={class:"text-lg font-bold text-red-400 mt-1"},Kl={class:"grid grid-cols-1 gap-4 md:grid-cols-2"},Hl={key:0},Gl={key:1},Yl={class:"mt-4 flex justify-end"},Wl={key:2},Jl={key:0,class:"space-y-3"},Xl={key:1,class:"p-4 bg-gray-50 rounded-md text-gray-600 text-center"},Ql={key:2,class:"space-y-4"},Zl={class:"flex justify-between items-start mb-2"},eo={class:"flex-grow"},to={class:"font-medium text-gray-900 text-lg"},ao={class:"text-xs text-gray-500 mt-1"},so={key:0},lo={class:"flex-shrink-0 text-right"},oo={key:0,class:"text-sm text-gray-600"},no={class:"flex justify-between items-end text-xs text-gray-600 mt-2 border-t border-gray-200 pt-2"},ro={key:0,class:"block"},io={key:1,class:"block"},uo={key:2,class:"block mt-1 text-gray-500"},co={class:"flex space-x-2 mt-2"},mo={key:0,class:"mt-4 p-4 bg-blue-50 rounded-md border border-blue-200"},vo={class:"text-md font-medium text-gray-900 mb-4"},po={class:"mb-4"},go={class:"mb-4"},yo={class:"flex items-center"},fo=["disabled"],bo={class:"text-sm text-gray-700"},wo={key:0,class:"mb-4"},xo={class:"flex justify-end space-x-2"},ze=.25,ho={__name:"ProjectTransactions",props:{projectId:{type:[Number,String],required:!0},userProjectRole:{type:Object,default:()=>({})}},setup(t){const w=t,{canDo:a,canManage:j}=Ve(()=>w.projectId),g=j("project_expenses",w.userProjectRole),_=j("project_income",w.userProjectRole),D=a("view_project_transactions",w.userProjectRole),U=k([]),I=k([]),y=k({}),n=k(""),s=k(!1),i=k(null),T=k(""),q=k(!1),Y=k({}),E=k(null),v=k(""),d=k({description:"",amount:"",currency:"PKR",user_id:null,hours_spent:"",type:"expense",transaction_type:null}),h=He,F=[{value:"PKR",label:"PKR"},{value:"AUD",label:"AUD"},{value:"INR",label:"INR"},{value:"USD",label:"USD"},{value:"EUR",label:"EUR"},{value:"GBP",label:"GBP"}],m=k(null),f=k("PKR"),b=k(!1),L=k({}),B=async()=>{try{const{data:$}=await window.axios.get(`/api/projects/${w.projectId}/expendable-budget`);m.value=$.total_budget,f.value=($.currency||"PKR").toUpperCase()}catch($){console.error("Error fetching expendable budget",$)}},V=async()=>{var $;if(L.value={},m.value===null||m.value===""||isNaN(Number(m.value))||Number(m.value)<0){L.value.amount=["Please enter a valid amount"];return}try{await window.axios.patch(`/api/projects/${w.projectId}/expendable-budget`,{total_expendable_amount:Number(m.value),currency:f.value}),se("Expendable budget updated"),b.value=!1}catch(c){(($=c.response)==null?void 0:$.status)===422?L.value=c.response.data.errors||{general:[c.response.data.message]}:(O("Failed to update expendable budget"),console.error(c))}},p=[{value:"expense",label:"Expense"},{value:"income",label:"Income"},{value:"bonus",label:"Bonus"}],u=J(()=>I.value.map($=>({value:$.id,label:$.name||"Unknown User"}))),M=()=>{const $=new Date,c=$.getFullYear(),G=String($.getMonth()+1).padStart(2,"0"),re=String($.getDate()).padStart(2,"0");return`${c}-${G}-${re}`},z=async()=>{if(!(!w.projectId||!D.value))try{const $=await window.axios.get(`/api/projects/${w.projectId}/sections/clients-users`);I.value=$.data.users||[]}catch($){n.value="Failed to fetch users.",console.error("Error fetching users:",$)}},K=async()=>{if(!(!w.projectId||!D.value)){s.value=!0;try{(!oe.value||Object.keys(oe.value).length===0)&&await Se();const $=await window.axios.get(`/api/projects/${w.projectId}/sections/transactions`);U.value=$.data}catch($){n.value="Failed to fetch transactions.",console.error("Error fetching transactions:",$)}finally{s.value=!1}}},te=async()=>{var $;if(!g.value&&!_.value){O("You do not have permission to manage transactions.");return}if(!d.value.amount||isNaN(d.value.amount)){y.value.amount=["Please enter a valid amount"];return}if(d.value.type==="expense"&&!g.value){O("You do not have permission to add expenses.");return}if(d.value.type==="income"&&!_.value){O("You do not have permission to add income.");return}if(d.value.type==="bonus"&&!g.value){O("You do not have permission to add bonuses.");return}y.value={},n.value="",s.value=!0;try{if(y.value={},!d.value.transaction_type){y.value.transaction_type_id=["Transaction Type is required"];return}if(d.value.type==="expense"&&!d.value.user_id){y.value.user_id=["User is required for expense transactions"];return}const c={...d.value,amount:Number(d.value.amount)};c.transaction_type!==null&&c.transaction_type!==void 0&&(c.transaction_type=c.transaction_type);const G=await window.axios.post(`/api/projects/${w.projectId}/transactions`,c);await K(),X(),se("Transaction saved successfully!")}catch(c){(($=c.response)==null?void 0:$.status)===422?y.value=c.response.data.errors:(n.value="Failed to save transaction.",console.error("Error saving transaction:",c))}finally{s.value=!1}},X=()=>{d.value={description:"",amount:"",currency:"PKR",user_id:null,hours_spent:"",type:"expense",transaction_type:null}},ve=async $=>{if(!g.value&&!_.value){O("You do not have permission to delete transactions.");return}if(window.confirm("Are you sure you want to delete this transaction?"))try{const c=U.value[$].id;await window.axios.delete(`/api/projects/${w.projectId}/transactions/${c}`),await K(),se("Transaction deleted successfully!")}catch(c){n.value="Failed to delete transaction.",console.error("Error deleting transaction:",c)}},Ge=$=>{if(!g.value&&!_.value){O("You do not have permission to manage transactions.");return}const c=U.value[$];i.value===c.id?(i.value=null,E.value=null,v.value=""):(E.value=$,i.value=c.id,T.value=c.amount,q.value=!1,Y.value={},v.value=M(),(Number(c.amount)===0||Math.abs(Number(T.value)-Number(c.amount))<.01)&&(q.value=!0))};ne(T,$=>{if(E.value!==null){const c=U.value[E.value];q.value=Math.abs(Number($)-Number(c.amount))<.01}});const Ce=()=>{i.value=null,E.value=null,T.value="",q.value=!1,Y.value={},v.value=""},Ye=async()=>{var re;if(!g.value&&!_.value){O("You do not have permission to manage transactions.");return}const $=E.value,c=U.value[$],G=Number(T.value);if(!q.value&&(!T.value||isNaN(G)||G<=0||G>Number(c.amount))){Y.value.amount=["Please enter a valid amount between 0 and "+ee(Number(c.amount),c.currency)];return}if(!v.value){Y.value.date=["Please select a payment date."];return}Y.value={},s.value=!0;try{const ge=c.id,xe=q.value||Math.abs(G-Number(c.amount))<.01,_e={payment_amount:xe?Number(c.amount):G,pay_in_full:xe,transaction_currency:c.currency,transaction_type:c.type,original_description:c.description,payment_date:v.value};await window.axios.patch(`/api/projects/${w.projectId}/transactions/${ge}/process-payment`,_e),await K(),se("Payment processed successfully!"),Ce()}catch(ge){((re=ge.response)==null?void 0:re.status)===422?Y.value=ge.response.data.errors:(n.value="Failed to process payment.",console.error("Error processing payment:",ge))}finally{s.value=!1}},ie=J(()=>!oe.value||Object.keys(oe.value).length===0?0:U.value.filter($=>$.type==="income").reduce(($,c)=>$+ye(parseFloat(c.amount||0),c.currency,h.value),0)),we=J(()=>!oe.value||Object.keys(oe.value).length===0?0:U.value.filter($=>$.type==="expense").reduce(($,c)=>$+ye(parseFloat(c.amount||0),c.currency,h.value),0)),je=J(()=>!oe.value||Object.keys(oe.value).length===0?0:U.value.filter($=>$.type==="bonus").reduce(($,c)=>$+ye(parseFloat(c.amount||0),c.currency,h.value),0)),We=J(()=>ee(ie.value,h.value)),Je=J(()=>ee(we.value,h.value)),Xe=J(()=>ee(je.value,h.value)),Qe=J(()=>{if(!oe.value||Object.keys(oe.value).length===0)return ee(0,h.value);const $=we.value+je.value;return ee(ie.value-$,h.value)}),Ze=J(()=>ie.value===0?"0.00%":`${(we.value/ie.value*100).toFixed(2)}%`),et=J(()=>ie.value===0?"0.00%":`${((we.value+je.value)/ie.value*100).toFixed(2)}%`),tt=J(()=>{if(ie.value<=0)return ee(0,h.value);const $=ie.value*ze;return ee($,h.value)}),at=J(()=>{const $=U.value.filter(G=>(G.type==="expense"||G.type==="bonus")&&G.is_paid&&G.payment_date);if($.length===0)return"N/A";const c=$.reduce((G,re)=>new Date(re.payment_date)>new Date(G.payment_date)?re:G);return new Date(c.payment_date).toLocaleDateString()}),st=J(()=>{const $=U.value.filter(G=>G.type==="income"&&G.payment_date);if($.length===0)return"N/A";const c=$.reduce((G,re)=>new Date(re.payment_date)>new Date(G.payment_date)?re:G);return new Date(c.payment_date).toLocaleDateString()});return me(async()=>{const $=localStorage.getItem("displayCurrency");$&&(h.value=$),await Se(),K(),z(),B()}),ne([()=>w.projectId,h,oe],()=>{w.projectId&&oe.value&&Object.keys(oe.value).length>0&&(K(),z())},{deep:!0}),ne(h,$=>{$&&localStorage.setItem("displayCurrency",$)},{deep:!0}),($,c)=>{var G,re,ge,xe,_e,Ie,De,Ue;return o(),r("div",gl,[n.value?(o(),r("div",yl,S(n.value),1)):x("",!0),P(g)||P(_)?(o(),r("div",fl,[e("div",bl,[e("div",wl,[c[14]||(c[14]=e("span",{class:"text-sm font-medium text-gray-700 mr-2"},"Currency:",-1)),l(Z,{id:"transactions-display-currency-switcher",modelValue:P(h),"onUpdate:modelValue":c[0]||(c[0]=C=>Ke(h)?h.value=C:null),options:F,"value-key":"value","label-key":"label",class:"w-24"},null,8,["modelValue"])]),c[25]||(c[25]=e("h4",{class:"text-md font-medium text-gray-700 mb-2"},"Summary",-1)),e("div",xl,[e("div",hl,[c[15]||(c[15]=e("p",{class:"text-sm text-gray-600"},"Total Income",-1)),e("p",jl,S(We.value),1)]),e("div",{class:"p-3 bg-indigo-100 rounded-md cursor-pointer",onClick:c[3]||(c[3]=C=>b.value=!0)},[e("div",_l,[c[17]||(c[17]=e("p",{class:"text-sm text-gray-600"},"Expendable Budget",-1)),b.value?(o(),r("button",{key:0,onClick:ke(V,["stop"]),class:"text-indigo-700 hover:text-indigo-900",title:"Save"},c[16]||(c[16]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-7.25 7.25a1 1 0 01-1.414 0l-3-3a1 1 0 111.414-1.414l2.293 2.293 6.543-6.543a1 1 0 011.414 0z","clip-rule":"evenodd"})],-1)]))):x("",!0)]),b.value?(o(),r("div",Sl,[e("div",null,[l(A,{for:"expendable_amount",value:"Amount"}),l(H,{id:"expendable_amount",type:"number",modelValue:m.value,"onUpdate:modelValue":c[1]||(c[1]=C=>m.value=C),class:"mt-1 block w-full"},null,8,["modelValue"]),l(N,{message:(G=L.value.amount)==null?void 0:G[0],class:"mt-1"},null,8,["message"])]),e("div",null,[l(A,{for:"expendable_currency",value:"Currency"}),l(Z,{id:"expendable_currency",modelValue:f.value,"onUpdate:modelValue":c[2]||(c[2]=C=>f.value=C),options:F,"value-key":"value","label-key":"label",class:"mt-1 block w-full"},null,8,["modelValue"])])])):(o(),r("div",kl,[e("p",Pl,S(m.value!==null?P(ee)(Number(m.value),f.value):"Not set"),1),m.value!==null&&f.value.toUpperCase()!==P(h).toUpperCase()?(o(),r("p",$l," ("+S(P(ee)(P(ye)(Number(m.value),f.value,P(h)),P(h)))+") ",1)):x("",!0)]))]),e("div",Vl,[c[18]||(c[18]=e("p",{class:"text-sm text-gray-600"},"Total Expenses",-1)),e("p",Cl,S(Je.value),1),e("p",Il,"("+S(Ze.value)+" of Income)",1)]),e("div",Dl,[c[19]||(c[19]=e("p",{class:"text-sm text-gray-600"},"Total Bonuses",-1)),e("p",Ul,S(Xe.value),1)]),e("div",Ml,[c[20]||(c[20]=e("p",{class:"text-sm text-gray-600"},"Balance",-1)),e("p",Al,S(Qe.value),1)]),e("div",Nl,[c[21]||(c[21]=e("p",{class:"text-sm text-gray-600"},"Expense + Bonus",-1)),e("p",Tl,S(P(ee)(we.value+je.value,P(h))),1),e("p",Bl,"("+S(et.value)+" of Income)",1)]),e("div",Rl,[c[22]||(c[22]=e("p",{class:"text-sm font-medium text-orange-800"},"Estimated Income Tax (AUD)",-1)),e("p",El,S(tt.value),1),e("p",Ol," (Based on "+S((ze*100).toFixed(1))+"% of Total Income. This is an estimation.) ",1)]),e("div",Fl,[c[23]||(c[23]=e("p",{class:"text-sm font-medium text-gray-800"},"Last Payment Received Date",-1)),e("p",Ll,S(st.value),1)]),e("div",zl,[c[24]||(c[24]=e("p",{class:"text-sm font-medium text-gray-800"},"Last Payment Sent Date",-1)),e("p",ql,S(at.value),1)])])]),c[26]||(c[26]=e("h4",{class:"text-md font-medium text-gray-700 mb-4"},"Add Transaction",-1)),e("div",Kl,[e("div",null,[l(A,{for:"description",value:"Description"}),l(H,{id:"description",modelValue:d.value.description,"onUpdate:modelValue":c[4]||(c[4]=C=>d.value.description=C),class:"mt-1 block w-full",disabled:s.value},null,8,["modelValue","disabled"]),l(N,{message:(re=y.value.description)==null?void 0:re[0],class:"mt-2"},null,8,["message"])]),e("div",null,[l(A,{for:"amount",value:"Amount"}),l(H,{id:"amount",type:"number",modelValue:d.value.amount,"onUpdate:modelValue":c[5]||(c[5]=C=>d.value.amount=C),class:"mt-1 block w-full",disabled:s.value},null,8,["modelValue","disabled"]),l(N,{message:(ge=y.value.amount)==null?void 0:ge[0],class:"mt-2"},null,8,["message"])]),e("div",null,[l(A,{for:"currency",value:"Currency"}),l(Z,{id:"currency",modelValue:d.value.currency,"onUpdate:modelValue":c[6]||(c[6]=C=>d.value.currency=C),options:F,disabled:s.value},null,8,["modelValue","disabled"]),l(N,{message:(xe=y.value.currency)==null?void 0:xe[0],class:"mt-2"},null,8,["message"])]),e("div",null,[l(A,{for:"type",value:"Type"}),l(Z,{id:"type",modelValue:d.value.type,"onUpdate:modelValue":c[7]||(c[7]=C=>d.value.type=C),options:p,disabled:s.value||!P(g)&&d.value.type==="expense"&&d.value.type!=="bonus"||!P(_)&&d.value.type==="income"},null,8,["modelValue","disabled"]),l(N,{message:(_e=y.value.type)==null?void 0:_e[0],class:"mt-2"},null,8,["message"])]),e("div",null,[l(pl,{modelValue:d.value.transaction_type,"onUpdate:modelValue":c[8]||(c[8]=C=>d.value.transaction_type=C),label:"Transaction Type",placeholder:"Select or add a transaction type",disabled:s.value,required:!0,"search-url":"/api/transaction-types/search"},null,8,["modelValue","disabled"]),l(N,{message:(Ie=y.value.transaction_type_id)==null?void 0:Ie[0],class:"mt-2"},null,8,["message"])]),d.value.type==="expense"||d.value.type==="bonus"?(o(),r("div",Hl,[l(A,{for:"user_id",value:"User"}),l(Z,{id:"user_id",modelValue:d.value.user_id,"onUpdate:modelValue":c[9]||(c[9]=C=>d.value.user_id=C),options:u.value,disabled:s.value||!I.value.length,placeholder:"Select a user"},null,8,["modelValue","options","disabled"]),l(N,{message:(De=y.value.user_id)==null?void 0:De[0],class:"mt-2"},null,8,["message"])])):x("",!0),d.value.type==="expense"||d.value.type==="bonus"?(o(),r("div",Gl,[l(A,{for:"hours_spent",value:"Hours Spent (Optional)"}),l(H,{id:"hours_spent",type:"number",modelValue:d.value.hours_spent,"onUpdate:modelValue":c[10]||(c[10]=C=>d.value.hours_spent=C),class:"mt-1 block w-full",disabled:s.value},null,8,["modelValue","disabled"]),l(N,{message:(Ue=y.value.hours_spent)==null?void 0:Ue[0],class:"mt-2"},null,8,["message"])])):x("",!0)]),e("div",Yl,[l(le,{onClick:te,disabled:s.value},{default:W(()=>[R(S(s.value?"Saving...":"Save Transaction"),1)]),_:1},8,["disabled"])])])):x("",!0),P(D)?(o(),r("div",Wl,[c[30]||(c[30]=e("h4",{class:"text-md font-medium text-gray-700 mb-4"},"Transaction History",-1)),s.value?(o(),r("div",Jl,c[27]||(c[27]=[e("div",{class:"h-4 bg-gray-200 rounded animate-pulse w-full"},null,-1),e("div",{class:"h-4 bg-gray-200 rounded animate-pulse w-5/6"},null,-1),e("div",{class:"h-4 bg-gray-200 rounded animate-pulse w-3/4"},null,-1)]))):U.value.length===0?(o(),r("div",Xl," No transactions found for this project. ")):(o(),r("div",Ql,[(o(!0),r(ue,null,ce(U.value,(C,Me)=>{var Ae,Ne,Te,Be;return o(),r("div",{key:C.id,class:Q([{"bg-green-50 border-green-200":C.type==="income","bg-red-50 border-red-200":C.type==="expense","bg-purple-50 border-purple-200":C.type==="bonus","border-l-4":!0},"p-4 rounded-md shadow-sm transition-all duration-200 ease-in-out hover:shadow-md"])},[e("div",Zl,[e("div",eo,[e("p",to,S(C.description),1),e("p",ao,[R(S(C.type==="income"?"Income":C.type==="expense"?"Expense":"Bonus")+" on "+S(new Date(C.created_at).toLocaleDateString())+" ",1),C.transaction_type&&C.transaction_type.name?(o(),r("span",so," Type: "+S(C.transaction_type.name),1)):x("",!0)])]),e("div",lo,[e("p",{class:Q(["text-lg font-bold",{"text-green-700":C.type==="income","text-red-700":C.type==="expense","text-purple-700":C.type==="bonus"}])},S(P(ee)(C.amount,C.currency)),3),C.currency.toUpperCase()!==P(h).toUpperCase()?(o(),r("p",oo," ("+S(P(ee)(P(ye)(C.amount,C.currency,P(h)),P(h)))+") ",1)):x("",!0),e("span",{class:Q(["block text-xs mt-1",C.is_paid?"text-green-600":"text-red-600"])},S(C.is_paid?"Paid":"Unpaid"),3)])]),e("div",no,[e("div",null,[C.user_id?(o(),r("span",ro,"User: "+S(((Ae=C.user)==null?void 0:Ae.name)||((Ne=I.value.find(pe=>pe.id===C.user_id))==null?void 0:Ne.name)||"Unknown"),1)):x("",!0),C.hours_spent?(o(),r("span",io,"Hours: "+S(C.hours_spent),1)):x("",!0),(C.type==="expense"||C.type==="bonus")&&ie.value>0?(o(),r("span",uo,S((P(ye)(C.amount,C.currency,P(h))/ie.value*100).toFixed(2))+"% of Income ",1)):x("",!0)]),e("div",co,[!C.is_paid&&(P(g)||P(_))?(o(),ae(fe,{key:0,onClick:pe=>Ge(Me),class:Q({"text-green-600":C.type!=="income","text-blue-600":C.type==="income"})},{default:W(()=>[R(S(C.type==="income"?"Receive":"Pay"),1)]),_:2},1032,["onClick","class"])):x("",!0),P(g)||P(_)?(o(),ae(fe,{key:1,onClick:pe=>ve(Me),class:"text-red-600"},{default:W(()=>c[28]||(c[28]=[R(" Delete ",-1)])),_:2,__:[28]},1032,["onClick"])):x("",!0)])]),i.value===C.id?(o(),r("div",mo,[e("h4",vo,S(C.type==="income"?"Record Receipt":"Make Payment"),1),e("div",po,[l(A,{for:"payment_date",value:"Date"}),l(H,{id:"payment_date",type:"date",modelValue:v.value,"onUpdate:modelValue":c[11]||(c[11]=pe=>v.value=pe),class:"mt-1 block w-full",disabled:s.value},null,8,["modelValue","disabled"]),l(N,{message:(Te=Y.value.date)==null?void 0:Te[0],class:"mt-2"},null,8,["message"])]),e("div",go,[e("label",yo,[he(e("input",{type:"checkbox","onUpdate:modelValue":c[12]||(c[12]=pe=>q.value=pe),class:"mr-2 rounded text-blue-600 focus:ring-blue-500",disabled:s.value},null,8,fo),[[rt,q.value]]),e("span",bo,S(C.type==="income"?"Receive in Full":"Pay in Full"),1)])]),q.value?x("",!0):(o(),r("div",wo,[l(A,{for:"payment_amount",value:"Amount"}),l(H,{id:"payment_amount",type:"number",modelValue:T.value,"onUpdate:modelValue":c[13]||(c[13]=pe=>T.value=pe),class:"mt-1 block w-full",disabled:s.value,placeholder:"Enter partial "+(C.type==="income"?"receipt":"payment")+" amount (Max: "+P(ee)(C.amount,C.currency)+")"},null,8,["modelValue","disabled","placeholder"]),l(N,{message:(Be=Y.value.amount)==null?void 0:Be[0],class:"mt-2"},null,8,["message"])])),e("div",xo,[l(fe,{onClick:Ce,disabled:s.value},{default:W(()=>c[29]||(c[29]=[R(" Cancel ",-1)])),_:1,__:[29]},8,["disabled"]),l(le,{onClick:Ye,disabled:s.value},{default:W(()=>[R(S(s.value?"Processing...":C.type==="income"?"Record Receipt":"Submit Payment"),1)]),_:2},1032,["disabled"])])])):x("",!0)],2)}),128))]))])):x("",!0)])}}},jo={class:"mb-6 p-4 bg-indigo-50 rounded-lg border border-indigo-100 flex items-center justify-between gap-4"},_o={class:"text-2xl font-semibold text-indigo-800"},ko={class:"w-48"},Po={key:0,class:"mb-6 p-4 border rounded-lg"},$o={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},So={class:"flex items-end"},Vo={class:"md:col-span-4"},Co={class:"space-y-3"},Io={key:0,class:"text-gray-500"},Do={key:1,class:"text-gray-500"},Uo={class:"font-medium"},Mo={key:0,class:"text-sm text-gray-600"},Ao={class:"text-sm text-gray-700 mt-1"},No={key:0,class:"text-gray-500"},To={class:"flex items-center gap-3"},Bo={__name:"ProjectExpendables",props:{projectId:{type:[Number,String],required:!0},userProjectRole:{type:Object,default:()=>({})}},setup(t){const w=t,{canView:a,canManage:j}=Ve(()=>w.projectId),g=a("project_expendable",w.userProjectRole),_=j("project_expendable",w.userProjectRole),D=k([]),U=k(!1),I=k({name:"",description:"",amount:"",currency:"PKR",status:"active"}),y=k({}),n=k(!1),s=[{value:"PKR",label:"PKR"},{value:"USD",label:"USD"},{value:"EUR",label:"EUR"},{value:"GBP",label:"GBP"},{value:"AUD",label:"AUD"},{value:"INR",label:"INR"}],i=He,T=J(()=>!oe.value||Object.keys(oe.value).length===0?0:D.value.reduce((v,d)=>v+ye(Number(d.amount||0),d.currency,i.value),0));async function q(){if(g.value){U.value=!0;try{const{data:v}=await window.axios.get(`/api/projects/${w.projectId}/expendables`);D.value=v||[]}catch(v){console.error(v)}finally{U.value=!1}}}async function Y(){var v,d,h;y.value={},n.value=!0;try{const F={...I.value,amount:Number(I.value.amount)},{data:m}=await window.axios.post(`/api/projects/${w.projectId}/expendables`,F);D.value.unshift(m),I.value={name:"",description:"",amount:"",currency:I.value.currency,status:"active"},se("Expendable created")}catch(F){((v=F.response)==null?void 0:v.status)===422?y.value=F.response.data.errors||{}:(h=(d=F.response)==null?void 0:d.data)!=null&&h.message?O(F.response.data.message):O("Failed to create expendable")}finally{n.value=!1}}async function E(v){if(confirm("Delete this expendable?"))try{await window.axios.delete(`/api/projects/${w.projectId}/expendables/${v.id}`),D.value=D.value.filter(d=>d.id!==v.id),se("Deleted")}catch(d){O("Failed to delete"),console.error(d)}}return me(async()=>{const v=localStorage.getItem("displayCurrency");v&&(i.value=v),await Se(),await q()}),ne(i,v=>{v&&localStorage.setItem("displayCurrency",v)}),(v,d)=>{var h,F,m,f;return o(),r("div",null,[e("div",jo,[e("div",null,[d[5]||(d[5]=e("div",{class:"text-sm text-gray-600"},"Total Expendables",-1)),e("div",_o,S(P(ee)(T.value,P(i))),1)]),e("div",ko,[l(A,{for:"display_currency",value:"Display Currency"}),l(Z,{id:"display_currency",modelValue:P(i),"onUpdate:modelValue":d[0]||(d[0]=b=>Ke(i)?i.value=b:null),options:s,"value-key":"value","label-key":"label",class:"mt-1 w-full"},null,8,["modelValue"])])]),P(_)?(o(),r("div",Po,[e("div",$o,[e("div",null,[l(A,{for:"name",value:"Name"}),l(H,{id:"name",modelValue:I.value.name,"onUpdate:modelValue":d[1]||(d[1]=b=>I.value.name=b),class:"mt-1 w-full",placeholder:"e.g., Asset Purchase"},null,8,["modelValue"]),l(N,{message:(h=y.value.name)==null?void 0:h[0],class:"mt-1"},null,8,["message"])]),e("div",null,[l(A,{for:"amount",value:"Amount"}),l(H,{id:"amount",type:"number",step:"0.01",modelValue:I.value.amount,"onUpdate:modelValue":d[2]||(d[2]=b=>I.value.amount=b),class:"mt-1 w-full"},null,8,["modelValue"]),l(N,{message:(F=y.value.amount)==null?void 0:F[0],class:"mt-1"},null,8,["message"])]),e("div",null,[l(A,{for:"currency",value:"Currency"}),l(Z,{id:"currency",modelValue:I.value.currency,"onUpdate:modelValue":d[3]||(d[3]=b=>I.value.currency=b),options:s,"value-key":"value","label-key":"label",class:"mt-1 w-full"},null,8,["modelValue"]),l(N,{message:(m=y.value.currency)==null?void 0:m[0],class:"mt-1"},null,8,["message"])]),e("div",So,[l(le,{disabled:n.value,onClick:Y},{default:W(()=>d[6]||(d[6]=[R("Add",-1)])),_:1,__:[6]},8,["disabled"])]),e("div",Vo,[l(A,{for:"description",value:"Description (optional)"}),l(H,{id:"description",modelValue:I.value.description,"onUpdate:modelValue":d[4]||(d[4]=b=>I.value.description=b),class:"mt-1 w-full",placeholder:"Details"},null,8,["modelValue"]),l(N,{message:(f=y.value.description)==null?void 0:f[0],class:"mt-1"},null,8,["message"])])])])):x("",!0),e("div",Co,[U.value?(o(),r("div",Io,"Loading...")):D.value.length?x("",!0):(o(),r("div",Do,"No expendables yet.")),(o(!0),r(ue,null,ce(D.value,b=>(o(),r("div",{key:b.id,class:"p-4 border rounded-lg flex items-center justify-between"},[e("div",null,[e("div",Uo,S(b.name),1),b.description?(o(),r("div",Mo,S(b.description),1)):x("",!0),e("div",Ao,[R(S(P(ee)(Number(b.amount),b.currency))+" ",1),b.currency&&b.currency.toUpperCase()!==P(i).toUpperCase()?(o(),r("span",No," ("+S(P(ee)(P(ye)(Number(b.amount),b.currency,P(i)),P(i)))+") ",1)):x("",!0)])]),e("div",To,[e("span",{class:Q(["text-xs px-2 py-1 rounded-full",b.status==="active"?"bg-green-100 text-green-700":"bg-gray-100 text-gray-700"])},S(b.status||"active"),3),P(_)?(o(),ae(fe,{key:0,onClick:L=>E(b),class:"!text-red-600"},{default:W(()=>d[7]||(d[7]=[R("Delete",-1)])),_:2,__:[7]},1032,["onClick"])):x("",!0)])]))),128))])])}}},Ro={class:"p-6 w-full mx-auto bg-white rounded-xl shadow-2xl transition-all duration-300"},Eo={class:"border-b border-gray-200 mb-6"},Oo={class:"flex -mb-px space-x-4 overflow-x-auto pb-2"},Fo={class:"py-4"},ln={__name:"ProjectForm",props:{projectId:{type:[Number,String],default:null},statusOptions:{type:Array,required:!0},departmentOptions:{type:Array,required:!0},sourceOptions:{type:Array,required:!0},clientRoleOptions:{type:Array,default:()=>[]},userRoleOptions:{type:Array,default:()=>[]},paymentTypeOptions:{type:Array,required:!0},errors:{type:Object,default:()=>({})},isSaving:{type:Boolean,default:!1}},emits:["close"],setup(t,{emit:w}){it();const a=t,j=k(a.projectId);ne(()=>a.projectId,te=>{j.value=te,te&&dt(te)},{immediate:!0}),ut(j);const g=ct(j),{canDo:_,canView:D,canManage:U}=Ve(j),I=_("manage_projects",g);_("create_clients",g);const y=_("upload_project_documents",g),n=U("project_services_and_payments",g),s=_("add_project_notes",g),i=U("project_users",g),T=U("project_clients",g),q=_("manage_project_basic_details",g),Y=D("project_documents",g),E=D("project_services_and_payments",g),v=D("project_notes",g),d=D("project_users",g),h=D("project_clients",g),F=D("project_transactions",g),m=D("project_expendable",g),f=U("project_expendable",g),b=D("project_deliverables"),L=U("project_deliverables"),B=k("basic"),V=J(()=>h.value&&d.value?"Clients and Users":h.value?"Clients":d.value?"Users":"Clients and Users"),p=k([]),u=k([]),M=k([]),z=k([]),K=te=>{if(te!=="basic"&&!a.projectId){mt("Please create the project first before managing this section."),B.value="basic";return}B.value=te};return me(async()=>{try{p.value=await Fe("client"),u.value=await Fe("project"),M.value=await Pt(!0,null),z.value=await $t(!0,null)}catch(te){console.error("Error fetching global data for ProjectForm:",te)}}),(te,X)=>(o(),r("div",Ro,[X[8]||(X[8]=e("div",{class:"flex justify-between items-center pb-4 mb-6 border-b border-gray-200"},[e("h2",{class:"text-2xl font-semibold text-gray-800"},"Edit Project")],-1)),e("div",Eo,[e("nav",Oo,[e("button",{onClick:X[0]||(X[0]=ve=>K("basic")),class:Q(["py-3 px-5 text-center border-b-2 font-medium text-base rounded-t-lg transition-colors duration-200 whitespace-nowrap",B.value==="basic"?"border-indigo-600 text-indigo-700 bg-indigo-50":"border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300 hover:bg-gray-50"])}," Basic Information ",2),t.projectId&&(P(h)||P(d))?(o(),r("button",{key:0,onClick:X[1]||(X[1]=ve=>K("client")),class:Q(["py-3 px-5 text-center border-b-2 font-medium text-base rounded-t-lg transition-colors duration-200 whitespace-nowrap",B.value==="client"?"border-indigo-600 text-indigo-700 bg-indigo-50":"border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300 hover:bg-gray-50"])},S(V.value),3)):x("",!0),t.projectId&&(P(n)||P(E))?(o(),r("button",{key:1,onClick:X[2]||(X[2]=ve=>K("services")),class:Q(["py-3 px-5 text-center border-b-2 font-medium text-base rounded-t-lg transition-colors duration-200 whitespace-nowrap",B.value==="services"?"border-indigo-600 text-indigo-700 bg-indigo-50":"border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300 hover:bg-gray-50"])}," Services & Payment ",2)):x("",!0),t.projectId&&P(F)?(o(),r("button",{key:2,onClick:X[3]||(X[3]=ve=>K("transactions")),class:Q(["py-3 px-5 text-center border-b-2 font-medium text-base rounded-t-lg transition-colors duration-200 whitespace-nowrap",B.value==="transactions"?"border-indigo-600 text-indigo-700 bg-indigo-50":"border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300 hover:bg-gray-50"])}," Transactions ",2)):x("",!0),t.projectId&&(P(f)||P(m))?(o(),r("button",{key:3,onClick:X[4]||(X[4]=ve=>K("expendables")),class:Q(["py-3 px-5 text-center border-b-2 font-medium text-base rounded-t-lg transition-colors duration-200 whitespace-nowrap",B.value==="expendables"?"border-indigo-600 text-indigo-700 bg-indigo-50":"border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300 hover:bg-gray-50"])}," Expendables ",2)):x("",!0),t.projectId&&P(Y)?(o(),r("button",{key:4,onClick:X[5]||(X[5]=ve=>K("documents")),class:Q(["py-3 px-5 text-center border-b-2 font-medium text-base rounded-t-lg transition-colors duration-200 whitespace-nowrap",B.value==="documents"?"border-indigo-600 text-indigo-700 bg-indigo-50":"border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300 hover:bg-gray-50"])}," Documents ",2)):x("",!0),t.projectId&&(P(s)||P(v))?(o(),r("button",{key:5,onClick:X[6]||(X[6]=ve=>K("notes")),class:Q(["py-3 px-5 text-center border-b-2 font-medium text-base rounded-t-lg transition-colors duration-200 whitespace-nowrap",B.value==="notes"?"border-indigo-600 text-indigo-700 bg-indigo-50":"border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300 hover:bg-gray-50"])}," Notes ",2)):x("",!0),t.projectId&&(P(L)||P(b))?(o(),r("button",{key:6,onClick:X[7]||(X[7]=ve=>K("deliverables")),class:Q(["py-3 px-5 text-center border-b-2 font-medium text-base rounded-t-lg transition-colors duration-200 whitespace-nowrap",B.value==="deliverables"?"border-indigo-600 text-indigo-700 bg-indigo-50":"border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300 hover:bg-gray-50"])}," Deliverables ",2)):x("",!0)])]),e("div",Fo,[B.value==="basic"?(o(),ae(Kt,{key:0,projectId:t.projectId,errors:a.errors,statusOptions:t.statusOptions,sourceOptions:t.sourceOptions,canManageProjects:P(I),canManageProjectBasicDetails:P(q),isSaving:a.isSaving},null,8,["projectId","errors","statusOptions","sourceOptions","canManageProjects","canManageProjectBasicDetails","isSaving"])):x("",!0),B.value==="client"?(o(),ae(ja,{key:1,projectId:t.projectId,errors:a.errors,clientRoleOptions:p.value,userRoleOptions:u.value,clients:M.value,users:z.value,canViewProjectClients:P(h),canManageProjectClients:P(T),canViewProjectUsers:P(d),canManageProjectUsers:P(i),isSaving:a.isSaving},null,8,["projectId","errors","clientRoleOptions","userRoleOptions","clients","users","canViewProjectClients","canManageProjectClients","canViewProjectUsers","canManageProjectUsers","isSaving"])):x("",!0),B.value==="services"?(o(),ae(nl,{key:2,projectId:t.projectId,departmentOptions:t.departmentOptions,paymentTypeOptions:t.paymentTypeOptions,canManageProjectServicesAndPayments:P(n),canViewProjectServicesAndPayments:P(E),isSaving:a.isSaving},null,8,["projectId","departmentOptions","paymentTypeOptions","canManageProjectServicesAndPayments","canViewProjectServicesAndPayments","isSaving"])):x("",!0),B.value==="expendables"?(o(),ae(Bo,{key:3,"project-id":t.projectId,"user-project-role":P(g)},null,8,["project-id","user-project-role"])):x("",!0),B.value==="transactions"&&P(F)?(o(),ae(ho,{key:4,projectId:t.projectId,userProjectRole:P(g),isSaving:a.isSaving},null,8,["projectId","userProjectRole","isSaving"])):x("",!0),B.value==="documents"?(o(),ae(Fa,{key:5,projectId:t.projectId,errors:a.errors,canUploadProjectDocuments:P(y),canViewProjectDocuments:P(Y),isSaving:a.isSaving},null,8,["projectId","errors","canUploadProjectDocuments","canViewProjectDocuments","isSaving"])):x("",!0),B.value==="notes"?(o(),ae(as,{key:6,projectId:t.projectId,errors:a.errors,canAddProjectNotes:P(s),canViewProjectNotes:P(v),"is-saving":a.isSaving},null,8,["projectId","errors","canAddProjectNotes","canViewProjectNotes","is-saving"])):x("",!0),B.value==="deliverables"?(o(),ae(hs,{key:7,projectId:t.projectId,errors:a.errors,canManageProjectDeliverables:P(L),canViewProjectDeliverables:P(b),isSaving:a.isSaving},null,8,["projectId","errors","canManageProjectDeliverables","canViewProjectDeliverables","isSaving"])):x("",!0)])]))}};export{ln as _};
