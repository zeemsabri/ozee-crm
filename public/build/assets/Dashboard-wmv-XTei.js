import{a as G,_ as R}from"./AuthenticatedLayout-AwCyMgOo.js";import{r as i,s as J,D as K,B as q,E as Q,i as s,g as U,o as a,b as e,e as w,m as g,t as r,a as E,n as V,x as C,G as Y,h as W,y as X,F as N,j as M,l as H}from"./app-B6zTH_qu.js";import{_ as Z}from"./NotesModal-k8xKUZjv.js";import{P as ee}from"./PrimaryButton-Cq4e6u-R.js";import"./ApplicationLogo-CqUXaeKK.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./SecondaryButton-VCs64EhH.js";import"./InputError-COqjK1Ow.js";import"./TextInput-Cuu_wzBu.js";const te={class:"flex"},se={class:"flex-shrink-0"},ae={key:0,class:"h-5 w-5 text-red-500",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},le={key:1,class:"h-5 w-5 text-indigo-500",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},oe={class:"ml-3 flex-1 md:flex md:justify-between"},ie={key:0,class:"text-sm text-indigo-700"},ne={key:1,class:"text-sm text-green-700"},re={key:2,class:"text-sm text-red-700 font-medium"},de={key:3,class:"text-sm text-green-700"},ue={class:"mt-3 text-sm md:mt-0 md:ml-6"},ce={__name:"AvailabilityPrompt",setup(F){const x=i(!1),k=i(!0),h=i([]),y=i(!1),b=i(""),m=i(!1),v=i(!1),p=i(null),d=i(!1),$=J(()=>{var o;return((o=K().props.auth.user)==null?void 0:o.id)||null}),T=()=>{const o=localStorage.getItem("authToken");o&&!C.defaults.headers.common.Authorization&&(C.defaults.headers.common.Authorization=`Bearer ${o}`,console.log("Auth headers set in AvailabilityPrompt"))},_=async()=>{k.value=!0,b.value="";try{T();const o=await C.get("/api/availability-prompt");x.value=o.data.should_show_prompt,m.value=o.data.should_block_user,v.value=o.data.all_weekdays_covered,p.value=o.data.current_day,d.value=o.data.is_thursday_to_saturday,x.value&&P(o.data.next_week_start,o.data.next_week_end),localStorage.setItem("shouldBlockUser",m.value),localStorage.setItem("allWeekdaysCovered",v.value);const c=new CustomEvent("availability-status-updated",{detail:{shouldBlockUser:m.value,allWeekdaysCovered:v.value}});window.dispatchEvent(c)}catch(o){console.error("Error checking availability prompt:",o),x.value=!1,o.response&&o.response.status===401&&(o.value="Authentication error. Please refresh the page or log in again.")}finally{k.value=!1}},P=(o,c)=>{const j=[],n=new Date(o),t=new Date(c),l=new Date(n);for(;l<=t;)j.push({value:l.toISOString().split("T")[0],label:l.toLocaleDateString("en-US",{weekday:"long",month:"short",day:"numeric"})}),l.setDate(l.getDate()+1);h.value=j},B=()=>{y.value=!0},I=()=>{_()},L=()=>{document.visibilityState==="visible"&&Y(()=>{_()})},z=o=>{(o.key==="shouldBlockUser"||o.key==="allWeekdaysCovered")&&Y(()=>{_()})};return q(()=>{_(),document.addEventListener("visibilitychange",L),window.addEventListener("storage",z)}),Q(()=>{document.removeEventListener("visibilitychange",L),window.removeEventListener("storage",z)}),(o,c)=>x.value&&!k.value?(a(),s("div",{key:0,class:V(["border-l-4 p-4 mb-6 rounded-md shadow-sm",m.value?"bg-red-50 border-red-500":"bg-indigo-50 border-indigo-500"])},[e("div",te,[e("div",se,[m.value?(a(),s("svg",ae,c[1]||(c[1]=[e("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"},null,-1)]))):(a(),s("svg",le,c[2]||(c[2]=[e("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z","clip-rule":"evenodd"},null,-1)])))]),e("div",oe,[p.value===4&&!v.value?(a(),s("p",ie," Please submit your availability for next week. This helps in planning meetings and work schedules. ")):p.value===4&&v.value?(a(),s("p",ne," Thank you for submitting your availability for next week! You can still update it if needed. ")):(p.value===5||p.value===6)&&!v.value?(a(),s("p",re,[c[3]||(c[3]=e("span",{class:"font-bold"},"Action Required:",-1)),g(" You must submit your availability for all weekdays of next week. "+r(m.value?"Other features are currently blocked until you complete this task.":""),1)])):(p.value===5||p.value===6)&&v.value?(a(),s("p",de," Thank you for submitting your availability for next week! You can still update it if needed. ")):U("",!0),e("p",ue,[w(ee,{onClick:B,class:V(["whitespace-nowrap",{"bg-red-600 hover:bg-red-700":m.value}])},{default:E(()=>[g(r(v.value?"Update Availability":"Submit Availability"),1)]),_:1},8,["class"])])])]),w(G,{show:y.value,"next-week-dates":h.value,date:h.value.length>0?h.value[0].value:"",userId:$.value,onClose:c[0]||(c[0]=j=>y.value=!1),onAvailabilitySaved:I},null,8,["show","next-week-dates","date","userId"])],2)):U("",!0)}},ve={class:"py-12"},pe={class:"mx-auto max-w-7xl sm:px-6 lg:px-8 space-y-6"},me={class:"overflow-hidden bg-white shadow-sm sm:rounded-lg"},xe={class:"p-6 text-gray-900"},he={class:"mt-1 text-sm text-gray-600"},ye={class:"font-medium"},ge={class:"mt-4"},_e={key:0,class:"text-sm text-gray-500"},fe={key:1,class:"text-sm text-red-500"},we={key:2,class:"text-sm text-gray-500"},ke={key:3,class:"mt-3"},be={class:"grid grid-cols-7 gap-2 mt-2"},De={key:0,class:"text-sm"},Se={key:1,class:"text-gray-400"},Ae={key:1,class:"text-sm text-gray-400"},Te={class:"overflow-hidden bg-white shadow-sm sm:rounded-lg"},Ce={class:"p-6 text-gray-900"},$e={class:"flex justify-between items-center"},je={class:"mt-1 text-sm text-gray-600"},Ne={class:"font-bold"},Ee={key:0,class:"mt-4"},Pe={key:0,class:"text-sm text-gray-500"},Be={key:1,class:"text-sm text-red-500"},Ie={key:2,class:"text-sm text-gray-500"},Le={key:3,class:"mt-3"},ze={class:"min-w-full divide-y divide-gray-200"},Me={class:"bg-white divide-y divide-gray-200"},Ue={class:"px-3 py-2 whitespace-nowrap text-sm"},We={class:"px-3 py-2 whitespace-nowrap text-sm capitalize"},Ve={class:"px-3 py-2 whitespace-nowrap text-sm"},Fe={class:"flex space-x-2"},Oe=["onClick"],Ye={class:"overflow-hidden bg-white shadow-sm sm:rounded-lg"},He={class:"p-6 text-gray-900"},qe={class:"flex justify-between items-center"},Ge={class:"mt-1 text-sm text-gray-600"},Re={class:"font-bold"},Je={key:0,class:"mt-4"},Ke={key:0,class:"text-sm text-gray-500"},Qe={key:1,class:"text-sm text-red-500"},Xe={key:2,class:"text-sm text-gray-500"},Ze={key:3,class:"mt-3"},et={class:"min-w-full divide-y divide-gray-200"},tt={class:"bg-white divide-y divide-gray-200"},st={class:"px-3 py-2 whitespace-nowrap text-sm"},at={class:"px-3 py-2 whitespace-nowrap text-sm"},lt={class:"px-3 py-2 whitespace-nowrap text-sm"},ot={class:"px-3 py-2 whitespace-nowrap text-sm"},it={class:"px-3 py-2 whitespace-nowrap text-sm"},nt={class:"flex space-x-2"},yt={__name:"Dashboard",props:{projectCount:Number},setup(F){const x=i([]),k=i(!0),h=i(""),y=i(!1),b=i({total_due_tasks:0,projects:[]}),m=i(!1),v=i(""),p=i(!1),d=i({availabilities:[],start_date:"",end_date:""}),$=i(!1),T=i(""),_=i(!1),P=i(null),B=async()=>{k.value=!0,h.value="";try{const n=await C.get("/api/projects-simplified");x.value=n.data}catch(n){h.value="Failed to load projects",console.error("Error fetching projects:",n)}finally{k.value=!1}},I=async()=>{m.value=!0,v.value="";try{const n=await C.get("/api/task-statistics");b.value=n.data}catch(n){v.value="Failed to load task statistics",console.error("Error fetching task statistics:",n)}finally{m.value=!1}},L=()=>{y.value=!y.value,y.value&&x.value.length===0&&B()},z=()=>{p.value=!p.value,p.value&&b.value.projects.length===0&&I()},o=n=>{P.value=n,_.value=!0},c=()=>{B()},j=async()=>{$.value=!0,T.value="";try{const n=new Date,t=new Date(n);t.setDate(n.getDate()-n.getDay()+(n.getDay()===0?-6:1));const l=new Date(t);l.setDate(t.getDate()+6);const u=S=>S.toISOString().split("T")[0],D=await C.get("/api/availabilities",{params:{start_date:u(t),end_date:u(l)}});d.value=D.data}catch(n){T.value="Failed to load availability data",console.error("Error fetching weekly availability:",n)}finally{$.value=!1}};return q(()=>{I(),j()}),(n,t)=>(a(),s(N,null,[w(W(X),{title:"Dashboard"}),w(R,null,{header:E(()=>t[1]||(t[1]=[e("h2",{class:"text-xl font-semibold leading-tight text-gray-800"}," Dashboard ",-1)])),default:E(()=>[e("div",ve,[e("div",pe,[w(ce),e("div",me,[e("div",xe,[t[3]||(t[3]=e("h3",{class:"text-lg font-medium text-gray-900"},"Your Weekly Availability",-1)),e("p",he,[t[2]||(t[2]=g(" Current week: ",-1)),e("span",ye,r(d.value.start_date?new Date(d.value.start_date).toLocaleDateString():"")+" to "+r(d.value.end_date?new Date(d.value.end_date).toLocaleDateString():""),1)]),e("div",ge,[$.value?(a(),s("div",_e,"Loading availability data...")):T.value?(a(),s("div",fe,r(T.value),1)):!d.value.availabilities||d.value.availabilities.length===0?(a(),s("div",we," No availability data found for this week. ")):(a(),s("div",ke,[e("div",be,[(a(),s(N,null,M(["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],l=>e("div",{key:l,class:"text-center text-xs font-medium text-gray-500"},r(l),1)),64)),(a(),s(N,null,M(7,l=>e("div",{key:"day-"+l,class:"h-10 border rounded-md flex items-center justify-center"},[d.value.start_date?(a(),s("div",De,[(()=>{const u=new Date(d.value.start_date);u.setDate(u.getDate()+l-1);const D=u.toISOString().split("T")[0];return d.value.availabilities.filter(S=>S.date.split("T")[0]===D).length>0})()?(a(),s("span",{key:0,class:V((()=>{const u=new Date(d.value.start_date);u.setDate(u.getDate()+l-1);const D=u.toISOString().split("T")[0];return d.value.availabilities.filter(A=>A.date.split("T")[0]===D).some(A=>!A.is_available)?"text-red-600":"text-green-600"})())},r((()=>{const u=new Date(d.value.start_date);u.setDate(u.getDate()+l-1);const D=u.toISOString().split("T")[0],S=d.value.availabilities.filter(f=>f.date.split("T")[0]===D);if(S.some(f=>!f.is_available))return"Unavailable";const A=[];return S.forEach(f=>{f.is_available&&f.time_slots&&Array.isArray(f.time_slots)&&f.time_slots.forEach(O=>{A.push(`${O.start_time} - ${O.end_time}`)})}),A.length>0?A.join(", "):"Available (No time slots)"})()),3)):(a(),s("span",Se,"-"))])):(a(),s("div",Ae,"-"))])),64))])]))])])]),e("div",Te,[e("div",Ce,[e("div",$e,[t[4]||(t[4]=e("h3",{class:"text-lg font-medium text-gray-900"},"Projects",-1)),e("button",{onClick:L,class:"text-sm text-blue-600 hover:text-blue-800"},r(y.value?"Collapse":"Expand"),1)]),e("p",je,[t[5]||(t[5]=g(" You have access to ",-1)),e("span",Ne,r(F.projectCount),1),t[6]||(t[6]=g(" project(s). ",-1))]),y.value?(a(),s("div",Ee,[k.value?(a(),s("div",Pe,"Loading projects...")):h.value?(a(),s("div",Be,r(h.value),1)):x.value.length===0?(a(),s("div",Ie,"No projects found.")):(a(),s("div",Le,[e("table",ze,[t[8]||(t[8]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{scope:"col",class:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Name"),e("th",{scope:"col",class:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Status"),e("th",{scope:"col",class:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Actions")])],-1)),e("tbody",Me,[(a(!0),s(N,null,M(x.value,l=>(a(),s("tr",{key:l.id},[e("td",Ue,r(l.name),1),e("td",We,r(l.status.replace("_"," ")),1),e("td",Ve,[e("div",Fe,[w(W(H),{href:`/projects/${l.id}`,class:"text-xs bg-blue-500 hover:bg-blue-700 text-white py-1 px-2 rounded"},{default:E(()=>t[7]||(t[7]=[g(" View ",-1)])),_:2,__:[7]},1032,["href"]),e("button",{onClick:u=>o(l.id),class:"text-xs bg-purple-500 hover:bg-purple-700 text-white py-1 px-2 rounded"}," Notes ",8,Oe)])])]))),128))])])]))])):U("",!0)])]),e("div",Ye,[e("div",He,[e("div",qe,[t[9]||(t[9]=e("h3",{class:"text-lg font-medium text-gray-900"},"Due Tasks",-1)),e("button",{onClick:z,class:"text-sm text-blue-600 hover:text-blue-800"},r(p.value?"Collapse":"Expand"),1)]),e("p",Ge,[t[10]||(t[10]=g(" You have ",-1)),e("span",Re,r(b.value.total_due_tasks),1),t[11]||(t[11]=g(" task(s) due. ",-1))]),p.value?(a(),s("div",Je,[m.value?(a(),s("div",Ke,"Loading tasks...")):v.value?(a(),s("div",Qe,r(v.value),1)):b.value.projects.length===0?(a(),s("div",Xe,"No due tasks found.")):(a(),s("div",Ze,[e("table",et,[t[13]||(t[13]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{scope:"col",class:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Project Name"),e("th",{scope:"col",class:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Due Tasks"),e("th",{scope:"col",class:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Due Today"),e("th",{scope:"col",class:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Assigned Me"),e("th",{scope:"col",class:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Actions")])],-1)),e("tbody",tt,[(a(!0),s(N,null,M(b.value.projects,l=>(a(),s("tr",{key:l.id},[e("td",st,r(l.name),1),e("td",at,r(l.due_tasks),1),e("td",lt,r(l.due_today),1),e("td",ot,r(l.assigned_to_me),1),e("td",it,[e("div",nt,[w(W(H),{href:`/projects/${l.id}`,class:"text-xs bg-blue-500 hover:bg-blue-700 text-white py-1 px-2 rounded"},{default:E(()=>t[12]||(t[12]=[g(" View ",-1)])),_:2,__:[12]},1032,["href"])])])]))),128))])])]))])):U("",!0)])]),t[14]||(t[14]=e("div",{class:"overflow-hidden bg-white shadow-sm sm:rounded-lg"},[e("div",{class:"p-6 text-gray-900"},[e("h3",{class:"text-lg font-medium text-gray-900"},"Notice Board"),e("p",{class:"mt-1 text-sm text-gray-600"}," No new announcements at this time. ")])],-1))])]),w(Z,{show:_.value,"project-id":P.value,onClose:t[0]||(t[0]=l=>_.value=!1),onNoteAdded:c},null,8,["show","project-id"])]),_:1})],64))}};export{yt as default};
