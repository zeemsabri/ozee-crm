import A from"./TriggerStep-H0MxtTlG.js";import D from"./ConditionStep-DUrQOvOh.js";import F from"./ActionStep-DBqxmWU4.js";import $ from"./AIStep-k7hWyCJS.js";import H from"./ForEachStep-C5pxxMmR.js";import U from"./FetchRecordsStep-Cty1Iqi0.js";import B from"./ScheduleTriggerStep-1AxAP1lL.js";import E from"./AddStepButton-CTw1uj0o.js";import{u as L}from"./workflowStore-I6WPJ2Rv.js";import M from"./TransformStep-Dyk2PZri.js";import{c as P,B as G,a,o as m,F as S,b as p,d as u,l as W,g as j,i as b,a8 as V}from"./app-D5B69b4J.js";import"./StepCard-CBdjvWs8.js";import"./trash-r1IWcce2.js";import"./createLucideIcon-DCxCwdB4.js";import"./SelectDropdown-CtafRPQ5.js";/* empty css                                                                       */import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./RelationshipPathPicker-DafsWgNy.js";import"./plus-HLNAaRrX.js";import"./DataTokenInserter-D0K6X0H-.js";import"./RelatedDataPicker-C1Vk1ZsT.js";import"./BaseFormModal-DOLJF0-I.js";import"./Modal-jF22Pxn9.js";import"./PrimaryButton-C-MexO47.js";import"./SecondaryButton-DAJ6dG_n.js";import"./PromptForm-CgAH8AIm.js";import"./ResponseBuilder-BU74XvHb.js";import"./FieldBuilder-DaDqZWFo.js";import"./chevron-down-Bx-8jXxC.js";import"./circle-x-BnBlfNKw.js";const q={class:"flex flex-col items-center w-full space-y-4"},Y={key:0,class:"text-center p-8 border-2 border-dashed rounded-lg w-full max-w-md"},z={class:"flex justify-center"},J={class:"w-full flex flex-col items-center"},K={key:1,class:"w-full flex mt-4 space-x-4"},Q={class:"flex-1 bg-green-50/50 p-4 rounded-lg border border-green-200"},X={class:"flex-1 bg-red-50/50 p-4 rounded-lg border border-red-200"},Z={key:2,class:"w-full mt-4 p-4 rounded-lg border border-purple-300 bg-purple-50/50"},vt={__name:"Workflow",props:{steps:{type:Array,required:!0},fullContextSteps:{type:Array,default:()=>[]},loopContextSchema:{type:Object,default:null},allowTrigger:{type:Boolean,default:!0}},emits:["update:steps","add-trigger"],setup(l,{emit:T}){const R=L(),I=P(()=>R.automationSchema||[]),f=l,C=T,k={TRIGGER:A,SCHEDULE_TRIGGER:B,FETCH_RECORDS:U,CONDITION:D,ACTION:F,AI_PROMPT:$,FOR_EACH:H,TRANSFORM_CONTENT:M},y=r=>k[r]||null;function N(r){var c,_,w,O;const t=(c=r.step_config)==null?void 0:c.sourceArray;if(!t)return null;const s=t.match(/{{step_(\w+)\.(.+)}}/);if(!s)return null;const e=s[1],n=s[2],o=f.fullContextSteps.find(i=>i.id==e);if((o==null?void 0:o.step_type)==="AI_PROMPT"){const i=(w=(_=o.step_config)==null?void 0:_.responseStructure)==null?void 0:w.find(x=>x.name===n);return(i==null?void 0:i.type)!=="Array of Objects"?null:{name:"Loop Item",columns:i.schema||[]}}if((o==null?void 0:o.step_type)==="FETCH_RECORDS"&&n==="records"){const i=(O=o.step_config)==null?void 0:O.model;if(!i)return null;const x=I.value.find(d=>d.name===i);return x?{name:"Loop Item",columns:(x.columns||[]).map(d=>typeof d=="string"?{name:d}:d)}:null}return null}function g(r,t){const s=[...f.steps];s[r]=t,C("update:steps",s)}function h(r,t){const s={id:`temp_${Date.now()}`,step_type:t,name:`New ${t.replace("_"," ")} Step`,step_config:{}};if(t==="CONDITION"&&(s.if_true=[],s.if_false=[]),t==="FOR_EACH"&&(s.children=[]),t==="FETCH_RECORDS"){const o=f.steps.slice(0,r).slice().reverse().find(c=>c&&c.step_type==="FETCH_RECORDS"&&c.step_config&&c.step_config.model);o&&(s.step_config={model:o.step_config.model,conditions:[]})}const e=[...f.steps];e.splice(r,0,s),C("update:steps",e)}function v(r){const t=f.steps.filter((s,e)=>e!==r);C("update:steps",t)}return(r,t)=>{const s=G("Workflow",!0);return m(),a("div",q,[l.steps.length===0?(m(),a("div",Y,[l.allowTrigger?(m(),a(S,{key:0},[t[2]||(t[2]=p("h3",{class:"text-lg font-semibold text-gray-700"},"Start your Automation",-1)),t[3]||(t[3]=p("p",{class:"text-sm text-gray-500 mt-1 mb-4"},"Every workflow starts with a trigger. How should this one begin?",-1)),p("button",{onClick:t[0]||(t[0]=e=>r.$emit("add-trigger")),class:"px-4 py-2 text-sm font-semibold rounded-md bg-indigo-600 text-white hover:bg-indigo-700"}," Add Trigger ")],64)):(m(),a(S,{key:1},[t[4]||(t[4]=p("h3",{class:"text-lg font-semibold text-gray-700"},"Start this flow",-1)),t[5]||(t[5]=p("p",{class:"text-sm text-gray-500 mt-1 mb-4"},"Choose a step to add in this branch.",-1)),p("div",z,[u(E,{onSelect:t[1]||(t[1]=e=>h(0,e))})])],64))])):(m(!0),a(S,{key:1},W(l.steps,(e,n)=>(m(),a(S,{key:e.id},[p("div",J,[y(e.step_type)?(m(),j(V(y(e.step_type)),{key:0,step:e,"all-steps-before":[...l.fullContextSteps,...l.steps.slice(0,n)],"loop-context-schema":l.loopContextSchema,onDelete:!l.allowTrigger||n>0?()=>v(n):null,"onUpdate:step":o=>g(n,o)},null,40,["step","all-steps-before","loop-context-schema","onDelete","onUpdate:step"])):b("",!0),e.step_type==="CONDITION"?(m(),a("div",K,[p("div",Q,[t[6]||(t[6]=p("p",{class:"text-center font-bold text-green-700 mb-4"},"IF YES",-1)),u(s,{steps:e.if_true||[],"onUpdate:steps":o=>g(n,{...e,if_true:o}),"full-context-steps":[...l.fullContextSteps,...l.steps.slice(0,n+1)],"loop-context-schema":l.loopContextSchema,"allow-trigger":!1},null,8,["steps","onUpdate:steps","full-context-steps","loop-context-schema"])]),p("div",X,[t[7]||(t[7]=p("p",{class:"text-center font-bold text-red-700 mb-4"},"IF NO",-1)),u(s,{steps:e.if_false||[],"onUpdate:steps":o=>g(n,{...e,if_false:o}),"full-context-steps":[...l.fullContextSteps,...l.steps.slice(0,n+1)],"loop-context-schema":l.loopContextSchema,"allow-trigger":!1},null,8,["steps","onUpdate:steps","full-context-steps","loop-context-schema"])])])):b("",!0),e.step_type==="FOR_EACH"?(m(),a("div",Z,[t[8]||(t[8]=p("p",{class:"text-center font-bold text-purple-700 mb-4"},"DO THIS FOR EACH ITEM",-1)),u(s,{steps:e.children||[],"onUpdate:steps":o=>g(n,{...e,children:o}),"full-context-steps":[...l.fullContextSteps,...l.steps.slice(0,n+1)],"loop-context-schema":N(e),"allow-trigger":!1},null,8,["steps","onUpdate:steps","full-context-steps","loop-context-schema"])])):b("",!0)]),u(E,{onSelect:o=>h(n+1,o)},null,8,["onSelect"])],64))),128))])}}};export{vt as default};
