import Z from"./BaseModal-Cu0mjoQh.js";import _ from"./LoadingOverlay-BkGJsaMi.js";import ee from"./Sidebar-BKWDmsGS.js";import te from"./HomeSection-C4gxrGqB.js";import ae from"./TicketsSection-BFoxuAMe.js";import oe from"./ApprovalsSection-Bm_h9THD.js";import ne from"./DocumentsSection-BSLoypv9.js";import ie from"./InvoicesSection-Cn29F75x.js";import le from"./AnnouncementsSection-D4DbT8J2.js";import re from"./DeliverableViewerModal-DVytApT0.js";import se from"./ResourceSection-8T0hgorC.js";import ce from"./SEOReport-CyymyI0Y.js";import{_ as ue}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as o,c as E,f as de,aN as W,a as P,o as r,d as A,i as s,b,t as ve,g as d,k as pe}from"./app-CsGDI9I1.js";import"./auto-BIBwKD9g.js";import"./chart-DUfl3Dpl.js";import"./TicketNotesSidebar-DXTqpYa1.js";import"./CreateTaskModal-CWWhWDPR.js";const me={},he={class:"bg-gray-100 flex min-h-screen font-sans"},fe={key:0,class:"fixed inset-0 bg-red-100 bg-opacity-90 flex items-center justify-center z-50 p-4"},ge={class:"bg-white p-8 rounded-lg shadow-xl text-red-700 max-w-lg w-full text-center"},be={class:"mb-6 whitespace-pre-line"},ke={__name:"ClientDashboard",props:{initialAuthToken:{type:String,default:""},projectId:{type:[String,Number],required:!0}},setup(n){const i=n,k=o(!0),q=o("client-user"),l=o("home"),S=o(!1),B=o(null),x=o(!1),v=o(!1),U=o(""),M=o(""),N=o([]),I=o(null),y=o([]),h=o([]),V=o([]),f=o([]),j=o([]),z=o([]),g=o([]),D=o([]),T=o([]),w=o(0),c=o(null),$=o({}),F=E(()=>Array.isArray(T.value)&&T.value.length>0),H=E(()=>{const e=import.meta&&me?"https://wireframe.ozeeweb.com.au":typeof window<"u"?window.location.origin:"",t=i.initialAuthToken||"";return e?`${e}/shared?token=${t}`:""}),K=E(()=>({marginLeft:S.value?"16rem":"4rem"})),L=e=>{B.value=e,x.value=!0},p=async(e,t)=>{try{const a=await fetch(`/api/client-api/${e}`,{headers:{Authorization:`Bearer ${i.initialAuthToken}`,"Content-Type":"application/json",Accept:"application/json"}});if(!a.ok){const C=await a.json();throw new Error(C.message||`Failed to fetch data from ${e}.`)}const u=await a.json();t.value=u}catch(a){console.error(`Error fetching from ${e}:`,a),c.value=c.value?c.value+`
${a.message}`:a.message}},G=(e,t,a,u=null,C=null)=>{U.value=e,M.value=t,I.value=C;const O=[];a==="alert"?O.push({label:"OK",className:"bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700",onClick:()=>v.value=!1}):a==="confirm"&&O.push({label:"Cancel",className:"bg-gray-300 text-gray-800 py-2 px-4 rounded-lg hover:bg-gray-400",onClick:()=>v.value=!1},{label:"Confirm",className:"bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700",onClick:()=>{u&&u(),v.value=!1}}),N.value=O,v.value=!0},J=()=>{v.value=!1,I.value=null},m=async e=>{console.log("Simulating adding activity:",e);const t={id:Date.now(),description:e,date:new Date().toISOString()};y.value.unshift(t),y.value=y.value.slice(0,10)},Q=async e=>{h.value.unshift(e),h.value.sort((t,a)=>new Date(a.date).getTime()-new Date(t.date).getTime())},R=async(e,t)=>{const a=g.value.findIndex(u=>u.id===e);a!==-1&&(g.value[a].status=t)},X=async e=>{console.log("Simulating adding document:",e),f.value.unshift(e),f.value.sort((t,a)=>new Date(a.uploadDate).getTime()-new Date(t.uploadDate).getTime())},Y=async(e,t)=>{console.log(`Simulating updating invoice ${e} to ${t}`);const a=j.value.findIndex(u=>u.id===e);a!==-1&&(j.value[a].status=t)};return de(async()=>{if(k.value=!0,c.value=null,!i.initialAuthToken||!i.projectId){c.value="Authentication token or Project ID missing. Cannot load dashboard.",k.value=!1;return}await Promise.all([p(`project/${i.projectId}/tasks`,h),p(`project/${i.projectId}/documents`,f),p(`project/${i.projectId}/deliverables`,g),p(`project/${i.projectId}/shareable-resources?visible_to_client=true`,D),p(`project/${i.projectId}/wireframes`,T),p(`project/${i.projectId}`,$)]);try{const e=await fetch(`/api/client-api/projects/${i.projectId}/seo-reports/count`,{headers:{Authorization:`Bearer ${i.initialAuthToken}`,Accept:"application/json"}});if(e.ok){const t=await e.json();w.value=t.count||0}else console.error("Error fetching SEO reports count"),w.value=0}catch(e){console.error("Error fetching SEO reports count:",e),w.value=0}k.value=!1}),W("modalService",{showModal:G}),W("activityService",{addActivity:m}),(e,t)=>(r(),P("div",he,[A(_,{isLoading:k.value},null,8,["isLoading"]),c.value?(r(),P("div",fe,[b("div",ge,[t[4]||(t[4]=b("h3",{class:"text-2xl font-bold mb-4"},"Error Loading Dashboard",-1)),b("p",be,ve(c.value),1),b("button",{onClick:t[0]||(t[0]=a=>c.value=null),class:"bg-red-600 text-white py-2 px-4 rounded-lg hover:bg-red-700"},"Dismiss")])])):s("",!0),A(ee,{userId:q.value,activeSection:l.value,isExpanded:S.value,hasWireframes:F.value,wireframeShareUrl:H.value,onSectionChange:t[1]||(t[1]=a=>l.value=a),"onUpdate:isExpanded":t[2]||(t[2]=a=>S.value=a)},null,8,["userId","activeSection","isExpanded","hasWireframes","wireframeShareUrl"]),b("div",{class:"flex-1 p-8 overflow-y-auto main-content",style:pe(K.value)},[l.value==="home"?(r(),d(te,{key:0,activities:y.value,tickets:h.value,approvals:V.value,documents:f.value,invoices:j.value,announcements:z.value,deliverables:g.value,shareableResources:D.value,"seo-reports-count":w.value,onOpenDeliverableViewer:L,"project-data":$.value},null,8,["activities","tickets","approvals","documents","invoices","announcements","deliverables","shareableResources","seo-reports-count","project-data"])):s("",!0),l.value==="seo"?(r(),d(ce,{key:1,"project-id":n.projectId,"initial-auth-token":n.initialAuthToken},null,8,["project-id","initial-auth-token"])):s("",!0),l.value==="tickets"?(r(),d(ae,{key:2,"project-id":n.projectId,"initial-auth-token":n.initialAuthToken,tickets:h.value,onAddTicket:Q,onAddActivity:m},null,8,["project-id","initial-auth-token","tickets"])):s("",!0),l.value==="approvals"?(r(),d(oe,{key:3,onOpenDeliverableViewer:L,deliverables:g.value,"initial-auth-token":n.initialAuthToken,"project-id":n.projectId,approvals:V.value,onUpdateApproval:R,onAddActivity:m},null,8,["deliverables","initial-auth-token","project-id","approvals"])):s("",!0),l.value==="documents"?(r(),d(ne,{key:4,"project-data":$.value,"project-id":n.projectId,"initial-auth-token":n.initialAuthToken,documents:f.value,onAddDocument:X,onAddActivity:m},null,8,["project-data","project-id","initial-auth-token","documents"])):s("",!0),l.value==="resources"?(r(),d(se,{key:5,"project-id":n.projectId,"initial-auth-token":n.initialAuthToken,"shareable-resources":D.value,onAddActivity:m},null,8,["project-id","initial-auth-token","shareable-resources"])):s("",!0),l.value==="invoices"?(r(),d(ie,{key:6,invoices:j.value,onUpdateInvoice:Y,onAddActivity:m},null,8,["invoices"])):s("",!0),l.value==="announcements"?(r(),d(le,{key:7,announcements:z.value},null,8,["announcements"])):s("",!0)],4),A(Z,{isOpen:v.value,title:U.value,message:M.value,buttons:N.value,children:I.value,onClose:J},null,8,["isOpen","title","message","buttons","children"]),A(re,{isOpen:x.value,"onUpdate:isOpen":t[3]||(t[3]=a=>x.value=a),deliverable:B.value,initialAuthToken:n.initialAuthToken,projectId:n.projectId,onDeliverableActionSuccess:R},null,8,["isOpen","deliverable","initialAuthToken","projectId"])]))}},ze=ue(ke,[["__scopeId","data-v-d32d0e0e"]]);export{ze as default};
