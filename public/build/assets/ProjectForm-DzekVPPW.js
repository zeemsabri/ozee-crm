import{x as ie,r as $,R as E,z as pe,w as le,B as me,i as d,o,b as t,m as F,g as f,e as l,f as ge,k as ke,c as ee,a as K,p as W,Q as ne,s as q,F as ue,j as ce,t as C,d as He,v as Ve,S as Ge,Z as Ne,h as D,ak as Ye,l as We,a8 as Je,al as Xe,am as Qe,an as Ze,$ as et}from"./app-DJMKqN8j.js";import{_ as M}from"./InputLabel-C5HKNZw0.js";import{_ as G}from"./TextInput-CQT4U5IF.js";import{_ as O}from"./InputError-CTdy1tgm.js";import{P as te}from"./PrimaryButton-DmlXcktq.js";import{S as se}from"./SelectDropdown-BudJbdR7.js";import{T as tt,j as at,k as st}from"./AuthenticatedLayout-BoAxqZnb.js";import{P as lt,_ as ot}from"./ProjectTypeInput-nEkJYUpi.js";import{_ as be}from"./SecondaryButton-BsbA8FYw.js";import{D as nt}from"./DangerButton-B6hbk-CJ.js";import{_ as rt}from"./Modal-CBATDj34.js";import{_ as it}from"./Checkbox-BsrQFdD7.js";const dt=$([]),ut=$([]),Ce=$([]),De=$([]),Ie=async e=>{try{const y=(await ie.get(`/api/roles?type=${e}`)).data.map(v=>({value:v.id,label:v.name}));return e==="client"?dt.value=y:e==="project"&&(ut.value=y),y}catch(p){return console.error(`Error fetching ${e} roles:`,p),E(`Failed to load ${e} roles. Please refresh the page.`),[]}},ct=async(e,p)=>{try{let a;return p&&!e||e&&(a=await window.axios.get("/api/clients"),Ce.value=a.data.data||a.data),Ce.value}catch(a){return console.error("Error fetching clients:",a),E("Failed to load clients. Please try again."),[]}},mt=async(e,p)=>{try{let a;return p&&!e||e&&(a=await window.axios.get("/api/users"),De.value=a.data),De.value}catch(a){return console.error("Error fetching users:",a),E("Failed to load users. Please try again."),[]}},xe=async(e,p,a)=>{let y="",v=null;try{switch(p){case"basic":y=`/api/projects/${e}/sections/basic`;break;case"client":(a.canViewProjectClients||a.canManageProjectClients||a.canViewProjectUsers||a.canManageProjectUsers)&&(y=`/api/projects/${e}/sections/clients-users`);break;case"services":(a.canViewProjectServicesAndPayments||a.canManageProjectServicesAndPayments)&&(y=`/api/projects/${e}/sections/services-payment`);break;case"documents":a.canViewProjectDocuments&&(y=`/api/projects/${e}/sections/documents`);break;case"notes":(a.canViewProjectNotes||a.canAddProjectNotes)&&(y=`/api/projects/${e}/sections/notes?type=private`);break;case"transactions":return null;default:return console.warn(`Attempted to fetch data for unknown tab: ${p}`),null}return y&&(v=(await window.axios.get(y)).data),v}catch(P){throw console.error(`Error fetching data for tab '${p}':`,P),E(`Failed to load data for ${p} section. Please try again.`),P}},vt={class:"space-y-6 bg-white p-6 rounded-lg border border-gray-100 font-inter"},pt={key:0,class:"text-center py-8 text-gray-500 text-lg"},gt={key:1,class:"grid grid-cols-1 md:grid-cols-2 gap-6"},yt={key:0},ft={key:1},bt={key:2},wt=["disabled"],ht={key:0,class:"mt-2"},xt=["src"],kt={class:"mt-6"},jt=["disabled"],_t={class:"mt-6"},Pt={class:"mt-6"},$t={class:"mt-6 flex justify-end"},St={key:0,class:"flex items-center"},Vt={key:1},Ct={__name:"ProjectEditBasicInfo",props:{projectId:{type:[Number,String],required:!0},errors:{type:Object,default:()=>({})},statusOptions:{type:Array,required:!0,default:()=>[{value:"active",label:"Active"},{value:"completed",label:"Completed"},{value:"paid",label:"Paid"},{value:"on_hold",label:"On-hold"}]},sourceOptions:{type:Array,required:!0},canManageProjects:{type:Boolean,default:!1},canManageProjectBasicDetails:{type:Boolean,default:!1},isSaving:{type:Boolean,default:!1}},setup(e){const p=e,a=pe({id:null,name:"",description:"",website:"",social_media_link:"",preferred_keywords:"",google_chat_id:"",google_drive_link:"",logo:null,status:"active",project_type:"",source:"",tags:[],tags_data:[],timezone:null}),y=$(!1),v=$(!0),P=b=>{const n=b.target.files[0];n?a.logo=n:a.logo=null},T=async()=>{y.value=!0;const b=new FormData,n=["id","tags","tags_data","logo"];for(const s in a)n.includes(s)||a[s]!==null&&a[s]!==void 0&&b.append(s,a[s]);Array.isArray(a.tags)&&a.tags.forEach(s=>{const r=typeof s=="object"&&s!==null&&s.id?s.id:s;r!=null&&b.append("tags[]",r)}),a.logo instanceof File&&b.append("logo",a.logo),b.append("_method","PUT");try{const s=await window.axios.post(`/api/projects/${p.projectId}/sections/basic`,b,{headers:{"Content-Type":"multipart/form-data"}});ne("Project basic information updated successfully!"),s.data&&Object.assign(a,{name:s.data.name||a.name,description:s.data.description||a.description,website:s.data.website||a.website,social_media_link:s.data.social_media_link||a.social_media_link,preferred_keywords:s.data.preferred_keywords||a.preferred_keywords,google_chat_id:s.data.google_chat_id||a.google_chat_id,google_drive_link:s.data.google_drive_link||a.google_drive_link,logo:s.data.logo||a.logo,status:s.data.status||a.status,project_type:s.data.project_type||a.project_type,source:s.data.source||a.source,tags:s.data.tags||a.tags,tags_data:s.data.tags_data||a.tags_data,timezone:s.data.timezone||a.timezone})}catch(s){console.error("Error saving basic info:",s);let r="Failed to save basic information.";s.response&&s.response.data&&s.response.data.message&&(r=s.response.data.message),E(r)}finally{y.value=!1}},I=async()=>{if(!p.projectId){v.value=!1;return}v.value=!0;try{const b=await xe(p.projectId,"basic",{});b&&Object.assign(a,{id:b.id||p.projectId,name:b.name||"",description:b.description||"",website:b.website||"",social_media_link:b.social_media_link||"",preferred_keywords:b.preferred_keywords||"",google_chat_id:b.google_chat_id||"",google_drive_link:b.google_drive_link||"",logo:b.logo||null,status:b.status||"active",project_type:b.project_type||"",source:b.source||"",tags:b.tags||[],tags_data:b.tags_data||[],timezone:b.timezone||null})}catch(b){console.error("Error fetching basic info:",b),E("Failed to load basic project information.")}finally{v.value=!1}};return le(()=>p.projectId,async b=>{setTimeout(async()=>{b&&await I()},500)},{immediate:!0}),me(()=>{}),(b,n)=>(o(),d("div",vt,[v.value?(o(),d("div",pt,n[12]||(n[12]=[t("svg",{class:"animate-spin h-8 w-8 text-indigo-500 mx-auto mb-3",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),F(" Loading basic project information... ",-1)]))):(o(),d("div",gt,[t("div",null,[l(M,{for:"name",value:"Project Name"}),l(G,{id:"name",type:"text",class:"mt-1 block w-full rounded-lg shadow-sm",modelValue:a.name,"onUpdate:modelValue":n[0]||(n[0]=s=>a.name=s),required:"",autofocus:"",disabled:!e.canManageProjects||y.value||e.isSaving},null,8,["modelValue","disabled"]),l(O,{message:e.errors.name?e.errors.name[0]:"",class:"mt-2"},null,8,["message"])]),t("div",null,[l(M,{for:"website",value:"Website"}),l(G,{id:"website",type:"url",class:"mt-1 block w-full rounded-lg shadow-sm",modelValue:a.website,"onUpdate:modelValue":n[1]||(n[1]=s=>a.website=s),disabled:!e.canManageProjects||y.value||e.isSaving},null,8,["modelValue","disabled"]),l(O,{message:e.errors.website?e.errors.website[0]:"",class:"mt-2"},null,8,["message"])]),t("div",null,[l(M,{for:"social_media_link",value:"Social Media Link"}),l(G,{id:"social_media_link",type:"url",class:"mt-1 block w-full rounded-lg shadow-sm",modelValue:a.social_media_link,"onUpdate:modelValue":n[2]||(n[2]=s=>a.social_media_link=s),disabled:!e.canManageProjects||y.value||e.isSaving},null,8,["modelValue","disabled"]),l(O,{message:e.errors.social_media_link?e.errors.social_media_link[0]:"",class:"mt-2"},null,8,["message"])]),e.canManageProjectBasicDetails?(o(),d("div",yt,[l(M,{for:"google_chat_id",value:"Google Chat ID"}),l(G,{id:"google_chat_id",type:"text",class:"mt-1 block w-full rounded-lg shadow-sm",modelValue:a.google_chat_id,"onUpdate:modelValue":n[3]||(n[3]=s=>a.google_chat_id=s),disabled:!e.canManageProjects||y.value||e.isSaving},null,8,["modelValue","disabled"]),l(O,{message:e.errors.google_chat_id?e.errors.google_chat_id[0]:"",class:"mt-2"},null,8,["message"])])):f("",!0),e.canManageProjectBasicDetails?(o(),d("div",ft,[l(M,{for:"google_drive_link",value:"Google Drive Link"}),l(G,{id:"google_drive_link",type:"text",class:"mt-1 block w-full rounded-lg shadow-sm",modelValue:a.google_drive_link,"onUpdate:modelValue":n[4]||(n[4]=s=>a.google_drive_link=s),disabled:!e.canManageProjects||y.value||e.isSaving},null,8,["modelValue","disabled"]),l(O,{message:e.errors.google_drive_link?e.errors.google_drive_link[0]:"",class:"mt-2"},null,8,["message"])])):f("",!0),t("div",null,[l(M,{for:"status",value:"Status"}),l(se,{id:"status",modelValue:a.status,"onUpdate:modelValue":n[5]||(n[5]=s=>a.status=s),options:e.statusOptions,valueKey:"value",labelKey:"label",placeholder:"Select Project Status",disabled:!e.canManageProjects||y.value||e.isSaving,required:!0,class:"mt-1 block w-full"},null,8,["modelValue","options","disabled"]),l(O,{message:e.errors.status?e.errors.status[0]:"",class:"mt-2"},null,8,["message"])]),t("div",null,[l(lt,{id:"project_type",modelValue:a.project_type,"onUpdate:modelValue":n[6]||(n[6]=s=>a.project_type=s),disabled:!e.canManageProjects||y.value||e.isSaving,class:"mt-1 block w-full"},null,8,["modelValue","disabled"]),l(O,{message:e.errors.project_type?e.errors.project_type[0]:"",class:"mt-2"},null,8,["message"])]),t("div",null,[l(M,{for:"source",value:"Source"}),l(se,{id:"source",modelValue:a.source,"onUpdate:modelValue":n[7]||(n[7]=s=>a.source=s),options:e.sourceOptions,valueKey:"value",labelKey:"label",placeholder:"Select a Source",disabled:!e.canManageProjects||y.value||e.isSaving,class:"mt-1 block w-full"},null,8,["modelValue","options","disabled"]),l(O,{message:e.errors.source?e.errors.source[0]:"",class:"mt-2"},null,8,["message"])]),t("div",null,[l(ot,{id:"timezone",modelValue:a.timezone,"onUpdate:modelValue":n[8]||(n[8]=s=>a.timezone=s),disabled:!e.canManageProjects||y.value||e.isSaving,class:"mt-1 block w-full"},null,8,["modelValue","disabled"]),l(O,{message:e.errors.timezone?e.errors.timezone[0]:"",class:"mt-2"},null,8,["message"])]),e.canManageProjectBasicDetails?(o(),d("div",bt,[l(M,{for:"logo",value:"Project Logo"}),t("input",{type:"file",id:"logo",onChange:P,class:"mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100 cursor-pointer",accept:"image/*",disabled:!e.canManageProjectBasicDetails||y.value||e.isSaving},null,40,wt),a.logo&&typeof a.logo=="string"?(o(),d("div",ht,[n[13]||(n[13]=t("p",{class:"text-sm text-gray-600"},"Current Logo:",-1)),t("img",{src:a.logo,alt:"Project Logo",class:"h-20 w-20 object-contain rounded-lg shadow-md border border-gray-200"},null,8,xt)])):f("",!0),l(O,{message:e.errors.logo?e.errors.logo[0]:"",class:"mt-2"},null,8,["message"])])):f("",!0)])),t("div",kt,[l(M,{for:"description",value:"Description"}),ge(t("textarea",{id:"description",class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-lg shadow-sm mt-1 block w-full","onUpdate:modelValue":n[9]||(n[9]=s=>a.description=s),disabled:!e.canManageProjects||y.value||e.isSaving,rows:"4"},null,8,jt),[[ke,a.description]]),l(O,{message:e.errors.description?e.errors.description[0]:"",class:"mt-2"},null,8,["message"])]),t("div",_t,[l(M,{for:"preferred_keywords",value:"Client Preferred Keywords"}),l(G,{id:"preferred_keywords",type:"text",class:"mt-1 block w-full rounded-lg shadow-sm",modelValue:a.preferred_keywords,"onUpdate:modelValue":n[10]||(n[10]=s=>a.preferred_keywords=s),disabled:!e.canManageProjects||y.value||e.isSaving},null,8,["modelValue","disabled"]),l(O,{message:e.errors.preferred_keywords?e.errors.preferred_keywords[0]:"",class:"mt-2"},null,8,["message"])]),t("div",Pt,[l(tt,{modelValue:a.tags,"onUpdate:modelValue":n[11]||(n[11]=s=>a.tags=s),initialTags:a.tags_data,label:"Associated Tags",placeholder:"Search or add tags",error:e.errors.tags?e.errors.tags[0]:"",disabled:!e.canManageProjects||y.value||e.isSaving},null,8,["modelValue","initialTags","error","disabled"])]),t("div",$t,[e.canManageProjectBasicDetails?(o(),ee(te,{key:0,onClick:T,disabled:!e.canManageProjects||y.value||e.isSaving,class:W([{"opacity-50 cursor-not-allowed":y.value||e.isSaving},"px-6 py-2 rounded-lg text-base shadow-md hover:shadow-lg transition-all"])},{default:K(()=>[y.value||e.isSaving?(o(),d("span",St,n[14]||(n[14]=[t("svg",{class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),F(" Updating... ",-1)]))):(o(),d("span",Vt," Update Basic Information "))]),_:1},8,["disabled","class"])):f("",!0)])]))}},Dt={class:"mb-4"},It={class:"mt-2"},Ut={key:0,class:"text-gray-500 text-sm mb-2"},Mt={class:"mb-4"},At={key:1,class:"space-y-3"},Nt={class:"flex-grow text-gray-800 font-medium"},Bt={class:"text-gray-600 text-sm"},Tt={class:"flex items-center space-x-2"},Ot=["onClick"],Rt={key:2,class:"p-4 bg-gray-50 rounded-lg text-gray-600 text-center border border-dashed border-gray-200"},Ue={__name:"MultiSelectWithRoles",props:{label:{type:String,required:!0},items:{type:Array,default:()=>[]},endpoint:{type:String,default:""},selectedItems:{type:Array,default:()=>[]},itemText:{type:String,default:"name"},itemSubtext:{type:String,default:"email"},itemValue:{type:String,default:"id"},roleOptions:{type:Array,default:()=>[]},roleType:{type:String,default:"application"},defaultRoleId:{type:Number,default:null},error:{type:String,default:""},placeholder:{type:String,default:"Select an item"},showRemoveButton:{type:Boolean,default:!0},disabled:{type:Boolean,default:!1}},emits:["update:selectedItems"],setup(e,{emit:p}){const a=e,y=p,v=$([]),P=$([]),T=$([]),I=$([]),b=$(!1),n=async()=>{if(!(a.roleOptions.length>0))try{const U=(await ie.get(`/api/roles?type=${a.roleType}`)).data;T.value=U.map(S=>({value:S.id,label:S.name}))}catch(u){console.error("Error fetching roles:",u)}},s=q(()=>T.value.length>0?T.value:a.roleOptions),r=()=>a.defaultRoleId?a.defaultRoleId:s.value.length>0?s.value[0].value:1,k=()=>{v.value=[],P.value=[],!(!a.selectedItems||a.selectedItems.length===0)&&a.selectedItems.forEach(u=>{const U=typeof u=="object"?u[a.itemValue]:u,S=typeof u=="object"&&u.role_id!==void 0?u.role_id:r();if(!v.value.includes(U))v.value.push(U),P.value.push({id:U,role_id:S});else{const H=P.value.find(Y=>Y.id===U);H&&H.role_id!==S&&(H.role_id=S)}})};le(()=>a.selectedItems,(u,U)=>{JSON.stringify(u)!==JSON.stringify(U)&&k()},{deep:!0,immediate:!0}),le(P,u=>{y("update:selectedItems",u)},{deep:!0});const w=u=>{a.disabled||u&&!v.value.includes(u)&&(v.value.push(u),P.value.push({id:u,role_id:r()}))},A=u=>{a.disabled||(v.value=v.value.filter(U=>U!==u),P.value=P.value.filter(U=>U.id!==u))},J=(u,U)=>{if(a.disabled)return;const S=P.value.find(H=>H.id===u);S&&(S.role_id=parseInt(U))},X=u=>j.value.find(U=>U[a.itemValue]===u),Q=u=>{const U=P.value.find(S=>S.id===u);return U?U.role_id:r()},N=async()=>{if(a.endpoint){b.value=!0;try{const u=await ie.get(a.endpoint);u.data&&Array.isArray(u.data)?I.value=u.data:u.data&&u.data.data&&Array.isArray(u.data.data)&&(I.value=u.data.data)}catch(u){console.error("Error fetching items from endpoint:",u)}finally{b.value=!1}}},j=q(()=>a.endpoint&&I.value.length>0?I.value:a.items),h=q(()=>j.value.filter(u=>!v.value.includes(u[a.itemValue])).map(u=>({value:u[a.itemValue],label:`${u[a.itemText]} (${u[a.itemSubtext]})`})));return me(()=>{n(),a.endpoint&&N()}),(u,U)=>(o(),d("div",Dt,[l(M,{value:e.label},null,8,["value"]),t("div",It,[b.value?(o(),d("div",Ut,"Loading available items...")):f("",!0),t("div",Mt,[l(se,{modelValue:u.selectedItemToAdd,"onUpdate:modelValue":U[0]||(U[0]=S=>u.selectedItemToAdd=S),options:h.value,valueKey:"value",labelKey:"label",placeholder:e.placeholder,disabled:b.value||e.disabled,onChange:w,class:"w-full"},null,8,["modelValue","options","placeholder","disabled"])]),v.value.length>0?(o(),d("div",At,[(o(!0),d(ue,null,ce(v.value,S=>{var H,Y;return o(),d("div",{key:S,class:"flex items-center p-3 border border-gray-200 rounded-lg bg-gray-50 shadow-sm"},[t("div",Nt,[F(C((H=X(S))==null?void 0:H[e.itemText])+" ",1),t("span",Bt,"("+C((Y=X(S))==null?void 0:Y[e.itemSubtext])+")",1)]),t("div",Tt,[l(se,{modelValue:Q(S),"onUpdate:modelValue":g=>J(S,g),options:s.value,valueKey:"value",labelKey:"label",placeholder:"Select Role",disabled:e.disabled,class:"w-32"},null,8,["modelValue","onUpdate:modelValue","options","disabled"]),e.showRemoveButton&&!e.disabled?(o(),d("button",{key:0,type:"button",class:"text-red-500 hover:text-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 rounded-full p-1 transition-colors duration-200",onClick:g=>A(S),"aria-label":"Remove item"},U[1]||(U[1]=[t("svg",{class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]),8,Ot)):f("",!0)])])}),128))])):(o(),d("div",Rt," No "+C(e.label.toLowerCase())+" selected. ",1))]),l(O,{message:e.error,class:"mt-2"},null,8,["message"])]))}},Ft={class:"space-y-8"},Et={key:0,class:"bg-gray-50 p-6 rounded-lg shadow-inner border border-gray-200"},zt={key:0,class:"mt-6 flex justify-end"},Lt={key:0},qt={key:1},Kt={key:1,class:"mt-3 text-green-600 text-sm flex items-center"},Ht={key:2,class:"mt-3 text-red-600 text-sm flex items-center"},Gt={class:"bg-gray-50 p-6 rounded-lg shadow-inner border border-gray-200"},Yt=["disabled"],Wt={key:1,class:"bg-gray-50 p-6 rounded-lg shadow-inner border border-gray-200"},Jt={key:0,class:"mt-6 flex justify-end"},Xt={key:0},Qt={key:1},Zt={key:1,class:"mt-3 text-green-600 text-sm flex items-center"},ea={key:2,class:"mt-3 text-red-600 text-sm flex items-center"},ta={__name:"ProjectFormClientsUsers",props:{projectId:{type:[Number,String],required:!0},errors:{type:Object,default:()=>({})},clientRoleOptions:{type:Array,default:()=>[]},userRoleOptions:{type:Array,default:()=>[]},clients:{type:Array,default:()=>[]},users:{type:Array,default:()=>[]},canViewProjectClients:{type:Boolean,default:!1},canManageProjectClients:{type:Boolean,default:!1},canViewProjectUsers:{type:Boolean,default:!1},canManageProjectUsers:{type:Boolean,default:!1},isSaving:{type:Boolean,default:!1}},setup(e){const p=e,a=pe({client_ids:[],user_ids:[],contract_details:""}),y=$(!1),v=$(!1),P=$(""),T=$(!1),I=$(!1),b=$(""),n=async()=>{if(p.projectId)try{const k=await xe(p.projectId,"client",{canViewProjectClients:p.canViewProjectClients,canManageProjectClients:p.canManageProjectClients,canViewProjectUsers:p.canViewProjectUsers,canManageProjectUsers:p.canManageProjectUsers});k&&(a.client_ids=k.clients?k.clients.map(w=>{var A;return{id:w.id,role_id:((A=w.pivot)==null?void 0:A.role_id)||(p.clientRoleOptions.length>0?p.clientRoleOptions[0].value:null)}}):[],a.user_ids=k.users?k.users.map(w=>{var A;return{id:w.id,role_id:((A=w.pivot)==null?void 0:A.role_id)||(p.userRoleOptions.length>0?p.userRoleOptions[0].value:null)}}):[],a.contract_details=k.contract_details||"")}catch(k){console.error("Error fetching clients/users data:",k),E("Failed to load clients and users data.")}};le(()=>p.projectId,async k=>{k&&await n()},{immediate:!0});const s=async()=>{var k,w;if(!p.projectId){E("Project ID is missing. Cannot save clients.");return}if(!a.client_ids||a.client_ids.length===0){E("Please select at least one client to save.");return}y.value=!0,v.value=!1,P.value="";try{await window.axios.post(`/api/projects/${p.projectId}/attach-clients`,{client_ids:a.client_ids}),ne("Clients saved successfully!"),v.value=!0,await n()}catch(A){console.error("Error saving clients:",A),P.value=((w=(k=A.response)==null?void 0:k.data)==null?void 0:w.message)||"Failed to save clients.",E(P.value)}finally{y.value=!1,setTimeout(()=>v.value=!1,3e3)}},r=async()=>{var k,w;if(!p.projectId){E("Project ID is missing. Cannot save users.");return}if(!a.user_ids||a.user_ids.length===0){E("Please select at least one user to save.");return}T.value=!0,I.value=!1,b.value="";try{await window.axios.post(`/api/projects/${p.projectId}/attach-users`,{user_ids:a.user_ids}),ne("Users saved successfully!"),I.value=!0,await n()}catch(A){console.error("Error saving users:",A),b.value=((w=(k=A.response)==null?void 0:k.data)==null?void 0:w.message)||"Failed to save users.",E(b.value)}finally{T.value=!1,setTimeout(()=>I.value=!1,3e3)}};return me(()=>{}),(k,w)=>(o(),d("div",Ft,[e.canViewProjectClients?(o(),d("div",Et,[w[5]||(w[5]=t("h3",{class:"text-xl font-semibold text-gray-800 mb-5"},"Project Clients",-1)),l(Ue,{label:"Select Clients",items:e.clients,selectedItems:a.client_ids,"onUpdate:selectedItems":w[0]||(w[0]=A=>a.client_ids=A),roleOptions:e.clientRoleOptions,roleType:"client",error:e.errors.client_ids?e.errors.client_ids[0]:"",placeholder:"Search and select clients to add",disabled:!e.canManageProjectClients||e.isSaving||y.value,readonly:!e.canManageProjectClients&&e.canViewProjectClients,showRemoveButton:e.canManageProjectClients,class:"mb-4"},null,8,["items","selectedItems","roleOptions","error","disabled","readonly","showRemoveButton"]),e.canManageProjectClients?(o(),d("div",zt,[l(te,{onClick:s,disabled:y.value||e.isSaving,class:"px-6 py-3 rounded-lg text-lg shadow-md hover:shadow-lg transition-all duration-200"},{default:K(()=>[y.value?(o(),d("span",Lt,"Saving Clients...")):(o(),d("span",qt,"Save Clients"))]),_:1},8,["disabled"])])):f("",!0),v.value?(o(),d("div",Kt,w[3]||(w[3]=[t("svg",{class:"h-5 w-5 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1),F(" Clients saved successfully! ",-1)]))):f("",!0),P.value?(o(),d("div",Ht,[w[4]||(w[4]=t("svg",{class:"h-5 w-5 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),F(" "+C(P.value),1)])):f("",!0)])):f("",!0),t("div",Gt,[w[6]||(w[6]=t("h3",{class:"text-xl font-semibold text-gray-800 mb-5"},"Contract Information",-1)),l(M,{for:"contract_details",value:"Contract Details",class:"mb-1"}),ge(t("textarea",{id:"contract_details",class:"block w-full px-4 py-2 border-gray-300 rounded-lg shadow-sm focus:border-indigo-500 focus:ring-indigo-500 transition-colors duration-200 resize-y min-h-[120px]","onUpdate:modelValue":w[1]||(w[1]=A=>a.contract_details=A),disabled:!e.canManageProjectClients||e.isSaving,placeholder:"Enter contract terms, agreements, or important notes about the client relationship."},null,8,Yt),[[ke,a.contract_details]]),l(O,{message:e.errors.contract_details?e.errors.contract_details[0]:"",class:"mt-2"},null,8,["message"])]),e.canViewProjectUsers?(o(),d("div",Wt,[w[9]||(w[9]=t("h3",{class:"text-xl font-semibold text-gray-800 mb-5"},"Assign Project Users",-1)),l(Ue,{label:"Assign Users",items:e.users,selectedItems:a.user_ids,"onUpdate:selectedItems":w[2]||(w[2]=A=>a.user_ids=A),roleOptions:e.userRoleOptions,roleType:"project",defaultRoleId:2,error:e.errors.user_ids?e.errors.user_ids[0]:"",placeholder:"Search and assign users to this project",disabled:!e.canManageProjectUsers||e.isSaving||T.value,readonly:!e.canManageProjectUsers&&e.canViewProjectUsers,showRemoveButton:e.canManageProjectUsers,class:"mb-4"},null,8,["items","selectedItems","roleOptions","error","disabled","readonly","showRemoveButton"]),e.canManageProjectUsers?(o(),d("div",Jt,[l(te,{onClick:r,disabled:T.value||e.isSaving,class:"px-6 py-3 rounded-lg text-lg shadow-md hover:shadow-lg transition-all duration-200"},{default:K(()=>[T.value?(o(),d("span",Xt,"Saving Users...")):(o(),d("span",Qt,"Save Users"))]),_:1},8,["disabled"])])):f("",!0),I.value?(o(),d("div",Zt,w[7]||(w[7]=[t("svg",{class:"h-5 w-5 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1),F(" Users saved successfully! ",-1)]))):f("",!0),b.value?(o(),d("div",ea,[w[8]||(w[8]=t("svg",{class:"h-5 w-5 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),F(" "+C(b.value),1)])):f("",!0)])):f("",!0)]))}},aa={class:"space-y-6"},sa={key:0,class:"bg-gray-50 p-6 rounded-lg shadow-inner border border-gray-200"},la={class:"mt-6"},oa={key:0},na={key:1},ra={key:0,class:"text-sm text-red-500 mt-3"},ia={key:1,class:"mt-8 bg-white p-6 rounded-lg shadow-md border border-gray-200"},da={class:"space-y-3"},ua={class:"flex items-center"},ca={class:"mr-3 text-indigo-500"},ma={key:0,class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},va={key:1,class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},pa={key:2,class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},ga={key:3,class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},ya=["href"],fa={key:1,class:"text-gray-700 font-medium break-all mr-4"},ba=["onClick","disabled"],wa={key:2,class:"p-6 bg-gray-50 rounded-lg text-gray-600 text-center border border-gray-200 shadow-sm"},ha={__name:"ProjectFormDocuments",props:{projectId:{type:[Number,String],required:!0},errors:{type:Object,default:()=>({})},canUploadProjectDocuments:{type:Boolean,default:!1},canViewProjectDocuments:{type:Boolean,default:!1},isSaving:{type:Boolean,default:!1}},setup(e){const p=e,a=pe({documents:[]}),y=$(null),v=$(!1),P=async()=>{if(p.projectId)try{const n=await xe(p.projectId,"documents",{canViewProjectDocuments:p.canViewProjectDocuments});n&&(a.documents=n||[])}catch(n){console.error("Error fetching documents data:",n),E("Failed to load documents data.")}};le(()=>p.projectId,async n=>{n&&await P()},{immediate:!0});const T=n=>{const s=Array.from(n.target.files);if(s.length>0){const r=Array.isArray(a.documents)?a.documents.filter(k=>typeof k=="object"&&"path"in k):[];a.documents=[...r,...s]}},I=async()=>{if(!p.projectId){E("Project ID is missing. Cannot upload documents.");return}const n=a.documents.filter(s=>s&&typeof s=="object"&&"name"in s&&"size"in s&&"type"in s);if(!n||n.length===0){E("Please select documents to upload.");return}v.value=!0;try{const s=new FormData;n.forEach((k,w)=>{s.append(`documents[${w}]`,k)});const r=await window.axios.post(`/api/projects/${p.projectId}/documents`,s,{headers:{"Content-Type":"multipart/form-data"}});a.documents=r.data.documents||[],ne("Documents uploaded successfully!"),await P()}catch(s){E("Failed to upload documents."),console.error("Error uploading documents:",s)}finally{v.value=!1,y.value&&(y.value.value="")}},b=n=>{a.documents=a.documents.filter((s,r)=>r!==n)};return me(()=>{}),(n,s)=>(o(),d("div",aa,[e.canUploadProjectDocuments?(o(),d("div",sa,[l(M,{for:"documents-upload",value:"Upload New Documents",class:"mb-2 text-lg"}),t("input",{type:"file",id:"documents-upload",ref_key:"documentFileInput",ref:y,onChange:T,class:"mt-2 block w-full text-sm text-gray-600 file:mr-4 file:py-2.5 file:px-5 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100 transition-colors duration-200 cursor-pointer",multiple:"",accept:".pdf,.doc,.docx,.jpg,.jpeg,.png,.gif"},null,544),s[0]||(s[0]=t("p",{class:"text-sm text-gray-500 mt-2"},"Supported formats: PDF, DOC, DOCX, JPG, JPEG, PNG, GIF. Max file size: 5MB.",-1)),l(O,{message:e.errors.documents?e.errors.documents[0]:"",class:"mt-2"},null,8,["message"]),t("div",la,[l(te,{type:"button",onClick:I,disabled:!e.projectId||!a.documents||!a.documents.some(r=>r&&typeof r=="object"&&"name"in r&&"size"in r&&"type"in r)||v.value||e.isSaving,class:"px-6 py-3 rounded-lg text-lg shadow-md hover:shadow-lg transition-all duration-200"},{default:K(()=>[v.value?(o(),d("span",oa,"Uploading...")):(o(),d("span",na,"Upload Selected Documents"))]),_:1},8,["disabled"]),e.projectId?f("",!0):(o(),d("p",ra," Please save the project first before uploading documents. "))])])):f("",!0),e.canViewProjectDocuments&&a.documents&&a.documents.length>0?(o(),d("div",ia,[s[7]||(s[7]=t("h3",{class:"text-xl font-semibold text-gray-800 mb-5"},"Existing Project Documents",-1)),t("ul",da,[(o(!0),d(ue,null,ce(a.documents,(r,k)=>(o(),d("li",{key:k,class:"flex items-center justify-between p-4 bg-gray-50 rounded-md border border-gray-100 shadow-sm transition-shadow hover:shadow-md duration-200"},[t("div",ua,[t("span",ca,[typeof r=="object"&&"type"in r&&r.type.includes("image")?(o(),d("svg",ma,s[1]||(s[1]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 002.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"},null,-1)]))):typeof r=="object"&&"type"in r&&r.type.includes("pdf")?(o(),d("svg",va,s[2]||(s[2]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"},null,-1)]))):typeof r=="object"&&"type"in r&&(r.type.includes("word")||r.type.includes("document"))?(o(),d("svg",pa,s[3]||(s[3]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"},null,-1)]))):(o(),d("svg",ga,s[4]||(s[4]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"},null,-1)])))]),typeof r=="object"&&"path"in r?(o(),d("a",{key:0,href:`/storage/${r.path}`,target:"_blank",class:"text-blue-600 hover:text-blue-800 hover:underline font-medium break-all mr-4"},C(r.filename),9,ya)):(o(),d("span",fa,[F(C(r.name)+" ",1),s[5]||(s[5]=t("span",{class:"text-gray-500 text-sm"},"(Pending Upload)",-1))]))]),e.canUploadProjectDocuments?(o(),d("button",{key:0,type:"button",onClick:w=>b(k),class:"p-2 rounded-full text-red-500 hover:bg-red-100 hover:text-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 transition-colors duration-200",title:"Remove document",disabled:v.value||e.isSaving},s[6]||(s[6]=[t("svg",{class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]),8,ba)):f("",!0)]))),128))])])):e.canViewProjectDocuments?(o(),d("div",wa," No documents found for this project. ")):f("",!0),s[8]||(s[8]=t("div",{class:"mt-6 p-4 bg-blue-50 rounded-lg text-blue-700 text-sm border border-blue-200"},[t("p",null,"Note: Uploaded documents will be stored in the project's designated Google Drive folder.")],-1))]))}},xa={class:"p-6 bg-white rounded-lg font-inter"},ka={key:0,class:"p-6 bg-gray-50 rounded-lg text-gray-600 text-center border border-gray-200 shadow-sm"},ja={key:1},_a={class:"mb-6 flex justify-between items-center"},Pa={key:0,class:"flex items-center"},$a={key:1},Sa={key:0,class:"text-sm text-red-500 mb-4 bg-red-50 p-3 rounded-md border border-red-200"},Va={key:1,class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6"},Ca={class:"flex justify-between items-start mb-3"},Da=["onClick","disabled"],Ia=["onUpdate:modelValue","readonly"],Ua={class:"mt-auto pt-3 border-t border-gray-100 text-xs text-gray-500 flex justify-between items-center"},Ma={class:"font-medium text-gray-700"},Aa={key:2,class:"p-8 bg-gray-50 rounded-lg text-gray-600 text-center border border-gray-200 shadow-sm flex flex-col items-center justify-center h-64"},Na={__name:"ProjectFormNotes",props:{projectId:{type:[Number,String],required:!0},errors:{type:Object,default:()=>({})},canAddProjectNotes:{type:Boolean,default:!1},canViewProjectNotes:{type:Boolean,default:!1},isSaving:{type:Boolean,default:!1}},setup(e){const p=e,a=pe({notes:[]}),y=$(!1),v=async()=>{if(p.projectId)try{const n=await xe(p.projectId,"notes",{canViewProjectNotes:p.canViewProjectNotes,canAddProjectNotes:p.canAddProjectNotes});n&&(a.notes=n.map(s=>{var r,k;return{id:s.id,content:s.content,created_at:s.created_at,creator_name:s.creator_name||((r=s.user)==null?void 0:r.name)||((k=s.creator)==null?void 0:k.name)||"Unknown"}})||[])}catch(n){console.error("Error fetching notes data:",n),E("Failed to load notes data.")}};le(()=>p.projectId,async n=>{n&&await v()},{immediate:!0});const P=()=>{p.canAddProjectNotes&&a.notes.push({id:null,content:"",created_at:new Date().toISOString(),creator_name:"You"})},T=n=>{p.canAddProjectNotes&&a.notes.splice(n,1)},I=async()=>{if(!p.projectId){E("Project ID is missing. Cannot save notes.");return}y.value=!0;const n=a.notes.map(s=>({id:s.id||null,content:s.content}));try{const s=await window.axios.put(`/api/projects/${p.projectId}/sections/notes?type=private`,{notes:n});a.notes=s.data.notes.map(r=>{var k,w;return{id:r.id,content:r.content,created_at:r.created_at,creator_name:r.creator_name||((k=r.user)==null?void 0:k.name)||((w=r.creator)==null?void 0:w.name)||"Unknown"}})||[],ne("Notes updated successfully!"),await v()}catch(s){console.error("Error updating notes:",s),E("Failed to update notes.")}finally{y.value=!1}},b=n=>n?new Date(n).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A";return me(()=>{}),(n,s)=>(o(),d("div",xa,[e.canViewProjectNotes?(o(),d("div",ja,[t("div",_a,[l(te,{onClick:P,type:"button",class:"px-5 py-2.5 rounded-lg text-base shadow-sm hover:shadow-md transition-all duration-200",disabled:!e.canAddProjectNotes||y.value||e.isSaving},{default:K(()=>s[0]||(s[0]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 4v16m8-8H4"})],-1),F(" Add New Note ",-1)])),_:1,__:[0]},8,["disabled"]),l(te,{onClick:I,disabled:!e.projectId||!e.canAddProjectNotes||y.value||e.isSaving,class:W([{"opacity-50 cursor-not-allowed":y.value||e.isSaving},"px-6 py-3 rounded-lg text-lg shadow-md hover:shadow-lg transition-all duration-200"])},{default:K(()=>[y.value||e.isSaving?(o(),d("span",Pa,s[1]||(s[1]=[t("svg",{class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),F(" Saving... ",-1)]))):(o(),d("span",$a,"Save All Notes"))]),_:1},8,["disabled","class"])]),e.projectId?f("",!0):(o(),d("p",Sa," Please save the project first before adding or editing notes. ")),a.notes&&a.notes.length>0?(o(),d("div",Va,[(o(!0),d(ue,null,ce(a.notes,(r,k)=>(o(),d("div",{key:r.id||`new-note-${k}`,class:W(["relative bg-white p-5 rounded-lg shadow-md border border-gray-200 flex flex-col h-64 transition-all duration-200 ease-in-out hover:shadow-lg",{"opacity-75 cursor-not-allowed":!e.canAddProjectNotes||y.value||e.isSaving}])},[t("div",Ca,[l(M,{value:`Note ${k+1}`,class:"text-sm font-semibold text-gray-700"},null,8,["value"]),e.canAddProjectNotes?(o(),d("button",{key:0,type:"button",onClick:w=>T(k),class:"p-1 rounded-full text-red-500 hover:bg-red-100 hover:text-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 transition-colors duration-200",title:"Remove note",disabled:y.value||e.isSaving},s[2]||(s[2]=[t("svg",{class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1)]),8,Da)):f("",!0)]),ge(t("textarea",{"onUpdate:modelValue":w=>r.content=w,readonly:!e.canAddProjectNotes||y.value||e.isSaving,placeholder:"Type your note content here...",class:"flex-grow border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-lg shadow-sm block w-full resize-none transition-colors duration-200 p-3 text-sm overflow-auto",rows:"6"},null,8,Ia),[[ke,r.content]]),l(O,{message:e.errors[`notes.${k}.content`]?e.errors[`notes.${k}.content`][0]:"",class:"mt-2"},null,8,["message"]),t("div",Ua,[t("span",null,[s[3]||(s[3]=F("By: ",-1)),t("span",Ma,C(r.creator_name||"Unknown"),1)]),t("span",null,"Last updated: "+C(b(r.created_at)),1)])],2))),128))])):(o(),d("div",Aa,s[4]||(s[4]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-16 w-16 text-gray-400 mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"1"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1),t("p",{class:"text-lg font-medium"},"No notes found for this project.",-1),t("p",{class:"text-sm mt-2"},'Click "Add New Note" to start creating your project notes.',-1)])))])):(o(),d("div",ka," You do not have permission to view project notes. "))]))}},Ba=["value","rows"],Ta={__name:"TextareaInput",props:{modelValue:[String,Number],rows:{type:[String,Number],default:3}},emits:["update:modelValue"],setup(e){const p=$(null);return me(()=>{p.value.hasAttribute("autofocus")&&p.value.focus()}),(a,y)=>(o(),d("textarea",{class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full",value:e.modelValue,rows:e.rows,onInput:y[0]||(y[0]=v=>a.$emit("update:modelValue",v.target.value)),ref_key:"input",ref:p},null,40,Ba))}},Oa={class:"p-6 bg-gray-50 rounded-xl shadow-lg"},Ra={class:"flex justify-between items-center mb-6"},Fa={key:0,class:"flex justify-center py-8"},Ea={key:1,class:"bg-white p-8 rounded-lg text-center border border-dashed border-gray-300"},za={key:2,class:"space-y-6"},La={class:"flex justify-between items-start"},qa={class:"text-xl font-medium text-gray-900"},Ka={class:"mt-2 flex items-center flex-wrap space-x-4 text-sm text-gray-500"},Ha={key:0,class:"text-gray-700"},Ga={key:1,class:"text-gray-700"},Ya={key:0,class:"mt-4 text-base text-gray-600"},Wa={key:0,class:"flex space-x-2"},Ja={class:"p-6 bg-white rounded-lg"},Xa={class:"text-2xl font-bold text-gray-900 mb-6"},Qa={class:"p-4 bg-indigo-50 rounded-lg border border-indigo-200"},Za={class:"flex justify-end space-x-3 mt-6"},es={__name:"ProjectDeliverables",props:{projectId:{type:[Number,String],required:!0},errors:{type:Object,default:()=>({})},isSaving:{type:Boolean,default:!1},canManageProjectDeliverables:{type:Boolean,default:!1},canViewProjectDeliverables:{type:Boolean,default:!0}},emits:["checklist-item-toggled"],setup(e,{emit:p}){const a=e,y=$([]),v=$([]),P=$(!0),T=$([]),I=$(!1),b=$("create"),n=$({id:null,name:"",description:"",milestone_id:null,status:"pending",due_date:"",details:{deliverable_type_key:null,checklist:[]}}),s=$({}),r=[{value:"pending",label:"Pending"},{value:"in_progress",label:"In Progress"},{value:"completed",label:"Completed"},{value:"cancelled",label:"Cancelled"}],k=q(()=>{const j=v.value.find(h=>{var u;return h.key===((u=n.value.details)==null?void 0:u.deliverable_type_key)});return(j==null?void 0:j.checklistItemPlaceholder)||"e.g., Task 1, Task 2, Task 3"});le(()=>a.projectId,w,{immediate:!0});async function w(){if(a.projectId){P.value=!0;try{const j=await ie.get(`/api/projects/${a.projectId}/project-deliverables`);y.value=j.data;const h=await ie.get(`/api/projects/${a.projectId}/milestones`);T.value=h.data;const u=await ie.get("/api/project-deliverable-types");v.value=u.data}catch(j){console.error("Error fetching data:",j),E("Failed to load project data")}finally{P.value=!1}}}function A(){b.value="create",n.value={id:null,name:"",description:"",milestone_id:null,status:"pending",due_date:"",details:{deliverable_type_key:null,checklist:[{name:"",completed:!1}]}},s.value={},I.value=!0}function J(j){b.value="edit",n.value=JSON.parse(JSON.stringify(j)),n.value.details.checklist||(n.value.details.checklist=[]),(n.value.details.checklist.length===0||n.value.details.checklist[n.value.details.checklist.length-1].name!=="")&&n.value.details.checklist.push({name:"",completed:!1}),s.value={},I.value=!0}async function X(){s.value={};try{let j;const h=n.value.details.checklist.filter(U=>U.name.trim()!==""),u={...n.value,details:{...n.value.details,checklist:h}};b.value==="create"?(j=await ie.post(`/api/projects/${a.projectId}/project-deliverables`,u),ne("Project deliverable created successfully")):(j=await ie.put(`/api/project-deliverables/${n.value.id}`,u),ne("Project deliverable updated successfully")),await w(),I.value=!1}catch(j){console.error("Error saving deliverable:",j),j.response&&j.response.data&&j.response.data.errors?s.value=j.response.data.errors:E("Failed to save project deliverable")}}async function Q(j){if(confirm("Are you sure you want to delete this deliverable?"))try{await ie.delete(`/api/project-deliverables/${j}`),ne("Project deliverable deleted successfully"),await w()}catch(h){console.error("Error deleting deliverable:",h),E("Failed to delete project deliverable")}}function N(j){return j?new Date(j).toLocaleDateString():"N/A"}return(j,h)=>(o(),d("div",Oa,[t("div",Ra,[h[11]||(h[11]=t("h3",{class:"text-2xl font-bold text-gray-900"},"Project Deliverables",-1)),e.canManageProjectDeliverables?(o(),ee(te,{key:0,onClick:A,disabled:e.isSaving||P.value},{default:K(()=>h[10]||(h[10]=[F(" Add Deliverable ",-1)])),_:1,__:[10]},8,["disabled"])):f("",!0)]),P.value?(o(),d("div",Fa,h[12]||(h[12]=[t("div",{class:"animate-spin rounded-full h-10 w-10 border-b-2 border-indigo-600"},null,-1)]))):y.value.length===0?(o(),d("div",Ea,[h[14]||(h[14]=t("p",{class:"text-gray-600 text-lg"},"No deliverables have been added to this project yet.",-1)),e.canManageProjectDeliverables?(o(),ee(te,{key:0,onClick:A,class:"mt-6"},{default:K(()=>h[13]||(h[13]=[F(" Add Your First Deliverable ",-1)])),_:1,__:[13]})):f("",!0)])):(o(),d("div",za,[(o(!0),d(ue,null,ce(y.value,u=>{var U;return o(),d("div",{key:u.id,class:"bg-white border border-gray-200 rounded-xl p-6 shadow-sm hover:shadow-lg transition-all duration-300"},[t("div",La,[t("div",null,[t("h4",qa,C(u.name),1),t("div",Ka,[t("span",{class:W({"font-medium py-1 px-3 rounded-full text-white":!0,"bg-yellow-500":u.status==="pending","bg-blue-500":u.status==="in_progress","bg-green-500":u.status==="completed","bg-red-500":u.status==="cancelled"})},C(u.status.replace("_"," ").toUpperCase()),3),u.milestone?(o(),d("span",Ha,[h[15]||(h[15]=t("span",{class:"font-semibold"},"Milestone:",-1)),F(" "+C(u.milestone.name),1)])):f("",!0),u.due_date?(o(),d("span",Ga,[h[16]||(h[16]=t("span",{class:"font-semibold"},"Due:",-1)),F(" "+C(N(u.due_date)),1)])):f("",!0)]),u.description?(o(),d("p",Ya,C(u.description),1)):f("",!0),(U=u.details)!=null&&U.checklist&&u.details.checklist.length>0?(o(),ee(at,{key:1,items:u.details.checklist,"api-endpoint":`/api/project-deliverables/${u.id}`,title:"Deliverable Checklist:","payload-transformer":(S,H)=>({...u,details:{...u.details,checklist:S}}),onItemToggled:S=>j.$emit("checklist-item-toggled",{deliverable:u,index:S.index,completed:S.completed})},null,8,["items","api-endpoint","payload-transformer","onItemToggled"])):f("",!0)]),e.canManageProjectDeliverables?(o(),d("div",Wa,[l(be,{onClick:S=>J(u),size:"sm"},{default:K(()=>h[17]||(h[17]=[F(" Edit ",-1)])),_:2,__:[17]},1032,["onClick"]),l(nt,{onClick:S=>Q(u.id),size:"sm"},{default:K(()=>h[18]||(h[18]=[F(" Delete ",-1)])),_:2,__:[18]},1032,["onClick"])])):f("",!0)])])}),128))])),l(rt,{show:I.value,onClose:h[9]||(h[9]=u=>I.value=!1),maxWidth:"2xl"},{default:K(()=>{var u,U,S,H,Y;return[t("div",Ja,[t("h3",Xa,C(b.value==="create"?"Add New Deliverable":"Edit Deliverable"),1),t("form",{onSubmit:He(X,["prevent"]),class:"space-y-6"},[t("div",null,[l(M,{for:"name",value:"Name"}),l(G,{id:"name",modelValue:n.value.name,"onUpdate:modelValue":h[0]||(h[0]=g=>n.value.name=g),type:"text",class:"mt-1 block w-full",required:""},null,8,["modelValue"]),l(O,{message:(u=s.value.name)==null?void 0:u[0],class:"mt-2"},null,8,["message"])]),t("div",null,[l(M,{for:"description",value:"Description"}),l(Ta,{id:"description",modelValue:n.value.description,"onUpdate:modelValue":h[1]||(h[1]=g=>n.value.description=g),class:"mt-1 block w-full",rows:"3"},null,8,["modelValue"]),l(O,{message:(U=s.value.description)==null?void 0:U[0],class:"mt-2"},null,8,["message"])]),t("div",null,[l(M,{for:"milestone_id",value:"Milestone (Optional)"}),l(se,{id:"milestone_id",modelValue:n.value.milestone_id,"onUpdate:modelValue":h[2]||(h[2]=g=>n.value.milestone_id=g),options:T.value,valueKey:"id",labelKey:"name",placeholder:"Select a milestone",class:"mt-1 block w-full"},null,8,["modelValue","options"]),l(O,{message:(S=s.value.milestone_id)==null?void 0:S[0],class:"mt-2"},null,8,["message"])]),t("div",null,[l(M,{for:"status",value:"Status"}),l(se,{id:"status",modelValue:n.value.status,"onUpdate:modelValue":h[3]||(h[3]=g=>n.value.status=g),options:r,valueKey:"value",labelKey:"label",placeholder:"Select a Status",class:"mt-1 block w-full"},null,8,["modelValue"]),l(O,{message:(H=s.value.status)==null?void 0:H[0],class:"mt-2"},null,8,["message"])]),t("div",null,[l(M,{for:"due_date",value:"Due Date (Optional)"}),l(G,{id:"due_date",modelValue:n.value.due_date,"onUpdate:modelValue":h[4]||(h[4]=g=>n.value.due_date=g),type:"date",class:"mt-1 block w-full"},null,8,["modelValue"]),l(O,{message:(Y=s.value.due_date)==null?void 0:Y[0],class:"mt-2"},null,8,["message"])]),t("div",Qa,[h[19]||(h[19]=t("h4",{class:"text-lg font-semibold text-indigo-800 mb-4"},"Deliverable Checklist",-1)),t("div",null,[l(M,{for:"deliverable_type_key",value:"Deliverable Type"}),l(se,{id:"deliverable_type_key",modelValue:n.value.details.deliverable_type_key,"onUpdate:modelValue":[h[5]||(h[5]=g=>n.value.details.deliverable_type_key=g),h[6]||(h[6]=g=>n.value.details={deliverable_type_key:g,checklist:[{name:"",completed:!1}]})],options:v.value,valueKey:"key",labelKey:"name",placeholder:"Select a Deliverable Type",class:"mt-1 block w-full",required:""},null,8,["modelValue","options"])]),l(st,{modelValue:n.value.details.checklist,"onUpdate:modelValue":h[7]||(h[7]=g=>n.value.details.checklist=g),placeholder:k.value,label:"Checklist Items",containerClass:"mt-4"},null,8,["modelValue","placeholder"])]),t("div",Za,[l(be,{onClick:h[8]||(h[8]=g=>I.value=!1),disabled:e.isSaving},{default:K(()=>h[20]||(h[20]=[F(" Cancel ",-1)])),_:1,__:[20]},8,["disabled"]),l(te,{type:"submit",disabled:e.isSaving},{default:K(()=>[F(C(b.value==="create"?"Create":"Update"),1)]),_:1},8,["disabled"])])],32)])]}),_:1},8,["show"])]))}},ts={class:"p-6 bg-white rounded-lg font-inter"},as={key:0,class:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4",role:"alert"},ss={class:"block sm:inline ml-2"},ls={key:1,class:"flex items-center justify-center py-8"},os={key:2},ns={key:0,class:"bg-gradient-to-r from-blue-500 to-indigo-600 text-white p-6 rounded-lg shadow-md mb-6"},rs={class:"flex items-center justify-between"},is={class:"text-3xl font-bold mt-1"},ds={class:"text-sm opacity-90 mt-2"},us={class:"font-semibold"},cs={class:"font-semibold"},ms={key:1,class:"bg-gray-100 text-gray-600 p-4 rounded-lg shadow-sm mb-6 text-center"},vs={class:"bg-gray-50 p-6 rounded-lg shadow-sm mb-6 border border-gray-200"},ps={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},gs=["disabled"],ys=["value"],fs={class:"bg-gray-50 p-6 rounded-lg shadow-sm mb-6 border border-gray-200"},bs={class:"mb-4"},ws={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-1 gap-4"},hs={class:"flex items-center justify-between"},xs=["for"],ks={class:"ms-2 text-base font-medium text-gray-800"},js=["onClick"],_s={key:0,class:"mt-4 pt-4 border-t border-gray-200"},Ps={class:"grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4"},$s={class:"grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4"},Ss=["id","onUpdate:modelValue","disabled"],Vs={key:0,class:"mt-4 p-4 bg-blue-50 rounded-lg border border-blue-200"},Cs={class:"flex justify-between items-center mb-3"},Ds={class:"space-y-4"},Is={class:"flex justify-between items-center mb-2"},Us=["onClick"],Ms={class:"grid grid-cols-1 sm:grid-cols-2 gap-4"},As=["onClick"],Ns={key:0},Bs={class:"mt-6 pt-4 border-t border-gray-200"},Ts={key:1,class:"mt-4 flex items-center"},Os={key:2,class:"mt-6 flex justify-end"},Rs={__name:"ServicesAndPaymentForm",props:{projectId:{type:[Number,String],required:!0},paymentTypeOptions:{type:Array,required:!0},canManageProjectServicesAndPayments:{type:Boolean,required:!0},canViewProjectServicesAndPayments:{type:Boolean,required:!0}},emits:["updated"],setup(e,{emit:p}){const a=e,y=p,v=$({}),P=$(!1),T=[{value:"PKR",label:"PKR"},{value:"AUD",label:"AUD"},{value:"INR",label:"INR"},{value:"USD",label:"USD"},{value:"EUR",label:"EUR"},{value:"GBP",label:"GBP"}],b=$([...[{value:"Website Designing",label:"Website Designing"},{value:"SEO",label:"SEO"},{value:"Social Media",label:"Social Media"},{value:"Content Writing",label:"Content Writing"},{value:"Graphic Design",label:"Graphic Design"}]]),n=$(""),s=$(!1),r=pe({services:[],service_details:[],payment_type:"one_off",currency:"AUD"}),k=pe({}),w=q(()=>{let g=0;return r.services.forEach(c=>{const i=u(c);i&&i.amount&&(g+=parseFloat(i.amount))}),g.toFixed(2)}),A=q(()=>{let g=null,c=null;const i=new Date;return i.setHours(0,0,0,0),r.service_details.forEach(x=>{x.frequency==="one_off"&&x.payment_breakdown&&x.payment_breakdown.forEach(B=>{var R;if(B.due_date){const L=new Date(B.due_date);L.setHours(0,0,0,0),L>=i&&(!g||L<g.date)&&(g={date:L,serviceId:x.service_id,paymentLabel:B.label},c=((R=b.value.find(ve=>ve.value===x.service_id))==null?void 0:R.label)||x.service_id)}})}),g?{date:g.date.toLocaleDateString(),serviceLabel:c,paymentLabel:g.paymentLabel}:null}),J=q(()=>{const g=r.services.filter(c=>{const i=u(c);return i&&i.frequency!=="monthly"});return g.length===0?!0:g.every(c=>U(c)===100)}),X=q(()=>!a.projectId||!a.canManageProjectServicesAndPayments||!J.value),Q=()=>{const g=n.value.trim();g&&!b.value.some(c=>c.label.toLowerCase()===g.toLowerCase())&&(b.value.push({value:g,label:g}),n.value="",s.value=!1)},N=async()=>{if(a.projectId){P.value=!0;try{const c=(await window.axios.get(`/api/projects/${a.projectId}/sections/services-payment`)).data;return r.services=c.services||[],r.service_details=c.service_details||[],r.payment_type=c.payment_type||"one_off",r.currency=c.currency||"AUD",r.services.forEach(i=>{b.value.some(x=>x.value===i)||b.value.push({value:i,label:i}),k[i]=!1}),r.service_details.forEach(i=>{if(i.payment_breakdown&&!Array.isArray(i.payment_breakdown)){const x=i.payment_breakdown;i.payment_breakdown=[{label:"First",percentage:parseInt(x.first)||30,due_date:null},{label:"Second",percentage:parseInt(x.second)||30,due_date:null},{label:"Third",percentage:parseInt(x.third)||40,due_date:null}]}else!i.payment_breakdown||i.payment_breakdown.length===0?i.payment_breakdown=[{label:"Payment 1",percentage:100,due_date:null}]:i.payment_breakdown.forEach(x=>{x.due_date===void 0&&(x.due_date=null)})}),c}catch(g){return console.error("Error fetching services and payment data:",g),v.value.general="Failed to fetch services and payment data.",null}finally{P.value=!1}}},j=async()=>{v.value={},P.value=!0;try{const g={services:r.services,service_details:r.service_details,total_amount:parseFloat(w.value),payment_type:r.payment_type,currency:r.currency},c=await window.axios.put(`/api/projects/${a.projectId}/sections/services-payment`,g);ne("Services and payment information updated successfully!"),y("updated")}catch(g){g.response&&g.response.status===422?v.value=g.response.data.errors:g.response&&g.response.data.message?v.value.general=g.response.data.message:(v.value.general="Failed to update services and payment information.",console.error("Error:",g))}finally{P.value=!1}},h=(g,c)=>{c?(r.service_details.some(i=>i.service_id===g)||r.service_details.push({service_id:g,amount:"",frequency:"one_off",start_date:"",payment_breakdown:[{label:"Payment 1",percentage:100,due_date:null}],currency:r.currency}),k[g]=!0):(r.service_details=r.service_details.filter(i=>i.service_id!==g),k[g]=!1)},u=g=>{let c=r.service_details.find(i=>i.service_id===g);if(!c)c={service_id:g,amount:"",frequency:"one_off",start_date:"",payment_breakdown:[{label:"Payment 1",percentage:100,due_date:null}],currency:r.currency},r.service_details.push(c);else if(c.payment_breakdown&&!Array.isArray(c.payment_breakdown)){const i=c.payment_breakdown;c.payment_breakdown=[{label:"First",percentage:parseInt(i.first)||30,due_date:null},{label:"Second",percentage:parseInt(i.second)||30,due_date:null},{label:"Third",percentage:parseInt(i.third)||40,due_date:null}]}else!c.payment_breakdown||c.payment_breakdown.length===0?c.payment_breakdown=[{label:"Payment 1",percentage:100,due_date:null}]:c.payment_breakdown.forEach(i=>{i.due_date===void 0&&(i.due_date=null)});return c},U=g=>{const c=u(g);return!c.payment_breakdown||!Array.isArray(c.payment_breakdown)?0:c.payment_breakdown.reduce((i,x)=>i+(parseInt(x.percentage)||0),0)},S=g=>{const c=u(g);if(c.payment_breakdown||(c.payment_breakdown=[]),!Array.isArray(c.payment_breakdown)){const B=c.payment_breakdown;c.payment_breakdown=[{label:"First",percentage:parseInt(B.first)||30,due_date:null},{label:"Second",percentage:parseInt(B.second)||30,due_date:null},{label:"Third",percentage:parseInt(B.third)||40,due_date:null}]}const i=c.payment_breakdown.length;let x=0;if(i>0){const B=c.payment_breakdown[i-1];x=Math.floor(B.percentage/2),B.percentage-=x}else x=100;c.payment_breakdown.push({label:`Payment ${i+1}`,percentage:x,due_date:null})},H=(g,c)=>{const i=u(g);if(!i.payment_breakdown||!Array.isArray(i.payment_breakdown)||i.payment_breakdown.length<=1)return;const x=parseInt(i.payment_breakdown[c].percentage)||0;if(i.payment_breakdown.splice(c,1),x>0&&i.payment_breakdown.length>0){const B=c>0&&c<=i.payment_breakdown.length?c-1:0;i.payment_breakdown[B].percentage=(parseInt(i.payment_breakdown[B].percentage)||0)+x}i.payment_breakdown.forEach((B,R)=>{B.label=`Payment ${R+1}`})},Y=g=>{k[g]=!k[g]};return le(()=>a.projectId,g=>{g&&N()},{immediate:!0}),(g,c)=>(o(),d("div",ts,[v.value.general?(o(),d("div",as,[c[6]||(c[6]=t("strong",{class:"font-bold"},"Error!",-1)),t("span",ss,C(v.value.general),1)])):f("",!0),P.value?(o(),d("div",ls,c[7]||(c[7]=[t("svg",{class:"animate-spin -ml-1 mr-3 h-8 w-8 text-blue-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),t("span",{class:"text-gray-600"},"Loading services and payment data...",-1)]))):(o(),d("div",os,[A.value?(o(),d("div",ns,[t("div",rs,[t("div",null,[c[10]||(c[10]=t("p",{class:"text-sm opacity-90"},"Next Payment Due",-1)),t("p",is,C(A.value.date),1),t("p",ds,[c[8]||(c[8]=F(" For: ",-1)),t("span",us,C(A.value.serviceLabel),1),c[9]||(c[9]=F(" - ",-1)),t("span",cs,C(A.value.paymentLabel),1)])]),c[11]||(c[11]=t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-12 w-12 opacity-70",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1))])])):(o(),d("div",ms," No upcoming payment due dates found for one-off services. ")),t("div",vs,[c[13]||(c[13]=t("h4",{class:"text-xl font-semibold text-gray-700 mb-4"},"Overall Project Payment Details",-1)),t("div",ps,[t("div",null,[l(M,{for:"calculated_total_amount",value:"Calculated Total Amount"}),l(G,{id:"calculated_total_amount",type:"text",class:"mt-1 block w-full bg-gray-100 cursor-not-allowed",value:w.value,disabled:""},null,8,["value"]),c[12]||(c[12]=t("p",{class:"text-sm text-gray-500 mt-1"},"This amount is automatically calculated from selected services.",-1))]),t("div",null,[l(M,{for:"payment_type",value:"Payment Type"}),ge(t("select",{id:"payment_type",class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full p-2.5","onUpdate:modelValue":c[0]||(c[0]=i=>r.payment_type=i),required:"",disabled:!e.canManageProjectServicesAndPayments},[(o(!0),d(ue,null,ce(e.paymentTypeOptions,i=>(o(),d("option",{key:i.value,value:i.value},C(i.label),9,ys))),128))],8,gs),[[Ve,r.payment_type]]),l(O,{message:v.value.payment_type?v.value.payment_type[0]:"",class:"mt-2"},null,8,["message"])]),t("div",null,[l(M,{for:"overall_currency",value:"Overall Project Currency"}),l(se,{id:"overall_currency",modelValue:r.currency,"onUpdate:modelValue":c[1]||(c[1]=i=>r.currency=i),options:T,"value-key":"value","label-key":"label",class:"w-full mt-1",disabled:!e.canManageProjectServicesAndPayments},null,8,["modelValue","disabled"]),l(O,{message:v.value.currency?v.value.currency[0]:"",class:"mt-2"},null,8,["message"])])])]),t("div",fs,[c[20]||(c[20]=t("h4",{class:"text-xl font-semibold text-gray-700 mb-4"},"Manage Services",-1)),t("div",bs,[l(M,{for:"services",value:"Select Services",class:"mb-2"}),t("div",ws,[(o(!0),d(ue,null,ce(b.value,i=>(o(),d("div",{key:i.value,class:"bg-white p-4 rounded-lg shadow-sm border border-gray-200"},[t("div",hs,[t("label",{for:`service_${i.value}`,class:"flex items-center cursor-pointer"},[l(it,{id:`service_${i.value}`,value:i.value,checked:r.services,"onUpdate:checked":[c[2]||(c[2]=x=>r.services=x),x=>h(i.value,x)],disabled:!e.canManageProjectServicesAndPayments},null,8,["id","value","checked","onUpdate:checked","disabled"]),t("span",ks,C(i.label),1)],8,xs),(r.services||[]).includes(i.value)?(o(),d("button",{key:0,onClick:x=>Y(i.value),type:"button",class:W(["text-gray-500 hover:text-gray-700 transition-transform duration-200",{"rotate-180":k[i.value]}])},c[14]||(c[14]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"})],-1)]),10,js)):f("",!0)]),(r.services||[]).includes(i.value)&&k[i.value]?(o(),d("div",_s,[t("div",Ps,[t("div",null,[l(M,{for:`service_amount_${i.value}`,value:"Amount"},null,8,["for"]),l(G,{id:`service_amount_${i.value}`,type:"number",step:"0.01",placeholder:"Service Amount",class:"w-full mt-1",modelValue:u(i.value).amount,"onUpdate:modelValue":x=>u(i.value).amount=x,disabled:!e.canManageProjectServicesAndPayments},null,8,["id","modelValue","onUpdate:modelValue","disabled"])]),t("div",null,[l(M,{for:`service_currency_${i.value}`,value:"Currency"},null,8,["for"]),l(se,{id:`service_currency_${i.value}`,modelValue:u(i.value).currency,"onUpdate:modelValue":x=>u(i.value).currency=x,options:T,"value-key":"value","label-key":"label",class:"w-full mt-1",disabled:!e.canManageProjectServicesAndPayments},null,8,["id","modelValue","onUpdate:modelValue","disabled"])])]),t("div",$s,[t("div",null,[l(M,{for:`service_frequency_${i.value}`,value:"Frequency"},null,8,["for"]),ge(t("select",{id:`service_frequency_${i.value}`,class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full p-2.5","onUpdate:modelValue":x=>u(i.value).frequency=x,disabled:!e.canManageProjectServicesAndPayments},c[15]||(c[15]=[t("option",{value:"monthly"},"Monthly",-1),t("option",{value:"one_off"},"One off",-1)]),8,Ss),[[Ve,u(i.value).frequency]])]),t("div",null,[l(M,{for:`service_start_date_${i.value}`,value:"Start Date"},null,8,["for"]),l(G,{id:`service_start_date_${i.value}`,type:"date",class:"w-full mt-1",modelValue:u(i.value).start_date,"onUpdate:modelValue":x=>u(i.value).start_date=x,disabled:!e.canManageProjectServicesAndPayments},null,8,["id","modelValue","onUpdate:modelValue","disabled"])])]),u(i.value).frequency!=="monthly"?(o(),d("div",Vs,[t("div",Cs,[l(M,{value:"Payment Breakdown (%)",class:"text-base font-medium text-blue-800"}),e.canManageProjectServicesAndPayments?(o(),ee(te,{key:0,type:"button",onClick:x=>S(i.value),class:"px-4 py-2 text-sm"},{default:K(()=>c[16]||(c[16]=[F(" + Add Payment Step ",-1)])),_:2,__:[16]},1032,["onClick"])):f("",!0)]),t("div",Ds,[(o(!0),d(ue,null,ce(u(i.value).payment_breakdown,(x,B)=>(o(),d("div",{key:B,class:"bg-white p-4 rounded-md shadow-sm border border-blue-100"},[t("div",Is,[l(M,{for:`payment_label_${B}_${i.value}`,value:x.label,class:"font-semibold"},null,8,["for","value"]),e.canManageProjectServicesAndPayments&&u(i.value).payment_breakdown.length>1?(o(),d("button",{key:0,type:"button",class:"text-red-500 hover:text-red-700 p-1 rounded-full hover:bg-red-100 transition-colors",onClick:R=>H(i.value,B),title:"Remove payment step"},c[17]||(c[17]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor"},[t("path",{"fill-rule":"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 011-1h4a1 1 0 110 2H8a1 1 0 01-1-1zm-1 3a1 1 0 100 2h8a1 1 0 100-2H6z","clip-rule":"evenodd"})],-1)]),8,Us)):f("",!0)]),t("div",Ms,[t("div",null,[l(M,{for:`payment_percentage_${B}_${i.value}`,value:"Percentage (%)",class:"text-sm"},null,8,["for"]),l(G,{id:`payment_percentage_${B}_${i.value}`,type:"number",min:"0",max:"100",class:"w-full mt-1",modelValue:x.percentage,"onUpdate:modelValue":R=>x.percentage=R,modelModifiers:{number:!0},onInput:R=>{x.percentage=Math.max(0,Math.min(100,parseInt(R.target.value)||0))},disabled:!e.canManageProjectServicesAndPayments},null,8,["id","modelValue","onUpdate:modelValue","onInput","disabled"])]),t("div",null,[l(M,{for:`payment_due_date_${B}_${i.value}`,value:"Due Date (Optional)",class:"text-sm"},null,8,["for"]),l(G,{id:`payment_due_date_${B}_${i.value}`,type:"date",class:"w-full mt-1",modelValue:x.due_date,"onUpdate:modelValue":R=>x.due_date=R,disabled:!e.canManageProjectServicesAndPayments},null,8,["id","modelValue","onUpdate:modelValue","disabled"]),e.canManageProjectServicesAndPayments&&x.due_date?(o(),d("button",{key:0,type:"button",class:"text-xs text-red-500 hover:text-red-700 mt-1",onClick:R=>x.due_date=null}," Clear Date ",8,As)):f("",!0)])])]))),128))]),t("div",{class:W(["text-sm mt-4 p-2 rounded-md",{"bg-green-100 text-green-700":U(i.value)===100,"bg-red-100 text-red-700 font-bold":U(i.value)!==100}])},[F(" Total Percentage: "+C(U(i.value))+"% ",1),U(i.value)!==100?(o(),d("span",Ns," (Total must be 100%) ")):f("",!0)],2)])):f("",!0)])):f("",!0)]))),128))])]),t("div",Bs,[e.canManageProjectServicesAndPayments&&!s.value?(o(),d("button",{key:0,type:"button",class:"inline-flex items-center px-4 py-2 bg-blue-600 border border-transparent rounded-md font-semibold text-xs text-white uppercase tracking-widest hover:bg-blue-700 active:bg-blue-900 focus:outline-none focus:border-blue-900 focus:ring ring-blue-300 disabled:opacity-25 transition ease-in-out duration-150 shadow-md",onClick:c[3]||(c[3]=i=>s.value=!0)},c[18]||(c[18]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 4v16m8-8H4"})],-1),F(" Add New Service/Department ",-1)]))):f("",!0),e.canManageProjectServicesAndPayments&&s.value?(o(),d("div",Ts,[l(G,{type:"text",class:"flex-grow mr-2 border-gray-300 rounded-md shadow-sm p-2.5",modelValue:n.value,"onUpdate:modelValue":c[4]||(c[4]=i=>n.value=i),placeholder:"Enter new service/department name",onKeyup:Ge(Q,["enter"])},null,8,["modelValue"]),l(te,{onClick:Q},{default:K(()=>c[19]||(c[19]=[F("Add",-1)])),_:1,__:[19]}),t("button",{type:"button",class:"ml-2 text-sm text-gray-500 hover:text-gray-700 px-3 py-2 rounded-md transition-colors",onClick:c[5]||(c[5]=i=>{s.value=!1,n.value=""})}," Cancel ")])):f("",!0)]),l(O,{message:v.value.services?v.value.services[0]:"",class:"mt-2"},null,8,["message"])]),e.canManageProjectServicesAndPayments?(o(),d("div",Os,[l(te,{onClick:j,disabled:X.value,class:W([{"opacity-50 cursor-not-allowed":X.value},"px-6 py-3 text-base"])},{default:K(()=>c[21]||(c[21]=[F(" Update Services & Payment ",-1)])),_:1,__:[21]},8,["disabled","class"])])):f("",!0)]))]))}},Z=$({}),Fs=localStorage.getItem("displayCurrency"),Be=$(Fs||"USD");le(Be,e=>{localStorage.setItem("displayCurrency",e)});const Me=async()=>{try{const e=await window.axios.get("/api/currency-rates");Z.value=e.data,console.log("Fetched currency rates:",Z.value)}catch(e){console.error("Failed to fetch currency rates:",e),Z.value={PKR:.0034,AUD:.65,INR:.012,EUR:1.08,GBP:1.28,USD:1}}},oe=(e,p="USD")=>{if(isNaN(e)||e==null)return"0.00";try{return new Intl.NumberFormat("en-US",{style:"currency",currency:p,minimumFractionDigits:2,maximumFractionDigits:2}).format(e)}catch(a){return console.warn(`Error formatting currency for ${e} ${p}:`,a),`${p} ${parseFloat(e).toFixed(2)}`}},fe=(e,p,a)=>{if(isNaN(e)||e==null||!p||!a)return 0;if(p.toUpperCase()===a.toUpperCase())return Number(e);const y=Z.value,v=y[p.toUpperCase()],P=y[a.toUpperCase()];if(!v||!P)return console.warn(`Missing conversion rates for: ${p} or ${a}. Cannot perform conversion.`),Number(e);const I=Number(e)*v/P;return Number(I.toFixed(2))},Es={class:"p-6 bg-white rounded-lg"},zs={key:0,class:"text-red-600 text-sm mb-4"},Ls={key:1,class:"mb-6 p-4 bg-gray-50 rounded-md"},qs={class:"mb-6"},Ks={class:"flex justify-end items-center mb-4"},Hs={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},Gs={class:"p-3 bg-blue-100 rounded-md"},Ys={class:"text-lg font-bold text-blue-800"},Ws={class:"p-3 bg-red-100 rounded-md"},Js={class:"text-lg font-bold text-red-800"},Xs={class:"text-xs text-gray-500"},Qs={class:"p-3 bg-purple-100 rounded-md"},Zs={class:"text-lg font-bold text-purple-800"},el={class:"p-3 bg-green-100 rounded-md"},tl={class:"text-lg font-bold text-green-800"},al={class:"p-3 bg-yellow-100 rounded-md col-span-full md:col-span-1"},sl={class:"text-lg font-bold text-yellow-800"},ll={class:"text-xs text-gray-500"},ol={class:"p-3 bg-orange-100 rounded-md col-span-full md:col-span-1"},nl={class:"text-lg font-bold text-orange-900 mt-1"},rl={class:"text-xs text-gray-500"},il={class:"p-3 bg-gray-100 rounded-md col-span-full md:col-span-1"},dl={class:"text-lg font-bold mt-1 text-green-400"},ul={class:"p-3 bg-gray-100 rounded-md col-span-full md:col-span-1"},cl={class:"text-lg font-bold text-red-400 mt-1"},ml={class:"grid grid-cols-1 gap-4 md:grid-cols-2"},vl={key:0},pl={key:1},gl={class:"mt-4 flex justify-end"},yl={key:2},fl={key:0,class:"space-y-3"},bl={key:1,class:"p-4 bg-gray-50 rounded-md text-gray-600 text-center"},wl={key:2,class:"space-y-4"},hl={class:"flex justify-between items-start mb-2"},xl={class:"flex-grow"},kl={class:"font-medium text-gray-900 text-lg"},jl={class:"text-xs text-gray-500 mt-1"},_l={class:"flex-shrink-0 text-right"},Pl={key:0,class:"text-sm text-gray-600"},$l={class:"flex justify-between items-end text-xs text-gray-600 mt-2 border-t border-gray-200 pt-2"},Sl={key:0,class:"block"},Vl={key:1,class:"block"},Cl={key:2,class:"block mt-1 text-gray-500"},Dl={class:"flex space-x-2 mt-2"},Il={key:0,class:"mt-4 p-4 bg-blue-50 rounded-md border border-blue-200"},Ul={class:"text-md font-medium text-gray-900 mb-4"},Ml={class:"mb-4"},Al={class:"mb-4"},Nl={class:"flex items-center"},Bl=["disabled"],Tl={class:"text-sm text-gray-700"},Ol={key:0,class:"mb-4"},Rl={class:"flex justify-end space-x-2"},Ae=.25,Fl={__name:"ProjectTransactions",props:{projectId:{type:[Number,String],required:!0},userProjectRole:{type:Object,default:()=>({})}},setup(e){const p=e,{canDo:a,canManage:y}=Ne(()=>p.projectId),v=y("project_expenses",p.userProjectRole),P=y("project_income",p.userProjectRole),T=a("view_project_transactions",p.userProjectRole),I=$([]),b=$([]),n=$({}),s=$(""),r=$(!1),k=$(null),w=$(""),A=$(!1),J=$({}),X=$(null),Q=$(""),N=$({description:"",amount:"",currency:"PKR",user_id:null,hours_spent:"",type:"expense"}),j=Be,h=[{value:"PKR",label:"PKR"},{value:"AUD",label:"AUD"},{value:"INR",label:"INR"},{value:"USD",label:"USD"},{value:"EUR",label:"EUR"},{value:"GBP",label:"GBP"}],u=[{value:"expense",label:"Expense"},{value:"income",label:"Income"},{value:"bonus",label:"Bonus"}],U=q(()=>b.value.map(_=>({value:_.id,label:_.name||"Unknown User"}))),S=()=>{const _=new Date,m=_.getFullYear(),z=String(_.getMonth()+1).padStart(2,"0"),ae=String(_.getDate()).padStart(2,"0");return`${m}-${z}-${ae}`},H=async()=>{if(!(!p.projectId||!T.value))try{const _=await window.axios.get(`/api/projects/${p.projectId}/sections/clients-users`);b.value=_.data.users||[]}catch(_){s.value="Failed to fetch users.",console.error("Error fetching users:",_)}},Y=async()=>{if(!(!p.projectId||!T.value)){r.value=!0;try{(!Z.value||Object.keys(Z.value).length===0)&&await Me();const _=await window.axios.get(`/api/projects/${p.projectId}/sections/transactions`);I.value=_.data}catch(_){s.value="Failed to fetch transactions.",console.error("Error fetching transactions:",_)}finally{r.value=!1}}},g=async()=>{var _;if(!v.value&&!P.value){E("You do not have permission to manage transactions.");return}if(!N.value.amount||isNaN(N.value.amount)){n.value.amount=["Please enter a valid amount"];return}if(N.value.type==="expense"&&!v.value){E("You do not have permission to add expenses.");return}if(N.value.type==="income"&&!P.value){E("You do not have permission to add income.");return}if(N.value.type==="bonus"&&!v.value){E("You do not have permission to add bonuses.");return}n.value={},s.value="",r.value=!0;try{const m={...N.value,amount:Number(N.value.amount)},z=await window.axios.post(`/api/projects/${p.projectId}/transactions`,m);await Y(),c(),ne("Transaction saved successfully!")}catch(m){((_=m.response)==null?void 0:_.status)===422?n.value=m.response.data.errors:(s.value="Failed to save transaction.",console.error("Error saving transaction:",m))}finally{r.value=!1}},c=()=>{N.value={description:"",amount:"",currency:"PKR",user_id:null,hours_spent:"",type:"expense"}},i=async _=>{if(!v.value&&!P.value){E("You do not have permission to delete transactions.");return}if(window.confirm("Are you sure you want to delete this transaction?"))try{const m=I.value[_].id;await window.axios.delete(`/api/projects/${p.projectId}/transactions/${m}`),await Y(),ne("Transaction deleted successfully!")}catch(m){s.value="Failed to delete transaction.",console.error("Error deleting transaction:",m)}},x=_=>{if(!v.value&&!P.value){E("You do not have permission to manage transactions.");return}const m=I.value[_];k.value===m.id?(k.value=null,X.value=null,Q.value=""):(X.value=_,k.value=m.id,w.value=m.amount,A.value=!1,J.value={},Q.value=S(),(Number(m.amount)===0||Math.abs(Number(w.value)-Number(m.amount))<.01)&&(A.value=!0))};le(w,_=>{if(X.value!==null){const m=I.value[X.value];A.value=Math.abs(Number(_)-Number(m.amount))<.01}});const B=()=>{k.value=null,X.value=null,w.value="",A.value=!1,J.value={},Q.value=""},R=async()=>{var ae;if(!v.value&&!P.value){E("You do not have permission to manage transactions.");return}const _=X.value,m=I.value[_],z=Number(w.value);if(!A.value&&(!w.value||isNaN(z)||z<=0||z>Number(m.amount))){J.value.amount=["Please enter a valid amount between 0 and "+oe(Number(m.amount),m.currency)];return}if(!Q.value){J.value.date=["Please select a payment date."];return}J.value={},r.value=!0;try{const de=m.id,ye=A.value||Math.abs(z-Number(m.amount))<.01,he={payment_amount:ye?Number(m.amount):z,pay_in_full:ye,transaction_currency:m.currency,transaction_type:m.type,original_description:m.description,payment_date:Q.value};await window.axios.patch(`/api/projects/${p.projectId}/transactions/${de}/process-payment`,he),await Y(),ne("Payment processed successfully!"),B()}catch(de){((ae=de.response)==null?void 0:ae.status)===422?J.value=de.response.data.errors:(s.value="Failed to process payment.",console.error("Error processing payment:",de))}finally{r.value=!1}},L=q(()=>!Z.value||Object.keys(Z.value).length===0?0:I.value.filter(_=>_.type==="income").reduce((_,m)=>_+fe(parseFloat(m.amount||0),m.currency,j.value),0)),ve=q(()=>!Z.value||Object.keys(Z.value).length===0?0:I.value.filter(_=>_.type==="expense").reduce((_,m)=>_+fe(parseFloat(m.amount||0),m.currency,j.value),0)),we=q(()=>!Z.value||Object.keys(Z.value).length===0?0:I.value.filter(_=>_.type==="bonus").reduce((_,m)=>_+fe(parseFloat(m.amount||0),m.currency,j.value),0)),Te=q(()=>oe(L.value,j.value)),Oe=q(()=>oe(ve.value,j.value)),Re=q(()=>oe(we.value,j.value)),Fe=q(()=>{if(!Z.value||Object.keys(Z.value).length===0)return oe(0,j.value);const _=ve.value+we.value;return oe(L.value-_,j.value)}),Ee=q(()=>L.value===0?"0.00%":`${(ve.value/L.value*100).toFixed(2)}%`),ze=q(()=>L.value===0?"0.00%":`${((ve.value+we.value)/L.value*100).toFixed(2)}%`),Le=q(()=>{if(L.value<=0)return oe(0,j.value);const _=L.value*Ae;return oe(_,j.value)}),qe=q(()=>{const _=I.value.filter(z=>(z.type==="expense"||z.type==="bonus")&&z.is_paid&&z.payment_date);if(_.length===0)return"N/A";const m=_.reduce((z,ae)=>new Date(ae.payment_date)>new Date(z.payment_date)?ae:z);return new Date(m.payment_date).toLocaleDateString()}),Ke=q(()=>{const _=I.value.filter(z=>z.type==="income"&&z.payment_date);if(_.length===0)return"N/A";const m=_.reduce((z,ae)=>new Date(ae.payment_date)>new Date(z.payment_date)?ae:z);return new Date(m.payment_date).toLocaleDateString()});return me(async()=>{const _=localStorage.getItem("displayCurrency");_&&(j.value=_),await Me(),Y(),H()}),le([()=>p.projectId,j,Z],()=>{p.projectId&&Z.value&&Object.keys(Z.value).length>0&&(Y(),H())},{deep:!0}),le(j,_=>{_&&localStorage.setItem("displayCurrency",_)},{deep:!0}),(_,m)=>{var z,ae,de,ye,he,je;return o(),d("div",Es,[s.value?(o(),d("div",zs,C(s.value),1)):f("",!0),D(v)||D(P)?(o(),d("div",Ls,[t("div",qs,[t("div",Ks,[m[10]||(m[10]=t("span",{class:"text-sm font-medium text-gray-700 mr-2"},"Currency:",-1)),l(se,{id:"transactions-display-currency-switcher",modelValue:D(j),"onUpdate:modelValue":m[0]||(m[0]=V=>Ye(j)?j.value=V:null),options:h,"value-key":"value","label-key":"label",class:"w-24"},null,8,["modelValue"])]),m[19]||(m[19]=t("h4",{class:"text-md font-medium text-gray-700 mb-2"},"Summary",-1)),t("div",Hs,[t("div",Gs,[m[11]||(m[11]=t("p",{class:"text-sm text-gray-600"},"Total Income",-1)),t("p",Ys,C(Te.value),1)]),t("div",Ws,[m[12]||(m[12]=t("p",{class:"text-sm text-gray-600"},"Total Expenses",-1)),t("p",Js,C(Oe.value),1),t("p",Xs,"("+C(Ee.value)+" of Income)",1)]),t("div",Qs,[m[13]||(m[13]=t("p",{class:"text-sm text-gray-600"},"Total Bonuses",-1)),t("p",Zs,C(Re.value),1)]),t("div",el,[m[14]||(m[14]=t("p",{class:"text-sm text-gray-600"},"Balance",-1)),t("p",tl,C(Fe.value),1)]),t("div",al,[m[15]||(m[15]=t("p",{class:"text-sm text-gray-600"},"Expense + Bonus",-1)),t("p",sl,C(D(oe)(ve.value+we.value,D(j))),1),t("p",ll,"("+C(ze.value)+" of Income)",1)]),t("div",ol,[m[16]||(m[16]=t("p",{class:"text-sm font-medium text-orange-800"},"Estimated Income Tax (AUD)",-1)),t("p",nl,C(Le.value),1),t("p",rl," (Based on "+C((Ae*100).toFixed(1))+"% of Total Income. This is an estimation.) ",1)]),t("div",il,[m[17]||(m[17]=t("p",{class:"text-sm font-medium text-gray-800"},"Last Payment Received Date",-1)),t("p",dl,C(Ke.value),1)]),t("div",ul,[m[18]||(m[18]=t("p",{class:"text-sm font-medium text-gray-800"},"Last Payment Sent Date",-1)),t("p",cl,C(qe.value),1)])])]),m[20]||(m[20]=t("h4",{class:"text-md font-medium text-gray-700 mb-4"},"Add Transaction",-1)),t("div",ml,[t("div",null,[l(M,{for:"description",value:"Description"}),l(G,{id:"description",modelValue:N.value.description,"onUpdate:modelValue":m[1]||(m[1]=V=>N.value.description=V),class:"mt-1 block w-full",disabled:r.value},null,8,["modelValue","disabled"]),l(O,{message:(z=n.value.description)==null?void 0:z[0],class:"mt-2"},null,8,["message"])]),t("div",null,[l(M,{for:"amount",value:"Amount"}),l(G,{id:"amount",type:"number",modelValue:N.value.amount,"onUpdate:modelValue":m[2]||(m[2]=V=>N.value.amount=V),class:"mt-1 block w-full",disabled:r.value},null,8,["modelValue","disabled"]),l(O,{message:(ae=n.value.amount)==null?void 0:ae[0],class:"mt-2"},null,8,["message"])]),t("div",null,[l(M,{for:"currency",value:"Currency"}),l(se,{id:"currency",modelValue:N.value.currency,"onUpdate:modelValue":m[3]||(m[3]=V=>N.value.currency=V),options:h,disabled:r.value},null,8,["modelValue","disabled"]),l(O,{message:(de=n.value.currency)==null?void 0:de[0],class:"mt-2"},null,8,["message"])]),t("div",null,[l(M,{for:"type",value:"Type"}),l(se,{id:"type",modelValue:N.value.type,"onUpdate:modelValue":m[4]||(m[4]=V=>N.value.type=V),options:u,disabled:r.value||!D(v)&&N.value.type==="expense"&&N.value.type!=="bonus"||!D(P)&&N.value.type==="income"},null,8,["modelValue","disabled"]),l(O,{message:(ye=n.value.type)==null?void 0:ye[0],class:"mt-2"},null,8,["message"])]),N.value.type==="expense"||N.value.type==="bonus"?(o(),d("div",vl,[l(M,{for:"user_id",value:"User"}),l(se,{id:"user_id",modelValue:N.value.user_id,"onUpdate:modelValue":m[5]||(m[5]=V=>N.value.user_id=V),options:U.value,disabled:r.value||!b.value.length,placeholder:"Select a user"},null,8,["modelValue","options","disabled"]),l(O,{message:(he=n.value.user_id)==null?void 0:he[0],class:"mt-2"},null,8,["message"])])):f("",!0),N.value.type==="expense"||N.value.type==="bonus"?(o(),d("div",pl,[l(M,{for:"hours_spent",value:"Hours Spent (Optional)"}),l(G,{id:"hours_spent",type:"number",modelValue:N.value.hours_spent,"onUpdate:modelValue":m[6]||(m[6]=V=>N.value.hours_spent=V),class:"mt-1 block w-full",disabled:r.value},null,8,["modelValue","disabled"]),l(O,{message:(je=n.value.hours_spent)==null?void 0:je[0],class:"mt-2"},null,8,["message"])])):f("",!0)]),t("div",gl,[l(te,{onClick:g,disabled:r.value},{default:K(()=>[F(C(r.value?"Saving...":"Save Transaction"),1)]),_:1},8,["disabled"])])])):f("",!0),D(T)?(o(),d("div",yl,[m[24]||(m[24]=t("h4",{class:"text-md font-medium text-gray-700 mb-4"},"Transaction History",-1)),r.value?(o(),d("div",fl,m[21]||(m[21]=[t("div",{class:"h-4 bg-gray-200 rounded animate-pulse w-full"},null,-1),t("div",{class:"h-4 bg-gray-200 rounded animate-pulse w-5/6"},null,-1),t("div",{class:"h-4 bg-gray-200 rounded animate-pulse w-3/4"},null,-1)]))):I.value.length===0?(o(),d("div",bl," No transactions found for this project. ")):(o(),d("div",wl,[(o(!0),d(ue,null,ce(I.value,(V,_e)=>{var Pe,$e,Se;return o(),d("div",{key:V.id,class:W([{"bg-green-50 border-green-200":V.type==="income","bg-red-50 border-red-200":V.type==="expense","bg-purple-50 border-purple-200":V.type==="bonus","border-l-4":!0},"p-4 rounded-md shadow-sm transition-all duration-200 ease-in-out hover:shadow-md"])},[t("div",hl,[t("div",xl,[t("p",kl,C(V.description),1),t("p",jl,C(V.type==="income"?"Income":V.type==="expense"?"Expense":"Bonus")+" on "+C(new Date(V.created_at).toLocaleDateString()),1)]),t("div",_l,[t("p",{class:W(["text-lg font-bold",{"text-green-700":V.type==="income","text-red-700":V.type==="expense","text-purple-700":V.type==="bonus"}])},C(D(oe)(V.amount,V.currency)),3),V.currency.toUpperCase()!==D(j).toUpperCase()?(o(),d("p",Pl," ("+C(D(oe)(D(fe)(V.amount,V.currency,D(j)),D(j)))+") ",1)):f("",!0),t("span",{class:W(["block text-xs mt-1",V.is_paid?"text-green-600":"text-red-600"])},C(V.is_paid?"Paid":"Unpaid"),3)])]),t("div",$l,[t("div",null,[V.user_id?(o(),d("span",Sl,"User: "+C(((Pe=b.value.find(re=>re.id===V.user_id))==null?void 0:Pe.name)||"Unknown"),1)):f("",!0),V.hours_spent?(o(),d("span",Vl,"Hours: "+C(V.hours_spent),1)):f("",!0),(V.type==="expense"||V.type==="bonus")&&L.value>0?(o(),d("span",Cl,C((D(fe)(V.amount,V.currency,D(j))/L.value*100).toFixed(2))+"% of Income ",1)):f("",!0)]),t("div",Dl,[!V.is_paid&&(D(v)||D(P))?(o(),ee(be,{key:0,onClick:re=>x(_e),class:W({"text-green-600":V.type!=="income","text-blue-600":V.type==="income"})},{default:K(()=>[F(C(V.type==="income"?"Receive":"Pay"),1)]),_:2},1032,["onClick","class"])):f("",!0),D(v)||D(P)?(o(),ee(be,{key:1,onClick:re=>i(_e),class:"text-red-600"},{default:K(()=>m[22]||(m[22]=[F(" Delete ",-1)])),_:2,__:[22]},1032,["onClick"])):f("",!0)])]),k.value===V.id?(o(),d("div",Il,[t("h4",Ul,C(V.type==="income"?"Record Receipt":"Make Payment"),1),t("div",Ml,[l(M,{for:"payment_date",value:"Date"}),l(G,{id:"payment_date",type:"date",modelValue:Q.value,"onUpdate:modelValue":m[7]||(m[7]=re=>Q.value=re),class:"mt-1 block w-full",disabled:r.value},null,8,["modelValue","disabled"]),l(O,{message:($e=J.value.date)==null?void 0:$e[0],class:"mt-2"},null,8,["message"])]),t("div",Al,[t("label",Nl,[ge(t("input",{type:"checkbox","onUpdate:modelValue":m[8]||(m[8]=re=>A.value=re),class:"mr-2 rounded text-blue-600 focus:ring-blue-500",disabled:r.value},null,8,Bl),[[We,A.value]]),t("span",Tl,C(V.type==="income"?"Receive in Full":"Pay in Full"),1)])]),A.value?f("",!0):(o(),d("div",Ol,[l(M,{for:"payment_amount",value:"Amount"}),l(G,{id:"payment_amount",type:"number",modelValue:w.value,"onUpdate:modelValue":m[9]||(m[9]=re=>w.value=re),class:"mt-1 block w-full",disabled:r.value,placeholder:"Enter partial "+(V.type==="income"?"receipt":"payment")+" amount (Max: "+D(oe)(V.amount,V.currency)+")"},null,8,["modelValue","disabled","placeholder"]),l(O,{message:(Se=J.value.amount)==null?void 0:Se[0],class:"mt-2"},null,8,["message"])])),t("div",Rl,[l(be,{onClick:B,disabled:r.value},{default:K(()=>m[23]||(m[23]=[F(" Cancel ",-1)])),_:1,__:[23]},8,["disabled"]),l(te,{onClick:R,disabled:r.value},{default:K(()=>[F(C(r.value?"Processing...":V.type==="income"?"Record Receipt":"Submit Payment"),1)]),_:2},1032,["disabled"])])])):f("",!0)],2)}),128))]))])):f("",!0)])}}},El={class:"p-6 w-full mx-auto bg-white rounded-xl shadow-2xl transition-all duration-300"},zl={class:"border-b border-gray-200 mb-6"},Ll={class:"flex -mb-px space-x-4 overflow-x-auto pb-2"},ql={class:"py-4"},so={__name:"ProjectForm",props:{projectId:{type:[Number,String],default:null},statusOptions:{type:Array,required:!0},departmentOptions:{type:Array,required:!0},sourceOptions:{type:Array,required:!0},clientRoleOptions:{type:Array,default:()=>[]},userRoleOptions:{type:Array,default:()=>[]},paymentTypeOptions:{type:Array,required:!0},errors:{type:Object,default:()=>({})},isSaving:{type:Boolean,default:!1}},emits:["close"],setup(e,{emit:p}){Je();const a=e,y=$(a.projectId);le(()=>a.projectId,B=>{y.value=B,B&&Xe(B)},{immediate:!0}),Qe(y);const v=Ze(y),{canDo:P,canView:T,canManage:I}=Ne(y),b=P("manage_projects",v);P("create_clients",v);const n=P("upload_project_documents",v),s=I("project_services_and_payments",v),r=P("add_project_notes",v),k=I("project_users",v),w=I("project_clients",v),A=P("manage_project_basic_details",v),J=T("project_documents",v),X=T("project_services_and_payments",v),Q=T("project_notes",v),N=T("project_users",v),j=T("project_clients",v),h=T("project_transactions",v),u=T("project_deliverables"),U=I("project_deliverables"),S=$("basic"),H=q(()=>j.value&&N.value?"Clients and Users":j.value?"Clients":N.value?"Users":"Clients and Users"),Y=$([]),g=$([]),c=$([]),i=$([]),x=B=>{if(B!=="basic"&&!a.projectId){et("Please create the project first before managing this section."),S.value="basic";return}S.value=B};return me(async()=>{try{Y.value=await Ie("client"),g.value=await Ie("project"),c.value=await ct(!0,null),i.value=await mt(!0,null)}catch(B){console.error("Error fetching global data for ProjectForm:",B)}}),(B,R)=>(o(),d("div",El,[R[7]||(R[7]=t("div",{class:"flex justify-between items-center pb-4 mb-6 border-b border-gray-200"},[t("h2",{class:"text-2xl font-semibold text-gray-800"},"Edit Project")],-1)),t("div",zl,[t("nav",Ll,[t("button",{onClick:R[0]||(R[0]=L=>x("basic")),class:W(["py-3 px-5 text-center border-b-2 font-medium text-base rounded-t-lg transition-colors duration-200 whitespace-nowrap",S.value==="basic"?"border-indigo-600 text-indigo-700 bg-indigo-50":"border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300 hover:bg-gray-50"])}," Basic Information ",2),e.projectId&&(D(j)||D(N))?(o(),d("button",{key:0,onClick:R[1]||(R[1]=L=>x("client")),class:W(["py-3 px-5 text-center border-b-2 font-medium text-base rounded-t-lg transition-colors duration-200 whitespace-nowrap",S.value==="client"?"border-indigo-600 text-indigo-700 bg-indigo-50":"border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300 hover:bg-gray-50"])},C(H.value),3)):f("",!0),e.projectId&&(D(s)||D(X))?(o(),d("button",{key:1,onClick:R[2]||(R[2]=L=>x("services")),class:W(["py-3 px-5 text-center border-b-2 font-medium text-base rounded-t-lg transition-colors duration-200 whitespace-nowrap",S.value==="services"?"border-indigo-600 text-indigo-700 bg-indigo-50":"border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300 hover:bg-gray-50"])}," Services & Payment ",2)):f("",!0),e.projectId&&D(h)?(o(),d("button",{key:2,onClick:R[3]||(R[3]=L=>x("transactions")),class:W(["py-3 px-5 text-center border-b-2 font-medium text-base rounded-t-lg transition-colors duration-200 whitespace-nowrap",S.value==="transactions"?"border-indigo-600 text-indigo-700 bg-indigo-50":"border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300 hover:bg-gray-50"])}," Transactions ",2)):f("",!0),e.projectId&&D(J)?(o(),d("button",{key:3,onClick:R[4]||(R[4]=L=>x("documents")),class:W(["py-3 px-5 text-center border-b-2 font-medium text-base rounded-t-lg transition-colors duration-200 whitespace-nowrap",S.value==="documents"?"border-indigo-600 text-indigo-700 bg-indigo-50":"border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300 hover:bg-gray-50"])}," Documents ",2)):f("",!0),e.projectId&&(D(r)||D(Q))?(o(),d("button",{key:4,onClick:R[5]||(R[5]=L=>x("notes")),class:W(["py-3 px-5 text-center border-b-2 font-medium text-base rounded-t-lg transition-colors duration-200 whitespace-nowrap",S.value==="notes"?"border-indigo-600 text-indigo-700 bg-indigo-50":"border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300 hover:bg-gray-50"])}," Notes ",2)):f("",!0),e.projectId&&(D(U)||D(u))?(o(),d("button",{key:5,onClick:R[6]||(R[6]=L=>x("deliverables")),class:W(["py-3 px-5 text-center border-b-2 font-medium text-base rounded-t-lg transition-colors duration-200 whitespace-nowrap",S.value==="deliverables"?"border-indigo-600 text-indigo-700 bg-indigo-50":"border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300 hover:bg-gray-50"])}," Deliverables ",2)):f("",!0)])]),t("div",ql,[S.value==="basic"?(o(),ee(Ct,{key:0,projectId:e.projectId,errors:a.errors,statusOptions:e.statusOptions,sourceOptions:e.sourceOptions,canManageProjects:D(b),canManageProjectBasicDetails:D(A),isSaving:a.isSaving},null,8,["projectId","errors","statusOptions","sourceOptions","canManageProjects","canManageProjectBasicDetails","isSaving"])):f("",!0),S.value==="client"?(o(),ee(ta,{key:1,projectId:e.projectId,errors:a.errors,clientRoleOptions:Y.value,userRoleOptions:g.value,clients:c.value,users:i.value,canViewProjectClients:D(j),canManageProjectClients:D(w),canViewProjectUsers:D(N),canManageProjectUsers:D(k),isSaving:a.isSaving},null,8,["projectId","errors","clientRoleOptions","userRoleOptions","clients","users","canViewProjectClients","canManageProjectClients","canViewProjectUsers","canManageProjectUsers","isSaving"])):f("",!0),S.value==="services"?(o(),ee(Rs,{key:2,projectId:e.projectId,departmentOptions:e.departmentOptions,paymentTypeOptions:e.paymentTypeOptions,canManageProjectServicesAndPayments:D(s),canViewProjectServicesAndPayments:D(X),isSaving:a.isSaving},null,8,["projectId","departmentOptions","paymentTypeOptions","canManageProjectServicesAndPayments","canViewProjectServicesAndPayments","isSaving"])):f("",!0),S.value==="transactions"&&D(h)?(o(),ee(Fl,{key:3,projectId:e.projectId,userProjectRole:D(v),isSaving:a.isSaving},null,8,["projectId","userProjectRole","isSaving"])):f("",!0),S.value==="documents"?(o(),ee(ha,{key:4,projectId:e.projectId,errors:a.errors,canUploadProjectDocuments:D(n),canViewProjectDocuments:D(J),isSaving:a.isSaving},null,8,["projectId","errors","canUploadProjectDocuments","canViewProjectDocuments","isSaving"])):f("",!0),S.value==="notes"?(o(),ee(Na,{key:5,projectId:e.projectId,errors:a.errors,canAddProjectNotes:D(r),canViewProjectNotes:D(Q),"is-saving":a.isSaving},null,8,["projectId","errors","canAddProjectNotes","canViewProjectNotes","is-saving"])):f("",!0),S.value==="deliverables"?(o(),ee(es,{key:6,projectId:e.projectId,errors:a.errors,canManageProjectDeliverables:D(U),canViewProjectDeliverables:D(u),isSaving:a.isSaving},null,8,["projectId","errors","canManageProjectDeliverables","canViewProjectDeliverables","isSaving"])):f("",!0)])]))}};export{so as _,fe as a,Me as b,Z as c,Be as d,oe as f};
