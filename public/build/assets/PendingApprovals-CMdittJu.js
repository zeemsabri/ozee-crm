import{s as A,D as J,r as u,z as B,B as K,i as n,o as d,e as o,h as Q,y as W,a as c,b as s,g as P,t as m,F as R,j as D,m as _,d as U,f as q,v as X,k as Z}from"./app-CVGDP6I0.js";import{_ as ee}from"./AuthenticatedLayout-BkDNYAP9.js";import{P as k}from"./PrimaryButton-CD6-48la.js";import{a as V,_ as L}from"./SecondaryButton-BfI_TbHa.js";import{_ as w,a as E}from"./InputError-Bn0nt5-1.js";import{_ as se}from"./TextInput-BAVMqkDT.js";import{R as te}from"./RichTextEditor-A0QnegPk.js";import"./ApplicationLogo-BP-O2cWi.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";/* empty css                                                                       */const oe={class:"py-12"},ae={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},le={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},re={class:"p-6 text-gray-900"},ie={key:0,class:"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative mb-4",role:"alert"},ne={class:"block sm:inline"},de={key:1,class:"text-gray-600"},ue={key:2,class:"text-red-600"},ce={key:3,class:"text-gray-600"},pe={key:4},me={class:"overflow-x-auto"},ve={class:"w-full divide-y divide-gray-200"},_e={class:"bg-white divide-y divide-gray-200"},fe={class:"px-4 py-4 whitespace-nowrap"},xe={class:"px-4 py-4 whitespace-nowrap"},ge={class:"px-4 py-4 truncate max-w-xs"},ye={class:"px-4 py-4 whitespace-nowrap"},be={class:"px-4 py-4 whitespace-nowrap"},we={class:"px-4 py-4 whitespace-nowrap flex space-x-2"},je={class:"p-6"},he={key:0},ke={class:"mb-4"},Ee=["value"],Ce={class:"mb-4"},$e={id:"client_name",class:"mt-1 p-2 border border-gray-300 rounded-md bg-gray-50"},Ae={class:"mb-4"},Pe={class:"mb-6"},Re={class:"mt-6 flex justify-end space-x-2"},Ve={class:"p-6"},Se={key:0},Me={class:"mb-6"},Ne={class:"mt-6 flex justify-end space-x-2"},Ge={__name:"PendingApprovals",setup(Fe){const S=A(()=>J().props.auth.user),C=u([]),j=u([]),T=u([]),$=u(!0),l=u(""),f=u(""),x=u(!1),g=u(!1),v=u(null),r=B({project_id:"",client_id:"",subject:"",body:""}),p=u({}),y=B({rejection_reason:""}),b=u({}),z=A(()=>S.value.role==="contractor"?j.value.filter(t=>t.users&&t.users.some(e=>e.id===S.value.id)):j.value);A(()=>{const t=j.value.find(e=>e.id===r.project_id);return t?T.value.find(e=>e.id===t.client_id):null});const h=async()=>{$.value=!0,l.value="";try{const t=await window.axios.get("/api/emails/pending-approval-simplified");C.value=t.data;const e=await window.axios.get("/api/projects");j.value=e.data}catch(t){l.value="Failed to load data.",console.error("Error fetching initial data:",t),t.response&&(t.response.status===401||t.response.status===403)&&(l.value="You are not authorized to view this content or your session expired. Please log in.")}finally{$.value=!1}},I=t=>{var e;v.value=t,r.project_id=(e=t.project)==null?void 0:e.id,r.subject=t.subject,r.body=t.body,p.value={},x.value=!0},O=async()=>{p.value={},l.value="";try{const t={project_id:r.project_id,subject:r.subject,body:r.body};await window.axios.post(`/api/emails/${v.value.id}/edit-and-approve`,t),f.value="Email updated and approved successfully!",x.value=!1,await h()}catch(t){t.response&&t.response.status===422?p.value=t.response.data.errors:t.response&&t.response.data.message?l.value=t.response.data.message:(l.value="Failed to update and approve email.",console.error("Error updating and approving email:",t))}},Y=async t=>{l.value="";try{await window.axios.post(`/api/emails/${t.id}/approve`),f.value="Email approved successfully!",await h()}catch(e){e.response&&e.response.data.message?l.value=e.response.data.message:(l.value="Failed to approve email.",console.error("Error approving email:",e))}},G=t=>{v.value=t,y.rejection_reason="",b.value={},g.value=!0},H=async()=>{b.value={},l.value="";try{await window.axios.post(`/api/emails/${v.value.id}/reject`,{rejection_reason:y.rejection_reason}),f.value="Email rejected successfully!",y.rejection_reason="",g.value=!1,await h()}catch(t){t.response&&t.response.status===422?b.value=t.response.data.errors:t.response&&t.response.data.message?l.value=t.response.data.message:(l.value="Failed to reject email.",console.error("Error rejecting email:",t))}};return K(()=>{h()}),(t,e)=>(d(),n(R,null,[o(Q(W),{title:"Pending Approvals"}),o(ee,null,{header:c(()=>e[8]||(e[8]=[s("h2",{class:"font-semibold text-xl text-gray-800 leading-tight"},"Pending Email Approvals",-1)])),default:c(()=>[s("div",oe,[s("div",ae,[s("div",le,[s("div",re,[e[13]||(e[13]=s("h3",{class:"text-2xl font-bold mb-4"},"Emails Pending Approval",-1)),f.value?(d(),n("div",ie,[s("span",ne,m(f.value),1)])):P("",!0),$.value?(d(),n("div",de,"Loading pending emails...")):l.value?(d(),n("div",ue,m(l.value),1)):C.value.length===0?(d(),n("div",ce,"No pending emails found.")):(d(),n("div",pe,[s("div",me,[s("table",ve,[e[12]||(e[12]=s("thead",{class:"bg-gray-50"},[s("tr",null,[s("th",{scope:"col",class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Project"),s("th",{scope:"col",class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Client"),s("th",{scope:"col",class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Subject"),s("th",{scope:"col",class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Sender"),s("th",{scope:"col",class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Submitted On"),s("th",{scope:"col",class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Actions")])],-1)),s("tbody",_e,[(d(!0),n(R,null,D(C.value,a=>{var i,M,N;return d(),n("tr",{key:a.id},[s("td",fe,m(((i=a.project)==null?void 0:i.name)||"N/A"),1),s("td",xe,m(((M=a.client)==null?void 0:M.name)||"N/A"),1),s("td",ge,m(a.subject),1),s("td",ye,m(((N=a.sender)==null?void 0:N.name)||"N/A"),1),s("td",be,m(new Date(a.created_at).toLocaleString()),1),s("td",we,[o(k,{onClick:F=>Y(a),class:"text-xs px-2 py-1"},{default:c(()=>e[9]||(e[9]=[_("Approve",-1)])),_:2,__:[9]},1032,["onClick"]),o(k,{onClick:F=>I(a),class:"text-xs px-2 py-1"},{default:c(()=>e[10]||(e[10]=[_("Edit & Approve",-1)])),_:2,__:[10]},1032,["onClick"]),o(V,{onClick:F=>G(a),class:"text-xs px-2 py-1"},{default:c(()=>e[11]||(e[11]=[_("Reject",-1)])),_:2,__:[11]},1032,["onClick"])])])}),128))])])])]))])])])]),o(L,{show:x.value,onClose:e[4]||(e[4]=a=>x.value=!1),"max-width":"3xl"},{default:c(()=>{var a;return[s("div",je,[e[17]||(e[17]=s("h2",{class:"text-2xl font-bold text-gray-900 mb-4"},"Edit and Approve Email",-1)),v.value?(d(),n("div",he,[s("form",{onSubmit:U(O,["prevent"])},[s("div",ke,[o(w,{for:"project_id",value:"Project"}),q(s("select",{id:"project_id",class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full","onUpdate:modelValue":e[0]||(e[0]=i=>r.project_id=i),required:""},[e[14]||(e[14]=s("option",{value:"",disabled:""},"Select a Project",-1)),(d(!0),n(R,null,D(z.value,i=>(d(),n("option",{key:i.id,value:i.id},m(i.name),9,Ee))),128))],512),[[X,r.project_id]]),o(E,{message:p.value.project_id?p.value.project_id[0]:"",class:"mt-2"},null,8,["message"])]),s("div",Ce,[o(w,{for:"client_name",value:"Client"}),s("div",$e,m(((a=v.value.client)==null?void 0:a.name)||"N/A"),1)]),s("div",Ae,[o(w,{for:"subject",value:"Subject"}),o(se,{id:"subject",type:"text",class:"mt-1 block w-full",modelValue:r.subject,"onUpdate:modelValue":e[1]||(e[1]=i=>r.subject=i),required:""},null,8,["modelValue"]),o(E,{message:p.value.subject?p.value.subject[0]:"",class:"mt-2"},null,8,["message"])]),s("div",Pe,[o(w,{for:"body",value:"Email Body"}),o(te,{id:"body",modelValue:r.body,"onUpdate:modelValue":e[2]||(e[2]=i=>r.body=i),placeholder:"Edit your email here...",height:"300px"},null,8,["modelValue"]),o(E,{message:p.value.body?p.value.body[0]:"",class:"mt-2"},null,8,["message"])]),s("div",Re,[o(V,{onClick:e[3]||(e[3]=i=>x.value=!1)},{default:c(()=>e[15]||(e[15]=[_("Cancel",-1)])),_:1,__:[15]}),o(k,{type:"submit"},{default:c(()=>e[16]||(e[16]=[_("Save & Approve",-1)])),_:1,__:[16]})])],32)])):P("",!0)])]}),_:1},8,["show"]),o(L,{show:g.value,onClose:e[7]||(e[7]=a=>g.value=!1),"max-width":"2xl"},{default:c(()=>[s("div",Ve,[e[20]||(e[20]=s("h2",{class:"text-2xl font-bold text-gray-900 mb-4"},"Reject Email",-1)),v.value?(d(),n("div",Se,[s("form",{onSubmit:U(H,["prevent"])},[s("div",Me,[o(w,{for:"rejection_reason",value:"Rejection Reason"}),q(s("textarea",{id:"rejection_reason",rows:"5",class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full","onUpdate:modelValue":e[5]||(e[5]=a=>y.rejection_reason=a),required:"",placeholder:"Please provide a reason for rejecting this email (minimum 10 characters)"},null,512),[[Z,y.rejection_reason]]),o(E,{message:b.value.rejection_reason?b.value.rejection_reason[0]:"",class:"mt-2"},null,8,["message"])]),s("div",Ne,[o(V,{onClick:e[6]||(e[6]=a=>g.value=!1)},{default:c(()=>e[18]||(e[18]=[_("Cancel",-1)])),_:1,__:[18]}),o(k,{type:"submit",class:"bg-red-600 hover:bg-red-700"},{default:c(()=>e[19]||(e[19]=[_("Reject Email",-1)])),_:1,__:[19]})])],32)])):P("",!0)])]),_:1},8,["show"])]),_:1})],64))}};export{Ge as default};
