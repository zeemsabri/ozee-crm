import{I as E,r as C,c as F,a as l,o as a,i as p,b as t,j as c,t as f,d as T,C as S,F as w,l as I,w as H,m as U,G as A,x as M,y as q,u as g,z as P,n as z,p as K}from"./app-DgoxlfmD.js";import{P as Y}from"./PrimaryButton-zgMcW2MC.js";import{_ as G}from"./TextInput-BP8dwQVo.js";/* empty css                                                                       */import"./_plugin-vue_export-helper-DlAUqK2U.js";const J={class:"space-y-4"},Q={key:1,class:"space-y-3"},R={class:"flex items-center justify-between"},W={class:"flex-1"},X=["onClick"],Z={key:0,class:"mt-0.5 text-xs text-gray-600 truncate"},ee=["id","value","onBlur","onKeyup"],te={class:"flex items-center space-x-2 ml-4"},oe=["onClick"],se=["onClick"],ie={key:0,class:"mt-4"},re=["onUpdate:modelValue"],ne={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between text-xs text-gray-600 mt-2 gap-3"},le={class:"flex flex-wrap items-center gap-2"},ae=["onClick"],de=["onClick"],ue=["value","onChange","min","max"],ce={class:"flex items-center gap-2"},pe=["onClick"],me=["onClick"],ge=["onClick"],ye={class:"flex items-center gap-2 min-w-[180px]"},be=["onUpdate:modelValue"],fe=["value"],ve={key:1,class:"text-[11px] text-gray-400 mt-1"},xe={key:2,class:"text-[11px] text-red-500 mt-1"},he={class:"flex justify-end mt-4 space-x-3"},Te={__name:"TaskCreationForm",props:{emailId:{type:Number,required:!0},projectId:{type:Number,required:!0},users:{type:Array,default:()=>[]},usersLoading:{type:Boolean,default:!1},usersError:{type:String,default:null},completionDate:{type:String,required:!1,default:null}},emits:["tasks-submitted"],setup(b,{emit:N}){const y=b,O=N,n=E([]),u=C({show:!1,text:"",type:"success"}),d=new Date,v=new Date(d);v.setDate(d.getDate()+1);const m=C(""),V=()=>{m.value&&m.value.trim()!==""&&(n.push({name:m.value,dueDate:"",priority:"Medium",description:"",isEditingName:!1,showDescription:!1,assigned_to_user_id:null}),m.value="",u.value.show=!1)},j=o=>n.splice(o,1),x=(o,e)=>{n[o].priority=e},h=(o,e)=>{const s=new Date(d.getFullYear(),d.getMonth(),d.getDate()),r=y.completionDate?new Date(y.completionDate):null,i=new Date(e);if(u.value.show=!1,r&&i>r){u.value={show:!0,text:"The selected due date is after the milestone completion date.",type:"error"},n[o].dueDate="";return}if(i<s){u.value={show:!0,text:"The selected due date cannot be in the past.",type:"error"},n[o].dueDate="";return}n[o].dueDate=e},B=o=>{n[o].showDescription=!n[o].showDescription},L=o=>{n[o].isEditingName=!0,z(()=>document.getElementById(`email-task-name-input-${o}`).focus())},_=(o,e)=>{e.trim()&&(n[o].name=e),n[o].isEditingName=!1},D=F(()=>n.length===0||n.some(o=>!o.name.trim()||!o.dueDate||!o.priority)),k=o=>{const e=y.completionDate?new Date(y.completionDate):null,s=new Date(d.getFullYear(),d.getMonth(),d.getDate()),r=new Date(o);return r>=s&&(!e||r<=e)},$=async()=>{try{const o={tasks:n.map(e=>({...e,assigned_to_user_id:e.assigned_to_user_id||null})),email_id:y.emailId};await K.post(`/api/emails/${y.emailId}/tasks/bulk`,o),n.splice(0,n.length),m.value="",O("tasks-submitted")}catch(o){u.value={show:!0,text:"Failed to create tasks.",type:"error"},console.error(o)}};return(o,e)=>(a(),l("div",J,[u.value.show?(a(),l("div",{key:0,class:c(["mb-4 p-4 rounded-lg",{"bg-green-100 text-green-700 border border-green-200":u.value.type==="success","bg-red-100 text-red-700 border border-red-200":u.value.type==="error"}])},f(u.value.text),3)):p("",!0),t("form",{onSubmit:S(V,["prevent"]),class:"relative"},[T(G,{modelValue:m.value,"onUpdate:modelValue":e[0]||(e[0]=s=>m.value=s),id:"email-task-name-input",placeholder:"e.g., 'Follow up with client'",class:"w-full p-4 pr-12 text-lg border border-gray-300 rounded-xl focus:ring-indigo-500 focus:border-indigo-500 shadow-sm"},null,8,["modelValue"]),e[1]||(e[1]=t("button",{type:"submit",class:"absolute right-4 top-1/2 -translate-y-1/2 p-2 text-indigo-600 hover:text-indigo-800"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})])],-1))],32),e[10]||(e[10]=t("hr",{class:"my-6 border-gray-200"},null,-1)),n.length>0?(a(),l("div",Q,[e[8]||(e[8]=t("h2",{class:"text-lg font-semibold text-gray-800"},"Tasks to Create:",-1)),(a(!0),l(w,null,I(n,(s,r)=>(a(),l("div",{key:r,class:"flex flex-col p-4 bg-gray-50 rounded-xl border border-gray-200 group"},[t("div",R,[t("div",W,[s.isEditingName?(a(),l("input",{key:1,id:`email-task-name-input-${r}`,type:"text",value:s.name,onBlur:i=>_(r,i.target.value),onKeyup:A(i=>_(r,i.target.value),["enter"]),class:"text-sm font-semibold text-gray-800 w-full rounded-md border-gray-300 focus:ring-indigo-500 focus:border-indigo-500 shadow-sm"},null,40,ee)):(a(),l(w,{key:0},[t("p",{onClick:i=>L(r),class:"text-sm font-semibold text-gray-800 truncate cursor-pointer hover:underline"},f(s.name),9,X),s.description&&s.description.trim().length?(a(),l("p",Z,f(s.description),1)):p("",!0)],64))]),t("div",te,[t("button",{type:"button",onClick:i=>B(r),class:c(["p-1 rounded-full",[s.showDescription||s.description&&s.description.trim().length?"text-indigo-600 hover:text-indigo-700":"text-gray-400 hover:text-indigo-500"]]),title:"Add description"},e[2]||(e[2]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",class:"h-5 w-5"},[t("path",{d:"M19.5 14.25h-15m15-5.25h-15M9 19.5H4.5A1.5 1.5 0 013 18V6a1.5 1.5 0 011.5-1.5H15L21 9v9a1.5 1.5 0 01-1.5 1.5H15"})],-1)]),10,oe),t("button",{type:"button",onClick:i=>j(r),class:"p-1 rounded-full text-red-500 opacity-0 group-hover:opacity-100"},e[3]||(e[3]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor"},[t("path",{"fill-rule":"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z","clip-rule":"evenodd"})],-1)]),8,se)])]),s.showDescription?(a(),l("div",ie,[M(t("textarea",{"onUpdate:modelValue":i=>s.description=i,rows:"2",placeholder:"Add an optional description...",class:"w-full rounded-md border-gray-300 focus:ring-indigo-500 focus:border-indigo-500 shadow-sm text-sm"},null,8,re),[[q,s.description]])])):p("",!0),t("div",ne,[t("div",le,[e[4]||(e[4]=t("span",{class:"font-medium"},"Due:",-1)),k(g(d).toISOString().split("T")[0])?(a(),l("button",{key:0,type:"button",onClick:i=>h(r,g(d).toISOString().split("T")[0]),class:c(["px-2 py-0.5 rounded-full text-indigo-600 bg-indigo-100 text-xs hover:bg-indigo-200",{"bg-indigo-300 font-semibold":s.dueDate===g(d).toISOString().split("T")[0]}])},"Today",10,ae)):p("",!0),k(g(v).toISOString().split("T")[0])?(a(),l("button",{key:1,type:"button",onClick:i=>h(r,g(v).toISOString().split("T")[0]),class:c(["px-2 py-0.5 rounded-full text-indigo-600 bg-indigo-100 text-xs hover:bg-indigo-200",{"bg-indigo-300 font-semibold":s.dueDate===g(v).toISOString().split("T")[0]}])},"Tomorrow",10,de)):p("",!0),t("input",{type:"date",value:s.dueDate,onChange:i=>h(r,i.target.value),min:g(d).toISOString().split("T")[0],max:b.completionDate,required:"",class:c(["p-1 rounded-lg border text-xs focus:ring-indigo-500 focus:border-indigo-500 shadow-sm",[s.dueDate?"border-gray-300":"border-red-300"]])},null,42,ue)]),t("div",ce,[e[5]||(e[5]=t("span",{class:"font-medium"},"Priority:",-1)),t("button",{type:"button",onClick:i=>x(r,"Low"),class:c(["px-2 py-0.5 rounded-full text-gray-500 bg-gray-100 text-xs hover:bg-gray-200",{"bg-gray-200 font-semibold":s.priority==="Low"}])},"Low",10,pe),t("button",{type:"button",onClick:i=>x(r,"Medium"),class:c(["px-2 py-0.5 rounded-full text-blue-600 bg-blue-100 text-xs hover:bg-blue-200",{"bg-blue-200 font-semibold":s.priority==="Medium"}])},"Medium",10,me),t("button",{type:"button",onClick:i=>x(r,"High"),class:c(["px-2 py-0.5 rounded-full text-red-600 bg-red-100 text-xs hover:bg-red-200",{"bg-red-200 font-semibold":s.priority==="High"}])},"High",10,ge)]),t("div",ye,[e[7]||(e[7]=t("span",{class:"font-medium"},"Assign:",-1)),M(t("select",{"onUpdate:modelValue":i=>s.assigned_to_user_id=i,class:"flex-1 rounded-md border-gray-300 focus:ring-indigo-500 focus:border-indigo-500 shadow-sm text-xs py-1"},[e[6]||(e[6]=t("option",{value:null},"Unassigned",-1)),(a(!0),l(w,null,I(b.users,i=>(a(),l("option",{key:i.id,value:i.id},f(i.name),9,fe))),128))],8,be),[[P,s.assigned_to_user_id]])])]),o.loadingUsers?(a(),l("p",ve,"Loading users...")):p("",!0),b.usersError?(a(),l("p",xe,f(b.usersError),1)):p("",!0)]))),128))])):p("",!0),t("div",he,[T(Y,{type:"submit",onClick:S($,["prevent"]),disabled:D.value,class:c({"opacity-50 cursor-not-allowed":D.value})},{default:H(()=>e[9]||(e[9]=[U("Create Tasks",-1)])),_:1,__:[9]},8,["disabled","class"])])]))}};export{Te as default};
