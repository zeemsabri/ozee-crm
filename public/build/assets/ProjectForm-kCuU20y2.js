import{r as j,s as Ne,p as G,w as X,h as l,o as r,g as p,t as w,b as i,e as m,f as Y,v as ie,F as R,i as T,n as ee,k as z,I as et,a as H,z as Be,m as be,D as tt,M as st,N as at,G as ot,O as Fe,u,j as Pe,c as Me,d as nt}from"./app-Cftj8kez.js";import{P as ae}from"./PrimaryButton-BNBWD5Jx.js";import{_ as V,a as O}from"./InputError-Dysw4GLH.js";import{_ as W}from"./TextInput-DItFCFfR.js";import{_ as rt}from"./Checkbox-P2ckk_dj.js";import{a as Re}from"./SecondaryButton-CVyu_OeR.js";import{s as Te}from"./AuthenticatedLayout-m1j3JS-L.js";const lt={key:0,class:"text-red-600 text-sm mb-4"},it={key:1,class:"text-gray-500 text-sm mb-4"},dt={key:2},ct={class:"mb-4"},ut={class:"mb-4"},mt=["disabled"],pt=["value"],vt={class:"mb-4"},yt={class:"mt-2"},ft={class:"flex items-center mb-2"},_t=["for"],gt={key:0,class:"pl-6"},bt={class:"grid grid-cols-2 gap-4 mb-2"},ht=["id","onUpdate:modelValue","disabled"],wt={class:"mb-2"},kt={key:0},xt={class:"flex justify-between items-center mb-1"},jt=["onClick"],Pt={class:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-2"},$t={class:"flex"},St=["onClick"],Ct={key:0},At={class:"mt-4"},Vt={key:1,class:"mt-2 flex items-center"},Dt={key:0,class:"mt-6 flex justify-end"},Ut={__name:"ServicesAndPaymentForm",props:{projectId:{type:[Number,String],required:!0},paymentTypeOptions:{type:Array,required:!0},canManageProjectServicesAndPayments:{type:Boolean,required:!0},canViewProjectServicesAndPayments:{type:Boolean,required:!0}},emits:["updated"],setup(g,{emit:de}){const P=g,J=de,_=j({}),$=j(!1),E=j([...[{value:"Website Designing",label:"Website Designing"},{value:"SEO",label:"SEO"},{value:"Social Media",label:"Social Media"},{value:"Content Writing",label:"Content Writing"},{value:"Graphic Design",label:"Graphic Design"}]]),h=j(""),F=j(!1),b=Ne({services:[],service_details:[],total_amount:"",payment_type:"one_off"}),N=G(()=>{const d=b.services.filter(o=>{const n=C(o);return n&&n.frequency!=="monthly"});return d.length===0?!0:d.every(o=>B(o)===100)}),D=G(()=>!P.projectId||!P.canManageProjectServicesAndPayments||!N.value),ne=()=>{const d=h.value.trim();d&&!E.value.some(o=>o.label.toLowerCase()===d.toLowerCase())&&(E.value.push({value:d,label:d}),h.value="",F.value=!1)},ce=async()=>{if(P.projectId){$.value=!0;try{const o=(await window.axios.get(`/api/projects/${P.projectId}/sections/services-payment`)).data;return b.services=o.services||[],b.service_details=o.service_details||[],b.total_amount=o.total_amount||"",b.payment_type=o.payment_type||"one_off",b.services.forEach(n=>{E.value.some(y=>y.value===n)||E.value.push({value:n,label:n})}),b.service_details.forEach(n=>{if(n.payment_breakdown&&!Array.isArray(n.payment_breakdown)){const y=n.payment_breakdown;n.payment_breakdown=[{label:"First",percentage:parseInt(y.first)||30},{label:"Second",percentage:parseInt(y.second)||30},{label:"Third",percentage:parseInt(y.third)||40}]}else(!n.payment_breakdown||n.payment_breakdown.length===0)&&(n.payment_breakdown=[{label:"Payment 1",percentage:100}])}),o}catch(d){return console.error("Error fetching services and payment data:",d),_.value.general="Failed to fetch services and payment data.",null}finally{$.value=!1}}},re=async()=>{_.value={},$.value=!0;try{const d={services:b.services,service_details:b.service_details,total_amount:b.total_amount,payment_type:b.payment_type},o=await window.axios.put(`/api/projects/${P.projectId}/sections/services-payment`,d);alert("Services and payment information updated successfully!"),J("updated")}catch(d){d.response&&d.response.status===422?_.value=d.response.data.errors:d.response&&d.response.data.message?_.value.general=d.response.data.message:(_.value.general="Failed to update services and payment information.",console.error("Error:",d))}finally{$.value=!1}},L=(d,o)=>{o?b.service_details.some(n=>n.service_id===d)||b.service_details.push({service_id:d,amount:"",frequency:"one_off",start_date:"",payment_breakdown:[{label:"Payment 1",percentage:100}]}):b.service_details=b.service_details.filter(n=>n.service_id!==d)},C=d=>{let o=b.service_details.find(n=>n.service_id===d);if(!o)o={service_id:d,amount:"",frequency:"one_off",start_date:"",payment_breakdown:[{label:"Payment 1",percentage:100}]},b.service_details.push(o);else if(o.payment_breakdown&&!Array.isArray(o.payment_breakdown)){const n=o.payment_breakdown;o.payment_breakdown=[{label:"First",percentage:parseInt(n.first)||30},{label:"Second",percentage:parseInt(n.second)||30},{label:"Third",percentage:parseInt(n.third)||40}]}else(!o.payment_breakdown||o.payment_breakdown.length===0)&&(o.payment_breakdown=[{label:"Payment 1",percentage:100}]);return o},B=d=>{const o=C(d);return!o.payment_breakdown||!Array.isArray(o.payment_breakdown)?0:o.payment_breakdown.reduce((n,y)=>n+(parseInt(y.percentage)||0),0)},K=d=>{const o=C(d);if(o.payment_breakdown||(o.payment_breakdown=[]),!Array.isArray(o.payment_breakdown)){const S=o.payment_breakdown;o.payment_breakdown=[{label:"First",percentage:parseInt(S.first)||30},{label:"Second",percentage:parseInt(S.second)||30},{label:"Third",percentage:parseInt(S.third)||40}]}const n=o.payment_breakdown.length;let y=0;if(n>0){const S=o.payment_breakdown[n-1];y=Math.floor(S.percentage/2),S.percentage-=y}else y=100;o.payment_breakdown.push({label:`Payment ${n+1}`,percentage:y})},v=(d,o)=>{const n=C(d);if(!n.payment_breakdown||!Array.isArray(n.payment_breakdown)||n.payment_breakdown.length<=1)return;const y=parseInt(n.payment_breakdown[o].percentage)||0;if(n.payment_breakdown.splice(o,1),y>0&&n.payment_breakdown.length>0){const S=o>0&&o<=n.payment_breakdown.length?o-1:0;n.payment_breakdown[S].percentage=(parseInt(n.payment_breakdown[S].percentage)||0)+y}n.payment_breakdown.forEach((S,I)=>{S.label=`Payment ${I+1}`})};return X(()=>P.projectId,d=>{d&&ce()},{immediate:!0}),(d,o)=>(r(),l("div",null,[_.value.general?(r(),l("div",lt,w(_.value.general),1)):p("",!0),$.value?(r(),l("div",it,"Loading...")):(r(),l("div",dt,[i("div",ct,[m(V,{for:"total_amount",value:"Total Amount"}),m(W,{id:"total_amount",type:"number",step:"0.01",class:"mt-1 block w-full",modelValue:b.total_amount,"onUpdate:modelValue":o[0]||(o[0]=n=>b.total_amount=n),disabled:!g.canManageProjectServicesAndPayments},null,8,["modelValue","disabled"]),m(O,{message:_.value.total_amount?_.value.total_amount[0]:"",class:"mt-2"},null,8,["message"])]),i("div",ut,[m(V,{for:"payment_type",value:"Payment Type"}),Y(i("select",{id:"payment_type",class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full","onUpdate:modelValue":o[1]||(o[1]=n=>b.payment_type=n),required:"",disabled:!g.canManageProjectServicesAndPayments},[(r(!0),l(R,null,T(g.paymentTypeOptions,n=>(r(),l("option",{key:n.value,value:n.value},w(n.label),9,pt))),128))],8,mt),[[ie,b.payment_type]]),m(O,{message:_.value.payment_type?_.value.payment_type[0]:"",class:"mt-2"},null,8,["message"])]),i("div",vt,[m(V,{for:"services",value:"Services"}),i("div",yt,[(r(!0),l(R,null,T(E.value,n=>(r(),l("div",{key:n.value,class:"border p-3 mb-3 rounded"},[i("div",ft,[m(rt,{id:`service_${n.value}`,value:n.value,checked:b.services,"onUpdate:checked":[o[2]||(o[2]=y=>b.services=y),y=>L(n.value,y)],disabled:!g.canManageProjectServicesAndPayments},null,8,["id","value","checked","onUpdate:checked","disabled"]),i("label",{for:`service_${n.value}`,class:"ms-2 text-sm font-medium text-gray-700"},w(n.label),9,_t)]),(b.services||[]).includes(n.value)?(r(),l("div",gt,[i("div",bt,[i("div",null,[m(V,{for:`service_amount_${n.value}`,value:"Amount",class:"text-xs"},null,8,["for"]),m(W,{id:`service_amount_${n.value}`,type:"number",step:"0.01",placeholder:"Amount",class:"w-full",modelValue:C(n.value).amount,"onUpdate:modelValue":y=>C(n.value).amount=y,disabled:!g.canManageProjectServicesAndPayments},null,8,["id","modelValue","onUpdate:modelValue","disabled"])]),i("div",null,[m(V,{for:`service_frequency_${n.value}`,value:"Frequency",class:"text-xs"},null,8,["for"]),Y(i("select",{id:`service_frequency_${n.value}`,class:"border-gray-300 rounded-md w-full","onUpdate:modelValue":y=>C(n.value).frequency=y,disabled:!g.canManageProjectServicesAndPayments},o[6]||(o[6]=[i("option",{value:"monthly"},"Monthly",-1),i("option",{value:"one_off"},"One off",-1)]),8,ht),[[ie,C(n.value).frequency]])])]),i("div",wt,[m(V,{for:`service_start_date_${n.value}`,value:"Start Date",class:"text-xs"},null,8,["for"]),m(W,{id:`service_start_date_${n.value}`,type:"date",class:"w-full",modelValue:C(n.value).start_date,"onUpdate:modelValue":y=>C(n.value).start_date=y,disabled:!g.canManageProjectServicesAndPayments},null,8,["id","modelValue","onUpdate:modelValue","disabled"])]),C(n.value).frequency!=="monthly"?(r(),l("div",kt,[i("div",xt,[m(V,{value:"Payment Breakdown (%)",class:"text-xs"}),g.canManageProjectServicesAndPayments?(r(),l("button",{key:0,type:"button",class:"text-xs text-blue-600 hover:text-blue-800",onClick:y=>K(n.value)}," + Add Payment ",8,jt)):p("",!0)]),i("div",Pt,[(r(!0),l(R,null,T(C(n.value).payment_breakdown,(y,S)=>(r(),l("div",{key:S,class:"relative"},[m(V,{for:`service_payment_${S}_${n.value}`,value:y.label,class:"text-xs"},null,8,["for","value"]),i("div",$t,[m(W,{id:`service_payment_${S}_${n.value}`,type:"text",inputmode:"numeric",pattern:"[0-9]*",min:"0",max:"100",class:"w-full",modelValue:y.percentage,"onUpdate:modelValue":I=>y.percentage=I,modelModifiers:{number:!0},onInput:I=>{y.percentage=Math.max(0,Math.min(100,parseInt(I.target.value)||0))},disabled:!g.canManageProjectServicesAndPayments},null,8,["id","modelValue","onUpdate:modelValue","onInput","disabled"]),g.canManageProjectServicesAndPayments&&C(n.value).payment_breakdown.length>1?(r(),l("button",{key:0,type:"button",class:"ml-1 text-red-500 hover:text-red-700",onClick:I=>v(n.value,S)},o[7]||(o[7]=[i("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor"},[i("path",{"fill-rule":"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z","clip-rule":"evenodd"})],-1)]),8,St)):p("",!0)])]))),128))]),i("div",{class:ee(["text-xs mt-2",{"text-gray-500":B(n.value)===100,"text-red-500 font-bold":B(n.value)!==100}])},[z(" Total: "+w(B(n.value))+"% ",1),B(n.value)!==100?(r(),l("span",Ct," (Total must be 100%) ")):p("",!0)],2)])):p("",!0)])):p("",!0)]))),128))]),i("div",At,[g.canManageProjectServicesAndPayments&&!F.value?(r(),l("button",{key:0,type:"button",class:"text-sm text-blue-600 hover:text-blue-800",onClick:o[3]||(o[3]=n=>F.value=!0)}," + Add New Service/Department ")):p("",!0),g.canManageProjectServicesAndPayments&&F.value?(r(),l("div",Vt,[m(W,{type:"text",class:"flex-grow mr-2",modelValue:h.value,"onUpdate:modelValue":o[4]||(o[4]=n=>h.value=n),placeholder:"New service/department name",onKeyup:et(ne,["enter"])},null,8,["modelValue"]),m(ae,{onClick:ne},{default:H(()=>o[8]||(o[8]=[z("Add")])),_:1,__:[8]}),i("button",{type:"button",class:"ml-2 text-sm text-gray-500 hover:text-gray-700",onClick:o[5]||(o[5]=n=>{F.value=!1,h.value=""})}," Cancel ")])):p("",!0)]),m(O,{message:_.value.services?_.value.services[0]:"",class:"mt-2"},null,8,["message"])]),g.canManageProjectServicesAndPayments?(r(),l("div",Dt,[m(ae,{onClick:re,disabled:D.value,class:ee({"opacity-25":D.value})},{default:H(()=>o[9]||(o[9]=[z(" Update Services & Payment ")])),_:1,__:[9]},8,["disabled","class"])])):p("",!0)]))]))}},It={class:"mt-2"},Ot={class:"mb-2"},Ft={key:0,class:"text-gray-500 text-sm mb-2"},Mt=["disabled"],Rt={value:""},Tt=["value"],Et={class:"flex-grow"},Nt=["value","onChange","disabled"],Bt=["value"],qt=["onClick"],Ee={__name:"MultiSelectWithRoles",props:{label:{type:String,required:!0},items:{type:Array,default:()=>[]},endpoint:{type:String,default:""},selectedItems:{type:Array,default:()=>[]},itemText:{type:String,default:"name"},itemSubtext:{type:String,default:"email"},itemValue:{type:String,default:"id"},roleOptions:{type:Array,default:()=>[]},roleType:{type:String,default:"application"},defaultRoleId:{type:Number,default:null},error:{type:String,default:""},placeholder:{type:String,default:"Select an item"},showRemoveButton:{type:Boolean,default:!0}},emits:["update:selectedItems"],setup(g,{emit:de}){const P=g,J=de,_=j([]),$=j([]),oe=j([]),E=j([]),h=j(!1),F=async()=>{if(!(P.roleOptions.length>0))try{const d=(await be.get(`/api/roles?type=${P.roleType}`)).data;oe.value=d.map(o=>({value:o.id,label:o.name}))}catch(v){console.error("Error fetching roles:",v)}},b=G(()=>oe.value.length>0?oe.value:P.roleOptions),N=()=>P.defaultRoleId?P.defaultRoleId:b.value.length>0?b.value[0].value:1,D=()=>{if(console.log("initializeFromProps called with selectedItems:",P.selectedItems),!P.selectedItems||P.selectedItems.length===0){_.value=[],$.value=[],console.log("Cleared selectedIds and selectedItemsWithRoles because props.selectedItems is empty");return}const v=new Set;P.selectedItems.forEach(d=>{const o=typeof d=="object"?d.id:d;if(!v.has(o)){if(v.add(o),!_.value.includes(o))_.value.push(o),typeof d=="object"&&d.role_id?$.value.push({id:o,role_id:d.role_id}):$.value.push({id:o,role_id:N()});else if(typeof d=="object"&&d.role_id){const n=$.value.find(y=>y.id===o);n&&(n.role_id=d.role_id)}}}),console.log("After initialization, selectedIds:",_.value),console.log("After initialization, selectedItemsWithRoles:",$.value)};X(()=>P.selectedItems,(v,d)=>{console.log("selectedItems changed:",v),JSON.stringify(v)!==JSON.stringify(d)?(console.log("selectedItems changed significantly, reinitializing"),D()):console.log("selectedItems change was not significant, skipping reinitialization")},{deep:!0,immediate:!0}),X($,v=>{J("update:selectedItems",v)},{deep:!0});const ne=v=>{v&&!_.value.includes(v)&&(_.value.push(v),$.value.push({id:v,role_id:N()}))},ce=v=>{_.value=_.value.filter(d=>d!==v),$.value=$.value.filter(d=>d.id!==v)},re=(v,d)=>{const o=$.value.find(n=>n.id===v);o&&(o.role_id=parseInt(d))},L=v=>K.value.find(d=>d[P.itemValue]===v),C=v=>{const d=$.value.find(o=>o.id===v);return d?d.role_id:N()},B=async()=>{if(P.endpoint){h.value=!0;try{const v=await be.get(P.endpoint);v.data&&Array.isArray(v.data)?E.value=v.data:v.data&&v.data.data&&Array.isArray(v.data.data)&&(E.value=v.data.data)}catch(v){console.error("Error fetching items from endpoint:",v)}finally{h.value=!1}}},K=G(()=>P.endpoint&&E.value.length>0?E.value:P.items);return Be(()=>{F(),D(),P.endpoint&&B()}),(v,d)=>(r(),l("div",null,[m(V,{value:g.label},null,8,["value"]),i("div",It,[i("div",Ot,[h.value?(r(),l("div",Ft,"Loading...")):p("",!0),g.showRemoveButton?(r(),l("select",{key:1,class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full",onChange:d[0]||(d[0]=o=>{const n=parseInt(o.target.value);ne(n),o.target.value=""}),disabled:h.value},[i("option",Rt,w(g.placeholder),1),(r(!0),l(R,null,T(K.value.filter(o=>!_.value.includes(o[g.itemValue])),o=>(r(),l("option",{key:o[g.itemValue],value:o[g.itemValue]},w(o[g.itemText])+" ("+w(o[g.itemSubtext])+") ",9,Tt))),128))],40,Mt)):p("",!0)]),(r(!0),l(R,null,T(_.value,o=>{var n,y;return r(),l("div",{key:o,class:"flex items-center mb-1 p-2 border rounded"},[i("div",Et,w((n=L(o))==null?void 0:n[g.itemText])+" ("+w((y=L(o))==null?void 0:y[g.itemSubtext])+") ",1),i("select",{class:"ms-2 border-gray-300 rounded-md",value:C(o),onChange:S=>re(o,S.target.value),disabled:!g.showRemoveButton},[(r(!0),l(R,null,T(b.value,S=>(r(),l("option",{key:S.value,value:S.value},w(S.label),9,Bt))),128))],40,Nt),g.showRemoveButton?(r(),l("button",{key:0,type:"button",class:"ml-2 text-red-600",onClick:()=>ce(o)}," Remove ",8,qt)):p("",!0)])}),128))]),m(O,{message:g.error,class:"mt-2"},null,8,["message"])]))}},Lt={class:"p-6 w-full max-w-6xl mx-auto bg-white rounded-lg shadow-xl"},zt={class:"flex justify-between items-center mb-4"},Wt={class:"text-lg font-medium text-gray-900"},Jt={key:0,class:"text-red-600 text-sm mb-4"},Gt={key:1,class:"mb-4"},Kt={key:0,class:"text-xs text-gray-500 mt-2 p-2 bg-gray-100 rounded"},Yt={class:"font-bold"},Ht={class:"mt-1"},Xt={key:0},Qt={key:1},Zt={key:2},es={key:0},ts={class:"list-disc ml-4"},ss={key:0},as={class:"mt-1"},os={class:"border-b border-gray-200 mb-6"},ns={class:"flex -mb-px"},rs={key:0},ls={class:"mb-4"},is={class:"mb-4"},ds=["disabled"],cs={class:"mb-4"},us={class:"mb-4"},ms={class:"mb-4"},ps=["disabled"],vs=["value"],ys={class:"mb-4"},fs=["disabled"],_s=["value"],gs={key:0,class:"mt-6 flex justify-end"},bs={key:1},hs={key:0,class:"mb-4"},ws={key:0,class:"mt-2 flex justify-end"},ks={key:1,class:"mt-2 text-green-600 text-sm"},xs={key:2,class:"mt-2 text-red-600 text-sm"},js={class:"mb-4"},Ps=["disabled"],$s={key:1,class:"mb-4"},Ss={key:0,class:"mt-2 flex justify-end"},Cs={key:1,class:"mt-2 text-green-600 text-sm"},As={key:2,class:"mt-2 text-red-600 text-sm"},Vs={key:2},Ds={key:3},Us={class:"mb-4"},Is={class:"flex justify-between items-center mb-4"},Os={class:"text-right"},Fs={class:"text-lg font-medium"},Ms={class:"text-lg font-medium"},Rs={class:"text-xl font-bold mt-1"},Ts={key:0,class:"mt-4"},Es=["onUpdate:modelValue"],Ns={key:0,value:"income"},Bs={key:1,value:"expense"},qs=["onUpdate:modelValue"],Ls=["value"],zs=["onClick"],Ws={class:"flex mt-2"},Js={key:0,class:"mt-6 flex justify-end"},Gs={key:4},Ks={class:"mb-4"},Ys={class:"mt-2"},Hs={key:0,class:"mb-4"},Xs={class:"mt-4"},Qs={key:0,class:"text-sm text-red-500 mt-2"},Zs={key:1,class:"mt-4"},ea={class:"flex-grow"},ta=["href"],sa=["onClick"],aa={key:5},oa={class:"mb-4"},na={class:"mt-2"},ra={key:0},la={class:"flex items-start mb-2"},ia=["onUpdate:modelValue","readonly"],da={key:1,class:"p-4 bg-gray-50 rounded-md text-gray-600 text-center"},ca={class:"mt-6 flex justify-end"},ga={__name:"ProjectForm",props:{show:{type:Boolean,required:!0},project:{type:Object,default:()=>({})},statusOptions:{type:Array,required:!0},departmentOptions:{type:Array,required:!0},sourceOptions:{type:Array,required:!0},clientRoleOptions:{type:Array,default:()=>[]},userRoleOptions:{type:Array,default:()=>[]},paymentTypeOptions:{type:Array,required:!0}},emits:["close","submit"],setup(g,{emit:de}){tt();const P=j({}),J=g;X(()=>J.project,t=>{P.value=t||{}},{immediate:!0});const _=G(()=>{var t;return((t=P.value)==null?void 0:t.id)||null}),{permissions:$,loading:oe,error:E}=st(_),h=at(P);G(()=>!!h.value),G(()=>{if(!h.value)return!1;const t=h.value.name,s=h.value.slug;return t==="Manager"||t==="Project Manager"||s==="manager"||s==="project-manager"});const{canDo:F,canView:b,canManage:N}=ot(_),D=F("manage_projects",h),ne=F("create_projects",h),ce=F("create_clients",h),re=F("upload_project_documents",h),L=N("project_expenses",h),C=N("project_income",h),B=N("project_services_and_payments",h),K=F("add_project_notes",h),v=N("project_users",h),d=N("project_clients",h),o=N("project_basic_details",h),n=b("project_documents",h),y=b("project_services_and_payments",h),S=b("project_notes",h),I=b("project_users",h),te=b("project_clients",h),he=b("view_project_transactions",h),U=j("basic"),qe=G(()=>te.value&&I.value?"Clients and Users":te.value?"Clients":I.value?"Users":"Clients and Users"),se=t=>{if(!(t==="documents"&&!e.id)&&(U.value=t,e.id))switch(M.value=!0,t){case"basic":Ce(e.id).finally(()=>{M.value=!1});break;case"client":te.value||d.value||I.value||v.value?Ae(e.id).finally(()=>{M.value=!1}):M.value=!1;break;case"services":y.value||B.value?we(e.id).finally(()=>{M.value=!1}):M.value=!1;break;case"transactions":L.value||C.value?Ve(e.id).finally(()=>{M.value=!1}):M.value=!1;break;case"documents":n.value?De(e.id).finally(()=>{M.value=!1}):M.value=!1;break;case"notes":S.value||K.value?Ue(e.id).finally(()=>{M.value=!1}):M.value=!1;break;default:M.value=!1;break}},ue=j([]),me=j([]),pe=j([]),le=j([]),Le=async()=>{try{const s=(await be.get("/api/roles?type=client")).data;ue.value=s.map(f=>({value:f.id,label:f.name}));const a=(await be.get("/api/roles?type=project")).data;me.value=a.map(f=>({value:f.id,label:f.name}))}catch(t){console.error("Error fetching roles:",t)}},$e=async()=>{try{if(ce.value){const t=await window.axios.get("/api/clients");pe.value=t.data.data||t.data}else if(_.value){const t=await window.axios.get(`/api/projects/${_.value}/clients`);pe.value=t.data}else{const t=await window.axios.get("/api/clients");pe.value=t.data.data||t.data}}catch(t){console.error("Error fetching clients:",t),A.value="Failed to load clients."}},Se=async()=>{try{if(ne.value){const t=await window.axios.get("/api/users");le.value=t.data}else if(_.value){const t=await window.axios.get(`/api/projects/${_.value}/users`);le.value=t.data}else{const t=await window.axios.get("/api/users");le.value=t.data}}catch(t){console.error("Error fetching users:",t),A.value="Failed to load users."}},ze=G(()=>ue.value.length>0?ue.value:J.clientRoleOptions),We=G(()=>me.value.length>0?me.value:J.userRoleOptions),Ce=async t=>{try{const c=(await window.axios.get(`/api/projects/${t}/sections/basic`)).data;return e.name=c.name||"",e.description=c.description||"",e.website=c.website||"",e.social_media_link=c.social_media_link||"",e.preferred_keywords=c.preferred_keywords||"",e.google_chat_id=c.google_chat_id||"",e.status=c.status||"active",e.project_type=c.project_type||"",e.source=c.source||"",e.google_drive_link=c.google_drive_link||"",c}catch(s){return console.error("Error fetching basic project data:",s),A.value="Failed to fetch basic project data.",null}},Ae=async t=>{try{const c=(await window.axios.get(`/api/projects/${t}/sections/clients-users`)).data;return c.clients&&c.clients.length>0&&(e.client_ids=c.clients.map(a=>{var x;let f=((x=a.pivot)==null?void 0:x.role_id)||(ue.value.length>0?ue.value[0].value:1);return{id:a.id,role_id:f}})),c.users&&c.users.length>0&&(e.user_ids=c.users.map(a=>{var x;let f=((x=a.pivot)==null?void 0:x.role_id)||(me.value.length>0?me.value[0].value:2);return{id:a.id,role_id:f}})),c.contract_details!==void 0&&(e.contract_details=c.contract_details||""),c}catch(s){return console.error("Error fetching clients and users data:",s),A.value="Failed to fetch clients and users data.",null}},we=async t=>{try{const c=(await window.axios.get(`/api/projects/${t}/sections/services-payment`)).data;return e.services=c.services||[],e.service_details=c.service_details||[],e.total_amount=c.total_amount||"",e.payment_type=c.payment_type||"one_off",c}catch(s){return console.error("Error fetching services and payment data:",s),A.value="Failed to fetch services and payment data.",null}},Ve=async t=>{try{const c=(await window.axios.get(`/api/projects/${t}/sections/transactions`)).data;return e.transactions=c.map(a=>({description:a.description,amount:a.amount,user_id:a.user_id,hours_spent:a.hours_spent,type:a.type||"expense"})),c}catch(s){return console.error("Error fetching transactions data:",s),A.value="Failed to fetch transactions data.",null}},De=async t=>{try{const c=(await window.axios.get(`/api/projects/${t}/sections/documents`)).data;return e.documents=c.documents||[],c}catch(s){return console.error("Error fetching documents data:",s),A.value="Failed to fetch documents data.",null}},Ue=async t=>{try{const c=(await window.axios.get(`/api/projects/${t}/sections/notes`)).data;return e.notes=c.map(a=>({content:a.content})),c}catch(s){return console.error("Error fetching notes data:",s),A.value="Failed to fetch notes data.",null}},Je=async t=>{try{switch(await Ce(t),U.value){case"client":(te.value||d.value||I.value||v.value)&&await Ae(t);break;case"services":(y.value||B.value)&&await we(t);break;case"transactions":(L.value||C.value)&&await Ve(t);break;case"documents":n.value&&await De(t);break;case"notes":(S.value||K.value)&&await Ue(t);break}}catch(s){console.error("Error fetching project data:",s),A.value="Failed to fetch project data."}};Be(()=>{Le(),$e(),Se(),_.value&&Fe(_.value).then(t=>{}).catch(t=>{})}),X(_,(t,s)=>{t&&t!==s&&(Fe(t).then(c=>{}).catch(c=>{}),Se(),$e())});const ke=de,k=j({}),A=j(""),M=j(!1),Ge=j(!1),ve=j(!1),ye=j(!1),Q=j(""),fe=j(!1),_e=j(!1),Z=j(""),e=Ne({id:null,name:"",description:"",website:"",social_media_link:"",preferred_keywords:"",google_chat_id:"",logo:null,documents:[],client_ids:[],status:"active",project_type:"",services:[],service_details:[],source:"",total_amount:"",contract_details:"",google_drive_link:"",payment_type:"one_off",user_ids:[],transactions:[],notes:[]});X(()=>J.show,t=>{t&&(e.client_ids||(e.client_ids=[]),e.user_ids||(e.user_ids=[]),e.id&&Je(e.id))},{immediate:!0}),X(()=>J.project,t=>{const s=e.id;e.id=t.id||null,s&&!e.id&&U.value==="documents"&&se("basic"),e.name=t.name||"",e.description=t.description||"",e.website=t.website||"",e.social_media_link=t.social_media_link||"",e.preferred_keywords=t.preferred_keywords||"",e.google_chat_id=t.google_chat_id||"",e.logo=t.logo||null,e.documents=t.documents||[],e.client_ids=[],e.status=t.status||"active",e.project_type=t.project_type||"",e.services=t.services||[],e.service_details=t.service_details||[],e.source=t.source||"",e.total_amount=t.total_amount||"",e.contract_details=t.contract_details||"",e.google_drive_link=t.google_drive_link||"",e.payment_type=t.payment_type||"one_off",e.user_ids=[],e.transactions=t.transactions?t.transactions.map(c=>({description:c.description,amount:c.amount,user_id:c.user_id,hours_spent:c.hours_spent,type:c.type||"expense"})):[],e.notes=t.notes?t.notes.map(c=>({content:c.content})):[],k.value={},A.value=""},{immediate:!0});const Ke=async()=>{k.value={},A.value="";try{const t={name:e.name,description:e.description,website:e.website,social_media_link:e.social_media_link,preferred_keywords:e.preferred_keywords,google_chat_id:e.google_chat_id,status:e.status,project_type:e.project_type,source:e.source,google_drive_link:e.google_drive_link,user_ids:e.user_ids},s=e.logo;typeof s=="object"&&s!==null&&"name"in s&&delete t.logo;const c=await window.axios.post("/api/projects",t);e.id=c.data.id,typeof s=="object"&&s!==null&&"name"in s&&await Oe(s,e.id),ke("submit",c.data)}catch(t){xe(t,"Failed to create project.")}},Ye=async()=>{k.value={},A.value="";try{const t={name:e.name,description:e.description,website:e.website,social_media_link:e.social_media_link,preferred_keywords:e.preferred_keywords,google_chat_id:e.google_chat_id,status:e.status,project_type:e.project_type,source:e.source,google_drive_link:e.google_drive_link},s=e.logo;typeof s=="object"&&s!==null&&"name"in s&&delete t.logo;const c=await window.axios.put(`/api/projects/${e.id}/sections/basic`,t);typeof s=="object"&&s!==null&&"name"in s&&await Oe(s,e.id),Te("Basic information updated successfully!")}catch(t){xe(t,"Failed to update basic information.")}},He=async()=>{k.value={},A.value="";try{const t={transactions:e.transactions};L.value||(t.transactions=t.transactions.filter(c=>c.type!=="expense")),C.value||(t.transactions=t.transactions.filter(c=>c.type!=="income"));const s=await window.axios.put(`/api/projects/${e.id}/sections/transactions`,t);Te("Transactions updated successfully!")}catch(t){xe(t,"Failed to update transactions.")}},xe=(t,s)=>{t.response&&t.response.status===422?k.value=t.response.data.errors:t.response&&t.response.data.message?A.value=t.response.data.message:(A.value=s,console.error("Error:",t))},ge=j(!1),je=j({});X(e,()=>{Object.keys(je.value).length>0&&(ge.value=!0)},{deep:!0}),X(()=>J.show,t=>{t&&setTimeout(()=>{je.value=JSON.parse(JSON.stringify(e)),ge.value=!1},100)});const Ie=()=>{ge.value?confirm("You have unsaved changes. Are you sure you want to close this form?")&&ke("close"):ke("close")},Oe=async(t,s)=>{try{const c=new FormData;c.append("logo",t);const a=await window.axios.post(`/api/projects/${s}/logo`,c,{headers:{"Content-Type":"multipart/form-data"}});return a.data&&a.data.logo&&(e.logo=a.data.logo),a}catch(c){console.error("Error uploading logo:",c)}},Xe=async()=>{if(!e.id){Q.value="Please save the project first before saving clients.";return}if(!e.client_ids||e.client_ids.length===0){Q.value="Please select at least one client to save.";return}ve.value=!0,ye.value=!1,Q.value="";try{const t=await window.axios.post(`/api/projects/${e.id}/attach-clients`,{client_ids:e.client_ids});ye.value=!0,setTimeout(()=>{ye.value=!1},3e3)}catch(t){t.response&&t.response.status===422?Q.value="Validation error. Please check your input.":t.response&&t.response.data.message?Q.value=t.response.data.message:(Q.value="Failed to save clients.",console.error("Error saving clients:",t))}finally{ve.value=!1}},Qe=async()=>{if(console.log("saveUsers called, projectForm.user_ids:",e.user_ids),!e.id){Z.value="Please save the project first before saving users.";return}if(!e.user_ids||e.user_ids.length===0){console.log("No users selected, projectForm.user_ids is empty or null"),Z.value="Please select at least one user to save.";return}fe.value=!0,_e.value=!1,Z.value="";try{console.log("Sending user_ids to API:",JSON.stringify(e.user_ids));const t=await window.axios.post(`/api/projects/${e.id}/attach-users`,{user_ids:e.user_ids});_e.value=!0,setTimeout(()=>{_e.value=!1},3e3)}catch(t){t.response&&t.response.status===422?Z.value="Validation error. Please check your input.":t.response&&t.response.data.message?Z.value=t.response.data.message:(Z.value="Failed to save users.",console.error("Error saving users:",t))}finally{fe.value=!1}},Ze=async()=>{if(!e.id){A.value="Please save the project first before uploading documents.";return}if(!e.documents||!e.documents.some(t=>typeof t=="object"&&t!==null&&"name"in t&&"size"in t&&"type"in t)){A.value="Please select documents to upload.";return}try{const t=new FormData;e.documents.filter(f=>typeof f=="object"&&f!==null&&"name"in f&&"size"in f&&"type"in f).forEach((f,x)=>{t.append(`documents[${x}]`,f)});const c=await window.axios.post(`/api/projects/${e.id}/documents`,t,{headers:{"Content-Type":"multipart/form-data"}});e.documents=c.data.documents||[],document.getElementById("documents").value="",alert("Documents uploaded successfully!");const a=JSON.parse(JSON.stringify(e));je.value=a,ge.value=!1}catch(t){t.response&&t.response.status===422?k.value=t.response.data.errors:t.response&&t.response.data.message?A.value=t.response.data.message:(A.value="Failed to upload documents.",console.error("Error uploading documents:",t))}};return(t,s)=>{var c;return r(),l("div",Lt,[i("div",zt,[i("h2",Wt,w(e.id?"Edit Project":"Create New Project"),1),i("button",{onClick:Ie,class:"text-gray-400 hover:text-gray-500"},s[20]||(s[20]=[i("svg",{class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[i("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),A.value?(r(),l("div",Jt,w(A.value),1)):p("",!0),_.value?(r(),l("div",Gt,[Ge.value?(r(),l("div",Kt,[i("div",Yt,"Project ID: "+w(_.value),1),i("div",null,w(u(h)?"Project Role: "+(((c=u(h).value)==null?void 0:c.name)||"None"):"No Project Role"),1),i("div",Ht,[s[22]||(s[22]=i("div",{class:"font-semibold"},"Project Permissions:",-1)),u(oe)?(r(),l("div",Xt,"Loading project permissions...")):u(E)?(r(),l("div",Qt,"Error loading project permissions")):u($)?(r(),l("div",Zt,[z(" Count: "+w(u($).permissions?u($).permissions.length:0)+" ",1),u($).permissions&&u($).permissions.length>0?(r(),l("div",es,[s[21]||(s[21]=i("div",{class:"font-semibold"},"Permissions:",-1)),i("ul",ts,[(r(!0),l(R,null,T(u($).permissions.slice(0,5),a=>(r(),l("li",{key:a.slug},w(a.name)+" ("+w(a.source)+") ",1))),128)),u($).permissions.length>5?(r(),l("li",ss," ... and "+w(u($).permissions.length-5)+" more ",1)):p("",!0)])])):p("",!0)])):p("",!0)]),i("div",as,"Can manage projects: "+w(u(D)?"Yes":"No"),1)])):p("",!0)])):p("",!0),i("div",os,[i("nav",ns,[u(D)?(r(),l("button",{key:0,onClick:s[0]||(s[0]=a=>se("basic")),class:ee(["py-2 px-4 text-center border-b-2 font-medium text-sm",U.value==="basic"?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"])}," Basic Information ",2)):p("",!0),u(te)||u(I)?(r(),l("button",{key:1,onClick:s[1]||(s[1]=a=>se("client")),class:ee(["py-2 px-4 text-center border-b-2 font-medium text-sm",U.value==="client"?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"])},w(qe.value),3)):p("",!0),e.id&&(u(B)||u(y))?(r(),l("button",{key:2,onClick:s[2]||(s[2]=a=>se("services")),class:ee(["py-2 px-4 text-center border-b-2 font-medium text-sm",U.value==="services"?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"])}," Services & Payment ",2)):p("",!0),e.id&&u(he)?(r(),l("button",{key:3,onClick:s[3]||(s[3]=a=>se("transactions")),class:ee(["py-2 px-4 text-center border-b-2 font-medium text-sm",U.value==="transactions"?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"])}," Transactions ",2)):p("",!0),e.id&&u(n)?(r(),l("button",{key:4,onClick:s[4]||(s[4]=a=>se("documents")),class:ee(["py-2 px-4 text-center border-b-2 font-medium text-sm",U.value==="documents"?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"])}," Documents ",2)):p("",!0),e.id&&(u(K)||u(S))?(r(),l("button",{key:5,onClick:s[5]||(s[5]=a=>se("notes")),class:ee(["py-2 px-4 text-center border-b-2 font-medium text-sm",U.value==="notes"?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"])}," Notes ",2)):p("",!0)])]),i("form",{onSubmit:s[19]||(s[19]=nt(()=>{},["prevent"]))},[U.value==="basic"?(r(),l("div",rs,[i("div",ls,[m(V,{for:"name",value:"Project Name"}),m(W,{id:"name",type:"text",class:"mt-1 block w-full",modelValue:e.name,"onUpdate:modelValue":s[6]||(s[6]=a=>e.name=a),required:"",autofocus:"",disabled:!u(D)},null,8,["modelValue","disabled"]),m(O,{message:k.value.name?k.value.name[0]:"",class:"mt-2"},null,8,["message"])]),i("div",is,[m(V,{for:"description",value:"Description"}),Y(i("textarea",{id:"description",class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full","onUpdate:modelValue":s[7]||(s[7]=a=>e.description=a),disabled:!u(D)},null,8,ds),[[Pe,e.description]]),m(O,{message:k.value.description?k.value.description[0]:"",class:"mt-2"},null,8,["message"])]),i("div",cs,[m(V,{for:"website",value:"Website"}),m(W,{id:"website",type:"url",class:"mt-1 block w-full",modelValue:e.website,"onUpdate:modelValue":s[8]||(s[8]=a=>e.website=a),disabled:!u(D)},null,8,["modelValue","disabled"]),m(O,{message:k.value.website?k.value.website[0]:"",class:"mt-2"},null,8,["message"])]),i("div",us,[m(V,{for:"preferred_keywords",value:"Client Preferred Keywords"}),m(W,{id:"preferred_keywords",type:"text",class:"mt-1 block w-full",modelValue:e.preferred_keywords,"onUpdate:modelValue":s[9]||(s[9]=a=>e.preferred_keywords=a),disabled:!u(D)},null,8,["modelValue","disabled"]),m(O,{message:k.value.preferred_keywords?k.value.preferred_keywords[0]:"",class:"mt-2"},null,8,["message"])]),i("div",ms,[m(V,{for:"status",value:"Status"}),Y(i("select",{id:"status",class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full","onUpdate:modelValue":s[10]||(s[10]=a=>e.status=a),required:"",disabled:!u(D)},[(r(!0),l(R,null,T(g.statusOptions,a=>(r(),l("option",{key:a.value,value:a.value},w(a.label),9,vs))),128))],8,ps),[[ie,e.status]]),m(O,{message:k.value.status?k.value.status[0]:"",class:"mt-2"},null,8,["message"])]),i("div",ys,[m(V,{for:"source",value:"Source"}),Y(i("select",{id:"source",class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full","onUpdate:modelValue":s[11]||(s[11]=a=>e.source=a),disabled:!u(D)},[s[23]||(s[23]=i("option",{value:"",disabled:""},"Select a Source",-1)),(r(!0),l(R,null,T(g.sourceOptions,a=>(r(),l("option",{key:a.value,value:a.value},w(a.label),9,_s))),128))],8,fs),[[ie,e.source]]),m(O,{message:k.value.source?k.value.source[0]:"",class:"mt-2"},null,8,["message"])]),u(D)?(r(),l("div",gs,[e.id&&u(o)||!e.id?(r(),Me(ae,{key:0,onClick:s[12]||(s[12]=a=>e.id?Ye():Ke()),disabled:!u(D)},{default:H(()=>[z(w(e.id?"Update Basic Information":"Create Project"),1)]),_:1},8,["disabled"])):p("",!0)])):p("",!0)])):p("",!0),U.value==="client"?(r(),l("div",bs,[u(te)?(r(),l("div",hs,[m(Ee,{label:"Clients",items:pe.value,selectedItems:e.client_ids,"onUpdate:selectedItems":s[13]||(s[13]=a=>e.client_ids=a),roleOptions:ze.value,roleType:"client",error:k.value.client_ids?k.value.client_ids[0]:"",placeholder:"Select a client to add",disabled:!u(d),readonly:!u(d)&&u(te),showRemoveButton:u(d)},null,8,["items","selectedItems","roleOptions","error","disabled","readonly","showRemoveButton"]),u(d)?(r(),l("div",ws,[m(ae,{onClick:Xe,disabled:ve.value},{default:H(()=>[z(w(ve.value?"Saving...":"Save Clients"),1)]),_:1},8,["disabled"])])):p("",!0),ye.value?(r(),l("div",ks," Clients saved successfully! ")):p("",!0),Q.value?(r(),l("div",xs,w(Q.value),1)):p("",!0)])):p("",!0),i("div",js,[m(V,{for:"contract_details",value:"Contract Details"}),Y(i("textarea",{id:"contract_details",class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full","onUpdate:modelValue":s[14]||(s[14]=a=>e.contract_details=a),disabled:!u(D)},null,8,Ps),[[Pe,e.contract_details]]),m(O,{message:k.value.contract_details?k.value.contract_details[0]:"",class:"mt-2"},null,8,["message"])]),u(I)?(r(),l("div",$s,[m(Ee,{label:"Assign Users",items:le.value,selectedItems:e.user_ids,"onUpdate:selectedItems":s[15]||(s[15]=a=>e.user_ids=a),roleOptions:We.value,roleType:"project",defaultRoleId:2,error:k.value.user_ids?k.value.user_ids[0]:"",placeholder:"Select a user to add",disabled:!u(v),readonly:!u(v)&&u(I),showRemoveButton:u(v)},null,8,["items","selectedItems","roleOptions","error","disabled","readonly","showRemoveButton"]),u(v)?(r(),l("div",Ss,[m(ae,{onClick:Qe,disabled:fe.value},{default:H(()=>[z(w(fe.value?"Saving...":"Save Users"),1)]),_:1},8,["disabled"])])):p("",!0),_e.value?(r(),l("div",Cs," Users saved successfully! ")):p("",!0),Z.value?(r(),l("div",As,w(Z.value),1)):p("",!0)])):p("",!0)])):p("",!0),U.value==="services"?(r(),l("div",Vs,[m(Ut,{projectId:e.id,departmentOptions:g.departmentOptions,paymentTypeOptions:g.paymentTypeOptions,canManageProjectServicesAndPayments:u(B),canViewProjectServicesAndPayments:u(y),onUpdated:s[16]||(s[16]=a=>we(e.id))},null,8,["projectId","departmentOptions","paymentTypeOptions","canManageProjectServicesAndPayments","canViewProjectServicesAndPayments"])])):p("",!0),U.value==="transactions"&&u(he)?(r(),l("div",Ds,[i("div",Us,[i("div",Is,[s[24]||(s[24]=i("h3",{class:"text-lg font-medium"},"Transactions",-1)),i("div",Os,[i("div",Fs," Total Income: $"+w(e.transactions.filter(a=>a.type==="income").reduce((a,f)=>a+(parseFloat(f.amount)||0),0).toFixed(2)),1),i("div",Ms," Total Expenses: $"+w(e.transactions.filter(a=>a.type==="expense").reduce((a,f)=>a+(parseFloat(f.amount)||0),0).toFixed(2)),1),i("div",Rs," Net: $"+w((e.transactions.filter(a=>a.type==="income").reduce((a,f)=>a+(parseFloat(f.amount)||0),0)-e.transactions.filter(a=>a.type==="expense").reduce((a,f)=>a+(parseFloat(f.amount)||0),0)).toFixed(2)),1)])]),u(he)?(r(),l("div",Ts,[(r(!0),l(R,null,T(e.transactions,(a,f)=>(r(),l("div",{key:f,class:"flex items-center mb-2 p-2 border rounded"},[Y(i("select",{"onUpdate:modelValue":x=>a.type=x,class:"mr-2 border-gray-300 rounded-md"},[u(C)?(r(),l("option",Ns,"Income")):p("",!0),u(L)?(r(),l("option",Bs,"Expense")):p("",!0)],8,Es),[[ie,a.type]]),m(W,{modelValue:a.description,"onUpdate:modelValue":x=>a.description=x,placeholder:"Description",class:"mr-2 flex-grow"},null,8,["modelValue","onUpdate:modelValue"]),m(W,{modelValue:a.amount,"onUpdate:modelValue":x=>a.amount=x,modelModifiers:{number:!0},type:"number",step:"0.01",placeholder:"Amount",class:"mr-2 w-24"},null,8,["modelValue","onUpdate:modelValue"]),a.type==="expense"?Y((r(),l("select",{key:0,"onUpdate:modelValue":x=>a.user_id=x,class:"mr-2 border-gray-300 rounded-md"},[s[25]||(s[25]=i("option",{value:"",disabled:""},"Select User (Optional)",-1)),(r(!0),l(R,null,T(Array.isArray(le.value)?le.value.filter(x=>e.user_ids.some(q=>q.id===x.id)):[],x=>(r(),l("option",{key:x.id,value:x.id},w(x.name),9,Ls))),128))],8,qs)),[[ie,a.user_id]]):p("",!0),a.type==="expense"?(r(),Me(W,{key:1,modelValue:a.hours_spent,"onUpdate:modelValue":x=>a.hours_spent=x,modelModifiers:{number:!0},type:"number",step:"0.01",placeholder:"Hours",class:"mr-2 w-20"},null,8,["modelValue","onUpdate:modelValue"])):p("",!0),i("button",{type:"button",class:"text-red-600",onClick:x=>e.transactions.splice(f,1)}," Remove ",8,zs)]))),128)),i("div",Ws,[m(Re,{onClick:s[17]||(s[17]=a=>e.transactions.push({description:"",amount:"",user_id:null,hours_spent:"",type:"expense"}))},{default:H(()=>s[26]||(s[26]=[z(" Add Transaction ")])),_:1,__:[26]})])])):p("",!0),m(O,{message:k.value.transactions?k.value.transactions[0]:"",class:"mt-2"},null,8,["message"])]),u(L)||u(C)?(r(),l("div",Js,[m(ae,{onClick:He,disabled:!e.id||!u(L)&&!u(C)},{default:H(()=>s[27]||(s[27]=[z(" Update Transactions ")])),_:1,__:[27]},8,["disabled"])])):p("",!0)])):p("",!0),U.value==="documents"?(r(),l("div",Gs,[i("div",Ks,[m(V,{value:"Project Documents"}),i("div",Ys,[u(re)?(r(),l("div",Hs,[m(V,{for:"documents",value:"Upload Documents"}),i("input",{type:"file",id:"documents",onChange:s[18]||(s[18]=a=>{const f=Array.from(a.target.files);if(f.length>0){const x=Array.isArray(e.documents)?e.documents.filter(q=>typeof q=="object"&&"path"in q):[];e.documents=[...x,...f],console.log("Files selected:",f),console.log("Are files File objects?",f.some(q=>typeof q=="object"&&q!==null&&"name"in q&&"size"in q&&"type"in q)),console.log("Updated documents array:",e.documents)}}),class:"mt-1 block w-full",multiple:"",accept:".pdf,.doc,.docx,.jpg,.png"},null,32),s[29]||(s[29]=i("p",{class:"text-sm text-gray-500 mt-1"},"Supported formats: PDF, DOC, DOCX, JPG, PNG",-1)),m(O,{message:k.value.documents?k.value.documents[0]:"",class:"mt-2"},null,8,["message"]),i("div",Xs,[m(ae,{type:"button",onClick:Ze,disabled:!e.id||!e.documents||!e.documents.some(a=>typeof a=="object"&&a!==null&&"name"in a&&"size"in a&&"type"in a)},{default:H(()=>s[28]||(s[28]=[z(" Upload Documents ")])),_:1,__:[28]},8,["disabled"]),e.id?p("",!0):(r(),l("p",Qs," Please save the project first before uploading documents. "))])])):p("",!0),e.documents&&e.documents.length>0&&typeof e.documents[0]=="object"&&"path"in e.documents[0]?(r(),l("div",Zs,[s[30]||(s[30]=i("h3",{class:"font-medium text-gray-700 mb-2"},"Existing Documents",-1)),(r(!0),l(R,null,T(e.documents,(a,f)=>(r(),l("div",{key:f,class:"flex items-center mb-2 p-2 border rounded"},[i("div",ea,[i("a",{href:"/storage/"+a.path,target:"_blank",class:"text-blue-600 hover:underline"},w(a.filename),9,ta)]),u(re).value?(r(),l("button",{key:0,type:"button",class:"ml-2 text-red-600",onClick:()=>{e.documents=e.documents.filter((x,q)=>q!==f)}}," Remove ",8,sa)):p("",!0)]))),128))])):p("",!0),s[31]||(s[31]=i("div",{class:"mt-4"},[i("p",{class:"text-sm text-gray-500"}," Documents will be uploaded to the project's Google Drive folder. ")],-1))])])])):p("",!0),U.value==="notes"?(r(),l("div",aa,[i("div",oa,[m(V,{value:"Notes"}),i("div",na,[e.notes&&e.notes.length>0?(r(),l("div",ra,[(r(!0),l(R,null,T(e.notes,(a,f)=>(r(),l("div",{key:f,class:"mb-4"},[i("div",la,[Y(i("textarea",{"onUpdate:modelValue":x=>a.content=x,readonly:!u(K),placeholder:"Note Content",class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full h-32"},null,8,ia),[[Pe,a.content]])])]))),128))])):(r(),l("div",da," No notes found for this project. "))]),m(O,{message:k.value.notes?k.value.notes[0]:"",class:"mt-2"},null,8,["message"])])])):p("",!0),i("div",ca,[m(Re,{onClick:Ie},{default:H(()=>s[32]||(s[32]=[z("Close")])),_:1,__:[32]})])],32)])}}};export{ga as _};
