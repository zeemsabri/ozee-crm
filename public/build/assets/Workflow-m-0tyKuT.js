import D from"./TriggerStep-thykhdf8.js";import N from"./ConditionStep-zRpXgAw5.js";import F from"./ActionStep-D5GfFcAv.js";import $ from"./AIStep-C_IlUOxS.js";import H from"./ForEachStep-Bfr3boIP.js";import U from"./FetchRecordsStep-DxJjA9Tu.js";import B from"./ScheduleTriggerStep-DToDv6XI.js";import E from"./AddStepButton-3OZ8Cs5L.js";import{u as L}from"./workflowStore-XAGUmoSA.js";import{c as P,B as G,a as m,o as a,F as S,b as p,d as u,l as M,g as W,i as b,a8 as j}from"./app-C_l5dlFM.js";import"./StepCard-C2N0dOAe.js";import"./trash-Bh-xRuVC.js";import"./createLucideIcon-kJjbaSbK.js";import"./SelectDropdown-Duuae3KQ.js";/* empty css                                                                       */import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./DataTokenInserter-B5tp_nJc.js";import"./plus-BLJjzuTJ.js";import"./RelatedDataPicker-OZ5dHcCt.js";import"./BaseFormModal-gnHL_btQ.js";import"./Modal-ernkAfjj.js";import"./PrimaryButton-BeqOxdrm.js";import"./SecondaryButton-CHg2i9M2.js";import"./PromptForm-BV1zDQVI.js";import"./ResponseBuilder-BjjM8RZ2.js";import"./FieldBuilder-CAOdJHz8.js";import"./chevron-down-CCfqkMMZ.js";import"./circle-x-DCvXriQI.js";const V={class:"flex flex-col items-center w-full space-y-4"},q={key:0,class:"text-center p-8 border-2 border-dashed rounded-lg w-full max-w-md"},Y={class:"flex justify-center"},z={class:"w-full flex flex-col items-center"},J={key:1,class:"w-full flex mt-4 space-x-4"},K={class:"flex-1 bg-green-50/50 p-4 rounded-lg border border-green-200"},Q={class:"flex-1 bg-red-50/50 p-4 rounded-lg border border-red-200"},X={key:2,class:"w-full mt-4 p-4 rounded-lg border border-purple-300 bg-purple-50/50"},Tt={__name:"Workflow",props:{steps:{type:Array,required:!0},fullContextSteps:{type:Array,default:()=>[]},loopContextSchema:{type:Object,default:null},allowTrigger:{type:Boolean,default:!0}},emits:["update:steps","add-trigger"],setup(l,{emit:I}){const R=L(),T=P(()=>R.automationSchema||[]),f=l,C=I,k={TRIGGER:D,SCHEDULE_TRIGGER:B,FETCH_RECORDS:U,CONDITION:N,ACTION:F,AI_PROMPT:$,FOR_EACH:H},y=r=>k[r]||null;function v(r){var c,w,_,O;const t=(c=r.step_config)==null?void 0:c.sourceArray;if(!t)return null;const s=t.match(/{{step_(\w+)\.(.+)}}/);if(!s)return null;const e=s[1],n=s[2],o=f.fullContextSteps.find(i=>i.id==e);if((o==null?void 0:o.step_type)==="AI_PROMPT"){const i=(_=(w=o.step_config)==null?void 0:w.responseStructure)==null?void 0:_.find(x=>x.name===n);return(i==null?void 0:i.type)!=="Array of Objects"?null:{name:"Loop Item",columns:i.schema||[]}}if((o==null?void 0:o.step_type)==="FETCH_RECORDS"&&n==="records"){const i=(O=o.step_config)==null?void 0:O.model;if(!i)return null;const x=T.value.find(d=>d.name===i);return x?{name:"Loop Item",columns:(x.columns||[]).map(d=>typeof d=="string"?{name:d}:d)}:null}return null}function g(r,t){const s=[...f.steps];s[r]=t,C("update:steps",s)}function h(r,t){const s={id:`temp_${Date.now()}`,step_type:t,name:`New ${t.replace("_"," ")} Step`,step_config:{}};if(t==="CONDITION"&&(s.if_true=[],s.if_false=[]),t==="FOR_EACH"&&(s.children=[]),t==="FETCH_RECORDS"){const o=f.steps.slice(0,r).slice().reverse().find(c=>c&&c.step_type==="FETCH_RECORDS"&&c.step_config&&c.step_config.model);o&&(s.step_config={model:o.step_config.model,conditions:[]})}const e=[...f.steps];e.splice(r,0,s),C("update:steps",e)}function A(r){const t=f.steps.filter((s,e)=>e!==r);C("update:steps",t)}return(r,t)=>{const s=G("Workflow",!0);return a(),m("div",V,[l.steps.length===0?(a(),m("div",q,[l.allowTrigger?(a(),m(S,{key:0},[t[2]||(t[2]=p("h3",{class:"text-lg font-semibold text-gray-700"},"Start your Automation",-1)),t[3]||(t[3]=p("p",{class:"text-sm text-gray-500 mt-1 mb-4"},"Every workflow starts with a trigger. How should this one begin?",-1)),p("button",{onClick:t[0]||(t[0]=e=>r.$emit("add-trigger")),class:"px-4 py-2 text-sm font-semibold rounded-md bg-indigo-600 text-white hover:bg-indigo-700"}," Add Trigger ")],64)):(a(),m(S,{key:1},[t[4]||(t[4]=p("h3",{class:"text-lg font-semibold text-gray-700"},"Start this flow",-1)),t[5]||(t[5]=p("p",{class:"text-sm text-gray-500 mt-1 mb-4"},"Choose a step to add in this branch.",-1)),p("div",Y,[u(E,{onSelect:t[1]||(t[1]=e=>h(0,e))})])],64))])):(a(!0),m(S,{key:1},M(l.steps,(e,n)=>(a(),m(S,{key:e.id},[p("div",z,[y(e.step_type)?(a(),W(j(y(e.step_type)),{key:0,step:e,"all-steps-before":[...l.fullContextSteps,...l.steps.slice(0,n)],"loop-context-schema":l.loopContextSchema,onDelete:!l.allowTrigger||n>0?()=>A(n):null,"onUpdate:step":o=>g(n,o)},null,40,["step","all-steps-before","loop-context-schema","onDelete","onUpdate:step"])):b("",!0),e.step_type==="CONDITION"?(a(),m("div",J,[p("div",K,[t[6]||(t[6]=p("p",{class:"text-center font-bold text-green-700 mb-4"},"IF YES",-1)),u(s,{steps:e.if_true||[],"onUpdate:steps":o=>g(n,{...e,if_true:o}),"full-context-steps":[...l.fullContextSteps,...l.steps.slice(0,n+1)],"loop-context-schema":l.loopContextSchema,"allow-trigger":!1},null,8,["steps","onUpdate:steps","full-context-steps","loop-context-schema"])]),p("div",Q,[t[7]||(t[7]=p("p",{class:"text-center font-bold text-red-700 mb-4"},"IF NO",-1)),u(s,{steps:e.if_false||[],"onUpdate:steps":o=>g(n,{...e,if_false:o}),"full-context-steps":[...l.fullContextSteps,...l.steps.slice(0,n+1)],"loop-context-schema":l.loopContextSchema,"allow-trigger":!1},null,8,["steps","onUpdate:steps","full-context-steps","loop-context-schema"])])])):b("",!0),e.step_type==="FOR_EACH"?(a(),m("div",X,[t[8]||(t[8]=p("p",{class:"text-center font-bold text-purple-700 mb-4"},"DO THIS FOR EACH ITEM",-1)),u(s,{steps:e.children||[],"onUpdate:steps":o=>g(n,{...e,children:o}),"full-context-steps":[...l.fullContextSteps,...l.steps.slice(0,n+1)],"loop-context-schema":v(e),"allow-trigger":!1},null,8,["steps","onUpdate:steps","full-context-steps","loop-context-schema"])])):b("",!0)]),u(E,{onSelect:o=>h(n+1,o)},null,8,["onSelect"])],64))),128))])}}};export{Tt as default};
