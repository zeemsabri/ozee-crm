import{c as m,r as A,e as x,f as N,a as u,i as b,o as r,b as s,v as h,x as _,d as i,m as w,u as v,j as V,F as U,l as q}from"./app-DbT8OS6U.js";import{u as D,l as j}from"./workflowStore-DZJsW282.js";import{S as f}from"./SelectDropdown-CHW2wT9H.js";import{P as T}from"./plus-Cqbd8Y22.js";import{S as $}from"./save-Dz7hmyY3.js";import{T as L}from"./trash-2-TxAo_pPz.js";/* empty css                                                                       */import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./createLucideIcon-CcTmroC8.js";const O={key:0,class:"p-4 space-y-4"},R={class:"space-y-3"},B={class:"flex items-center justify-between"},F={key:0,class:"p-1 bg-gray-200 rounded-md flex text-xs"},E={key:1,class:"space-y-2"},K={class:"flex items-center gap-2"},P={class:"flex items-center gap-2"},Y=["onUpdate:modelValue"],z={class:"text-right"},I=["onClick"],W={key:2,class:"text-center text-xs text-gray-500 py-4 border-2 border-dashed rounded-lg"},G={class:"pt-2"},ae={__name:"ConditionConfig",setup(H){const d=D(),t=m(()=>d.selectedStep),C=m(()=>d.automationSchema),g=m(()=>{var l;return((l=C.value)==null?void 0:l.models)||[]}),n=A([]),c=m({get(){var l,e;return((e=(l=t.value)==null?void 0:l.step_config)==null?void 0:e.logic)||"AND"},set(l){t.value&&((!t.value.step_config||typeof t.value.step_config!="object"||Array.isArray(t.value.step_config))&&(t.value.step_config={}),t.value.step_config.logic=l)}});x(()=>{var l;return(l=t.value)==null?void 0:l.id},l=>{l&&t.value&&Array.isArray(t.value.condition_rules)?n.value=t.value.condition_rules.map(e=>{const[o,p]=(e.field||"").split(".");return{selectedModel:o||null,selectedColumn:p||null,operator:e.operator||"equals",value:e.value||""}}):n.value=[]},{immediate:!0}),x(n,l=>{t.value&&(t.value.condition_rules=l.map(e=>({field:e.selectedModel&&e.selectedColumn?`${e.selectedModel}.${e.selectedColumn}`:"",operator:e.operator,value:e.value})))},{deep:!0});const S=()=>{n.value.push({selectedModel:null,selectedColumn:null,operator:"equals",value:""})},k=l=>{n.value.splice(l,1)},M=async()=>{t.value&&(t.value.condition_rules=t.value.condition_rules.filter(l=>l.field&&l.value!==""),await d.persistStep(t.value),j.success("Step saved successfully!"),d.selectStep(null))};return N(()=>{Object.keys(d.automationSchema).length||d.fetchAutomationSchema()}),(l,e)=>t.value?(r(),u("div",O,[s("div",null,[e[3]||(e[3]=s("label",{class:"block text-xs font-medium text-gray-700"},"Name",-1)),h(s("input",{"onUpdate:modelValue":e[0]||(e[0]=o=>t.value.name=o),type:"text",class:"mt-1 w-full border rounded px-2 py-1 text-sm",placeholder:"Condition name"},null,512),[[_,t.value.name]])]),s("div",R,[s("div",B,[e[5]||(e[5]=s("label",{class:"text-xs font-medium text-gray-700"},"If...",-1)),s("button",{onClick:S,class:"flex items-center gap-1 px-2 py-1 text-xs rounded-md bg-gray-100 hover:bg-gray-200"},[i(v(T),{class:"w-3 h-3"}),e[4]||(e[4]=w(" Add Rule ",-1))])]),n.value.length>1?(r(),u("div",F,[s("button",{onClick:e[1]||(e[1]=o=>c.value="AND"),class:V(["w-1/2 py-1 rounded-md transition-colors",c.value==="AND"?"bg-white text-gray-800 shadow":"bg-transparent text-gray-500 hover:bg-gray-300/50"])}," Match ALL (AND) ",2),s("button",{onClick:e[2]||(e[2]=o=>c.value="OR"),class:V(["w-1/2 py-1 rounded-md transition-colors",c.value==="OR"?"bg-white text-gray-800 shadow":"bg-transparent text-gray-500 hover:bg-gray-300/50"])}," Match ANY (OR) ",2)])):b("",!0),n.value.length>0?(r(),u("div",E,[(r(!0),u(U,null,q(n.value,(o,p)=>{var y;return r(),u("div",{key:p,class:"p-2 border rounded-md bg-gray-50/50 space-y-2"},[s("div",K,[i(f,{modelValue:o.selectedModel,"onUpdate:modelValue":a=>o.selectedModel=a,options:g.value,valueKey:"name",labelKey:"name",placeholder:"Select Module...",class:"w-1/2"},null,8,["modelValue","onUpdate:modelValue","options"]),i(f,{modelValue:o.selectedColumn,"onUpdate:modelValue":a=>o.selectedColumn=a,options:((y=g.value.find(a=>a.name===o.selectedModel))==null?void 0:y.columns.map(a=>({value:a,label:a})))||[],placeholder:"Select Field...",class:"w-1/2",disabled:!o.selectedModel},null,8,["modelValue","onUpdate:modelValue","options","disabled"])]),s("div",P,[i(f,{modelValue:o.operator,"onUpdate:modelValue":a=>o.operator=a,options:[{value:"equals",label:"equals"},{value:"not_equals",label:"not equals"},{value:"contains",label:"contains"}],class:"w-1/2"},null,8,["modelValue","onUpdate:modelValue"]),h(s("input",{"onUpdate:modelValue":a=>o.value=a,type:"text",class:"w-1/2 border rounded px-2 py-1 text-sm",placeholder:"Value"},null,8,Y),[[_,o.value]])]),s("div",z,[s("button",{onClick:a=>k(p),class:"text-red-500 hover:text-red-700 p-1",title:"Remove Rule"},[i(v(L),{class:"w-3 h-3"})],8,I)])])}),128))])):(r(),u("div",W,' No rules defined. This step will always follow the "YES" path. '))]),s("div",G,[s("button",{onClick:M,class:"w-full flex items-center justify-center gap-2 px-4 py-2 text-sm font-semibold text-white bg-blue-600 rounded-lg hover:bg-blue-700"},[i(v($),{class:"w-4 h-4"}),e[6]||(e[6]=w(" Save Step ",-1))])])])):b("",!0)}};export{ae as default};
