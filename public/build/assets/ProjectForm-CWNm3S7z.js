import{r as b,p as te,w as X,A as Je,h as i,o as n,e as d,b as o,g as u,t as y,F as O,i as T,m as he,B as lt,L as nt,M as rt,D as it,N as Me,s as dt,u as r,k as z,n as oe,f as L,j as Ce,v as le,c as qe,a as K,d as ut}from"./app-BIwMTLGy.js";import{P as ne}from"./PrimaryButton-DBKTw9ZT.js";import{a as ze}from"./SecondaryButton-Cd3WLAbk.js";import{_ as w,a as A}from"./TextInput-BaE0AonU.js";import{_ as I}from"./InputError-BZciBhnq.js";import{_ as ct}from"./Checkbox-IgCyHxBh.js";const mt={class:"mt-2"},vt={class:"mb-2"},pt={key:0,class:"text-gray-500 text-sm mb-2"},ft=["disabled"],_t={value:""},yt=["value"],gt={class:"flex-grow"},bt=["value","onChange","disabled"],ht=["value"],xt=["onClick"],Le={__name:"MultiSelectWithRoles",props:{label:{type:String,required:!0},items:{type:Array,default:()=>[]},endpoint:{type:String,default:""},selectedItems:{type:Array,default:()=>[]},itemText:{type:String,default:"name"},itemSubtext:{type:String,default:"email"},itemValue:{type:String,default:"id"},roleOptions:{type:Array,default:()=>[]},roleType:{type:String,default:"application"},defaultRoleId:{type:Number,default:null},error:{type:String,default:""},placeholder:{type:String,default:"Select an item"},showRemoveButton:{type:Boolean,default:!0}},emits:["update:selectedItems"],setup(k,{emit:xe}){const j=k,J=xe,h=b([]),V=b([]),re=b([]),se=b([]),g=b(!1),Q=async()=>{if(!(j.roleOptions.length>0))try{const f=(await he.get(`/api/roles?type=${j.roleType}`)).data;re.value=f.map(p=>({value:p.id,label:p.name}))}catch(c){console.error("Error fetching roles:",c)}},N=te(()=>re.value.length>0?re.value:j.roleOptions),B=()=>j.defaultRoleId?j.defaultRoleId:N.value.length>0?N.value[0].value:1,P=()=>{if(console.log("initializeFromProps called with selectedItems:",j.selectedItems),!j.selectedItems||j.selectedItems.length===0){h.value=[],V.value=[],console.log("Cleared selectedIds and selectedItemsWithRoles because props.selectedItems is empty");return}const c=new Set;j.selectedItems.forEach(f=>{const p=typeof f=="object"?f.id:f;if(!c.has(p)){if(c.add(p),!h.value.includes(p))h.value.push(p),typeof f=="object"&&f.role_id?V.value.push({id:p,role_id:f.role_id}):V.value.push({id:p,role_id:B()});else if(typeof f=="object"&&f.role_id){const R=V.value.find(G=>G.id===p);R&&(R.role_id=f.role_id)}}}),console.log("After initialization, selectedIds:",h.value),console.log("After initialization, selectedItemsWithRoles:",V.value)};X(()=>j.selectedItems,(c,f)=>{console.log("selectedItems changed:",c),JSON.stringify(c)!==JSON.stringify(f)?(console.log("selectedItems changed significantly, reinitializing"),P()):console.log("selectedItems change was not significant, skipping reinitialization")},{deep:!0,immediate:!0}),X(V,c=>{J("update:selectedItems",c)},{deep:!0});const we=c=>{c&&!h.value.includes(c)&&(h.value.push(c),V.value.push({id:c,role_id:B()}))},ke=c=>{h.value=h.value.filter(f=>f!==c),V.value=V.value.filter(f=>f.id!==c)},me=(c,f)=>{const p=V.value.find(R=>R.id===c);p&&(p.role_id=parseInt(f))},M=c=>Z.value.find(f=>f[j.itemValue]===c),W=c=>{const f=V.value.find(p=>p.id===c);return f?f.role_id:B()},S=async()=>{if(j.endpoint){g.value=!0;try{const c=await he.get(j.endpoint);c.data&&Array.isArray(c.data)?se.value=c.data:c.data&&c.data.data&&Array.isArray(c.data.data)&&(se.value=c.data.data)}catch(c){console.error("Error fetching items from endpoint:",c)}finally{g.value=!1}}},Z=te(()=>j.endpoint&&se.value.length>0?se.value:j.items);return Je(()=>{Q(),P(),j.endpoint&&S()}),(c,f)=>(n(),i("div",null,[d(w,{value:k.label},null,8,["value"]),o("div",mt,[o("div",vt,[g.value?(n(),i("div",pt,"Loading...")):u("",!0),k.showRemoveButton?(n(),i("select",{key:1,class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full",onChange:f[0]||(f[0]=p=>{const R=parseInt(p.target.value);we(R),p.target.value=""}),disabled:g.value},[o("option",_t,y(k.placeholder),1),(n(!0),i(O,null,T(Z.value.filter(p=>!h.value.includes(p[k.itemValue])),p=>(n(),i("option",{key:p[k.itemValue],value:p[k.itemValue]},y(p[k.itemText])+" ("+y(p[k.itemSubtext])+") ",9,yt))),128))],40,ft)):u("",!0)]),(n(!0),i(O,null,T(h.value,p=>{var R,G;return n(),i("div",{key:p,class:"flex items-center mb-1 p-2 border rounded"},[o("div",gt,y((R=M(p))==null?void 0:R[k.itemText])+" ("+y((G=M(p))==null?void 0:G[k.itemSubtext])+") ",1),o("select",{class:"ms-2 border-gray-300 rounded-md",value:W(p),onChange:q=>me(p,q.target.value),disabled:!k.showRemoveButton},[(n(!0),i(O,null,T(N.value,q=>(n(),i("option",{key:q.value,value:q.value},y(q.label),9,ht))),128))],40,bt),k.showRemoveButton?(n(),i("button",{key:0,type:"button",class:"ml-2 text-red-600",onClick:()=>ke(p)}," Remove ",8,xt)):u("",!0)])}),128))]),d(I,{message:k.error,class:"mt-2"},null,8,["message"])]))}},wt={class:"p-6 w-full max-w-6xl mx-auto bg-white rounded-lg shadow-xl"},kt={class:"flex justify-between items-center mb-4"},jt={class:"text-lg font-medium text-gray-900"},Vt={key:0,class:"text-red-600 text-sm mb-4"},St={key:1,class:"mb-4"},Ct={key:0,class:"text-xs text-gray-500 mt-2 p-2 bg-gray-100 rounded"},$t={class:"font-bold"},Ut={class:"mt-1"},Dt={key:0},Pt={key:1},It={key:2},Rt={key:0},Ft={class:"list-disc ml-4"},At={key:0},Ot={class:"mt-1"},Tt={class:"border-b border-gray-200 mb-6"},Et={class:"flex -mb-px"},Nt={key:0},Bt={class:"mb-4"},Mt={class:"mb-4"},qt=["disabled"],zt={class:"mb-4"},Lt={class:"mb-4"},Jt={class:"mb-4"},Wt=["disabled"],Gt=["value"],Yt={class:"mb-4"},Ht=["disabled"],Kt=["value"],Xt={key:0,class:"mt-6 flex justify-end"},Qt={key:1},Zt={key:0,class:"mb-4"},es={key:0,class:"mt-2 flex justify-end"},ts={key:1,class:"mt-2 text-green-600 text-sm"},ss={key:2,class:"mt-2 text-red-600 text-sm"},as={class:"mb-4"},os=["disabled"],ls={key:1,class:"mb-4"},ns={key:0,class:"mt-2 flex justify-end"},rs={key:1,class:"mt-2 text-green-600 text-sm"},is={key:2,class:"mt-2 text-red-600 text-sm"},ds={key:2},us={class:"mb-4"},cs={class:"mb-4"},ms=["disabled"],vs=["value"],ps={class:"mb-4"},fs={class:"mt-2"},_s={class:"flex items-center mb-2"},ys=["for"],gs={key:0,class:"pl-6"},bs={class:"grid grid-cols-2 gap-4 mb-2"},hs=["id","onUpdate:modelValue","disabled"],xs={class:"mb-2"},ws={class:"grid grid-cols-3 gap-2"},ks={class:"text-xs text-gray-500 mt-1"},js={key:0,class:"mt-6 flex justify-end"},Vs={key:3},Ss={class:"mb-4"},Cs={class:"flex justify-between items-center mb-4"},$s={class:"text-right"},Us={class:"text-lg font-medium"},Ds={class:"text-lg font-medium"},Ps={class:"text-xl font-bold mt-1"},Is={key:0,class:"mt-4"},Rs=["onUpdate:modelValue"],Fs={key:0,value:"income"},As={key:1,value:"expense"},Os=["onUpdate:modelValue"],Ts=["value"],Es=["onClick"],Ns={class:"flex mt-2"},Bs={key:0,class:"mt-6 flex justify-end"},Ms={key:4},qs={class:"mb-4"},zs={class:"mt-2"},Ls={key:0,class:"mb-4"},Js={class:"mt-4"},Ws={key:0,class:"text-sm text-red-500 mt-2"},Gs={key:1,class:"mt-4"},Ys={class:"flex-grow"},Hs=["href"],Ks=["onClick"],Xs={key:5},Qs={class:"mb-4"},Zs={class:"mt-2"},ea={class:"flex items-start mb-2"},ta=["onUpdate:modelValue","readonly"],sa={class:"mt-6 flex justify-end"},da={__name:"ProjectForm",props:{show:{type:Boolean,required:!0},project:{type:Object,default:()=>({})},statusOptions:{type:Array,required:!0},departmentOptions:{type:Array,required:!0},sourceOptions:{type:Array,required:!0},clientRoleOptions:{type:Array,default:()=>[]},userRoleOptions:{type:Array,default:()=>[]},paymentTypeOptions:{type:Array,required:!0}},emits:["close","submit"],setup(k,{emit:xe}){lt();const j=b({}),J=k;X(()=>J.project,t=>{j.value=t||{}},{immediate:!0});const h=te(()=>{var t;return((t=j.value)==null?void 0:t.id)||null}),{permissions:V,loading:re,error:se}=nt(h),g=rt(j);te(()=>!!g.value),te(()=>{if(!g.value)return!1;const t=g.value.name,a=g.value.slug;return t==="Manager"||t==="Project Manager"||a==="manager"||a==="project-manager"});const{canDo:Q,canView:N,canManage:B}=it(h),P=Q("manage_projects",g),we=Q("create_projects",g),ke=Q("create_clients",g),me=Q("upload_project_documents",g),M=B("project_expenses",g),W=B("project_income",g),S=B("project_services_and_payments",g),Z=Q("add_project_notes",g),c=B("project_users",g),f=B("project_clients",g),p=B("project_basic_details",g),R=N("project_documents",g),G=N("project_services_and_payments",g),q=N("project_notes",g),ie=N("project_users",g),de=N("project_clients",g),je=N("view_project_transactions",g),C=b("basic"),ee=t=>{if(!(t==="documents"&&!e.id)&&(C.value=t,e.id))switch(F.value=!0,t){case"basic":De(e.id).finally(()=>{F.value=!1});break;case"client":de.value||f.value||ie.value||c.value?Pe(e.id).finally(()=>{F.value=!1}):F.value=!1;break;case"services":G.value||S.value?Ie(e.id).finally(()=>{F.value=!1}):F.value=!1;break;case"transactions":M.value||W.value?Re(e.id).finally(()=>{F.value=!1}):F.value=!1;break;case"documents":R.value?Fe(e.id).finally(()=>{F.value=!1}):F.value=!1;break;case"notes":q.value||Z.value?Ae(e.id).finally(()=>{F.value=!1}):F.value=!1;break;default:F.value=!1;break}},ue=b([]),ce=b([]),ve=b([]),ae=b([]),We=async()=>{try{const a=(await he.get("/api/roles?type=client")).data;ue.value=a.map(m=>({value:m.id,label:m.name}));const s=(await he.get("/api/roles?type=project")).data;ce.value=s.map(m=>({value:m.id,label:m.name}))}catch(t){console.error("Error fetching roles:",t)}},$e=async()=>{try{if(ke.value){const t=await window.axios.get("/api/clients");ve.value=t.data.data||t.data}else if(h.value){const t=await window.axios.get(`/api/projects/${h.value}/clients`);ve.value=t.data}else{const t=await window.axios.get("/api/clients");ve.value=t.data.data||t.data}}catch(t){console.error("Error fetching clients:",t),x.value="Failed to load clients."}},Ue=async()=>{try{if(we.value){const t=await window.axios.get("/api/users");ae.value=t.data}else if(h.value){const t=await window.axios.get(`/api/projects/${h.value}/users`);ae.value=t.data}else{const t=await window.axios.get("/api/users");ae.value=t.data}}catch(t){console.error("Error fetching users:",t),x.value="Failed to load users."}},Ge=te(()=>ue.value.length>0?ue.value:J.clientRoleOptions),Ye=te(()=>ce.value.length>0?ce.value:J.userRoleOptions),De=async t=>{try{const l=(await window.axios.get(`/api/projects/${t}/sections/basic`)).data;return e.name=l.name||"",e.description=l.description||"",e.website=l.website||"",e.social_media_link=l.social_media_link||"",e.preferred_keywords=l.preferred_keywords||"",e.google_chat_id=l.google_chat_id||"",e.status=l.status||"active",e.project_type=l.project_type||"",e.source=l.source||"",e.google_drive_link=l.google_drive_link||"",l}catch(a){return console.error("Error fetching basic project data:",a),x.value="Failed to fetch basic project data.",null}},Pe=async t=>{try{const l=(await window.axios.get(`/api/projects/${t}/sections/clients-users`)).data;return l.clients&&l.clients.length>0&&(e.client_ids=l.clients.map(s=>{var _;let m=((_=s.pivot)==null?void 0:_.role_id)||(ue.value.length>0?ue.value[0].value:1);return{id:s.id,role_id:m}})),l.users&&l.users.length>0&&(e.user_ids=l.users.map(s=>{var _;let m=((_=s.pivot)==null?void 0:_.role_id)||(ce.value.length>0?ce.value[0].value:2);return{id:s.id,role_id:m}})),l.contract_details!==void 0&&(e.contract_details=l.contract_details||""),l}catch(a){return console.error("Error fetching clients and users data:",a),x.value="Failed to fetch clients and users data.",null}},Ie=async t=>{try{const l=(await window.axios.get(`/api/projects/${t}/sections/services-payment`)).data;return e.services=l.services||[],e.service_details=l.service_details||[],e.total_amount=l.total_amount||"",e.payment_type=l.payment_type||"one_off",l}catch(a){return console.error("Error fetching services and payment data:",a),x.value="Failed to fetch services and payment data.",null}},Re=async t=>{try{const l=(await window.axios.get(`/api/projects/${t}/sections/transactions`)).data;return e.transactions=l.map(s=>({description:s.description,amount:s.amount,user_id:s.user_id,hours_spent:s.hours_spent,type:s.type||"expense"})),l}catch(a){return console.error("Error fetching transactions data:",a),x.value="Failed to fetch transactions data.",null}},Fe=async t=>{try{const l=(await window.axios.get(`/api/projects/${t}/sections/documents`)).data;return e.documents=l.documents||[],l}catch(a){return console.error("Error fetching documents data:",a),x.value="Failed to fetch documents data.",null}},Ae=async t=>{try{const l=(await window.axios.get(`/api/projects/${t}/sections/notes`)).data;return e.notes=l.map(s=>({content:s.content})),l}catch(a){return console.error("Error fetching notes data:",a),x.value="Failed to fetch notes data.",null}},He=async t=>{try{switch(await De(t),C.value){case"client":(de.value||f.value||ie.value||c.value)&&await Pe(t);break;case"services":(G.value||S.value)&&await Ie(t);break;case"transactions":(M.value||W.value)&&await Re(t);break;case"documents":R.value&&await Fe(t);break;case"notes":(q.value||Z.value)&&await Ae(t);break}}catch(a){console.error("Error fetching project data:",a),x.value="Failed to fetch project data."}};Je(()=>{We(),$e(),Ue(),h.value&&Me(h.value).then(t=>{}).catch(t=>{})}),X(h,(t,a)=>{t&&t!==a&&(Me(t).then(l=>{}).catch(l=>{}),Ue(),$e())});const Ve=xe,v=b({}),x=b(""),F=b(!1),Ke=b(!1),pe=b(!1),fe=b(!1),Y=b(""),_e=b(!1),ye=b(!1),H=b(""),e=dt({id:null,name:"",description:"",website:"",social_media_link:"",preferred_keywords:"",google_chat_id:"",logo:null,documents:[],client_ids:[],status:"active",project_type:"",services:[],service_details:[],source:"",total_amount:"",contract_details:"",google_drive_link:"",payment_type:"one_off",user_ids:[],transactions:[],notes:[]});X(()=>J.show,t=>{t&&(e.client_ids||(e.client_ids=[]),e.user_ids||(e.user_ids=[]),e.id&&He(e.id))},{immediate:!0}),X(()=>J.project,t=>{const a=e.id;e.id=t.id||null,a&&!e.id&&C.value==="documents"&&ee("basic"),e.name=t.name||"",e.description=t.description||"",e.website=t.website||"",e.social_media_link=t.social_media_link||"",e.preferred_keywords=t.preferred_keywords||"",e.google_chat_id=t.google_chat_id||"",e.logo=t.logo||null,e.documents=t.documents||[],e.client_ids=[],e.status=t.status||"active",e.project_type=t.project_type||"",e.services=t.services||[],e.service_details=t.service_details||[],e.source=t.source||"",e.total_amount=t.total_amount||"",e.contract_details=t.contract_details||"",e.google_drive_link=t.google_drive_link||"",e.payment_type=t.payment_type||"one_off",e.user_ids=[],e.transactions=t.transactions?t.transactions.map(l=>({description:l.description,amount:l.amount,user_id:l.user_id,hours_spent:l.hours_spent,type:l.type||"expense"})):[],e.notes=t.notes?t.notes.map(l=>({content:l.content})):[],v.value={},x.value=""},{immediate:!0});const Xe=async()=>{v.value={},x.value="";try{const t={name:e.name,description:e.description,website:e.website,social_media_link:e.social_media_link,preferred_keywords:e.preferred_keywords,google_chat_id:e.google_chat_id,status:e.status,project_type:e.project_type,source:e.source,google_drive_link:e.google_drive_link,user_ids:e.user_ids},a=e.logo;typeof a=="object"&&a!==null&&"name"in a&&delete t.logo;const l=await window.axios.post("/api/projects",t);e.id=l.data.id,typeof a=="object"&&a!==null&&"name"in a&&await Te(a,e.id),Ve("submit",l.data)}catch(t){ge(t,"Failed to create project.")}},Qe=async()=>{v.value={},x.value="";try{const t={name:e.name,description:e.description,website:e.website,social_media_link:e.social_media_link,preferred_keywords:e.preferred_keywords,google_chat_id:e.google_chat_id,status:e.status,project_type:e.project_type,source:e.source,google_drive_link:e.google_drive_link},a=e.logo;typeof a=="object"&&a!==null&&"name"in a&&delete t.logo;const l=await window.axios.put(`/api/projects/${e.id}/sections/basic`,t);typeof a=="object"&&a!==null&&"name"in a&&await Te(a,e.id),alert("Basic information updated successfully!")}catch(t){ge(t,"Failed to update basic information.")}},Ze=async()=>{v.value={},x.value="";try{const t={services:e.services,service_details:e.service_details,total_amount:e.total_amount,payment_type:e.payment_type},a=await window.axios.put(`/api/projects/${e.id}/sections/services-payment`,t);alert("Services and payment information updated successfully!")}catch(t){ge(t,"Failed to update services and payment information.")}},et=async()=>{v.value={},x.value="";try{const t={transactions:e.transactions};M.value||(t.transactions=t.transactions.filter(l=>l.type!=="expense")),W.value||(t.transactions=t.transactions.filter(l=>l.type!=="income"));const a=await window.axios.put(`/api/projects/${e.id}/sections/transactions`,t);alert("Transactions updated successfully!")}catch(t){ge(t,"Failed to update transactions.")}},ge=(t,a)=>{t.response&&t.response.status===422?v.value=t.response.data.errors:t.response&&t.response.data.message?x.value=t.response.data.message:(x.value=a,console.error("Error:",t))},tt=(t,a)=>{a?e.service_details.some(l=>l.service_id===t)||e.service_details.push({service_id:t,amount:"",frequency:"one_off",start_date:"",payment_breakdown:{first:30,second:30,third:40}}):e.service_details=e.service_details.filter(l=>l.service_id!==t)},$=t=>{let a=e.service_details.find(l=>l.service_id===t);return a||(a={service_id:t,amount:"",frequency:"one_off",start_date:"",payment_breakdown:{first:30,second:30,third:40}},e.service_details.push(a)),a},be=b(!1),Se=b({});X(e,()=>{Object.keys(Se.value).length>0&&(be.value=!0)},{deep:!0}),X(()=>J.show,t=>{t&&setTimeout(()=>{Se.value=JSON.parse(JSON.stringify(e)),be.value=!1},100)});const Oe=()=>{be.value?confirm("You have unsaved changes. Are you sure you want to close this form?")&&Ve("close"):Ve("close")},Te=async(t,a)=>{try{const l=new FormData;l.append("logo",t);const s=await window.axios.post(`/api/projects/${a}/logo`,l,{headers:{"Content-Type":"multipart/form-data"}});return s.data&&s.data.logo&&(e.logo=s.data.logo),s}catch(l){console.error("Error uploading logo:",l)}},st=async()=>{if(!e.id){Y.value="Please save the project first before saving clients.";return}if(!e.client_ids||e.client_ids.length===0){Y.value="Please select at least one client to save.";return}pe.value=!0,fe.value=!1,Y.value="";try{const t=await window.axios.post(`/api/projects/${e.id}/attach-clients`,{client_ids:e.client_ids});fe.value=!0,setTimeout(()=>{fe.value=!1},3e3)}catch(t){t.response&&t.response.status===422?Y.value="Validation error. Please check your input.":t.response&&t.response.data.message?Y.value=t.response.data.message:(Y.value="Failed to save clients.",console.error("Error saving clients:",t))}finally{pe.value=!1}},at=async()=>{if(console.log("saveUsers called, projectForm.user_ids:",e.user_ids),!e.id){H.value="Please save the project first before saving users.";return}if(!e.user_ids||e.user_ids.length===0){console.log("No users selected, projectForm.user_ids is empty or null"),H.value="Please select at least one user to save.";return}_e.value=!0,ye.value=!1,H.value="";try{console.log("Sending user_ids to API:",JSON.stringify(e.user_ids));const t=await window.axios.post(`/api/projects/${e.id}/attach-users`,{user_ids:e.user_ids});ye.value=!0,setTimeout(()=>{ye.value=!1},3e3)}catch(t){t.response&&t.response.status===422?H.value="Validation error. Please check your input.":t.response&&t.response.data.message?H.value=t.response.data.message:(H.value="Failed to save users.",console.error("Error saving users:",t))}finally{_e.value=!1}},ot=async()=>{if(!e.id){x.value="Please save the project first before uploading documents.";return}if(!e.documents||!e.documents.some(t=>typeof t=="object"&&t!==null&&"name"in t&&"size"in t&&"type"in t)){x.value="Please select documents to upload.";return}try{const t=new FormData;e.documents.filter(m=>typeof m=="object"&&m!==null&&"name"in m&&"size"in m&&"type"in m).forEach((m,_)=>{t.append(`documents[${_}]`,m)});const l=await window.axios.post(`/api/projects/${e.id}/documents`,t,{headers:{"Content-Type":"multipart/form-data"}});e.documents=l.data.documents||[],document.getElementById("documents").value="",alert("Documents uploaded successfully!");const s=JSON.parse(JSON.stringify(e));Se.value=s,be.value=!1}catch(t){t.response&&t.response.status===422?v.value=t.response.data.errors:t.response&&t.response.data.message?x.value=t.response.data.message:(x.value="Failed to upload documents.",console.error("Error uploading documents:",t))}};return(t,a)=>{var l;return n(),i("div",wt,[o("div",kt,[o("h2",jt,y(e.id?"Edit Project":"Create New Project"),1),o("button",{onClick:Oe,class:"text-gray-400 hover:text-gray-500"},a[22]||(a[22]=[o("svg",{class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),x.value?(n(),i("div",Vt,y(x.value),1)):u("",!0),h.value?(n(),i("div",St,[Ke.value?(n(),i("div",Ct,[o("div",$t,"Project ID: "+y(h.value),1),o("div",null,y(r(g)?"Project Role: "+(((l=r(g).value)==null?void 0:l.name)||"None"):"No Project Role"),1),o("div",Ut,[a[24]||(a[24]=o("div",{class:"font-semibold"},"Project Permissions:",-1)),r(re)?(n(),i("div",Dt,"Loading project permissions...")):r(se)?(n(),i("div",Pt,"Error loading project permissions")):r(V)?(n(),i("div",It,[z(" Count: "+y(r(V).permissions?r(V).permissions.length:0)+" ",1),r(V).permissions&&r(V).permissions.length>0?(n(),i("div",Rt,[a[23]||(a[23]=o("div",{class:"font-semibold"},"Permissions:",-1)),o("ul",Ft,[(n(!0),i(O,null,T(r(V).permissions.slice(0,5),s=>(n(),i("li",{key:s.slug},y(s.name)+" ("+y(s.source)+") ",1))),128)),r(V).permissions.length>5?(n(),i("li",At," ... and "+y(r(V).permissions.length-5)+" more ",1)):u("",!0)])])):u("",!0)])):u("",!0)]),o("div",Ot,"Can manage projects: "+y(r(P)?"Yes":"No"),1)])):u("",!0)])):u("",!0),o("div",Tt,[o("nav",Et,[r(P)?(n(),i("button",{key:0,onClick:a[0]||(a[0]=s=>ee("basic")),class:oe(["py-2 px-4 text-center border-b-2 font-medium text-sm",C.value==="basic"?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"])}," Basic Information ",2)):u("",!0),r(de)||r(ie)?(n(),i("button",{key:1,onClick:a[1]||(a[1]=s=>ee("client")),class:oe(["py-2 px-4 text-center border-b-2 font-medium text-sm",C.value==="client"?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"])}," Clients and Users ",2)):u("",!0),e.id&&(r(S)||r(G))?(n(),i("button",{key:2,onClick:a[2]||(a[2]=s=>ee("services")),class:oe(["py-2 px-4 text-center border-b-2 font-medium text-sm",C.value==="services"?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"])}," Services & Payment ",2)):u("",!0),e.id&&r(je)?(n(),i("button",{key:3,onClick:a[3]||(a[3]=s=>ee("transactions")),class:oe(["py-2 px-4 text-center border-b-2 font-medium text-sm",C.value==="transactions"?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"])}," Transactions ",2)):u("",!0),e.id&&r(R)?(n(),i("button",{key:4,onClick:a[4]||(a[4]=s=>ee("documents")),class:oe(["py-2 px-4 text-center border-b-2 font-medium text-sm",C.value==="documents"?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"])}," Documents ",2)):u("",!0),e.id&&(r(Z)||r(q))?(n(),i("button",{key:5,onClick:a[5]||(a[5]=s=>ee("notes")),class:oe(["py-2 px-4 text-center border-b-2 font-medium text-sm",C.value==="notes"?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"])}," Notes ",2)):u("",!0)])]),o("form",{onSubmit:a[21]||(a[21]=ut(()=>{},["prevent"]))},[C.value==="basic"?(n(),i("div",Nt,[o("div",Bt,[d(w,{for:"name",value:"Project Name"}),d(A,{id:"name",type:"text",class:"mt-1 block w-full",modelValue:e.name,"onUpdate:modelValue":a[6]||(a[6]=s=>e.name=s),required:"",autofocus:"",disabled:!r(P)},null,8,["modelValue","disabled"]),d(I,{message:v.value.name?v.value.name[0]:"",class:"mt-2"},null,8,["message"])]),o("div",Mt,[d(w,{for:"description",value:"Description"}),L(o("textarea",{id:"description",class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full","onUpdate:modelValue":a[7]||(a[7]=s=>e.description=s),disabled:!r(P)},null,8,qt),[[Ce,e.description]]),d(I,{message:v.value.description?v.value.description[0]:"",class:"mt-2"},null,8,["message"])]),o("div",zt,[d(w,{for:"website",value:"Website"}),d(A,{id:"website",type:"url",class:"mt-1 block w-full",modelValue:e.website,"onUpdate:modelValue":a[8]||(a[8]=s=>e.website=s),disabled:!r(P)},null,8,["modelValue","disabled"]),d(I,{message:v.value.website?v.value.website[0]:"",class:"mt-2"},null,8,["message"])]),o("div",Lt,[d(w,{for:"preferred_keywords",value:"Client Preferred Keywords"}),d(A,{id:"preferred_keywords",type:"text",class:"mt-1 block w-full",modelValue:e.preferred_keywords,"onUpdate:modelValue":a[9]||(a[9]=s=>e.preferred_keywords=s),disabled:!r(P)},null,8,["modelValue","disabled"]),d(I,{message:v.value.preferred_keywords?v.value.preferred_keywords[0]:"",class:"mt-2"},null,8,["message"])]),o("div",Jt,[d(w,{for:"status",value:"Status"}),L(o("select",{id:"status",class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full","onUpdate:modelValue":a[10]||(a[10]=s=>e.status=s),required:"",disabled:!r(P)},[(n(!0),i(O,null,T(k.statusOptions,s=>(n(),i("option",{key:s.value,value:s.value},y(s.label),9,Gt))),128))],8,Wt),[[le,e.status]]),d(I,{message:v.value.status?v.value.status[0]:"",class:"mt-2"},null,8,["message"])]),o("div",Yt,[d(w,{for:"source",value:"Source"}),L(o("select",{id:"source",class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full","onUpdate:modelValue":a[11]||(a[11]=s=>e.source=s),disabled:!r(P)},[a[25]||(a[25]=o("option",{value:"",disabled:""},"Select a Source",-1)),(n(!0),i(O,null,T(k.sourceOptions,s=>(n(),i("option",{key:s.value,value:s.value},y(s.label),9,Kt))),128))],8,Ht),[[le,e.source]]),d(I,{message:v.value.source?v.value.source[0]:"",class:"mt-2"},null,8,["message"])]),r(P)?(n(),i("div",Xt,[e.id&&r(p)||!e.id?(n(),qe(ne,{key:0,onClick:a[12]||(a[12]=s=>e.id?Qe():Xe()),disabled:!r(P)},{default:K(()=>[z(y(e.id?"Update Basic Information":"Create Project"),1)]),_:1},8,["disabled"])):u("",!0)])):u("",!0)])):u("",!0),C.value==="client"?(n(),i("div",Qt,[r(de)?(n(),i("div",Zt,[d(Le,{label:"Clients",items:ve.value,selectedItems:e.client_ids,"onUpdate:selectedItems":a[13]||(a[13]=s=>e.client_ids=s),roleOptions:Ge.value,roleType:"client",error:v.value.client_ids?v.value.client_ids[0]:"",placeholder:"Select a client to add",disabled:!r(f),readonly:!r(f)&&r(de),showRemoveButton:r(f)},null,8,["items","selectedItems","roleOptions","error","disabled","readonly","showRemoveButton"]),r(f)?(n(),i("div",es,[d(ne,{onClick:st,disabled:pe.value},{default:K(()=>[z(y(pe.value?"Saving...":"Save Clients"),1)]),_:1},8,["disabled"])])):u("",!0),fe.value?(n(),i("div",ts," Clients saved successfully! ")):u("",!0),Y.value?(n(),i("div",ss,y(Y.value),1)):u("",!0)])):u("",!0),o("div",as,[d(w,{for:"contract_details",value:"Contract Details"}),L(o("textarea",{id:"contract_details",class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full","onUpdate:modelValue":a[14]||(a[14]=s=>e.contract_details=s),disabled:!r(P)},null,8,os),[[Ce,e.contract_details]]),d(I,{message:v.value.contract_details?v.value.contract_details[0]:"",class:"mt-2"},null,8,["message"])]),r(ie)?(n(),i("div",ls,[d(Le,{label:"Assign Users",items:ae.value,selectedItems:e.user_ids,"onUpdate:selectedItems":a[15]||(a[15]=s=>e.user_ids=s),roleOptions:Ye.value,roleType:"project",defaultRoleId:2,error:v.value.user_ids?v.value.user_ids[0]:"",placeholder:"Select a user to add",disabled:!r(c),readonly:!r(c)&&r(ie),showRemoveButton:r(c)},null,8,["items","selectedItems","roleOptions","error","disabled","readonly","showRemoveButton"]),r(c)?(n(),i("div",ns,[d(ne,{onClick:at,disabled:_e.value},{default:K(()=>[z(y(_e.value?"Saving...":"Save Users"),1)]),_:1},8,["disabled"])])):u("",!0),ye.value?(n(),i("div",rs," Users saved successfully! ")):u("",!0),H.value?(n(),i("div",is,y(H.value),1)):u("",!0)])):u("",!0)])):u("",!0),C.value==="services"?(n(),i("div",ds,[o("div",us,[d(w,{for:"total_amount",value:"Total Amount"}),d(A,{id:"total_amount",type:"number",step:"0.01",class:"mt-1 block w-full",modelValue:e.total_amount,"onUpdate:modelValue":a[16]||(a[16]=s=>e.total_amount=s),disabled:!r(S)},null,8,["modelValue","disabled"]),d(I,{message:v.value.total_amount?v.value.total_amount[0]:"",class:"mt-2"},null,8,["message"])]),o("div",cs,[d(w,{for:"payment_type",value:"Payment Type"}),L(o("select",{id:"payment_type",class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full","onUpdate:modelValue":a[17]||(a[17]=s=>e.payment_type=s),required:"",disabled:!r(S)},[(n(!0),i(O,null,T(k.paymentTypeOptions,s=>(n(),i("option",{key:s.value,value:s.value},y(s.label),9,vs))),128))],8,ms),[[le,e.payment_type]]),d(I,{message:v.value.payment_type?v.value.payment_type[0]:"",class:"mt-2"},null,8,["message"])]),o("div",ps,[d(w,{for:"services",value:"Services"}),o("div",fs,[(n(!0),i(O,null,T(k.departmentOptions,s=>{var m,_,U,Ee,Ne,Be;return n(),i("div",{key:s.value,class:"border p-3 mb-3 rounded"},[o("div",_s,[d(ct,{id:`service_${s.value}`,value:s.value,checked:e.services,"onUpdate:checked":[a[18]||(a[18]=D=>e.services=D),D=>tt(s.value,D)],disabled:!r(S)},null,8,["id","value","checked","onUpdate:checked","disabled"]),o("label",{for:`service_${s.value}`,class:"ms-2 text-sm font-medium text-gray-700"},y(s.label),9,ys)]),(e.services||[]).includes(s.value)?(n(),i("div",gs,[o("div",bs,[o("div",null,[d(w,{for:`service_amount_${s.value}`,value:"Amount",class:"text-xs"},null,8,["for"]),d(A,{id:`service_amount_${s.value}`,type:"number",step:"0.01",placeholder:"Amount",class:"w-full",modelValue:$(s.value).amount,"onUpdate:modelValue":D=>$(s.value).amount=D,disabled:!r(S)},null,8,["id","modelValue","onUpdate:modelValue","disabled"])]),o("div",null,[d(w,{for:`service_frequency_${s.value}`,value:"Frequency",class:"text-xs"},null,8,["for"]),L(o("select",{id:`service_frequency_${s.value}`,class:"border-gray-300 rounded-md w-full","onUpdate:modelValue":D=>$(s.value).frequency=D,disabled:!r(S)},a[26]||(a[26]=[o("option",{value:"monthly"},"Monthly",-1),o("option",{value:"one_off"},"One off",-1)]),8,hs),[[le,$(s.value).frequency]])])]),o("div",xs,[d(w,{for:`service_start_date_${s.value}`,value:"Start Date",class:"text-xs"},null,8,["for"]),d(A,{id:`service_start_date_${s.value}`,type:"date",class:"w-full",modelValue:$(s.value).start_date,"onUpdate:modelValue":D=>$(s.value).start_date=D,disabled:!r(S)},null,8,["id","modelValue","onUpdate:modelValue","disabled"])]),o("div",null,[d(w,{value:"Payment Breakdown (%)",class:"text-xs mb-1"}),o("div",ws,[o("div",null,[d(w,{for:`service_payment_first_${s.value}`,value:"First",class:"text-xs"},null,8,["for"]),d(A,{id:`service_payment_first_${s.value}`,type:"text",min:"0",max:"100",class:"w-full",value:((m=$(s.value).payment_breakdown)==null?void 0:m.first)||0,onInput:D=>{if(r(S)){const E=$(s.value);E.payment_breakdown||(E.payment_breakdown={}),E.payment_breakdown.first=D.target.value}},disabled:!r(S)},null,8,["id","value","onInput","disabled"])]),o("div",null,[d(w,{for:`service_payment_second_${s.value}`,value:"Second",class:"text-xs"},null,8,["for"]),d(A,{id:`service_payment_second_${s.value}`,type:"text",min:"0",max:"100",class:"w-full",value:((_=$(s.value).payment_breakdown)==null?void 0:_.second)||0,onInput:D=>{if(r(S)){const E=$(s.value);E.payment_breakdown||(E.payment_breakdown={}),E.payment_breakdown.second=D.target.value}},disabled:!r(S)},null,8,["id","value","onInput","disabled"])]),o("div",null,[d(w,{for:`service_payment_third_${s.value}`,value:"Third",class:"text-xs"},null,8,["for"]),d(A,{id:`service_payment_third_${s.value}`,type:"text",min:"0",max:"100",class:"w-full",value:((U=$(s.value).payment_breakdown)==null?void 0:U.third)||0,onInput:D=>{if(r(S)){const E=$(s.value);E.payment_breakdown||(E.payment_breakdown={}),E.payment_breakdown.third=D.target.value}},disabled:!r(S)},null,8,["id","value","onInput","disabled"])])]),o("div",ks," Total: "+y(parseInt(((Ee=$(s.value).payment_breakdown)==null?void 0:Ee.first)||0)+parseInt(((Ne=$(s.value).payment_breakdown)==null?void 0:Ne.second)||0)+parseInt(((Be=$(s.value).payment_breakdown)==null?void 0:Be.third)||0))+"% ",1)])])):u("",!0)])}),128))]),d(I,{message:v.value.services?v.value.services[0]:"",class:"mt-2"},null,8,["message"])]),r(S)?(n(),i("div",js,[d(ne,{onClick:Ze,disabled:!e.id||!r(S)},{default:K(()=>a[27]||(a[27]=[z(" Update Services & Payment ")])),_:1,__:[27]},8,["disabled"])])):u("",!0)])):u("",!0),C.value==="transactions"&&r(je)?(n(),i("div",Vs,[o("div",Ss,[o("div",Cs,[a[28]||(a[28]=o("h3",{class:"text-lg font-medium"},"Transactions",-1)),o("div",$s,[o("div",Us," Total Income: $"+y(e.transactions.filter(s=>s.type==="income").reduce((s,m)=>s+(parseFloat(m.amount)||0),0).toFixed(2)),1),o("div",Ds," Total Expenses: $"+y(e.transactions.filter(s=>s.type==="expense").reduce((s,m)=>s+(parseFloat(m.amount)||0),0).toFixed(2)),1),o("div",Ps," Net: $"+y((e.transactions.filter(s=>s.type==="income").reduce((s,m)=>s+(parseFloat(m.amount)||0),0)-e.transactions.filter(s=>s.type==="expense").reduce((s,m)=>s+(parseFloat(m.amount)||0),0)).toFixed(2)),1)])]),r(je)?(n(),i("div",Is,[(n(!0),i(O,null,T(e.transactions,(s,m)=>(n(),i("div",{key:m,class:"flex items-center mb-2 p-2 border rounded"},[L(o("select",{"onUpdate:modelValue":_=>s.type=_,class:"mr-2 border-gray-300 rounded-md"},[r(W)?(n(),i("option",Fs,"Income")):u("",!0),r(M)?(n(),i("option",As,"Expense")):u("",!0)],8,Rs),[[le,s.type]]),d(A,{modelValue:s.description,"onUpdate:modelValue":_=>s.description=_,placeholder:"Description",class:"mr-2 flex-grow"},null,8,["modelValue","onUpdate:modelValue"]),d(A,{modelValue:s.amount,"onUpdate:modelValue":_=>s.amount=_,modelModifiers:{number:!0},type:"number",step:"0.01",placeholder:"Amount",class:"mr-2 w-24"},null,8,["modelValue","onUpdate:modelValue"]),s.type==="expense"?L((n(),i("select",{key:0,"onUpdate:modelValue":_=>s.user_id=_,class:"mr-2 border-gray-300 rounded-md"},[a[29]||(a[29]=o("option",{value:"",disabled:""},"Select User (Optional)",-1)),(n(!0),i(O,null,T(Array.isArray(ae.value)?ae.value.filter(_=>e.user_ids.some(U=>U.id===_.id)):[],_=>(n(),i("option",{key:_.id,value:_.id},y(_.name),9,Ts))),128))],8,Os)),[[le,s.user_id]]):u("",!0),s.type==="expense"?(n(),qe(A,{key:1,modelValue:s.hours_spent,"onUpdate:modelValue":_=>s.hours_spent=_,modelModifiers:{number:!0},type:"number",step:"0.01",placeholder:"Hours",class:"mr-2 w-20"},null,8,["modelValue","onUpdate:modelValue"])):u("",!0),o("button",{type:"button",class:"text-red-600",onClick:_=>e.transactions.splice(m,1)}," Remove ",8,Es)]))),128)),o("div",Ns,[d(ze,{onClick:a[19]||(a[19]=s=>e.transactions.push({description:"",amount:"",user_id:null,hours_spent:"",type:"expense"}))},{default:K(()=>a[30]||(a[30]=[z(" Add Transaction ")])),_:1,__:[30]})])])):u("",!0),d(I,{message:v.value.transactions?v.value.transactions[0]:"",class:"mt-2"},null,8,["message"])]),r(M)||r(W)?(n(),i("div",Bs,[d(ne,{onClick:et,disabled:!e.id||!r(M)&&!r(W)},{default:K(()=>a[31]||(a[31]=[z(" Update Transactions ")])),_:1,__:[31]},8,["disabled"])])):u("",!0)])):u("",!0),C.value==="documents"?(n(),i("div",Ms,[o("div",qs,[d(w,{value:"Project Documents"}),o("div",zs,[r(me)?(n(),i("div",Ls,[d(w,{for:"documents",value:"Upload Documents"}),o("input",{type:"file",id:"documents",onChange:a[20]||(a[20]=s=>{const m=Array.from(s.target.files);if(m.length>0){const _=Array.isArray(e.documents)?e.documents.filter(U=>typeof U=="object"&&"path"in U):[];e.documents=[..._,...m],console.log("Files selected:",m),console.log("Are files File objects?",m.some(U=>typeof U=="object"&&U!==null&&"name"in U&&"size"in U&&"type"in U)),console.log("Updated documents array:",e.documents)}}),class:"mt-1 block w-full",multiple:"",accept:".pdf,.doc,.docx,.jpg,.png"},null,32),a[33]||(a[33]=o("p",{class:"text-sm text-gray-500 mt-1"},"Supported formats: PDF, DOC, DOCX, JPG, PNG",-1)),d(I,{message:v.value.documents?v.value.documents[0]:"",class:"mt-2"},null,8,["message"]),o("div",Js,[d(ne,{type:"button",onClick:ot,disabled:!e.id||!e.documents||!e.documents.some(s=>typeof s=="object"&&s!==null&&"name"in s&&"size"in s&&"type"in s)},{default:K(()=>a[32]||(a[32]=[z(" Upload Documents ")])),_:1,__:[32]},8,["disabled"]),e.id?u("",!0):(n(),i("p",Ws," Please save the project first before uploading documents. "))])])):u("",!0),e.documents&&e.documents.length>0&&typeof e.documents[0]=="object"&&"path"in e.documents[0]?(n(),i("div",Gs,[a[34]||(a[34]=o("h3",{class:"font-medium text-gray-700 mb-2"},"Existing Documents",-1)),(n(!0),i(O,null,T(e.documents,(s,m)=>(n(),i("div",{key:m,class:"flex items-center mb-2 p-2 border rounded"},[o("div",Ys,[o("a",{href:"/storage/"+s.path,target:"_blank",class:"text-blue-600 hover:underline"},y(s.filename),9,Hs)]),r(me).value?(n(),i("button",{key:0,type:"button",class:"ml-2 text-red-600",onClick:()=>{e.documents=e.documents.filter((_,U)=>U!==m)}}," Remove ",8,Ks)):u("",!0)]))),128))])):u("",!0),a[35]||(a[35]=o("div",{class:"mt-4"},[o("p",{class:"text-sm text-gray-500"}," Documents will be uploaded to the project's Google Drive folder. ")],-1))])])])):u("",!0),C.value==="notes"?(n(),i("div",Xs,[o("div",Qs,[d(w,{value:"Notes"}),o("div",Zs,[(n(!0),i(O,null,T(e.notes,(s,m)=>(n(),i("div",{key:m,class:"mb-4"},[o("div",ea,[L(o("textarea",{"onUpdate:modelValue":_=>s.content=_,readonly:!r(Z),placeholder:"Note Content",class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full h-32"},null,8,ta),[[Ce,s.content]])])]))),128))]),d(I,{message:v.value.notes?v.value.notes[0]:"",class:"mt-2"},null,8,["message"])])])):u("",!0),o("div",sa,[d(ze,{onClick:Oe},{default:K(()=>a[36]||(a[36]=[z("Close")])),_:1,__:[36]})])],32)])}}};export{da as _};
