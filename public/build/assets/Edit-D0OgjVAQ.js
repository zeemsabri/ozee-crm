import{r as j,u as N,w as R,c as C,o as r,a as v,b as e,d as $,e as l,h as i,f as b,k as S,g as x,i as n,F as _,j as w,t as d,v as P,l as E,m as k,n as q,p as B,q as M}from"./app-BxyvjcMt.js";import{_ as D}from"./AuthenticatedLayout-Bt2eLvLv.js";import{_ as U,a as y}from"./InputError-fqt0aoVm.js";import{_ as f}from"./InputLabel-w7_UPhib.js";import{P as F}from"./PrimaryButton-OnMWxl5W.js";import"./ApplicationLogo-B9dwRTmC.js";import"./SecondaryButton-Ck7xNdrL.js";import"./Checkbox-CHqDhqT3.js";const T={class:"font-semibold text-xl text-gray-800 leading-tight"},z={class:"py-12"},L={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},O={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},G={class:"p-6 bg-white border-b border-gray-200"},H={class:"mb-6"},J={class:"mb-6"},K={class:"mb-6"},Q={class:"mb-6"},W={class:"flex space-x-2"},X=["value"],Y={class:"mb-6"},Z={class:"mt-2 max-h-60 overflow-y-auto p-2 border border-gray-300 rounded-md"},I={key:0,class:"text-gray-500 text-sm"},ee={key:1,class:"space-y-2"},se={class:"flex items-center h-5"},te=["id","value"],oe={class:"ml-3 text-sm"},ie=["for"],ae={class:"text-xs text-gray-500"},re={key:0,class:"text-gray-500"},le={class:"mb-6"},ne={key:0,class:"mb-6"},de={class:"overflow-x-auto"},ce={class:"min-w-full divide-y divide-gray-200"},me={class:"bg-white divide-y divide-gray-200"},pe={class:"px-6 py-4 whitespace-nowrap"},ue={class:"text-sm font-medium text-gray-900"},ge={class:"px-6 py-4 whitespace-nowrap"},xe={class:"text-sm text-gray-500"},ye={class:"px-6 py-4 whitespace-nowrap"},fe={class:"text-sm text-gray-500"},he={class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium"},ve=["onClick"],_e={key:1,class:"mb-6"},we={class:"overflow-x-auto"},be={class:"min-w-full divide-y divide-gray-200"},ke={class:"bg-white divide-y divide-gray-200"},Ue={class:"px-6 py-4 whitespace-nowrap"},Ve={class:"text-sm font-medium text-gray-900"},je={class:"px-6 py-4 whitespace-nowrap"},Ce={class:"text-sm text-gray-500"},Ae={class:"px-6 py-4 whitespace-nowrap"},Ne={class:"text-sm text-gray-500"},Re={class:"px-6 py-4 whitespace-nowrap"},$e={class:"text-sm text-gray-500"},Se={class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium"},Pe=["onClick"],Ee={key:2,class:"text-sm text-gray-500 p-4 bg-gray-50 rounded-lg"},qe={class:"flex items-center justify-end mt-4"},Ge={__name:"Edit",props:{permission:Object,categories:Array,roles:Array,permissionRoles:Array,applicationUsers:Array,projectUsers:Array},setup(a){const m=a,p=j(""),o=N({name:m.permission.name,slug:m.permission.slug,description:m.permission.description||"",category:m.permission.category,roles:m.permissionRoles||[]});R(()=>o.category,u=>{u!=="new"&&(p.value="")});const h=j(!1),V=(u,t,s=null)=>{if(h.value)return;h.value=!0;const c={user_id:u,permission_id:m.permission.id,role_type:t};s&&(c.project_id=s),M.post(route("admin.permissions.revoke-user"),c,{preserveScroll:!0,onSuccess:()=>{h.value=!1},onError:()=>{h.value=!1}})},A=()=>{o.category==="new"&&p.value&&(o.category=p.value),o.put(route("admin.permissions.update",m.permission.id),{onSuccess:()=>{}})};return(u,t)=>(r(),C(D,null,{header:v(()=>[e("h2",T," Edit Permission: "+d(a.permission.name),1)]),default:v(()=>[e("div",z,[e("div",L,[e("div",O,[e("div",G,[e("form",{onSubmit:$(A,["prevent"])},[e("div",H,[l(f,{for:"name",value:"Name"}),l(U,{id:"name",type:"text",class:"mt-1 block w-full",modelValue:i(o).name,"onUpdate:modelValue":t[0]||(t[0]=s=>i(o).name=s),required:"",autofocus:""},null,8,["modelValue"]),l(y,{class:"mt-2",message:i(o).errors.name},null,8,["message"])]),e("div",J,[l(f,{for:"slug",value:"Slug"}),l(U,{id:"slug",type:"text",class:"mt-1 block w-full",modelValue:i(o).slug,"onUpdate:modelValue":t[1]||(t[1]=s=>i(o).slug=s),required:""},null,8,["modelValue"]),l(y,{class:"mt-2",message:i(o).errors.slug},null,8,["message"])]),e("div",K,[l(f,{for:"description",value:"Description (optional)"}),b(e("textarea",{id:"description",class:"mt-1 block w-full border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm","onUpdate:modelValue":t[2]||(t[2]=s=>i(o).description=s),rows:"3"},null,512),[[S,i(o).description]]),l(y,{class:"mt-2",message:i(o).errors.description},null,8,["message"])]),e("div",Q,[l(f,{for:"category",value:"Category"}),e("div",W,[b(e("select",{id:"category",class:"mt-1 block w-full border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm","onUpdate:modelValue":t[3]||(t[3]=s=>i(o).category=s),required:""},[t[6]||(t[6]=e("option",{value:"",disabled:""},"Select a category",-1)),(r(!0),n(_,null,w(a.categories,s=>(r(),n("option",{key:s,value:s},d(s),9,X))),128)),t[7]||(t[7]=e("option",{value:"new"},"+ Add New Category",-1))],512),[[P,i(o).category]]),i(o).category==="new"?(r(),C(U,{key:0,type:"text",class:"mt-1 block w-full",modelValue:p.value,"onUpdate:modelValue":t[4]||(t[4]=s=>p.value=s),placeholder:"Enter new category name",required:""},null,8,["modelValue"])):x("",!0)]),l(y,{class:"mt-2",message:i(o).errors.category},null,8,["message"])]),e("div",Y,[l(f,{for:"roles",value:"Assign to Roles"}),e("div",Z,[!a.roles||a.roles.length===0?(r(),n("div",I," No roles available. ")):(r(),n("div",ee,[(r(!0),n(_,null,w(a.roles,s=>(r(),n("div",{key:s.id,class:"flex items-start"},[e("div",se,[b(e("input",{id:`role-${s.id}`,type:"checkbox",value:s.id,"onUpdate:modelValue":t[5]||(t[5]=c=>i(o).roles=c),class:"h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500"},null,8,te),[[E,i(o).roles]])]),e("div",oe,[e("label",{for:`role-${s.id}`,class:"font-medium text-gray-700"},[k(d(s.name)+" ",1),e("span",ae,"("+d(s.type)+")",1)],8,ie),s.description?(r(),n("p",re,d(s.description),1)):x("",!0)])]))),128))]))]),t[8]||(t[8]=e("p",{class:"mt-1 text-sm text-gray-500"}," Select roles to assign this permission to them. ",-1)),l(y,{class:"mt-2",message:i(o).errors.roles},null,8,["message"])]),e("div",le,[t[13]||(t[13]=e("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"Users with this Permission",-1)),a.applicationUsers&&a.applicationUsers.length>0?(r(),n("div",ne,[t[10]||(t[10]=e("h4",{class:"font-medium text-gray-700 mb-2"},"Application Users",-1)),e("div",de,[e("table",ce,[t[9]||(t[9]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Name "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Email "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Role "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Actions ")])],-1)),e("tbody",me,[(r(!0),n(_,null,w(a.applicationUsers,s=>{var c;return r(),n("tr",{key:s.id},[e("td",pe,[e("div",ue,d(s.name),1)]),e("td",ge,[e("div",xe,d(s.email),1)]),e("td",ye,[e("div",fe,d(((c=a.roles.find(g=>g.id===s.role_id))==null?void 0:c.name)||"Unknown Role"),1)]),e("td",he,[e("button",{onClick:g=>V(s.id,"application"),class:"text-red-600 hover:text-red-900"}," Revoke ",8,ve)])])}),128))])])])])):x("",!0),a.projectUsers&&a.projectUsers.length>0?(r(),n("div",_e,[t[12]||(t[12]=e("h4",{class:"font-medium text-gray-700 mb-2"},"Project Users",-1)),e("div",we,[e("table",be,[t[11]||(t[11]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Name "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Email "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Project "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Role "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Actions ")])],-1)),e("tbody",ke,[(r(!0),n(_,null,w(a.projectUsers,s=>{var c;return r(),n("tr",{key:`${s.id}-${s.project_id}`},[e("td",Ue,[e("div",Ve,d(s.name),1)]),e("td",je,[e("div",Ce,d(s.email),1)]),e("td",Ae,[e("div",Ne,d(s.project_name),1)]),e("td",Re,[e("div",$e,d(((c=a.roles.find(g=>g.id===s.role_id))==null?void 0:c.name)||"Unknown Role"),1)]),e("td",Se,[e("button",{onClick:g=>V(s.id,"project",s.project_id),class:"text-red-600 hover:text-red-900"}," Revoke ",8,Pe)])])}),128))])])])])):x("",!0),(!a.applicationUsers||a.applicationUsers.length===0)&&(!a.projectUsers||a.projectUsers.length===0)?(r(),n("div",Ee," No users have been assigned this permission. ")):x("",!0)]),e("div",qe,[l(i(q),{href:u.route("admin.permissions.index"),class:"inline-flex items-center px-4 py-2 bg-gray-300 border border-transparent rounded-md font-semibold text-xs text-gray-800 uppercase tracking-widest hover:bg-gray-400 active:bg-gray-500 focus:outline-none focus:border-gray-500 focus:ring focus:ring-gray-300 disabled:opacity-25 transition mr-2"},{default:v(()=>t[14]||(t[14]=[k(" Cancel ",-1)])),_:1,__:[14]},8,["href"]),l(F,{class:B(["ml-4",{"opacity-25":i(o).processing}]),disabled:i(o).processing},{default:v(()=>t[15]||(t[15]=[k(" Update Permission ",-1)])),_:1,__:[15]},8,["class","disabled"])])],32)])])])])]),_:1}))}};export{Ge as default};
