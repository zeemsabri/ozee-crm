import{u as O}from"./workflowStore-DMkwNXfJ.js";import{c as x,r as P,a,i as n,o as r,b as t,t as o,F as S,l as E,j as T,m as l}from"./app-DPPlWUgE.js";const I={key:0,class:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center"},j={class:"bg-white rounded-lg shadow-xl w-full max-w-5xl max-h-[85vh] flex flex-col"},F={class:"flex items-center justify-between px-4 py-3 border-b"},M={key:0,class:"text-xs text-gray-500"},V={class:"p-4 overflow-auto flex-1"},$={key:0,class:"text-sm text-gray-500"},B={key:1},W={key:0,class:"text-sm text-gray-500"},z={key:1,class:"min-w-full divide-y divide-gray-200 text-sm"},A={class:"divide-y divide-gray-200"},H={class:"px-3 py-2 align-top"},J={class:"px-3 py-2 align-top"},R={class:"font-medium text-gray-900 flex items-center gap-2"},U={key:0,class:"text-[10px] uppercase tracking-wide px-1.5 py-0.5 rounded bg-gray-100 text-gray-700"},q={class:"text-xs text-gray-500 flex gap-2 flex-wrap"},G={key:0},K={key:1},Q={class:"px-3 py-2 align-top"},X={class:"text-xs text-gray-500 mt-0.5 flex gap-3"},Y={key:0},Z={key:1},tt={key:2},et={class:"px-3 py-2 max-w-[320px] align-top"},st=["title"],ot={class:"px-3 py-2 align-top"},at=["onClick"],rt={key:0,class:"bg-gray-50/50"},dt={colspan:"5",class:"px-3 py-3"},nt={class:"grid grid-cols-1 md:grid-cols-3 gap-3 mb-3 text-xs text-gray-600"},it={class:"text-gray-800"},lt={class:"text-gray-800 uppercase"},ut={class:"text-gray-800"},pt={class:"text-gray-800"},xt={class:"text-gray-800"},ct={key:0},_t={class:"text-gray-800"},yt={key:0},gt={class:"text-gray-800"},mt={key:1},vt={class:"text-gray-800"},ft={key:2},bt={class:"text-gray-800"},ht={class:"grid grid-cols-1 md:grid-cols-3 gap-3"},wt={class:"bg-white border rounded p-2 max-h-48 overflow-auto text-xs whitespace-pre-wrap"},kt={class:"bg-white border rounded p-2 max-h-48 overflow-auto text-xs whitespace-pre-wrap"},St={class:"bg-white border rounded p-2 max-h-48 overflow-auto text-xs whitespace-pre-wrap"},Nt={key:0,class:"mt-3 text-xs"},Ct={class:"bg-white border border-red-200 rounded p-2 max-h-48 overflow-auto text-xs whitespace-pre-wrap text-red-800"},Lt={class:"px-4 py-3 border-t flex items-center justify-between text-sm"},Dt={key:0},Ot={class:"space-x-2"},Pt=["disabled"],Et=["disabled"],Mt={__name:"WorkflowLogsModal",setup(Tt){const p=O(),u=x(()=>p.logsModal),N=()=>p.hideLogs(),i=x(()=>u.value.meta||null),y=x(()=>i.value&&i.value.current_page>1),g=x(()=>i.value&&i.value.current_page<i.value.last_page),C=()=>{y.value&&p.goToLogsPage(i.value.current_page-1)},L=()=>{g.value&&p.goToLogsPage(i.value.current_page+1)},m=d=>{try{return d?new Date(d).toLocaleString():""}catch{return d||""}},c=P(new Set),D=d=>{const s=new Set(c.value);s.has(d)?s.delete(d):s.add(d),c.value=s},v=d=>c.value.has(d),_=d=>{try{return d==null||d===""?"":typeof d=="string"?d:JSON.stringify(d,null,2)}catch{return String(d)}};return(d,s)=>u.value.show?(r(),a("div",I,[t("div",j,[t("div",F,[t("div",null,[s[0]||(s[0]=t("h3",{class:"text-lg font-semibold text-gray-800"},"Execution Logs",-1)),u.value.workflow?(r(),a("p",M,"Workflow: "+o(u.value.workflow.name),1)):n("",!0)]),t("button",{onClick:N,class:"text-gray-500 hover:text-gray-700"},"âœ•")]),t("div",V,[u.value.isLoading?(r(),a("div",$,"Loading logs...")):(r(),a("div",B,[u.value.items.length?(r(),a("table",z,[s[17]||(s[17]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-3 py-2 text-left font-medium text-gray-700 w-24"},"Time"),t("th",{class:"px-3 py-2 text-left font-medium text-gray-700"},"Step"),t("th",{class:"px-3 py-2 text-left font-medium text-gray-700"},"Status"),t("th",{class:"px-3 py-2 text-left font-medium text-gray-700"},"Error"),t("th",{class:"px-3 py-2 text-left font-medium text-gray-700 w-20"},"Details")])],-1)),t("tbody",A,[(r(!0),a(S,null,E(u.value.items,e=>{var f,b,h,w,k;return r(),a(S,{key:e.id},[t("tr",null,[t("td",H,o(m(e.executed_at)),1),t("td",J,[t("div",R,[t("span",null,o(((f=e.step)==null?void 0:f.name)||`Step #${e.step_id}`),1),(b=e.step)!=null&&b.step_type?(r(),a("span",U,o(e.step.step_type),1)):n("",!0)]),t("div",q,[t("span",null,"ID: "+o(e.id),1),e.step_id?(r(),a("span",G,"Step ID: "+o(e.step_id),1)):n("",!0),e.triggering_object_id?(r(),a("span",K,"Object: "+o(e.triggering_object_id),1)):n("",!0)])]),t("td",Q,[t("span",{class:T(["px-2 py-0.5 rounded-full text-xs",e.status==="success"?"bg-green-100 text-green-800":e.status==="failed"?"bg-red-100 text-red-800":e.status==="scheduled"?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"])},o(e.status),3),t("div",X,[e.duration_ms?(r(),a("span",Y,o(e.duration_ms)+" ms",1)):n("",!0),e.token_usage?(r(),a("span",Z,"tokens: "+o(e.token_usage),1)):n("",!0),e.cost?(r(),a("span",tt,"cost: $"+o(Number(e.cost).toFixed(4)),1)):n("",!0)])]),t("td",et,[t("div",{class:"truncate text-red-700",title:e.error_message||""},o(e.error_message),9,st)]),t("td",ot,[t("button",{onClick:It=>D(e.id),class:"px-2 py-1 rounded border hover:bg-gray-50"},o(v(e.id)?"Hide":"View"),9,at)])]),v(e.id)?(r(),a("tr",rt,[t("td",dt,[t("div",nt,[t("div",null,[s[4]||(s[4]=t("div",{class:"font-semibold text-gray-700 mb-1"},"Step Info",-1)),t("div",null,[s[1]||(s[1]=l("Name: ",-1)),t("span",it,o(((h=e.step)==null?void 0:h.name)||"-"),1)]),t("div",null,[s[2]||(s[2]=l("Type: ",-1)),t("span",lt,o(((w=e.step)==null?void 0:w.step_type)||"-"),1)]),t("div",null,[s[3]||(s[3]=l("Order: ",-1)),t("span",ut,o(((k=e.step)==null?void 0:k.step_order)??"-"),1)])]),t("div",null,[s[8]||(s[8]=t("div",{class:"font-semibold text-gray-700 mb-1"},"Execution",-1)),t("div",null,[s[5]||(s[5]=l("Status: ",-1)),t("span",pt,o(e.status),1)]),t("div",null,[s[6]||(s[6]=l("Executed At: ",-1)),t("span",xt,o(m(e.executed_at)),1)]),e.duration_ms?(r(),a("div",ct,[s[7]||(s[7]=l("Duration: ",-1)),t("span",_t,o(e.duration_ms)+" ms",1)])):n("",!0)]),t("div",null,[s[12]||(s[12]=t("div",{class:"font-semibold text-gray-700 mb-1"},"Metrics",-1)),e.token_usage?(r(),a("div",yt,[s[9]||(s[9]=l("Token Usage: ",-1)),t("span",gt,o(e.token_usage),1)])):n("",!0),e.cost?(r(),a("div",mt,[s[10]||(s[10]=l("Cost: ",-1)),t("span",vt,"$"+o(Number(e.cost).toFixed(6)),1)])):n("",!0),e.triggering_object_id?(r(),a("div",ft,[s[11]||(s[11]=l("Object ID: ",-1)),t("span",bt,o(e.triggering_object_id),1)])):n("",!0)])]),t("div",ht,[t("div",null,[s[13]||(s[13]=t("div",{class:"text-xs font-semibold text-gray-700 mb-1"},"Input Context",-1)),t("pre",wt,o(_(e.input_context)),1)]),t("div",null,[s[14]||(s[14]=t("div",{class:"text-xs font-semibold text-gray-700 mb-1"},"Raw Output",-1)),t("pre",kt,o(_(e.raw_output)),1)]),t("div",null,[s[15]||(s[15]=t("div",{class:"text-xs font-semibold text-gray-700 mb-1"},"Parsed Output",-1)),t("pre",St,o(_(e.parsed_output)),1)])]),e.error_message?(r(),a("div",Nt,[s[16]||(s[16]=t("div",{class:"font-semibold text-red-700 mb-1"},"Error Message",-1)),t("pre",Ct,o(e.error_message),1)])):n("",!0)])])):n("",!0)],64)}),128))])])):(r(),a("div",W,"No logs found."))]))]),t("div",Lt,[t("div",null,[i.value?(r(),a("span",Dt,"Page "+o(i.value.current_page)+" of "+o(i.value.last_page),1)):n("",!0)]),t("div",Ot,[t("button",{onClick:C,disabled:!y.value,class:"px-3 py-1 rounded border disabled:opacity-50"},"Prev",8,Pt),t("button",{onClick:L,disabled:!g.value,class:"px-3 py-1 rounded border disabled:opacity-50"},"Next",8,Et)])])])])):n("",!0)}};export{Mt as default};
