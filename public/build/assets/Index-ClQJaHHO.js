import{_ as Q}from"./AuthenticatedLayout-DQ2rrSKX.js";import{r as c,c as X,e as R,n as q,a as u,o as r,b as t,i as N,y as I,s as P,k as Z,F as L,l as O,j as ee,t as V,q as te,g as A,w as E,d as i,u as m,v as se,x as oe,D as le,f as ae,h as ne,m as B,N as ie,J as re}from"./app-D5B69b4J.js";import{_ as z}from"./PrimaryButton-C-MexO47.js";import{D as H}from"./DangerButton-Bpqdlx9-.js";import{_ as K}from"./SecondaryButton-DAJ6dG_n.js";import{_ as de}from"./Modal-jF22Pxn9.js";import{B as ue}from"./BaseFormModal-DOLJF0-I.js";import{_ as M}from"./InputLabel-Dfj67Ys3.js";import{_ as J}from"./TextInput-Bn4eL-Jq.js";import{_ as D}from"./InputError-CDMWm3Ur.js";import{_ as W}from"./Checkbox-CpWon2zN.js";import"./index-Cff_vMTn.js";import"./SelectDropdown-CtafRPQ5.js";/* empty css                                                                       */import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./debounce-C-hnF4Z3.js";import"./ApplicationLogo-Div4aj7J.js";import"./createLucideIcon-DCxCwdB4.js";import"./plus-HLNAaRrX.js";import"./moment-BLMuvzoS.js";import"./NoticeboardModal-DwasP8TL.js";const me={class:"relative w-full"},ce=["id","value","onKeydown","rows","required"],pe={class:"max-h-60 overflow-y-auto"},fe=["onMousedown"],ge={class:"font-medium text-gray-900"},xe={class:"text-xs text-gray-500"},ve={key:0,class:"px-4 py-2 text-gray-500 text-sm"},Y={__name:"CustomRichTextEditor",props:{id:String,modelValue:String,definitions:{type:Array,default:()=>[]},rows:{type:Number,default:8},required:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(p,{emit:j}){const d=p,T=j,a=c(null),f=c(!1),v=c(""),h=c(-1),_=c({top:"auto",left:"auto"}),y=X(()=>{if(!v.value)return d.definitions;const s=v.value.toLowerCase();return d.definitions.filter(e=>e.name.toLowerCase().includes(s))});R(()=>d.modelValue,()=>{f.value&&q(()=>C())});const b=s=>{T("update:modelValue",s.target.value);const e=s.target.selectionStart,n=s.target.value.substring(0,e),l=n.lastIndexOf("{{");if(l!==-1&&e-l>1){const w=n.substring(l+2);if(!w.includes("}")){v.value=w.trim(),f.value=!0,h.value=0,q(()=>C());return}}k()},g=()=>{if(f.value&&h.value!==-1)$(y.value[h.value].name);else{const s=a.value,e=s.selectionStart,n=s.selectionEnd,l=s.value.substring(0,e)+`
`+s.value.substring(n);T("update:modelValue",l),q(()=>{const w=e+1;s.setSelectionRange(w,w)})}},o=s=>{f.value&&S(s)},x=()=>{f.value&&k()},k=()=>{f.value=!1,v.value="",h.value=-1},$=s=>{const e=a.value,n=e.selectionStart,w=e.value.substring(0,n).lastIndexOf("{{"),U=e.value.substring(0,w)+`{{ ${s} }}`+e.value.substring(n);T("update:modelValue",U),q(()=>{const F=w+`{{ ${s} }}`.length;e.setSelectionRange(F,F),e.focus()}),k()},S=s=>{if(!y.value.length)return;let e=h.value+s;e<0?e=y.value.length-1:e>=y.value.length&&(e=0),h.value=e},C=()=>{const s=a.value,e=s.selectionStart,l=s.value.substring(0,e).split(`
`),w=l.length-1,U=l[w].length,F=parseFloat(window.getComputedStyle(s).lineHeight),G=parseFloat(window.getComputedStyle(s).fontSize)*.6;_.value.top=`${s.offsetTop+(w+1)*F}px`,_.value.left=`${s.offsetLeft+U*G}px`};return(s,e)=>(r(),u("div",me,[t("textarea",{id:p.id,ref_key:"textareaRef",ref:a,value:p.modelValue,onInput:b,onKeydown:[I(P(g,["prevent"]),["enter"]),e[0]||(e[0]=I(P(n=>o(-1),["prevent"]),["up"])),e[1]||(e[1]=I(P(n=>o(1),["prevent"]),["down"])),I(P(x,["prevent"]),["escape"])],onBlur:k,class:"block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",rows:p.rows,required:p.required},null,40,ce),f.value?(r(),u("div",{key:0,class:"absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg",style:Z({top:_.value.top,left:_.value.left})},[t("ul",pe,[(r(!0),u(L,null,O(y.value,(n,l)=>(r(),u("li",{key:n.name,onMousedown:P(w=>$(n.name),["prevent"]),class:ee(["cursor-pointer px-4 py-2 hover:bg-indigo-50",{"bg-indigo-100":h.value===l}])},[t("span",ge,V(n.name),1),t("p",xe,V(n.description),1)],42,fe))),128)),y.value.length?N("",!0):(r(),u("li",ve," No placeholders found. "))])],4)):N("",!0)]))}},ye={class:"flex"},he={class:"flex-1 pr-6"},we={class:"mb-4"},_e={class:"mb-4"},be={class:"mb-4"},ke={class:"mb-4"},$e={class:"mb-4"},Ce={class:"mb-4 space-y-2"},Ee={class:"flex items-center"},Te={class:"flex items-center"},Se={class:"w-64 border-l border-gray-200 pl-6 space-y-4"},Ve={class:"flex items-center justify-between"},De={key:0,class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},je={key:1,class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},Be={key:0,class:"space-y-2"},Pe={class:"max-h-96 overflow-y-auto pr-2"},Me=["onClick"],Ne={class:"font-medium text-gray-900"},Fe={class:"text-xs text-gray-500"},qe={__name:"CreateEditTemplateModal",props:{show:{type:Boolean,default:!1},isEditing:{type:Boolean,default:!1},template:{type:Object,default:null},placeholderDefinitions:{type:Array,required:!0,default:()=>[]}},emits:["close","submitted"],setup(p,{emit:j}){const d=p,T=j,a=te({name:"",slug:"",subject:"",body_html:"",description:"",is_default:!1,is_private:!1});c(null),c(null);const f=c(null),v=c(!0),h=()=>{T("close")},_=()=>{a.reset(),T("submitted")};R(()=>d.show,g=>{g&&d.isEditing&&d.template?(a.name=d.template.name,a.slug=d.template.slug,a.subject=d.template.subject,a.body_html=d.template.body_html,a.description=d.template.description,a.is_default=d.template.is_default,a.is_private=d.template.is_private??!1):g&&!d.isEditing&&a.reset()}),R(()=>d.isEditing,g=>{g||a.reset()});const y=g=>{if(!f.value){console.error("No active editor selected to insert placeholder.");return}const o=f.value.$el,x=o.selectionStart,k=o.selectionEnd,$=o.value,S=$.substring(0,x)+g+$.substring(k);f.value.id==="subject"?a.subject=S:f.value.id==="body_html"&&(a.body_html=S),nextTick(()=>{const C=x+g.length;o.setSelectionRange(C,C),o.focus()})},b=g=>{f.value=g};return(g,o)=>(r(),A(ue,{show:p.show,title:p.isEditing?"Edit Email Template":"Create New Email Template","api-endpoint":p.isEditing?`/api/email-templates/${p.template.id}`:"/api/email-templates","http-method":p.isEditing?"put":"post","form-data":m(a).data(),"submit-button-text":p.isEditing?"Update Template":"Save Template","success-message":"Email template saved successfully!",onClose:h,onSubmitted:_},{default:E(({errors:x})=>{var k,$,S,C,s,e,n;return[t("div",ye,[t("div",he,[t("div",we,[i(M,{for:"name",value:"Template Name"}),i(J,{id:"name",modelValue:m(a).name,"onUpdate:modelValue":o[0]||(o[0]=l=>m(a).name=l),type:"text",class:"mt-1 block w-full",required:"",autofocus:""},null,8,["modelValue"]),i(D,{class:"mt-2",message:(k=x.name)==null?void 0:k[0]},null,8,["message"])]),t("div",_e,[i(M,{for:"slug",value:"Template Slug"}),i(J,{id:"slug",modelValue:m(a).slug,"onUpdate:modelValue":o[1]||(o[1]=l=>m(a).slug=l),type:"text",class:"mt-1 block w-full",required:""},null,8,["modelValue"]),i(D,{class:"mt-2",message:($=x.slug)==null?void 0:$[0]},null,8,["message"])]),t("div",be,[i(M,{for:"subject",value:"Subject Line"}),i(Y,{id:"subject",modelValue:m(a).subject,"onUpdate:modelValue":o[2]||(o[2]=l=>m(a).subject=l),definitions:p.placeholderDefinitions,rows:2,required:"",onFocus:o[3]||(o[3]=l=>b(l))},null,8,["modelValue","definitions"]),i(D,{class:"mt-2",message:(S=x.subject)==null?void 0:S[0]},null,8,["message"])]),t("div",ke,[i(M,{for:"body_html",value:"Email Body (HTML)"}),i(Y,{id:"body_html",modelValue:m(a).body_html,"onUpdate:modelValue":o[4]||(o[4]=l=>m(a).body_html=l),definitions:p.placeholderDefinitions,rows:10,required:"",onFocus:o[5]||(o[5]=l=>b(l))},null,8,["modelValue","definitions"]),i(D,{class:"mt-2",message:(C=x.body_html)==null?void 0:C[0]},null,8,["message"])]),t("div",$e,[i(M,{for:"description",value:"Description"}),se(t("textarea",{id:"description","onUpdate:modelValue":o[6]||(o[6]=l=>m(a).description=l),class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-lg shadow-sm mt-1 block w-full"},null,512),[[oe,m(a).description]]),i(D,{class:"mt-2",message:(s=x.description)==null?void 0:s[0]},null,8,["message"])]),t("div",Ce,[t("label",Ee,[i(W,{name:"is_default",checked:m(a).is_default,"onUpdate:checked":o[7]||(o[7]=l=>m(a).is_default=l)},null,8,["checked"]),o[10]||(o[10]=t("span",{class:"ml-2 text-sm text-gray-600"},"Is a system default template?",-1))]),i(D,{class:"mt-2",message:(e=x.is_default)==null?void 0:e[0]},null,8,["message"]),t("label",Te,[i(W,{name:"is_private",checked:m(a).is_private,"onUpdate:checked":o[8]||(o[8]=l=>m(a).is_private=l)},null,8,["checked"]),o[11]||(o[11]=t("span",{class:"ml-2 text-sm text-gray-600"},"Private (visible only to users with permission)",-1))]),i(D,{class:"mt-2",message:(n=x.is_private)==null?void 0:n[0]},null,8,["message"])])]),t("div",Se,[t("div",Ve,[o[14]||(o[14]=t("h4",{class:"text-sm font-semibold text-gray-900"},"Placeholders",-1)),t("button",{onClick:o[9]||(o[9]=l=>v.value=!v.value),type:"button",class:"text-gray-400 hover:text-gray-600 focus:outline-none"},[v.value?(r(),u("svg",De,o[12]||(o[12]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"},null,-1)]))):(r(),u("svg",je,o[13]||(o[13]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"},null,-1)])))])]),v.value?(r(),u("div",Be,[o[15]||(o[15]=t("p",{class:"text-xs text-gray-500"},"Click to insert into the active editor.",-1)),t("div",Pe,[(r(!0),u(L,null,O(p.placeholderDefinitions,l=>(r(),u("button",{key:l.id,onClick:P(w=>y(`{{ ${l.name} }}`),["prevent"]),type:"button",class:"w-full text-left p-2 border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-colors duration-150 text-sm mb-2"},[t("span",Ne,V(l.name),1),t("p",Fe,V(l.description),1)],8,Me))),128))])])):N("",!0)])])]}),_:1},8,["show","title","api-endpoint","http-method","form-data","submit-button-text"]))}},Ie={class:"py-12"},Le={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},Ue={class:"bg-white overflow-hidden shadow-xl sm:rounded-lg p-6"},Re={class:"flex justify-between items-center mb-6"},Ae={key:0,class:"text-center text-gray-500 py-8"},Oe={key:1,class:"text-center text-red-500 py-8"},ze={key:2,class:"overflow-x-auto rounded-lg border border-gray-200 shadow-sm mt-6"},He={class:"min-w-full divide-y divide-gray-200"},Ke={class:"bg-white divide-y divide-gray-200"},Je={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},We={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Ye={class:"px-6 py-4 text-sm text-gray-500"},Ge={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Qe={key:0,class:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800"},Xe={key:1,class:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800"},Ze={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},et={key:0,class:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-purple-100 text-purple-800"},tt={key:1,class:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800"},st={class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium"},ot={class:"flex justify-end space-x-2"},lt={key:3,class:"text-center text-gray-500 py-8"},at={class:"p-6"},nt={class:"mt-6 flex justify-end"},St={__name:"Index",setup(p){const{canDo:j}=le(),d=c([]),T=c([]),a=c(!0),f=c(!0),v=c(""),h=c(!1),_=c(!1),y=c(!1),b=c(null),g=async()=>{a.value=!0,v.value="";try{const s=await window.axios.get("/api/email-templates");d.value=s.data}catch(s){v.value="Failed to load email templates.",console.error("Error fetching templates:",s)}finally{a.value=!1}},o=async()=>{f.value=!0;try{const s=await window.axios.get("/api/placeholder-definitions");T.value=s.data}catch(s){console.error("Error fetching placeholder definitions:",s)}finally{f.value=!1}},x=()=>{h.value=!1,b.value=null,_.value=!0},k=s=>{h.value=!0,b.value=s,_.value=!0},$=s=>{b.value=s,y.value=!0},S=()=>{_.value=!1,g()},C=async()=>{var s,e;try{await window.axios.delete(`/api/email-templates/${b.value.id}`),ie("Template deleted successfully!"),y.value=!1,await g()}catch(n){console.error("Error deleting template:",n);const l=((e=(s=n.response)==null?void 0:s.data)==null?void 0:e.message)||"Failed to delete template.";re(l)}};return ae(()=>{g(),o()}),(s,e)=>(r(),u(L,null,[i(m(ne),{title:"Email Templates"}),i(Q,null,{header:E(()=>e[3]||(e[3]=[t("h2",{class:"font-bold text-3xl text-gray-800 leading-tight"},"Email Templates",-1)])),default:E(()=>[t("div",Ie,[t("div",Le,[t("div",Ue,[t("div",Re,[e[5]||(e[5]=t("h3",{class:"text-2xl font-semibold text-gray-900"},"Manage Email Templates",-1)),m(j)("manage_email_templates")?(r(),A(z,{key:0,onClick:x},{default:E(()=>e[4]||(e[4]=[B(" Create New Template ",-1)])),_:1,__:[4]})):N("",!0)]),a.value?(r(),u("div",Ae," Loading templates... ")):v.value?(r(),u("div",Oe,V(v.value),1)):d.value&&d.value.length?(r(),u("div",ze,[t("table",He,[e[8]||(e[8]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Name "),t("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Slug "),t("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Subject "),t("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Is Default "),t("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Private "),t("th",{scope:"col",class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"}," Actions ")])],-1)),t("tbody",Ke,[(r(!0),u(L,null,O(d.value,n=>(r(),u("tr",{key:n.id},[t("td",Je,V(n.name),1),t("td",We,V(n.slug),1),t("td",Ye,V(n.subject),1),t("td",Ge,[n.is_default?(r(),u("span",Qe," Yes ")):(r(),u("span",Xe," No "))]),t("td",Ze,[n.is_private?(r(),u("span",et," Private ")):(r(),u("span",tt," Public "))]),t("td",st,[t("div",ot,[i(K,{onClick:l=>k(n)},{default:E(()=>e[6]||(e[6]=[B("Edit",-1)])),_:2,__:[6]},1032,["onClick"]),i(H,{onClick:l=>$(n)},{default:E(()=>e[7]||(e[7]=[B("Delete",-1)])),_:2,__:[7]},1032,["onClick"])])])]))),128))])])])):(r(),u("div",lt,[e[10]||(e[10]=t("p",null,"No email templates found.",-1)),m(j)("manage_email_templates")?(r(),A(z,{key:0,onClick:x,class:"mt-4"},{default:E(()=>e[9]||(e[9]=[B(" Create First Template ",-1)])),_:1,__:[9]})):N("",!0)]))])])]),i(qe,{show:_.value,"is-editing":h.value,template:b.value,"placeholder-definitions":T.value,onClose:e[0]||(e[0]=n=>_.value=!1),onSubmitted:S},null,8,["show","is-editing","template","placeholder-definitions"]),i(de,{show:y.value,onClose:e[2]||(e[2]=()=>y.value=!1)},{default:E(()=>{var n;return[t("div",at,[e[13]||(e[13]=t("h3",{class:"text-xl font-semibold text-gray-900 mb-4"},"Delete Email Template",-1)),t("p",null,'Are you sure you want to delete the template "'+V((n=b.value)==null?void 0:n.name)+'"? This action cannot be undone.',1),t("div",nt,[i(K,{onClick:e[1]||(e[1]=()=>y.value=!1)},{default:E(()=>e[11]||(e[11]=[B("Cancel",-1)])),_:1,__:[11]}),i(H,{class:"ml-3",onClick:C},{default:E(()=>e[12]||(e[12]=[B(" Delete ",-1)])),_:1,__:[12]})])])]}),_:1},8,["show"])]),_:1})],64))}};export{St as default};
