import{s as w,aJ as O,D as F,$,aK as Ie,aD as Z,p as ce,l as h,e as p,b as pe,d as me,F as Ne,r as B,ab as z,aL as ye,aM as Te,aN as G,aO as Oe}from"./app-DdN7Mxvn.js";const A="/api",ke=async(e={})=>{const{data:t}=await w.get(`${A}/workflows`,{params:e});return t},Le=async e=>{const{data:t}=await w.get(`${A}/workflows/${e}`);return t},be=async e=>{const{data:t}=await w.post(`${A}/workflows`,e);return t},Pe=async(e,t)=>{const{data:o}=await w.put(`${A}/workflows/${e}`,t);return o},$e=async e=>{await w.delete(`${A}/workflows/${e}`)},Me=async e=>{const{data:t}=await w.post(`${A}/workflow-steps`,e);return t},Fe=async(e,t)=>{const{data:o}=await w.put(`${A}/workflow-steps/${e}`,t);return o},qe=async e=>{await w.delete(`${A}/workflow-steps/${e}`)},Be=async(e={})=>{const{data:t}=await w.get(`${A}/prompts`,{params:e});return t},Re=async e=>{const{data:t}=await w.post(`${A}/prompts`,e);return t},De=async(e,t)=>{const{data:o}=await w.put(`${A}/prompts/${e}`,t);return o},We=async e=>{await w.delete(`${A}/prompts/${e}`)},xe=async(e,t={})=>{const{data:o}=await w.get(`${A}/workflows/${e}/logs`,{params:t});return o},Ue=async()=>{const{data:e}=await w.get(`${A}/automation/schema`);return e},j={TOP_LEFT:"top-left",TOP_RIGHT:"top-right",TOP_CENTER:"top-center",BOTTOM_LEFT:"bottom-left",BOTTOM_RIGHT:"bottom-right",BOTTOM_CENTER:"bottom-center"},D={LIGHT:"light",DARK:"dark",COLORED:"colored",AUTO:"auto"},g={INFO:"info",SUCCESS:"success",WARNING:"warning",ERROR:"error",DEFAULT:"default"},He={BOUNCE:"bounce",SLIDE:"slide",FLIP:"flip",ZOOM:"zoom",NONE:"none"},je={dangerouslyHTMLString:!1,multiple:!0,position:j.TOP_RIGHT,autoClose:5e3,transition:"bounce",hideProgressBar:!1,pauseOnHover:!0,pauseOnFocusLoss:!0,closeOnClick:!0,className:"",bodyClassName:"",style:{},progressClassName:"",progressStyle:{},role:"alert",theme:"light"},ze={rtl:!1,newestOnTop:!1,toastClassName:""},he={...je,...ze};g.DEFAULT;var c=(e=>(e[e.COLLAPSE_DURATION=300]="COLLAPSE_DURATION",e[e.DEBOUNCE_DURATION=50]="DEBOUNCE_DURATION",e.CSS_NAMESPACE="Toastify",e))(c||{}),se=(e=>(e.ENTRANCE_ANIMATION_END="d",e))(se||{});const Ge={enter:"Toastify--animate Toastify__bounce-enter",exit:"Toastify--animate Toastify__bounce-exit",appendPosition:!0},Ve={enter:"Toastify--animate Toastify__slide-enter",exit:"Toastify--animate Toastify__slide-exit",appendPosition:!0},Ke={enter:"Toastify--animate Toastify__zoom-enter",exit:"Toastify--animate Toastify__zoom-exit"},Je={enter:"Toastify--animate Toastify__flip-enter",exit:"Toastify--animate Toastify__flip-exit"},ue="Toastify--animate Toastify__none-enter";function ge(e,t=!1){var o;let s=Ge;if(!e||typeof e=="string")switch(e){case"flip":s=Je;break;case"zoom":s=Ke;break;case"slide":s=Ve;break}else s=e;if(t)s.enter=ue;else if(s.enter===ue){const n=(o=s.exit.split("__")[1])==null?void 0:o.split("-")[0];s.enter=`Toastify--animate Toastify__${n}-enter`}return s}function Xe(e){return e.containerId||String(e.position)}const Q="will-unmount";function Ye(e=j.TOP_RIGHT){return!!document.querySelector(`.${c.CSS_NAMESPACE}__toast-container--${e}`)}function Ze(e=j.TOP_RIGHT){return`${c.CSS_NAMESPACE}__toast-container--${e}`}function Qe(e,t,o=!1){const s=[`${c.CSS_NAMESPACE}__toast-container`,`${c.CSS_NAMESPACE}__toast-container--${e}`,o?`${c.CSS_NAMESPACE}__toast-container--rtl`:null].filter(Boolean).join(" ");return R(t)?t({position:e,rtl:o,defaultClassName:s}):`${s} ${t||""}`}function et(e){var t;const{position:o,containerClassName:s,rtl:n=!1,style:a={}}=e,i=c.CSS_NAMESPACE,l=Ze(o),u=document.querySelector(`.${i}`),m=document.querySelector(`.${l}`),_=!!m&&!((t=m.className)!=null&&t.includes(Q)),v=u||document.createElement("div"),r=document.createElement("div");r.className=Qe(o,s,n),r.dataset.testid=`${c.CSS_NAMESPACE}__toast-container--${o}`,r.id=Xe(e);for(const f in a)if(Object.prototype.hasOwnProperty.call(a,f)){const I=a[f];r.style[f]=I}return u||(v.className=c.CSS_NAMESPACE,document.body.appendChild(v)),_||v.appendChild(r),r}function ne(e){var t,o,s;const n=typeof e=="string"?e:((t=e.currentTarget)==null?void 0:t.id)||((o=e.target)==null?void 0:o.id),a=document.getElementById(n);a&&a.removeEventListener("animationend",ne,!1);try{H[n].unmount(),(s=document.getElementById(n))==null||s.remove(),delete H[n],delete y[n]}catch{}}const H=F({});function tt(e,t){const o=document.getElementById(String(t));o&&(H[o.id]=e)}function ae(e,t=!0){const o=String(e);if(!H[o])return;const s=document.getElementById(o);s&&s.classList.add(Q),t?(st(e),s&&s.addEventListener("animationend",ne,!1)):ne(o),k.items=k.items.filter(n=>n.containerId!==e)}function ot(e){for(const t in H)ae(t,e);k.items=[]}function _e(e,t){const o=document.getElementById(e.toastId);if(o){let s=e;s={...s,...ge(s.transition)};const n=s.appendPosition?`${s.exit}--${s.position}`:s.exit;o.className+=` ${n}`,t&&t(o)}}function st(e){for(const t in y)if(t===e)for(const o of y[t]||[])_e(o)}function nt(e){const t=W().find(o=>o.toastId===e);return t==null?void 0:t.containerId}function de(e){return document.getElementById(e)}function at(e){const t=de(e.containerId);return t&&t.classList.contains(Q)}function fe(e){var t;const o=ye(e.content)?O(e.content.props):null;return o??O((t=e.data)!=null?t:{})}function rt(e){return e?k.items.filter(t=>t.containerId===e).length>0:k.items.length>0}function it(){if(k.items.length>0){const e=k.items.shift();V(e==null?void 0:e.toastContent,e==null?void 0:e.toastProps)}}const y=F({}),k=F({items:[]});function W(){const e=O(y);return Object.values(e).reduce((t,o)=>[...t,...o],[])}function lt(e){return W().find(t=>t.toastId===e)}function V(e,t={}){if(at(t)){const o=de(t.containerId);o&&o.addEventListener("animationend",re.bind(null,e,t),!1)}else re(e,t)}function re(e,t={}){const o=de(t.containerId);o&&o.removeEventListener("animationend",re.bind(null,e,t),!1);const s=y[t.containerId]||[],n=s.length>0;if(!n&&!Ye(t.position)){const a=et(t),i=Ie(Ot,t);t.useHandler&&t.useHandler(i),i.mount(a),tt(i,a.id)}n&&!t.updateId&&(t.position=s[0].position),ce(()=>{t.updateId?E.update(t):E.add(e,t)})}const E={add(e,t){const{containerId:o=""}=t;o&&(y[o]=y[o]||[],y[o].find(s=>s.toastId===t.toastId)||setTimeout(()=>{var s,n;t.newestOnTop?(s=y[o])==null||s.unshift(t):(n=y[o])==null||n.push(t),t.onOpen&&t.onOpen(fe(t))},t.delay||0))},remove(e){if(e){const t=nt(e);if(t){const o=y[t];let s=o.find(n=>n.toastId===e);y[t]=o.filter(n=>n.toastId!==e),!y[t].length&&!rt(t)&&ae(t,!1),it(),ce(()=>{s!=null&&s.onClose&&(s.onClose(fe(s)),s=void 0)})}}},update(e={}){const{containerId:t=""}=e;if(t&&e.updateId){y[t]=y[t]||[];const o=y[t].find(a=>a.toastId===e.toastId),s=(o==null?void 0:o.position)!==e.position||(o==null?void 0:o.transition)!==e.transition,n={...e,disabledEnterTransition:!s,updateId:void 0};E.dismissForce(e==null?void 0:e.toastId),setTimeout(()=>{d(n.content,n)},e.delay||0)}},clear(e,t=!0){e?ae(e,t):ot(t)},dismissCallback(e){var t;const o=(t=e.currentTarget)==null?void 0:t.id,s=document.getElementById(o);s&&(s.removeEventListener("animationend",E.dismissCallback,!1),setTimeout(()=>{E.remove(o)}))},dismiss(e){if(e){const t=W();for(const o of t)if(o.toastId===e){_e(o,s=>{s.addEventListener("animationend",E.dismissCallback,!1)});break}}},dismissForce(e){if(e){const t=W();for(const o of t)if(o.toastId===e){const s=document.getElementById(e);s&&(s.remove(),s.removeEventListener("animationend",E.dismissCallback,!1),E.remove(e));break}}}},ct=F({useHandler:void 0}),we=F({}),Y=F({});function Ae(){return Math.random().toString(36).substring(2,9)}function dt(e){return typeof e=="number"&&!isNaN(e)}function ie(e){return typeof e=="string"}function R(e){return typeof e=="function"}function ee(...e){return $(...e)}function K(e){return typeof e=="object"&&(!!(e!=null&&e.render)||!!(e!=null&&e.setup)||typeof(e==null?void 0:e.type)=="object")}function ut(e={}){we[`${c.CSS_NAMESPACE}-default-options`]=e}function ft(){return we[`${c.CSS_NAMESPACE}-default-options`]||he}function pt(){const e=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches;return document.documentElement.classList.contains("dark")||e?"dark":"light"}var J=(e=>(e[e.Enter=0]="Enter",e[e.Exit=1]="Exit",e))(J||{});const ve={containerId:{type:[String,Number],required:!1,default:""},clearOnUrlChange:{type:Boolean,required:!1,default:!0},disabledEnterTransition:{type:Boolean,required:!1,default:!1},dangerouslyHTMLString:{type:Boolean,required:!1,default:!1},multiple:{type:Boolean,required:!1,default:!0},limit:{type:Number,required:!1,default:void 0},position:{type:String,required:!1,default:j.TOP_LEFT},bodyClassName:{type:String,required:!1,default:""},autoClose:{type:[Number,Boolean],required:!1,default:!1},closeButton:{type:[Boolean,Function,Object],required:!1,default:void 0},transition:{type:[String,Object],required:!1,default:"bounce"},hideProgressBar:{type:Boolean,required:!1,default:!1},pauseOnHover:{type:Boolean,required:!1,default:!0},pauseOnFocusLoss:{type:Boolean,required:!1,default:!0},closeOnClick:{type:Boolean,required:!1,default:!0},progress:{type:Number,required:!1,default:void 0},progressClassName:{type:String,required:!1,default:""},toastStyle:{type:Object,required:!1,default(){return{}}},progressStyle:{type:Object,required:!1,default(){return{}}},role:{type:String,required:!1,default:"alert"},theme:{type:String,required:!1,default:D.AUTO},content:{type:[String,Object,Function],required:!1,default:""},toastId:{type:[String,Number],required:!1,default:""},data:{type:[Object,String],required:!1,default(){return{}}},type:{type:String,required:!1,default:g.DEFAULT},icon:{type:[Boolean,String,Number,Object,Function],required:!1,default:void 0},delay:{type:Number,required:!1,default:void 0},onOpen:{type:Function,required:!1,default:void 0},onClose:{type:Function,required:!1,default:void 0},onClick:{type:Function,required:!1,default:void 0},isLoading:{type:Boolean,required:!1,default:void 0},rtl:{type:Boolean,required:!1,default:!1},toastClassName:{type:String,required:!1,default:""},updateId:{type:[String,Number],required:!1,default:""},contentProps:{type:Object,required:!1,default:null},expandCustomProps:{type:Boolean,required:!1,default:!1}},mt={autoClose:{type:[Number,Boolean],required:!0},isRunning:{type:Boolean,required:!1,default:void 0},type:{type:String,required:!1,default:g.DEFAULT},theme:{type:String,required:!1,default:D.AUTO},hide:{type:Boolean,required:!1,default:void 0},className:{type:[String,Function],required:!1,default:""},controlledProgress:{type:Boolean,required:!1,default:void 0},rtl:{type:Boolean,required:!1,default:void 0},isIn:{type:Boolean,required:!1,default:void 0},progress:{type:Number,required:!1,default:void 0},closeToast:{type:Function,required:!1,default:void 0}},yt=Z({name:"ProgressBar",props:mt,setup(e,{attrs:t}){const o=B(),s=h(()=>e.hide?"true":"false"),n=h(()=>({...t.style||{},animationDuration:`${e.autoClose===!0?5e3:e.autoClose}ms`,animationPlayState:e.isRunning?"running":"paused",opacity:e.hide||e.autoClose===!1?0:1,transform:e.controlledProgress?`scaleX(${e.progress})`:"none"})),a=h(()=>[`${c.CSS_NAMESPACE}__progress-bar`,e.controlledProgress?`${c.CSS_NAMESPACE}__progress-bar--controlled`:`${c.CSS_NAMESPACE}__progress-bar--animated`,`${c.CSS_NAMESPACE}__progress-bar-theme--${e.theme}`,`${c.CSS_NAMESPACE}__progress-bar--${e.type}`,e.rtl?`${c.CSS_NAMESPACE}__progress-bar--rtl`:null].filter(Boolean).join(" ")),i=h(()=>`${a.value} ${(t==null?void 0:t.class)||""}`),l=()=>{o.value&&(o.value.onanimationend=null,o.value.ontransitionend=null)},u=()=>{e.isIn&&e.closeToast&&e.autoClose!==!1&&(e.closeToast(),l())},m=h(()=>e.controlledProgress?null:u),_=h(()=>e.controlledProgress?u:null);return G(()=>{o.value&&(l(),o.value.onanimationend=m.value,o.value.ontransitionend=_.value)}),()=>p("div",{ref:o,role:"progressbar","aria-hidden":s.value,"aria-label":"notification timer",class:i.value,style:n.value},null)}}),ht=Z({name:"CloseButton",inheritAttrs:!1,props:{theme:{type:String,required:!1,default:D.AUTO},type:{type:String,required:!1,default:D.LIGHT},ariaLabel:{type:String,required:!1,default:"close"},closeToast:{type:Function,required:!1,default:void 0}},setup(e){return()=>p("button",{class:`${c.CSS_NAMESPACE}__close-button ${c.CSS_NAMESPACE}__close-button--${e.theme}`,type:"button",onClick:t=>{t.stopPropagation(),e.closeToast&&e.closeToast(t)},"aria-label":e.ariaLabel},[p("svg",{"aria-hidden":"true",viewBox:"0 0 14 16"},[p("path",{"fill-rule":"evenodd",d:"M7.71 8.23l3.75 3.75-1.48 1.48-3.75-3.75-3.75 3.75L1 11.98l3.75-3.75L1 4.48 2.48 3l3.75 3.75L9.98 3l1.48 1.48-3.75 3.75z"},null)])])}}),te=({theme:e,type:t,path:o,...s})=>p("svg",$({viewBox:"0 0 24 24",width:"100%",height:"100%",fill:e==="colored"?"currentColor":`var(--toastify-icon-color-${t})`},s),[p("path",{d:o},null)]);function gt(e){return p(te,$(e,{path:"M23.32 17.191L15.438 2.184C14.728.833 13.416 0 11.996 0c-1.42 0-2.733.833-3.443 2.184L.533 17.448a4.744 4.744 0 000 4.368C1.243 23.167 2.555 24 3.975 24h16.05C22.22 24 24 22.044 24 19.632c0-.904-.251-1.746-.68-2.44zm-9.622 1.46c0 1.033-.724 1.823-1.698 1.823s-1.698-.79-1.698-1.822v-.043c0-1.028.724-1.822 1.698-1.822s1.698.79 1.698 1.822v.043zm.039-12.285l-.84 8.06c-.057.581-.408.943-.897.943-.49 0-.84-.367-.896-.942l-.84-8.065c-.057-.624.25-1.095.779-1.095h1.91c.528.005.84.476.784 1.1z"}),null)}function _t(e){return p(te,$(e,{path:"M12 0a12 12 0 1012 12A12.013 12.013 0 0012 0zm.25 5a1.5 1.5 0 11-1.5 1.5 1.5 1.5 0 011.5-1.5zm2.25 13.5h-4a1 1 0 010-2h.75a.25.25 0 00.25-.25v-4.5a.25.25 0 00-.25-.25h-.75a1 1 0 010-2h1a2 2 0 012 2v4.75a.25.25 0 00.25.25h.75a1 1 0 110 2z"}),null)}function wt(e){return p(te,$(e,{path:"M12 0a12 12 0 1012 12A12.014 12.014 0 0012 0zm6.927 8.2l-6.845 9.289a1.011 1.011 0 01-1.43.188l-4.888-3.908a1 1 0 111.25-1.562l4.076 3.261 6.227-8.451a1 1 0 111.61 1.183z"}),null)}function At(e){return p(te,$(e,{path:"M11.983 0a12.206 12.206 0 00-8.51 3.653A11.8 11.8 0 000 12.207 11.779 11.779 0 0011.8 24h.214A12.111 12.111 0 0024 11.791 11.766 11.766 0 0011.983 0zM10.5 16.542a1.476 1.476 0 011.449-1.53h.027a1.527 1.527 0 011.523 1.47 1.475 1.475 0 01-1.449 1.53h-.027a1.529 1.529 0 01-1.523-1.47zM11 12.5v-6a1 1 0 012 0v6a1 1 0 11-2 0z"}),null)}function vt(){return p("div",{class:`${c.CSS_NAMESPACE}__spinner`},null)}const X={info:_t,warning:gt,success:wt,error:At,spinner:vt},St=e=>e in X;function Ct({theme:e,type:t,isLoading:o,icon:s}){let n;const a=!!o||t==="loading",i={theme:e,type:t};if(a&&(s===void 0||typeof s=="boolean"))return X.spinner();if(s!==!1){if(K(s))n=O(s);else if(R(s)){const l=s;i.type=a?"loading":t,n=l(i),n=!n&&a?X.spinner():n}else ye(s)?n=Te(s,i):ie(s)||dt(s)?n=s:St(t)&&(n=X[t](i));return n}}const Et=()=>{};function It(e,t,o=c.COLLAPSE_DURATION){const{scrollHeight:s,style:n}=e,a=o;requestAnimationFrame(()=>{n.minHeight="initial",n.height=s+"px",n.transition=`all ${a}ms`,requestAnimationFrame(()=>{n.height="0",n.padding="0",n.margin="0",setTimeout(t,a)})})}function Nt(e){const t=B(!1),o=B(!1),s=B(!1),n=B(J.Enter),a=F({...e,appendPosition:e.appendPosition||!1,collapse:typeof e.collapse>"u"?!0:e.collapse,collapseDuration:e.collapseDuration||c.COLLAPSE_DURATION}),i=a.done||Et,l=h(()=>a.appendPosition?`${a.enter}--${a.position}`:a.enter),u=h(()=>a.appendPosition?`${a.exit}--${a.position}`:a.exit),m=h(()=>e.pauseOnHover?{onMouseenter:T,onMouseleave:N}:{});function _(){const C=l.value.split(" ");r().addEventListener(se.ENTRANCE_ANIMATION_END,N,{once:!0});const L=q=>{const x=r();q.target===x&&(x.dispatchEvent(new Event(se.ENTRANCE_ANIMATION_END)),x.removeEventListener("animationend",L),x.removeEventListener("animationcancel",L),n.value===J.Enter&&q.type!=="animationcancel"&&x.classList.remove(...C))},P=()=>{const q=r();q.classList.add(...C),q.addEventListener("animationend",L),q.addEventListener("animationcancel",L)};e.pauseOnFocusLoss&&f(),P()}function v(){if(!r())return;const C=()=>{const P=r();P.removeEventListener("animationend",C),a.collapse?It(P,i,a.collapseDuration):i()},L=()=>{const P=r();n.value=J.Exit,P&&(P.className+=` ${u.value}`,P.addEventListener("animationend",C))};o.value||(s.value?C():setTimeout(L))}function r(){return e.toastRef.value}function f(){document.hasFocus()||T(),window.addEventListener("focus",N),window.addEventListener("blur",T)}function I(){window.removeEventListener("focus",N),window.removeEventListener("blur",T)}function N(){(!e.loading.value||e.isLoading===void 0)&&(t.value=!0)}function T(){t.value=!1}function S(C){C&&(C.stopPropagation(),C.preventDefault()),o.value=!1}return G(v),G(()=>{const C=W();o.value=C.findIndex(L=>L.toastId===a.toastId)>-1}),G(()=>{e.isLoading!==void 0&&(e.loading.value?T():N())}),pe(_),me(()=>{e.pauseOnFocusLoss&&I()}),{isIn:o,isRunning:t,hideToast:S,eventHandlers:m}}const Tt=Z({name:"ToastItem",inheritAttrs:!1,props:ve,setup(e){const t=B(),o=h(()=>!!e.isLoading),s=h(()=>e.progress!==void 0&&e.progress!==null),n=h(()=>Ct(e)),a=h(()=>[`${c.CSS_NAMESPACE}__toast`,`${c.CSS_NAMESPACE}__toast-theme--${e.theme}`,`${c.CSS_NAMESPACE}__toast--${e.type}`,e.rtl?`${c.CSS_NAMESPACE}__toast--rtl`:void 0,e.toastClassName||""].filter(Boolean).join(" ")),{isRunning:i,isIn:l,hideToast:u,eventHandlers:m}=Nt({toastRef:t,loading:o,done:()=>{E.remove(e.toastId)},...ge(e.transition,e.disabledEnterTransition),...e});return()=>p("div",$({id:e.toastId,class:a.value,style:e.toastStyle||{},ref:t,"data-testid":`toast-item-${e.toastId}`,onClick:_=>{e.closeOnClick&&u(),e.onClick&&e.onClick(_)}},m.value),[p("div",{role:e.role,"data-testid":"toast-body",class:`${c.CSS_NAMESPACE}__toast-body ${e.bodyClassName||""}`},[n.value!=null&&p("div",{"data-testid":`toast-icon-${e.type}`,class:[`${c.CSS_NAMESPACE}__toast-icon`,e.isLoading?"":`${c.CSS_NAMESPACE}--animate-icon ${c.CSS_NAMESPACE}__zoom-enter`].join(" ")},[K(n.value)?z(O(n.value),{theme:e.theme,type:e.type}):R(n.value)?n.value({theme:e.theme,type:e.type}):n.value]),p("div",{"data-testid":"toast-content"},[K(e.content)?z(O(e.content),{toastProps:O(e),closeToast:u,data:e.data,...e.expandCustomProps?e.contentProps:{contentProps:e.contentProps||{}}}):R(e.content)?e.content({toastProps:O(e),closeToast:u,data:e.data}):e.dangerouslyHTMLString?z("div",{innerHTML:e.content}):e.content])]),(e.closeButton===void 0||e.closeButton===!0)&&p(ht,{theme:e.theme,closeToast:_=>{_.stopPropagation(),_.preventDefault(),u()}},null),K(e.closeButton)?z(O(e.closeButton),{closeToast:u,type:e.type,theme:e.theme}):R(e.closeButton)?e.closeButton({closeToast:u,type:e.type,theme:e.theme}):null,p(yt,{className:e.progressClassName,style:e.progressStyle,rtl:e.rtl,theme:e.theme,isIn:l.value,type:e.type,hide:e.hideProgressBar,isRunning:i.value,autoClose:e.autoClose,controlledProgress:s.value,progress:e.progress,closeToast:e.isLoading?void 0:u},null)])}});let U=0;function Se(){typeof window>"u"||(U&&window.cancelAnimationFrame(U),U=window.requestAnimationFrame(Se),Y.lastUrl!==window.location.href&&(Y.lastUrl=window.location.href,E.clear()))}const Ot=Z({name:"ToastifyContainer",inheritAttrs:!1,props:ve,setup(e){const t=h(()=>e.containerId),o=h(()=>y[t.value]||[]),s=h(()=>o.value.filter(n=>n.position===e.position));return pe(()=>{typeof window<"u"&&e.clearOnUrlChange&&window.requestAnimationFrame(Se)}),me(()=>{typeof window<"u"&&U&&(window.cancelAnimationFrame(U),Y.lastUrl="")}),()=>p(Ne,null,[s.value.map(n=>{const{toastId:a=""}=n;return p(Tt,$({key:a},n),null)})])}});let oe=!1;const Ce={isLoading:!0,autoClose:!1,closeOnClick:!1,closeButton:!1,draggable:!1};function Ee(){const e=[];return W().forEach(t=>{const o=document.getElementById(t.containerId);o&&!o.classList.contains(Q)&&e.push(t)}),e}function kt(e){const t=Ee().length,o=e??0;return o>0&&t+k.items.length>=o}function Lt(e){kt(e.limit)&&!e.updateId&&k.items.push({toastId:e.toastId,containerId:e.containerId,toastContent:e.content,toastProps:e})}function M(e,t,o={}){if(oe)return;o=ee(ft(),{type:t},O(o)),(!o.toastId||typeof o.toastId!="string"&&typeof o.toastId!="number")&&(o.toastId=Ae()),o={...o,...o.type==="loading"?Ce:{},content:e,containerId:o.containerId||String(o.position)};const s=Number(o==null?void 0:o.progress);return!isNaN(s)&&s<0&&(o.progress=0),s>1&&(o.progress=1),o.theme==="auto"&&(o.theme=pt()),Lt(o),Y.lastUrl=window.location.href,o.multiple?k.items.length?o.updateId&&V(e,o):V(e,o):(oe=!0,d.clearAll(void 0,!1),setTimeout(()=>{V(e,o)},0),setTimeout(()=>{oe=!1},390)),o.toastId}const d=(e,t)=>M(e,g.DEFAULT,t);d.info=(e,t)=>M(e,g.DEFAULT,{...t,type:g.INFO});d.error=(e,t)=>M(e,g.DEFAULT,{...t,type:g.ERROR});d.warning=(e,t)=>M(e,g.DEFAULT,{...t,type:g.WARNING});d.warn=d.warning;d.success=(e,t)=>M(e,g.DEFAULT,{...t,type:g.SUCCESS});d.loading=(e,t)=>M(e,g.DEFAULT,ee(t,Ce));d.dark=(e,t)=>M(e,g.DEFAULT,ee(t,{theme:D.DARK}));d.remove=e=>{e?E.dismiss(e):E.clear()};d.clearAll=(e,t)=>{ce(()=>{E.clear(e,t)})};d.isActive=e=>{let t=!1;return t=Ee().findIndex(o=>o.toastId===e)>-1,t};d.update=(e,t={})=>{setTimeout(()=>{const o=lt(e);if(o){const s=O(o),{content:n}=s,a={...s,...t,toastId:t.toastId||e,updateId:Ae()},i=a.render||n;delete a.render,M(i,a.type,a)}},0)};d.done=e=>{d.update(e,{isLoading:!1,progress:1})};d.promise=bt;function bt(e,{pending:t,error:o,success:s},n){var a,i,l;let u;const m={...n||{},autoClose:!1};t&&(u=ie(t)?d.loading(t,m):d.loading(t.render,{...m,...t}));const _={autoClose:(a=n==null?void 0:n.autoClose)!=null?a:!0,closeOnClick:(i=n==null?void 0:n.closeOnClick)!=null?i:!0,closeButton:(l=n==null?void 0:n.autoClose)!=null?l:null,isLoading:void 0,draggable:null,delay:100},v=(f,I,N)=>{if(I==null){d.remove(u);return}const T={type:f,..._,...n,data:N},S=ie(I)?{render:I}:I;return u?d.update(u,{...T,...S,isLoading:!1}):d(S.render,{...T,...S,isLoading:!1}),N},r=R(e)?e():e;return r.then(f=>{v("success",s,f)}).catch(f=>{v("error",o,f)}),r}d.POSITION=j;d.THEME=D;d.TYPE=g;d.TRANSITIONS=He;const Pt={install(e,t={}){ct.useHandler=t.useHandler||(()=>{}),$t(t)}};typeof window<"u"&&(window.Vue3Toastify=Pt);function $t(e={}){const t=ee(he,e);ut(t)}const b=e=>e&&e.data?e.data:e,le=(e,t,o)=>{if(!e)return!1;const s=e.findIndex(n=>n.id===t);if(s>-1)return e.splice(s,1,o),!0;for(const n of e)if(n.step_type==="CONDITION"&&(le(n.yes_steps,t,o)||le(n.no_steps,t,o)))return!0;return!1},Ft=Oe("workflow",{state:()=>({workflows:[],prompts:[],automationSchema:[],campaigns:[],morphMap:[],activeWorkflow:null,selectedStep:null,isLoading:!1,modalState:{show:!1,title:"",message:"",onConfirm:null,onCancel:null,type:"alert"},logsModal:{show:!1,isLoading:!1,workflow:null,items:[],meta:null,params:{per_page:20,page:1,status:null,step_id:null}}}),actions:{showAlert(e,t){this.modalState={show:!0,title:e,message:t,onConfirm:null,onCancel:null,type:"alert"}},showConfirm(e,t,o,s){this.modalState={show:!0,title:e,message:t,onConfirm:o,onCancel:s,type:"confirm"}},hideModal(){this.modalState={show:!1,title:"",message:"",onConfirm:null,onCancel:null,type:"alert"}},showLogs(e){this.logsModal.show=!0,this.logsModal.workflow=e,this.logsModal.items=[],this.logsModal.meta=null,this.logsModal.params.page=1,this.fetchWorkflowLogs(e.id)},hideLogs(){this.logsModal={show:!1,isLoading:!1,workflow:null,items:[],meta:null,params:{per_page:20,page:1,status:null,step_id:null}}},async fetchWorkflowLogs(e,t={}){this.logsModal.isLoading=!0;try{const o={...this.logsModal.params,...t},s=await xe(e,o);if(s&&typeof s=="object"){const n=Array.isArray(s.data)?s.data:[];this.logsModal.items=n;let a=null;s.meta&&typeof s.meta=="object"?a=s.meta:(typeof s.current_page=="number"||typeof s.last_page=="number")&&(a={current_page:s.current_page??1,last_page:s.last_page??1,per_page:s.per_page??o.per_page??20,total:s.total??(Array.isArray(n)?n.length:0),from:s.from??null,to:s.to??null}),this.logsModal.meta=a,a&&typeof a.current_page=="number"&&(this.logsModal.params.page=a.current_page)}else Array.isArray(s)?(this.logsModal.items=s,this.logsModal.meta=null):(this.logsModal.items=[],this.logsModal.meta=null)}catch(o){console.error("Failed to fetch workflow logs",o),this.showAlert("Failed to load logs","Could not load execution logs for this workflow.")}finally{this.logsModal.isLoading=!1}},async goToLogsPage(e){this.logsModal.workflow&&(this.logsModal.params.page=e,await this.fetchWorkflowLogs(this.logsModal.workflow.id,{page:e}))},async fetchAutomationSchema(){try{const e=await Ue();if(Array.isArray(e))this.automationSchema=e,this.campaigns=[];else if(e&&typeof e=="object"){const t=Array.isArray(e.models)?e.models:[];this.automationSchema=t,this.campaigns=Array.isArray(e.campaigns)?e.campaigns:[],this.morphMap=Array.isArray(e.morph_map)?e.morph_map:[]}else this.automationSchema=[],this.campaigns=[]}catch(e){console.error("Failed to fetch automation schema:",e),this.automationSchema=[],this.campaigns=[]}},async fetchWorkflows(){this.isLoading=!0;try{const e=await ke();this.workflows=b(e)||[]}catch(e){console.error("Failed to fetch workflows:",e)}finally{this.isLoading=!1}},async fetchWorkflow(e){this.isLoading=!0;try{const t=await Le(e),o=b(t),s=a=>{Array.isArray(a)&&a.forEach(i=>{(!i.step_config||typeof i.step_config!="object"||Array.isArray(i.step_config))&&(i.step_config={}),i.step_type==="CONDITION"&&(Array.isArray(i.yes_steps)||(i.yes_steps=[]),Array.isArray(i.no_steps)||(i.no_steps=[]),s(i.yes_steps),s(i.no_steps)),i.step_type==="FOR_EACH"&&(Array.isArray(i.children)||(i.children=[]),s(i.children))})},n=a=>{const i=Array.isArray(a.steps)?a.steps:[];if(!i.length)return;const l=i.some(r=>r?r.step_type==="CONDITION"?Array.isArray(r.yes_steps)&&r.yes_steps.length||Array.isArray(r.no_steps)&&r.no_steps.length:r.step_type==="FOR_EACH"?Array.isArray(r.children)&&r.children.length>0:!1:!1);if(i.forEach(r=>{(!r.step_config||typeof r.step_config!="object"||Array.isArray(r.step_config))&&(r.step_config={})}),l){s(i);return}const u=new Map;i.forEach(r=>u.set(String(r.id),r)),i.forEach(r=>{r.step_type==="CONDITION"&&(Array.isArray(r.yes_steps)||(r.yes_steps=[]),Array.isArray(r.no_steps)||(r.no_steps=[])),r.step_type==="FOR_EACH"&&(Array.isArray(r.children)||(r.children=[]))});const m=[];i.forEach(r=>{var N,T;const f=(N=r.step_config)==null?void 0:N._parent_id,I=(T=r.step_config)==null?void 0:T._branch;if(f&&u.has(String(f))){const S=u.get(String(f));if(S&&S.step_type==="CONDITION"){(String(I??"yes").toLowerCase()==="no"?S.no_steps:S.yes_steps).push(r);return}if(S&&S.step_type==="FOR_EACH"){S.children.push(r);return}return}m.push(r)});const _=r=>r.sort((f,I)=>(f.step_order??0)-(I.step_order??0)),v=r=>{_(r),r.forEach(f=>{f.step_type==="CONDITION"&&(v(f.yes_steps),v(f.no_steps)),f.step_type==="FOR_EACH"&&v(f.children)})};v(m),a.steps=m};if(o&&typeof o=="object"&&Array.isArray(o.steps)){n(o);const a=i=>{Array.isArray(i)&&i.forEach((l,u)=>{var m;!l||typeof l!="object"||((!l.step_config||typeof l.step_config!="object"||Array.isArray(l.step_config))&&(l.step_config={}),u===0&&l.step_type==="TRIGGER"&&((m=l.step_config)==null?void 0:m.trigger_event)==="schedule.run"&&(l.step_type="SCHEDULE_TRIGGER"),l.step_type==="CONDITION"&&(Array.isArray(l.if_true)||(l.if_true=Array.isArray(l.yes_steps)?l.yes_steps:[]),Array.isArray(l.if_false)||(l.if_false=Array.isArray(l.no_steps)?l.no_steps:[]),l.yes_steps=l.if_true,l.no_steps=l.if_false,a(l.if_true),a(l.if_false)),l.step_type==="FOR_EACH"&&(Array.isArray(l.children)||(l.children=[]),a(l.children)))})};a(o.steps),this.activeWorkflow=o}else console.error(`Received invalid data structure for workflow ${e}:`,t),this.activeWorkflow=null,this.selectedStep=null}catch(t){console.error(`Failed to fetch workflow ${e}:`,t),this.activeWorkflow=null,this.selectedStep=null}finally{this.isLoading=!1}},async createWorkflow(e){const t=await be(e),o=b(t);return o&&typeof o=="object"&&o.id?(this.workflows.unshift(o),await this.fetchWorkflow(o.id),o):(console.error("Received invalid data structure after creating workflow:",t),this.showAlert("Failed to create workflow.","An unknown error occurred while creating the workflow."),null)},async updateWorkflow(e,t){const o=await Pe(e,t),s=b(o);if(s&&s.id){const n=this.workflows.findIndex(a=>a.id===e);n!==-1&&this.workflows.splice(n,1,s),this.activeWorkflow&&this.activeWorkflow.id===e&&(this.activeWorkflow={...this.activeWorkflow,...s})}return s},async toggleWorkflowActive(e){if(!e)return;const t=e.id||e,o=typeof e=="object"?e:this.workflows.find(n=>n.id===t),s=!((o==null?void 0:o.is_active)??!0);return await this.updateWorkflow(t,{is_active:s})},async deleteWorkflow(e){try{await $e(e);const t=this.workflows.findIndex(o=>o.id===e);t!==-1&&this.workflows.splice(t,1),this.activeWorkflow&&this.activeWorkflow.id===e&&(this.activeWorkflow=null,this.selectedStep=null),d.success("Workflow deleted")}catch(t){console.error("Failed to delete workflow",t),this.showAlert("Delete failed","Could not delete workflow.")}},addStep({type:e,insertAfter:t,parentArray:o,parentStep:s=null,branch:n=null}){if(!this.activeWorkflow)return;const a={id:`temp_${Date.now()}`,workflow_id:this.activeWorkflow.id,name:`New ${e.replace("ACTION_","")}`,step_type:e,step_order:t+1,step_config:{},condition_rules:e==="CONDITION"?[]:null};s&&n&&(a.step_config._parent_id=s.id,a.step_config._branch=n),e==="CONDITION"&&(a.yes_steps=[],a.no_steps=[]),(o||this.activeWorkflow.steps).splice(t+1,0,a),this.selectStep(a)},selectStep(e){this.selectedStep=e},async deleteStep(e){if(!this.activeWorkflow)return;const t=(o,s)=>{const n=o.findIndex(a=>a.id===s);if(n>-1)return o.splice(n,1),!0;for(const a of o)if(a.step_type==="CONDITION"&&(t(a.yes_steps,s)||t(a.no_steps,s)))return!0;return!1};if(t(this.activeWorkflow.steps,e.id)&&(this.selectedStep&&this.selectedStep.id===e.id&&(this.selectedStep=null),!String(e.id).startsWith("temp_")))try{await qe(e.id),d.success("Step deleted!")}catch(o){console.error("Failed to delete step:",o),this.showAlert("Could not delete step.","An error occurred while deleting the step.")}},async persistStep(e){if(!e||!e.workflow_id)return;const t=e.id;try{let o;if(String(t).startsWith("temp_")){const{id:n,...a}=e,i=await Me(a);o=b(i)}else{const n=await Fe(t,e);o=b(n)}o&&(o.step_type==="CONDITION"&&(Array.isArray(o.yes_steps)||(o.yes_steps=[]),Array.isArray(o.no_steps)||(o.no_steps=[])),le(this.activeWorkflow.steps,t,o)?this.selectStep(o):await this.fetchWorkflow(e.workflow_id))}catch(o){console.error("Failed to save step:",o),this.showAlert("Failed to save step.","An error occurred while saving the step.")}},async fetchPrompts(){try{const e=await Be({per_page:100}),t=b(e);if(Array.isArray(t))this.prompts=t;else if(t&&typeof t=="object"){const o=Array.isArray(t.data)?t.data:[];this.prompts=o}else this.prompts=[]}catch(e){console.error("Failed to fetch prompts:",e),this.prompts=[]}},async createPrompt(e){const t=await Re(e),o=b(t);return Array.isArray(this.prompts)||(this.prompts=[]),o&&this.prompts.unshift(o),o},async updatePrompt(e,t){const o=await De(e,t),s=b(o);Array.isArray(this.prompts)||(this.prompts=[]);const n=this.prompts.findIndex(a=>a.id===e);return n!==-1&&s?this.prompts.splice(n,1,s):s&&this.prompts.unshift(s),s},async deletePrompt(e){await We(e);const t=this.prompts.findIndex(o=>o.id===e);t!==-1&&this.prompts.splice(t,1)}}});export{Le as f,Ft as u};
