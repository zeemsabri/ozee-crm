import{r,c as A,e as B,f as O,a as m,o as u,d as p,u as j,h as z,w as x,b as n,j as J,g as L,i as P,t as T,s as Y,U as q,F as G,E as Q}from"./app-CAFAb1eF.js";import{d as H,a as X}from"./currency-Bnw3WT5K.js";import{v as Z,_ as ee,i as te,u as ae,s as S,e as se,r as oe,p as ne,j as re}from"./AuthenticatedLayout-BkgTs1s1.js";import ie from"./Filters-Coj_zXa3.js";import le from"./ProjectCards-9DUGfWZ8.js";import ce from"./Sidebar-BRsYub8p.js";import{_ as ue}from"./KanbanBoard-DImyvs0q.js";import"./PrimaryButton-B0IQlqda.js";import"./Modal-CDN04Q2S.js";import"./InputLabel-7v3_eWB1.js";import"./InputError-I39UKt8R.js";import"./SecondaryButton-B0qjAY1S.js";import"./index-D_i0B-3M.js";import"./BaseFormModal-dq60iOty.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./TextInput-LBlrGUfM.js";import"./SelectDropdown-VugtsDkb.js";/* empty css                                                                       */import"./debounce-C-hnF4Z3.js";import"./ApplicationLogo-BVOiNkKZ.js";import"./createLucideIcon-Bh9soDj0.js";import"./plus-zE9ixXKo.js";import"./DangerButton-enh6BrPK.js";import"./moment-BLMuvzoS.js";import"./NoticeboardModal-BQYDwu5O.js";import"./ProjectCard-VBR8gKi8.js";const de={class:"flex items-center justify-between"},me={class:"flex items-center gap-3"},pe=["data-active"],ve={class:"py-10"},ke={class:"mb-6"},ge={key:0,class:"flex flex-col lg:flex-row gap-8"},fe={class:"lg:w-2/3"},he={class:"lg:w-1/3"},ye={key:1,class:"mt-4"},be={class:"mb-3 flex items-center justify-between"},_e={key:0,class:"text-xs text-gray-500"},we={key:1,class:"text-xs text-red-600"},xe=["onDragstart","onClick","title"],Pe={class:"text-sm font-medium text-gray-800 truncate"},Te={key:0,class:"text-xs text-gray-500 truncate"},Ze={__name:"Index",setup(Ce){const y=r([{id:1,name:"Project Phoenix",role:"Manager",health:"at-risk",alert:{text:"Client email from Project Phoenix requires a reply.",timer:"3h 25m",incentive:"Reply in time to earn 50 points."},overview:{milestone:"3 of 5 - Design Phase (60% Complete)",budget:"$15,000 / $25,000 Used",status:"On Track"},tasks:{today:[{name:"Create new ad copy",status:"started",assignee:"Alex Ray"},{name:"Review wireframes",status:"blocked",assignee:"Sarah Chen"}],tomorrow:[{name:"Client feedback call",status:"paused",assignee:"Jane Doe"},{name:"Design review meeting",status:"complete",assignee:"Team A"}],completed:[{name:"Initial Project Kickoff",status:"complete"}]},communication:{lastSent:"Today at 9:15 AM",lastReceived:"3 days ago at 4:30 PM"}},{id:2,name:"Project Odyssey",role:"Contributor",health:"needs-attention",tasks:{today:[{name:"Develop login API endpoint",status:"blocked"},{name:"Write unit tests for checkout process",status:"started"}],tomorrow:[{name:"Refactor database schema",status:"paused"}],completed:[{name:"Update documentation",status:"complete"}]},milestone:{name:"Backend API Development",deadline:"September 5, 2025",progress:75,incentive:"Complete on time to earn a 5% bonus and 200 points!"}},{id:3,name:"Project Gemini",role:"Manager",health:"on-track",alert:null,overview:{milestone:"2 of 4 - Testing Phase (95% Complete)",budget:"$8,000 / $10,000 Used",status:"In Progress"},tasks:{today:[{name:"User Acceptance Testing",status:"complete"}],tomorrow:[{name:"Deploy to staging",status:"started"}],completed:[{name:"Initial QA Review",status:"complete"}]},communication:{lastSent:"Yesterday at 11:00 AM",lastReceived:"Yesterday at 10:45 AM"}},{id:4,name:"Project Alpha",role:"Contributor",health:"on-track",tasks:{today:[],tomorrow:[],completed:[{name:"Initial project setup",status:"complete"},{name:"Write documentation",status:"complete"}]},milestone:{name:"Project Kickoff",deadline:"September 20, 2025",progress:100,incentive:"Complete on time to earn a 5% bonus and 200 points!"}}]),d=r("all"),b=r(""),_=r("with");A(()=>d.value==="all"?y.value:d.value==="manager"?y.value.filter(e=>e.role==="Manager"):d.value==="contributor"?y.value.filter(e=>e.role==="Contributor"):[]);const w=r(["Follow up with Alex on Project Phoenix","Prepare for sprint planning"]),C=r(localStorage.getItem("my_dashboard_notes")||"");function $(e){e&&w.value.push(e)}function M(e){w.value.splice(e,1)}function R(e){C.value=e,localStorage.setItem("my_dashboard_notes",e)}const i=r(localStorage.getItem("workspace_kanban_view")==="1");B(i,e=>{try{localStorage.setItem("workspace_kanban_view",e?"1":"0")}catch{}});const U=[{key:"To Do",title:"To Do"},{key:"In Progress",title:"In Progress"},{key:"Paused",title:"Paused"},{key:"Blocked",title:"Blocked"},{key:"Done",title:"Done"},{key:"Archived",title:"Archived"}],l=r([]),v=r(!1),g=r(""),F=async()=>{var t,a;const e=(a=(t=Q().props.auth)==null?void 0:t.user)==null?void 0:a.id;if(e){v.value=!0,g.value="";try{const{data:c}=await window.axios.get("/api/tasks",{params:{assigned_to_user_id:e}});l.value=Array.isArray(c)?c:[]}catch(c){console.error("Failed to load assigned tasks for kanban",c),g.value="Failed to load tasks",l.value=[]}finally{v.value=!1}}};B(i,e=>{setTimeout(()=>{e&&l.value.length===0&&!v.value&&F()},500)},{immediate:!0});const W=A(()=>{const e={"To Do":[],"In Progress":[],Paused:[],Blocked:[],Done:[],Archived:[]};for(const t of l.value){const a=t.status&&e[t.status]!==void 0?t.status:"To Do";e[a].push(t)}return e}),f=r(!1),h=r(null),K=e=>{h.value=e,f.value=!0},E=async e=>{if(h.value)try{const t=await re(h.value,e);k(t)}catch(t){console.error("Failed to block task from workspace:",t)}finally{f.value=!1,h.value=null}},N=(e,t)=>e===t?null:e==="To Do"&&t==="In Progress"?"start":e==="In Progress"&&t==="Paused"?"pause":e==="Paused"&&t==="In Progress"?"resume":e==="In Progress"&&t==="Done"?"complete":(e==="To Do"||e==="In Progress"||e==="Paused")&&t==="Blocked"?"block":e==="Blocked"&&t==="In Progress"?"unblock_to_inprogress":e==="Done"&&t==="To Do"?"revise":null,k=e=>{if(!e)return;const t=l.value.findIndex(a=>String(a.id)===String(e.id));t>=0?l.value[t]={...l.value[t],...e}:l.value.push(e)},V=async({data:e,to:t})=>{if(!e||!t)return;const a=e.status,c=N(a,t);if(!c)return;const o={...e};e.status=t,k(e);try{let s;switch(c){case"start":s=await S(o);break;case"pause":s=await ne(o);break;case"resume":s=await oe(o);break;case"complete":s=await se(o);break;case"block":return e.status=o.status,k(o),K(o);case"unblock_to_inprogress":s=await ae(o),s.status==="To Do"&&(s=await S(s));break;case"revise":s=await te(o);break;default:throw new Error("Unsupported transition")}k(s)}catch{k(o)}};return O(async()=>{try{const e=localStorage.getItem("displayCurrency");e&&(H.value=e),await X()}catch(e){console.warn("Currency initialization failed in Workspace/Index.vue:",e)}}),(e,t)=>(u(),m(G,null,[p(j(z),{title:"My Workspace"}),p(ee,null,{header:x(()=>[n("div",de,[n("div",me,[n("button",{type:"button",class:"px-3 py-1.5 rounded-md border text-sm transition border-gray-300 text-gray-700 hover:bg-gray-50 data-[active=true]:bg-indigo-600 data-[active=true]:text-white data-[active=true]:border-indigo-600","data-active":i.value?"true":"false",onClick:t[0]||(t[0]=a=>i.value=!i.value)}," Kanban ",8,pe),t[5]||(t[5]=n("h2",{class:"font-semibold text-xl text-gray-800 leading-tight"},"Workspace",-1))])])]),default:x(()=>[n("div",ve,[n("div",{class:J(i.value?"max-w-none w-full px-4 sm:px-6 lg:px-8":"max-w-7xl mx-auto sm:px-6 lg:px-8")},[n("div",ke,[i.value?P("",!0):(u(),L(ie,{key:0,"onUpdate:filter":t[1]||(t[1]=a=>d.value=a),"active-filter":d.value,search:b.value,"onUpdate:search":t[2]||(t[2]=a=>b.value=a),"pending-filter":_.value,"onUpdate:pending":t[3]||(t[3]=a=>_.value=a)},null,8,["active-filter","search","pending-filter"]))]),i.value?(u(),m("div",ye,[n("div",be,[t[6]||(t[6]=n("h3",{class:"text-lg font-semibold text-gray-800"},"My Tasks (Kanban)",-1)),v.value?(u(),m("span",_e,"Loading...")):g.value?(u(),m("span",we,T(g.value),1)):P("",!0)]),p(ue,{columns:U,"items-by-column":W.value,loading:v.value,onDrop:V},{item:x(({item:a,columnKey:c})=>{var o,s;return[n("div",{class:"p-3 rounded-md bg-white border border-gray-200 shadow-sm cursor-move",draggable:"true",onDragstart:I=>I.dataTransfer.setData("text/plain",JSON.stringify(a)),onClick:Y(I=>{var D;return j(q)(a.id,(D=a.milestone)==null?void 0:D.project_id)},["stop"]),title:(o=a.milestone)!=null&&o.name?`${a.name} â€” ${a.milestone.name}`:a.name},[n("div",Pe,T(a.name||a.title||"Task"),1),(s=a.milestone)!=null&&s.name?(u(),m("div",Te,T(a.milestone.name),1)):P("",!0)],40,xe)]}),_:1},8,["items-by-column","loading"]),p(Z,{show:f.value,title:"Block Task","confirm-text":"Block Task",placeholder:"Enter reason for blocking...",onClose:t[4]||(t[4]=a=>f.value=!1),onConfirm:E},null,8,["show"])])):(u(),m("div",ge,[n("div",fe,[p(le,{search:b.value,"active-filter":d.value,"pending-filter":_.value},null,8,["search","active-filter","pending-filter"])]),n("div",he,[p(ce,{"checklist-items":w.value,notes:C.value,onAddChecklistItem:$,onRemoveChecklistItem:M,onUpdateNotes:R},null,8,["checklist-items","notes"])])]))],2)])]),_:1})],64))}};export{Ze as default};
