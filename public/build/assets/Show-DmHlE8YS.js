import{h as ce,S as he,B as Ce,b as Jt,c as Zt,R as Xt,d as Qt,e as es,_ as ts}from"./AuthenticatedLayout-Bt2eLvLv.js";import{r as k,B as fe,i as r,o,b as e,F as J,j as ee,g as E,t as h,m as B,am as je,e as p,an as et,a as N,A as ne,c as X,ao as mt,L as vt,p as Q,D as xe,T as Ge,ap as se,H as ss,P as Oe,aq as as,d as we,z as ke,w as re,s as P,f as me,k as be,v as Ye,h as K,G as ls,_ as Ee,al as is,l as tt,ar as pt,Y as st,ab as ns,a5 as Ue,u as os,M as rs,aj as ds,ah as us,y as cs,ag as ms}from"./app-BxyvjcMt.js";import{c as ge,a as Ie,d as We,f as Ve,b as vs,_ as ps}from"./ProjectForm-BUj_fr4m.js";import{a as ye,_ as $e}from"./SecondaryButton-Ck7xNdrL.js";import{P as ue}from"./PrimaryButton-OnMWxl5W.js";import{a as bt,_ as _t}from"./StandupModal-CwvNhibN.js";import{_ as q}from"./InputLabel-w7_UPhib.js";import{_ as oe,a as ae}from"./InputError-fqt0aoVm.js";import{_ as wt}from"./EmailEditor-jFMgKYEg.js";import"./ApplicationLogo-B9dwRTmC.js";import"./Checkbox-CHqDhqT3.js";import"./ProjectTypeInput-DfGKkYtv.js";const hs={class:"bg-white p-6 rounded-xl shadow-md hover:shadow-lg transition-shadow mb-6"},gs={key:0,class:"text-sm text-gray-500"},ys={key:1,class:"text-sm text-gray-500"},fs={key:2,class:"space-y-3"},bs={class:"flex justify-between items-start"},_s={class:"font-medium text-gray-900"},ws={class:"text-sm text-gray-600"},xs={key:0,class:"text-sm text-gray-600 mt-1"},ks={class:"flex space-x-2"},Ds=["href"],Cs=["href"],Es=["onClick"],Ts={__name:"ProjectMeetingsList",props:{projectId:{type:Number,required:!0}},setup(s,{expose:t}){const a=s,n=k([]),i=k(!1),l=k(""),c=()=>{try{l.value=Intl.DateTimeFormat().resolvedOptions().timeZone}catch(y){console.error("Error detecting user timezone:",y),l.value="UTC"}},u=(y,w=null,C=!1)=>{if(!y)return"";try{if(C||y.endsWith("Z")){if(w&&w===l.value){const T={dateStyle:"medium",timeStyle:"short"};return new Date(y).toLocaleString(void 0,T)}const D={dateStyle:"medium",timeStyle:"short",timeZone:w||l.value};return new Date(y).toLocaleString(void 0,D)}else{if(w&&w===l.value){const T={dateStyle:"medium",timeStyle:"short"};return new Date(y).toLocaleString(void 0,T)}const D={dateStyle:"medium",timeStyle:"short",timeZone:w||l.value};return new Date(y).toLocaleString(void 0,D)}}catch(D){return console.error("Error formatting meeting time:",D),new Date(y).toLocaleString()}},m=(y,w=null,C=!1)=>{if(!y)return"";try{if(C||y.endsWith("Z")){if(w&&w===l.value){const T={timeStyle:"short"};return new Date(y).toLocaleTimeString(void 0,T)}const D={timeStyle:"short",timeZone:w||l.value};return new Date(y).toLocaleTimeString(void 0,D)}else{if(w&&w===l.value){const T={timeStyle:"short"};return new Date(y).toLocaleTimeString(void 0,T)}const D={timeStyle:"short",timeZone:w||l.value};return new Date(y).toLocaleTimeString(void 0,D)}}catch(D){return console.error("Error formatting meeting time (time only):",D),new Date(y).toLocaleTimeString()}},d=async()=>{i.value=!0;try{const y=await window.axios.get(`/api/projects/${a.projectId}/meetings`);n.value=y.data}catch(y){console.error("Error fetching project meetings:",y)}finally{i.value=!1}},v=async y=>{if(confirm("Are you sure you want to delete this meeting?"))try{await window.axios.delete(`/api/projects/${a.projectId}/meetings/${y}`),await d()}catch(w){console.error("Error deleting meeting:",w),alert("Failed to delete meeting. Please try again.")}};return t({fetchMeetings:d}),fe(()=>{c(),d()}),(y,w)=>(o(),r("div",hs,[w[4]||(w[4]=e("h4",{class:"text-md font-semibold text-gray-900 mb-2"},"Upcoming Meetings",-1)),i.value?(o(),r("div",gs," Loading meetings... ")):n.value.length===0?(o(),r("div",ys," No upcoming meetings scheduled. ")):(o(),r("div",fs,[(o(!0),r(J,null,ee(n.value,C=>(o(),r("div",{key:C.id,class:"p-3 bg-gray-50 rounded-lg border border-gray-200 hover:bg-gray-100 transition-colors"},[e("div",bs,[e("div",null,[e("h5",_s,h(C.summary),1),e("p",ws,h(u(C.start_time,C.timezone,C.is_utc))+" - "+h(m(C.end_time,C.timezone,C.is_utc)),1),C.location?(o(),r("p",xs,[w[0]||(w[0]=e("span",{class:"font-medium"},"Location:",-1)),B(" "+h(C.location),1)])):E("",!0)]),e("div",ks,[e("a",{href:C.google_event_link,target:"_blank",class:"text-blue-600 hover:text-blue-800",title:"View in Google Calendar"},w[1]||(w[1]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)]),8,Ds),C.google_meet_link?(o(),r("a",{key:0,href:C.google_meet_link,target:"_blank",class:"text-green-600 hover:text-green-800",title:"Join Google Meet"},w[2]||(w[2]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})],-1)]),8,Cs)):E("",!0),e("button",{onClick:D=>v(C.google_event_id),class:"text-red-600 hover:text-red-800",title:"Delete Meeting"},w[3]||(w[3]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)]),8,Es)])])]))),128))]))]))}};var $s=Object.defineProperty,Ss=(s,t,a)=>t in s?$s(s,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[t]=a,Te=(s,t,a)=>Ss(s,typeof t!="symbol"?t+"":t,a);const Ms=(s,t,a)=>{const n=s[t];return n?typeof n=="function"?n():Promise.resolve(n):new Promise((i,l)=>{(typeof queueMicrotask=="function"?queueMicrotask:setTimeout)(l.bind(null,new Error("Unknown variable dynamic import: "+t+(t.split("/").length!==a?". Note that variables only represent file names one level deep.":""))))})};let Fe,ht,gt,_e,Be={},Ae={};class js{constructor(t,a=!1){Te(this,"texts",{}),Te(this,"dateToMinutes",n=>n.getHours()*60+n.getMinutes()),_e=this,this._texts=t,!a&&Date&&!Date.prototype.addDays&&this._initDatePrototypes()}_initDatePrototypes(){Date.prototype.addDays=function(t){return _e.addDays(this,t)},Date.prototype.subtractDays=function(t){return _e.subtractDays(this,t)},Date.prototype.addHours=function(t){return _e.addHours(this,t)},Date.prototype.subtractHours=function(t){return _e.subtractHours(this,t)},Date.prototype.addMinutes=function(t){return _e.addMinutes(this,t)},Date.prototype.subtractMinutes=function(t){return _e.subtractMinutes(this,t)},Date.prototype.getWeek=function(){return _e.getWeek(this)},Date.prototype.isToday=function(){return _e.isToday(this)},Date.prototype.isLeapYear=function(){return _e.isLeapYear(this)},Date.prototype.format=function(t="YYYY-MM-DD"){return _e.formatDate(this,t)},Date.prototype.formatTime=function(t="HH:mm"){return _e.formatTime(this,t)}}removePrototypes(){delete Date.prototype.addDays,delete Date.prototype.subtractDays,delete Date.prototype.addHours,delete Date.prototype.subtractHours,delete Date.prototype.addMinutes,delete Date.prototype.subtractMinutes,delete Date.prototype.getWeek,delete Date.prototype.isToday,delete Date.prototype.isLeapYear,delete Date.prototype.format,delete Date.prototype.formatTime}updateTexts(t){this._texts=t}_todayFormatted(){return ht!==new Date().getDate()&&(Fe=new Date,ht=Fe.getDate(),gt=`${Fe.getFullYear()}-${Fe.getMonth()}-${Fe.getDate()}`),gt}addDays(t,a){const n=new Date(t.valueOf());return n.setDate(n.getDate()+a),n}subtractDays(t,a){const n=new Date(t.valueOf());return n.setDate(n.getDate()-a),n}addHours(t,a){const n=new Date(t.valueOf());return n.setHours(n.getHours()+a),n}subtractHours(t,a){const n=new Date(t.valueOf());return n.setHours(n.getHours()-a),n}addMinutes(t,a){const n=new Date(t.valueOf());return n.setMinutes(n.getMinutes()+a),n}subtractMinutes(t,a){const n=new Date(t.valueOf());return n.setMinutes(n.getMinutes()-a),n}getWeek(t){const a=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate())),n=a.getUTCDay()||7;a.setUTCDate(a.getUTCDate()+4-n);const i=new Date(Date.UTC(a.getUTCFullYear(),0,1));return Math.ceil(((a-i)/864e5+1)/7)}isToday(t){return`${t.getFullYear()}-${t.getMonth()}-${t.getDate()}`===this._todayFormatted()}isLeapYear(t){const a=t.getFullYear();return!(a%400)||a%100&&!(a%4)}getPreviousFirstDayOfWeek(t=null,a){const n=t&&new Date(t.valueOf())||new Date,i=a?7:6;return n.setDate(n.getDate()-(n.getDay()+i)%7),n}stringToDate(t){return t instanceof Date?t:(t.length===10&&(t+=" 00:00"),new Date(t.replace(/-/g,"/")))}countDays(t,a){typeof t=="string"&&(t=t.replace(/-/g,"/")),typeof a=="string"&&(a=a.replace(/-/g,"/")),t=new Date(t).setHours(0,0,0,0),a=new Date(a).setHours(0,0,1,0);const n=(new Date(a).getTimezoneOffset()-new Date(t).getTimezoneOffset())*60*1e3;return Math.ceil((a-t-n)/(24*3600*1e3))}datesInSameTimeStep(t,a,n){return Math.abs(t.getTime()-a.getTime())<=n*60*1e3}formatDate(t,a="YYYY-MM-DD",n=null){if(n||(n=this._texts),a||(a="YYYY-MM-DD"),a==="YYYY-MM-DD")return this.formatDateLite(t);Be={},Ae={};const i={YYYY:()=>this._hydrateDateObject(t,n).YYYY,YY:()=>this._hydrateDateObject(t,n).YY(),M:()=>this._hydrateDateObject(t,n).M,MM:()=>this._hydrateDateObject(t,n).MM(),MMM:()=>this._hydrateDateObject(t,n).MMM(),MMMM:()=>this._hydrateDateObject(t,n).MMMM(),MMMMG:()=>this._hydrateDateObject(t,n).MMMMG(),D:()=>this._hydrateDateObject(t,n).D,DD:()=>this._hydrateDateObject(t,n).DD(),S:()=>this._hydrateDateObject(t,n).S(),d:()=>this._hydrateDateObject(t,n).d,dd:()=>this._hydrateDateObject(t,n).dd(),ddd:()=>this._hydrateDateObject(t,n).ddd(),dddd:()=>this._hydrateDateObject(t,n).dddd(),HH:()=>this._hydrateTimeObject(t,n).HH,H:()=>this._hydrateTimeObject(t,n).H,hh:()=>this._hydrateTimeObject(t,n).hh,h:()=>this._hydrateTimeObject(t,n).h,am:()=>this._hydrateTimeObject(t,n).am,AM:()=>this._hydrateTimeObject(t,n).AM,mm:()=>this._hydrateTimeObject(t,n).mm,m:()=>this._hydrateTimeObject(t,n).m};return a.replace(/(\{[a-zA-Z]+\}|[a-zA-Z]+)/g,(l,c)=>{const u=i[c.replace(/\{|\}/g,"")];return u!==void 0?u():c})}formatDateLite(t){const a=t.getMonth()+1,n=t.getDate();return`${t.getFullYear()}-${a<10?"0":""}${a}-${n<10?"0":""}${n}`}formatTime(t,a="HH:mm",n=null,i=!1){let l=!1;if(i){const[m,d,v]=[t.getHours(),t.getMinutes(),t.getSeconds()];m+d+v===141&&(l=!0)}if(t instanceof Date&&a==="HH:mm")return l?"24:00":this.formatTimeLite(t);Ae={},n||(n=this._texts);const c=this._hydrateTimeObject(t,n),u=a.replace(/(\{[a-zA-Z]+\}|[a-zA-Z]+)/g,(m,d)=>{const v=c[d.replace(/\{|\}/g,"")];return v!==void 0?v:d});return l?u.replace("23:59","24:00"):u}formatTimeLite(t){const a=t.getHours(),n=t.getMinutes();return`${(a<10?"0":"")+a}:${(n<10?"0":"")+n}`}_nth(t){if(t>3&&t<21)return"th";switch(t%10){case 1:return"st";case 2:return"nd";case 3:return"rd";default:return"th"}}_hydrateDateObject(t,a){if(Be.D)return Be;const n=t.getFullYear(),i=t.getMonth()+1,l=t.getDate(),u=(t.getDay()-1+7)%7;return Be={YYYY:n,YY:()=>n.toString().substring(2),M:i,MM:()=>(i<10?"0":"")+i,MMM:()=>a.months[i-1].substring(0,3),MMMM:()=>a.months[i-1],MMMMG:()=>(a.monthsGenitive||a.months)[i-1],D:l,DD:()=>(l<10?"0":"")+l,S:()=>this._nth(l),d:u+1,dd:()=>a.weekDays[u][0],ddd:()=>a.weekDays[u].substr(0,3),dddd:()=>a.weekDays[u]},Be}_hydrateTimeObject(t,a){if(Ae.am)return Ae;let n,i;t instanceof Date?(n=t.getHours(),i=t.getMinutes()):(n=Math.floor(t/60),i=Math.floor(t%60));const l=n%12?n%12:12,c=(a||{am:"am",pm:"pm"})[n===24||n<12?"am":"pm"];return Ae={H:n,h:l,HH:(n<10?"0":"")+n,hh:(l<10?"0":"")+l,am:c,AM:c.toUpperCase(),m:i,mm:(i<10?"0":"")+i},Ae}}const Vs=1440;class As{constructor(t){Te(this,"_vuecal",null),Te(this,"selectCell",(a=!1,n,i)=>{this._vuecal.$emit("cell-click",i?{date:n,split:i}:n),this._vuecal.clickToNavigate||a?this._vuecal.switchToNarrowerView():this._vuecal.dblclickToNavigate&&"ontouchstart"in window&&(this._vuecal.domEvents.dblTapACell.taps++,setTimeout(()=>this._vuecal.domEvents.dblTapACell.taps=0,this._vuecal.domEvents.dblTapACell.timeout),this._vuecal.domEvents.dblTapACell.taps>=2&&(this._vuecal.domEvents.dblTapACell.taps=0,this._vuecal.switchToNarrowerView(),this._vuecal.$emit("cell-dblclick",i?{date:n,split:i}:n)))}),Te(this,"keyPressEnterCell",(a,n)=>{this._vuecal.$emit("cell-keypress-enter",n?{date:a,split:n}:a),this._vuecal.switchToNarrowerView()}),Te(this,"getPosition",a=>{const{left:n,top:i}=this._vuecal.cellsEl.getBoundingClientRect(),{clientX:l,clientY:c}="ontouchstart"in window&&a.touches?a.touches[0]:a;return{x:l-n,y:c-i}}),Te(this,"minutesAtCursor",a=>{let n=0,i={x:0,y:0};const{timeStep:l,timeCellHeight:c,timeFrom:u}=this._vuecal.$props;return typeof a=="number"?n=a:typeof a=="object"&&(i=this.getPosition(a),n=Math.round(i.y*l/parseInt(c)+u)),{minutes:Math.max(Math.min(n,Vs),0),cursorCoords:i}}),this._vuecal=t}}const Is=2,Xe=1440;let ve,pe,Qe;class Os{constructor(t,a){Te(this,"_vuecal",null),Te(this,"eventDefaults",{_eid:null,start:"",startTimeMinutes:0,end:"",endTimeMinutes:0,title:"",content:"",background:!1,allDay:!1,segments:null,repeat:null,daysCount:1,deletable:!0,deleting:!1,titleEditable:!0,resizable:!0,resizing:!1,draggable:!0,dragging:!1,draggingStatic:!1,focused:!1,class:""}),this._vuecal=t,ve=a}createAnEvent(t,a,n){if(typeof t=="string"&&(t=ve.stringToDate(t)),!(t instanceof Date))return!1;const i=ve.dateToMinutes(t);a=a*1||Is*60;const l=i+a,c=ve.addMinutes(new Date(t),a);n.end&&(typeof n.end=="string"&&(n.end=ve.stringToDate(n.end)),n.endTimeMinutes=ve.dateToMinutes(n.end));const u={...this.eventDefaults,_eid:`${this._vuecal._.uid}_${this._vuecal.eventIdIncrement++}`,start:t,startTimeMinutes:i,end:c,endTimeMinutes:l,segments:null,...n};if(!(typeof this._vuecal.onEventCreate=="function"&&!this._vuecal.onEventCreate(u,()=>this.deleteAnEvent(u))))return u.startDateF!==u.endDateF&&(u.daysCount=ve.countDays(u.start,u.end)),this._vuecal.mutableEvents.push(u),this._vuecal.addEventsToView([u]),this._vuecal.emitWithEvent("event-create",u),this._vuecal.$emit("event-change",{event:this._vuecal.cleanupEvent(u),originalEvent:null}),u}addEventSegment(t){t.segments||(t.segments={},t.segments[ve.formatDateLite(t.start)]={start:t.start,startTimeMinutes:t.startTimeMinutes,endTimeMinutes:Xe,isFirstDay:!0,isLastDay:!1});const a=t.segments[ve.formatDateLite(t.end)];a&&(a.isLastDay=!1,a.endTimeMinutes=Xe);const n=ve.addDays(t.end,1),i=ve.formatDateLite(n);return n.setHours(0,0,0,0),t.segments[i]={start:n,startTimeMinutes:0,endTimeMinutes:t.endTimeMinutes,isFirstDay:!1,isLastDay:!0},t.end=ve.addMinutes(n,t.endTimeMinutes),t.daysCount=Object.keys(t.segments).length,i}removeEventSegment(t){let a=Object.keys(t.segments).length;if(a<=1)return ve.formatDateLite(t.end);delete t.segments[ve.formatDateLite(t.end)],a--;const n=ve.subtractDays(t.end,1),i=ve.formatDateLite(n),l=t.segments[i];return a?l&&(l.isLastDay=!0,l.endTimeMinutes=t.endTimeMinutes):t.segments=null,t.daysCount=a||1,t.end=n,i}createEventSegments(t,a,n){const i=a.getTime(),l=n.getTime();let c=t.start.getTime(),u=t.end.getTime(),m=!1,d,v,y;for(!t.end.getHours()&&!t.end.getMinutes()&&(u-=1e3),t.segments={},t.repeat?(d=i,v=Math.min(l,t.repeat.until?ve.stringToDate(t.repeat.until).getTime():l)):(d=Math.max(i,c),v=Math.min(l,u));d<=v;){let w=!1;const C=ve.addDays(new Date(d),1).setHours(0,0,0,0);let D,T,g,f;if(t.repeat){const S=new Date(d),V=ve.formatDateLite(S);(m||t.occurrences&&t.occurrences[V])&&(m||(c=t.occurrences[V].start,y=new Date(c).setHours(0,0,0,0),u=t.occurrences[V].end),m=!0,w=!0),D=d===y,T=V===ve.formatDateLite(new Date(u)),g=new Date(D?c:d),f=ve.formatDateLite(g),T&&(m=!1)}else w=!0,D=d===c,T=v===u&&C>v,g=D?t.start:new Date(d),f=ve.formatDateLite(D?t.start:g);w&&(t.segments[f]={start:g,startTimeMinutes:D?t.startTimeMinutes:0,endTimeMinutes:T?t.endTimeMinutes:Xe,isFirstDay:D,isLastDay:T}),d=C}return t}deleteAnEvent(t){this._vuecal.emitWithEvent("event-delete",t),this._vuecal.mutableEvents=this._vuecal.mutableEvents.filter(a=>a._eid!==t._eid),this._vuecal.view.events=this._vuecal.view.events.filter(a=>a._eid!==t._eid)}checkCellOverlappingEvents(t,a){Qe=t.slice(0),pe={},t.forEach(i=>{Qe.shift(),pe[i._eid]||(pe[i._eid]={overlaps:[],start:i.start,position:0}),pe[i._eid].position=0,Qe.forEach(l=>{pe[l._eid]||(pe[l._eid]={overlaps:[],start:l.start,position:0});const c=this.eventInRange(l,i.start,i.end),u=a.overlapsPerTimeStep?ve.datesInSameTimeStep(i.start,l.start,a.timeStep):1;if(!i.background&&!i.allDay&&!l.background&&!l.allDay&&c&&u)pe[i._eid].overlaps.push(l._eid),pe[i._eid].overlaps=[...new Set(pe[i._eid].overlaps)],pe[l._eid].overlaps.push(i._eid),pe[l._eid].overlaps=[...new Set(pe[l._eid].overlaps)],pe[l._eid].position++;else{let m,d;(m=(pe[i._eid]||{overlaps:[]}).overlaps.indexOf(l._eid))>-1&&pe[i._eid].overlaps.splice(m,1),(d=(pe[l._eid]||{overlaps:[]}).overlaps.indexOf(i._eid))>-1&&pe[l._eid].overlaps.splice(d,1),pe[l._eid].position--}})});let n=0;for(const i in pe){const l=pe[i],c=l.overlaps.map(u=>({id:u,start:pe[u].start}));c.push({id:i,start:l.start}),c.sort((u,m)=>u.start<m.start?-1:u.start>m.start?1:u.id>m.id?-1:1),l.position=c.findIndex(u=>u.id===i),n=Math.max(this.getOverlapsStreak(l,pe),n)}return[pe,n]}getOverlapsStreak(t,a={}){let n=t.overlaps.length+1,i=[];return t.overlaps.forEach(l=>{i.includes(l)||t.overlaps.filter(u=>u!==l).forEach(u=>{a[u].overlaps.includes(l)||i.push(u)})}),i=[...new Set(i)],n-=i.length,n}eventInRange(t,a,n){if(t.allDay||!this._vuecal.time){const c=new Date(t.start).setHours(0,0,0,0);return new Date(t.end).setHours(23,59,0,0)>=new Date(a).setHours(0,0,0,0)&&c<=new Date(n).setHours(0,0,0,0)}const i=t.start.getTime(),l=t.end.getTime();return i<n.getTime()&&l>a.getTime()}}const Ls={class:"vuecal__flex vuecal__weekdays-headings"},Us=["onClick"],Ns={class:"vuecal__flex weekday-label",grow:""},Ps={class:"full"},Rs={class:"small"},Fs={class:"xsmall"},Bs={key:0},Hs={key:0,class:"vuecal__flex vuecal__split-days-headers",grow:""};function Ws(s,t,a,n,i,l){return o(),r("div",Ls,[(o(!0),r(J,null,ee(l.headings,(c,u)=>(o(),r(J,{key:u},[c.hide?E("",!0):(o(),r("div",{key:0,class:Q(["vuecal__flex vuecal__heading",{today:c.today,clickable:l.cellHeadingsClickable}]),style:xe(l.weekdayCellStyles),onClick:m=>l.view.id==="week"&&l.selectCell(c.date,m),onDblclick:t[0]||(t[0]=m=>l.view.id==="week"&&l.vuecal.dblclickToNavigate&&a.switchToNarrowerView())},[p(Ge,{name:`slide-fade--${a.transitionDirection}`,appear:l.vuecal.transitions},{default:N(()=>[(o(),r("div",{class:"vuecal__flex",column:"",key:l.vuecal.transitions?`${u}-${c.dayOfMonth}`:!1},[e("div",Ns,[ne(s.$slots,"weekday-heading",{heading:l.cleanupHeading(c),view:l.view},()=>[e("span",Ps,h(c.full),1),e("span",Rs,h(c.small),1),e("span",Fs,h(c.xsmall),1),c.dayOfMonth?(o(),r("span",Bs," "+h(c.dayOfMonth),1)):E("",!0)])]),l.vuecal.hasSplits&&l.vuecal.stickySplitLabels?(o(),r("div",Hs,[(o(!0),r(J,null,ee(l.vuecal.daySplits,(m,d)=>(o(),r("div",{class:Q(["day-split-header",m.class||!1]),key:d},[ne(s.$slots,"split-label",{split:m,view:l.view},()=>[B(h(m.label),1)])],2))),128))])):E("",!0)]))]),_:2},1032,["name","appear"])],46,Us))],64))),128))])}const Ne=(s,t)=>{const a=s.__vccOpts||s;for(const[n,i]of t)a[n]=i;return a},Ys={inject:["vuecal","utils","view"],props:{transitionDirection:{type:String,default:"right"},weekDays:{type:Array,default:()=>[]},switchToNarrowerView:{type:Function,default:()=>{}}},methods:{selectCell(s,t){s.getTime()!==this.view.selectedDate.getTime()&&(this.view.selectedDate=s),this.utils.cell.selectCell(!1,s,t)},cleanupHeading:s=>({label:s.full,date:s.date,...s.today?{today:s.today}:{}})},computed:{headings(){if(!["month","week"].includes(this.view.id))return[];let s=!1;return this.weekDays.map((a,n)=>{const i=this.utils.date.addDays(this.view.startDate,this.vuecal.startWeekOnSunday&&this.vuecal.hideWeekends?n-1:n);return{hide:a.hide,full:a.label,small:a.short||a.label.substr(0,3),xsmall:a.short||a.label.substr(0,1),...this.view.id==="week"?{dayOfMonth:i.getDate(),date:i,today:!s&&this.utils.date.isToday(i)&&!s++}:{}}})},cellWidth(){return 100/(7-this.weekDays.reduce((s,t)=>s+t.hide,0))},weekdayCellStyles(){return{...this.vuecal.hideWeekdays.length?{width:`${this.cellWidth}%`}:{}}},cellHeadingsClickable(){return this.view.id==="week"&&(this.vuecal.clickToNavigate||this.vuecal.dblclickToNavigate)}}},xt=Ne(Ys,[["render",Ws]]),zs={class:"vuecal__header"},qs={key:0,class:"vuecal__flex vuecal__menu",role:"tablist","aria-label":"Calendar views navigation"},Gs=["onDragenter","onDragleave","onClick","aria-label"],Ks={key:1,class:"vuecal__title-bar"},Js=["aria-label"],Zs={class:"vuecal__flex vuecal__title",grow:""},Xs=["aria-label"],Qs={key:0,class:"vuecal__flex vuecal__split-days-headers"};function ea(s,t,a,n,i,l){const c=je("weekdays-headings");return o(),r("div",zs,[a.options.hideViewSelector?E("",!0):(o(),r("div",qs,[(o(!0),r(J,null,ee(a.viewProps.views,(u,m)=>(o(),r(J,{key:m},[u.enabled?(o(),r("button",{key:0,class:Q(["vuecal__view-btn",{"vuecal__view-btn--active":l.view.id===m,"vuecal__view-btn--highlighted":s.highlightedControl===m}]),type:"button",onDragenter:d=>a.editEvents.drag&&l.dnd&&l.dnd.viewSelectorDragEnter(d,m,s.$data),onDragleave:d=>a.editEvents.drag&&l.dnd&&l.dnd.viewSelectorDragLeave(d,m,s.$data),onClick:d=>l.switchView(m,null,!0),"aria-label":`${u.label} view`},h(u.label),43,Gs)):E("",!0)],64))),128))])),a.options.hideTitleBar?E("",!0):(o(),r("div",Ks,[e("button",{class:Q(["vuecal__arrow vuecal__arrow--prev",{"vuecal__arrow--highlighted":s.highlightedControl==="previous"}]),type:"button",onClick:t[0]||(t[0]=(...u)=>l.previous&&l.previous(...u)),onDragenter:t[1]||(t[1]=u=>a.editEvents.drag&&l.dnd&&l.dnd.viewSelectorDragEnter(u,"previous",s.$data)),onDragleave:t[2]||(t[2]=u=>a.editEvents.drag&&l.dnd&&l.dnd.viewSelectorDragLeave(u,"previous",s.$data)),"aria-label":`Previous ${l.view.id}`},[ne(s.$slots,"arrow-prev")],42,Js),e("div",Zs,[p(Ge,{name:a.options.transitions?`slide-fade--${l.transitionDirection}`:""},{default:N(()=>[(o(),X(ss(l.broaderView?"button":"span"),{type:!!l.broaderView&&"button",key:`${l.view.id}${l.view.startDate.toString()}`,onClick:t[3]||(t[3]=u=>!!l.broaderView&&l.switchToBroaderView()),"aria-label":!!l.broaderView&&`Go to ${l.broaderView} view`},{default:N(()=>[ne(s.$slots,"title")]),_:3},8,["type","aria-label"]))]),_:3},8,["name"])]),a.options.todayButton?(o(),r("button",{key:0,class:Q(["vuecal__today-btn",{"vuecal__today-btn--highlighted":s.highlightedControl==="today"}]),type:"button",onClick:t[4]||(t[4]=(...u)=>l.goToToday&&l.goToToday(...u)),onDragenter:t[5]||(t[5]=u=>a.editEvents.drag&&l.dnd&&l.dnd.viewSelectorDragEnter(u,"today",s.$data)),onDragleave:t[6]||(t[6]=u=>a.editEvents.drag&&l.dnd&&l.dnd.viewSelectorDragLeave(u,"today",s.$data)),"aria-label":"Today"},[ne(s.$slots,"today-button")],34)):E("",!0),e("button",{class:Q(["vuecal__arrow vuecal__arrow--next",{"vuecal__arrow--highlighted":s.highlightedControl==="next"}]),type:"button",onClick:t[7]||(t[7]=(...u)=>l.next&&l.next(...u)),onDragenter:t[8]||(t[8]=u=>a.editEvents.drag&&l.dnd&&l.dnd.viewSelectorDragEnter(u,"next",s.$data)),onDragleave:t[9]||(t[9]=u=>a.editEvents.drag&&l.dnd&&l.dnd.viewSelectorDragLeave(u,"next",s.$data)),"aria-label":`Next ${l.view.id}`},[ne(s.$slots,"arrow-next")],42,Xs)])),a.viewProps.weekDaysInHeader?(o(),X(c,{key:2,"week-days":a.weekDays,"transition-direction":l.transitionDirection,"switch-to-narrower-view":a.switchToNarrowerView},et({_:2},[s.$slots["weekday-heading"]?{name:"weekday-heading",fn:N(({heading:u,view:m})=>[ne(s.$slots,"weekday-heading",{heading:u,view:m})]),key:"0"}:void 0,s.$slots["split-label"]?{name:"split-label",fn:N(({split:u})=>[ne(s.$slots,"split-label",{split:u,view:l.view})]),key:"1"}:void 0]),1032,["week-days","transition-direction","switch-to-narrower-view"])):E("",!0),p(Ge,{name:`slide-fade--${l.transitionDirection}`},{default:N(()=>[l.showDaySplits?(o(),r("div",Qs,[(o(!0),r(J,null,ee(a.daySplits,(u,m)=>(o(),r("div",{class:Q(["day-split-header",u.class||!1]),key:m},[ne(s.$slots,"split-label",{split:u,view:l.view.id},()=>[B(h(u.label),1)])],2))),128))])):E("",!0)]),_:3},8,["name"])])}const ta={inject:["vuecal","previous","next","switchView","updateSelectedDate","modules","view"],components:{WeekdaysHeadings:xt},props:{options:{type:Object,default:()=>({})},editEvents:{type:Object,required:!0},hasSplits:{type:[Boolean,Number],default:!1},daySplits:{type:Array,default:()=>[]},viewProps:{type:Object,default:()=>({})},weekDays:{type:Array,default:()=>[]},switchToNarrowerView:{type:Function,default:()=>{}}},data:()=>({highlightedControl:null}),methods:{goToToday(){this.updateSelectedDate(new Date(new Date().setHours(0,0,0,0)))},switchToBroaderView(){this.transitionDirection="left",this.broaderView&&this.switchView(this.broaderView)}},computed:{transitionDirection:{get(){return this.vuecal.transitionDirection},set(s){this.vuecal.transitionDirection=s}},broaderView(){const{enabledViews:s}=this.vuecal;return s[s.indexOf(this.view.id)-1]},showDaySplits(){return this.view.id==="day"&&this.hasSplits&&this.options.stickySplitLabels&&!this.options.minSplitWidth},dnd(){return this.modules.dnd}}},sa=Ne(ta,[["render",ea]]),aa=["draggable"];function la(s,t,a,n,i,l){return o(),r("div",{class:Q(["vuecal__event",l.eventClasses]),style:xe(l.eventStyles),tabindex:"0",onFocus:t[4]||(t[4]=(...c)=>l.focusEvent&&l.focusEvent(...c)),onKeypress:t[5]||(t[5]=Oe(we((...c)=>l.onEnterKeypress&&l.onEnterKeypress(...c),["stop"]),["enter"])),onMouseenter:t[6]||(t[6]=(...c)=>l.onMouseEnter&&l.onMouseEnter(...c)),onMouseleave:t[7]||(t[7]=(...c)=>l.onMouseLeave&&l.onMouseLeave(...c)),onTouchstart:t[8]||(t[8]=we((...c)=>l.onTouchStart&&l.onTouchStart(...c),["stop"])),onMousedown:t[9]||(t[9]=c=>l.onMouseDown(c)),onMouseup:t[10]||(t[10]=(...c)=>l.onMouseUp&&l.onMouseUp(...c)),onTouchend:t[11]||(t[11]=(...c)=>l.onMouseUp&&l.onMouseUp(...c)),onTouchmove:t[12]||(t[12]=(...c)=>l.onTouchMove&&l.onTouchMove(...c)),onDblclick:t[13]||(t[13]=(...c)=>l.onDblClick&&l.onDblClick(...c)),draggable:l.draggable,onDragstart:t[14]||(t[14]=c=>l.draggable&&l.onDragStart(c)),onDragend:t[15]||(t[15]=c=>l.draggable&&l.onDragEnd())},[l.vuecal.editEvents.delete&&a.event.deletable?(o(),r("div",{key:0,class:"vuecal__event-delete",onClick:t[0]||(t[0]=we((...c)=>l.deleteEvent&&l.deleteEvent(...c),["stop"])),onTouchstart:t[1]||(t[1]=we((...c)=>l.touchDeleteEvent&&l.touchDeleteEvent(...c),["stop"]))},h(l.vuecal.texts.deleteEvent),33)):E("",!0),ne(s.$slots,"event",{event:a.event,view:l.view.id}),l.resizable?(o(),r("div",{key:1,class:"vuecal__event-resize-handle",contenteditable:"false",onMousedown:t[2]||(t[2]=we((...c)=>l.onResizeHandleMouseDown&&l.onResizeHandleMouseDown(...c),["stop","prevent"])),onTouchstart:t[3]||(t[3]=we((...c)=>l.onResizeHandleMouseDown&&l.onResizeHandleMouseDown(...c),["stop","prevent"]))},null,32)):E("",!0)],46,aa)}const ia={inject:["vuecal","utils","modules","view","domEvents","editEvents"],props:{cellFormattedDate:{type:String,default:""},event:{type:Object,default:()=>({})},cellEvents:{type:Array,default:()=>[]},overlaps:{type:Array,default:()=>[]},eventPosition:{type:Number,default:0},overlapsStreak:{type:Number,default:0},allDay:{type:Boolean,default:!1}},data:()=>({touch:{dragThreshold:30,startX:0,startY:0,dragged:!1}}),methods:{onMouseDown(s,t=!1){if("ontouchstart"in window&&!t)return!1;const{clickHoldAnEvent:a,focusAnEvent:n,resizeAnEvent:i,dragAnEvent:l}=this.domEvents;if(n._eid===this.event._eid&&a._eid===this.event._eid)return!0;this.focusEvent(),a._eid=null,this.vuecal.editEvents.delete&&this.event.deletable&&(a.timeoutId=setTimeout(()=>{!i._eid&&!l._eid&&(a._eid=this.event._eid,this.event.deleting=!0)},a.timeout))},onMouseUp(s){this.domEvents.focusAnEvent._eid===this.event._eid&&!this.touch.dragged&&(this.domEvents.focusAnEvent.mousedUp=!0),this.touch.dragged=!1},onMouseEnter(s){s.preventDefault(),this.vuecal.emitWithEvent("event-mouse-enter",this.event)},onMouseLeave(s){s.preventDefault(),this.vuecal.emitWithEvent("event-mouse-leave",this.event)},onTouchMove(s){if(typeof this.vuecal.onEventClick!="function")return;const{clientX:t,clientY:a}=s.touches[0],{startX:n,startY:i,dragThreshold:l}=this.touch;(Math.abs(t-n)>l||Math.abs(a-i)>l)&&(this.touch.dragged=!0)},onTouchStart(s){this.touch.startX=s.touches[0].clientX,this.touch.startY=s.touches[0].clientY,this.onMouseDown(s,!0)},onEnterKeypress(s){if(typeof this.vuecal.onEventClick=="function")return this.vuecal.onEventClick(this.event,s)},onDblClick(s){if(typeof this.vuecal.onEventDblclick=="function")return this.vuecal.onEventDblclick(this.event,s)},onDragStart(s){this.dnd&&this.dnd.eventDragStart(s,this.event)},onDragEnd(){this.dnd&&this.dnd.eventDragEnd(this.event)},onResizeHandleMouseDown(){this.focusEvent(),this.domEvents.dragAnEvent._eid=null,this.domEvents.resizeAnEvent=Object.assign(this.domEvents.resizeAnEvent,{_eid:this.event._eid,start:(this.segment||this.event).start,split:this.event.split||null,segment:!!this.segment&&this.utils.date.formatDateLite(this.segment.start),originalEnd:new Date((this.segment||this.event).end),originalEndTimeMinutes:this.event.endTimeMinutes}),this.event.resizing=!0},deleteEvent(s=!1){if("ontouchstart"in window&&!s)return!1;this.utils.event.deleteAnEvent(this.event)},touchDeleteEvent(s){this.deleteEvent(!0)},cancelDeleteEvent(){this.event.deleting=!1},focusEvent(){const{focusAnEvent:s}=this.domEvents,t=s._eid;if(t!==this.event._eid){if(t){const a=this.view.events.find(n=>n._eid===t);a&&(a.focused=!1)}this.vuecal.cancelDelete(),this.vuecal.emitWithEvent("event-focus",this.event),s._eid=this.event._eid,this.event.focused=!0}}},computed:{eventDimensions(){const{startTimeMinutes:s,endTimeMinutes:t}=this.segment||this.event;let a=s-this.vuecal.timeFrom;const n=Math.max(Math.round(a*this.vuecal.timeCellHeight/this.vuecal.timeStep),0);a=Math.min(t,this.vuecal.timeTo)-this.vuecal.timeFrom;const i=Math.round(a*this.vuecal.timeCellHeight/this.vuecal.timeStep),l=Math.max(i-n,5);return{top:n,height:l}},eventStyles(){if(this.event.allDay||!this.vuecal.time||!this.event.endTimeMinutes||this.view.id==="month"||this.allDay)return{};let s=100/Math.min(this.overlaps.length+1,this.overlapsStreak),t=100/(this.overlaps.length+1)*this.eventPosition;this.vuecal.minEventWidth&&s<this.vuecal.minEventWidth&&(s=this.vuecal.minEventWidth,t=(100-this.vuecal.minEventWidth)/this.overlaps.length*this.eventPosition);const{top:a,height:n}=this.eventDimensions;return{top:`${a}px`,height:`${n}px`,width:`${s}%`,left:this.event.left&&`${this.event.left}px`||`${t}%`}},eventClasses(){const{isFirstDay:s,isLastDay:t}=this.segment||{};return{[this.event.class]:!!this.event.class,"vuecal__event--focus":this.event.focused,"vuecal__event--resizing":this.event.resizing,"vuecal__event--background":this.event.background,"vuecal__event--deletable":this.event.deleting,"vuecal__event--all-day":this.event.allDay,"vuecal__event--dragging":!this.event.draggingStatic&&this.event.dragging,"vuecal__event--static":this.event.dragging&&this.event.draggingStatic,"vuecal__event--multiple-days":!!this.segment,"event-start":this.segment&&s&&!t,"event-middle":this.segment&&!s&&!t,"event-end":this.segment&&t&&!s}},segment(){return this.event.segments&&this.event.segments[this.cellFormattedDate]||null},draggable(){const{draggable:s,background:t,daysCount:a}=this.event;return this.vuecal.editEvents.drag&&s&&!t&&a===1},resizable(){const{editEvents:s,time:t}=this.vuecal;return s.resize&&this.event.resizable&&t&&!this.allDay&&(!this.segment||this.segment&&this.segment.isLastDay)&&this.view.id!=="month"},dnd(){return this.modules.dnd}}},na=Ne(ia,[["render",la]]),oa=["data-split","aria-label","onTouchstart","onMousedown","onDragover","onDrop"],ra={key:0,class:"cell-time-labels"},da=["innerHTML"],ua={key:2,class:"vuecal__cell-events"},ca=["title"];function ma(s,t,a,n,i,l){const c=je("event");return o(),X(as,{class:Q(["vuecal__cell",l.cellClasses]),name:`slide-fade--${l.transitionDirection}`,tag:"div",appear:a.options.transitions,style:xe(l.cellStyles)},{default:N(()=>[(o(!0),r(J,null,ee(l.splitsCount?l.splits:1,(u,m)=>(o(),r("div",{class:Q(["vuecal__flex vuecal__cell-content",l.splitsCount&&l.splitClasses(u)]),key:a.options.transitions?`${l.view.id}-${a.data.content}-${m}`:m,"data-split":l.splitsCount?u.id:!1,column:"",tabindex:"0","aria-label":a.data.content,onFocus:t[0]||(t[0]=d=>l.onCellFocus(d)),onKeypress:t[1]||(t[1]=Oe(d=>l.onCellkeyPressEnter(d),["enter"])),onTouchstart:d=>!l.isDisabled&&l.onCellTouchStart(d,l.splitsCount?u.id:null),onMousedown:d=>!l.isDisabled&&l.onCellMouseDown(d,l.splitsCount?u.id:null),onClick:t[2]||(t[2]=d=>!l.isDisabled&&l.onCellClick(d)),onDblclick:t[3]||(t[3]=d=>!l.isDisabled&&l.onCellDblClick(d)),onContextmenu:t[4]||(t[4]=d=>!l.isDisabled&&a.options.cellContextmenu&&l.onCellContextMenu(d)),onDragenter:t[5]||(t[5]=d=>!l.isDisabled&&a.editEvents.drag&&l.dnd&&l.dnd.cellDragEnter(d,s.$data,a.data.startDate)),onDragover:d=>!l.isDisabled&&a.editEvents.drag&&l.dnd&&l.dnd.cellDragOver(d,s.$data,a.data.startDate,l.splitsCount?u.id:null),onDragleave:t[6]||(t[6]=d=>!l.isDisabled&&a.editEvents.drag&&l.dnd&&l.dnd.cellDragLeave(d,s.$data,a.data.startDate)),onDrop:d=>!l.isDisabled&&a.editEvents.drag&&l.dnd&&l.dnd.cellDragDrop(d,s.$data,a.data.startDate,l.splitsCount?u.id:null)},[a.options.showTimeInCells&&a.options.time&&l.isWeekOrDayView&&!a.allDay?(o(),r("div",ra,[(o(!0),r(J,null,ee(l.vuecal.timeCells,(d,v)=>(o(),r("span",{class:"cell-time-label",key:v},h(d.label),1))),128))])):E("",!0),l.isWeekOrDayView&&!a.allDay&&l.specialHours.length?(o(!0),r(J,{key:1},ee(l.specialHours,(d,v)=>(o(),r("div",{class:Q(["vuecal__special-hours",`vuecal__special-hours--day${d.day} ${d.class}`]),style:xe(`height: ${d.height}px;top: ${d.top}px`)},[d.label?(o(),r("div",{key:0,class:"special-hours-label",innerHTML:d.label},null,8,da)):E("",!0)],6))),256)):E("",!0),ne(s.$slots,"cell-content",{events:l.events,selectCell:d=>l.selectCell(d,!0),split:l.splitsCount?u:!1}),l.eventsCount&&(l.isWeekOrDayView||l.view.id==="month"&&a.options.eventsOnMonthView)?(o(),r("div",ua,[(o(!0),r(J,null,ee(l.splitsCount?u.events:l.events,(d,v)=>(o(),X(c,{key:v,"cell-formatted-date":a.data.formattedDate,event:d,"all-day":a.allDay,"cell-events":l.splitsCount?u.events:l.events,overlaps:((l.splitsCount?u.overlaps[d._eid]:s.cellOverlaps[d._eid])||[]).overlaps,"event-position":((l.splitsCount?u.overlaps[d._eid]:s.cellOverlaps[d._eid])||[]).position,"overlaps-streak":l.splitsCount?u.overlapsStreak:s.cellOverlapsStreak},{event:N(({event:y,view:w})=>[ne(s.$slots,"event",{view:w,event:y})]),_:2},1032,["cell-formatted-date","event","all-day","cell-events","overlaps","event-position","overlaps-streak"]))),128))])):E("",!0)],42,oa))),128)),l.timelineVisible?(o(),r("div",{class:"vuecal__now-line",style:xe(`top: ${l.todaysTimePosition}px`),key:a.options.transitions?`${l.view.id}-now-line`:"now-line",title:l.utils.date.formatTime(l.vuecal.now)},null,12,ca)):E("",!0)]),_:3},8,["class","name","appear","style"])}const va={inject:["vuecal","utils","modules","view","domEvents"],components:{Event:na},props:{options:{type:Object,default:()=>({})},editEvents:{type:Object,required:!0},data:{type:Object,required:!0},cellSplits:{type:Array,default:()=>[]},minTimestamp:{type:[Number,null],default:null},maxTimestamp:{type:[Number,null],default:null},cellWidth:{type:[Number,Boolean],default:!1},allDay:{type:Boolean,default:!1}},data:()=>({cellOverlaps:{},cellOverlapsStreak:1,timeAtCursor:null,highlighted:!1,highlightedSplit:null}),methods:{getSplitAtCursor({target:s}){let a=s.classList.contains("vuecal__cell-split")?s:this.vuecal.findAncestor(s,"vuecal__cell-split");return a&&(a=a.attributes["data-split"].value,parseInt(a).toString()===a.toString()&&(a=parseInt(a))),a||null},splitClasses(s){return{"vuecal__cell-split":!0,"vuecal__cell-split--highlighted":this.highlightedSplit===s.id,[s.class]:!!s.class}},checkCellOverlappingEvents(){this.options.time&&this.eventsCount&&!this.splitsCount&&(this.eventsCount===1?(this.cellOverlaps=[],this.cellOverlapsStreak=1):[this.cellOverlaps,this.cellOverlapsStreak]=this.utils.event.checkCellOverlappingEvents(this.events,this.options))},isDOMElementAnEvent(s){return this.vuecal.isDOMElementAnEvent(s)},selectCell(s,t=!1){const a=this.splitsCount?this.getSplitAtCursor(s):null;this.utils.cell.selectCell(t,this.timeAtCursor,a),this.timeAtCursor=null},onCellkeyPressEnter(s){this.isSelected||this.onCellFocus(s);const t=this.splitsCount?this.getSplitAtCursor(s):null;this.utils.cell.keyPressEnterCell(this.timeAtCursor,t),this.timeAtCursor=null},onCellFocus(s){if(!this.isSelected&&!this.isDisabled){this.isSelected=this.data.startDate;const t=this.splitsCount?this.getSplitAtCursor(s):null,a=this.timeAtCursor||this.data.startDate;this.vuecal.$emit("cell-focus",t?{date:a,split:t}:a)}},onCellMouseDown(s,t=null,a=!1){if("ontouchstart"in window&&!a)return!1;this.isSelected||this.onCellFocus(s);const{clickHoldACell:n,focusAnEvent:i}=this.domEvents;this.domEvents.cancelClickEventCreation=!1,n.eventCreated=!1,this.timeAtCursor=new Date(this.data.startDate);const{minutes:l,cursorCoords:{y:c}}=this.vuecal.minutesAtCursor(s);this.timeAtCursor.setMinutes(l);const u=this.isDOMElementAnEvent(s.target);!u&&i._eid&&((this.view.events.find(m=>m._eid===i._eid)||{}).focused=!1),this.editEvents.create&&!u&&this.setUpEventCreation(s,c)},setUpEventCreation(s,t){if(this.options.dragToCreateEvent&&["week","day"].includes(this.view.id)){const{dragCreateAnEvent:a}=this.domEvents;if(a.startCursorY=t,a.split=this.splitsCount?this.getSplitAtCursor(s):null,a.start=this.timeAtCursor,this.options.snapToTime){let n=this.timeAtCursor.getHours()*60+this.timeAtCursor.getMinutes();const i=n+this.options.snapToTime/2;n=i-i%this.options.snapToTime,a.start.setHours(0,n,0,0)}}else this.options.cellClickHold&&["month","week","day"].includes(this.view.id)&&this.setUpCellHoldTimer(s)},setUpCellHoldTimer(s){const{clickHoldACell:t}=this.domEvents;t.cellId=`${this.vuecal._.uid}_${this.data.formattedDate}`,t.split=this.splitsCount?this.getSplitAtCursor(s):null,t.timeoutId=setTimeout(()=>{if(t.cellId&&!this.domEvents.cancelClickEventCreation){const{_eid:a}=this.utils.event.createAnEvent(this.timeAtCursor,null,t.split?{split:t.split}:{});t.eventCreated=a}},t.timeout)},onCellTouchStart(s,t=null){this.onCellMouseDown(s,t,!0)},onCellClick(s){this.isDOMElementAnEvent(s.target)||this.selectCell(s)},onCellDblClick(s){const t=new Date(this.data.startDate);t.setMinutes(this.vuecal.minutesAtCursor(s).minutes);const a=this.splitsCount?this.getSplitAtCursor(s):null;this.vuecal.$emit("cell-dblclick",a?{date:t,split:a}:t),this.options.dblclickToNavigate&&this.vuecal.switchToNarrowerView()},onCellContextMenu(s){s.stopPropagation(),s.preventDefault();const t=new Date(this.data.startDate),{cursorCoords:a,minutes:n}=this.vuecal.minutesAtCursor(s);t.setMinutes(n);const i=this.splitsCount?this.getSplitAtCursor(s):null;this.vuecal.$emit("cell-contextmenu",{date:t,...a,...i||{},e:s})}},computed:{dnd(){return this.modules.dnd},nowInMinutes(){return this.utils.date.dateToMinutes(this.vuecal.now)},isBeforeMinDate(){return this.minTimestamp!==null&&this.minTimestamp>this.data.endDate.getTime()},isAfterMaxDate(){return this.maxTimestamp&&this.maxTimestamp<this.data.startDate.getTime()},isDisabled(){const{disableDays:s}=this.options,{isYearsOrYearView:t}=this.vuecal;return s.length&&s.includes(this.data.formattedDate)&&!t?!0:this.isBeforeMinDate||this.isAfterMaxDate},isSelected:{get(){let s=!1;const{selectedDate:t}=this.view;return this.view.id==="years"?s=t.getFullYear()===this.data.startDate.getFullYear():this.view.id==="year"?s=t.getFullYear()===this.data.startDate.getFullYear()&&t.getMonth()===this.data.startDate.getMonth():s=t.getTime()===this.data.startDate.getTime(),s},set(s){this.view.selectedDate=s,this.vuecal.$emit("update:selected-date",this.view.selectedDate)}},isWeekOrDayView(){return["week","day"].includes(this.view.id)},transitionDirection(){return this.vuecal.transitionDirection},specialHours(){return this.data.specialHours.map(s=>{let{from:t,to:a}=s;return t=Math.max(t,this.options.timeFrom),a=Math.min(a,this.options.timeTo),{...s,height:(a-t)*this.timeScale,top:(t-this.options.timeFrom)*this.timeScale}})},events(){const{startDate:s,endDate:t}=this.data;let a=[];if(!(["years","year"].includes(this.view.id)&&!this.options.eventsCountOnYearView)){if(a=this.view.events.slice(0),this.view.id==="month"&&a.push(...this.view.outOfScopeEvents),a=a.filter(n=>this.utils.event.eventInRange(n,s,t)),this.options.showAllDayEvents&&this.view.id!=="month"&&(a=a.filter(n=>!!n.allDay===this.allDay)),this.options.time&&this.isWeekOrDayView&&!this.allDay){const{timeFrom:n,timeTo:i}=this.options;a=a.filter(l=>{const c=l.daysCount>1&&l.segments[this.data.formattedDate]||{},u=l.daysCount===1&&l.startTimeMinutes<i&&l.endTimeMinutes>n,m=l.daysCount>1&&c.startTimeMinutes<i&&c.endTimeMinutes>n;return l.allDay||u||m||!1})}this.options.time&&this.isWeekOrDayView&&!(this.options.showAllDayEvents&&this.allDay)&&a.sort((n,i)=>n.start<i.start?-1:1),this.cellSplits.length||this.$nextTick(this.checkCellOverlappingEvents)}return a},eventsCount(){return this.events.length},splits(){return this.cellSplits.map((s,t)=>{const a=this.events.filter(l=>l.split===s.id),[n,i]=this.utils.event.checkCellOverlappingEvents(a.filter(l=>!l.background&&!l.allDay),this.options);return{...s,overlaps:n,overlapsStreak:i,events:a}})},splitsCount(){return this.splits.length},cellClasses(){return{[this.data.class]:!!this.data.class,"vuecal__cell--current":this.data.current,"vuecal__cell--today":this.data.today,"vuecal__cell--out-of-scope":this.data.outOfScope,"vuecal__cell--before-min":this.isDisabled&&this.isBeforeMinDate,"vuecal__cell--after-max":this.isDisabled&&this.isAfterMaxDate,"vuecal__cell--disabled":this.isDisabled,"vuecal__cell--selected":this.isSelected,"vuecal__cell--highlighted":this.highlighted,"vuecal__cell--has-splits":this.splitsCount,"vuecal__cell--has-events":this.eventsCount}},cellStyles(){return{...this.cellWidth?{width:`${this.cellWidth}%`}:{}}},timelineVisible(){const{time:s,timeTo:t}=this.options;return this.data.today&&this.isWeekOrDayView&&s&&!this.allDay&&this.nowInMinutes<=t},todaysTimePosition(){if(!this.data.today||!this.options.time)return;const s=this.nowInMinutes-this.options.timeFrom;return Math.round(s*this.timeScale)},timeScale(){return this.options.timeCellHeight/this.options.timeStep}}},kt=Ne(va,[["render",ma]]),pa={key:0,class:"vuecal__all-day-text",style:{width:"3em"}};function ha(s,t,a,n,i,l){const c=je("vuecal-cell");return o(),r("div",{class:"vuecal__flex vuecal__all-day",style:xe(a.cellOrSplitMinWidth&&{height:a.height})},[a.cellOrSplitMinWidth?E("",!0):(o(),r("div",pa,[e("span",null,h(a.label),1)])),e("div",{class:Q(["vuecal__flex vuecal__cells",`${l.view.id}-view`]),grow:"",style:xe(a.cellOrSplitMinWidth?`min-width: ${a.cellOrSplitMinWidth}px`:"")},[(o(!0),r(J,null,ee(a.cells,(u,m)=>(o(),X(c,{key:m,options:a.options,"edit-events":l.editEvents,data:u,"all-day":!0,"cell-width":a.options.hideWeekdays.length&&(l.vuecal.isWeekView||l.vuecal.isMonthView)&&l.vuecal.cellWidth,"min-timestamp":a.options.minTimestamp,"max-timestamp":a.options.maxTimestamp,"cell-splits":a.daySplits},{event:N(({event:d,view:v})=>[ne(s.$slots,"event",{view:v,event:d})]),_:2},1032,["options","edit-events","data","cell-width","min-timestamp","max-timestamp","cell-splits"]))),128))],6)],4)}const ga={inject:["vuecal","view","editEvents"],components:{"vuecal-cell":kt},props:{options:{type:Object,required:!0},cells:{type:Array,required:!0},label:{type:String,required:!0},daySplits:{type:Array,default:()=>[]},shortEvents:{type:Boolean,default:!0},height:{type:String,default:""},cellOrSplitMinWidth:{type:Number,default:null}},computed:{hasCellOrSplitWidth(){return!!(this.options.minCellWidth||this.daySplits.length&&this.options.minSplitWidth)}}},ya=Ne(ga,[["render",ha]]),fa=["lang"],ba={class:"default"},_a={key:0,class:"vuecal__flex vuecal__body",grow:""},wa=["onBlur","innerHTML"],xa=["innerHTML"],ka=["innerHTML"],Da={class:"vuecal__flex",row:"",grow:""},Ca={key:0,class:"vuecal__time-column"},Ea={class:"vuecal__time-cell-label"},Ta={key:1,class:"vuecal__flex vuecal__week-numbers",column:""},$a=["wrap","column"],Sa=["onBlur","innerHTML"],Ma=["innerHTML"],ja=["innerHTML"],Va=["wrap"],Aa=["innerHTML"],Ia=["innerHTML"],Oa={key:2,class:"vuecal__cell-events-count"},La={key:3,class:"vuecal__no-event"},Ua=["onBlur","innerHTML"],Na=["innerHTML"],Pa={key:2,class:"vuecal__event-time"},Ra={key:0},Fa={key:1,class:"days-to-end"},Ba=["innerHTML"],Ha={key:0,class:"vuecal__scrollbar-check"};function Wa(s,t,a,n,i,l){const c=je("vuecal-header"),u=je("all-day-bar"),m=je("weekdays-headings"),d=je("vuecal-cell");return o(),r("div",{class:Q(["vuecal__flex vuecal",l.cssClasses]),column:"",ref:"vuecal",lang:a.locale},[p(c,{options:s.$props,"edit-events":l.editEvents,"view-props":{views:l.views,weekDaysInHeader:l.weekDaysInHeader},"week-days":l.weekDays,"has-splits":l.hasSplits,"day-splits":l.daySplits,"switch-to-narrower-view":l.switchToNarrowerView},et({"arrow-prev":N(()=>[ne(s.$slots,"arrow-prev",{},()=>[t[0]||(t[0]=B(" ")),t[1]||(t[1]=e("i",{class:"angle"},null,-1)),t[2]||(t[2]=B(" "))])]),"arrow-next":N(()=>[ne(s.$slots,"arrow-next",{},()=>[t[3]||(t[3]=B(" ")),t[4]||(t[4]=e("i",{class:"angle"},null,-1)),t[5]||(t[5]=B(" "))])]),"today-button":N(()=>[ne(s.$slots,"today-button",{},()=>[e("span",ba,h(i.texts.today),1)])]),title:N(()=>[ne(s.$slots,"title",{title:l.viewTitle,view:i.view},()=>[B(h(l.viewTitle),1)])]),_:2},[s.$slots["weekday-heading"]?{name:"weekday-heading",fn:N(({heading:v,view:y})=>[ne(s.$slots,"weekday-heading",{heading:v,view:y})]),key:"0"}:void 0,s.$slots["split-label"]?{name:"split-label",fn:N(({split:v})=>[ne(s.$slots,"split-label",{split:v,view:i.view.id})]),key:"1"}:void 0]),1032,["options","edit-events","view-props","week-days","has-splits","day-splits","switch-to-narrower-view"]),a.hideBody?E("",!0):(o(),r("div",_a,[p(Ge,{name:`slide-fade--${i.transitionDirection}`,appear:a.transitions},{default:N(()=>[(o(),r("div",{class:"vuecal__flex",style:{"min-width":"100%"},key:a.transitions?i.view.id:!1,column:""},[a.showAllDayEvents&&l.hasTimeColumn&&(!l.cellOrSplitMinWidth||l.isDayView&&!a.minSplitWidth)?(o(),X(u,mt(vt({key:0},l.allDayBar)),{event:N(({event:v,view:y})=>[ne(s.$slots,"event",{view:y,event:v},()=>[l.editEvents.title&&v.titleEditable?(o(),r("div",{key:0,class:"vuecal__event-title vuecal__event-title--edit",contenteditable:"",onBlur:w=>l.onEventTitleBlur(w,v),innerHTML:v.title},null,40,wa)):v.title?(o(),r("div",{key:1,class:"vuecal__event-title",innerHTML:v.title},null,8,xa)):E("",!0),v.content&&!l.hasShortEvents&&!l.isShortMonthView?(o(),r("div",{key:2,class:"vuecal__event-content",innerHTML:v.content},null,8,ka)):E("",!0)])]),_:3},16)):E("",!0),e("div",{class:Q(["vuecal__bg",{vuecal__flex:!l.hasTimeColumn}]),column:""},[e("div",Da,[l.hasTimeColumn?(o(),r("div",Ca,[a.showAllDayEvents&&l.cellOrSplitMinWidth&&!(l.isDayView&&!a.minSplitWidth)?(o(),r("div",{key:0,class:"vuecal__all-day-text",style:xe({height:l.allDayBar.height})},[e("span",null,h(i.texts.allDay),1)],4)):E("",!0),(o(!0),r(J,null,ee(l.timeCells,(v,y)=>(o(),r("div",{class:"vuecal__time-cell",key:y,style:xe(`height: ${a.timeCellHeight}px`)},[ne(s.$slots,"time-cell",{hours:v.hours,minutes:v.minutes},()=>[t[6]||(t[6]=e("span",{class:"vuecal__time-cell-line"},null,-1)),e("span",Ea,h(v.label),1)])],4))),128))])):E("",!0),a.showWeekNumbers&&l.isMonthView?(o(),r("div",Ta,[(o(),r(J,null,ee(6,v=>e("div",{class:"vuecal__flex vuecal__week-number-cell",key:v,grow:""},[ne(s.$slots,"week-number-cell",{week:l.getWeekNumber(v-1)},()=>[B(h(l.getWeekNumber(v-1)),1)])])),64))])):E("",!0),e("div",{class:Q(["vuecal__flex vuecal__cells",`${i.view.id}-view`]),grow:"",wrap:!l.cellOrSplitMinWidth||!l.isWeekView,column:!!l.cellOrSplitMinWidth},[l.cellOrSplitMinWidth&&l.isWeekView?(o(),X(m,{key:0,"transition-direction":i.transitionDirection,"week-days":l.weekDays,"switch-to-narrower-view":l.switchToNarrowerView,style:xe(l.cellOrSplitMinWidth?`min-width: ${l.cellOrSplitMinWidth}px`:"")},et({_:2},[s.$slots["weekday-heading"]?{name:"weekday-heading",fn:N(({heading:v,view:y})=>[ne(s.$slots,"weekday-heading",{heading:v,view:y})]),key:"0"}:void 0,s.$slots["split-label"]?{name:"split-label",fn:N(({split:v})=>[ne(s.$slots,"split-label",{split:v,view:i.view.id})]),key:"1"}:void 0]),1032,["transition-direction","week-days","switch-to-narrower-view","style"])):l.hasSplits&&a.stickySplitLabels&&a.minSplitWidth?(o(),r("div",{key:1,class:"vuecal__flex vuecal__split-days-headers",style:xe(l.cellOrSplitMinWidth?`min-width: ${l.cellOrSplitMinWidth}px`:"")},[(o(!0),r(J,null,ee(l.daySplits,(v,y)=>(o(),r("div",{class:Q(["day-split-header",v.class||!1]),key:y},[ne(s.$slots,"split-label",{split:v,view:i.view.id},()=>[B(h(v.label),1)])],2))),128))],4)):E("",!0),a.showAllDayEvents&&l.hasTimeColumn&&(l.isWeekView&&l.cellOrSplitMinWidth||l.isDayView&&l.hasSplits&&a.minSplitWidth)?(o(),X(u,mt(vt({key:2},l.allDayBar)),{event:N(({event:v,view:y})=>[ne(s.$slots,"event",{view:y,event:v},()=>[l.editEvents.title&&v.titleEditable?(o(),r("div",{key:0,class:"vuecal__event-title vuecal__event-title--edit",contenteditable:"",onBlur:w=>l.onEventTitleBlur(w,v),innerHTML:v.title},null,40,Sa)):v.title?(o(),r("div",{key:1,class:"vuecal__event-title",innerHTML:v.title},null,8,Ma)):E("",!0),v.content&&!l.hasShortEvents&&!l.isShortMonthView?(o(),r("div",{key:2,class:"vuecal__event-content",innerHTML:v.content},null,8,ja)):E("",!0)])]),_:3},16)):E("",!0),e("div",{class:"vuecal__flex",ref:v=>i.cellsEl=v,grow:"",wrap:!l.cellOrSplitMinWidth||!l.isWeekView,style:xe(l.cellOrSplitMinWidth?`min-width: ${l.cellOrSplitMinWidth}px`:"")},[(o(!0),r(J,null,ee(l.viewCells,(v,y)=>(o(),X(d,{key:y,options:s.$props,"edit-events":l.editEvents,data:v,"cell-width":a.hideWeekdays.length&&(l.isWeekView||l.isMonthView)&&l.cellWidth,"min-timestamp":l.minTimestamp,"max-timestamp":l.maxTimestamp,"cell-splits":l.hasSplits&&l.daySplits||[]},{"cell-content":N(({events:w,split:C,selectCell:D})=>[ne(s.$slots,"cell-content",{cell:v,view:i.view,goNarrower:D,events:w},()=>[C&&!a.stickySplitLabels?(o(),r("div",{key:0,class:"split-label",innerHTML:C.label},null,8,Aa)):E("",!0),v.content?(o(),r("div",{key:1,class:"vuecal__cell-date",innerHTML:v.content},null,8,Ia)):E("",!0),(l.isMonthView&&!a.eventsOnMonthView||l.isYearsOrYearView&&a.eventsCountOnYearView)&&w.length?(o(),r("div",Oa,[ne(s.$slots,"events-count",{view:i.view,events:w},()=>[B(h(w.length),1)])])):E("",!0),!l.cellOrSplitHasEvents(w,C)&&l.isWeekOrDayView?(o(),r("div",La,[ne(s.$slots,"no-event",{},()=>[B(h(i.texts.noEvent),1)])])):E("",!0)])]),event:N(({event:w,view:C})=>[ne(s.$slots,"event",{view:C,event:w},()=>[l.editEvents.title&&w.titleEditable?(o(),r("div",{key:0,class:"vuecal__event-title vuecal__event-title--edit",contenteditable:"",onBlur:D=>l.onEventTitleBlur(D,w),innerHTML:w.title},null,40,Ua)):w.title?(o(),r("div",{key:1,class:"vuecal__event-title",innerHTML:w.title},null,8,Na)):E("",!0),a.time&&!w.allDay&&!(l.isMonthView&&(w.allDay||a.showAllDayEvents==="short"))&&!l.isShortMonthView?(o(),r("div",Pa,[B(h(i.utils.date.formatTime(w.start,l.TimeFormat)),1),w.endTimeMinutes?(o(),r("span",Ra," - "+h(i.utils.date.formatTime(w.end,l.TimeFormat,null,!0)),1)):E("",!0),w.daysCount>1&&(w.segments[v.formattedDate]||{}).isFirstDay?(o(),r("small",Fa," +"+h(w.daysCount-1)+h((i.texts.day[0]||"").toLowerCase()),1)):E("",!0)])):E("",!0),w.content&&!(l.isMonthView&&w.allDay&&a.showAllDayEvents==="short")&&!l.isShortMonthView?(o(),r("div",{key:3,class:"vuecal__event-content",innerHTML:w.content},null,8,Ba)):E("",!0)])]),"no-event":N(()=>[ne(s.$slots,"no-event",{},()=>[B(h(i.texts.noEvent),1)])]),_:2},1032,["options","edit-events","data","cell-width","min-timestamp","max-timestamp","cell-splits"]))),128))],12,Va)],10,$a)])],2)]))]),_:3},8,["name","appear"]),i.ready?E("",!0):(o(),r("div",Ha,t[7]||(t[7]=[e("div",null,null,-1)])))]))],10,fa)}const He=1440,qe={weekDays:Array(7).fill(""),weekDaysShort:[],months:Array(12).fill(""),years:"",year:"",month:"",week:"",day:"",today:"",noEvent:"",allDay:"",deleteEvent:"",createEvent:"",dateFormat:"dddd MMMM D, YYYY",am:"am",pm:"pm"},yt=["years","year","month","week","day"],ft=new js(qe),Ya={name:"vue-cal",components:{"vuecal-cell":kt,"vuecal-header":sa,WeekdaysHeadings:xt,AllDayBar:ya},provide(){return{vuecal:this,utils:this.utils,modules:this.modules,previous:this.previous,next:this.next,switchView:this.switchView,updateSelectedDate:this.updateSelectedDate,editEvents:this.editEvents,view:this.view,domEvents:this.domEvents}},props:{activeView:{type:String,default:"week"},allDayBarHeight:{type:[String,Number],default:"25px"},cellClickHold:{type:Boolean,default:!0},cellContextmenu:{type:Boolean,default:!1},clickToNavigate:{type:Boolean,default:!1},dblclickToNavigate:{type:Boolean,default:!0},disableDatePrototypes:{type:Boolean,default:!1},disableDays:{type:Array,default:()=>[]},disableViews:{type:Array,default:()=>[]},dragToCreateEvent:{type:Boolean,default:!0},dragToCreateThreshold:{type:Number,default:15},editableEvents:{type:[Boolean,Object],default:!1},events:{type:Array,default:()=>[]},eventsCountOnYearView:{type:Boolean,default:!1},eventsOnMonthView:{type:[Boolean,String],default:!1},hideBody:{type:Boolean,default:!1},hideTitleBar:{type:Boolean,default:!1},hideViewSelector:{type:Boolean,default:!1},hideWeekdays:{type:Array,default:()=>[]},hideWeekends:{type:Boolean,default:!1},locale:{type:[String,Object],default:"en"},maxDate:{type:[String,Date],default:""},minCellWidth:{type:Number,default:0},minDate:{type:[String,Date],default:""},minEventWidth:{type:Number,default:0},minSplitWidth:{type:Number,default:0},onEventClick:{type:[Function,null],default:null},onEventCreate:{type:[Function,null],default:null},onEventDblclick:{type:[Function,null],default:null},overlapsPerTimeStep:{type:Boolean,default:!1},resizeX:{type:Boolean,default:!1},selectedDate:{type:[String,Date],default:""},showAllDayEvents:{type:[Boolean,String],default:!1},showTimeInCells:{type:Boolean,default:!1},showWeekNumbers:{type:[Boolean,String],default:!1},snapToTime:{type:Number,default:0},small:{type:Boolean,default:!1},specialHours:{type:Object,default:()=>({})},splitDays:{type:Array,default:()=>[]},startWeekOnSunday:{type:Boolean,default:!1},stickySplitLabels:{type:Boolean,default:!1},time:{type:Boolean,default:!0},timeCellHeight:{type:Number,default:40},timeFormat:{type:String,default:""},timeFrom:{type:Number,default:0},timeStep:{type:Number,default:60},timeTo:{type:Number,default:He},todayButton:{type:Boolean,default:!1},transitions:{type:Boolean,default:!0},twelveHour:{type:Boolean,default:!1},watchRealTime:{type:Boolean,default:!1},xsmall:{type:Boolean,default:!1}},data(){return{ready:!1,texts:{...qe},utils:{date:(this.disableDatePrototypes?ft.removePrototypes():!1)||ft,cell:null,event:null},modules:{dnd:null},cellsEl:null,view:{id:"",title:"",startDate:null,endDate:null,firstCellDate:null,lastCellDate:null,selectedDate:null,events:[]},eventIdIncrement:1,now:new Date,timeTickerIds:[null,null],domEvents:{resizeAnEvent:{_eid:null,start:null,split:null,segment:null,originalEndTimeMinutes:0,originalEnd:null,end:null,startCell:null,endCell:null},dragAnEvent:{_eid:null},dragCreateAnEvent:{startCursorY:null,start:null,split:null,event:null},focusAnEvent:{_eid:null,mousedUp:!1},clickHoldAnEvent:{_eid:null,timeout:1200,timeoutId:null},dblTapACell:{taps:0,timeout:500},clickHoldACell:{cellId:null,split:null,timeout:1200,timeoutId:null,eventCreated:!1},cancelClickEventCreation:!1},mutableEvents:[],transitionDirection:"right"}},methods:{async loadLocale(s){if(typeof this.locale=="object"){this.texts=Object.assign({},qe,s),this.utils.date.updateTexts(this.texts);return}const t=await Ms(Object.assign({"./i18n/ar.json":()=>se(()=>import("./ar.es-bitOgb9K.js"),[]),"./i18n/bg.json":()=>se(()=>import("./bg.es-5tp0KQRo.js"),[]),"./i18n/bn.json":()=>se(()=>import("./bn.es-C_qR0y0-.js"),[]),"./i18n/bs.json":()=>se(()=>import("./bs.es-DduooXS8.js"),[]),"./i18n/ca.json":()=>se(()=>import("./ca.es-DYDNDJFJ.js"),[]),"./i18n/cs.json":()=>se(()=>import("./cs.es-CvnAvfoI.js"),[]),"./i18n/da.json":()=>se(()=>import("./da.es-C_eJXDX3.js"),[]),"./i18n/de.json":()=>se(()=>import("./de.es-Cp-R9E16.js"),[]),"./i18n/el.json":()=>se(()=>import("./el.es-BZ44a1Tb.js"),[]),"./i18n/en.json":()=>se(()=>import("./en.es-DwVNOttH.js"),[]),"./i18n/es.json":()=>se(()=>import("./es.es-DO8PaQ_q.js"),[]),"./i18n/et.json":()=>se(()=>import("./et.es-DdRIcUrz.js"),[]),"./i18n/fa.json":()=>se(()=>import("./fa.es-XN0av8Tx.js"),[]),"./i18n/fi.json":()=>se(()=>import("./fi.es-B0Iy6aas.js"),[]),"./i18n/fr.json":()=>se(()=>import("./fr.es-B7WXlprl.js"),[]),"./i18n/he.json":()=>se(()=>import("./he.es-BWEk5prp.js"),[]),"./i18n/hr.json":()=>se(()=>import("./hr.es-B_iqHQyr.js"),[]),"./i18n/hu.json":()=>se(()=>import("./hu.es-D_t4Ibxf.js"),[]),"./i18n/id.json":()=>se(()=>import("./id.es-CzHAK-XV.js"),[]),"./i18n/is.json":()=>se(()=>import("./is.es-DChRpym4.js"),[]),"./i18n/it.json":()=>se(()=>import("./it.es-CquQA5xx.js"),[]),"./i18n/ja.json":()=>se(()=>import("./ja.es-B19gsG6H.js"),[]),"./i18n/ka.json":()=>se(()=>import("./ka.es-CuOe65jc.js"),[]),"./i18n/ko.json":()=>se(()=>import("./ko.es-CsMl2USK.js"),[]),"./i18n/lt.json":()=>se(()=>import("./lt.es-vqgjGyMx.js"),[]),"./i18n/mn.json":()=>se(()=>import("./mn.es-BmdwFdas.js"),[]),"./i18n/nl.json":()=>se(()=>import("./nl.es-CFxVMCWy.js"),[]),"./i18n/no.json":()=>se(()=>import("./no.es-qRcuRMwl.js"),[]),"./i18n/pl.json":()=>se(()=>import("./pl.es-BQ3a0ltx.js"),[]),"./i18n/pt-br.json":()=>se(()=>import("./pt-br.es-U9bVHsgs.js"),[]),"./i18n/pt-pt.json":()=>se(()=>import("./pt-pt.es-U9bVHsgs.js"),[]),"./i18n/ro.json":()=>se(()=>import("./ro.es-ldjMjt3l.js"),[]),"./i18n/ru.json":()=>se(()=>import("./ru.es-CS-QKsYL.js"),[]),"./i18n/sk.json":()=>se(()=>import("./sk.es-CAe8sEvL.js"),[]),"./i18n/sl.json":()=>se(()=>import("./sl.es-rdzOxu_X.js"),[]),"./i18n/sq.json":()=>se(()=>import("./sq.es-BY5E06HI.js"),[]),"./i18n/sr.json":()=>se(()=>import("./sr.es-QPseRVBy.js"),[]),"./i18n/sv.json":()=>se(()=>import("./sv.es-BfPUYcV1.js"),[]),"./i18n/tr.json":()=>se(()=>import("./tr.es-Cl6kz_IH.js"),[]),"./i18n/uk.json":()=>se(()=>import("./uk.es-DBEtNQnZ.js"),[]),"./i18n/vi.json":()=>se(()=>import("./vi.es-Bx2g_1jx.js"),[]),"./i18n/zh-cn.json":()=>se(()=>import("./zh-cn.es-BWMmCH-R.js"),[]),"./i18n/zh-hk.json":()=>se(()=>import("./zh-hk.es-DFZ0bKvi.js"),[])}),`./i18n/${s}.json`,3);this.texts=Object.assign({},qe,t),this.utils.date.updateTexts(this.texts)},loadDragAndDrop(){se(()=>import("./drag-and-drop.es-CbCm7IHa.js"),[]).then(s=>{const{DragAndDrop:t}=s;this.modules.dnd=new t(this)}).catch(()=>console.warn("Vue Cal: Missing drag & drop module."))},validateView(s){return yt.includes(s)||(console.error(`Vue Cal: invalid active-view parameter provided: "${s}".
A valid view must be one of: ${yt.join(", ")}.`),s="week"),this.enabledViews.includes(s)||(console.warn(`Vue Cal: the provided active-view "${s}" is disabled. Using the "${this.enabledViews[0]}" view instead.`),s=this.enabledViews[0]),s},switchToNarrowerView(s=null){this.transitionDirection="right";const t=this.enabledViews[this.enabledViews.indexOf(this.view.id)+1];t&&this.switchView(t,s)},switchView(s,t=null,a=!1){s=this.validateView(s);const n=this.utils.date,i=this.view.startDate&&this.view.startDate.getTime();if(this.transitions&&a){if(this.view.id===s)return;const u=this.enabledViews;this.transitionDirection=u.indexOf(this.view.id)>u.indexOf(s)?"left":"right"}const l=this.view.id;switch(this.view.events=[],this.view.id=s,this.view.firstCellDate=null,this.view.lastCellDate=null,t||(t=this.view.selectedDate||this.view.startDate),s){case"years":{this.view.startDate=new Date(Math.floor(t.getFullYear()/25)*25||2e3,0,1),this.view.endDate=new Date(this.view.startDate.getFullYear()+25,0,1),this.view.endDate.setSeconds(-1);break}case"year":{this.view.startDate=new Date(t.getFullYear(),0,1),this.view.endDate=new Date(t.getFullYear()+1,0,1),this.view.endDate.setSeconds(-1);break}case"month":{this.view.startDate=new Date(t.getFullYear(),t.getMonth(),1),this.view.endDate=new Date(t.getFullYear(),t.getMonth()+1,1),this.view.endDate.setSeconds(-1);let u=new Date(this.view.startDate);if(u.getDay()!==(this.startWeekOnSunday?0:1)&&(u=n.getPreviousFirstDayOfWeek(u,this.startWeekOnSunday)),this.view.firstCellDate=u,this.view.lastCellDate=n.addDays(u,41),this.view.lastCellDate.setHours(23,59,59,0),this.hideWeekends){if([0,6].includes(this.view.firstCellDate.getDay())){const m=this.view.firstCellDate.getDay()===6&&!this.startWeekOnSunday?2:1;this.view.firstCellDate=n.addDays(this.view.firstCellDate,m)}if([0,6].includes(this.view.startDate.getDay())){const m=this.view.startDate.getDay()===6?2:1;this.view.startDate=n.addDays(this.view.startDate,m)}if([0,6].includes(this.view.lastCellDate.getDay())){const m=this.view.lastCellDate.getDay()===0&&!this.startWeekOnSunday?2:1;this.view.lastCellDate=n.subtractDays(this.view.lastCellDate,m)}if([0,6].includes(this.view.endDate.getDay())){const m=this.view.endDate.getDay()===0?2:1;this.view.endDate=n.subtractDays(this.view.endDate,m)}}break}case"week":{t=n.getPreviousFirstDayOfWeek(t,this.startWeekOnSunday);const u=this.hideWeekends?5:7;this.view.startDate=this.hideWeekends&&this.startWeekOnSunday?n.addDays(t,1):t,this.view.startDate.setHours(0,0,0,0),this.view.endDate=n.addDays(t,u),this.view.endDate.setSeconds(-1);break}case"day":{this.view.startDate=t,this.view.startDate.setHours(0,0,0,0),this.view.endDate=new Date(t),this.view.endDate.setHours(23,59,59,0);break}}this.addEventsToView();const c=this.view.startDate&&this.view.startDate.getTime();if(!(l===s&&c===i)&&(this.$emit("update:activeView",s),this.ready)){const u=this.view.startDate,m={view:s,startDate:u,endDate:this.view.endDate,...this.isMonthView?{firstCellDate:this.view.firstCellDate,lastCellDate:this.view.lastCellDate,outOfScopeEvents:this.view.outOfScopeEvents.map(this.cleanupEvent)}:{},events:this.view.events.map(this.cleanupEvent),...this.isWeekView?{week:n.getWeek(this.startWeekOnSunday?n.addDays(u,1):u)}:{}};this.$emit("view-change",m)}},previous(){this.previousNext(!1)},next(){this.previousNext()},previousNext(s=!0){const t=this.utils.date;this.transitionDirection=s?"right":"left";const a=s?1:-1;let n=null;const{startDate:i,id:l}=this.view;switch(l){case"years":n=new Date(i.getFullYear()+25*a,0,1);break;case"year":n=new Date(i.getFullYear()+1*a,1,1);break;case"month":n=new Date(i.getFullYear(),i.getMonth()+1*a,1);break;case"week":n=t[s?"addDays":"subtractDays"](t.getPreviousFirstDayOfWeek(i,this.startWeekOnSunday),7);break;case"day":n=t[s?"addDays":"subtractDays"](i,1);const c=n.getDay(),u=this.startWeekOnSunday?c:(c||7)-1;if(this.weekDays[u].hide){const d=this.weekDays.map((y,w)=>({...y,i:w}));let v=0;s?([...d.slice(u),...d].find(y=>(v++,!y.hide)).i,v--):[...d,...d.slice(0,u)].reverse().find(y=>(v++,!y.hide)).i,n=t[s?"addDays":"subtractDays"](n,v)}break}n&&this.switchView(l,n)},addEventsToView(s=[]){const t=this.utils.event,{startDate:a,endDate:n,firstCellDate:i,lastCellDate:l}=this.view;if(s.length||(this.view.events=[]),s=s.length?s:[...this.mutableEvents],!s||this.isYearsOrYearView&&!this.eventsCountOnYearView)return;let c=s.filter(u=>t.eventInRange(u,a,n));!this.isYearsOrYearView&&!(this.isMonthView&&!this.eventsOnMonthView)&&(c=c.map(u=>u.daysCount>1?t.createEventSegments(u,i||a,l||n):u)),this.view.events.push(...c),this.isMonthView&&(this.view.outOfScopeEvents=[],s.forEach(u=>{(t.eventInRange(u,i,a)||t.eventInRange(u,n,l))&&(this.view.events.some(m=>m._eid===u._eid)||this.view.outOfScopeEvents.push(u))}))},findAncestor(s,t){for(;(s=s.parentElement)&&!s.classList.contains(t););return s},isDOMElementAnEvent(s){return s.classList.contains("vuecal__event")||this.findAncestor(s,"vuecal__event")},onMouseMove(s){const{resizeAnEvent:t,dragAnEvent:a,dragCreateAnEvent:n}=this.domEvents;t._eid===null&&a._eid===null&&!n.start||(s.preventDefault(),t._eid?this.eventResizing(s):this.dragToCreateEvent&&n.start&&this.eventDragCreation(s))},onMouseUp(s){const{focusAnEvent:t,resizeAnEvent:a,clickHoldAnEvent:n,clickHoldACell:i,dragCreateAnEvent:l}=this.domEvents,{_eid:c}=n,{_eid:u}=a;let m=!1;const{event:d,start:v}=l,y=this.isDOMElementAnEvent(s.target),w=t.mousedUp;if(t.mousedUp=!1,y&&(this.domEvents.cancelClickEventCreation=!0),i.eventCreated)return;if(u){const{originalEnd:D,originalEndTimeMinutes:T,endTimeMinutes:g}=a,f=this.view.events.find(S=>S._eid===a._eid);if(m=g&&g!==T,f&&f.end.getTime()!==D.getTime()){const S=this.mutableEvents.find(U=>U._eid===a._eid);S.endTimeMinutes=f.endTimeMinutes,S.end=f.end;const V=this.cleanupEvent(f),R={...this.cleanupEvent(f),end:D,endTimeMinutes:f.originalEndTimeMinutes};this.$emit("event-duration-change",{event:V,oldDate:a.originalEnd,originalEvent:R}),this.$emit("event-change",{event:V,originalEvent:R})}f&&(f.resizing=!1),a._eid=null,a.start=null,a.split=null,a.segment=null,a.originalEndTimeMinutes=null,a.originalEnd=null,a.endTimeMinutes=null,a.startCell=null,a.endCell=null}else v&&(d&&(this.emitWithEvent("event-drag-create",d),l.event.resizing=!1),l.start=null,l.split=null,l.event=null);!y&&!u&&this.unfocusEvent(),n.timeoutId&&!c&&(clearTimeout(n.timeoutId),n.timeoutId=null),i.timeoutId&&(clearTimeout(i.timeoutId),i.timeoutId=null);const C=typeof this.onEventClick=="function";if(w&&!m&&!c&&!d&&C){let D=this.view.events.find(T=>T._eid===t._eid);return!D&&this.isMonthView&&(D=this.view.outOfScopeEvents.find(T=>T._eid===t._eid)),D&&this.onEventClick(D,s)}},onKeyUp(s){s.keyCode===27&&this.cancelDelete()},eventResizing(s){const{resizeAnEvent:t}=this.domEvents,a=this.view.events.find(d=>d._eid===t._eid)||{segments:{}},{minutes:n,cursorCoords:i}=this.minutesAtCursor(s),l=a.segments&&a.segments[t.segment],{date:c,event:u}=this.utils,m=Math.max(n,this.timeFrom+1,(l||a).startTimeMinutes+1);if(a.endTimeMinutes=t.endTimeMinutes=m,this.snapToTime){const d=a.endTimeMinutes+this.snapToTime/2;a.endTimeMinutes=d-d%this.snapToTime}if(l&&(l.endTimeMinutes=a.endTimeMinutes),a.end.setHours(0,a.endTimeMinutes,a.endTimeMinutes===He?-1:0,0),this.resizeX&&this.isWeekView){a.daysCount=c.countDays(a.start,a.end);const d=this.cellsEl,v=d.offsetWidth/d.childElementCount,y=Math.floor(i.x/v);if(t.startCell===null&&(t.startCell=y-(a.daysCount-1)),t.endCell!==y){t.endCell=y;const w=c.addDays(a.start,y-t.startCell),C=Math.max(c.countDays(a.start,w),1);if(C!==a.daysCount){let D=null;C>a.daysCount?D=u.addEventSegment(a):D=u.removeEventSegment(a),t.segment=D,a.endTimeMinutes+=.001}}}this.$emit("event-resizing",{_eid:a._eid,end:a.end,endTimeMinutes:a.endTimeMinutes})},eventDragCreation(s){const{dragCreateAnEvent:t}=this.domEvents,{start:a,startCursorY:n,split:i}=t,l=new Date(a),{minutes:c,cursorCoords:{y:u}}=this.minutesAtCursor(s);if(!(!t.event&&Math.abs(n-u)<this.dragToCreateThreshold))if(t.event){if(l.setHours(0,c,c===He?-1:0,0),this.snapToTime){let v=l.getHours()*60+l.getMinutes();const y=v+this.snapToTime/2;v=y-y%this.snapToTime,l.setHours(0,v,0,0)}const m=a<l,{event:d}=t;d.start=m?a:l,d.end=m?l:a,d.startTimeMinutes=d.start.getHours()*60+d.start.getMinutes(),d.endTimeMinutes=d.end.getHours()*60+d.end.getMinutes()}else{if(t.event=this.utils.event.createAnEvent(a,1,{split:i}),!t.event){t.start=null,t.split=null,t.event=null;return}t.event.resizing=!0}},unfocusEvent(){const{focusAnEvent:s,clickHoldAnEvent:t}=this.domEvents,a=this.view.events.find(n=>n._eid===(s._eid||t._eid));s._eid=null,t._eid=null,a&&(a.focused=!1,a.deleting=!1)},cancelDelete(){const{clickHoldAnEvent:s}=this.domEvents;if(s._eid){const t=this.view.events.find(a=>a._eid===s._eid);t&&(t.deleting=!1),s._eid=null,s.timeoutId=null}},onEventTitleBlur(s,t){if(t.title===s.target.innerHTML)return;const a=t.title;t.title=s.target.innerHTML;const n=this.cleanupEvent(t);this.$emit("event-title-change",{event:n,oldTitle:a}),this.$emit("event-change",{event:n,originalEvent:{...n,title:a}})},updateMutableEvents(){const s=this.utils.date;this.mutableEvents=[],this.events.forEach(t=>{const a=typeof t.start=="string"?s.stringToDate(t.start):t.start,n=s.formatDateLite(a),i=s.dateToMinutes(a);let l=null;typeof t.end=="string"&&t.end.includes("24:00")?(l=new Date(t.end.replace(" 24:00","")),l.setHours(23,59,59,0)):l=typeof t.end=="string"?s.stringToDate(t.end):t.end;let c=s.formatDateLite(l),u=s.dateToMinutes(l);(!u||u===He)&&(!this.time||typeof t.end=="string"&&t.end.length===10?l.setHours(23,59,59,0):l.setSeconds(l.getSeconds()-1),c=s.formatDateLite(l),u=He);const m=n!==c;t=Object.assign({...this.utils.event.eventDefaults},t,{_eid:`${this._.uid}_${this.eventIdIncrement++}`,segments:m?{}:null,start:a,startTimeMinutes:i,end:l,endTimeMinutes:u,daysCount:m?s.countDays(a,l):1,class:t.class}),this.mutableEvents.push(t)})},minutesAtCursor(s){return this.utils.cell.minutesAtCursor(s)},createEvent(s,t,a={}){return this.utils.event.createAnEvent(s,t,a)},cleanupEvent(s){return s={...s},["segments","deletable","deleting","titleEditable","resizable","resizing","draggable","dragging","draggingStatic","focused"].forEach(a=>{a in s&&delete s[a]}),s.repeat||delete s.repeat,s},emitWithEvent(s,t){this.$emit(s,this.cleanupEvent(t))},updateSelectedDate(s){if(s&&typeof s=="string"?s=this.utils.date.stringToDate(s):s=new Date(s),s&&s instanceof Date){const{selectedDate:t}=this.view;t&&(this.transitionDirection=t.getTime()>s.getTime()?"left":"right"),s.setHours(0,0,0,0),(!t||t.getTime()!==s.getTime())&&(this.view.selectedDate=s),this.switchView(this.view.id)}this.$emit("update:selected-date",this.view.selectedDate)},getWeekNumber(s){const t=this.utils.date,n=this.firstCellDateWeekNumber+s,i=this.startWeekOnSunday?1:0;return n>52?t.getWeek(t.addDays(this.view.firstCellDate,7*s+i)):n},timeTick(){this.now=new Date,this.timeTickerIds[1]=setTimeout(this.timeTick,60*1e3)},updateDateTexts(){this.utils.date.updateTexts(this.texts)},alignWithScrollbar(){if(document.getElementById("vuecal-align-with-scrollbar"))return;const s=this.$refs.vuecal.getElementsByClassName("vuecal__scrollbar-check")[0],t=s.offsetWidth-s.children[0].offsetWidth;if(t){const a=document.createElement("style");a.id="vuecal-align-with-scrollbar",a.type="text/css",a.innerHTML=`.vuecal--view-with-time .vuecal__weekdays-headings,.vuecal--view-with-time .vuecal__all-day {padding-right: ${t}px}`,document.head.appendChild(a)}},cellOrSplitHasEvents(s,t=null){return s.length&&(!t&&s.length||t&&s.some(a=>a.split===t.id))}},created(){this.utils.cell=new As(this),this.utils.event=new Os(this,this.utils.date),this.loadLocale(this.locale),this.editEvents.drag&&this.loadDragAndDrop(),this.updateMutableEvents(this.events),this.view.id=this.currentView,this.selectedDate?this.updateSelectedDate(this.selectedDate):(this.view.selectedDate=new Date,this.switchView(this.currentView)),this.time&&this.watchRealTime&&(this.timeTickerIds[0]=setTimeout(this.timeTick,(60-this.now.getSeconds())*1e3))},mounted(){const s=this.utils.date,t="ontouchstart"in window,{resize:a,drag:n,create:i,delete:l,title:c}=this.editEvents,u=this.onEventClick&&typeof this.onEventClick=="function";(a||n||i||l||c||u)&&window.addEventListener(t?"touchend":"mouseup",this.onMouseUp),(a||n||i&&this.dragToCreateEvent)&&window.addEventListener(t?"touchmove":"mousemove",this.onMouseMove,{passive:!1}),c&&window.addEventListener("keyup",this.onKeyUp),t&&(this.$refs.vuecal.oncontextmenu=function(v){v.preventDefault(),v.stopPropagation()}),this.hideBody||this.alignWithScrollbar();const m=this.view.startDate,d={view:this.view.id,startDate:m,endDate:this.view.endDate,...this.isMonthView?{firstCellDate:this.view.firstCellDate,lastCellDate:this.view.lastCellDate}:{},events:this.view.events.map(this.cleanupEvent),...this.isWeekView?{week:s.getWeek(this.startWeekOnSunday?s.addDays(m,1):m)}:{}};this.$emit("ready",d),this.ready=!0},beforeUnmount(){const s="ontouchstart"in window;window.removeEventListener(s?"touchmove":"mousemove",this.onMouseMove,{passive:!1}),window.removeEventListener(s?"touchend":"mouseup",this.onMouseUp),window.removeEventListener("keyup",this.onKeyUp),this.timeTickerIds[0]&&clearTimeout(this.timeTickerIds[0]),this.timeTickerIds[1]&&clearTimeout(this.timeTickerIds[1]),this.timeTickerIds=[null,null]},computed:{editEvents(){return this.editableEvents&&typeof this.editableEvents=="object"?{title:!!this.editableEvents.title,drag:!!this.editableEvents.drag,resize:!!this.editableEvents.resize,create:!!this.editableEvents.create,delete:!!this.editableEvents.delete}:{title:!!this.editableEvents,drag:!!this.editableEvents,resize:!!this.editableEvents,create:!!this.editableEvents,delete:!!this.editableEvents}},views(){return{years:{label:this.texts.years,enabled:!this.disableViews.includes("years")},year:{label:this.texts.year,enabled:!this.disableViews.includes("year")},month:{label:this.texts.month,enabled:!this.disableViews.includes("month")},week:{label:this.texts.week,enabled:!this.disableViews.includes("week")},day:{label:this.texts.day,enabled:!this.disableViews.includes("day")}}},currentView(){return this.validateView(this.activeView)},enabledViews(){return Object.keys(this.views).filter(s=>this.views[s].enabled)},hasTimeColumn(){return this.time&&this.isWeekOrDayView},isShortMonthView(){return this.isMonthView&&this.eventsOnMonthView==="short"},firstCellDateWeekNumber(){const s=this.utils.date,t=this.view.firstCellDate;return s.getWeek(this.startWeekOnSunday?s.addDays(t,1):t)},timeCells(){const s=[];for(let t=this.timeFrom,a=this.timeTo;t<a;t+=this.timeStep)s.push({hours:Math.floor(t/60),minutes:t%60,label:this.utils.date.formatTime(t,this.TimeFormat),value:t});return s},TimeFormat(){return this.timeFormat||(this.twelveHour?"h:mm{am}":"HH:mm")},daySplits(){return(this.splitDays.filter(s=>!s.hide)||[]).map((s,t)=>({...s,id:s.id||t+1}))},hasSplits(){return this.daySplits.length&&this.isWeekOrDayView},hasShortEvents(){return this.showAllDayEvents==="short"},cellOrSplitMinWidth(){let s=null;return this.hasSplits&&this.minSplitWidth?s=this.visibleDaysCount*this.minSplitWidth*this.daySplits.length:this.minCellWidth&&this.isWeekView&&(s=this.visibleDaysCount*this.minCellWidth),s},allDayBar(){let s=this.allDayBarHeight||null;return s&&!isNaN(s)&&(s+="px"),{cells:this.viewCells,options:this.$props,label:this.texts.allDay,shortEvents:this.hasShortEvents,daySplits:this.hasSplits&&this.daySplits||[],cellOrSplitMinWidth:this.cellOrSplitMinWidth,height:s}},minTimestamp(){let s=null;return this.minDate&&typeof this.minDate=="string"?s=this.utils.date.stringToDate(this.minDate):this.minDate&&this.minDate instanceof Date&&(s=this.minDate),s?s.getTime():null},maxTimestamp(){let s=null;return this.maxDate&&typeof this.maxDate=="string"?s=this.utils.date.stringToDate(this.maxDate):this.maxDate&&this.maxDate instanceof Date&&(s=this.maxDate),s?s.getTime():null},weekDays(){let{weekDays:s,weekDaysShort:t=[]}=this.texts;return s=s.slice(0).map((a,n)=>({label:a,...t.length?{short:t[n]}:{},hide:this.hideWeekends&&n>=5||this.hideWeekdays.length&&this.hideWeekdays.includes(n+1)})),this.startWeekOnSunday&&s.unshift(s.pop()),s},weekDaysInHeader(){return this.isMonthView||this.isWeekView&&!this.minCellWidth&&!(this.hasSplits&&this.minSplitWidth)},months(){return this.texts.months.map(s=>({label:s}))},specialDayHours(){return!this.specialHours||!Object.keys(this.specialHours).length?{}:Array(7).fill("").map((s,t)=>{let a=this.specialHours[t+1]||[];return Array.isArray(a)||(a=[a]),s=[],a.forEach(({from:n,to:i,class:l,label:c},u)=>{s[u]={day:t+1,from:[null,void 0].includes(n)?null:n*1,to:[null,void 0].includes(i)?null:i*1,class:l||"",label:c||""}}),s})},viewTitle(){const s=this.utils.date;let t="";const a=this.view.startDate,n=a.getFullYear(),i=a.getMonth();switch(this.view.id){case"years":{t=this.texts.years;break}case"year":{t=n;break}case"month":{t=`${this.months[i].label} ${n}`;break}case"week":{const l=this.view.endDate,c=a.getFullYear();let u=this.texts.months[a.getMonth()];this.xsmall&&(u=u.substring(0,3));let m=`${u} ${c}`;if(l.getMonth()!==a.getMonth()){const d=l.getFullYear();let v=this.texts.months[l.getMonth()];this.xsmall&&(v=v.substring(0,3)),c===d?m=`${u} - ${v} ${c}`:this.small?m=`${u.substring(0,3)} ${c} - ${v.substring(0,3)} ${d}`:m=`${u} ${c} - ${v} ${d}`}t=`${this.texts.week} ${s.getWeek(this.startWeekOnSunday?s.addDays(a,1):a)} (${m})`;break}case"day":{t=this.utils.date.formatDate(a,this.texts.dateFormat,this.texts);break}}return t},viewCells(){const s=this.utils.date;let t=[],a=null,n=!1;this.watchRealTime||(this.now=new Date);const i=this.now;switch(this.view.id){case"years":{a=this.view.startDate.getFullYear(),t=Array.apply(null,Array(25)).map((l,c)=>{const u=new Date(a+c,0,1),m=new Date(a+c+1,0,1);return m.setSeconds(-1),{startDate:u,formattedDate:s.formatDateLite(u),endDate:m,content:a+c,current:a+c===i.getFullYear()}});break}case"year":{a=this.view.startDate.getFullYear(),t=Array.apply(null,Array(12)).map((l,c)=>{const u=new Date(a,c,1),m=new Date(a,c+1,1);return m.setSeconds(-1),{startDate:u,formattedDate:s.formatDateLite(u),endDate:m,content:this.xsmall?this.months[c].label.substr(0,3):this.months[c].label,current:c===i.getMonth()&&a===i.getFullYear()}});break}case"month":{const l=this.view.startDate.getMonth(),c=new Date(this.view.firstCellDate);n=!1,t=Array.apply(null,Array(42)).map((u,m)=>{const d=s.addDays(c,m),v=new Date(d);v.setHours(23,59,59,0);const y=!n&&s.isToday(d)&&!n++;return{startDate:d,formattedDate:s.formatDateLite(d),endDate:v,content:d.getDate(),today:y,outOfScope:d.getMonth()!==l,class:`vuecal__cell--day${d.getDay()||7}`}}),(this.hideWeekends||this.hideWeekdays.length)&&(t=t.filter(u=>{const m=u.startDate.getDay()||7;return!(this.hideWeekends&&m>=6||this.hideWeekdays.length&&this.hideWeekdays.includes(m))}));break}case"week":{n=!1;const l=this.view.startDate,c=this.weekDays;t=c.map((u,m)=>{const d=s.addDays(l,this.startWeekOnSunday&&this.hideWeekends?m-1:m),v=new Date(d);v.setHours(23,59,59,0);const y=(d.getDay()||7)-1;return{startDate:d,formattedDate:s.formatDateLite(d),endDate:v,today:!n&&s.isToday(d)&&!n++,specialHours:this.specialDayHours[y]||[]}}).filter((u,m)=>!c[m].hide);break}case"day":{const l=this.view.startDate,c=new Date(this.view.startDate);c.setHours(23,59,59,0);const u=(l.getDay()||7)-1;t=[{startDate:l,formattedDate:s.formatDateLite(l),endDate:c,today:s.isToday(l),specialHours:this.specialDayHours[u]||[]}];break}}return t},visibleDaysCount(){return this.isDayView?1:7-this.weekDays.reduce((s,t)=>s+t.hide,0)},cellWidth(){return 100/this.visibleDaysCount},cssClasses(){const{resizeAnEvent:s,dragAnEvent:t,dragCreateAnEvent:a}=this.domEvents;return{[`vuecal--${this.view.id}-view`]:!0,[`vuecal--${this.locale}`]:this.locale,"vuecal--no-time":!this.time,"vuecal--view-with-time":this.hasTimeColumn,"vuecal--week-numbers":this.showWeekNumbers&&this.isMonthView,"vuecal--twelve-hour":this.twelveHour,"vuecal--click-to-navigate":this.clickToNavigate,"vuecal--hide-weekends":this.hideWeekends,"vuecal--split-days":this.hasSplits,"vuecal--sticky-split-labels":this.hasSplits&&this.stickySplitLabels,"vuecal--overflow-x":this.minCellWidth&&this.isWeekView||this.hasSplits&&this.minSplitWidth,"vuecal--small":this.small,"vuecal--xsmall":this.xsmall,"vuecal--resizing-event":s._eid,"vuecal--drag-creating-event":a.event,"vuecal--dragging-event":t._eid,"vuecal--events-on-month-view":this.eventsOnMonthView,"vuecal--short-events":this.isMonthView&&this.eventsOnMonthView==="short","vuecal--has-touch":typeof window<"u"&&"ontouchstart"in window}},isYearsOrYearView(){return["years","year"].includes(this.view.id)},isYearsView(){return this.view.id==="years"},isYearView(){return this.view.id==="year"},isMonthView(){return this.view.id==="month"},isWeekOrDayView(){return["week","day"].includes(this.view.id)},isWeekView(){return this.view.id==="week"},isDayView(){return this.view.id==="day"}},watch:{events:{handler(s,t){this.updateMutableEvents(s),this.addEventsToView()},deep:!0},locale(s){this.loadLocale(s)},selectedDate(s){this.updateSelectedDate(s)},activeView(s){this.switchView(s)}}},za=Ne(Ya,[["render",Wa]]),qa={class:"bg-white p-6 rounded-xl shadow-md hover:shadow-lg transition-shadow"},Ga={class:"flex justify-between items-center mb-4"},Ka={class:"flex gap-3"},Ja={class:"flex rounded-md shadow-sm mr-3"},Za={key:0,class:"mb-4 bg-gray-50 p-4 rounded-lg"},Xa={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},Qa=["value"],el={class:"mt-1 relative rounded-md shadow-sm"},tl={key:1,class:"text-center text-gray-600 text-sm animate-pulse py-4"},sl={key:2,class:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-md"},al={key:3},ll={key:0,class:"space-y-4"},il={key:0,class:"flex justify-between"},nl={class:"flex-grow"},ol={class:"text-sm text-red-500 italic"},rl={class:"flex items-center mt-1"},dl={class:"text-xs text-gray-500"},ul={key:1},cl={class:"flex-grow"},ml={class:"flex justify-between items-center mb-3"},vl={class:"text-sm text-gray-600 bg-blue-100 px-2 py-1 rounded-full"},pl={class:"mb-3"},hl={class:"text-sm text-gray-700 ml-6"},gl={class:"mb-3"},yl={class:"text-sm text-gray-700 ml-6"},fl={class:"mb-2"},bl={class:"text-sm text-gray-700 ml-6"},_l={class:"flex items-center mt-3 pt-2 border-t border-blue-200"},wl={class:"text-xs text-gray-500"},xl={key:1,class:"text-gray-400 text-sm"},kl={key:4,class:"mt-4"},Dl={class:"flex justify-between items-center mb-6"},Cl={class:"text-lg font-medium text-gray-900"},El=["innerHTML"],Tl=["innerHTML"],$l={key:0,class:"mt-1 text-xs p-1 rounded bg-red-50 border-l-2 border-red-500 text-red-700"},Sl={class:"mt-6 bg-white rounded-lg shadow p-4"},Ml={key:0},jl={class:"font-medium text-gray-800 mb-2"},Vl={class:"font-medium text-blue-800"},Al={class:"text-sm text-gray-600 mt-1"},Il={key:1,class:"text-gray-500 text-sm"},Ol={__name:"DailyStandups",props:{projectId:{type:Number,required:!0},users:{type:Array,default:()=>[]}},emits:["standupAdded"],setup(s,{emit:t}){const a=s,n=k("list"),i=k(!1),l=k(!1),c=k(""),u=k([]),m=k(""),d=ke({startDate:"",endDate:"",search:"",userId:""}),v=_=>{const x=ce(_);return x.isValid()?{start:x.clone().startOf("month").format("YYYY-MM-DD"),end:x.clone().endOf("month").format("YYYY-MM-DD")}:(console.warn("getMonthRange received an invalid input, defaulting to current date:",_),{start:ce().startOf("month").format("YYYY-MM-DD"),end:ce().endOf("month").format("YYYY-MM-DD")})};let y=null;const w=()=>{clearTimeout(y),y=setTimeout(()=>{D()},500)},C=async()=>{l.value=!0,c.value="";try{const _=new URLSearchParams;d.startDate&&_.append("start_date",d.startDate),d.endDate&&_.append("end_date",d.endDate),d.search&&_.append("search",d.search),d.userId&&_.append("user_id",String(d.userId));const x=_.toString(),j=`/api/projects/${a.projectId}/sections/notes?type=standup${x?`&${x}`:""}`,Z=await window.axios.get(j);u.value=Z.data.filter(ie=>ie.type==="standup")}catch(_){console.error("Error fetching project standups:",_),c.value="Failed to load standups. Please try again."}finally{l.value=!1}},D=()=>{C()},T=()=>{d.search="",d.userId="",d.startDate="",d.endDate="",C()},g=()=>{m.value=ce(m.value).subtract(1,"month").format("YYYY-MM-DD")},f=()=>{m.value=ce(m.value).add(1,"month").format("YYYY-MM-DD")};re(()=>m.value,_=>{if(n.value==="calendar"&&_){const x=v(_);d.startDate=x.start,d.endDate=x.end,C()}}),re(()=>n.value,_=>{_==="calendar"?(d.search="",d.userId="",m.value=v(new Date).start):(d.startDate="",d.endDate="",C())});const S=P(()=>(u.value||[]).map(_=>{var Z;if(!(_!=null&&_.created_at))return null;const x=ce(_.created_at);if(!x.isValid())return null;const j=I(_.content);return{start:x.format("YYYY-MM-DD HH:mm"),end:x.format("YYYY-MM-DD HH:mm"),title:`${((Z=_.user)==null?void 0:Z.name)||"Unknown"} - Standup`,content:`Yesterday: ${j.yesterday}
Today: ${j.today}
Blockers: ${j.blockers}`,class:"standup-event",standupData:_}}).filter(Boolean));fe(()=>{C()});const V=P(()=>{if(!u.value)return[];let _=[...u.value];if(d.startDate&&(_=_.filter(x=>x.created_at&&ce(x.created_at).isSameOrAfter(d.startDate,"day"))),d.endDate&&(_=_.filter(x=>x.created_at&&ce(x.created_at).isSameOrBefore(d.endDate,"day"))),d.userId&&(_=_.filter(x=>x.user_id===parseInt(d.userId))),d.search){const x=d.search.toLowerCase();_=_.filter(j=>j.content&&j.content!=="[Encrypted content could not be decrypted]"&&j.content.toLowerCase().includes(x))}return _.sort((x,j)=>ce(j.created_at).valueOf()-ce(x.created_at).valueOf())}),R=_=>{const x=ce(_).day();return x>=1&&x<=5},U=_=>ce(_).isBefore(ce(),"day"),M=(_,x)=>ce(_).isSame(x,"day"),I=_=>{var H,A,$,O;if(!_||typeof _!="string"||_==="[Encrypted content could not be decrypted]"||_.trim()==="")return{yesterday:"N/A",today:"N/A",blockers:"N/A",date:"N/A"};const x=((H=_.match(/\*\*Yesterday:\*\* ([^\n]+)/))==null?void 0:H[1].trim())||"Nothing",j=((A=_.match(/\*\*Today:\*\* ([^\n]+)/))==null?void 0:A[1].trim())||"Nothing",Z=(($=_.match(/\*\*Blockers:\*\* ([^\n]+)/))==null?void 0:$[1].trim())||"None",ie=((O=_.match(/\*\*Daily Standup - ([^*]+)\*\*/))==null?void 0:O[1].trim())||ce().format("L");return{yesterday:x,today:j,blockers:Z,date:ie}},b=P(()=>{const _={};return(u.value||[]).forEach(x=>{if(!(x!=null&&x.created_at))return;const j=ce(x.created_at).format("YYYY-MM-DD");_[j]||(_[j]=[]),_[j].push(x)}),_});return(_,x)=>(o(),r("div",qa,[e("div",Ga,[x[11]||(x[11]=e("h4",{class:"text-lg font-semibold text-gray-900"},"Daily Standups",-1)),e("div",Ka,[e("div",Ja,[e("button",{type:"button",onClick:x[0]||(x[0]=j=>n.value="list"),class:Q([n.value==="list"?"bg-indigo-100 text-indigo-700":"bg-white text-gray-700 hover:text-gray-500","px-4 py-2 text-sm font-medium rounded-l-md border border-gray-300 focus:z-10 focus:outline-none focus:ring-1 focus:ring-indigo-500"])},x[8]||(x[8]=[e("span",{class:"flex items-center"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 6h16M4 10h16M4 14h16M4 18h16"})]),B(" List ")],-1)]),2),e("button",{type:"button",onClick:x[1]||(x[1]=j=>n.value="calendar"),class:Q([n.value==="calendar"?"bg-indigo-100 text-indigo-700":"bg-white text-gray-700 hover:text-gray-500","px-4 py-2 text-sm font-medium rounded-r-md border border-gray-300 focus:z-10 focus:outline-none focus:ring-1 focus:ring-indigo-500"])},x[9]||(x[9]=[e("span",{class:"flex items-center"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})]),B(" Calendar ")],-1)]),2)]),p(ue,{class:"bg-blue-600 hover:bg-blue-700 transition-colors",onClick:x[2]||(x[2]=j=>i.value=!0)},{default:N(()=>x[10]||(x[10]=[B(" Submit Standup ",-1)])),_:1,__:[10]})])]),n.value==="list"?(o(),r("div",Za,[e("div",Xa,[e("div",null,[x[12]||(x[12]=e("label",{for:"standupStartDate",class:"block text-sm font-medium text-gray-700 mb-1"},"From Date",-1)),me(e("input",{type:"date",id:"standupStartDate","onUpdate:modelValue":x[3]||(x[3]=j=>d.startDate=j),class:"mt-1 block w-full border-gray-300 focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md",onChange:D},null,544),[[be,d.startDate]])]),e("div",null,[x[13]||(x[13]=e("label",{for:"standupEndDate",class:"block text-sm font-medium text-gray-700 mb-1"},"To Date",-1)),me(e("input",{type:"date",id:"standupEndDate","onUpdate:modelValue":x[4]||(x[4]=j=>d.endDate=j),class:"mt-1 block w-full border-gray-300 focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md",onChange:D},null,544),[[be,d.endDate]])]),e("div",null,[x[15]||(x[15]=e("label",{for:"standupUserFilter",class:"block text-sm font-medium text-gray-700 mb-1"},"User",-1)),me(e("select",{id:"standupUserFilter","onUpdate:modelValue":x[5]||(x[5]=j=>d.userId=j),class:"mt-1 block w-full border-gray-300 focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md",onChange:D},[x[14]||(x[14]=e("option",{value:""},"All Users",-1)),(o(!0),r(J,null,ee(a.users,j=>(o(),r("option",{key:j.id,value:j.id},h(j.name),9,Qa))),128))],544),[[Ye,d.userId]])]),e("div",null,[x[17]||(x[17]=e("label",{for:"standupSearchFilter",class:"block text-sm font-medium text-gray-700 mb-1"},"Search Content",-1)),e("div",el,[me(e("input",{type:"text",id:"standupSearchFilter","onUpdate:modelValue":x[6]||(x[6]=j=>d.search=j),class:"focus:ring-indigo-500 focus:border-indigo-500 block w-full pr-10 sm:text-sm border-gray-300 rounded-md",placeholder:"Search in standup content...",onInput:w},null,544),[[be,d.search]]),x[16]||(x[16]=e("div",{class:"absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none"},[e("svg",{class:"h-5 w-5 text-gray-400",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},[e("path",{"fill-rule":"evenodd",d:"M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z","clip-rule":"evenodd"})])],-1))])])]),e("div",{class:"mt-3 flex justify-end"},[e("button",{type:"button",class:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",onClick:T}," Reset Filters ")])])):E("",!0),l.value?(o(),r("div",tl,"Loading standups...")):c.value?(o(),r("div",sl,h(c.value),1)):n.value==="list"?(o(),r("div",al,[V.value.length?(o(),r("div",ll,[(o(!0),r(J,null,ee(V.value,j=>{var Z,ie;return o(),r("div",{key:j.id,class:"p-4 bg-blue-50 rounded-md shadow-sm hover:bg-blue-100 transition-colors border-l-4 border-blue-500"},[j.content==="[Encrypted content could not be decrypted]"?(o(),r("div",il,[e("div",nl,[e("p",ol,[B(h(j.content),1),x[18]||(x[18]=e("span",{class:"text-xs text-red-400 block mt-1"},"(There was an issue decrypting this standup. Please contact an administrator.)",-1))]),e("div",rl,[e("p",dl,"Submitted by "+h(((Z=j.user)==null?void 0:Z.name)||"Unknown")+" on "+h(K(ce)(j.created_at).format("L")),1)])])])):(o(),r("div",ul,[e("div",cl,[e("div",ml,[x[19]||(x[19]=e("h3",{class:"text-md font-bold text-gray-800"},"Daily Standup",-1)),e("span",vl,h(I(j.content).date),1)]),e("div",pl,[x[20]||(x[20]=e("div",{class:"flex items-center mb-1"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 text-blue-600 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})]),e("span",{class:"font-semibold text-sm text-gray-700"},"Yesterday:")],-1)),e("p",hl,h(I(j.content).yesterday),1)]),e("div",gl,[x[21]||(x[21]=e("div",{class:"flex items-center mb-1"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 text-green-600 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})]),e("span",{class:"font-semibold text-sm text-gray-700"},"Today:")],-1)),e("p",yl,h(I(j.content).today),1)]),e("div",fl,[x[22]||(x[22]=e("div",{class:"flex items-center mb-1"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 text-red-600 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})]),e("span",{class:"font-semibold text-sm text-gray-700"},"Blockers:")],-1)),e("p",bl,h(I(j.content).blockers),1)]),e("div",_l,[e("p",wl,"Submitted by "+h(((ie=j.user)==null?void 0:ie.name)||"Unknown")+" on "+h(K(ce)(j.created_at).format("L")),1)])])]))])}),128))])):(o(),r("p",xl,"No daily standups found for the selected criteria."))])):n.value==="calendar"?(o(),r("div",kl,[e("div",Dl,[e("button",{onClick:g,class:"p-2 rounded-full bg-gray-100 hover:bg-gray-200 transition-colors"},x[23]||(x[23]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])),e("h3",Cl,h(m.value?K(ce)(m.value).format("MMMM YYYY"):"Loading..."),1),e("button",{onClick:f,class:"p-2 rounded-full bg-gray-100 hover:bg-gray-200 transition-colors"},x[24]||(x[24]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)]))]),p(K(za),{class:"vuecal--blue-theme","active-view":"month",events:S.value,"selected-date":m.value,"hide-title-bar":"","disable-views":["week","day","years","year"],twelveHour:!0,"time-from":480,"time-to":1200,"time-step":30,"events-on-month-view":"short"},{event:N(({event:j})=>[e("div",{class:"vuecal__event-title",innerHTML:j.title},null,8,El),e("div",{class:"vuecal__event-content",innerHTML:j.content},null,8,Tl)]),"cell-content":N(({view:j,date:Z})=>[j.id==="month"?(o(),r(J,{key:0},[Z&&R(Z)&&U(Z)&&!S.value.some(ie=>M(ie.start,Z))?(o(),r("div",$l," No standups ")):E("",!0)],64)):E("",!0)]),_:1},8,["events","selected-date"]),x[26]||(x[26]=ls('<div class="mt-4 flex items-center space-x-4 text-sm"><div class="flex items-center"><span class="inline-block w-3 h-3 bg-blue-50 border-l-2 border-blue-500 mr-1"></span><span>Standup submitted</span></div><div class="flex items-center"><span class="inline-block w-3 h-3 bg-red-50 border-l-2 border-red-500 mr-1"></span><span>Missing standup</span></div></div>',1)),e("div",Sl,[x[25]||(x[25]=e("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"Standups Outside Current Month View",-1)),Object.entries(b.value).some(([j])=>!K(ce)(j).isSame(m.value,"month"))?(o(),r("div",Ml,[(o(!0),r(J,null,ee(Object.entries(b.value).filter(([j])=>!K(ce)(j).isSame(m.value,"month")).sort((j,Z)=>K(ce)(j[0]).valueOf()-K(ce)(Z[0]).valueOf()),([j,Z])=>(o(),r("div",{key:j,class:"mb-4"},[e("div",jl,h(K(ce)(j).format("dddd, MMMM Do YYYY")),1),(o(!0),r(J,null,ee(Z,ie=>{var H;return o(),r("div",{key:ie.id,class:"p-2 mb-2 rounded bg-blue-50 border-l-2 border-blue-500"},[e("div",Vl,h(((H=ie.user)==null?void 0:H.name)||"Unknown"),1),e("div",Al,h(K(ce)(ie.created_at).format("LT")),1)])}),128))]))),128))])):(o(),r("div",Il,"No standups outside the current month view."))])])):E("",!0),p(bt,{show:i.value,onClose:x[7]||(x[7]=j=>i.value=!1),onStandupAdded:C,projectId:s.projectId},null,8,["show","projectId"])]))}},Ll={class:"relative"},Ul={key:0,class:"text-gray-400 text-sm"},Nl=["onClick"],Pl=["placeholder"],Rl={key:0,class:"absolute z-50 w-full bg-white border border-gray-300 rounded-md shadow-lg mt-1 max-h-60 overflow-y-auto"},Fl={class:"py-1"},Bl={key:0,class:"px-4 py-2 text-gray-500 text-sm"},Hl=["onClick"],Wl={__name:"CustomMultiSelect",props:{modelValue:{type:Array,default:()=>[]},options:{type:Array,default:()=>[],required:!0},placeholder:{type:String,default:"Select items"},labelKey:{type:String,default:"name"},trackBy:{type:String,default:"id"}},emits:["update:modelValue"],setup(s,{emit:t}){const a=s,n=t,i=k(!1),l=k(""),c=P(()=>{if(!l.value)return a.options;const v=l.value.toLowerCase();return a.options.filter(y=>y[a.labelKey].toLowerCase().includes(v))});re(()=>a.modelValue,v=>{},{deep:!0});const u=v=>{const y=[...a.modelValue],w=y.findIndex(C=>C===v[a.trackBy]);w===-1?y.push(v[a.trackBy]):y.splice(w,1),n("update:modelValue",y),l.value=""},m=v=>{const y=a.options.find(w=>w[a.trackBy]===v);return y?y[a.labelKey]:""},d=v=>a.modelValue.includes(v);return(v,y)=>{const w=is("click-outside");return me((o(),r("div",Ll,[e("div",{class:"flex flex-wrap items-center w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm cursor-pointer min-h-[38px] bg-white focus-within:border-indigo-500 focus-within:ring-indigo-500",onClick:y[2]||(y[2]=C=>i.value=!i.value)},[s.modelValue.length===0&&!l.value?(o(),r("span",Ul,h(s.placeholder),1)):E("",!0),(o(!0),r(J,null,ee(s.modelValue,C=>(o(),r("div",{key:C,class:"inline-flex items-center bg-indigo-100 text-indigo-800 text-xs font-medium px-2.5 py-0.5 rounded mr-2 mb-1"},[B(h(m(C))+" ",1),e("button",{type:"button",onClick:we(D=>u(s.options.find(T=>T[s.trackBy]===C)),["stop"]),class:"ml-1 text-indigo-800 hover:text-indigo-900 focus:outline-none"},y[3]||(y[3]=[e("svg",{class:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]),8,Nl)]))),128)),me(e("input",{type:"text","onUpdate:modelValue":y[0]||(y[0]=C=>l.value=C),onInput:y[1]||(y[1]=C=>i.value=!0),class:"flex-grow border-none focus:ring-0 p-0 text-sm placeholder-gray-400 bg-transparent outline-none",placeholder:s.modelValue.length===0?"Search...":""},null,40,Pl),[[be,l.value]])]),i.value?(o(),r("div",Rl,[e("ul",Fl,[c.value.length===0?(o(),r("li",Bl,"No items found.")):E("",!0),(o(!0),r(J,null,ee(c.value,C=>(o(),r("li",{key:C[s.trackBy],class:Q(["px-4 py-2 cursor-pointer hover:bg-gray-100 text-sm",{"bg-indigo-50 text-indigo-900":d(C[s.trackBy])}]),onClick:D=>u(C)},h(C[s.labelKey]),11,Hl))),128))])])):E("",!0)])),[[w,()=>i.value=!1]])}}},Le=Ee(Wl,[["__scopeId","data-v-5326f069"]]),Yl={class:"mt-6 space-y-6"},zl={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},ql={class:"flex items-center"},Gl={class:"flex items-center"},Kl={__name:"MeetingModal",props:{show:{type:Boolean,default:!1},projectId:{type:Number,required:!0},projectUsers:{type:Array,default:()=>[]}},emits:["close","saved"],setup(s,{emit:t}){const a=s,n=t,i=()=>Intl.DateTimeFormat().resolvedOptions().timeZone,l=["Africa/Cairo","Africa/Johannesburg","Africa/Lagos","America/Anchorage","America/Bogota","America/Chicago","America/Denver","America/Los_Angeles","America/Mexico_City","America/New_York","America/Phoenix","America/Sao_Paulo","America/Toronto","America/Vancouver","Asia/Dubai","Asia/Hong_Kong","Asia/Jerusalem","Asia/Kolkata","Asia/Seoul","Asia/Shanghai","Asia/Singapore","Asia/Tokyo","Australia/Melbourne","Australia/Perth","Australia/Sydney","Europe/Amsterdam","Europe/Berlin","Europe/Dublin","Europe/Istanbul","Europe/London","Europe/Madrid","Europe/Moscow","Europe/Paris","Europe/Rome","Pacific/Auckland","Pacific/Honolulu","UTC","GMT","Europe/Belfast","America/Adak","America/Boise","America/Detroit","America/Indianapolis","America/Juneau","America/Louisville","America/Menominee","America/Nome","America/Sitka","America/Yakutat","Asia/Karachi","Asia/Kolkata","Pacific/Auckland","Pacific/Chatham","Europe/Athens","Europe/Brussels","Europe/Budapest","Europe/Copenhagen","Europe/Helsinki","Europe/Lisbon","Europe/Oslo","Europe/Stockholm","Europe/Zurich","Europe/Vienna","Europe/Warsaw","Europe/Zurich","Europe/Sofia","Europe/Prague","Europe/Malta","Europe/Luxembourg","Europe/Kiev","Europe/Rome"].sort(),c=P(()=>l.map(f=>({value:f,label:f}))),u=P(()=>{const f=i(),S=l.includes(f);return console.log("DEBUG: Is detected timezone in list?",S,"Detected:",f),S?f:(console.log("DEBUG: Falling back to UTC for timezone as detected timezone not in list."),"UTC")}),m=ke({summary:"",description:"",start_datetime:"",end_datetime:"",attendee_user_ids:[],location:"",with_google_meet:!0,timezone:u.value,enable_recording:!1}),d=()=>{m.summary="",m.description="",m.attendee_user_ids=[],m.location="",m.with_google_meet=!0,m.timezone=u.value,m.enable_recording=!1,y(),console.log("DEBUG: Form reset. Current timezone in form:",m.timezone)},v=f=>{const S=new Date(f),V=S.getFullYear(),R=String(S.getMonth()+1).padStart(2,"0"),U=String(S.getDate()).padStart(2,"0"),M=String(S.getHours()).padStart(2,"0"),I=String(S.getMinutes()).padStart(2,"0");return`${V}-${R}-${U}T${M}:${I}`},y=()=>{const f=new Date,S=new Date(f.getTime()+3600*1e3),V=new Date(f.getTime()+7200*1e3);m.start_datetime=v(S),m.end_datetime=v(V),console.log("DEBUG: Default times set. Start:",m.start_datetime,"End:",m.end_datetime)};y(),re(()=>a.show,f=>{f&&d()},{immediate:!0});const w=f=>f?(console.log(f),f.replace("T"," ")+":00"):"",C=f=>{const S={...f};return S.start_datetime=w(f.start_datetime),S.end_datetime=w(f.end_datetime),console.log(S),S},D=P(()=>`/api/projects/${a.projectId}/meetings`),T=f=>{n("saved",f)},g=f=>{console.error("DEBUG: MeetingModal submission error:",f)};return(f,S)=>(o(),X(Ce,{show:s.show,title:"Schedule a Meeting","api-endpoint":D.value,"http-method":"post","form-data":m,"format-data-for-api":C,"submit-button-text":"Schedule Meeting","success-message":"Meeting scheduled successfully!",onClose:S[9]||(S[9]=V=>f.$emit("close")),onSubmitted:T,onError:g},{default:N(({errors:V})=>[e("div",Yl,[e("div",null,[p(q,{for:"summary",value:"Meeting Title"}),p(oe,{id:"summary",modelValue:m.summary,"onUpdate:modelValue":S[0]||(S[0]=R=>m.summary=R),type:"text",class:"mt-1 block w-full",placeholder:"Project Status Meeting",required:""},null,8,["modelValue"]),p(ae,{message:V.summary?V.summary[0]:"",class:"mt-2"},null,8,["message"])]),e("div",null,[p(q,{for:"description",value:"Description"}),me(e("textarea",{id:"description","onUpdate:modelValue":S[1]||(S[1]=R=>m.description=R),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",rows:"3",placeholder:"Meeting agenda and details..."},null,512),[[be,m.description]]),p(ae,{message:V.description?V.description[0]:"",class:"mt-2"},null,8,["message"])]),e("div",zl,[e("div",null,[p(q,{for:"start_datetime",value:"Start Date & Time"}),p(oe,{id:"start_datetime",modelValue:m.start_datetime,"onUpdate:modelValue":S[2]||(S[2]=R=>m.start_datetime=R),type:"datetime-local",class:"mt-1 block w-full",required:""},null,8,["modelValue"]),p(ae,{message:V.start_datetime?V.start_datetime[0]:"",class:"mt-2"},null,8,["message"])]),e("div",null,[p(q,{for:"end_datetime",value:"End Date & Time"}),p(oe,{id:"end_datetime",modelValue:m.end_datetime,"onUpdate:modelValue":S[3]||(S[3]=R=>m.end_datetime=R),type:"datetime-local",class:"mt-1 block w-full",required:""},null,8,["modelValue"]),p(ae,{message:V.end_datetime?V.end_datetime[0]:"",class:"mt-2"},null,8,["message"])])]),e("div",null,[p(q,{for:"attendees",value:"Attendees"}),p(Le,{id:"attendees",modelValue:m.attendee_user_ids,"onUpdate:modelValue":S[4]||(S[4]=R=>m.attendee_user_ids=R),options:a.projectUsers,"label-key":"name","track-by":"id",placeholder:"Select attendees",class:"mt-1"},null,8,["modelValue","options"]),S[10]||(S[10]=e("p",{class:"mt-1 text-sm text-gray-500"}," Select project members to invite to this meeting ",-1)),p(ae,{message:V.attendee_user_ids?V.attendee_user_ids[0]:"",class:"mt-2"},null,8,["message"])]),e("div",null,[p(q,{for:"location",value:"Location (Optional)"}),p(oe,{id:"location",modelValue:m.location,"onUpdate:modelValue":S[5]||(S[5]=R=>m.location=R),type:"text",class:"mt-1 block w-full",placeholder:"Office, Conference Room, etc."},null,8,["modelValue"]),p(ae,{message:V.location?V.location[0]:"",class:"mt-2"},null,8,["message"])]),e("div",null,[p(q,{for:"timezone",value:"Timezone"}),p(he,{id:"timezone",modelValue:m.timezone,"onUpdate:modelValue":S[6]||(S[6]=R=>m.timezone=R),options:c.value,"value-key":"value","label-key":"label",placeholder:"Select timezone",class:"mt-1"},null,8,["modelValue","options"]),S[11]||(S[11]=e("p",{class:"mt-1 text-sm text-gray-500"}," Select your timezone for this meeting ",-1)),p(ae,{message:V.timezone?V.timezone[0]:"",class:"mt-2"},null,8,["message"])]),e("div",ql,[me(e("input",{id:"with_google_meet","onUpdate:modelValue":S[7]||(S[7]=R=>m.with_google_meet=R),type:"checkbox",class:"h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"},null,512),[[tt,m.with_google_meet]]),S[12]||(S[12]=e("label",{for:"with_google_meet",class:"ml-2 block text-sm text-gray-900"}," Create Google Meet video conference ",-1))]),e("div",Gl,[me(e("input",{id:"enable_recording","onUpdate:modelValue":S[8]||(S[8]=R=>m.enable_recording=R),type:"checkbox",class:"h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"},null,512),[[tt,m.enable_recording]]),S[13]||(S[13]=e("label",{for:"enable_recording",class:"ml-2 block text-sm text-gray-900"}," Enable recording and transcript ",-1))])])]),_:1},8,["show","api-endpoint","form-data"]))}},Jl=Ee(Kl,[["__scopeId","data-v-4e53a3e5"]]),Zl={class:"p-6"},Xl={key:0,class:"mb-4 p-3 bg-green-100 text-green-800 rounded-md"},Ql={key:1,class:"mb-4 p-3 bg-red-100 text-red-800 rounded-md"},ei={class:"mb-4"},ti=["value"],si={class:"mt-6 flex justify-end space-x-3"},ai={__name:"ProjectMagicLinkModal",props:{show:{type:Boolean,default:!1},projectId:{type:Number,required:!0},projectClients:{type:Array,default:()=>[]}},emits:["close"],setup(s,{emit:t}){const a=s,n=t,i=k(!1),l=k(""),c=k(""),u=k(""),m=async()=>{var v,y;if(!l.value){u.value="Please select a client email";return}i.value=!0,c.value="",u.value="";try{const w=await window.axios.post(`/api/projects/${a.projectId}/magic-link`,{email:l.value});w.data.success?(c.value=w.data.message,l.value=""):u.value=w.data.message||"Failed to send magic link"}catch(w){console.error("Error sending magic link:",w),u.value=((y=(v=w.response)==null?void 0:v.data)==null?void 0:y.message)||"An error occurred while sending the magic link"}finally{i.value=!1}},d=()=>{l.value="",c.value="",u.value="",n("close")};return(v,y)=>(o(),X($e,{show:s.show,onClose:d},{default:N(()=>[e("div",Zl,[e("div",{class:"flex justify-between items-center mb-4"},[y[2]||(y[2]=e("h3",{class:"text-lg font-semibold text-gray-900"},"Send Magic Link to Client",-1)),e("button",{onClick:d,class:"text-gray-400 hover:text-gray-500"},y[1]||(y[1]=[e("svg",{class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),c.value?(o(),r("div",Xl,h(c.value),1)):E("",!0),u.value?(o(),r("div",Ql,h(u.value),1)):E("",!0),e("div",ei,[p(q,{for:"client-email",value:"Select Client"}),me(e("select",{id:"client-email","onUpdate:modelValue":y[0]||(y[0]=w=>l.value=w),class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full"},[y[3]||(y[3]=e("option",{value:""},"Select a client",-1)),(o(!0),r(J,null,ee(s.projectClients,w=>(o(),r("option",{key:w.id,value:w.email},h(w.name)+" ("+h(w.email)+") ",9,ti))),128))],512),[[Ye,l.value]]),y[4]||(y[4]=e("p",{class:"mt-2 text-sm text-gray-500"}," The magic link will be sent to the selected client's email address. ",-1))]),e("div",si,[p(ye,{onClick:d,type:"button"},{default:N(()=>y[5]||(y[5]=[B(" Cancel ",-1)])),_:1,__:[5]}),p(ue,{onClick:m,disabled:i.value||!l.value,class:"bg-purple-600 hover:bg-purple-700"},{default:N(()=>[B(h(i.value?"Sending...":"Send Magic Link"),1)]),_:1},8,["disabled"])])])]),_:1},8,["show"]))}},li={class:"mt-6 space-y-6"},ii={class:"mt-2 flex space-x-4"},ni={class:"inline-flex items-center"},oi={class:"inline-flex items-center"},ri={key:0},di={key:1},ui=["required"],ci={__name:"ResourceModal",props:{show:{type:Boolean,default:!1},projectId:{type:Number,required:!0},resource:{type:Object,default:null}},emits:["close","saved"],setup(s,{emit:t}){const a=s,n=t,i=k({name:"",type:"link",url:"",file:null,description:""}),l=k(null),c=P(()=>a.resource?`/api/projects/${a.projectId}/resources/${a.resource.id}`:`/api/projects/${a.projectId}/resources`),u=P(()=>a.resource?"put":"post"),m=P(()=>a.resource?"Update Resource":"Add Resource"),d=P(()=>a.resource?"Resource updated successfully!":"Resource added successfully!");re(()=>a.show,D=>{D&&(a.resource?i.value={name:a.resource.name,type:a.resource.type,url:a.resource.type==="link"?a.resource.url:"",file:null,description:a.resource.description||""}:i.value={name:"",type:"link",url:"",file:null,description:""},l.value&&(l.value.value=""))},{immediate:!0});const v=D=>{i.value.file=D.target.files[0]||null},y=D=>{const T=new FormData;return T.append("name",D.name||""),T.append("type",D.type||"link"),T.append("description",D.description||""),D.type==="link"?T.append("url",D.url||""):D.type==="file"&&D.file&&T.append("file",D.file),(u.value==="put"||u.value==="patch")&&T.append("_method","PUT"),T},w=D=>{n("saved",D.resource)},C=()=>{n("close")};return(D,T)=>(o(),X(Ce,{show:s.show,title:s.resource?"Edit Resource":"Add Resource","api-endpoint":c.value,"http-method":u.value,"form-data":i.value,"submit-button-text":m.value,"success-message":d.value,"format-data-for-api":y,onClose:C,onSubmitted:w},{default:N(({errors:g})=>[e("div",li,[e("div",null,[p(q,{for:"resource-type",value:"Resource Type"}),e("div",ii,[e("label",ni,[me(e("input",{type:"radio","onUpdate:modelValue":T[0]||(T[0]=f=>i.value.type=f),value:"link",class:"form-radio text-indigo-600"},null,512),[[pt,i.value.type]]),T[5]||(T[5]=e("span",{class:"ml-2 text-gray-700"},"Link",-1))]),e("label",oi,[me(e("input",{type:"radio","onUpdate:modelValue":T[1]||(T[1]=f=>i.value.type=f),value:"file",class:"form-radio text-indigo-600"},null,512),[[pt,i.value.type]]),T[6]||(T[6]=e("span",{class:"ml-2 text-gray-700"},"File",-1))])])]),e("div",null,[p(q,{for:"resource-name",value:"Name"}),p(oe,{id:"resource-name",modelValue:i.value.name,"onUpdate:modelValue":T[2]||(T[2]=f=>i.value.name=f),type:"text",class:"mt-1 block w-full",placeholder:"Enter resource name",required:""},null,8,["modelValue"]),p(ae,{message:g.name?g.name[0]:"",class:"mt-2"},null,8,["message"])]),i.value.type==="link"?(o(),r("div",ri,[p(q,{for:"resource-url",value:"URL"}),p(oe,{id:"resource-url",modelValue:i.value.url,"onUpdate:modelValue":T[3]||(T[3]=f=>i.value.url=f),type:"url",class:"mt-1 block w-full",placeholder:"https://example.com",required:""},null,8,["modelValue"]),p(ae,{message:g.url?g.url[0]:"",class:"mt-2"},null,8,["message"])])):E("",!0),i.value.type==="file"?(o(),r("div",di,[p(q,{for:"resource-file",value:"File"}),e("input",{id:"resource-file",ref_key:"fileInputRef",ref:l,type:"file",class:"mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100",onChange:v,required:!s.resource||i.value.type==="file"},null,40,ui),p(ae,{message:g.file?g.file[0]:"",class:"mt-2"},null,8,["message"])])):E("",!0),e("div",null,[p(q,{for:"resource-description",value:"Description (Optional)"}),me(e("textarea",{id:"resource-description","onUpdate:modelValue":T[4]||(T[4]=f=>i.value.description=f),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",rows:"3",placeholder:"Enter a description for this resource"},null,512),[[be,i.value.description]]),p(ae,{message:g.description?g.description[0]:"",class:"mt-2"},null,8,["message"])])])]),_:1},8,["show","title","api-endpoint","http-method","form-data","submit-button-text","success-message"]))}},mi=Ee(ci,[["__scopeId","data-v-f508dda8"]]),vi={class:"flex flex-col space-y-6"},pi={class:"grid grid-cols-1 sm:grid-cols-2 gap-6"},hi={key:0},gi={class:"grid grid-cols-1 sm:grid-cols-2 gap-6"},yi={class:"mb-4"},fi={key:0,class:"text-xs text-gray-500 mt-1"},bi={key:0,class:"text-xs text-gray-500 mt-1"},_i={class:"flex justify-between items-center mb-3"},wi={key:0,class:"flex items-center"},xi={key:1},ki={class:"bg-gray-100 p-4 rounded-lg shadow-inner min-h-[300px]"},Di={key:0,class:"flex items-center justify-center h-full"},Ci=["innerHTML"],Ei={__name:"ComposeEmailModal",props:{show:{type:Boolean,default:!1},projectId:{type:Number,required:!0},clients:{type:Array,default:()=>[]}},emits:["close"],setup(s,{emit:t}){const a=s,n=t,i=k([]),l=k(""),c=k(!1),u=k({}),m=k({}),d=k(!1),v=ke({template_id:null,template_data:{},project_id:a.projectId,client_ids:[],subject:"",greeting_name:"",custom_greeting_name:"",status:"pending_approval"});st(a.projectId);const y=P(()=>i.value.find(U=>U.id===v.template_id)),w=async U=>{d.value=!0,m.value={};const M=new Set;U.placeholders.forEach(I=>{(I.is_repeatable||I.is_selectable)&&I.source_model&&M.add(I.source_model)});try{const I=Array.from(M).map(b=>{const _=b.split("\\").pop(),x=`/api/projects/${a.projectId}/model-data/${_}`;return window.axios.get(x).then(j=>{m.value[_]=j.data})});await Promise.all(I)}catch(I){console.error("Failed to fetch source model data:",I)}finally{d.value=!1}},C=async()=>{try{const U=await window.axios.get("/api/email-templates");i.value=U.data}catch(U){console.error("Failed to fetch email templates:",U)}},D=async()=>{if(!v.template_id||v.client_ids.length===0){l.value='<p class="text-gray-500 italic">Select a template and at least one recipient to see a preview.</p>';return}c.value=!0;try{const U=v.client_ids[0],M=typeof U=="object"?U.id:U,I=await window.axios.post(`/api/projects/${a.projectId}/email-preview`,{template_id:v.template_id,client_id:M,template_data:v.template_data});l.value=I.data.body_html,I.data.subject&&(v.subject=I.data.subject)}catch(U){console.error("Failed to fetch email preview:",U),l.value='<p class="text-red-500 italic">Error loading preview.</p>'}finally{c.value=!1}};re(()=>a.show,U=>{U&&(Object.assign(v,{template_id:null,template_data:{},project_id:a.projectId,client_ids:[],subject:"",greeting_name:"",custom_greeting_name:"",status:"pending_approval"}),l.value="",u.value={},m.value={},C())}),re(y,U=>{v.template_data={},U&&U.placeholders&&(U.placeholders.forEach(M=>{M.is_dynamic?v.template_data[M.name]="":(M.is_repeatable||M.is_selectable)&&(M.is_repeatable?v.template_data[M.name]=[]:v.template_data[M.name]=null)}),w(U))});const T=async()=>{if(Array.isArray(v.client_ids)&&v.client_ids.length>0&&typeof v.client_ids[0]=="object"&&(v.client_ids=v.client_ids.map(U=>U.id)),!v.subject&&y.value&&(v.subject=y.value.subject||""),v.client_ids.length>0){const U=v.client_ids[0],M=a.clients.find(I=>I.id===U);M&&(v.greeting_name=M.name||"")}return console.log("Form data prepared:",JSON.stringify(v)),!0},g=()=>{n("close")},f=()=>{n("close")},S=P(()=>i.value.map(U=>({value:U.id,label:U.name}))),V=P(()=>y.value?y.value.placeholders.filter(U=>U.is_dynamic||U.is_repeatable||U.is_selectable):[]),R=P(()=>"/api/emails/templated");return fe(()=>{C()}),(U,M)=>(o(),X(Ce,{show:s.show,title:"Compose Email from Template","api-endpoint":R.value,"http-method":"post","form-data":v,"submit-button-text":"Submit for Approval","success-message":"Email submitted for approval successfully!",onClose:f,onSubmitted:g,"before-submit":T},{default:N(({errors:I})=>[e("div",vi,[e("div",pi,[e("div",null,[p(q,{for:"template",value:"Select Template"}),p(he,{id:"template",modelValue:v.template_id,"onUpdate:modelValue":M[0]||(M[0]=b=>v.template_id=b),options:S.value,placeholder:"Select a template","value-key":"value","label-key":"label","allow-empty":!0,class:"mt-1"},null,8,["modelValue","options"]),p(ae,{message:I.template_id?I.template_id[0]:"",class:"mt-2"},null,8,["message"])]),e("div",null,[p(q,{for:"client_ids",value:"Recipients"}),p(Le,{id:"client_ids",modelValue:v.client_ids,"onUpdate:modelValue":M[1]||(M[1]=b=>v.client_ids=b),options:s.clients,placeholder:"Select clients to send to","label-key":"name","track-by":"id","preserve-search":!0,"object-value":!0,class:"mt-1"},null,8,["modelValue","options"]),p(ae,{message:I.client_ids?I.client_ids[0]:"",class:"mt-2"},null,8,["message"])])]),y.value?(o(),r("div",hi,[M[2]||(M[2]=e("h4",{class:"text-md font-semibold text-gray-800 mb-3"},"Dynamic Placeholders",-1)),e("div",gi,[(o(!0),r(J,null,ee(V.value,b=>(o(),r("div",{key:b.id},[e("div",yi,[p(q,{for:b.name,value:b.name},null,8,["for","value"]),b.is_repeatable&&b.source_model?(o(),r(J,{key:0},[p(Le,{id:b.name,modelValue:v.template_data[b.name],"onUpdate:modelValue":_=>v.template_data[b.name]=_,options:m.value[b.source_model.split("\\").pop()]||[],placeholder:`Select one or more ${b.name}`,"label-key":b.source_attribute,"track-by":"id",class:"mt-1"},null,8,["id","modelValue","onUpdate:modelValue","options","placeholder","label-key"]),d.value?(o(),r("div",fi," Loading "+h(b.source_model.split("\\").pop())+"... ",1)):E("",!0)],64)):b.is_selectable&&b.source_model?(o(),r(J,{key:1},[p(he,{id:b.name,modelValue:v.template_data[b.name],"onUpdate:modelValue":_=>v.template_data[b.name]=_,options:m.value[b.source_model.split("\\").pop()]||[],placeholder:`Select a ${b.name}`,"value-key":b.trackBy??"id","label-key":b.source_attribute,"allow-empty":!0,class:"mt-1"},null,8,["id","modelValue","onUpdate:modelValue","options","placeholder","value-key","label-key"]),d.value?(o(),r("div",bi," Loading "+h(b.source_model.split("\\").pop())+"... ",1)):E("",!0)],64)):b.is_dynamic&&b.is_link?(o(),X(oe,{key:2,id:b.name,type:"url",class:"mt-1 block w-full",modelValue:v.template_data[b.name],"onUpdate:modelValue":_=>v.template_data[b.name]=_,placeholder:"Enter URL"},null,8,["id","modelValue","onUpdate:modelValue"])):(o(),X(oe,{key:3,id:b.name,type:"text",class:"mt-1 block w-full",modelValue:v.template_data[b.name],"onUpdate:modelValue":_=>v.template_data[b.name]=_},null,8,["id","modelValue","onUpdate:modelValue"])),p(ae,{message:I[`template_data.${b.name}`]?I[`template_data.${b.name}`][0]:"",class:"mt-2"},null,8,["message"])])]))),128))])])):E("",!0),e("div",null,[e("div",_i,[M[4]||(M[4]=e("h4",{class:"text-md font-semibold text-gray-800"},"Email Preview",-1)),p(ue,{onClick:D,disabled:!v.template_id||v.client_ids.length===0||c.value,class:Q({"opacity-50 cursor-not-allowed":!v.template_id||v.client_ids.length===0||c.value})},{default:N(()=>[c.value?(o(),r("span",wi,M[3]||(M[3]=[e("svg",{class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),B(" Loading... ",-1)]))):(o(),r("span",xi," Refresh Preview "))]),_:1},8,["disabled","class"])]),e("div",ki,[c.value?(o(),r("div",Di,M[5]||(M[5]=[e("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-500"},null,-1)]))):(o(),r("div",{key:1,innerHTML:l.value},null,8,Ci))])])])]),_:1},8,["show","api-endpoint","form-data"]))}},Ti={class:"bg-white p-6 rounded-xl shadow-md hover:shadow-lg transition-shadow mb-6"},$i={class:"flex justify-between items-center mb-4"},Si={class:"flex gap-3"},Mi={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},ji={class:"text-2xl font-bold text-gray-900 tracking-tight mb-2"},Vi={class:"text-gray-600 text-base"},Ai={class:"space-y-3 text-sm text-gray-700"},Ii={class:"flex flex-wrap gap-2 mt-2 items-center"},Oi=["href"],Li=["href"],Ui=["href"],Ni={key:3,class:"text-gray-500 text-sm"},Pi={class:"relative"},Ri=["onClick"],Fi={key:0,xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 text-indigo-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},Bi={key:1,xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 text-indigo-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},Hi={key:0,class:"resource-tooltip absolute left-0 bottom-full mb-2 w-48 z-10"},Wi={class:"bg-white rounded-md shadow-lg p-3 text-sm border border-gray-200"},Yi={class:"flex justify-between items-center mb-2"},zi={class:"font-medium text-gray-900"},qi={key:0,class:"text-gray-600 text-xs mb-2"},Gi={class:"flex justify-between mt-2 pt-2 border-t border-gray-100"},Ki=["href"],Ji={class:"flex space-x-2"},Zi=["onClick"],Xi=["onClick"],Qi={class:"p-6"},en={key:0,class:"mb-4 p-4 bg-green-50 border border-green-200 text-green-700 rounded-md"},tn={key:1,class:"mb-4 p-4 bg-red-50 border border-red-200 text-red-700 rounded-md"},sn={class:"mb-4"},an={key:0,class:"text-gray-500 text-sm mt-1"},ln={key:1,class:"text-red-500 text-sm mt-1"},nn={class:"flex justify-end mt-6"},on={__name:"ProjectGeneralInfoCard",props:{project:{type:Object,required:!0},projectId:{type:Number,required:!0},canManageProjects:{type:Boolean,required:!0},canEditProjects:{type:Boolean,required:!1},isSuperAdmin:{type:Boolean,required:!0}},emits:["openEditModal","openStandupModal","openMeetingModal","resourceSaved","openComposeModal"],setup(s,{emit:t}){const a=s,n=t,i=k(!1),l=k(null),c=k([]),u=k(!1),m=k(null),d=k(!1),v=k(!1),y=k(!1),w=k({client_ids:[]}),C=k({}),D=k(""),T=k([]),g=k(!1),f=k("");st(a.projectId);const S=async()=>{u.value=!0;try{const A=await window.axios.get(`/api/projects/${a.projectId}/resources`);A.data.success?c.value=A.data.resources:console.error("Failed to fetch resources:",A.data.message)}catch(A){console.error("Error fetching resources:",A)}finally{u.value=!1}},V=()=>{l.value=null,i.value=!0},R=A=>{l.value=A,i.value=!0},U=async A=>{if(confirm("Are you sure you want to delete this resource?"))try{const $=await window.axios.delete(`/api/projects/${a.projectId}/resources/${A}`);$.data.success?c.value=c.value.filter(O=>O.id!==A):console.error("Failed to delete resource:",$.data.message)}catch($){console.error("Error deleting resource:",$)}},M=A=>{if(l.value){const $=c.value.findIndex(O=>O.id===A.id);$!==-1&&(c.value[$]=A)}else c.value.push(A);n("resourceSaved",A)},I=A=>{m.value=m.value===A?null:A},b=()=>{m.value=null},_=A=>{if(m.value!==null){const $=A.target.closest(".resource-tooltip"),O=A.target.closest(".resource-button");!$&&!O&&b()}};fe(()=>{S(),document.addEventListener("click",_)}),ns(()=>{document.removeEventListener("click",_)});const x=async()=>{var A,$;g.value=!0,f.value="";try{const O=await window.axios.get(`/api/projects/${a.projectId}/sections/clients?type=clients`);console.log(O),T.value=O.data}catch(O){console.error("Failed to fetch project clients:",O),f.value=(($=(A=O.response)==null?void 0:A.data)==null?void 0:$.message)||"Failed to load client data."}finally{g.value=!1}},j=()=>{w.value.client_ids=[],C.value={},D.value="",v.value=!0,x()},Z=()=>{d.value=!0,x()},ie=()=>{v.value=!1},H=async()=>{if(C.value={},D.value="",y.value=!0,!w.value.client_ids||w.value.client_ids.length===0){C.value={client_ids:["Please select a client."]},y.value=!1;return}try{const A=w.value.client_ids[0];if(!T.value.find(G=>G.id===A)){C.value={client_ids:["Selected client does not have a valid email."]},y.value=!1;return}const O=await window.axios.post(`/api/projects/${a.projectId}/magic-link`,{client_id:A});O.data.success&&(D.value=O.data.message,w.value.client_ids=[])}catch(A){A.response&&A.response.status===422?C.value=A.response.data.errors:A.response&&A.response.data.message?C.value={general:[A.response.data.message]}:C.value={general:["An unexpected error occurred. Please try again."]}}finally{y.value=!1}};return(A,$)=>{var O;return o(),r(J,null,[e("div",Ti,[e("div",$i,[$[12]||($[12]=e("h4",{class:"text-lg font-semibold text-gray-900"},"General Information",-1)),e("div",Si,[p(ue,{class:"bg-blue-600 hover:bg-blue-700 transition-colors",onClick:$[0]||($[0]=G=>n("openStandupModal"))},{default:N(()=>$[8]||($[8]=[B(" Daily Standup ",-1)])),_:1,__:[8]}),s.canEditProjects||s.isSuperAdmin?(o(),X(ue,{key:0,onClick:$[1]||($[1]=G=>A.$inertia.visit("/projects/"+s.projectId+"/edit")),class:"bg-indigo-600 hover:bg-indigo-700 transition-colors"},{default:N(()=>$[9]||($[9]=[B(" Edit Project ",-1)])),_:1,__:[9]})):E("",!0),s.canManageProjects||s.isSuperAdmin?(o(),X(ue,{key:1,class:"bg-green-600 hover:bg-green-700 transition-colors",onClick:$[2]||($[2]=G=>n("openMeetingModal"))},{default:N(()=>$[10]||($[10]=[B(" Schedule Meeting ",-1)])),_:1,__:[10]})):E("",!0),s.canManageProjects||s.isSuperAdmin?(o(),X(ue,{key:2,class:"bg-blue-400 hover:bg-blue-600 transition-colors",onClick:Z},{default:N(()=>$[11]||($[11]=[B(" Compose Email ",-1)])),_:1,__:[11]})):E("",!0),s.canManageProjects?(o(),X(ue,{key:3,class:"bg-purple-600 hover:bg-purple-700 transition-colors",onClick:j,disabled:y.value},{default:N(()=>[B(h(y.value?"Sending...":"Send Magic Link"),1)]),_:1},8,["disabled"])):E("",!0)])]),e("div",Mi,[e("div",null,[e("h3",ji,h(s.project.name),1),e("p",Vi,h(s.project.description||"No description provided"),1)]),e("div",Ai,[e("p",null,[$[13]||($[13]=e("strong",{class:"text-gray-900"},"Status:",-1)),B(" "+h(((O=s.project.status)==null?void 0:O.replace("_"," ").toUpperCase())||"N/A"),1)]),e("p",null,[$[14]||($[14]=e("strong",{class:"text-gray-900"},"Project Type:",-1)),B(" "+h(s.project.project_type||"N/A"),1)]),e("p",null,[$[15]||($[15]=e("strong",{class:"text-gray-900"},"Source:",-1)),B(" "+h(s.project.source||"N/A"),1)]),e("div",Ii,[e("button",{onClick:V,class:"p-2 bg-gray-100 rounded-full hover:bg-gray-200 transition-colors",title:"Add Resource"},$[16]||($[16]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 text-indigo-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1)])),s.project.website?(o(),r("a",{key:0,href:s.project.website,target:"_blank",class:"p-2 bg-gray-100 rounded-full hover:bg-gray-200 transition-colors",title:"Visit Website"},$[17]||($[17]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 text-indigo-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9"})],-1)]),8,Oi)):E("",!0),s.project.social_media_link?(o(),r("a",{key:1,href:s.project.social_media_link,target:"_blank",class:"p-2 bg-gray-100 rounded-full hover:bg-gray-200 transition-colors",title:"Social Media"},$[18]||($[18]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 text-indigo-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"})],-1)]),8,Li)):E("",!0),s.project.google_drive_link?(o(),r("a",{key:2,href:s.project.google_drive_link,target:"_blank",class:"p-2 bg-gray-100 rounded-full hover:bg-gray-200 transition-colors",title:"Google Drive"},$[19]||($[19]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 text-indigo-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1)]),8,Ui)):E("",!0),u.value?(o(),r("div",Ni," Loading resources... ")):(o(!0),r(J,{key:4},ee(c.value,G=>(o(),r("div",{key:G.id,class:"relative"},[e("div",Pi,[e("button",{onClick:we(de=>I(G.id),["prevent"]),class:"resource-button p-2 bg-gray-100 rounded-full hover:bg-gray-200 transition-colors block"},[G.type==="link"?(o(),r("svg",Fi,$[20]||($[20]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101"},null,-1),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10.172 13.828a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.102 1.101"},null,-1)]))):(o(),r("svg",Bi,$[21]||($[21]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"},null,-1)])))],8,Ri),m.value===G.id?(o(),r("div",Hi,[e("div",Wi,[e("div",Yi,[e("h4",zi,h(G.name),1),e("button",{onClick:we(b,["prevent"]),class:"text-gray-400 hover:text-gray-600"},$[22]||($[22]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),G.description?(o(),r("p",qi,h(G.description),1)):E("",!0),e("div",Gi,[e("a",{href:G.url,target:"_blank",class:"text-xs text-indigo-600 hover:text-indigo-800"}," Open Link ",8,Ki),e("div",Ji,[e("button",{onClick:we(de=>R(G),["prevent"]),class:"p-1 text-gray-500 hover:text-indigo-600",title:"Edit"},$[23]||($[23]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1)]),8,Zi),e("button",{onClick:we(de=>U(G.id),["prevent"]),class:"p-1 text-gray-500 hover:text-red-600",title:"Delete"},$[24]||($[24]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]),8,Xi)])])]),$[25]||($[25]=e("div",{class:"absolute left-5 bottom-0 transform translate-y-1/2 rotate-45 w-2 h-2 bg-white border-r border-b border-gray-200"},null,-1))])):E("",!0)])]))),128))])])])]),p(mi,{show:i.value,"project-id":s.projectId,resource:l.value,onClose:$[3]||($[3]=G=>i.value=!1),onSaved:M},null,8,["show","project-id","resource"]),p($e,{show:v.value,onClose:ie},{default:N(()=>[e("div",Qi,[$[28]||($[28]=e("h2",{class:"text-lg font-medium text-gray-900 mb-4"}," Send Magic Link ",-1)),D.value?(o(),r("div",en,h(D.value),1)):E("",!0),C.value.general?(o(),r("div",tn,h(C.value.general[0]),1)):E("",!0),e("form",{onSubmit:we(H,["prevent"])},[e("div",sn,[p(q,{for:"client",value:"Select Client"}),g.value?(o(),r("div",an,"Loading clients...")):f.value?(o(),r("div",ln,h(f.value),1)):(o(),X(Le,{key:2,id:"client",modelValue:w.value.client_ids,"onUpdate:modelValue":$[4]||($[4]=G=>w.value.client_ids=G),options:T.value,placeholder:"Select a client","label-key":"name","track-by":"id",class:"mt-1"},null,8,["modelValue","options"])),p(ae,{message:C.value.client_ids?C.value.client_ids[0]:"",class:"mt-2"},null,8,["message"]),$[26]||($[26]=e("p",{class:"mt-2 text-sm text-gray-500"}," Select a client to send them a magic link for project access. ",-1))]),e("div",nn,[p(ye,{onClick:ie,class:"mr-3"},{default:N(()=>$[27]||($[27]=[B(" Cancel ",-1)])),_:1,__:[27]}),p(ue,{type:"submit",class:"bg-purple-600 hover:bg-purple-700 transition-colors",disabled:y.value},{default:N(()=>[B(h(y.value?"Sending...":"Send Magic Link"),1)]),_:1},8,["disabled"])])],32)])]),_:1},8,["show"]),p(Ei,{show:d.value,title:"Compose New Email","api-endpoint":"/api/emails/templated","http-method":"post",clients:T.value,"submit-button-text":"Submit for Approval","success-message":"Email submitted for approval successfully!","project-id":s.projectId,onClose:$[5]||($[5]=G=>d.value=!1),onSubmitted:$[6]||($[6]=G=>d.value=!1),onError:$[7]||($[7]=G=>console.error("Email submission error:",G))},null,8,["show","clients","project-id"])],64)}}},rn=Ee(on,[["__scopeId","data-v-5f39fde9"]]),dn={class:"grid grid-cols-2 sm:grid-cols-4 gap-4 mb-6"},un={class:"bg-white p-4 rounded-xl shadow-md hover:shadow-lg transition-shadow"},cn={class:"text-2xl font-bold text-indigo-600"},mn={class:"bg-white p-4 rounded-xl shadow-md hover:shadow-lg transition-shadow"},vn={class:"text-2xl font-bold text-indigo-600"},pn={class:"bg-white p-4 rounded-xl shadow-md hover:shadow-lg transition-shadow"},hn={class:"text-2xl font-bold text-indigo-600"},gn={class:"bg-white p-4 rounded-xl shadow-md hover:shadow-lg transition-shadow"},yn={class:"text-2xl font-bold text-indigo-600"},fn={__name:"ProjectStatsCards",props:{tasks:{type:Array,required:!0},emails:{type:Array,required:!0}},setup(s){const t=s,a=P(()=>t.tasks.filter(c=>c.status!=="Done").length),n=P(()=>t.emails.filter(c=>c.type==="received").length),i=P(()=>{const c=t.emails.filter(u=>u.status==="received"||u.type==="received");if(c.length>0){const u=[...c].sort((m,d)=>new Date(d.created_at)-new Date(m.created_at));return new Date(u[0].created_at).toLocaleDateString()}return"N/A"}),l=P(()=>{const c=t.tasks.filter(u=>u.status!=="Done");if(c.length>0){const u=c.filter(m=>m.due_date);if(u.length>0)return[...u].sort((d,v)=>new Date(d.due_date)-new Date(v.due_date))[0].due_date}return"N/A"});return(c,u)=>(o(),r("div",dn,[e("div",un,[u[0]||(u[0]=e("h4",{class:"text-sm font-semibold text-gray-500 mb-1"},"Pending Tasks",-1)),e("p",cn,h(a.value),1)]),e("div",mn,[u[1]||(u[1]=e("h4",{class:"text-sm font-semibold text-gray-500 mb-1"},"Received Emails",-1)),e("p",vn,h(n.value),1)]),e("div",pn,[u[2]||(u[2]=e("h4",{class:"text-sm font-semibold text-gray-500 mb-1"},"Last Email Received",-1)),e("p",hn,h(i.value),1)]),e("div",gn,[u[3]||(u[3]=e("h4",{class:"text-sm font-semibold text-gray-500 mb-1"},"Next Task Deadline",-1)),e("p",yn,h(l.value),1)])]))}},bn={class:"bg-white p-4 rounded-xl shadow-md mb-6"},_n={class:"border-b border-gray-200"},wn={__name:"ProjectTabsNavigation",props:{selectedTab:{type:String,default:null},canViewEmails:{type:Boolean,required:!0},canViewNotes:{type:Boolean,required:!0},canViewDeliverables:{type:Boolean,required:!0},canViewSeoReports:{type:Boolean,required:!0}},emits:["update:selectedTab"],setup(s,{expose:t,emit:a}){const n=k(null),i=s,l=a,c=P({get:()=>i.selectedTab,set:m=>l("update:selectedTab",m)});return t({scrollIntoView:m=>{n.value&&n.value.scrollIntoView(m)}}),(m,d)=>(o(),r("div",bn,[e("div",_n,[e("nav",{class:"-mb-px flex space-x-8 overflow-x-auto",ref_key:"navElement",ref:n},[e("button",{onClick:d[0]||(d[0]=v=>c.value=null),class:Q([c.value===null?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300","whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm"])}," Overview ",2),e("button",{onClick:d[1]||(d[1]=v=>c.value="tasks"),class:Q([c.value==="tasks"?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300","whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm"])}," Project Tasks ",2),s.canViewEmails?(o(),r("button",{key:0,onClick:d[2]||(d[2]=v=>c.value="emails"),class:Q([c.value==="emails"?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300","whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm"])}," Email Communication ",2)):E("",!0),s.canViewNotes?(o(),r("button",{key:1,onClick:d[3]||(d[3]=v=>c.value="notes"),class:Q([c.value==="notes"?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300","whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm"])}," Notes ",2)):E("",!0),s.canViewNotes?(o(),r("button",{key:2,onClick:d[4]||(d[4]=v=>c.value="standups"),class:Q([c.value==="standups"?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300","whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm"])}," Daily Standups ",2)):E("",!0),s.canViewDeliverables?(o(),r("button",{key:3,onClick:d[5]||(d[5]=v=>c.value="deliverables"),class:Q([c.value==="deliverables"?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300","whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm"])}," Deliverables ",2)):E("",!0),s.canViewSeoReports?(o(),r("button",{key:4,onClick:d[6]||(d[6]=v=>c.value="seo-reports"),class:Q([c.value==="seo-reports"?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300","whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm"])}," SEO Reports ",2)):E("",!0)],512)])]))}},xn={class:"space-y-4"},kn={key:0,class:"text-sm text-gray-500"},Dn={class:"flex justify-between items-center"},Cn={key:0,class:"text-sm text-gray-500"},En="put",Tn="Update Task",$n="Task updated successfully!",Sn={__name:"EditTaskModal",props:{show:Boolean,projectId:Number,selectedTask:Object,projectUsers:Array,taskTypes:Array,milestones:Array,loadingTaskTypes:Boolean,loadingMilestones:Boolean},emits:["close","saved","open-add-milestone-modal"],setup(s,{emit:t}){const a=s,n=t,i=ke({name:"",description:"",assigned_to_user_id:null,due_date:null,status:"To Do",task_type_id:null,milestone_id:null}),l=["To Do","In Progress","Done","Blocked","Archived"],c=P(()=>"Edit Task"),u=P(()=>{var D;return`/api/tasks/${(D=a.selectedTask)==null?void 0:D.id}`});re(()=>[a.show,a.selectedTask],([D,T],[g,f]=[])=>{var S;if(D&&T){let V=null;if(T.milestone){const M=a.milestones.find(I=>I.name===T.milestone);M&&(V=M.id)}else T.milestone_id&&(V=T.milestone_id);let R=null;if(T.task_type){const M=a.taskTypes.find(I=>I.name===T.task_type);M&&(R=M.id)}else T.task_type_id&&(R=T.task_type_id);let U=null;if(T.assigned_to&&T.assigned_to!=="Unassigned"){const M=(S=a.projectUsers)==null?void 0:S.find(I=>I.name===T.assigned_to);M&&(U=M.id)}else T.assigned_to_id&&(U=T.assigned_to_id);Object.assign(i,{name:T.title,description:T.description||"",assigned_to_user_id:U,due_date:T.due_date||null,status:T.status,task_type_id:R,milestone_id:V})}else D||Object.assign(i,{name:"",description:"",assigned_to_user_id:null,due_date:null,status:"To Do",task_type_id:null,milestone_id:null})},{immediate:!0});const m=D=>{n("saved",D),n("close")},d=()=>{n("open-add-milestone-modal")},v=()=>{n("close")},y=P(()=>a.projectUsers.map(D=>({value:D.id,label:D.name}))),w=P(()=>a.taskTypes.map(D=>({value:D.id,label:D.name}))),C=P(()=>a.milestones.map(D=>({value:D.id,label:D.name})));return(D,T)=>(o(),X(Ce,{show:s.show,title:c.value,"api-endpoint":u.value,"http-method":En,"form-data":i,"submit-button-text":Tn,"success-message":$n,onClose:v,onSubmitted:m},{default:N(({errors:g})=>[e("div",xn,[e("div",null,[p(q,{for:"task-name",value:"Task Name"}),p(oe,{id:"task-name",modelValue:i.name,"onUpdate:modelValue":T[0]||(T[0]=f=>i.name=f),type:"text",class:"mt-1 block w-full",placeholder:"Enter task name",required:""},null,8,["modelValue"]),p(ae,{message:g.name?g.name[0]:"",class:"mt-2"},null,8,["message"])]),e("div",null,[p(q,{for:"task-description",value:"Description"}),me(e("textarea",{id:"task-description","onUpdate:modelValue":T[1]||(T[1]=f=>i.description=f),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",rows:"3",placeholder:"Enter task description"},null,512),[[be,i.description]]),p(ae,{message:g.description?g.description[0]:"",class:"mt-2"},null,8,["message"])]),e("div",null,[p(q,{for:"task-status",value:"Status"}),p(he,{id:"task-status",modelValue:i.status,"onUpdate:modelValue":T[2]||(T[2]=f=>i.status=f),options:l.map(f=>({value:f,label:f})),"value-key":"value","label-key":"label",placeholder:"Select status",class:"mt-1"},null,8,["modelValue","options"]),p(ae,{message:g.status?g.status[0]:"",class:"mt-2"},null,8,["message"])]),e("div",null,[p(q,{for:"task-due-date",value:"Due Date"}),p(oe,{id:"task-due-date",modelValue:i.due_date,"onUpdate:modelValue":T[3]||(T[3]=f=>i.due_date=f),type:"date",class:"mt-1 block w-full"},null,8,["modelValue"]),p(ae,{message:g.due_date?g.due_date[0]:"",class:"mt-2"},null,8,["message"])]),e("div",null,[p(q,{for:"task-assigned-to",value:"Assigned To"}),p(he,{id:"task-assigned-to",modelValue:i.assigned_to_user_id,"onUpdate:modelValue":T[4]||(T[4]=f=>i.assigned_to_user_id=f),options:y.value,"value-key":"value","label-key":"label",placeholder:"Unassigned",class:"mt-1","allow-empty":!0},null,8,["modelValue","options"]),p(ae,{message:g.assigned_to_user_id?g.assigned_to_user_id[0]:"",class:"mt-2"},null,8,["message"])]),e("div",null,[p(q,{for:"task-type",value:"Task Type"}),s.loadingTaskTypes?(o(),r("div",kn,"Loading task types...")):(o(),X(he,{key:1,id:"task-type",modelValue:i.task_type_id,"onUpdate:modelValue":T[5]||(T[5]=f=>i.task_type_id=f),options:w.value,"value-key":"value","label-key":"label",placeholder:"Select a task type",class:"mt-1","allow-empty":!0},null,8,["modelValue","options"])),p(ae,{message:g.task_type_id?g.task_type_id[0]:"",class:"mt-2"},null,8,["message"])]),e("div",null,[e("div",Dn,[p(q,{for:"task-milestone",value:"Milestone"}),e("button",{type:"button",onClick:d,class:"text-sm text-indigo-600 hover:text-indigo-800"}," + Create New Milestone ")]),s.loadingMilestones?(o(),r("div",Cn,"Loading milestones...")):(o(),X(he,{key:1,id:"task-milestone",modelValue:i.milestone_id,"onUpdate:modelValue":T[6]||(T[6]=f=>i.milestone_id=f),options:C.value,"value-key":"value","label-key":"label",placeholder:"No milestone",class:"mt-1","allow-empty":!0},null,8,["modelValue","options"])),p(ae,{message:g.milestone_id?g.milestone_id[0]:"",class:"mt-2"},null,8,["message"])])])]),_:1},8,["show","title","api-endpoint","form-data"]))}},Mn={class:"bg-white p-6 rounded-xl shadow-md hover:shadow-lg transition-shadow"},jn={class:"flex justify-between items-center mb-4"},Vn={class:"flex gap-2"},An={key:0},In={key:1},On={class:"mb-6 overflow-x-auto"},Ln={key:0,class:"text-center text-gray-600 text-sm animate-pulse py-4"},Un={key:1,class:"text-center py-4"},Nn={key:2,class:"relative py-8"},Pn={class:"relative flex justify-between"},Rn={key:0,class:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Fn={key:1,class:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Bn={key:2,class:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Hn={key:3,class:"w-2 h-2 bg-white rounded-full"},Wn={class:"absolute -top-8 transform -translate-x-1/2 left-1/2 w-32"},Yn=["title"],zn={class:"absolute top-8 transform -translate-x-1/2 left-1/2"},qn={class:"text-xs text-gray-500 whitespace-nowrap"},Gn={class:"mb-6 bg-gray-50 p-4 rounded-lg"},Kn={class:"flex flex-wrap items-center gap-4"},Jn={class:"flex-1 min-w-[200px]"},Zn={class:"flex-1 min-w-[200px]"},Xn={class:"flex-1 min-w-[200px]"},Qn={class:"flex-1 min-w-[200px]"},eo={key:0,class:"mt-3 text-sm text-gray-600"},to={key:0,class:"text-red-600 font-medium"},so={key:0,class:"text-center text-gray-600 text-sm animate-pulse py-4"},ao={key:1,class:"text-center py-4"},lo={class:"text-red-600 text-sm font-medium"},io={key:2,class:"overflow-x-auto"},no={class:"min-w-full divide-y divide-gray-200"},oo={class:"bg-white divide-y divide-gray-200"},ro={class:"px-4 py-3 text-sm text-gray-900"},uo={class:"px-4 py-3 text-sm text-gray-700"},co={class:"px-4 py-3 text-sm text-gray-700"},mo={class:"px-4 py-3 text-sm text-gray-700"},vo={class:"px-4 py-3 text-sm text-gray-700"},po={class:"px-4 py-3 text-right"},ho={class:"flex justify-end space-x-2"},go=["onClick"],yo=["onClick"],fo=["onClick"],bo=["onClick"],_o=["onClick"],wo={key:3,class:"text-center py-4"},xo={__name:"ProjectTasksTab",props:{projectId:{type:Number,required:!0},projectUsers:{type:Array,default:()=>[]},canManageProjects:{type:Boolean,required:!0},tasksFilter:{type:String,default:"all"}},emits:["tasksUpdated","openTaskDetailSidebar","open-create-task-modal","filter-changed"],setup(s,{emit:t}){const a=s,n=t,i=k([]),l=k(!0),c=k(""),u=k(!1),m=k(null),d=k(!1),v=k(!1),y=k(null),w=k([]),C=k([]),D=k(!1),T=k(!1),g=ke({status:"",assigned_to_user_id:null,milestone_id:null,due_date_range:""}),f=[{value:"",label:"All Statuses"},{value:"To Do",label:"To Do"},{value:"In Progress",label:"In Progress"},{value:"Done",label:"Done"},{value:"Blocked",label:"Blocked"},{value:"Archived",label:"Archived"}],S=P(()=>{const F=[{value:null,label:"All Users"},{value:-1,label:"Unassigned"}];return F.push(...a.projectUsers.map(L=>({value:L.id,label:L.name}))),F}),V=P(()=>{const F=[{value:null,label:"All Milestones"},{value:-1,label:"No Milestone"}];return F.push(...C.value.map(L=>({value:L.id,label:L.name}))),F}),R=[{value:"",label:"All Dates"},{value:"today",label:"Due Today"},{value:"this_week",label:"Due This Week"},{value:"next_week",label:"Due Next Week"},{value:"overdue",label:"Overdue"},{value:"no_date",label:"No Due Date"}],U=P(()=>!C.value||!C.value.length?[]:[...C.value].sort((F,L)=>F.completion_date?L.completion_date?new Date(F.completion_date)-new Date(L.completion_date):-1:1)),M=P(()=>i.value.length?i.value.filter(F=>{if(g.status&&F.status!==g.status)return!1;if(g.assigned_to_user_id!==null){const L=parseInt(g.assigned_to_user_id);if(L===-1){if(F.assigned_to!=="Unassigned"&&F.assigned_to_id!==null)return!1}else if(F.assigned_to_id!==L)return!1}if(g.milestone_id!==null){const L=parseInt(g.milestone_id);if(L===-1){if(F.milestone_id)return!1}else if(F.milestone_id!==L)return!1}if(g.due_date_range){const L=new Date;L.setHours(0,0,0,0);const Y=F.due_date?new Date(F.due_date):null;switch(g.due_date_range){case"today":if(!Y||Y.toDateString()!==L.toDateString())return!1;break;case"this_week":{if(!Y)return!1;const le=new Date(L);if(le.setDate(L.getDate()+(6-L.getDay())),Y<L||Y>le)return!1;break}case"next_week":{if(!Y)return!1;const le=new Date(L);le.setDate(L.getDate()+(7-L.getDay()));const Pe=new Date(le);if(Pe.setDate(le.getDate()+6),Y<le||Y>Pe)return!1;break}case"overdue":{if(!Y||Y>=L)return!1;break}case"no_date":{if(Y)return!1;break}}}return!0}):[]),I=()=>{g.status="",g.assigned_to_user_id=null,g.milestone_id=null,g.due_date_range=""},b=async()=>{l.value=!0,c.value="";try{const F=await window.axios.get(`/api/projects/${a.projectId}/tasks`);i.value=F.data,n("tasksUpdated",i.value)}catch(F){c.value="Failed to load tasks data.",console.error("Error fetching project tasks:",F),F.response&&F.response.data&&F.response.data.message&&(c.value=F.response.data.message)}finally{l.value=!1}},_=async()=>{D.value=!0;try{const F=await window.axios.get("/api/task-types");w.value=F.data}catch(F){console.error("Error fetching task types:",F)}finally{D.value=!1}},x=async()=>{T.value=!0;try{const F=await window.axios.get(`/api/projects/${a.projectId}/milestones`);C.value=F.data}catch(F){console.error("Error fetching milestones:",F)}finally{T.value=!1}},j=()=>{n("open-create-task-modal")},Z=async F=>{m.value=F,await _(),await x(),u.value=!0},ie=()=>{b()},H=F=>{console.log("ProjectTasksTab: Emitting open-task-detail-sidebar for taskId:",F.id),n("openTaskDetailSidebar",F.id)},A=()=>{d.value=!0},$=F=>{C.value.push(F),b()},O=F=>{y.value=F,v.value=!0},G=()=>{b()},de=async F=>{try{await window.axios.post(`/api/tasks/${F.id}/complete`),await b()}catch(L){console.error("Error marking task as completed:",L),alert("Failed to mark task as completed. Please try again.")}},Se=async F=>{try{await window.axios.post(`/api/tasks/${F.id}/start`),await b()}catch(L){console.error("Error starting task:",L),alert("Failed to start task. Please try again.")}};return fe(()=>{b(),_(),x()}),re(()=>a.projectUsers,()=>{}),re(()=>a.taskTypes,()=>{}),re(()=>a.milestones,()=>{}),re(()=>a.tasksFilter,F=>{F==="due-overdue"?(new Date().setHours(0,0,0,0),g.status="",g.assigned_to_user_id=null,g.milestone_id=null,g.due_date_range="overdue"):F==="all"&&(g.status="",g.assigned_to_user_id=null,g.milestone_id=null,g.due_date_range=""),n("filter-changed",F)}),(F,L)=>(o(),r("div",Mn,[e("div",jn,[L[8]||(L[8]=e("h4",{class:"text-lg font-semibold text-gray-900"},"Project Tasks",-1)),e("div",Vn,[p(ye,{onClick:b,disabled:l.value,class:"text-indigo-600 hover:text-indigo-800"},{default:N(()=>[l.value?(o(),r("span",In,"Loading...")):(o(),r("span",An,"Refresh"))]),_:1},8,["disabled"]),s.canManageProjects?(o(),X(ue,{key:0,class:"bg-indigo-600 hover:bg-indigo-700 transition-colors",onClick:j},{default:N(()=>L[7]||(L[7]=[B(" Add Task ",-1)])),_:1,__:[7]})):E("",!0)])]),e("div",On,[T.value?(o(),r("div",Ln," Loading milestones... ")):U.value.length?(o(),r("div",Nn,[L[13]||(L[13]=e("div",{class:"absolute h-1 bg-gray-200 top-1/2 left-0 right-0 transform -translate-y-1/2"},null,-1)),e("div",Pn,[(o(!0),r(J,null,ee(U.value,(Y,le)=>(o(),r("div",{key:Y.id,class:Q(["flex flex-col items-center relative z-10",{"ml-4":le===0,"mr-4":le===U.value.length-1}])},[e("div",{class:Q(["w-6 h-6 rounded-full shadow-lg flex items-center justify-center",{"bg-gray-300":Y.status==="Not Started","bg-blue-500":Y.status==="In Progress","bg-green-500":Y.status==="Completed","bg-red-500":Y.status==="Overdue"}])},[Y.status==="Completed"?(o(),r("svg",Rn,L[10]||(L[10]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)]))):Y.status==="In Progress"?(o(),r("svg",Fn,L[11]||(L[11]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 10V3L4 14h7v7l9-11h-7z"},null,-1)]))):Y.status==="Overdue"?(o(),r("svg",Bn,L[12]||(L[12]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"},null,-1)]))):(o(),r("span",Hn))],2),e("div",Wn,[e("p",{class:"text-xs font-medium text-gray-700 text-center truncate",title:Y.name},h(Y.name),9,Yn)]),e("div",zn,[e("p",qn,h(Y.completion_date?new Date(Y.completion_date).toLocaleDateString():"No date"),1)])],2))),128))])])):(o(),r("div",Un,L[9]||(L[9]=[e("p",{class:"text-gray-400 text-sm"},"No milestones found for this project.",-1)])))]),e("div",Gn,[e("div",Kn,[e("div",Jn,[p(q,{for:"status-filter",value:"Status"}),p(he,{id:"status-filter",modelValue:g.status,"onUpdate:modelValue":L[0]||(L[0]=Y=>g.status=Y),options:f,"value-key":"value","label-key":"label",placeholder:"All Statuses",class:"mt-1"},null,8,["modelValue"])]),e("div",Zn,[p(q,{for:"assigned-filter",value:"Assigned To"}),p(he,{id:"assigned-filter",modelValue:g.assigned_to_user_id,"onUpdate:modelValue":L[1]||(L[1]=Y=>g.assigned_to_user_id=Y),options:S.value,"value-key":"value","label-key":"label",placeholder:"All Users",class:"mt-1"},null,8,["modelValue","options"])]),e("div",Xn,[p(q,{for:"milestone-filter",value:"Milestone"}),p(he,{id:"milestone-filter",modelValue:g.milestone_id,"onUpdate:modelValue":L[2]||(L[2]=Y=>g.milestone_id=Y),options:V.value,"value-key":"value","label-key":"label",placeholder:"All Milestones",class:"mt-1"},null,8,["modelValue","options"])]),e("div",Qn,[p(q,{for:"due-date-filter",value:"Due Date"}),p(he,{id:"due-date-filter",modelValue:g.due_date_range,"onUpdate:modelValue":L[3]||(L[3]=Y=>g.due_date_range=Y),options:R,"value-key":"value","label-key":"label",placeholder:"All Dates",class:"mt-1"},null,8,["modelValue"])]),e("div",{class:"flex items-end"},[e("button",{type:"button",onClick:I,class:"px-3 py-2 text-sm text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-md transition-colors"}," Clear Filters ")])]),Object.values(g).some(Y=>Y!==null&&Y!=="")?(o(),r("div",eo,[e("p",null,[B(" Showing "+h(M.value.length)+" of "+h(i.value.length)+" tasks ",1),M.value.length===0?(o(),r("span",to," (No tasks match the current filters) ")):E("",!0)])])):E("",!0)]),l.value?(o(),r("div",so," Loading tasks... ")):c.value?(o(),r("div",ao,[e("p",lo,h(c.value),1)])):i.value.length?(o(),r("div",io,[e("table",no,[L[14]||(L[14]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Title"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Status"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Assigned To"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Due Date"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Milestone"),e("th",{class:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"Actions")])],-1)),e("tbody",oo,[(o(!0),r(J,null,ee(M.value,Y=>(o(),r("tr",{key:Y.id,class:Q(["hover:bg-gray-50 transition-colors",{"bg-red-50":Y.due_date&&new Date(Y.due_date)<new Date,"bg-yellow-50":Y.due_date&&new Date(Y.due_date).toDateString()===new Date().toDateString()}])},[e("td",ro,h(Y.name),1),e("td",uo,[e("span",{class:Q({"px-2 py-1 rounded-full text-xs font-medium":!0,"bg-yellow-100 text-yellow-800":Y.status==="To Do","bg-blue-100 text-blue-800":Y.status==="In Progress","bg-green-100 text-green-800":Y.status==="Done","bg-red-100 text-red-800":Y.status==="Blocked","bg-gray-100 text-gray-800":Y.status==="Archived"})},h(Y.status),3)]),e("td",co,h(Y.assigned_to),1),e("td",mo,h(Y.due_date?Y.due_date:"N/A"),1),e("td",vo,h(Y.milestone||"N/A"),1),e("td",po,[e("div",ho,[e("button",{onClick:le=>H(Y),class:"text-purple-600 hover:text-purple-800 text-sm font-medium"}," View ",8,go),e("button",{onClick:le=>Z(Y),class:"text-indigo-600 hover:text-indigo-800 text-sm font-medium"}," Edit ",8,yo),e("button",{onClick:le=>O(Y),class:"text-blue-600 hover:text-blue-800 text-sm font-medium"}," Add Note ",8,fo),Y.status==="To Do"?(o(),r("button",{key:0,onClick:le=>Se(Y),class:"text-blue-600 hover:text-blue-800 text-sm font-medium"}," Start ",8,bo)):E("",!0),Y.status!=="Done"?(o(),r("button",{key:1,onClick:le=>de(Y),class:"text-green-600 hover:text-green-800 text-sm font-medium"}," Complete ",8,_o)):E("",!0)])])],2))),128))])])])):(o(),r("div",wo,L[15]||(L[15]=[e("p",{class:"text-gray-400 text-sm"},"No tasks found for this project.",-1),e("p",{class:"text-gray-500 text-sm mt-2"},' Click the "Add Task" button to create a new task. ',-1)]))),p(Sn,{show:u.value,"project-id":s.projectId,"selected-task":m.value,"project-users":s.projectUsers,"task-types":w.value,milestones:C.value,"loading-task-types":D.value,"loading-milestones":T.value,onClose:L[4]||(L[4]=Y=>u.value=!1),onSaved:ie,onOpenAddMilestoneModal:A},null,8,["show","project-id","selected-task","project-users","task-types","milestones","loading-task-types","loading-milestones"]),p(Jt,{show:d.value,"project-id":s.projectId,onClose:L[5]||(L[5]=Y=>d.value=!1),onSaved:$},null,8,["show","project-id"]),p(Zt,{show:v.value,"task-for-note":y.value,onClose:L[6]||(L[6]=Y=>v.value=!1),onNoteAdded:G},null,8,["show","task-for-note"])]))}},ko={class:"p-6"},Do={key:0,class:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4",role:"alert"},Co={class:"block sm:inline"},Eo={class:"mb-4"},To={class:"mb-6"},$o={class:"flex justify-end space-x-3"},So={__name:"InsertLinkModal",props:{show:{type:Boolean,default:!1}},emits:["close","insert"],setup(s,{emit:t}){const a=t,n=k(""),i=k(""),l=k(""),c=()=>{if(!n.value.trim()){l.value="Link text cannot be empty.";return}let m=i.value.trim();!m.startsWith("http://")&&!m.startsWith("https://")&&(m="http://"+m);try{new URL(m)}catch{l.value="Please enter a valid URL (e.g., https://example.com or www.example.com).";return}const d=`[${n.value.trim()}] {${m}}`;a("insert",d),u()},u=()=>{n.value="",i.value="",l.value="",a("close")};return(m,d)=>(o(),X($e,{show:s.show,onClose:u,"max-width":"md"},{default:N(()=>[e("div",ko,[d[4]||(d[4]=e("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"Insert Link",-1)),l.value?(o(),r("div",Do,[e("span",Co,h(l.value),1)])):E("",!0),e("div",Eo,[p(q,{for:"link_text",value:"Link Text"}),p(oe,{id:"link_text",type:"text",class:"mt-1 block w-full",modelValue:n.value,"onUpdate:modelValue":d[0]||(d[0]=v=>n.value=v),onKeyup:Oe(c,["enter"])},null,8,["modelValue"])]),e("div",To,[p(q,{for:"link_url",value:"URL"}),p(oe,{id:"link_url",type:"text",class:"mt-1 block w-full",modelValue:i.value,"onUpdate:modelValue":d[1]||(d[1]=v=>i.value=v),placeholder:"e.g., https://www.example.com",onKeyup:Oe(c,["enter"])},null,8,["modelValue"])]),e("div",$o,[p(ye,{onClick:u},{default:N(()=>d[2]||(d[2]=[B("Cancel",-1)])),_:1,__:[2]}),p(ue,{onClick:c},{default:N(()=>d[3]||(d[3]=[B("Insert",-1)])),_:1,__:[3]})])])]),_:1},8,["show"]))}},Mo={class:"p-6"},jo={key:0,class:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4",role:"alert"},Vo={class:"block sm:inline"},Ao={class:"mb-4"},Io={class:"mb-6"},Oo={class:"flex justify-end space-x-3"},Lo={__name:"InsertListModal",props:{show:{type:Boolean,default:!1}},emits:["close","insert"],setup(s,{emit:t}){const a=t,n=k(""),i=k("bullet"),l=k(""),c=()=>{const m=n.value.split(`
`).map(y=>y.trim()).filter(y=>y!=="");if(m.length===0){l.value="Please enter at least one list item.";return}const d=i.value==="bullet"?"ul":"ol";let v=`<${d}>`;m.forEach(y=>{v+=`<li>${y}</li>`}),v+=`</${d}>`,a("insert",v),u()},u=()=>{n.value="",i.value="bullet",l.value="",a("close")};return(m,d)=>(o(),X($e,{show:s.show,onClose:u,"max-width":"md"},{default:N(()=>[e("div",Mo,[d[5]||(d[5]=e("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"Insert List",-1)),l.value?(o(),r("div",jo,[e("span",Vo,h(l.value),1)])):E("",!0),e("div",Ao,[p(q,{for:"list_items",value:"List Items (one per line)"}),me(e("textarea",{id:"list_items",rows:"6",class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full","onUpdate:modelValue":d[0]||(d[0]=v=>n.value=v),placeholder:"Enter each list item on a new line"},null,512),[[be,n.value]])]),e("div",Io,[p(q,{for:"list_type",value:"List Type"}),me(e("select",{id:"list_type",class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full","onUpdate:modelValue":d[1]||(d[1]=v=>i.value=v)},d[2]||(d[2]=[e("option",{value:"bullet"},"Bulleted List",-1),e("option",{value:"numbered"},"Numbered List",-1)]),512),[[Ye,i.value]])]),e("div",Oo,[p(ye,{onClick:u},{default:N(()=>d[3]||(d[3]=[B("Cancel",-1)])),_:1,__:[3]}),p(ue,{onClick:c},{default:N(()=>d[4]||(d[4]=[B("Insert List",-1)])),_:1,__:[4]})])])]),_:1},8,["show"]))}};function Dt(s){const t=i=>{const l=/\[([^\]]+?)\][\s\u00A0]*\{([^}]+?)\}/g;return i.replace(l,(c,u,m)=>{let d=m.trim();return!d.startsWith("http://")&&!d.startsWith("https://")&&(d=`https://${d}`),`<a href="${d}" target="_blank" style="color: #1a73e8; text-decoration: underline;">${u.trim()}</a>`})},a=i=>{const l=/<(ul|ol)>(.*?)<\/(ul|ol)>/gs;return i.replace(l,(c,u,m)=>{const d=u,v=d==="ul"?"list-style-type: disc;":"list-style-type: decimal;",y=/<li>(.*?)<\/li>/gs,w=m.replace(y,(C,D)=>`<li style="margin-bottom: 5px; font-family: 'Inter', sans-serif; font-size: 16px; line-height: 1.6; color: #1a202c;">${D}</li>`);return`<${d} style="margin: 0; padding: 0 0 0 20px; ${v}">${w}</${d}>`})};return{processedHtmlBody:P(()=>{let i=s.value;return i=t(i),i=a(i),i})}}const Uo={key:0},No={class:"mb-4"},Po={class:"mb-6"},Ro={class:"mb-2 flex justify-end space-x-2"},Fo={key:0,class:"min-h-[300px] flex items-center justify-center bg-gray-50 rounded-md"},Bo={key:1},Ho={key:0,class:"text-red-500 mb-2"},Wo={class:"mb-2 flex justify-end space-x-2"},Yo={key:1},zo={class:"mb-6"},qo={__name:"EmailActionModal",props:{show:{type:Boolean,default:!1},title:{type:String,required:!0},apiEndpoint:{type:String,required:!0},httpMethod:{type:String,default:"post"},submitButtonText:{type:String,default:"Save"},successMessage:{type:String,default:"Operation successful!"},emailId:{type:Number,required:!1},projectId:{type:Number,required:!0}},emits:["close","submitted","error","fetchEmails"],setup(s,{emit:t}){const a=s,n=t,i=ke({}),l=k(!1),c=k(!1),u=async()=>{if(a.emailId){c.value=!0;try{for(const x in i)delete i[x];if(a.title==="Reject Email"){Object.assign(i,{rejection_reason:""}),c.value=!1;return}const _=(await window.axios.get(`/api/emails/${a.emailId}/edit-content`)).data;_.body_html&&!_.body&&(_.body=_.body_html),Object.assign(i,_),console.log("Fetched email data:",i)}catch(b){console.error("Failed to fetch email data:",b),n("error",b)}finally{c.value=!1}}};re(()=>a.show,b=>{b&&a.emailId&&u()});const m=k(!1),d=k(!1),v=P(()=>(console.log("editorBodyContent computed property called"),console.log("Using localFormData.body:",i.body),i.body||"")),{processedHtmlBody:y}=Dt(v),w=b=>{const _={...b};return a.title==="Edit and Approve Email"&&(_.body=y.value),_},C=()=>{console.log("EmailActionModal is closing"),n("close")},D=b=>{n("submitted",b)},T=b=>{n("error",b)},g=()=>{m.value=!0},f=b=>{i.body+=b,m.value=!1},S=()=>{d.value=!0},V=b=>{i.body+=b,d.value=!1},R=k({}),U=k(!1),M=async()=>{U.value=!0;try{console.log("Saving email with ID:",a.emailId),console.log("Email data:",{subject:i.subject,body:i.body}),await window.axios.post(`/api/emails/${a.emailId}/update`,{subject:i.subject,body:i.body}),console.log("Email saved successfully"),alert("Email saved successfully!"),U.value=!1,n("fetchEmails"),C()}catch(b){U.value=!1,console.error("Error saving email:",b);let _="Failed to save email.";b.response&&b.response.data.message&&(_=b.response.data.message),R.value=_,alert(_)}},I=()=>{if(a.emailId){const b=`/emails/${a.emailId}/preview`;window.open(b,"_blank")}else console.warn("Cannot preview email: Email ID not available.")};return(b,_)=>(o(),r(J,null,[p(Ce,{show:s.show,title:s.title,"api-endpoint":s.apiEndpoint,"http-method":s.httpMethod,"form-data":i,"submit-button-text":s.submitButtonText,"success-message":s.successMessage,"format-data-for-api":w,onClose:C,onSubmitted:D,onError:T,"max-width":"3xl"},{default:N(({errors:x})=>[s.title==="Edit and Approve Email"?(o(),r("div",Uo,[e("div",No,[p(q,{for:"edit_subject",value:"Subject"}),p(oe,{id:"edit_subject",type:"text",class:"mt-1 block w-full",modelValue:i.subject,"onUpdate:modelValue":_[0]||(_[0]=j=>i.subject=j),required:""},null,8,["modelValue"]),p(ae,{message:x.subject?x.subject[0]:"",class:"mt-2"},null,8,["message"])]),e("div",Po,[e("div",Ro,[p(ye,{type:"button",onClick:S},{default:N(()=>_[5]||(_[5]=[B(" Insert List ",-1)])),_:1,__:[5]}),p(ye,{type:"button",onClick:g},{default:N(()=>_[6]||(_[6]=[B(" Insert Link ",-1)])),_:1,__:[6]})]),p(q,{for:"edit_body",value:"Email Body",class:"sr-only"}),l.value?(o(),r("div",Fo,_[7]||(_[7]=[e("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-500"},null,-1)]))):(o(),r("div",Bo,[v.value?E("",!0):(o(),r("div",Ho,"Warning: Email body content is empty!")),p(wt,{id:"edit_body",modelValue:i.body,"onUpdate:modelValue":_[1]||(_[1]=j=>i.body=j),value:v.value,placeholder:"Edit your email here...",height:"300px"},null,8,["modelValue","value"])])),p(ae,{message:x.body?x.body[0]:"",class:"mt-2"},null,8,["message"])]),e("div",Wo,[p(ue,{type:"button",disabled:U.value,onClick:M},{default:N(()=>[B(h(U.value?"Saving...":"Save"),1)]),_:1},8,["disabled"]),p(ye,{type:"button",onClick:I},{default:N(()=>_[8]||(_[8]=[B(" Preview Email ",-1)])),_:1,__:[8]})])])):s.title==="Reject Email"?(o(),r("div",Yo,[e("div",zo,[p(q,{for:"rejection_reason",value:"Rejection Reason"}),me(e("textarea",{id:"rejection_reason",rows:"5",class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full","onUpdate:modelValue":_[2]||(_[2]=j=>i.rejection_reason=j),required:"",placeholder:"Please provide a reason for rejecting this email (minimum 10 characters)"},null,512),[[be,i.rejection_reason]]),p(ae,{message:x.rejection_reason?x.rejection_reason[0]:"",class:"mt-2"},null,8,["message"])])])):E("",!0)]),_:1},8,["show","title","api-endpoint","http-method","form-data","submit-button-text","success-message"]),p(So,{show:m.value,onClose:_[3]||(_[3]=x=>m.value=!1),onInsert:f},null,8,["show"]),p(Lo,{show:d.value,onClose:_[4]||(_[4]=x=>d.value=!1),onInsert:V},null,8,["show"])],64))}},Go=Ee(qo,[["__scopeId","data-v-e68fe9d9"]]);function Ko(s){const t=Ue();return{userSignature:P(()=>{const n=t.value&&t.value.name?t.value.name:"",i=s.name??"",l="+61 456 639 389",c="ozeeweb.com.au",u="#1a73e8",m="#fbbc05",d="#1a202c",v="#4a5568",y="#e5e7eb",w="#f9fafb",C=`${window.location.origin}/logo.png`,D=`https://img.icons8.com/ios-filled/20/${u.substring(1)}/facebook-new.png`,T=`https://img.icons8.com/ios-filled/20/${u.substring(1)}/twitter.png`,g=`https://img.icons8.com/ios-filled/20/${u.substring(1)}/linkedin.png`,f=`https://img.icons8.com/ios-filled/20/${u.substring(1)}/instagram-new.png`;return`
            <div style="font-family: 'Inter', sans-serif; padding: 20px; border: 1px solid ${y}; margin-top: 30px; background-color: ${w}; border-radius: 8px; overflow: hidden; box-shadow: 0 0 0 3px ${m};">
                <table role="presentation" cellspacing="0" cellpadding="0" width="100%">
                    <tr>
                        <td style="vertical-align: middle;">
                            <p style="margin: 0; font-size: 18px; color: ${d};">Best Regards</p>
                            <p style="margin: 0; font-size: 18px; font-weight: bold; color: ${d};">${n}</p>
                            <p style="margin: 5px 0 5px 0; font-size: 14px; color: ${v};">${i}</p>
                            <p style="margin: 0 0 15px 0; font-size: 12px; color: ${v};">
                                Your website and social media are like your home, first impressions matter!
                            </p>
                            <table role="presentation" cellspacing="0" cellpadding="0">
                                <tr>
                                    <td style="padding-right: 15px;">
                                        <p style="margin: 0; font-size: 13px; color: ${v};">📞 ${l}</p>
                                        <p style="margin: 5px 0 0 0; font-size: 13px; color: ${v};">🌐 <a href="https://${c}" target="_blank" style="color: ${u}; text-decoration: none;">${c}</a></p>
                                    </td>
                                </tr>
                            </table>
                            <div style="margin-top: 15px; text-align: left;">
                                <a href="https://www.facebook.com/yourprofile" target="_blank" style="display: inline-block; margin-right: 8px; color: ${u}; text-decoration: none;">
                                    <img src="${D}" alt="Facebook" style="vertical-align: middle;">
                                </a>
                                <a href="https://twitter.com/yourhandle" target="_blank" style="display: inline-block; margin-right: 8px; color: ${u}; text-decoration: none;">
                                    <img src="${T}" alt="Twitter" style="vertical-align: middle;">
                                </a>
                                <a href="https://www.linkedin.com/in/yourprofile" target="_blank" style="display: inline-block; margin-right: 8px; color: ${u}; text-decoration: none;">
                                    <img src="${g}" alt="LinkedIn" style="vertical-align: middle;">
                                </a>
                                <a href="https://www.instagram.com/yourprofile" target="_blank" style="display: inline-block; margin-right: 8px; color: ${u}; text-decoration: none;">
                                    <img src="${f}" alt="Instagram" style="vertical-align: middle;">
                                </a>
                            </div>
                        </td>
                        <td style="padding-left: 20px; vertical-align: middle; width: 120px; text-align: right;">
                            <img src="${C}" alt="Company Logo" width="100" style="display: block; border-radius: 8px; margin-left: auto;">
                        </td>
                    </tr>
                </table>

                <p style="margin-top: 25px; font-size: 12px; color: ${v}; text-align: center;">
                    Powered by MMS IT & Web Solutions PTY Ltd.
                </p>
                <p style="margin-top: 10px; font-style: italic; color: ${v}; text-align: center; font-size: 13px;">
                    Please consider the environment before printing this email.
                </p>
                <p style="margin-top: 10px; text-align: center; font-size: 13px;">
                    How did I do? <a href="https://www.example.com/review" target="_blank" style="color: ${u}; text-decoration: none; font-weight: bold;">Leave a review!</a>
                </p>
            </div>
        `})}}const Jo={class:"mb-4"},Zo={key:0,class:"text-gray-500 text-sm"},Xo={key:1,class:"text-red-500 text-sm"},Qo={class:"mb-4"},er={class:"mb-6"},tr={class:"mb-2 flex justify-end space-x-2"},sr={class:"mb-4"},ar={key:0,class:"mt-2"},lr={class:"text-gray-700 text-base mb-2"},ir=["innerHTML"],nr={class:"p-6"},or={key:0,class:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4",role:"alert"},rr={class:"block sm:inline"},dr={class:"mb-4"},ur={class:"mb-6"},cr={class:"flex justify-end space-x-3"},mr={class:"p-6"},vr={key:0,class:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4",role:"alert"},pr={class:"block sm:inline"},hr={class:"mb-4"},gr={class:"mb-6"},yr={class:"flex justify-end space-x-3"},fr={__name:"ComponseEmailModal",props:{show:{type:Boolean,default:!1},projectId:{type:Number,required:!0},userProjectRole:{type:Object,required:!0}},emits:["close","submitted","error"],setup(s,{emit:t}){const a=s,n=t,i=ke({project_id:a.projectId,client_ids:[],subject:"",body:"",status:"pending_approval"}),l=k([]),c=k(!0),u=k(""),m=k(!1),d=k(""),v=k(""),y=k(""),w=k(!1),C=k(""),D=k("bullet"),T=k(""),g=k("full_name"),f=k(""),S=k([{value:"full_name",label:"Full Name"},{value:"first_name",label:"First Name"},{value:"last_name",label:"Last Name"},{value:"custom",label:"Custom"}]),{userSignature:V}=Ko(P(()=>a.userProjectRole)),R=P(()=>i.body||""),{processedHtmlBody:U}=Dt(R),M=P(()=>{if(i.client_ids&&i.client_ids.length>0){const $=i.client_ids[0],O=l.value.find(G=>G.id===$);if(O){const G=O.name.split(" ").filter(F=>F.length>0),de=G.length>0?G[0]:"",Se=G.length>1?G[G.length-1]:"";switch(g.value){case"full_name":return`Hi ${O.name},`;case"first_name":return`Hi ${de},`;case"last_name":return`Hi ${Se},`;case"custom":return`Hi ${f.value.trim()||"there"},`;default:return`Hi ${O.name},`}}}return"Hi there,"});re(()=>a.show,$=>{$&&(Object.assign(i,{project_id:a.projectId,client_ids:[],subject:"",body:"",status:"pending_approval"}),g.value="full_name",f.value="",u.value="",A())},{immediate:!0});const I=$=>{const O={...$};return O.client_ids&&Array.isArray(O.client_ids)&&(O.client_ids=O.client_ids.map(G=>({id:G}))),O.body=U.value,O.greeting_name=M.value,O.custom_greeting_name=f.value.trim(),O.first_client_id=i.client_ids&&i.client_ids.length>0?i.client_ids[0]:null,O},b=()=>{n("close")},_=$=>{n("submitted",$)},x=$=>{n("error",$)},j=()=>{d.value="",v.value="",y.value="",m.value=!0},Z=()=>{if(!d.value.trim()){y.value="Link text cannot be empty.";return}let $=v.value.trim();!$.startsWith("http://")&&!$.startsWith("https://")&&($="http://"+$);try{new URL($)}catch{y.value="Please enter a valid URL (e.g., https://example.com or www.example.com).";return}const O=`[${d.value.trim()}] {${$}}`;i.body+=O,m.value=!1,d.value="",v.value="",y.value=""},ie=()=>{C.value="",D.value="bullet",T.value="",w.value=!0},H=()=>{const $=C.value.split(`
`).map(de=>de.trim()).filter(de=>de!=="");if($.length===0){T.value="Please enter at least one list item.";return}const O=D.value==="bullet"?"ul":"ol";let G=`<${O}>`;$.forEach(de=>{G+=`<li>${de}</li>`}),G+=`</${O}>`,i.body+=G,w.value=!1,C.value="",T.value=""},A=async()=>{var $,O;c.value=!0,u.value=null;try{const G=await window.axios.get(`/api/projects/${a.projectId}/sections/clients?type=clients`);l.value=G.data}catch(G){console.error("Failed to fetch project clients:",G),u.value=((O=($=G.response)==null?void 0:$.data)==null?void 0:O.message)||"Failed to load client data."}finally{c.value=!1}};return fe(()=>{}),($,O)=>(o(),r(J,null,[p(Ce,{show:s.show,title:"Compose New Email","api-endpoint":"/api/emails","http-method":"post","form-data":i,"submit-button-text":"Submit for Approval","success-message":"Email submitted for approval successfully!","format-data-for-api":I,onClose:b,onSubmitted:_,onError:x,"max-width":"3xl"},{default:N(({errors:G})=>[e("div",Jo,[p(q,{for:"client_ids",value:"To (Clients)"}),c.value?(o(),r("div",Zo,"Loading clients...")):u.value?(o(),r("div",Xo,h(u.value),1)):(o(),X(Le,{key:2,modelValue:i.client_ids,"onUpdate:modelValue":O[0]||(O[0]=de=>i.client_ids=de),options:l.value,placeholder:"Select one or more clients","label-key":"name","value-key":"id"},null,8,["modelValue","options"])),p(ae,{message:G.client_ids?G.client_ids[0]:"",class:"mt-2"},null,8,["message"])]),e("div",Qo,[p(q,{for:"subject",value:"Subject"}),p(oe,{id:"subject",type:"text",class:"mt-1 block w-full",modelValue:i.subject,"onUpdate:modelValue":O[1]||(O[1]=de=>i.subject=de),required:""},null,8,["modelValue"]),p(ae,{message:G.subject?G.subject[0]:"",class:"mt-2"},null,8,["message"])]),e("div",er,[e("div",tr,[p(ye,{type:"button",onClick:ie},{default:N(()=>O[13]||(O[13]=[B(" Insert List ",-1)])),_:1,__:[13]}),p(ye,{type:"button",onClick:j},{default:N(()=>O[14]||(O[14]=[B(" Insert Link ",-1)])),_:1,__:[14]})]),e("div",sr,[p(q,{for:"greeting_type",value:"Address Client By"}),p(he,{id:"greeting_type",modelValue:g.value,"onUpdate:modelValue":O[2]||(O[2]=de=>g.value=de),options:S.value,"value-key":"value","label-key":"label",class:"mt-1 block w-full"},null,8,["modelValue","options"]),g.value==="custom"?(o(),r("div",ar,[p(q,{for:"custom_greeting_name",value:"Custom Name"}),p(oe,{id:"custom_greeting_name",type:"text",class:"mt-1 block w-full",modelValue:f.value,"onUpdate:modelValue":O[3]||(O[3]=de=>f.value=de),placeholder:"e.g., Azaan"},null,8,["modelValue"])])):E("",!0)]),e("p",lr,h(M.value),1),p(q,{for:"body",value:"Email Body",class:"sr-only"}),p(wt,{id:"body",modelValue:i.body,"onUpdate:modelValue":O[4]||(O[4]=de=>i.body=de),placeholder:"Compose your email here...",height:"300px"},null,8,["modelValue"]),p(ae,{message:G.body?G.body[0]:"",class:"mt-2"},null,8,["message"])]),K(V)?(o(),r("div",{key:0,class:"unselectable-signature",innerHTML:K(V)},null,8,ir)):E("",!0)]),_:1},8,["show","form-data"]),p($e,{show:m.value,onClose:O[8]||(O[8]=G=>m.value=!1),"max-width":"md"},{default:N(()=>[e("div",nr,[O[17]||(O[17]=e("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"Insert Link",-1)),y.value?(o(),r("div",or,[e("span",rr,h(y.value),1)])):E("",!0),e("div",dr,[p(q,{for:"link_text",value:"Link Text"}),p(oe,{id:"link_text",type:"text",class:"mt-1 block w-full",modelValue:d.value,"onUpdate:modelValue":O[5]||(O[5]=G=>d.value=G),onKeyup:Oe(Z,["enter"])},null,8,["modelValue"])]),e("div",ur,[p(q,{for:"link_url",value:"URL"}),p(oe,{id:"link_url",type:"text",class:"mt-1 block w-full",modelValue:v.value,"onUpdate:modelValue":O[6]||(O[6]=G=>v.value=G),placeholder:"e.g., https://www.example.com",onKeyup:Oe(Z,["enter"])},null,8,["modelValue"])]),e("div",cr,[p(ye,{onClick:O[7]||(O[7]=G=>m.value=!1)},{default:N(()=>O[15]||(O[15]=[B("Cancel",-1)])),_:1,__:[15]}),p(ue,{onClick:Z},{default:N(()=>O[16]||(O[16]=[B("Insert",-1)])),_:1,__:[16]})])])]),_:1},8,["show"]),p($e,{show:w.value,onClose:O[12]||(O[12]=G=>w.value=!1),"max-width":"md"},{default:N(()=>[e("div",mr,[O[21]||(O[21]=e("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"Insert List",-1)),T.value?(o(),r("div",vr,[e("span",pr,h(T.value),1)])):E("",!0),e("div",hr,[p(q,{for:"list_items",value:"List Items (one per line)"}),me(e("textarea",{id:"list_items",rows:"6",class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full","onUpdate:modelValue":O[9]||(O[9]=G=>C.value=G),placeholder:"Enter each list item on a new line"},null,512),[[be,C.value]])]),e("div",gr,[p(q,{for:"list_type",value:"List Type"}),me(e("select",{id:"list_type",class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full","onUpdate:modelValue":O[10]||(O[10]=G=>D.value=G)},O[18]||(O[18]=[e("option",{value:"bullet"},"Bulleted List",-1),e("option",{value:"numbered"},"Numbered List",-1)]),512),[[Ye,D.value]])]),e("div",yr,[p(ye,{onClick:O[11]||(O[11]=G=>w.value=!1)},{default:N(()=>O[19]||(O[19]=[B("Cancel",-1)])),_:1,__:[19]}),p(ue,{onClick:H},{default:N(()=>O[20]||(O[20]=[B("Insert List",-1)])),_:1,__:[20]})])])]),_:1},8,["show"])],64))}},Ct=Ee(fr,[["__scopeId","data-v-70bf1503"]]),br={class:"mb-4"},_r={class:"grid grid-cols-1 sm:grid-cols-2 gap-6 mt-4"},wr={key:2},xr={key:0,class:"text-gray-500 text-sm mt-1"},kr={class:"mt-6"},Dr={class:"flex justify-between items-center mb-3"},Cr=["innerHTML"],Er={__name:"EditTemplateEmailModal",props:{show:Boolean,title:String,apiEndpoint:String,httpMethod:{type:String,default:"post"},submitButtonText:String,successMessage:String,emailId:Number,projectId:Number,clientId:{type:Number,default:null}},emits:["close","submitted","error"],setup(s,{expose:t,emit:a}){const n=s,i=a,l=ke({subject:"",template_id:null,template_data:{}}),c=k([]),u=k({}),m=k(!1),d=k(""),v=k(!1),y=P(()=>c.value.find(M=>M.id===l.template_id)),w=P(()=>y.value?y.value.placeholders.filter(M=>M.is_dynamic||M.is_repeatable||M.is_selectable):[]),C=async()=>{try{const M=await window.axios.get("/api/email-templates");c.value=M.data}catch(M){console.error("Failed to fetch email templates:",M)}},D=async M=>{if(!(!M||!M.placeholders)){m.value=!0,u.value={};try{const I=M.placeholders.filter(x=>(x.is_selectable||x.is_repeatable)&&x.source_model);if(I.length===0){m.value=!1;return}const b={};I.forEach(x=>{b[x.source_model]||(b[x.source_model]=[]),b[x.source_model].push(x)});const _=Object.keys(b).map(async x=>{try{const j=await window.axios.get(`/api/source-models/${encodeURIComponent(x)}`);b[x].forEach(Z=>{u.value[Z.name]=j.data.map(ie=>({id:ie.id,label:ie[Z.source_attribute]||ie.name||`ID: ${ie.id}`}))})}catch(j){console.error(`Failed to fetch data for model ${x}:`,j),b[x].forEach(Z=>{u.value[Z.name]=[]})}});await Promise.all(_)}catch(I){console.error("Error fetching source models data:",I)}finally{m.value=!1}}},T=async M=>{if(Object.assign(l,{subject:"",template_id:null,template_data:{}}),d.value="",u.value={},M.template_id){await C(),l.subject=M.subject,l.template_id=M.template_id,l.template_data=M.template_data||{};const I=c.value.find(b=>b.id===l.template_id);I&&await D(I),f()}else console.error("This modal is only for template-based emails")};t({setData:T});const g=M=>{const I={...M};if(I.composition_type="template",typeof I.template_data=="object"&&I.template_data!==null){const b=c.value.find(_=>_.id===I.template_id);if(b&&b.placeholders){const _={};b.placeholders.forEach(x=>{const j=x.name,Z=I.template_data[j];Z!=null&&(x.is_repeatable&&Array.isArray(Z)||x.is_selectable,_[j]=Z)}),I.template_data=_}}else if(typeof I.template_data=="string")try{I.template_data=JSON.parse(I.template_data)}catch(b){console.error("Error parsing template_data:",b),I.template_data={}}else I.template_data={};return I},f=async()=>{v.value=!0;try{const M={},I=c.value.find(x=>x.id===l.template_id);I&&I.placeholders?I.placeholders.forEach(x=>{const j=x.name,Z=l.template_data[j];Z!=null&&(x.is_repeatable&&Array.isArray(Z)||x.is_selectable,M[j]=Z)}):Object.assign(M,l.template_data);const b={template_id:l.template_id,template_data:M};n.clientId&&(b.client_id=n.clientId);const _=await window.axios.post(`/api/projects/${n.projectId}/email-preview`,b);d.value=_.data.body_html,l.subject=_.data.subject}catch(M){console.error("Error fetching preview:",M),d.value='<p class="text-red-500 italic">Error loading preview.</p>'}finally{v.value=!1}},S=()=>{i("close")},V=M=>{i("submitted",M)},R=M=>{i("error",M)};re(()=>n.show,M=>{M&&n.emailId&&U()});const U=async()=>{if(n.emailId)try{const I=(await window.axios.get(`/api/emails/${n.emailId}/edit-content`)).data;if(!I.template_id){console.error("This email does not use a template"),i("close");return}await T(I)}catch(M){console.error("Failed to fetch email data:",M),i("error",M)}};return fe(()=>{C()}),(M,I)=>(o(),X(Ce,{show:s.show,title:s.title,"api-endpoint":s.apiEndpoint,"http-method":s.httpMethod,"form-data":l,"submit-button-text":s.submitButtonText,"success-message":s.successMessage,"format-data-for-api":g,onClose:S,onSubmitted:V,onError:R,"max-width":"4xl"},{default:N(({errors:b})=>[e("div",br,[p(q,{for:"edit_subject",value:"Subject"}),p(oe,{id:"edit_subject",type:"text",class:"mt-1 block w-full",modelValue:l.subject,"onUpdate:modelValue":I[0]||(I[0]=_=>l.subject=_),required:""},null,8,["modelValue"]),p(ae,{message:b.subject?b.subject[0]:"",class:"mt-2"},null,8,["message"])]),e("div",null,[I[2]||(I[2]=e("h4",{class:"text-md font-semibold text-gray-800 mb-3 border-b pb-2"},"Editing Template Fields",-1)),e("div",_r,[(o(!0),r(J,null,ee(w.value,_=>(o(),r("div",{key:_.id},[p(q,{for:_.name,value:_.name},null,8,["for","value"]),_.is_dynamic&&!_.is_selectable&&!_.is_repeatable?(o(),X(oe,{key:0,type:"text",class:"mt-1 block w-full",modelValue:l.template_data[_.name],"onUpdate:modelValue":x=>l.template_data[_.name]=x},null,8,["modelValue","onUpdate:modelValue"])):_.is_selectable?(o(),X(he,{key:1,id:_.name,modelValue:l.template_data[_.name],"onUpdate:modelValue":x=>l.template_data[_.name]=x,options:u.value[_.name]||[],"value-key":"id","label-key":"label",class:"mt-1 block w-full",disabled:m.value},null,8,["id","modelValue","onUpdate:modelValue","options","disabled"])):_.is_repeatable?(o(),r("div",wr,[m.value?(o(),r("div",xr,"Loading options...")):(o(),X(Le,{key:1,modelValue:l.template_data[_.name],"onUpdate:modelValue":x=>l.template_data[_.name]=x,options:u.value[_.name]||[],placeholder:`Select ${_.name}`,"label-key":"label","value-key":"id",class:"mt-1"},null,8,["modelValue","onUpdate:modelValue","options","placeholder"]))])):(o(),X(oe,{key:3,type:"text",class:"mt-1 block w-full",modelValue:l.template_data[_.name],"onUpdate:modelValue":x=>l.template_data[_.name]=x},null,8,["modelValue","onUpdate:modelValue"])),p(ae,{message:b[`template_data.${_.name}`]?b[`template_data.${_.name}`][0]:"",class:"mt-2"},null,8,["message"])]))),128))]),e("div",kr,[e("div",Dr,[I[1]||(I[1]=e("h4",{class:"text-md font-semibold text-gray-800"},"Email Preview",-1)),p(ue,{onClick:f,disabled:v.value},{default:N(()=>[B(h(v.value?"Loading...":"Refresh Preview"),1)]),_:1},8,["disabled"])]),e("div",{class:"bg-gray-100 p-4 rounded-lg shadow-inner min-h-[300px]",innerHTML:d.value},null,8,Cr)])])]),_:1},8,["show","title","api-endpoint","http-method","form-data","submit-button-text","success-message"]))}},Tr={class:"p-6"},$r={key:0,class:"space-y-4"},Sr={class:"border-b pb-4"},Mr={class:"text-xl font-medium text-gray-900 mb-2"},jr={class:"grid grid-cols-2 gap-4 text-sm"},Vr={class:"text-gray-600"},Ar={class:"text-gray-900"},Ir={class:"text-gray-600 mt-1"},Or={class:"text-gray-600"},Lr={class:"text-gray-900"},Ur={class:"prose max-w-none"},Nr=["innerHTML"],Pr={key:0,class:"mt-4 p-4 bg-red-50 rounded-md"},Rr={class:"text-red-700"},Fr={key:1,class:"mt-4 text-sm text-gray-600"},Br={key:0},Hr={key:2,class:"mt-6 flex justify-end space-x-2"},Wr={__name:"EmailDetailsModal",props:{show:{type:Boolean,required:!0},email:{type:Object,required:!0},canApproveEmails:{type:Boolean,required:!0}},emits:["close","edit","reject"],setup(s,{emit:t}){const a=s,n=t,i=()=>{n("close")},l=()=>{n("edit",a.email)},c=()=>{n("reject",a.email)};return(u,m)=>(o(),X($e,{show:s.show,onClose:i},{default:N(()=>{var d;return[e("div",Tr,[e("div",{class:"flex justify-between items-center mb-4"},[m[1]||(m[1]=e("h3",{class:"text-lg font-semibold text-gray-900"},"Email Details",-1)),e("button",{onClick:i,class:"text-gray-400 hover:text-gray-500"},m[0]||(m[0]=[e("svg",{class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),s.email?(o(),r("div",$r,[e("div",Sr,[e("h4",Mr,h(s.email.subject),1),e("div",jr,[e("div",null,[e("p",Vr,[m[2]||(m[2]=B("From: ",-1)),e("span",Ar,h(((d=s.email.sender)==null?void 0:d.name)||"N/A"),1)]),e("p",Ir,[m[3]||(m[3]=B("Status: ",-1)),e("span",{class:Q({"px-2 py-1 rounded-full text-xs font-medium":!0,"bg-green-100 text-green-800":s.email.status==="sent","bg-yellow-100 text-yellow-800":s.email.status==="pending_approval","bg-red-100 text-red-800":s.email.status==="rejected","bg-gray-100 text-gray-800":s.email.status==="draft"})},h(s.email.status?s.email.status.replace("_"," ").toUpperCase():"N/A"),3)])]),e("div",null,[e("p",Or,[m[4]||(m[4]=B("Date: ",-1)),e("span",Lr,h(new Date(s.email.created_at).toLocaleString()),1)])])])]),e("div",Ur,[e("div",{innerHTML:s.email.body},null,8,Nr)]),s.email.rejection_reason?(o(),r("div",Pr,[m[5]||(m[5]=e("h5",{class:"font-medium text-red-800"},"Rejection Reason:",-1)),e("p",Rr,h(s.email.rejection_reason),1)])):E("",!0),s.email.approver?(o(),r("div",Fr,[e("p",null,"Approved/Rejected by: "+h(s.email.approver.name),1),s.email.sent_at?(o(),r("p",Br,"Sent at: "+h(new Date(s.email.sent_at).toLocaleString()),1)):E("",!0)])):E("",!0),(s.email.status==="pending_approval"||s.email.status==="pending_approval_received")&&s.canApproveEmails?(o(),r("div",Hr,[p(ue,{onClick:l,class:"bg-blue-600 hover:bg-blue-700"},{default:N(()=>m[6]||(m[6]=[B("Edit & Approve",-1)])),_:1,__:[6]}),p(ye,{onClick:c,class:"text-red-600 hover:text-red-800"},{default:N(()=>m[7]||(m[7]=[B("Reject",-1)])),_:1,__:[7]})])):E("",!0)])):E("",!0)])]}),_:1},8,["show"]))}},Yr={key:0,class:"text-center text-gray-600 text-sm animate-pulse py-4"},zr={key:1,class:"text-center text-red-600 text-sm font-medium py-4"},qr={key:2,class:"overflow-x-auto"},Gr={class:"min-w-full divide-y divide-gray-200"},Kr={class:"bg-white divide-y divide-gray-200"},Jr={class:"px-4 py-3 text-sm text-gray-900"},Zr={class:"px-4 py-3 text-sm text-gray-700"},Xr={class:"px-4 py-3 text-sm text-gray-700"},Qr={class:"px-4 py-3 text-sm text-gray-700"},ed={class:"px-4 py-3 text-sm text-gray-700"},td={class:"px-4 py-3 text-right"},sd={key:3,class:"text-gray-400 text-sm"},ad={__name:"EmailList",props:{emails:{type:Array,required:!0},loading:{type:Boolean,default:!1},error:{type:String,default:""}},emits:["view"],setup(s,{emit:t}){const a=t,n=i=>{a("view",i)};return(i,l)=>(o(),r("div",null,[s.loading?(o(),r("div",Yr," Loading email data... ")):s.error?(o(),r("div",zr,h(s.error),1)):s.emails.length?(o(),r("div",qr,[e("table",Gr,[l[1]||(l[1]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Subject"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"From"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Date"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Type"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Status"),e("th",{class:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"Actions")])],-1)),e("tbody",Kr,[(o(!0),r(J,null,ee(s.emails,c=>{var u;return o(),r("tr",{key:c.id,class:"hover:bg-gray-50 transition-colors"},[e("td",Jr,h(c.subject),1),e("td",Zr,h(((u=c.sender)==null?void 0:u.name)||"N/A"),1),e("td",Xr,h(new Date(c.created_at).toLocaleDateString()),1),e("td",Qr,[e("span",{class:Q({"px-2 py-1 rounded-full text-xs font-medium":!0,"bg-blue-100 text-blue-800":c.type==="sent","bg-purple-100 text-purple-800":c.type==="received"})},h(c.type?c.type.toUpperCase():"N/A"),3)]),e("td",ed,[e("span",{class:Q({"px-2 py-1 rounded-full text-xs font-medium":!0,"bg-green-100 text-green-800":c.status==="sent","bg-yellow-100 text-yellow-800":c.status==="pending_approval","bg-red-100 text-red-800":c.status==="rejected","bg-gray-100 text-gray-800":c.status==="draft","bg-purple-200 text-white-800":c.status==="pending_approval_received","bg-blue-100 text-white-800":c.status==="received"})},h(c.status?c.status.replace("_"," ").toUpperCase():"N/A"),3)]),e("td",td,[p(ye,{class:"text-indigo-600 hover:text-indigo-800",onClick:m=>n(c)},{default:N(()=>l[0]||(l[0]=[B(" View ",-1)])),_:2,__:[0]},1032,["onClick"])])])}),128))])])])):(o(),r("p",sd,"No email communication found."))]))}},ld={key:0,class:"bg-white p-6 rounded-xl shadow-md hover:shadow-lg transition-shadow"},id={class:"flex justify-between items-center mb-4"},nd={key:0,class:"flex gap-3"},od={key:1,class:"mt-2 bg-red-100 border border-red-400 text-red-700 px-4 py-2 rounded relative",role:"alert"},rd={class:"block sm:inline"},dd={class:"mb-4 bg-gray-50 p-4 rounded-lg"},ud={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},cd={class:"mt-1 relative rounded-md shadow-sm"},md={__name:"ProjectEmailsTab",props:{projectId:{type:Number,required:!0},canViewEmails:{type:Boolean,required:!0},canComposeEmails:{type:Boolean,required:!0},canApproveEmails:{type:Boolean,required:!0},userProjectRole:{type:Object,required:!0},openCompose:{type:Boolean,required:!1,default:!1}},emits:["emailsUpdated","resetOpenCompose"],setup(s,{emit:t}){const a=s,n=t,i=k([]),l=k(!0),c=k(""),u=k(null),m=k(!1),d=k(!1),v=k(""),y=k(""),w=k("post"),C=k(""),D=k(""),T=k(!1),g=k(!1),f=k(null),S=k(""),V=k(""),R=k(""),U=k(null);Ue();const M=ke({type:"",startDate:"",endDate:"",search:""});let I=null;const b=()=>{j()},_=()=>{M.type="",M.startDate="",M.endDate="",M.search="",j()},x=()=>{clearTimeout(I),I=setTimeout(()=>{b()},500)},j=async()=>{l.value=!0,c.value="";try{const F=new URLSearchParams;M.type&&F.append("type",M.type),M.startDate&&F.append("start_date",M.startDate),M.endDate&&F.append("end_date",M.endDate),M.search&&F.append("search",M.search);const L=F.toString(),Y=`/api/projects/${a.projectId}/emails-simplified${L?`?${L}`:""}`,le=await window.axios.get(Y);i.value=le.data,n("emailsUpdated",i.value)}catch(F){c.value="Failed to load email data.",console.error("Error fetching project emails:",F)}finally{l.value=!1}},Z=async F=>{u.value=null,m.value=!0;try{const L=await window.axios.get(`/api/emails/${F.id}`);u.value={...F,subject:L.data.subject,body:L.data.body_html}}catch(L){console.error("Failed to fetch full email details:",L),u.value={subject:"Error",body:"Failed to load email content.",created_at:new Date().toISOString(),status:"error",sender:{name:"System"}}}},ie=async F=>{try{console.log("Opening email editor for email ID:",F.id),u.value=F;const Y=(await window.axios.get(`/api/emails/${F.id}/edit-content`)).data;Y.template_id?(console.log("Opening template-based email editor for email ID:",F.id),f.value=F.id,S.value=`/api/emails/${F.id}/edit-and-approve`,V.value="Approve & Send",R.value="Email updated and approved successfully!",U.value=Y.client_id,g.value=!0,m.value=!1):(v.value="Edit and Approve Email",y.value=`/api/emails/${F.id}/edit-and-approve`,w.value="post",C.value="Approve & Send",D.value="Email updated and approved successfully!",d.value=!0,m.value=!1)}catch(L){console.error("Failed to determine email type:",L),c.value="Failed to load email for editing."}},H=F=>{u.value=F,v.value="Reject Email",y.value=`/api/emails/${F.id}/reject`,w.value="post",C.value="Reject Email",D.value="Email rejected successfully!",d.value=!0,m.value=!1},A=async F=>{console.log("Form submitted successfully:",F),await j(),d.value=!1},$=()=>{d.value=!1},O=()=>{T.value=!1,n("resetOpenCompose")},G=async F=>{console.log("Compose email submitted successfully:",F),await j(),T.value=!1,n("resetOpenCompose")},de=()=>{g.value=!1},Se=async F=>{console.log("Template email edited and submitted successfully:",F),await j(),g.value=!1};return re(()=>a.openCompose,F=>{console.log("Watcher triggered: openCompose changed to",F),F&&(console.log("Opening compose email modal"),T.value=!0)}),fe(()=>{a.canViewEmails&&j(),a.openCompose&&(T.value=!0)}),(F,L)=>{var Y;return s.canViewEmails?(o(),r("div",ld,[e("div",id,[L[10]||(L[10]=e("h4",{class:"text-lg font-semibold text-gray-900"},"Email Communication",-1)),s.canComposeEmails?(o(),r("div",nd,[p(ue,{class:"bg-indigo-600 hover:bg-indigo-700 transition-colors",onClick:L[0]||(L[0]=le=>T.value=!0)},{default:N(()=>L[9]||(L[9]=[B(" Compose Email ",-1)])),_:1,__:[9]})])):E("",!0),c.value?(o(),r("div",od,[e("span",rd,h(c.value),1)])):E("",!0)]),e("div",dd,[e("div",ud,[e("div",null,[p(q,{for:"typeFilter",value:"Type"}),me(e("select",{id:"typeFilter","onUpdate:modelValue":L[1]||(L[1]=le=>M.type=le),class:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md",onChange:b},L[11]||(L[11]=[e("option",{value:""},"All Types",-1),e("option",{value:"sent"},"Sent",-1),e("option",{value:"received"},"Received",-1)]),544),[[Ye,M.type]])]),e("div",null,[p(q,{for:"startDate",value:"From Date"}),p(oe,{type:"date",id:"startDate",modelValue:M.startDate,"onUpdate:modelValue":L[2]||(L[2]=le=>M.startDate=le),class:"mt-1 block w-full",onChange:b},null,8,["modelValue"])]),e("div",null,[p(q,{for:"endDate",value:"To Date"}),p(oe,{type:"date",id:"endDate",modelValue:M.endDate,"onUpdate:modelValue":L[3]||(L[3]=le=>M.endDate=le),class:"mt-1 block w-full",onChange:b},null,8,["modelValue"])]),e("div",null,[p(q,{for:"searchFilter",value:"Search Content"}),e("div",cd,[p(oe,{type:"text",id:"searchFilter",modelValue:M.search,"onUpdate:modelValue":L[4]||(L[4]=le=>M.search=le),class:"block w-full pr-10",placeholder:"Search in email content...",onInput:x},null,8,["modelValue"]),L[12]||(L[12]=e("div",{class:"absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none"},[e("svg",{class:"h-5 w-5 text-gray-400",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},[e("path",{"fill-rule":"evenodd",d:"M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z","clip-rule":"evenodd"})])],-1))])])]),e("div",{class:"mt-3 flex justify-end"},[e("button",{type:"button",class:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",onClick:_}," Reset Filters ")])]),p(ad,{emails:i.value,loading:l.value,error:c.value,onView:Z},null,8,["emails","loading","error"]),p(Wr,{show:m.value,email:u.value,"can-approve-emails":s.canApproveEmails,onClose:L[5]||(L[5]=le=>m.value=!1),onEdit:ie,onReject:H},null,8,["show","email","can-approve-emails"]),p(Ct,{show:T.value,"project-id":s.projectId,"user-project-role":s.userProjectRole,onClose:O,onSubmitted:G,onError:L[6]||(L[6]=le=>console.error("ComposeEmailModal error:",le))},null,8,["show","project-id","user-project-role"]),p(Go,{show:d.value,title:v.value,"api-endpoint":y.value,"http-method":w.value,"submit-button-text":C.value,"success-message":D.value,"email-id":(Y=u.value)==null?void 0:Y.id,"project-id":s.projectId,onClose:$,onSubmitted:A,onError:L[7]||(L[7]=le=>console.error("EmailActionModal error:",le)),onFetchEmails:j},null,8,["show","title","api-endpoint","http-method","submit-button-text","success-message","email-id","project-id"]),p(Er,{show:g.value,title:"Edit Template Email","api-endpoint":S.value,"http-method":"post","submit-button-text":V.value,"success-message":R.value,"email-id":f.value,"project-id":s.projectId,"client-id":U.value,onClose:de,onSubmitted:Se,onError:L[8]||(L[8]=le=>console.error("EditTemplateEmailModal error:",le))},null,8,["show","api-endpoint","submit-button-text","success-message","email-id","project-id","client-id"])])):E("",!0)}}},vd={key:0,class:"bg-white p-6 rounded-xl shadow-md hover:shadow-lg transition-shadow"},pd={class:"flex justify-between items-center mb-4"},hd={class:"flex gap-3"},gd={class:"mb-4 bg-gray-50 p-4 rounded-lg"},yd={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},fd={class:"mt-1 relative rounded-md shadow-sm"},bd={class:"mb-8 p-4 bg-blue-50 rounded-md"},_d={class:"flex items-center"},wd={class:"text-sm text-blue-800"},xd={key:0,class:"text-center text-gray-600 text-sm animate-pulse py-4"},kd={key:1,class:"text-center text-red-600 text-sm font-medium py-4"},Dd={key:2,class:"space-y-4"},Cd={class:"flex justify-between"},Ed={class:"flex-grow"},Td={key:0,class:"text-xs text-red-400 block mt-1"},$d={class:"flex items-center mt-1"},Sd={class:"text-xs text-gray-500"},Md={key:0,class:"ml-2 px-2 py-0.5 bg-indigo-100 text-indigo-800 text-xs rounded-full"},jd={key:0},Vd={key:3,class:"text-gray-400 text-sm"},Ad={class:"p-6"},Id={class:"flex justify-between items-center mb-4"},Od={key:0,class:"mb-4 p-3 bg-gray-100 rounded-md"},Ld={class:"text-sm text-gray-700"},Ud={class:"text-xs text-gray-500 mt-1"},Nd={key:1,class:"mb-4"},Pd={key:0,class:"text-center py-4"},Rd={key:1,class:"space-y-3 max-h-60 overflow-y-auto"},Fd={class:"text-sm text-gray-700"},Bd={class:"text-xs text-gray-500 mt-1"},Hd={key:2,class:"text-center py-3"},Wd={key:2,class:"mb-4"},Yd={key:0,class:"mt-2 text-sm text-red-600"},zd={key:3,class:"mt-6 flex justify-end"},qd={__name:"ProjectNotesTab",props:{projectId:{type:Number,required:!0},googleChatId:{type:String,default:null},canViewNotes:{type:Boolean,required:!0},canAddNotes:{type:Boolean,required:!0}},emits:["notesUpdated"],setup(s,{emit:t}){const a=s,n=t,i=k([]),l=k(!0),c=k(""),u=k(!1),m=k(!1),d=k(null),v=k(""),y=k(""),w=k([]),C=k(!1),D=ke({startDate:"",endDate:"",search:""});let T=null;const g=async()=>{l.value=!0,c.value="";try{const I=new URLSearchParams;D.startDate&&I.append("start_date",D.startDate),D.endDate&&I.append("end_date",D.endDate),D.search&&I.append("search",D.search);const b=I.toString(),_=`/api/projects/${a.projectId}/notes${b?`?${b}`:""}`,x=await window.axios.get(_);i.value=x.data,n("notesUpdated",i.value)}catch(I){c.value="Failed to load notes data.",console.error("Error fetching project notes:",I)}finally{l.value=!1}},f=()=>{u.value=!0},S=async I=>{d.value=I,v.value="",y.value="",w.value=[],C.value=!0,m.value=!0;try{const b=await window.axios.get(`/api/projects/${a.projectId}/notes/${I.id}/replies`);b.data.success?w.value=b.data.replies:console.error("Failed to fetch replies:",b.data.message)}catch(b){console.error("Error fetching replies:",b)}finally{C.value=!1}},V=async()=>{var I,b;if(!d.value||!v.value.trim()){y.value="Reply content is required";return}y.value="";try{const _=await window.axios.post(`/api/projects/${a.projectId}/notes/${d.value.id}/reply`,{content:v.value});if(_.data.success){v.value="",C.value=!0;const x=await window.axios.get(`/api/projects/${a.projectId}/notes/${d.value.id}/replies`);x.data.success&&(w.value=x.data.replies),C.value=!1,await g()}else y.value=_.data.message||"Failed to send reply"}catch(_){console.error("Error sending reply:",_),y.value=((b=(I=_.response)==null?void 0:I.data)==null?void 0:b.message)||"An error occurred while sending the reply"}},R=()=>{g()},U=()=>{D.startDate="",D.endDate="",D.search="",g()},M=()=>{clearTimeout(T),T=setTimeout(()=>{R()},500)};return fe(()=>{a.canViewNotes&&g()}),(I,b)=>s.canViewNotes?(o(),r("div",vd,[e("div",pd,[b[10]||(b[10]=e("h4",{class:"text-lg font-semibold text-gray-900"},"Project Notes",-1)),e("div",hd,[s.canAddNotes?(o(),X(ue,{key:0,class:"bg-indigo-600 hover:bg-indigo-700 transition-colors",onClick:f},{default:N(()=>b[9]||(b[9]=[B(" Add Note ",-1)])),_:1,__:[9]})):E("",!0)])]),e("div",gd,[e("div",yd,[e("div",null,[p(q,{for:"noteStartDate",value:"From Date"}),p(oe,{type:"date",id:"noteStartDate",modelValue:D.startDate,"onUpdate:modelValue":b[0]||(b[0]=_=>D.startDate=_),class:"mt-1 block w-full",onChange:R},null,8,["modelValue"])]),e("div",null,[p(q,{for:"noteEndDate",value:"To Date"}),p(oe,{type:"date",id:"noteEndDate",modelValue:D.endDate,"onUpdate:modelValue":b[1]||(b[1]=_=>D.endDate=_),class:"mt-1 block w-full",onChange:R},null,8,["modelValue"])]),e("div",null,[p(q,{for:"noteSearchFilter",value:"Search Content"}),e("div",fd,[p(oe,{type:"text",id:"noteSearchFilter",modelValue:D.search,"onUpdate:modelValue":b[2]||(b[2]=_=>D.search=_),class:"block w-full pr-10",placeholder:"Search in note content...",onInput:M},null,8,["modelValue"]),b[11]||(b[11]=e("div",{class:"absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none"},[e("svg",{class:"h-5 w-5 text-gray-400",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},[e("path",{"fill-rule":"evenodd",d:"M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z","clip-rule":"evenodd"})])],-1))])])]),e("div",{class:"mt-3 flex justify-end"},[e("button",{type:"button",class:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",onClick:U}," Reset Filters ")])]),e("div",bd,[e("div",_d,[b[13]||(b[13]=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 text-blue-600 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),e("p",wd,[b[12]||(b[12]=B(" Daily Standups are now available in their own dedicated tab. ",-1)),e("button",{onClick:b[3]||(b[3]=_=>I.$emit("changeTab","standups")),class:"text-blue-600 hover:text-blue-800 font-medium underline"}," Click here to view Daily Standups ")])])]),e("div",null,[b[15]||(b[15]=e("h5",{class:"text-md font-semibold text-gray-900 mb-4 border-b pb-2"},"Notes",-1)),l.value?(o(),r("div",xd," Loading notes... ")):c.value?(o(),r("div",kd,h(c.value),1)):i.value.length?(o(),r("div",Dd,[(o(!0),r(J,null,ee(i.value,_=>{var x;return o(),r("div",{key:_.id,class:"p-4 bg-gray-50 rounded-md shadow-sm hover:bg-gray-100 transition-colors"},[e("div",Cd,[e("div",Ed,[e("p",{class:Q(["text-sm",{"text-gray-700":_.content!=="[Encrypted content could not be decrypted]","text-red-500 italic":_.content==="[Encrypted content could not be decrypted]"}])},[B(h(_.content)+" ",1),_.content==="[Encrypted content could not be decrypted]"?(o(),r("span",Td," (There was an issue decrypting this note. Please contact an administrator.) ")):E("",!0)],2),e("div",$d,[e("p",Sd,"Added by "+h(((x=_.user)==null?void 0:x.name)||"Unknown")+" on "+h(new Date(_.created_at).toLocaleDateString()),1),_.reply_count>0?(o(),r("span",Md,h(_.reply_count)+" "+h(_.reply_count===1?"reply":"replies"),1)):E("",!0)])]),s.googleChatId&&_.chat_message_id?(o(),r("div",jd,[p(ye,{class:"text-sm text-indigo-600 hover:text-indigo-800",onClick:j=>S(_)},{default:N(()=>b[14]||(b[14]=[B(" View ",-1)])),_:2,__:[14]},1032,["onClick"])])):E("",!0)])])}),128))])):(o(),r("p",Vd,"No notes available."))]),p(_t,{show:u.value,"project-id":s.projectId,onClose:b[4]||(b[4]=_=>u.value=!1),onNoteAdded:g},null,8,["show","project-id"]),p($e,{show:m.value,onClose:b[8]||(b[8]=_=>m.value=!1)},{default:N(()=>{var _;return[e("div",Ad,[e("div",Id,[b[17]||(b[17]=e("h3",{class:"text-lg font-semibold text-gray-900"},"Reply to Note",-1)),e("button",{onClick:b[5]||(b[5]=x=>m.value=!1),class:"text-gray-400 hover:text-gray-500"},b[16]||(b[16]=[e("svg",{class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),d.value?(o(),r("div",Od,[e("p",Ld,h(d.value.content),1),e("p",Ud,"Added by "+h(((_=d.value.user)==null?void 0:_.name)||"Unknown")+" on "+h(new Date(d.value.created_at).toLocaleDateString()),1)])):E("",!0),d.value?(o(),r("div",Nd,[b[20]||(b[20]=e("h4",{class:"text-sm font-medium text-gray-700 mb-2"},"Replies",-1)),C.value?(o(),r("div",Pd,b[18]||(b[18]=[e("p",{class:"text-gray-500 text-sm"},"Loading replies...",-1)]))):w.value.length?(o(),r("div",Rd,[(o(!0),r(J,null,ee(w.value,x=>{var j;return o(),r("div",{key:x.id,class:"p-2 bg-gray-50 rounded border-l-2 border-indigo-300"},[e("p",Fd,h(x.content),1),e("p",Bd,"Replied by "+h(((j=x.user)==null?void 0:j.name)||"Unknown")+" on "+h(new Date(x.created_at).toLocaleDateString()),1)])}),128))])):(o(),r("div",Hd,b[19]||(b[19]=[e("p",{class:"text-gray-500 text-sm"},"No replies yet. Be the first to reply!",-1)])))])):E("",!0),s.canAddNotes?(o(),r("div",Wd,[p(q,{for:"reply-content",value:"Your Reply"}),me(e("textarea",{id:"reply-content","onUpdate:modelValue":b[6]||(b[6]=x=>v.value=x),class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full h-32",placeholder:"Enter your reply..."},null,512),[[be,v.value]]),y.value?(o(),r("p",Yd,h(y.value),1)):E("",!0)])):E("",!0),s.canAddNotes?(o(),r("div",zd,[p(ye,{onClick:b[7]||(b[7]=x=>m.value=!1),class:"mr-2"},{default:N(()=>b[21]||(b[21]=[B("Cancel",-1)])),_:1,__:[21]}),p(ue,{onClick:V},{default:N(()=>b[22]||(b[22]=[B("Send Reply",-1)])),_:1,__:[22]})])):E("",!0)])]}),_:1},8,["show"])])):E("",!0)}},Gd={class:"w-full"},Kd={key:0,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"},Jd={key:1,class:"text-red-600 text-sm py-2 text-center"},Zd={key:2,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"},Xd={class:"p-4 bg-blue-100 rounded-lg shadow-sm transition-shadow hover:shadow-lg"},Qd={class:"text-2xl font-bold text-blue-900 mt-1"},eu={class:"p-4 bg-green-100 rounded-lg shadow-sm transition-shadow hover:shadow-lg"},tu={class:"text-2xl font-bold text-green-900 mt-1"},su={class:"p-4 bg-red-100 rounded-lg shadow-sm transition-shadow hover:shadow-lg"},au={class:"text-2xl font-bold mt-1"},lu={key:3,class:"space-y-2 text-sm text-gray-700 mt-6 pt-4 border-t border-gray-200"},iu={key:0},nu={class:"text-gray-900 whitespace-pre-wrap"},ou={key:4,class:"text-gray-400 text-sm mt-4 text-center"},ru={__name:"ProjectFinancialsCard",props:{projectId:{type:Number,required:!0},canViewProjectServicesAndPayments:{type:Boolean,default:!1},canViewProjectTransactions:{type:Boolean,default:!1}},setup(s){const t=s,a=k(null),n=k([]),i=k(!0),l=k(null),c=We,u=P(()=>{var C;if(!ge.value||Object.keys(ge.value).length===0)return 0;const w=parseFloat(((C=a.value)==null?void 0:C.total_amount)||0);return Ie(w,"USD",c.value)}),m=P(()=>!n.value.length||!ge.value||Object.keys(ge.value).length===0?0:n.value.filter(w=>w.type==="expense").reduce((w,C)=>w+Ie(parseFloat(C.amount||0),C.currency,c.value),0)),d=P(()=>!n.value.length||!ge.value||Object.keys(ge.value).length===0?0:n.value.filter(w=>w.type==="income").reduce((w,C)=>w+Ie(parseFloat(C.amount||0),C.currency,c.value),0)),v=P(()=>d.value-m.value),y=async()=>{var w,C;if(i.value=!0,l.value=null,n.value=[],!ge.value||Object.keys(ge.value).length===0){l.value="Currency rates not loaded. Please try again.",i.value=!1;return}if(!t.canViewProjectServicesAndPayments&&!t.canViewProjectTransactions){l.value="You don't have permission to view project financials.",i.value=!1;return}try{if(t.canViewProjectServicesAndPayments){const D=await window.axios.get(`/api/projects/${t.projectId}/sections/services-payment`);a.value=D.data}else a.value=null;if(t.canViewProjectTransactions){const D=await window.axios.get(`/api/projects/${t.projectId}/sections/transactions`);n.value=D.data}else n.value=[]}catch(D){console.error("Failed to fetch project financials:",D),l.value=((C=(w=D.response)==null?void 0:w.data)==null?void 0:C.message)||"Failed to load financial data."}finally{i.value=!1}};return re([()=>t.canViewProjectServicesAndPayments,()=>t.canViewProjectTransactions,c,ge],(w,C)=>{t.projectId&&ge.value&&Object.keys(ge.value).length>0?y():t.projectId||(i.value=!0,l.value=null)},{immediate:!0,deep:!0}),(w,C)=>{var D,T;return o(),r("div",Gd,[i.value?(o(),r("div",Kd,[(o(),r(J,null,ee(4,g=>e("div",{key:g,class:"p-4 bg-gray-100 rounded-lg animate-pulse h-24"},C[0]||(C[0]=[e("div",{class:"h-4 bg-gray-200 rounded w-1/2 mb-3"},null,-1),e("div",{class:"h-6 bg-gray-200 rounded w-3/4"},null,-1)]))),64))])):l.value?(o(),r("div",Jd,[e("p",null,h(l.value),1)])):(o(),r("div",Zd,[e("div",Xd,[C[1]||(C[1]=e("p",{class:"text-sm font-medium text-blue-800"},"Contract Value",-1)),e("p",Qd,h(K(Ve)(u.value,K(c).value)),1)]),e("div",eu,[C[2]||(C[2]=e("p",{class:"text-sm font-medium text-green-800"},"Total Income",-1)),e("p",tu,h(K(Ve)(d.value,K(c))),1)]),e("div",su,[C[3]||(C[3]=e("p",{class:"text-sm font-medium text-red-800"},"Total Expenses",-1)),e("p",au,h(K(Ve)(m.value,K(c))),1)]),e("div",{class:Q(["p-4 rounded-lg shadow-sm transition-shadow hover:shadow-lg",{"bg-green-100":v.value>=0,"bg-red-100":v.value<0}])},[e("p",{class:Q(["text-sm font-medium",{"text-green-800":v.value>=0,"text-red-800":v.value<0}])},"Profit/Loss",2),e("p",{class:Q(["text-2xl font-bold mt-1",{"text-green-900":v.value>=0,"text-red-900":v.value<0}])},h(K(Ve)(v.value,K(c))),3)],2)])),!i.value&&!l.value&&((D=a.value)!=null&&D.contract_details)?(o(),r("dl",lu,[(T=a.value)!=null&&T.contract_details?(o(),r("div",iu,[C[4]||(C[4]=e("dt",{class:"font-medium w-full block mt-2"},"Contract Details:",-1)),e("dd",nu,h(a.value.contract_details),1)])):E("",!0)])):E("",!0),!i.value&&!l.value&&!a.value&&!n.value.length?(o(),r("p",ou," No financial information available. ")):E("",!0)])}}},du={class:"bg-white p-6 rounded-xl shadow-md transition-shadow hover:shadow-lg"},uu={key:0},cu={key:1,class:"text-red-600 text-sm py-2"},mu={key:2,class:"space-y-1 text-sm text-gray-700"},vu={key:0},pu={key:3,class:"text-gray-400 text-sm"},hu={__name:"ProjectClientsCard",props:{projectId:{type:Number,required:!0},canViewClientContacts:{type:Boolean,default:!1}},setup(s){const t=s,a=k([]),n=k(!0),i=k(null),l=async()=>{var c,u;if(n.value=!0,i.value=null,!t.canViewClientContacts){i.value="You don't have permission to view project clients.",n.value=!1;return}try{const m=await window.axios.get(`/api/projects/${t.projectId}/sections/clients?type=clients`);a.value=m.data}catch(m){console.error("Failed to fetch project clients:",m),i.value=((u=(c=m.response)==null?void 0:c.data)==null?void 0:u.message)||"Failed to load client data."}finally{n.value=!1}};return fe(()=>{l()}),re(()=>t.canViewClientContacts,()=>{l()}),(c,u)=>(o(),r("div",du,[u[1]||(u[1]=e("h4",{class:"text-lg font-semibold text-gray-900 mb-4"},"Project Clients",-1)),n.value?(o(),r("div",uu,u[0]||(u[0]=[e("div",{class:"space-y-3"},[e("div",{class:"h-4 bg-gray-200 rounded animate-pulse w-3/4"}),e("div",{class:"h-4 bg-gray-200 rounded animate-pulse w-2/3"}),e("div",{class:"h-4 bg-gray-200 rounded animate-pulse w-1/2"})],-1)]))):i.value?(o(),r("div",cu,[e("p",null,h(i.value),1)])):a.value.length?(o(),r("ul",mu,[(o(!0),r(J,null,ee(a.value,m=>(o(),r("li",{key:m.id},[B(h(m.name)+" ",1),m.email?(o(),r("span",vu,"("+h(m.email)+")",1)):E("",!0)]))),128))])):(o(),r("p",pu,"No clients assigned."))]))}},gu={class:"bg-white p-6 rounded-xl shadow-md transition-shadow hover:shadow-lg"},yu={key:0},fu={key:1,class:"text-red-600 text-sm py-2"},bu={key:2},_u={key:0,class:"space-y-2 text-sm text-gray-700 mb-4"},wu={class:"font-medium"},xu={class:"text-xs text-gray-500 mt-1"},ku={key:1,class:"text-gray-400 text-sm mb-4"},Du={__name:"ProjectTeamCard",props:{projectId:{type:Number,required:!0},canViewUsers:{type:Boolean,default:!1}},setup(s){const t=s,a=Ue(),n=k([]),i=k(!0),l=k(null),c=async()=>{var m,d;if(i.value=!0,l.value=null,!t.canViewUsers){l.value="You don't have permission to view project team members.",i.value=!1,n.value=[];return}try{const v=await window.axios.get(`/api/projects/${t.projectId}/sections/users`);n.value=v.data.users||[],console.log("Fetched team users:",n.value)}catch(v){console.error("Failed to fetch project users:",v),l.value=((d=(m=v.response)==null?void 0:m.data)==null?void 0:d.message)||"Failed to load team data."}finally{i.value=!1}},u=m=>{if(!m.availabilities||m.availabilities.length===0)return"No availability submitted for today.";const d=m.availabilities[0];return d.is_available?d.time_slots&&d.time_slots.length>0?`${d.time_slots.map(y=>`${y.start_time}-${y.end_time}`).join(", ")}`:"No specific slots provided.":`Not available today: ${d.reason||"No reason provided"}`};return fe(()=>{c()}),re([()=>t.canViewUsers,()=>a.value,()=>t.projectId],()=>{c()},{deep:!0}),(m,d)=>(o(),r("div",gu,[d[3]||(d[3]=e("h4",{class:"text-lg font-semibold text-gray-900 mb-4"},"Project Team",-1)),i.value?(o(),r("div",yu,d[0]||(d[0]=[e("div",{class:"space-y-3"},[e("div",{class:"h-4 bg-gray-200 rounded animate-pulse w-3/4"}),e("div",{class:"h-4 bg-gray-200 rounded animate-pulse w-2/3"}),e("div",{class:"h-4 bg-gray-200 rounded animate-pulse w-1/2"})],-1)]))):l.value?(o(),r("div",fu,[e("p",null,h(l.value),1)])):(o(),r("div",bu,[n.value.length?(o(),r("ul",_u,[(o(!0),r(J,null,ee(n.value,v=>{var y;return o(),r("li",{key:v.id,class:"border-b pb-2 last:border-b-0"},[e("div",null,[e("strong",null,h(v.name),1),d[1]||(d[1]=B(" (Role: ",-1)),e("span",wu,h(((y=v.pivot)==null?void 0:y.role)||"N/A"),1),d[2]||(d[2]=B(") ",-1))]),e("div",xu," Today's Availability: "+h(u(v)),1)])}),128))])):(o(),r("p",ku,"No team members assigned."))]))]))}},Cu={class:"bg-white p-6 rounded-xl shadow-md transition-shadow hover:shadow-lg"},Eu={key:0,class:"space-y-3"},Tu={key:1,class:"text-red-600 text-sm py-2 text-center"},$u={key:2},Su={class:"space-y-1 text-sm text-gray-700"},Mu={key:0},ju={class:"inline-block text-gray-900"},Vu={class:"inline-block text-gray-900"},Au={class:"inline-block text-gray-900"},Iu={key:1},Ou={key:0,class:"text-gray-400 text-sm"},Lu={key:1,class:"text-gray-400 text-sm"},Uu={key:0,class:"mt-4 text-right"},Nu={__name:"UserFinancialCard",props:{projectId:{type:Number,required:!0}},emits:["viewUserTransactions"],setup(s,{emit:t}){const a=s,n=t,i=Ue(),l=k(!0),c=k(null),u=k([]),m=We,d=async()=>{var T,g;if(l.value=!0,c.value=null,!i.value||!i.value.id||!a.projectId){u.value=[],l.value=!1;return}if(!ge.value||Object.keys(ge.value).length===0){c.value="Currency rates not loaded. Please try again.",l.value=!1;return}try{const f=await window.axios.get(`/api/projects/${a.projectId}/sections/transactions?user_id=${i.value.id}`);u.value=f.data,console.log("User-specific transactions:",u.value)}catch(f){console.error("Failed to fetch user transactions for UserFinancialsCard:",f),c.value=((g=(T=f.response)==null?void 0:T.data)==null?void 0:g.message)||"Failed to load your financial data.",u.value=[]}finally{l.value=!1}},v=P(()=>!i.value||!i.value.id||!u.value.length||!ge.value||Object.keys(ge.value).length===0?0:u.value.filter(g=>g.type==="expense").reduce((g,f)=>g+Ie(parseFloat(f.amount||0),f.currency,m.value),0)),y=P(()=>!i.value||!i.value.id||!u.value.length||!ge.value||Object.keys(ge.value).length===0?0:u.value.filter(g=>g.type==="bonus").reduce((g,f)=>g+Ie(parseFloat(f.amount||0),f.currency,m.value),0)),w=P(()=>!i.value||!i.value.id||!u.value.length||!ge.value||Object.keys(ge.value).length===0?0:u.value.filter(g=>(g.type==="expense"||g.type==="bonus")&&g.is_paid===1).reduce((g,f)=>g+Ie(parseFloat(f.amount||0),f.currency,m.value),0)),C=P(()=>i.value&&(v.value>0||y.value>0||w.value>0));fe(()=>{d()}),re([()=>i.value,()=>a.projectId,m,ge],()=>{d()},{deep:!0});const D=()=>{n("viewUserTransactions")};return(T,g)=>(o(),r("div",Cu,[g[5]||(g[5]=e("h4",{class:"text-lg font-semibold text-gray-900 mb-4"},"Your Financials",-1)),l.value?(o(),r("div",Eu,g[0]||(g[0]=[e("div",{class:"h-4 bg-gray-200 rounded animate-pulse w-full"},null,-1),e("div",{class:"h-4 bg-gray-200 rounded animate-pulse w-5/6"},null,-1),e("div",{class:"h-4 bg-gray-200 rounded animate-pulse w-3/4"},null,-1)]))):c.value?(o(),r("div",Tu,[e("p",null,h(c.value),1)])):(o(),r("div",$u,[e("dl",Su,[C.value?(o(),r("div",Mu,[e("div",null,[g[1]||(g[1]=e("dt",{class:"font-medium inline-block w-32"},"Agreed Amount:",-1)),e("dd",ju,h(K(Ve)(v.value,K(m))),1)]),e("div",null,[g[2]||(g[2]=e("dt",{class:"font-medium inline-block w-32"},"Bonus Amount:",-1)),e("dd",Vu,h(K(Ve)(y.value,K(m))),1)]),e("div",null,[g[3]||(g[3]=e("dt",{class:"font-medium inline-block w-32"},"Received Amount:",-1)),e("dd",Au,h(K(Ve)(w.value,K(m))),1)])])):(o(),r("div",Iu,[K(i)?(o(),r("p",Lu," Your financials for this project are not available or you're not assigned. ")):(o(),r("p",Ou," Sign in to view your specific financials. "))]))]),K(i)?(o(),r("div",Uu,[p(ue,{onClick:D},{default:N(()=>g[4]||(g[4]=[B(" View Transactions ",-1)])),_:1,__:[4]})])):E("",!0)]))]))}},Pu=Ee(Nu,[["__scopeId","data-v-34bab241"]]),Ru={class:"p-4"},Fu={key:0,class:"text-center text-gray-600"},Bu={key:1,class:"text-red-600 text-sm py-2"},Hu={key:2,class:"text-gray-500 text-center py-4"},Wu={key:3,class:"overflow-x-auto"},Yu={class:"min-w-full divide-y divide-gray-200"},zu={class:"bg-white divide-y divide-gray-200"},qu={class:"px-4 py-3 text-sm text-gray-900"},Gu={class:"px-4 py-3 text-sm text-gray-700"},Ku={class:"px-4 py-3 text-sm text-right text-gray-900"},Ju={class:"px-4 py-3 text-sm"},Zu={class:"px-4 py-3 text-sm text-gray-700"},Xu={__name:"UserTransactionsModal",props:{show:{type:Boolean,default:!1},projectId:{type:Number,required:!0},projectName:{type:String,required:!1}},emits:["close"],setup(s,{emit:t}){const a=s,n=Ue(),i=k(!0),l=k(null),c=k([]);k("PKR");const u=(d,v="USD")=>isNaN(d)||d==null?"0.00":new Intl.NumberFormat("en-US",{style:"currency",currency:v,minimumFractionDigits:2,maximumFractionDigits:2}).format(d),m=async()=>{var d,v;if(i.value=!0,l.value=null,c.value=[],!n.value||!n.value.id||!a.projectId){l.value="User not authenticated or project ID missing.",i.value=!1;return}try{const y=await window.axios.get(`/api/projects/${a.projectId}/sections/transactions?user_id=${n.value.id}`);c.value=y.data}catch(y){console.error("Failed to fetch user-specific transactions for modal:",y),l.value=((v=(d=y.response)==null?void 0:d.data)==null?void 0:v.message)||"Failed to load transactions."}finally{i.value=!1}};return re(()=>a.show,d=>{d&&m()},{immediate:!1}),re([()=>{var d;return(d=n.value)==null?void 0:d.id},()=>a.projectId],(d,v)=>{a.show&&m()},{deep:!0}),P(()=>`Your Transactions for Project ${a.projectId}`),(d,v)=>(o(),X(Ce,{show:s.show,title:"Transactions for: "+s.projectName,"show-footer":!1,onClose:v[0]||(v[0]=y=>d.$emit("close")),"hide-submit-button":!0,"hide-cancel-button":!0,"api-endpoint":null,"form-data":"{}"},{default:N(({errors:y})=>[e("div",Ru,[i.value?(o(),r("div",Fu,v[1]||(v[1]=[e("div",{class:"space-y-3"},[e("div",{class:"h-4 bg-gray-200 rounded animate-pulse w-full"}),e("div",{class:"h-4 bg-gray-200 rounded animate-pulse w-5/6"}),e("div",{class:"h-4 bg-gray-200 rounded animate-pulse w-full"}),e("div",{class:"h-4 bg-gray-200 rounded animate-pulse w-2/3"})],-1)]))):l.value?(o(),r("div",Bu,[e("p",null,h(l.value),1)])):c.value.length===0?(o(),r("div",Hu," No transactions found for you on this project. ")):(o(),r("div",Wu,[e("table",Yu,[v[2]||(v[2]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Description"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Type"),e("th",{class:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"Amount"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Status"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Date")])],-1)),e("tbody",zu,[(o(!0),r(J,null,ee(c.value,w=>(o(),r("tr",{key:w.id,class:"hover:bg-gray-50 transition-colors"},[e("td",qu,h(w.description),1),e("td",Gu,h(w.type),1),e("td",Ku,h(u(w.amount,w.currency)),1),e("td",Ju,[e("span",{class:Q({"px-2 py-1 rounded-full text-xs font-medium":!0,"bg-green-100 text-green-800":w.is_paid===1,"bg-yellow-100 text-yellow-800":w.is_paid===0})},h(w.is_paid===1?"Paid":"Unpaid"),3)]),e("td",Zu,h(new Date(w.created_at).toLocaleDateString()),1)]))),128))])])]))])]),_:1},8,["show","title"]))}},Qu={class:"space-y-4"},ec={key:0},tc=["disabled"],sc={key:0,class:"mt-4"},ac=["src"],lc={class:"flex items-center"},ic="Create New Deliverable",nc="post",oc="Create Deliverable",rc="Deliverable created successfully!",Et={__name:"CreateDeliverableModal",props:{show:{type:Boolean,default:!1},projectId:{type:[String,Number],required:!0}},emits:["close","saved"],setup(s,{emit:t}){const a=s,n=t,i=ke({title:"",description:"",type:"blog_post",content_url:"",content_url_type:null,attachment_file:null,is_visible_to_client:!0,initial_status:"pending_review"}),l=[{value:"blog_post",label:"Blog Post"},{value:"design_mockup",label:"Design Mockup"},{value:"social_media_post",label:"Social Media Post"},{value:"report",label:"Report"},{value:"contract_draft",label:"Contract Draft"},{value:"proposal",label:"Proposal"},{value:"other",label:"Other"}],c=[{value:"pending_review",label:"Pending Review (Requires Client Approval)"},{value:"for_information",label:"For Information Only (No Approval Needed)"}],u=[{value:null,label:"Select Type (if providing URL)"},{value:"google_doc",label:"Google Document (Doc, Sheet, Slide)"},{value:"pdf",label:"PDF Document"},{value:"image",label:"Image (JPG, PNG, GIF)"},{value:"video",label:"Video (YouTube, Vimeo, etc.)"},{value:"other",label:"Other Web Link"}],m=k(null),d=k(null);re(()=>a.show,g=>{g&&(Object.assign(i,{title:"",description:"",type:"blog_post",content_url:"",content_url_type:null,attachment_file:null,is_visible_to_client:!0,initial_status:"pending_review"}),d.value=null,m.value&&(m.value.value=""))});const v=g=>{const f=g.target.files[0];if(f)if(i.attachment_file=f,i.content_url="",i.content_url_type=null,f.type.startsWith("image/")){const S=new FileReader;S.onload=V=>{d.value=V.target.result},S.readAsDataURL(f)}else d.value=null;else i.attachment_file=null,d.value=null},y=()=>{i.content_url?(i.attachment_file=null,d.value=null,m.value&&(m.value.value="")):i.content_url_type=null},w=g=>{const f=new FormData;return f.append("title",g.title),f.append("description",g.description||""),f.append("type",g.type),f.append("is_visible_to_client",g.is_visible_to_client?1:0),f.append("initial_status",g.initial_status),g.attachment_file?f.append("attachment_file",g.attachment_file):g.content_url&&(f.append("content_url",g.content_url),f.append("content_url_type",g.content_url_type||"")),f},C=P(()=>`/api/projects/${a.projectId}/deliverables`),D=g=>{n("saved",g),n("close")},T=()=>{n("close")};return(g,f)=>(o(),X(Ce,{show:s.show,title:ic,"api-endpoint":C.value,"http-method":nc,"form-data":i,"submit-button-text":oc,"success-message":rc,"format-data-for-api":w,onClose:T,onSubmitted:D},{default:N(({errors:S})=>[e("div",Qu,[e("div",null,[p(q,{for:"title",value:"Title"}),p(oe,{id:"title",modelValue:i.title,"onUpdate:modelValue":f[0]||(f[0]=V=>i.title=V),type:"text",class:"mt-1 block w-full",required:"",autofocus:""},null,8,["modelValue"]),p(ae,{message:S.title?S.title[0]:"",class:"mt-2"},null,8,["message"])]),e("div",null,[p(q,{for:"description",value:"Description"}),me(e("textarea",{id:"description","onUpdate:modelValue":f[1]||(f[1]=V=>i.description=V),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",rows:"3",placeholder:"Enter deliverable description"},null,512),[[be,i.description]]),p(ae,{message:S.description?S.description[0]:"",class:"mt-2"},null,8,["message"])]),e("div",null,[p(q,{for:"type",value:"Deliverable Type"}),p(he,{id:"type",modelValue:i.type,"onUpdate:modelValue":f[2]||(f[2]=V=>i.type=V),options:l,"value-key":"value","label-key":"label",placeholder:"Select a type",class:"mt-1 block w-full",required:""},null,8,["modelValue"]),p(ae,{message:S.type?S.type[0]:"",class:"mt-2"},null,8,["message"])]),e("div",null,[p(q,{for:"initial_status",value:"Initial Status"}),p(he,{id:"initial_status",modelValue:i.initial_status,"onUpdate:modelValue":f[3]||(f[3]=V=>i.initial_status=V),options:c,"value-key":"value","label-key":"label",class:"mt-1 block w-full",required:""},null,8,["modelValue"]),p(ae,{message:S.initial_status?S.initial_status[0]:"",class:"mt-2"},null,8,["message"])]),e("div",null,[p(q,{for:"content_url",value:"Content URL (for Google Docs, external links)"}),p(oe,{id:"content_url",modelValue:i.content_url,"onUpdate:modelValue":f[4]||(f[4]=V=>i.content_url=V),type:"url",class:"mt-1 block w-full",disabled:!!i.attachment_file,onInput:y,placeholder:"e.g., https://docs.google.com/document/d/..."},null,8,["modelValue","disabled"]),f[7]||(f[7]=e("p",{class:"text-xs text-gray-500 mt-1"},"Leave empty if uploading a file below.",-1)),p(ae,{message:S.content_url?S.content_url[0]:"",class:"mt-2"},null,8,["message"])]),i.content_url&&!i.attachment_file?(o(),r("div",ec,[p(q,{for:"content_url_type",value:"Type of Content URL"}),p(he,{id:"content_url_type",modelValue:i.content_url_type,"onUpdate:modelValue":f[5]||(f[5]=V=>i.content_url_type=V),options:u,"value-key":"value","label-key":"label",placeholder:"Select the type of content this URL links to",class:"mt-1 block w-full",required:""},null,8,["modelValue"]),p(ae,{message:S.content_url_type?S.content_url_type[0]:"",class:"mt-2"},null,8,["message"])])):E("",!0),e("div",null,[p(q,{for:"attachment_file",value:"Upload File (PDF, Image)"}),e("input",{id:"attachment_file",ref_key:"fileInput",ref:m,type:"file",onChange:v,class:"mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100",disabled:!!i.content_url,accept:"application/pdf,image/*"},null,40,tc),f[9]||(f[9]=e("p",{class:"text-xs text-gray-500 mt-1"},"Max 10MB. Leave empty if providing a URL above.",-1)),p(ae,{message:S.attachment_file?S.attachment_file[0]:"",class:"mt-2"},null,8,["message"]),d.value?(o(),r("div",sc,[f[8]||(f[8]=e("p",{class:"text-sm font-medium text-gray-700 mb-2"},"Image Preview:",-1)),e("img",{src:d.value,alt:"File Preview",class:"max-w-full h-auto rounded-lg shadow-md max-h-60 object-contain"},null,8,ac)])):E("",!0)]),e("div",lc,[me(e("input",{id:"is_visible_to_client",type:"checkbox","onUpdate:modelValue":f[6]||(f[6]=V=>i.is_visible_to_client=V),class:"rounded border-gray-300 text-indigo-600 shadow-sm focus:ring-indigo-500"},null,512),[[tt,i.is_visible_to_client]]),p(q,{for:"is_visible_to_client",value:"Visible to Client",class:"ml-2"}),p(ae,{message:S.is_visible_to_client?S.is_visible_to_client[0]:"",class:"mt-2"},null,8,["message"])])])]),_:1},8,["show","api-endpoint","form-data"]))}};function dc(){return{formatDate:n=>n?new Date(n).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"",formatDateTime:n=>n?new Date(n).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"",timeAgo:n=>{if(!n)return"";const i=new Date(n),c=Math.floor((new Date-i)/1e3);let u=c/31536e3;return u>1?Math.floor(u)+" years ago":(u=c/2592e3,u>1?Math.floor(u)+" months ago":(u=c/86400,u>1?Math.floor(u)+" days ago":(u=c/3600,u>1?Math.floor(u)+" hours ago":(u=c/60,u>1?Math.floor(u)+" minutes ago":Math.floor(c)+" seconds ago"))))}}}const uc={class:"p-6 bg-white rounded-lg shadow-md min-h-[calc(100vh-6rem)]"},cc={class:"flex justify-between items-center mb-4"},mc={class:"flex gap-2"},vc={key:0},pc={key:1},hc={class:"mb-6 bg-gray-50 p-4 rounded-lg"},gc={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4"},yc={key:0,class:"mt-3 text-sm text-gray-600"},fc={key:0,class:"text-red-600 font-medium"},bc={key:0,class:"text-center text-gray-600 text-sm animate-pulse py-4"},_c={key:1,class:"text-center py-4"},wc={class:"text-red-600 text-sm font-medium"},xc={key:2,class:"overflow-x-auto"},kc={class:"min-w-full divide-y divide-gray-200"},Dc={class:"bg-white divide-y divide-gray-200"},Cc={class:"px-4 py-3 text-sm text-gray-900"},Ec={class:"px-4 py-3 text-sm text-gray-700 capitalize"},Tc={class:"px-4 py-3 text-sm text-gray-700"},$c={class:"px-4 py-3 text-sm text-gray-700"},Sc={class:"px-4 py-3 text-sm text-gray-700"},Mc={class:"px-4 py-3 text-sm text-gray-700"},jc={class:"px-4 py-3 text-sm text-gray-700"},Vc={class:"px-4 py-3 text-right"},Ac={class:"flex justify-end space-x-2"},Ic=["onClick"],Oc={key:3,class:"text-center py-4"},Lc={__name:"ProjectDeliverableTab",props:{projectId:{type:[String,Number],required:!0},canCreateDeliverables:{type:Boolean,default:!1},canViewDeliverables:{type:Boolean,default:!1}},emits:["deliverablesUpdated","openDeliverableDetailSidebar"],setup(s,{emit:t}){const a=s,n=t,i=k([]),l=k(!0),c=k(null),u=k(!1),m=k({status:"",type:"",visibility:"",clientStatus:""}),d=[{value:"",label:"All Statuses"},{value:"pending_review",label:"Pending Review"},{value:"for_information",label:"For Information"},{value:"approved",label:"Approved"},{value:"revisions_requested",label:"Revisions Requested"},{value:"completed",label:"Completed"}],v=[{value:"",label:"All Types"},{value:"blog_post",label:"Blog Post"},{value:"design_mockup",label:"Design Mockup"},{value:"social_media_post",label:"Social Media Post"},{value:"report",label:"Report"},{value:"contract_draft",label:"Contract Draft"},{value:"proposal",label:"Proposal"},{value:"other",label:"Other"}],y=[{value:"",label:"All Visibility"},{value:"visible_to_client",label:"Visible to Client"},{value:"not_visible_to_client",label:"Not Visible to Client"}],w=[{value:"",label:"All Client Status"},{value:"read",label:"Read"},{value:"unread",label:"Unread"},{value:"approved",label:"Approved"},{value:"revisions_requested",label:"Revisions Requested"}],C=V=>{var U;if(!V.is_visible_to_client)return{status:"N/A",class:"bg-gray-100 text-gray-800"};const R=(U=V.client_interactions)==null?void 0:U[0];return R?R.approved_at?{status:"Approved",class:"bg-green-100 text-green-800"}:R.revisions_requested_at?{status:"Revisions Requested",class:"bg-yellow-100 text-yellow-800"}:R.rejected_at?{status:"Rejected",class:"bg-red-100 text-red-800"}:R.read_at?{status:`Read on ${new Date(R.read_at).toLocaleDateString()}`,class:"bg-blue-100 text-blue-800"}:{status:"Unread",class:"bg-red-100 text-red-800"}:{status:"Unread",class:"bg-red-100 text-red-800"}},D=P(()=>i.value.length?i.value.filter(V=>{const R=C(V);return!(m.value.status&&V.status!==m.value.status||m.value.type&&V.type!==m.value.type||m.value.visibility&&(m.value.visibility==="visible_to_client"&&!V.is_visible_to_client||m.value.visibility==="not_visible_to_client"&&V.is_visible_to_client)||m.value.clientStatus&&(m.value.clientStatus==="read"&&!R.status.startsWith("Read")||m.value.clientStatus==="unread"&&R.status!=="Unread"||m.value.clientStatus==="approved"&&R.status!=="Approved"||m.value.clientStatus==="revisions_requested"&&R.status!=="Revisions Requested"))}):[]),T=()=>{m.value.status="",m.value.type="",m.value.visibility="",m.value.clientStatus=""},g=async()=>{if(!a.canViewDeliverables){c.value="You do not have permission to view deliverables.",l.value=!1;return}l.value=!0,c.value=null;try{const V=await window.axios.get(route("projects.deliverables.index",a.projectId));i.value=V.data}catch(V){console.error("Error fetching deliverables:",V),c.value="Failed to load deliverables."}finally{l.value=!1}},f=()=>{g(),n("deliverablesUpdated")},S=V=>{n("openDeliverableDetailSidebar",V)};return fe(()=>{g()}),re(()=>a.projectId,()=>{g()}),(V,R)=>(o(),r("div",uc,[e("div",cc,[R[7]||(R[7]=e("h4",{class:"text-lg font-semibold text-gray-900"},"Project Deliverables & Approvals",-1)),e("div",mc,[p(ye,{onClick:g,disabled:l.value,class:"text-indigo-600 hover:text-indigo-800"},{default:N(()=>[l.value?(o(),r("span",pc,"Loading...")):(o(),r("span",vc,"Refresh"))]),_:1},8,["disabled"]),s.canCreateDeliverables?(o(),X(ue,{key:0,onClick:R[0]||(R[0]=U=>u.value=!0),class:"bg-indigo-600 hover:bg-indigo-700 transition-colors"},{default:N(()=>R[6]||(R[6]=[B(" Add New Deliverable ",-1)])),_:1,__:[6]})):E("",!0)])]),e("div",hc,[e("div",gc,[e("div",null,[p(q,{for:"deliverable-status-filter",value:"Status"}),p(he,{id:"deliverable-status-filter",modelValue:m.value.status,"onUpdate:modelValue":R[1]||(R[1]=U=>m.value.status=U),options:d,placeholder:"All Statuses",class:"mt-1"},null,8,["modelValue"])]),e("div",null,[p(q,{for:"deliverable-type-filter",value:"Type"}),p(he,{id:"deliverable-type-filter",modelValue:m.value.type,"onUpdate:modelValue":R[2]||(R[2]=U=>m.value.type=U),options:v,placeholder:"All Types",class:"mt-1"},null,8,["modelValue"])]),e("div",null,[p(q,{for:"deliverable-visibility-filter",value:"Visibility"}),p(he,{id:"deliverable-visibility-filter",modelValue:m.value.visibility,"onUpdate:modelValue":R[3]||(R[3]=U=>m.value.visibility=U),options:y,placeholder:"All Visibility",class:"mt-1"},null,8,["modelValue"])]),e("div",null,[p(q,{for:"deliverable-client-status-filter",value:"Client Status"}),p(he,{id:"deliverable-client-status-filter",modelValue:m.value.clientStatus,"onUpdate:modelValue":R[4]||(R[4]=U=>m.value.clientStatus=U),options:w,placeholder:"All Client Status",class:"mt-1"},null,8,["modelValue"])])]),e("div",{class:"flex justify-end mt-4"},[e("button",{type:"button",onClick:T,class:"px-3 py-2 text-sm text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-md transition-colors"}," Clear Filters ")]),Object.values(m.value).some(U=>U!==null&&U!=="")?(o(),r("div",yc,[e("p",null,[B(" Showing "+h(D.value.length)+" of "+h(i.value.length)+" deliverables ",1),D.value.length===0?(o(),r("span",fc," (No deliverables match the current filters) ")):E("",!0)])])):E("",!0)]),l.value?(o(),r("div",bc," Loading deliverables... ")):c.value?(o(),r("div",_c,[e("p",wc,h(c.value),1)])):D.value.length?(o(),r("div",xc,[e("table",kc,[R[8]||(R[8]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Title"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Type"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Status"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Submitted By"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Submitted On"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Visibility"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Client Status"),B(),e("th",{class:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"Actions")])],-1)),e("tbody",Dc,[(o(!0),r(J,null,ee(D.value,U=>{var M;return o(),r("tr",{key:U.id,class:"hover:bg-gray-50 transition-colors"},[e("td",Cc,h(U.title),1),e("td",Ec,h(U.type.replace(/_/g," ")),1),e("td",Tc,[e("span",{class:Q({"px-2 py-1 rounded-full text-xs font-medium":!0,"bg-yellow-100 text-yellow-800":U.status==="pending_review"||U.status==="revisions_requested","bg-green-100 text-green-800":U.status==="approved","bg-blue-100 text-blue-800":U.status==="completed","bg-gray-100 text-gray-800":U.status==="for_information"})},h(U.status.replace(/_/g," ").replace(/\b\w/g,I=>I.toUpperCase())),3)]),e("td",$c,h(((M=U.team_member)==null?void 0:M.name)||"Unknown"),1),e("td",Sc,h(new Date(U.submitted_at).toLocaleDateString()),1),e("td",Mc,[e("span",{class:Q({"px-2 py-1 rounded-full text-xs font-medium":!0,"bg-green-100 text-green-800":U.is_visible_to_client,"bg-red-100 text-red-800":!U.is_visible_to_client})},h(U.is_visible_to_client?"Visible":"Hidden"),3)]),e("td",jc,[e("span",{class:Q(["px-2 py-1 rounded-full text-xs font-medium",C(U).class])},h(C(U).status),3)]),e("td",Vc,[e("div",Ac,[e("button",{onClick:I=>S(U.id),class:"text-purple-600 hover:text-purple-800 text-sm font-medium"}," View Details ",8,Ic)])])])}),128))])])])):(o(),r("div",Oc,R[9]||(R[9]=[e("p",{class:"text-gray-400 text-sm"},"No deliverables found for this project.",-1),e("p",{class:"text-gray-500 text-sm mt-2"},' Click the "Add New Deliverable" button to create one. ',-1)]))),p(Et,{show:u.value,"project-id":s.projectId,onClose:R[5]||(R[5]=U=>u.value=!1),onSaved:f},null,8,["show","project-id"])]))}},Uc=Ee(Lc,[["__scopeId","data-v-40d67f52"]]),Nc={key:0,class:"text-center py-8 text-gray-500"},Pc={key:1,class:"text-center py-8 text-red-600"},Rc={key:2,class:"space-y-6"},Fc={class:"bg-gray-50 p-4 rounded-lg shadow-sm"},Bc={class:"text-xl font-bold text-gray-900 mb-2"},Hc={class:"flex items-center space-x-2 text-sm text-gray-600 mb-4"},Wc={class:"text-indigo-600 font-medium"},Yc={class:"text-gray-700"},zc={class:"text-gray-700 leading-relaxed"},qc={class:"mt-4 space-y-2 text-sm"},Gc={key:0,class:"text-blue-600 hover:underline"},Kc=["href"],Jc={key:1,class:"text-blue-600 hover:underline"},Zc=["href"],Xc={key:2,class:"text-green-600 font-medium"},Qc={class:"bg-white p-4 rounded-lg shadow-sm"},em={key:0,class:"space-y-3"},tm={class:"font-semibold text-gray-800"},sm={class:"text-sm text-gray-700"},am={class:"font-medium"},lm={key:0,class:"text-xs text-gray-500 ml-2"},im={key:0,class:"text-sm text-gray-600 mt-1"},nm={key:1,class:"text-gray-500 text-sm py-2"},om={class:"bg-white p-4 rounded-lg shadow-sm"},rm={class:"flex justify-between items-center mb-4 border-b pb-2"},dm={class:"space-y-3 mb-4"},um={key:0,class:"space-y-3"},cm={class:"text-sm text-gray-700"},mm={class:"text-xs text-gray-500 mt-1"},vm={key:0},pm={key:1,class:"ml-2 text-gray-400"},hm={key:1,class:"text-gray-500 text-sm py-2"},gm={key:3,class:"text-center py-8 text-gray-500"},ym={__name:"DeliverableDetailSidebar",props:{projectId:{type:Number,required:!0},deliverableId:{type:Number,required:!0}},emits:["close","deliverable-updated"],setup(s,{emit:t}){const a=s,n=t,i=k(null),l=k(!0),c=k(""),{formatDateTime:u,timeAgo:m}=dc(),d=os({comment_text:"",context:""}),v=async()=>{l.value=!0,c.value="";try{const g=await window.axios.get(route("projects.deliverables.show",{project:a.projectId,deliverable:a.deliverableId}));i.value=g.data}catch(g){c.value="Failed to load deliverable details.",console.error("Error fetching deliverable details:",g)}finally{l.value=!1}};re(()=>a.deliverableId,g=>{g?v():i.value=null},{immediate:!0});const y=k(!1),w=async()=>{var g,f;if(i.value){y.value=!0,d.errors={};try{const S=await window.axios.post(`/api/projects/${a.projectId}/deliverables/${a.deliverableId}/comments`,{comment_text:d.comment_text,context:d.context});d.comment_text="",d.context="",v(),n("deliverable-updated")}catch(S){console.error("Error adding comment:",S),S.response&&S.response.status===422?d.errors=S.response.data.errors:console.error("Failed to add comment:",((f=(g=S.response)==null?void 0:g.data)==null?void 0:f.message)||S.message)}finally{y.value=!1}}},C=P(()=>i.value?{"bg-yellow-100 text-yellow-800":i.value.status==="pending_review"||i.value.status==="revisions_requested","bg-green-100 text-green-800":i.value.status==="approved","bg-blue-100 text-blue-800":i.value.status==="completed","bg-gray-100 text-gray-800":i.value.status==="for_information"}:""),D=g=>{let f="No Action Yet",S="";return g.approved_at?(f="Approved",S=u(g.approved_at)):g.revisions_requested_at?(f="Revisions Requested",S=u(g.revisions_requested_at)):g.rejected_at?(f="Rejected",S=u(g.rejected_at)):g.read_at&&(f="Read",S=u(g.read_at)),{status:f,timestamp:S}},T=g=>g.creator_type==="App\\Models\\Client"?"Client":g.creator_type==="App\\Models\\User"?"Team Member":"Unknown";return(g,f)=>{var S;return l.value?(o(),r("div",Nc," Loading deliverable details... ")):c.value?(o(),r("div",Pc,h(c.value),1)):i.value?(o(),r("div",Rc,[e("div",Fc,[e("h4",Bc,h(i.value.title),1),e("div",Hc,[e("span",{class:Q(["px-2 py-1 rounded-full text-xs font-medium",C.value])},h(i.value.status.replace(/_/g," ").replace(/\b\w/g,V=>V.toUpperCase())),3),e("span",Wc," | "+h(i.value.type.replace(/_/g," "))+" | ",1),e("span",Yc," Submitted by: "+h(((S=i.value.team_member)==null?void 0:S.name)||"Unknown"),1)]),e("p",zc,h(i.value.description||"No description provided."),1),e("div",qc,[i.value.content_url?(o(),r("div",Gc,[e("a",{href:i.value.content_url,target:"_blank",rel:"noopener noreferrer"},"View Content Link ("+h(i.value.mime_type||"Unknown Type")+")",9,Kc)])):E("",!0),i.value.attachment_path?(o(),r("div",Jc,[e("a",{href:i.value.attachment_path,target:"_blank",rel:"noopener noreferrer"},"View Attachment",8,Zc)])):E("",!0),e("div",{class:Q(i.value.is_visible_to_client?"text-green-600":"text-red-600")}," Visibility: "+h(i.value.is_visible_to_client?"Visible to Client":"Not Visible to Client"),3),i.value.overall_approved_at?(o(),r("div",Xc," Overall Approved by Client on "+h(K(u)(i.value.overall_approved_at)),1)):E("",!0)])]),e("div",Qc,[f[3]||(f[3]=e("h5",{class:"text-lg font-semibold text-gray-800 border-b pb-2 mb-4"},"Client Interactions",-1)),i.value.client_interactions&&i.value.client_interactions.length>0?(o(),r("div",em,[(o(!0),r(J,null,ee(i.value.client_interactions,V=>{var R;return o(),r("div",{key:V.id,class:"p-3 bg-gray-50 rounded-md"},[e("p",tm,h(((R=V.client)==null?void 0:R.name)||"Unknown Client"),1),e("p",sm,[f[2]||(f[2]=B(" Status: ",-1)),e("span",am,h(D(V).status),1),D(V).timestamp?(o(),r("span",lm," ("+h(D(V).timestamp)+") ",1)):E("",!0)]),V.feedback_text?(o(),r("p",im,'Feedback: "'+h(V.feedback_text)+'"',1)):E("",!0)])}),128))])):(o(),r("div",nm,"No client interactions recorded yet."))]),e("div",om,[e("div",rm,[f[5]||(f[5]=e("h5",{class:"text-lg font-semibold text-gray-800"},"Comments",-1)),p(ue,{onClick:w,disabled:K(d).processing,class:"bg-indigo-600 hover:bg-indigo-700 transition-colors"},{default:N(()=>f[4]||(f[4]=[B(" Add Comment ",-1)])),_:1,__:[4]},8,["disabled"])]),e("div",dm,[e("div",null,[p(q,{for:"new-comment-text",value:"New Comment",class:"sr-only"}),me(e("textarea",{id:"new-comment-text","onUpdate:modelValue":f[0]||(f[0]=V=>K(d).comment_text=V),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",rows:"3",placeholder:"Type your comment here..."},null,512),[[be,K(d).comment_text]]),p(ae,{message:K(d).errors.comment_text,class:"mt-2"},null,8,["message"])]),e("div",null,[p(q,{for:"comment-context",value:"Context (Optional, e.g., 'Paragraph 2', 'Image 1')",class:"sr-only"}),p(oe,{id:"comment-context",modelValue:K(d).context,"onUpdate:modelValue":f[1]||(f[1]=V=>K(d).context=V),type:"text",class:"mt-1 block w-full",placeholder:"Context (optional)"},null,8,["modelValue"]),p(ae,{message:K(d).errors.context,class:"mt-2"},null,8,["message"])])]),i.value.comments&&i.value.comments.length>0?(o(),r("div",um,[(o(!0),r(J,null,ee(i.value.comments,V=>(o(),r("div",{key:V.id,class:"p-3 bg-gray-50 rounded-md"},[e("p",cm,h(V.content),1),e("p",mm,[B(" By "+h(V.creator_name||"Unknown")+" ("+h(T(V))+") ",1),V.created_at?(o(),r("span",vm,h(K(m)(V.created_at)),1)):E("",!0),V.context?(o(),r("span",pm,"("+h(V.context)+")",1)):E("",!0)])]))),128))])):(o(),r("div",hm,"No comments for this deliverable yet."))])])):(o(),r("div",gm," Select a deliverable to view details. "))}}},fm={class:"p-6 bg-white rounded-lg shadow-md min-h-[calc(100vh-6rem)]"},bm={class:"flex justify-between items-center mb-4"},_m={class:"mb-6 bg-gray-50 p-4 rounded-lg"},wm={class:"flex items-center gap-4"},xm={class:"flex-1 min-w-[200px]"},km={key:0,class:"text-red-600 text-sm mt-2"},Dm={key:1,class:"text-gray-600 text-sm mt-2 animate-pulse"},Cm={key:2,class:"text-gray-500 text-sm mt-2"},Em={class:"mt-6"},Tm={class:"flex justify-between items-center mb-3"},$m={class:"text-md font-medium text-gray-800"},Sm={key:0},Mm={key:1},jm={key:0,class:"text-center text-gray-600 text-sm animate-pulse py-8"},Vm={key:1,class:"text-center py-8"},Am={class:"text-red-600 text-sm font-medium"},Im={key:2,class:"text-center py-8"},Om={class:"text-red-600 text-sm font-medium"},Lm={key:3,class:"space-y-8"},Um={class:"bg-gray-50 p-6 rounded-lg shadow-sm grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"},Nm={class:"flex flex-col items-center p-3 bg-white rounded-md shadow-xs"},Pm={class:"text-lg font-semibold text-gray-900"},Rm={class:"flex flex-col items-center p-3 bg-white rounded-md shadow-xs"},Fm={class:"text-lg font-semibold text-gray-900"},Bm={class:"flex flex-col items-center p-3 bg-white rounded-md shadow-xs"},Hm={class:"text-lg font-semibold text-gray-900"},Wm={class:"flex flex-col items-center p-3 bg-white rounded-md shadow-xs"},Ym={class:"text-lg font-semibold text-gray-900"},zm={class:"flex flex-col items-center p-3 bg-white rounded-md shadow-xs"},qm={class:"text-lg font-semibold text-gray-900"},Gm={class:"flex flex-col items-center p-3 bg-white rounded-md shadow-xs"},Km={class:"text-lg font-semibold text-gray-900"},Jm={class:"flex flex-col items-center p-3 bg-white rounded-md shadow-xs"},Zm={class:"text-lg font-semibold text-gray-900"},Xm={class:"bg-white p-6 rounded-lg shadow-sm"},Qm={class:"overflow-x-auto max-h-60"},ev={class:"min-w-full divide-y divide-gray-200"},tv={class:"bg-white divide-y divide-gray-200"},sv={class:"px-4 py-3 text-sm text-gray-900"},av={class:"px-4 py-3 text-sm text-gray-700"},lv={class:"px-4 py-3 text-sm text-gray-700"},iv={key:0,class:"text-gray-500 text-sm py-2"},nv={class:"bg-white p-6 rounded-lg shadow-sm"},ov={class:"overflow-x-auto max-h-60"},rv={class:"min-w-full divide-y divide-gray-200"},dv={class:"bg-white divide-y divide-gray-200"},uv={class:"px-4 py-3 text-sm text-gray-900"},cv={class:"px-4 py-3 text-sm text-gray-700"},mv={class:"px-4 py-3 text-sm text-gray-700"},vv={class:"px-4 py-3 text-sm text-gray-700"},pv={class:"px-4 py-3 text-sm text-gray-700"},hv={key:0,class:"text-gray-500 text-sm py-2"},gv={class:"bg-white p-6 rounded-lg shadow-sm"},yv={class:"overflow-x-auto max-h-60"},fv={class:"min-w-full divide-y divide-gray-200"},bv={class:"bg-white divide-y divide-gray-200"},_v={class:"px-4 py-3 text-sm text-gray-900"},wv={class:"px-4 py-3 text-sm text-gray-700"},xv={key:0,class:"text-gray-500 text-sm py-2"},kv={class:"bg-white p-6 rounded-lg shadow-sm"},Dv={class:"overflow-x-auto"},Cv={class:"min-w-full divide-y divide-gray-200"},Ev={class:"bg-white divide-y divide-gray-200"},Tv={class:"px-4 py-3 text-sm text-gray-900"},$v={class:"px-4 py-3 text-sm text-gray-700"},Sv={key:0,class:"text-gray-500 text-sm py-2"},Mv={class:"bg-white p-6 rounded-lg shadow-sm"},jv={class:"overflow-x-auto"},Vv={class:"min-w-full divide-y divide-gray-200"},Av={class:"bg-white divide-y divide-gray-200"},Iv={class:"px-4 py-3 text-sm text-gray-900"},Ov={class:"px-4 py-3 text-sm text-gray-700"},Lv={key:0,class:"text-gray-500 text-sm py-2"},Uv={class:"bg-white p-6 rounded-lg shadow-sm"},Nv={class:"overflow-x-auto max-h-60"},Pv={class:"min-w-full divide-y divide-gray-200"},Rv={class:"bg-white divide-y divide-gray-200"},Fv={class:"px-4 py-3 text-sm text-gray-900"},Bv={class:"px-4 py-3 text-sm text-gray-700"},Hv={key:0,class:"text-gray-500 text-sm py-2"},Wv={class:"bg-white p-6 rounded-lg shadow-sm grid grid-cols-1 md:grid-cols-2 gap-6"},Yv={key:0,class:"space-y-2"},zv={class:"font-medium"},qv={key:1,class:"text-gray-500 text-sm py-2"},Gv={key:0,class:"space-y-2"},Kv={class:"font-medium"},Jv={key:1,class:"text-gray-500 text-sm py-2"},Zv={key:4,class:"text-center py-8 text-gray-500"},Xv={__name:"SeoReportTab",props:{projectId:{type:[String,Number],required:!0},canCreateSeoReports:{type:Boolean,default:!1}},emits:["openCreateSeoReportModal"],setup(s,{emit:t}){const a=s,n=t,i=k([]),l=k(""),c=k(null),u=k(!0),m=k(!1),d=k(null),v=k(null),y=k(null),w=async()=>{u.value=!0,d.value=null;try{const H=await window.axios.get(`/api/projects/${a.projectId}/seo-reports/available-months`);i.value=H.data.map(A=>({value:A,label:new Date(A+"-01").toLocaleString("en-US",{year:"numeric",month:"long"})})),i.value.length>0&&(l.value=i.value[0].value)}catch(H){console.error("Error fetching available months:",H),d.value="Failed to load available report months."}finally{u.value=!1}},C=H=>{const $=["clientName","reportingPeriod","authorityScoreValue","totalClicksValue","totalImpressionsValue","averagePositionValue","totalBacklinksValue","clicksImpressions","trafficSources","deviceUsage","countryPerformance","coreVitals","topQueries","keywordRankings","backlinks","zeroClickKeywords"].filter(O=>!(O in H));return $.length>0?`Report data is missing expected top-level keys: ${$.join(", ")}. Please ensure the JSON structure is correct.`:!H.clicksImpressions||!Array.isArray(H.clicksImpressions.labels)||!Array.isArray(H.clicksImpressions.clicks)?"clicksImpressions data is malformed.":!H.trafficSources||!Array.isArray(H.trafficSources.labels)||!Array.isArray(H.trafficSources.sessions)?"trafficSources data is malformed.":null},D=async()=>{if(!l.value){c.value=null,y.value=null;return}m.value=!0,v.value=null,y.value=null;try{const A=(await window.axios.get(`/api/projects/${a.projectId}/seo-reports/${l.value}`)).data,$=C(A);$?(y.value=$,c.value=null):c.value=A}catch(H){console.error("Error fetching SEO report:",H),v.value="Failed to load SEO report for the selected month.",c.value=null,y.value=null}finally{m.value=!1}},T=(H=null)=>{n("openCreateSeoReportModal",H)},g=P(()=>{var H;return((H=c.value)==null?void 0:H.clientName)||"N/A"}),f=P(()=>{var H;return((H=c.value)==null?void 0:H.reportingPeriod)||"N/A"}),S=P(()=>{var H;return((H=c.value)==null?void 0:H.authorityScoreValue)||"N/A"}),V=P(()=>{var H;return((H=c.value)==null?void 0:H.totalClicksValue)||"N/A"}),R=P(()=>{var H;return((H=c.value)==null?void 0:H.totalImpressionsValue)||"N/A"}),U=P(()=>{var H;return((H=c.value)==null?void 0:H.averagePositionValue)||"N/A"}),M=P(()=>{var H;return((H=c.value)==null?void 0:H.totalBacklinksValue)||"N/A"}),I=P(()=>{var H;return((H=c.value)==null?void 0:H.clicksImpressions)||{labels:[],clicks:[],impressions:[]}}),b=P(()=>{var H;return((H=c.value)==null?void 0:H.trafficSources)||{labels:[],sessions:[],colors:[]}}),_=P(()=>{var H;return((H=c.value)==null?void 0:H.deviceUsage)||{labels:[],clicks:[],colors:[]}}),x=P(()=>{var H;return((H=c.value)==null?void 0:H.countryPerformance)||{labels:[],clicks:[]}}),j=P(()=>{var H;return((H=c.value)==null?void 0:H.coreVitals)||{mobile:{},desktop:{}}}),Z=P(()=>{var H;return((H=c.value)==null?void 0:H.topQueries)||[]}),ie=P(()=>{var H;return((H=c.value)==null?void 0:H.keywordRankings)||[]});return fe(()=>{w()}),re(()=>a.projectId,()=>{w()}),re(l,H=>{H?D():(c.value=null,y.value=null)}),(H,A)=>(o(),r("div",fm,[e("div",bm,[A[4]||(A[4]=e("h4",{class:"text-lg font-semibold text-gray-900"},"SEO Reports",-1)),s.canCreateSeoReports?(o(),X(ue,{key:0,onClick:A[0]||(A[0]=$=>T()),class:"bg-indigo-600 hover:bg-indigo-700 transition-colors"},{default:N(()=>A[3]||(A[3]=[B(" Add New Report ",-1)])),_:1,__:[3]})):E("",!0)]),e("div",_m,[e("div",wm,[e("div",xm,[p(q,{for:"seo-report-month-filter",value:"Select Report Month"}),p(he,{id:"seo-report-month-filter",modelValue:l.value,"onUpdate:modelValue":A[1]||(A[1]=$=>l.value=$),options:i.value,"value-key":"value","label-key":"label",placeholder:"Select a month",disabled:u.value||i.value.length===0,class:"mt-1"},null,8,["modelValue","options","disabled"])])]),d.value?(o(),r("div",km,h(d.value),1)):E("",!0),u.value?(o(),r("div",Dm,"Loading available months...")):E("",!0),!u.value&&i.value.length===0?(o(),r("div",Cm,"No SEO reports available for this project.")):E("",!0)]),e("div",Em,[e("div",Tm,[e("h5",$m,[l.value?(o(),r("span",Sm,"Report for "+h(new Date(l.value+"-01").toLocaleString("en-US",{year:"numeric",month:"long"})),1)):(o(),r("span",Mm,"Select a month to view report"))]),s.canCreateSeoReports&&c.value&&l.value?(o(),X(ue,{key:0,onClick:A[2]||(A[2]=$=>T({report_date:l.value,data:JSON.stringify(c.value,null,2)})),class:"bg-blue-500 hover:bg-blue-600 transition-colors text-sm py-1 px-3"},{default:N(()=>A[5]||(A[5]=[B(" Edit Report ",-1)])),_:1,__:[5]})):E("",!0)]),m.value?(o(),r("div",jm," Loading SEO report data... ")):v.value?(o(),r("div",Vm,[e("p",Am,h(v.value),1)])):y.value?(o(),r("div",Im,[e("p",Om,"Data Structure Error: "+h(y.value),1),A[6]||(A[6]=e("p",{class:"text-gray-500 text-sm mt-2"},"Please ensure the JSON data conforms to the expected format.",-1))])):c.value?(o(),r("div",Lm,[e("div",Um,[e("div",Nm,[A[7]||(A[7]=e("p",{class:"text-sm text-gray-500"},"Client Name",-1)),e("p",Pm,h(g.value),1)]),e("div",Rm,[A[8]||(A[8]=e("p",{class:"text-sm text-gray-500"},"Reporting Period",-1)),e("p",Fm,h(f.value),1)]),e("div",Bm,[A[9]||(A[9]=e("p",{class:"text-sm text-gray-500"},"Authority Score",-1)),e("p",Hm,h(S.value),1)]),e("div",Wm,[A[10]||(A[10]=e("p",{class:"text-sm text-gray-500"},"Total Clicks",-1)),e("p",Ym,h(V.value),1)]),e("div",zm,[A[11]||(A[11]=e("p",{class:"text-sm text-gray-500"},"Total Impressions",-1)),e("p",qm,h(R.value),1)]),e("div",Gm,[A[12]||(A[12]=e("p",{class:"text-sm text-gray-500"},"Average Position",-1)),e("p",Km,h(U.value),1)]),e("div",Jm,[A[13]||(A[13]=e("p",{class:"text-sm text-gray-500"},"Total Backlinks",-1)),e("p",Zm,h(M.value),1)])]),e("div",Xm,[A[15]||(A[15]=e("h5",{class:"text-lg font-semibold text-gray-800 border-b pb-2 mb-4"},"Clicks & Impressions Trend",-1)),e("div",Qm,[e("table",ev,[A[14]||(A[14]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Date"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Clicks"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Impressions")])],-1)),e("tbody",tv,[(o(!0),r(J,null,ee(I.value.labels,($,O)=>(o(),r("tr",{key:O},[e("td",sv,h($),1),e("td",av,h(I.value.clicks[O]),1),e("td",lv,h(I.value.impressions[O]),1)]))),128))])])]),I.value.labels.length?E("",!0):(o(),r("p",iv,"No clicks and impressions data available."))]),e("div",nv,[A[17]||(A[17]=e("h5",{class:"text-lg font-semibold text-gray-800 border-b pb-2 mb-4"},"Top Queries",-1)),e("div",ov,[e("table",rv,[A[16]||(A[16]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Query"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Clicks"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Impressions"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"CTR"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Position")])],-1)),e("tbody",dv,[(o(!0),r(J,null,ee(Z.value,$=>(o(),r("tr",{key:$.query},[e("td",uv,h($.query),1),e("td",cv,h($.clicks),1),e("td",mv,h($.impressions),1),e("td",vv,h($.ctr)+"%",1),e("td",pv,h($.position),1)]))),128))])])]),Z.value.length?E("",!0):(o(),r("p",hv,"No top queries data available."))]),e("div",gv,[A[19]||(A[19]=e("h5",{class:"text-lg font-semibold text-gray-800 border-b pb-2 mb-4"},"Keyword Rankings",-1)),e("div",yv,[e("table",fv,[A[18]||(A[18]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Keyword"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Ranking")])],-1)),e("tbody",bv,[(o(!0),r(J,null,ee(ie.value,$=>(o(),r("tr",{key:$.keyword},[e("td",_v,h($.keyword),1),e("td",wv,h($.ranking),1)]))),128))])])]),ie.value.length?E("",!0):(o(),r("p",xv,"No keyword rankings data available."))]),e("div",kv,[A[21]||(A[21]=e("h5",{class:"text-lg font-semibold text-gray-800 border-b pb-2 mb-4"},"Traffic Sources",-1)),e("div",Dv,[e("table",Cv,[A[20]||(A[20]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Source"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Sessions")])],-1)),e("tbody",Ev,[(o(!0),r(J,null,ee(b.value.labels,($,O)=>(o(),r("tr",{key:$},[e("td",Tv,h($),1),e("td",$v,h(b.value.sessions[O]),1)]))),128))])])]),b.value.labels.length?E("",!0):(o(),r("p",Sv,"No traffic sources data available."))]),e("div",Mv,[A[23]||(A[23]=e("h5",{class:"text-lg font-semibold text-gray-800 border-b pb-2 mb-4"},"Device Usage",-1)),e("div",jv,[e("table",Vv,[A[22]||(A[22]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Device"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Clicks")])],-1)),e("tbody",Av,[(o(!0),r(J,null,ee(_.value.labels,($,O)=>(o(),r("tr",{key:$},[e("td",Iv,h($),1),e("td",Ov,h(_.value.clicks[O]),1)]))),128))])])]),_.value.labels.length?E("",!0):(o(),r("p",Lv,"No device usage data available."))]),e("div",Uv,[A[25]||(A[25]=e("h5",{class:"text-lg font-semibold text-gray-800 border-b pb-2 mb-4"},"Country Performance (Top 10)",-1)),e("div",Nv,[e("table",Pv,[A[24]||(A[24]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Country"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Clicks")])],-1)),e("tbody",Rv,[(o(!0),r(J,null,ee(x.value.labels,$=>(o(),r("tr",{key:$},[e("td",Fv,h($),1),e("td",Bv,h(x.value.clicks[x.value.labels.indexOf($)]),1)]))),128))])])]),x.value.labels.length?E("",!0):(o(),r("p",Hv,"No country performance data available."))]),e("div",Wv,[e("div",null,[A[26]||(A[26]=e("h5",{class:"text-lg font-semibold text-gray-800 border-b pb-2 mb-4"},"Core Vitals (Mobile)",-1)),j.value.mobile&&j.value.mobile.labels&&j.value.mobile.labels.length?(o(),r("div",Yv,[(o(!0),r(J,null,ee(j.value.mobile.labels,($,O)=>(o(),r("div",{key:$,class:"flex justify-between items-center text-sm text-gray-700"},[e("span",null,h($)+":",1),e("span",zv,h(j.value.mobile.scores[O]),1)]))),128))])):(o(),r("p",qv,"No mobile core vitals data available."))]),e("div",null,[A[27]||(A[27]=e("h5",{class:"text-lg font-semibold text-gray-800 border-b pb-2 mb-4"},"Core Vitals (Desktop)",-1)),j.value.desktop&&j.value.desktop.labels&&j.value.desktop.labels.length?(o(),r("div",Gv,[(o(!0),r(J,null,ee(j.value.desktop.labels,($,O)=>(o(),r("div",{key:$,class:"flex justify-between items-center text-sm text-gray-700"},[e("span",null,h($)+":",1),e("span",Kv,h(j.value.desktop.scores[O]),1)]))),128))])):(o(),r("p",Jv,"No desktop core vitals data available."))])])])):(o(),r("div",Zv," No report data to display. Please select a month from the dropdown. "))])]))}},Qv=Ee(Xv,[["__scopeId","data-v-37cb2f02"]]),ep={class:"space-y-4"},tp={key:0,class:"text-xs text-gray-500 mt-1 text-red-500"},sp=["onBlur"],ap={__name:"CreateSeoReportModal",props:{show:{type:Boolean,default:!1},projectId:{type:[String,Number],required:!0},initialData:{type:Object,default:null}},emits:["close","saved"],setup(s,{emit:t}){const a=s,n=t,i=ke({report_date:"",data:""}),l=k(null);re(()=>[a.show,a.initialData],([g,f])=>{g&&(f?Object.assign(i,{report_date:f.report_date||"",data:f.data||""}):Object.assign(i,{report_date:"",data:""}))},{immediate:!0});const c=g=>{let f=g.data;try{f=JSON.stringify(JSON.parse(g.data))}catch{console.warn("Provided data is not valid JSON, sending as plain string. Backend should validate.")}return{report_date:g.report_date,data:f}},u=P(()=>a.initialData?"Edit SEO Report":"Create New SEO Report"),m=P(()=>`/api/projects/${a.projectId}/seo-reports`),d=P(()=>"post"),v=P(()=>a.initialData?"Update Report":"Create Report"),y=P(()=>a.initialData?"SEO Report updated successfully!":"SEO Report created successfully!"),w=g=>{n("saved",g),n("close")},C=()=>{n("close")},D=()=>{try{const g=JSON.parse(i.data);i.data=JSON.stringify(g,null,2)}catch(g){console.error("Invalid JSON for pretty print:",g)}},T=g=>{if(i.data)try{JSON.parse(i.data),g.data&&g.data[0]==="The data field must be a valid JSON string."&&(g.data=[])}catch{(!g.data||g.data.length===0)&&(g.data=["The data field must be a valid JSON string."])}};return(g,f)=>(o(),X(Ce,{show:s.show,title:u.value,"api-endpoint":m.value,"http-method":d.value,"form-data":i,"submit-button-text":v.value,"success-message":y.value,"format-data-for-api":c,onClose:C,onSubmitted:w},{default:N(({errors:S})=>[e("div",ep,[e("div",null,[p(q,{for:"report_date",value:"Report Month (YYYY-MM)"}),p(oe,{id:"report_date",modelValue:i.report_date,"onUpdate:modelValue":f[0]||(f[0]=V=>i.report_date=V),type:"text",class:"mt-1 block w-full",placeholder:"e.g., 2025-07",required:"",autofocus:"",pattern:"\\d{4}-\\d{2}",title:"Please enter a date in YYYY-MM format (e.g., 2025-07)",disabled:!!s.initialData},null,8,["modelValue","disabled"]),p(ae,{message:S.report_date?S.report_date[0]:"",class:"mt-2"},null,8,["message"]),f[2]||(f[2]=e("p",{class:"text-xs text-gray-500 mt-1"},"Enter the report month in YYYY-MM format (e.g., 2025-07).",-1)),s.initialData?(o(),r("p",tp,"Note: Report month cannot be changed when editing.")):E("",!0)]),e("div",null,[p(q,{for:"report_data",value:"Report Data (JSON)"}),me(e("textarea",{id:"report_data",ref_key:"jsonInputRef",ref:l,"onUpdate:modelValue":f[1]||(f[1]=V=>i.data=V),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 font-mono",rows:"10",placeholder:'Enter JSON data for the report, e.g., {"keywords_ranked": 150, "traffic": 1200, "rankings": {"keyword1": 5, "keyword2": 12}}',required:"",onBlur:V=>T(S)},null,40,sp),[[be,i.data]]),p(ae,{message:S.data?S.data[0]:"",class:"mt-2"},null,8,["message"]),e("div",{class:"flex justify-end mt-2"},[e("button",{type:"button",onClick:D,class:"text-sm text-indigo-600 hover:text-indigo-800 font-medium"}," Format JSON ")])])])]),_:1},8,["show","title","api-endpoint","http-method","form-data","submit-button-text","success-message"]))}},lp={key:0,class:"bg-amber-50 border-l-4 border-amber-500 p-4 mb-6 rounded-md shadow-md"},ip={class:"flex items-center justify-between"},np={class:"flex items-center"},op={class:"ml-3"},rp={class:"text-sm text-amber-800 font-medium"},dp={key:0},up={key:1},cp={key:2},mp={__name:"ProjectTaskNotificationPrompt",props:{overdueTasks:{type:Number,required:!0},dueTodayTasks:{type:Number,required:!0}},emits:["view-tasks"],setup(s,{emit:t}){const a=s,n=t,i=P(()=>a.overdueTasks+a.dueTodayTasks),l=P(()=>i.value>0),c=()=>{n("view-tasks")};return(u,m)=>l.value?(o(),r("div",lp,[e("div",ip,[e("div",np,[m[0]||(m[0]=e("div",{class:"flex-shrink-0"},[e("svg",{class:"h-6 w-6 text-amber-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})])],-1)),e("div",op,[e("p",rp,[s.overdueTasks>0&&s.dueTodayTasks>0?(o(),r("span",dp," This project has "+h(s.overdueTasks)+" overdue "+h(s.overdueTasks===1?"task":"tasks")+" and "+h(s.dueTodayTasks)+" "+h(s.dueTodayTasks===1?"task":"tasks")+" due today. ",1)):s.overdueTasks>0?(o(),r("span",up," This project has "+h(s.overdueTasks)+" overdue "+h(s.overdueTasks===1?"task":"tasks")+" that require attention. ",1)):s.dueTodayTasks>0?(o(),r("span",cp," This project has "+h(s.dueTodayTasks)+" "+h(s.dueTodayTasks===1?"task":"tasks")+" due today. ",1)):E("",!0)])])]),e("div",null,[p(ue,{onClick:c,class:"px-4 py-2 text-sm bg-amber-600 hover:bg-amber-700 focus:ring-amber-500"},{default:N(()=>m[1]||(m[1]=[B(" View ",-1)])),_:1,__:[1]})])])])):E("",!0)}},vp={class:"py-8 max-w-full mx-auto px-4 sm:px-6 lg:px-8"},pp={key:0,class:"text-center text-gray-600 text-lg animate-pulse"},hp={key:1,class:"text-center text-red-600 text-lg font-medium"},gp={key:2,class:"space-y-8"},yp={class:"flex justify-end items-center mb-5"},fp={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"},bp={key:1},_p={key:0,class:"bg-white p-6 rounded-xl shadow-md hover:shadow-lg transition-shadow mb-6"},wp={class:"flex justify-between items-center mb-4"},xp={class:"overflow-x-auto"},kp={class:"min-w-full divide-y divide-gray-200"},Dp={class:"bg-white divide-y divide-gray-200"},Cp={class:"px-4 py-3 text-sm text-gray-900"},Ep={class:"px-4 py-3 text-sm text-gray-700"},Tp={class:"px-4 py-3 text-sm text-gray-700"},$p={class:"px-4 py-3 text-right"},Sp=["onClick"],Mp={key:1,class:"bg-white p-6 rounded-xl shadow-md hover:shadow-lg transition-shadow mb-6"},jp={class:"flex justify-between items-center mb-4"},Vp={key:2,class:"bg-white p-6 rounded-xl shadow-md hover:shadow-lg transition-shadow mb-6"},Ap={class:"flex justify-between items-center mb-4"},Ip={key:0,class:"text-gray-400 text-sm"},Op={key:1,class:"overflow-x-auto"},Lp={class:"min-w-full divide-y divide-gray-200"},Up={class:"bg-white divide-y divide-gray-200"},Np={class:"px-4 py-3 text-sm text-gray-900"},Pp={class:"px-4 py-3 text-sm text-gray-700"},Rp={class:"px-4 py-3 text-sm text-gray-700"},Fp={class:"px-4 py-3 text-sm text-gray-700"},Bp={class:"px-4 py-3 text-sm text-gray-700"},Hp={class:"px-4 py-3 text-right"},Wp={key:3,class:"bg-white p-6 rounded-xl shadow-md hover:shadow-lg transition-shadow mb-6"},Yp={class:"flex justify-between items-center mb-4"},zp={class:"flex items-center gap-4"},qp={key:0},Gp={key:0,class:"space-y-4"},Kp={class:"flex justify-between"},Jp={class:"flex-grow"},Zp={key:0,class:"text-xs text-red-400 block mt-1"},Xp={class:"flex items-center mt-1"},Qp={class:"text-xs text-gray-500"},eh={key:0,class:"ml-2 px-2 py-0.5 bg-indigo-100 text-indigo-800 text-xs rounded-full"},th={key:0},sh={key:1,class:"text-gray-400 text-sm"},ah={__name:"Show",setup(s){const t=Ue(),a=rs().props.id,n=k({clients:[],users:[],notes:[],transactions:[],documents:[],meetings:[],tasks:[],emails:[],deliverables:[]}),i=k(!0),l=k(""),c=k(!1),u=k(!1),m=k(!1),d=k(!1),v=k(!1),y=k(!1),w=k(!1),C=k(!1),D=k(!1),T=k(null),g=k(null),f=k(!1),S=k(!1),V=k(null),R=[{value:"active",label:"Active"},{value:"completed",label:"Completed"},{value:"on_hold",label:"On Hold"},{value:"archived",label:"Archived"}],U=[{value:"Website Designing",label:"Website Designing"},{value:"SEO",label:"SEO"},{value:"Social Media",label:"Social Media"},{value:"Content Writing",label:"Content Writing"},{value:"Graphic Design",label:"Graphic Design"}],M=[{value:"UpWork",label:"UpWork"},{value:"Direct",label:"Direct Client"},{value:"Wix Marketplace",label:"Wix Marketplace"},{value:"Referral",label:"Referral"}],I=k(null),b=k(null),_=ds(n),{canDo:x,canView:j}=st(a),Z=P(()=>{var te,W;return((W=(te=t.value)==null?void 0:te.role_data)==null?void 0:W.slug)==="super-admin"}),ie=P(()=>x("manage_projects").value||Z.value),H=P(()=>x("edit_projects").value||Z.value),A=P(()=>j("emails").value),$=P(()=>x("compose_emails").value),O=P(()=>x("approve_emails").value),G=P(()=>j("project_notes").value),de=P(()=>x("add_project_notes").value),Se=P(()=>j("deliverables").value),F=P(()=>x("create_deliverables").value),L=P(()=>j("seo_reports").value),Y=P(()=>x("create_seo_reports").value),le=P(()=>j("client_contacts").value);P(()=>j("users").value);const Pe=P(()=>j("project_financial",_).value),at=P(()=>j("project_transactions").value);P(()=>j("client_financial").value);const Tt=[{value:"PKR",label:"PKR"},{value:"AUD",label:"AUD"},{value:"INR",label:"INR"},{value:"USD",label:"USD"},{value:"EUR",label:"EUR"},{value:"GBP",label:"GBP"}],Re=k([]),$t=k(null),ze=k(null),Ke=k("all"),St=async()=>{try{const te=await window.axios.get(`/api/projects/${a}/due-and-overdue-tasks`);Re.value=te.data}catch(te){console.error("Error fetching due and overdue tasks:",te)}},Mt=()=>{b.value="tasks",Ke.value="due-overdue",setTimeout(()=>{ze.value&&ze.value.scrollIntoView&&ze.value.scrollIntoView({behavior:"smooth"})},100)},lt=P(()=>n.value.notes?[...n.value.notes].filter(te=>te.type!=="standup").sort((te,W)=>new Date(W.created_at)-new Date(te.created_at)).slice(0,3):[]),it=k([]),Je=async()=>{try{const te=await window.axios.get(`/api/projects/${a}/emails-simplified`,{params:{limit:5}});it.value=te.data}catch(te){console.error("Error fetching latest emails:",te)}},De=async()=>{i.value=!0,l.value="";try{const te=await window.axios.get(`/api/projects/${a}`);n.value=te.data,console.log("Full project data received (Show.vue main fetch):",n.value),await St()}catch(te){l.value="Failed to load project data.",console.error("Error fetching project data:",te),te.response&&(te.response.status===401||te.response.status===403)&&(l.value="You are not authorized to view this project or your session expired. Please log in.")}finally{i.value=!1}},jt=te=>{n.value=te,c.value=!1,De()},Vt=te=>{n.value.tasks=te},At=te=>{n.value.emails=te,A.value&&Je()},nt=te=>{n.value.notes=te},It=()=>{De()},Ot=()=>{I.value&&I.value.fetchMeetings()},ot=()=>{De()},Lt=te=>{b.value=te,Ze(),dt()},Ut=()=>{y.value=!0},Nt=()=>{w.value=!0,b.value="emails"},Pt=async()=>{w.value=!1,await De(),A.value&&await Je()},Rt=()=>{w.value=!1},rt=te=>{T.value=te,g.value=null,D.value=!0},Ze=()=>{D.value=!1,T.value=null},Ft=()=>{De()},Bt=te=>{n.value.tasks=n.value.tasks.filter(W=>W.id!==te),De(),Ze()},Ht=te=>{g.value=te,T.value=null,D.value=!0},dt=()=>{D.value=!1,g.value=null},Wt=()=>{De()},Yt=()=>{f.value=!0},zt=()=>{f.value=!1,De()},qt=(te=null)=>{V.value=te,S.value=!0},Gt=()=>{S.value=!1};return fe(async()=>{console.log("Show.vue mounted, fetching initial data...");try{await us(a),console.log("Project permissions fetched (includes global)")}catch(te){console.error(`Error fetching permissions for project ${a}:`,te)}await vs(),await De(),A.value&&await Je()}),(te,W)=>{const Kt=je("SecondaryButton");return o(),r(J,null,[p(K(cs),{title:n.value.name||"Project Details"},null,8,["title"]),p(ts,null,{default:N(()=>{var ut;return[e("div",vp,[i.value?(o(),r("div",pp," Loading project details... ")):l.value?(o(),r("div",hp,h(l.value),1)):(o(),r("div",gp,[p(mp,{"overdue-tasks":Re.value.filter(z=>new Date(z.due_date)<new Date).length,"due-today-tasks":Re.value.filter(z=>new Date(z.due_date).toDateString()===new Date().toDateString()).length,onViewTasks:Mt},null,8,["overdue-tasks","due-today-tasks"]),p(rn,{project:n.value,"project-id":K(a),"can-manage-projects":ie.value,"is-super-admin":Z.value,"can-edit-projects":H.value,onOpenEditModal:W[0]||(W[0]=z=>c.value=!0),onOpenStandupModal:W[1]||(W[1]=z=>m.value=!0),onOpenMeetingModal:W[2]||(W[2]=z=>u.value=!0),onOpenMagicLinkModal:W[3]||(W[3]=z=>v.value=!0),onResourceSaved:De,onOpenComposeModal:Nt},null,8,["project","project-id","can-manage-projects","is-super-admin","can-edit-projects"]),p(Ts,{"project-id":K(a),ref_key:"meetingsListComponent",ref:I},null,8,["project-id"]),p(fn,{tasks:n.value.tasks||[],emails:n.value.emails||[]},null,8,["tasks","emails"]),e("div",yp,[p(he,{id:"display-currency-switcher",modelValue:K(We),"onUpdate:modelValue":W[4]||(W[4]=z=>ms(We)?We.value=z:null),options:Tt,"value-key":"value","label-key":"label",class:"w-20",containerClasses:"max-w-[150px]"},null,8,["modelValue"])]),Pe.value&&at.value?(o(),X(ru,{key:0,"project-id":K(a),"can-view-project-services-and-payments":Pe.value,"can-view-project-transactions":at.value},null,8,["project-id","can-view-project-services-and-payments","can-view-project-transactions"])):E("",!0),e("div",fp,[le.value?(o(),X(hu,{key:0,"project-id":K(a),"can-view-client-contacts":le.value},null,8,["project-id","can-view-client-contacts"])):E("",!0),p(Du,{"project-id":K(a),"can-view-users":!0},null,8,["project-id"]),p(Pu,{"project-id":K(a),onViewUserTransactions:Ut},null,8,["project-id"])]),p(wn,{ref_key:"navigationRef",ref:ze,selectedTab:b.value,"onUpdate:selectedTab":W[5]||(W[5]=z=>b.value=z),"can-view-emails":A.value,"can-view-notes":G.value,"can-view-deliverables":Se.value,"can-view-seo-reports":L.value},null,8,["selectedTab","can-view-emails","can-view-notes","can-view-deliverables","can-view-seo-reports"]),b.value===null?(o(),r("div",bp,[Re.value.length>0?(o(),r("div",_p,[e("div",wp,[W[26]||(W[26]=e("h4",{class:"text-lg font-semibold text-gray-900"},"Due & Overdue Tasks",-1)),e("button",{onClick:W[6]||(W[6]=z=>b.value="tasks"),class:"text-sm text-indigo-600 hover:text-indigo-800 font-medium"}," View All Tasks → ")]),e("div",xp,[e("table",kp,[W[27]||(W[27]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Title"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Status"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Assigned To"),e("th",{class:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"Actions")])],-1)),e("tbody",Dp,[(o(!0),r(J,null,ee(Re.value,z=>{var Me;return o(),r("tr",{key:z.id,class:"hover:bg-gray-50 transition-colors"},[e("td",Cp,h(z.name),1),e("td",Ep,[e("span",{class:Q({"px-2 py-1 rounded-full text-xs font-medium":!0,"bg-yellow-100 text-yellow-800":z.status==="To Do","bg-blue-100 text-blue-800":z.status==="In Progress","bg-green-100 text-green-800":z.status==="Done","bg-red-100 text-red-800":z.status==="Blocked","bg-gray-100 text-gray-800":z.status==="Archived"})},h(z.status),3)]),e("td",Tp,h((Me=z.assigned_to)==null?void 0:Me.name),1),e("td",$p,[e("button",{onClick:ct=>rt(z.id),class:"text-indigo-600 hover:text-indigo-800 text-sm font-medium"}," View/Edit ",8,Sp)])])}),128))])])])])):(o(),r("div",Mp,[e("div",jp,[W[28]||(W[28]=e("h4",{class:"text-lg font-semibold text-gray-900"},"Due & Overdue Tasks",-1)),e("button",{onClick:W[7]||(W[7]=z=>b.value="tasks"),class:"text-sm text-indigo-600 hover:text-indigo-800 font-medium"}," View All Tasks → ")]),W[29]||(W[29]=e("p",{class:"text-gray-400 text-sm"},"No due or overdue tasks.",-1))])),A.value?(o(),r("div",Vp,[e("div",Ap,[W[30]||(W[30]=e("h4",{class:"text-lg font-semibold text-gray-900"},"Latest Emails",-1)),e("button",{onClick:W[8]||(W[8]=z=>b.value="emails"),class:"text-sm text-indigo-600 hover:text-indigo-800 font-medium"}," View All Emails → ")]),(ut=n.value.emails)!=null&&ut.length?(o(),r("div",Op,[e("table",Lp,[W[32]||(W[32]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Subject"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"From"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Date"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Type"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Status"),e("th",{class:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"Actions")])],-1)),e("tbody",Up,[(o(!0),r(J,null,ee(it.value,z=>{var Me;return o(),r("tr",{key:z.id,class:"hover:bg-gray-50 transition-colors"},[e("td",Np,h(z.subject),1),e("td",Pp,h(((Me=z.sender)==null?void 0:Me.name)||"N/A"),1),e("td",Rp,h(new Date(z.created_at).toLocaleDateString()),1),e("td",Fp,[e("span",{class:Q({"px-2 py-1 rounded-full text-xs font-medium":!0,"bg-blue-100 text-blue-800":z.type==="sent","bg-purple-100 text-purple-800":z.type==="received"})},h(z.type?z.type.toUpperCase():"N/A"),3)]),e("td",Bp,[e("span",{class:Q({"px-2 py-1 rounded-full text-xs font-medium":!0,"bg-green-100 text-green-800":z.status==="sent","bg-yellow-100 text-yellow-800":z.status==="pending_approval","bg-blue-200 text-blue-900":z.status==="pending_approval_received","bg-red-100 text-red-800":z.status==="rejected","bg-gray-100 text-gray-800":z.status==="draft"})},h(z.status.replace("_"," ").toUpperCase()),3)]),e("td",Hp,[p(Kt,{class:"text-indigo-600 hover:text-indigo-800",onClick:ct=>te.viewEmail(z)},{default:N(()=>W[31]||(W[31]=[B(" View ",-1)])),_:2,__:[31]},1032,["onClick"])])])}),128))])])])):(o(),r("div",Ip,"No email communication found."))])):E("",!0),G.value?(o(),r("div",Wp,[e("div",Yp,[W[34]||(W[34]=e("h4",{class:"text-lg font-semibold text-gray-900"},"Latest Notes",-1)),e("div",zp,[e("button",{onClick:W[9]||(W[9]=z=>b.value="notes"),class:"text-sm text-indigo-600 hover:text-indigo-800 font-medium"}," View All Notes → "),de.value?(o(),r("div",qp,[p(ue,{class:"bg-indigo-600 hover:bg-indigo-700 transition-colors",onClick:W[10]||(W[10]=z=>d.value=!0)},{default:N(()=>W[33]||(W[33]=[B(" Add Note ",-1)])),_:1,__:[33]})])):E("",!0)])]),lt.value.length?(o(),r("div",Gp,[(o(!0),r(J,null,ee(lt.value,z=>{var Me;return o(),r("div",{key:z.id,class:"p-4 bg-gray-50 rounded-md shadow-sm hover:bg-gray-100 transition-colors"},[e("div",Kp,[e("div",Jp,[e("p",{class:Q(["text-sm",{"text-gray-700":z.content!=="[Encrypted content could not be decrypted]","text-red-500 italic":z.content==="[Encrypted content could not be decrypted]"}])},[B(h(z.content)+" ",1),z.content==="[Encrypted content could not be decrypted]"?(o(),r("span",Zp," (There was an issue decrypting this note. Please contact an administrator.) ")):E("",!0)],2),e("div",Xp,[e("p",Qp,"Added by "+h(((Me=z.user)==null?void 0:Me.name)||"Unknown")+" on "+h(new Date(z.created_at).toLocaleDateString()),1),z.reply_count>0?(o(),r("span",eh,h(z.reply_count)+" "+h(z.reply_count===1?"reply":"replies"),1)):E("",!0)])]),G.value&&z.chat_message_id&&n.value.google_chat_id?(o(),r("div",th,[e("button",{onClick:W[11]||(W[11]=ct=>b.value="notes"),class:"text-sm text-indigo-600 hover:text-indigo-800 font-medium"}," View ")])):E("",!0)])])}),128))])):(o(),r("p",sh,"No notes available."))])):E("",!0)])):E("",!0),b.value==="tasks"?(o(),X(xo,{key:2,ref_key:"tasksTabRef",ref:$t,"project-id":K(a),"project-users":n.value.users||[],"can-manage-projects":ie.value,"tasks-filter":Ke.value,onTasksUpdated:Vt,onOpenTaskDetailSidebar:rt,onOpenCreateTaskModal:Yt,onFilterChanged:W[12]||(W[12]=z=>Ke.value=z)},null,8,["project-id","project-users","can-manage-projects","tasks-filter"])):E("",!0),b.value==="emails"?(o(),X(md,{key:3,"project-id":K(a),"can-view-emails":A.value,"can-compose-emails":$.value,"can-approve-emails":O.value,"user-project-role":K(_),"open-compose":w.value,onEmailsUpdated:At,onResetOpenCompose:W[13]||(W[13]=z=>w.value=!1)},null,8,["project-id","can-view-emails","can-compose-emails","can-approve-emails","user-project-role","open-compose"])):E("",!0),b.value==="standups"?(o(),X(Ol,{key:4,projectId:K(a),users:n.value.users||[],onStandupAdded:ot},null,8,["projectId","users"])):E("",!0),b.value==="notes"?(o(),X(qd,{key:5,"project-id":K(a),"google-chat-id":n.value.google_chat_id,"can-view-notes":G.value,"can-add-notes":de.value,onNotesUpdated:nt,onChangeTab:Lt},null,8,["project-id","google-chat-id","can-view-notes","can-add-notes"])):E("",!0),b.value==="deliverables"?(o(),X(Uc,{key:6,"project-id":K(a),"can-create-deliverables":F.value,"can-view-deliverables":Se.value,onDeliverablesUpdated:It,onOpenDeliverableDetailSidebar:Ht},null,8,["project-id","can-create-deliverables","can-view-deliverables"])):E("",!0),b.value==="seo-reports"?(o(),X(Qv,{key:7,"project-id":K(a),"can-create-seo-reports":Y.value,onOpenCreateSeoReportModal:qt},null,8,["project-id","can-create-seo-reports"])):E("",!0)]))]),p($e,{show:c.value,onClose:W[15]||(W[15]=z=>c.value=!1)},{default:N(()=>[p(ps,{show:c.value,project:n.value,statusOptions:R,departmentOptions:U,sourceOptions:M,clientRoleOptions:[],userRoleOptions:[],paymentTypeOptions:[],onClose:W[14]||(W[14]=z=>c.value=!1),onSubmit:jt},null,8,["show","project"])]),_:1},8,["show"]),p(Jl,{show:u.value,onClose:W[16]||(W[16]=z=>u.value=!1),onSaved:Ot,projectId:K(a),projectUsers:n.value.users||[]},null,8,["show","projectId","projectUsers"]),p(bt,{show:m.value,onClose:W[17]||(W[17]=z=>m.value=!1),onStandupAdded:ot,projectId:K(a)},null,8,["show","projectId"]),p(_t,{show:d.value,"project-id":K(a),onClose:W[18]||(W[18]=z=>d.value=!1),onNoteAdded:nt},null,8,["show","project-id"]),p(ai,{show:v.value,"project-id":K(a),"project-clients":n.value.clients||[],onClose:W[19]||(W[19]=z=>v.value=!1)},null,8,["show","project-id","project-clients"]),p(Xu,{show:y.value,"project-id":K(a),"project-name":n.value.name,onClose:W[20]||(W[20]=z=>y.value=!1)},null,8,["show","project-id","project-name"]),p(Ct,{show:w.value,"project-id":K(a),"user-project-role":K(_),onClose:Rt,onSubmitted:Pt,onError:W[21]||(W[21]=z=>console.error("Error composing email:",z))},null,8,["show","project-id","user-project-role"]),p(Xt,{show:D.value,"onUpdate:show":W[22]||(W[22]=z=>D.value=z),title:T.value?"Task Details":g.value?"Deliverable Details":"Details",initialWidth:50},{content:N(()=>[T.value?(o(),X(Qt,{key:0,"task-id":T.value,"project-users":n.value.users||[],onClose:Ze,onTaskUpdated:Ft,onTaskDeleted:Bt},null,8,["task-id","project-users"])):g.value?(o(),X(ym,{key:1,"project-id":K(a),"deliverable-id":g.value,onClose:dt,onDeliverableUpdated:Wt},null,8,["project-id","deliverable-id"])):E("",!0)]),_:1},8,["show","title"]),p(es,{show:f.value,"project-id":K(a),onClose:W[23]||(W[23]=z=>f.value=!1),onSaved:zt},null,8,["show","project-id"]),p(Et,{show:C.value,"project-id":K(a),onClose:W[24]||(W[24]=z=>C.value=!1),onSaved:te.handleDeliverableSaved},null,8,["show","project-id","onSaved"]),p(ap,{"project-id":K(a),show:S.value,"initial-data":V.value,onClose:W[25]||(W[25]=z=>S.value=!1),onSaved:Gt},null,8,["project-id","show","initial-data"])]}),_:1})],64)}}},gh=Ee(ah,[["__scopeId","data-v-15ba32b5"]]);export{gh as default};
