import{r as x,s as Oe,m as E,w as H,h as l,o as r,g as v,t as h,b as i,e as p,f as X,v as ie,F,i as N,n as oe,k as J,I as Xe,a as ee,G as Fe,z as xe,u as m,c as Me,p as ge,D as Qe,M as Ze,N as et,O as Ie,j as ke,d as tt}from"./app-Cq3jf0JG.js";import{P as le}from"./PrimaryButton-DeU3tpPn.js";import{_ as D,a as T}from"./InputError-Dzy8YfWP.js";import{_ as G}from"./TextInput-Ctpb8Vgz.js";import{_ as st}from"./Checkbox-wniu4RRu.js";import{a as Te}from"./SecondaryButton-DnFcUaWD.js";import{s as Ee}from"./AuthenticatedLayout-BtBID5En.js";const at={key:0,class:"text-red-600 text-sm mb-4"},ot={key:1,class:"text-gray-500 text-sm mb-4"},nt={key:2},rt={class:"mb-4"},lt={class:"mb-4"},it=["disabled"],dt=["value"],ct={class:"mb-4"},ut={class:"mt-2"},mt={class:"flex items-center mb-2"},pt=["for"],vt={key:0,class:"pl-6"},yt={class:"grid grid-cols-2 gap-4 mb-2"},ft=["id","onUpdate:modelValue","disabled"],_t={class:"mb-2"},gt={key:0},bt={class:"flex justify-between items-center mb-1"},ht=["onClick"],wt={class:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-2"},kt={class:"flex"},xt=["onClick"],jt={key:0},Pt={class:"mt-4"},$t={key:1,class:"mt-2 flex items-center"},St={key:0,class:"mt-6 flex justify-end"},Vt={__name:"ServicesAndPaymentForm",props:{projectId:{type:[Number,String],required:!0},paymentTypeOptions:{type:Array,required:!0},canManageProjectServicesAndPayments:{type:Boolean,required:!0},canViewProjectServicesAndPayments:{type:Boolean,required:!0}},emits:["updated"],setup(w,{emit:ne}){const _=w,B=ne,g=x({}),j=x(!1),M=x([...[{value:"Website Designing",label:"Website Designing"},{value:"SEO",label:"SEO"},{value:"Social Media",label:"Social Media"},{value:"Content Writing",label:"Content Writing"},{value:"Graphic Design",label:"Graphic Design"}]]),y=x(""),I=x(!1),k=Oe({services:[],service_details:[],total_amount:"",payment_type:"one_off"}),V=E(()=>{const o=k.services.filter(s=>{const a=U(s);return a&&a.frequency!=="monthly"});return o.length===0?!0:o.every(s=>R(s)===100)}),C=E(()=>!_.projectId||!_.canManageProjectServicesAndPayments||!V.value),K=()=>{const o=y.value.trim();o&&!M.value.some(s=>s.label.toLowerCase()===o.toLowerCase())&&(M.value.push({value:o,label:o}),y.value="",I.value=!1)},te=async()=>{if(_.projectId){j.value=!0;try{const s=(await window.axios.get(`/api/projects/${_.projectId}/sections/services-payment`)).data;return k.services=s.services||[],k.service_details=s.service_details||[],k.total_amount=s.total_amount||"",k.payment_type=s.payment_type||"one_off",k.services.forEach(a=>{M.value.some(f=>f.value===a)||M.value.push({value:a,label:a})}),k.service_details.forEach(a=>{if(a.payment_breakdown&&!Array.isArray(a.payment_breakdown)){const f=a.payment_breakdown;a.payment_breakdown=[{label:"First",percentage:parseInt(f.first)||30},{label:"Second",percentage:parseInt(f.second)||30},{label:"Third",percentage:parseInt(f.third)||40}]}else(!a.payment_breakdown||a.payment_breakdown.length===0)&&(a.payment_breakdown=[{label:"Payment 1",percentage:100}])}),s}catch(o){return console.error("Error fetching services and payment data:",o),g.value.general="Failed to fetch services and payment data.",null}finally{j.value=!1}}},Q=async()=>{g.value={},j.value=!0;try{const o={services:k.services,service_details:k.service_details,total_amount:k.total_amount,payment_type:k.payment_type},s=await window.axios.put(`/api/projects/${_.projectId}/sections/services-payment`,o);alert("Services and payment information updated successfully!"),B("updated")}catch(o){o.response&&o.response.status===422?g.value=o.response.data.errors:o.response&&o.response.data.message?g.value.general=o.response.data.message:(g.value.general="Failed to update services and payment information.",console.error("Error:",o))}finally{j.value=!1}},W=(o,s)=>{s?k.service_details.some(a=>a.service_id===o)||k.service_details.push({service_id:o,amount:"",frequency:"one_off",start_date:"",payment_breakdown:[{label:"Payment 1",percentage:100}]}):k.service_details=k.service_details.filter(a=>a.service_id!==o)},U=o=>{let s=k.service_details.find(a=>a.service_id===o);if(!s)s={service_id:o,amount:"",frequency:"one_off",start_date:"",payment_breakdown:[{label:"Payment 1",percentage:100}]},k.service_details.push(s);else if(s.payment_breakdown&&!Array.isArray(s.payment_breakdown)){const a=s.payment_breakdown;s.payment_breakdown=[{label:"First",percentage:parseInt(a.first)||30},{label:"Second",percentage:parseInt(a.second)||30},{label:"Third",percentage:parseInt(a.third)||40}]}else(!s.payment_breakdown||s.payment_breakdown.length===0)&&(s.payment_breakdown=[{label:"Payment 1",percentage:100}]);return s},R=o=>{const s=U(o);return!s.payment_breakdown||!Array.isArray(s.payment_breakdown)?0:s.payment_breakdown.reduce((a,f)=>a+(parseInt(f.percentage)||0),0)},b=o=>{const s=U(o);if(s.payment_breakdown||(s.payment_breakdown=[]),!Array.isArray(s.payment_breakdown)){const P=s.payment_breakdown;s.payment_breakdown=[{label:"First",percentage:parseInt(P.first)||30},{label:"Second",percentage:parseInt(P.second)||30},{label:"Third",percentage:parseInt(P.third)||40}]}const a=s.payment_breakdown.length;let f=0;if(a>0){const P=s.payment_breakdown[a-1];f=Math.floor(P.percentage/2),P.percentage-=f}else f=100;s.payment_breakdown.push({label:`Payment ${a+1}`,percentage:f})},c=(o,s)=>{const a=U(o);if(!a.payment_breakdown||!Array.isArray(a.payment_breakdown)||a.payment_breakdown.length<=1)return;const f=parseInt(a.payment_breakdown[s].percentage)||0;if(a.payment_breakdown.splice(s,1),f>0&&a.payment_breakdown.length>0){const P=s>0&&s<=a.payment_breakdown.length?s-1:0;a.payment_breakdown[P].percentage=(parseInt(a.payment_breakdown[P].percentage)||0)+f}a.payment_breakdown.forEach((P,Z)=>{P.label=`Payment ${Z+1}`})};return H(()=>_.projectId,o=>{o&&te()},{immediate:!0}),(o,s)=>(r(),l("div",null,[g.value.general?(r(),l("div",at,h(g.value.general),1)):v("",!0),j.value?(r(),l("div",ot,"Loading...")):(r(),l("div",nt,[i("div",rt,[p(D,{for:"total_amount",value:"Total Amount"}),p(G,{id:"total_amount",type:"number",step:"0.01",class:"mt-1 block w-full",modelValue:k.total_amount,"onUpdate:modelValue":s[0]||(s[0]=a=>k.total_amount=a),disabled:!w.canManageProjectServicesAndPayments},null,8,["modelValue","disabled"]),p(T,{message:g.value.total_amount?g.value.total_amount[0]:"",class:"mt-2"},null,8,["message"])]),i("div",lt,[p(D,{for:"payment_type",value:"Payment Type"}),X(i("select",{id:"payment_type",class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full","onUpdate:modelValue":s[1]||(s[1]=a=>k.payment_type=a),required:"",disabled:!w.canManageProjectServicesAndPayments},[(r(!0),l(F,null,N(w.paymentTypeOptions,a=>(r(),l("option",{key:a.value,value:a.value},h(a.label),9,dt))),128))],8,it),[[ie,k.payment_type]]),p(T,{message:g.value.payment_type?g.value.payment_type[0]:"",class:"mt-2"},null,8,["message"])]),i("div",ct,[p(D,{for:"services",value:"Services"}),i("div",ut,[(r(!0),l(F,null,N(M.value,a=>(r(),l("div",{key:a.value,class:"border p-3 mb-3 rounded"},[i("div",mt,[p(st,{id:`service_${a.value}`,value:a.value,checked:k.services,"onUpdate:checked":[s[2]||(s[2]=f=>k.services=f),f=>W(a.value,f)],disabled:!w.canManageProjectServicesAndPayments},null,8,["id","value","checked","onUpdate:checked","disabled"]),i("label",{for:`service_${a.value}`,class:"ms-2 text-sm font-medium text-gray-700"},h(a.label),9,pt)]),(k.services||[]).includes(a.value)?(r(),l("div",vt,[i("div",yt,[i("div",null,[p(D,{for:`service_amount_${a.value}`,value:"Amount",class:"text-xs"},null,8,["for"]),p(G,{id:`service_amount_${a.value}`,type:"number",step:"0.01",placeholder:"Amount",class:"w-full",modelValue:U(a.value).amount,"onUpdate:modelValue":f=>U(a.value).amount=f,disabled:!w.canManageProjectServicesAndPayments},null,8,["id","modelValue","onUpdate:modelValue","disabled"])]),i("div",null,[p(D,{for:`service_frequency_${a.value}`,value:"Frequency",class:"text-xs"},null,8,["for"]),X(i("select",{id:`service_frequency_${a.value}`,class:"border-gray-300 rounded-md w-full","onUpdate:modelValue":f=>U(a.value).frequency=f,disabled:!w.canManageProjectServicesAndPayments},s[6]||(s[6]=[i("option",{value:"monthly"},"Monthly",-1),i("option",{value:"one_off"},"One off",-1)]),8,ft),[[ie,U(a.value).frequency]])])]),i("div",_t,[p(D,{for:`service_start_date_${a.value}`,value:"Start Date",class:"text-xs"},null,8,["for"]),p(G,{id:`service_start_date_${a.value}`,type:"date",class:"w-full",modelValue:U(a.value).start_date,"onUpdate:modelValue":f=>U(a.value).start_date=f,disabled:!w.canManageProjectServicesAndPayments},null,8,["id","modelValue","onUpdate:modelValue","disabled"])]),U(a.value).frequency!=="monthly"?(r(),l("div",gt,[i("div",bt,[p(D,{value:"Payment Breakdown (%)",class:"text-xs"}),w.canManageProjectServicesAndPayments?(r(),l("button",{key:0,type:"button",class:"text-xs text-blue-600 hover:text-blue-800",onClick:f=>b(a.value)}," + Add Payment ",8,ht)):v("",!0)]),i("div",wt,[(r(!0),l(F,null,N(U(a.value).payment_breakdown,(f,P)=>(r(),l("div",{key:P,class:"relative"},[p(D,{for:`service_payment_${P}_${a.value}`,value:f.label,class:"text-xs"},null,8,["for","value"]),i("div",kt,[p(G,{id:`service_payment_${P}_${a.value}`,type:"text",inputmode:"numeric",pattern:"[0-9]*",min:"0",max:"100",class:"w-full",modelValue:f.percentage,"onUpdate:modelValue":Z=>f.percentage=Z,modelModifiers:{number:!0},onInput:Z=>{f.percentage=Math.max(0,Math.min(100,parseInt(Z.target.value)||0))},disabled:!w.canManageProjectServicesAndPayments},null,8,["id","modelValue","onUpdate:modelValue","onInput","disabled"]),w.canManageProjectServicesAndPayments&&U(a.value).payment_breakdown.length>1?(r(),l("button",{key:0,type:"button",class:"ml-1 text-red-500 hover:text-red-700",onClick:Z=>c(a.value,P)},s[7]||(s[7]=[i("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor"},[i("path",{"fill-rule":"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z","clip-rule":"evenodd"})],-1)]),8,xt)):v("",!0)])]))),128))]),i("div",{class:oe(["text-xs mt-2",{"text-gray-500":R(a.value)===100,"text-red-500 font-bold":R(a.value)!==100}])},[J(" Total: "+h(R(a.value))+"% ",1),R(a.value)!==100?(r(),l("span",jt," (Total must be 100%) ")):v("",!0)],2)])):v("",!0)])):v("",!0)]))),128))]),i("div",Pt,[w.canManageProjectServicesAndPayments&&!I.value?(r(),l("button",{key:0,type:"button",class:"text-sm text-blue-600 hover:text-blue-800",onClick:s[3]||(s[3]=a=>I.value=!0)}," + Add New Service/Department ")):v("",!0),w.canManageProjectServicesAndPayments&&I.value?(r(),l("div",$t,[p(G,{type:"text",class:"flex-grow mr-2",modelValue:y.value,"onUpdate:modelValue":s[4]||(s[4]=a=>y.value=a),placeholder:"New service/department name",onKeyup:Xe(K,["enter"])},null,8,["modelValue"]),p(le,{onClick:K},{default:ee(()=>s[8]||(s[8]=[J("Add")])),_:1,__:[8]}),i("button",{type:"button",class:"ml-2 text-sm text-gray-500 hover:text-gray-700",onClick:s[5]||(s[5]=a=>{I.value=!1,y.value=""})}," Cancel ")])):v("",!0)]),p(T,{message:g.value.services?g.value.services[0]:"",class:"mt-2"},null,8,["message"])]),w.canManageProjectServicesAndPayments?(r(),l("div",St,[p(le,{onClick:Q,disabled:C.value,class:oe({"opacity-25":C.value})},{default:ee(()=>s[9]||(s[9]=[J(" Update Services & Payment ")])),_:1,__:[9]},8,["disabled","class"])])):v("",!0)]))]))}},Ct={class:"mb-4"},Ut={class:"flex justify-between items-center mb-4"},At={class:"text-right"},Dt={class:"text-lg font-medium"},It={class:"text-lg font-medium"},Rt={class:"text-xl font-bold mt-1 mb-2"},Ot={key:0,class:"text-red-600 text-sm mb-4"},Ft={key:1,class:"mt-4"},Mt=["onUpdate:modelValue"],Tt={key:0,value:"income"},Et={key:1,value:"expense"},Nt={class:"flex items-center mr-2"},Bt=["onUpdate:modelValue"],qt=["onUpdate:modelValue"],Lt=["value"],zt=["onClick"],Wt={class:"flex mt-2"},Jt={key:0,class:"mt-6 flex justify-end"},Gt={__name:"ProjectTransactions",props:{projectId:{type:[Number,String],required:!0},userProjectRole:{type:Object,default:null}},setup(w,{expose:ne}){const _=w,{canView:B,canManage:g}=Fe(E(()=>_.projectId)),j=g("project_expenses",E(()=>_.userProjectRole)),z=g("project_income",E(()=>_.userProjectRole)),M=B("project_transactions",E(()=>_.userProjectRole)),y=x([]),I=x([]),k=x([]),V=x({}),C=x(!1),K=async()=>{if(_.projectId){C.value=!0;try{const c=(await window.axios.get(`/api/projects/${_.projectId}/sections/transactions`)).data;return y.value=c.map(o=>({description:o.description,amount:o.amount,currency:o.currency||"USD",user_id:o.user_id,hours_spent:o.hours_spent,type:o.type||"expense"})),c}catch(b){return console.error("Error fetching transactions data:",b),V.value.general="Failed to fetch transactions data.",null}finally{C.value=!1}}},te=async()=>{if(_.projectId){C.value=!0;try{const c=(await window.axios.get(`/api/projects/${_.projectId}/sections/clients-users`)).data;return c.users&&c.users.length>0&&(I.value=c.users),c.clients&&c.clients.length>0&&(k.value=c.clients),c}catch(b){return console.error("Error fetching users and clients data:",b),V.value.general="Failed to fetch users and clients data.",null}finally{C.value=!1}}},Q=async()=>{if(_.projectId){V.value={};try{const b={transactions:y.value};j.value||(b.transactions=b.transactions.filter(o=>o.type!=="expense")),z.value||(b.transactions=b.transactions.filter(o=>o.type!=="income"));const c=await window.axios.put(`/api/projects/${_.projectId}/sections/transactions`,b);Ee("Transactions updated successfully!")}catch(b){W(b,"Failed to update transactions.")}}},W=(b,c)=>{b.response&&b.response.status===422?V.value=b.response.data.errors:b.response&&b.response.data.message?V.value.general=b.response.data.message:(V.value.general=c,console.error("Error:",b))},U=()=>{y.value.push({description:"",amount:"",currency:"USD",user_id:null,hours_spent:"",type:"expense"})},R=b=>{y.value.splice(b,1)};return H(()=>_.projectId,(b,c)=>{b&&b!==c&&(K(),te())},{immediate:!0}),xe(()=>{_.projectId&&(K(),te())}),ne({fetchTransactionsData:K,updateTransactions:Q}),(b,c)=>(r(),l("div",null,[i("div",Ct,[i("div",Ut,[c[0]||(c[0]=i("h3",{class:"text-lg font-medium"},"Transactions",-1)),i("div",At,[(r(!0),l(F,null,N([...new Set(y.value.map(o=>o.currency||"USD"))],o=>(r(),l(F,{key:o},[i("div",Dt," Total Income ("+h(o)+"): "+h(o)+" "+h(y.value.filter(s=>s.type==="income"&&(s.currency||"USD")===o).reduce((s,a)=>s+(parseFloat(a.amount)||0),0).toFixed(2)),1),i("div",It," Total Expenses ("+h(o)+"): "+h(o)+" "+h(y.value.filter(s=>s.type==="expense"&&(s.currency||"USD")===o).reduce((s,a)=>s+(parseFloat(a.amount)||0),0).toFixed(2)),1),i("div",Rt," Net ("+h(o)+"): "+h(o)+" "+h((y.value.filter(s=>s.type==="income"&&(s.currency||"USD")===o).reduce((s,a)=>s+(parseFloat(a.amount)||0),0)-y.value.filter(s=>s.type==="expense"&&(s.currency||"USD")===o).reduce((s,a)=>s+(parseFloat(a.amount)||0),0)).toFixed(2)),1)],64))),128))])]),V.value.general?(r(),l("div",Ot,h(V.value.general),1)):v("",!0),m(M)?(r(),l("div",Ft,[(r(!0),l(F,null,N(y.value,(o,s)=>(r(),l("div",{key:s,class:"flex items-center mb-2 p-2 border rounded"},[X(i("select",{"onUpdate:modelValue":a=>o.type=a,class:"mr-2 border-gray-300 rounded-md"},[m(z)?(r(),l("option",Tt,"Income")):v("",!0),m(j)?(r(),l("option",Et,"Expense")):v("",!0)],8,Mt),[[ie,o.type]]),p(G,{modelValue:o.description,"onUpdate:modelValue":a=>o.description=a,placeholder:"Description",class:"mr-2 flex-grow"},null,8,["modelValue","onUpdate:modelValue"]),i("div",Nt,[p(G,{modelValue:o.amount,"onUpdate:modelValue":a=>o.amount=a,modelModifiers:{number:!0},type:"number",step:"0.01",placeholder:"Amount",class:"w-24"},null,8,["modelValue","onUpdate:modelValue"]),X(i("select",{"onUpdate:modelValue":a=>o.currency=a,class:"ml-1 border-gray-300 rounded-md"},c[1]||(c[1]=[i("option",{value:"INR"},"INR",-1),i("option",{value:"PKR"},"PKR",-1),i("option",{value:"AUD"},"AUD",-1),i("option",{value:"USD"},"USD",-1)]),8,Bt),[[ie,o.currency]])]),o.type==="expense"?X((r(),l("select",{key:0,"onUpdate:modelValue":a=>o.user_id=a,class:"mr-2 border-gray-300 rounded-md"},[c[2]||(c[2]=i("option",{value:"",disabled:""},"Select User (Optional)",-1)),(r(!0),l(F,null,N(I.value,a=>(r(),l("option",{key:a.id,value:a.id},h(a.name),9,Lt))),128))],8,qt)),[[ie,o.user_id]]):v("",!0),o.type==="expense"?(r(),Me(G,{key:1,modelValue:o.hours_spent,"onUpdate:modelValue":a=>o.hours_spent=a,modelModifiers:{number:!0},type:"number",step:"0.01",placeholder:"Hours",class:"mr-2 w-20"},null,8,["modelValue","onUpdate:modelValue"])):v("",!0),i("button",{type:"button",class:"text-red-600",onClick:a=>R(s)}," Remove ",8,zt)]))),128)),i("div",Wt,[p(Te,{onClick:U},{default:ee(()=>c[3]||(c[3]=[J(" Add Transaction ")])),_:1,__:[3]})])])):v("",!0),p(T,{message:V.value.transactions?V.value.transactions[0]:"",class:"mt-2"},null,8,["message"])]),m(j)||m(z)?(r(),l("div",Jt,[p(le,{onClick:Q,disabled:!_.projectId||!m(j)&&!m(z)},{default:ee(()=>c[4]||(c[4]=[J(" Update Transactions ")])),_:1,__:[4]},8,["disabled"])])):v("",!0)]))}},Kt={class:"mt-2"},Yt={class:"mb-2"},Ht={key:0,class:"text-gray-500 text-sm mb-2"},Xt=["disabled"],Qt={value:""},Zt=["value"],es={class:"flex-grow"},ts=["value","onChange","disabled"],ss=["value"],as=["onClick"],Re={__name:"MultiSelectWithRoles",props:{label:{type:String,required:!0},items:{type:Array,default:()=>[]},endpoint:{type:String,default:""},selectedItems:{type:Array,default:()=>[]},itemText:{type:String,default:"name"},itemSubtext:{type:String,default:"email"},itemValue:{type:String,default:"id"},roleOptions:{type:Array,default:()=>[]},roleType:{type:String,default:"application"},defaultRoleId:{type:Number,default:null},error:{type:String,default:""},placeholder:{type:String,default:"Select an item"},showRemoveButton:{type:Boolean,default:!0}},emits:["update:selectedItems"],setup(w,{emit:ne}){const _=w,B=ne,g=x([]),j=x([]),z=x([]),M=x([]),y=x(!1),I=async()=>{if(!(_.roleOptions.length>0))try{const o=(await ge.get(`/api/roles?type=${_.roleType}`)).data;z.value=o.map(s=>({value:s.id,label:s.name}))}catch(c){console.error("Error fetching roles:",c)}},k=E(()=>z.value.length>0?z.value:_.roleOptions),V=()=>_.defaultRoleId?_.defaultRoleId:k.value.length>0?k.value[0].value:1,C=()=>{if(console.log("initializeFromProps called with selectedItems:",_.selectedItems),!_.selectedItems||_.selectedItems.length===0){g.value=[],j.value=[],console.log("Cleared selectedIds and selectedItemsWithRoles because props.selectedItems is empty");return}const c=new Set;_.selectedItems.forEach(o=>{const s=typeof o=="object"?o.id:o;if(!c.has(s)){if(c.add(s),!g.value.includes(s))g.value.push(s),typeof o=="object"&&o.role_id?j.value.push({id:s,role_id:o.role_id}):j.value.push({id:s,role_id:V()});else if(typeof o=="object"&&o.role_id){const a=j.value.find(f=>f.id===s);a&&(a.role_id=o.role_id)}}}),console.log("After initialization, selectedIds:",g.value),console.log("After initialization, selectedItemsWithRoles:",j.value)};H(()=>_.selectedItems,(c,o)=>{console.log("selectedItems changed:",c),JSON.stringify(c)!==JSON.stringify(o)?(console.log("selectedItems changed significantly, reinitializing"),C()):console.log("selectedItems change was not significant, skipping reinitialization")},{deep:!0,immediate:!0}),H(j,c=>{B("update:selectedItems",c)},{deep:!0});const K=c=>{c&&!g.value.includes(c)&&(g.value.push(c),j.value.push({id:c,role_id:V()}))},te=c=>{g.value=g.value.filter(o=>o!==c),j.value=j.value.filter(o=>o.id!==c)},Q=(c,o)=>{const s=j.value.find(a=>a.id===c);s&&(s.role_id=parseInt(o))},W=c=>b.value.find(o=>o[_.itemValue]===c),U=c=>{const o=j.value.find(s=>s.id===c);return o?o.role_id:V()},R=async()=>{if(_.endpoint){y.value=!0;try{const c=await ge.get(_.endpoint);c.data&&Array.isArray(c.data)?M.value=c.data:c.data&&c.data.data&&Array.isArray(c.data.data)&&(M.value=c.data.data)}catch(c){console.error("Error fetching items from endpoint:",c)}finally{y.value=!1}}},b=E(()=>_.endpoint&&M.value.length>0?M.value:_.items);return xe(()=>{I(),C(),_.endpoint&&R()}),(c,o)=>(r(),l("div",null,[p(D,{value:w.label},null,8,["value"]),i("div",Kt,[i("div",Yt,[y.value?(r(),l("div",Ht,"Loading...")):v("",!0),w.showRemoveButton?(r(),l("select",{key:1,class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full",onChange:o[0]||(o[0]=s=>{const a=parseInt(s.target.value);K(a),s.target.value=""}),disabled:y.value},[i("option",Qt,h(w.placeholder),1),(r(!0),l(F,null,N(b.value.filter(s=>!g.value.includes(s[w.itemValue])),s=>(r(),l("option",{key:s[w.itemValue],value:s[w.itemValue]},h(s[w.itemText])+" ("+h(s[w.itemSubtext])+") ",9,Zt))),128))],40,Xt)):v("",!0)]),(r(!0),l(F,null,N(g.value,s=>{var a,f;return r(),l("div",{key:s,class:"flex items-center mb-1 p-2 border rounded"},[i("div",es,h((a=W(s))==null?void 0:a[w.itemText])+" ("+h((f=W(s))==null?void 0:f[w.itemSubtext])+") ",1),i("select",{class:"ms-2 border-gray-300 rounded-md",value:U(s),onChange:P=>Q(s,P.target.value),disabled:!w.showRemoveButton},[(r(!0),l(F,null,N(k.value,P=>(r(),l("option",{key:P.value,value:P.value},h(P.label),9,ss))),128))],40,ts),w.showRemoveButton?(r(),l("button",{key:0,type:"button",class:"ml-2 text-red-600",onClick:()=>te(s)}," Remove ",8,as)):v("",!0)])}),128))]),p(T,{message:w.error,class:"mt-2"},null,8,["message"])]))}},os={class:"p-6 w-full max-w-6xl mx-auto bg-white rounded-lg shadow-xl"},ns={class:"flex justify-between items-center mb-4"},rs={class:"text-lg font-medium text-gray-900"},ls={key:0,class:"text-red-600 text-sm mb-4"},is={key:1,class:"mb-4"},ds={key:0,class:"text-xs text-gray-500 mt-2 p-2 bg-gray-100 rounded"},cs={class:"font-bold"},us={class:"mt-1"},ms={key:0},ps={key:1},vs={key:2},ys={key:0},fs={class:"list-disc ml-4"},_s={key:0},gs={class:"mt-1"},bs={class:"border-b border-gray-200 mb-6"},hs={class:"flex -mb-px"},ws={key:0},ks={class:"mb-4"},xs={class:"mb-4"},js=["disabled"],Ps={class:"mb-4"},$s={class:"mb-4"},Ss={class:"mb-4"},Vs=["disabled"],Cs=["value"],Us={class:"mb-4"},As=["disabled"],Ds=["value"],Is={key:0,class:"mt-6 flex justify-end"},Rs={key:1},Os={key:0,class:"mb-4"},Fs={key:0,class:"mt-2 flex justify-end"},Ms={key:1,class:"mt-2 text-green-600 text-sm"},Ts={key:2,class:"mt-2 text-red-600 text-sm"},Es={class:"mb-4"},Ns=["disabled"],Bs={key:1,class:"mb-4"},qs={key:0,class:"mt-2 flex justify-end"},Ls={key:1,class:"mt-2 text-green-600 text-sm"},zs={key:2,class:"mt-2 text-red-600 text-sm"},Ws={key:2},Js={key:3},Gs={key:4},Ks={class:"mb-4"},Ys={class:"mt-2"},Hs={key:0,class:"mb-4"},Xs={class:"mt-4"},Qs={key:0,class:"text-sm text-red-500 mt-2"},Zs={key:1,class:"mt-4"},ea={class:"flex-grow"},ta=["href"],sa=["onClick"],aa={key:5},oa={class:"mb-4"},na={class:"mt-2"},ra={key:0},la={class:"flex items-start mb-2"},ia=["onUpdate:modelValue","readonly"],da={key:1,class:"p-4 bg-gray-50 rounded-md text-gray-600 text-center"},ca={class:"mt-6 flex justify-end"},ga={__name:"ProjectForm",props:{show:{type:Boolean,required:!0},project:{type:Object,default:()=>({})},statusOptions:{type:Array,required:!0},departmentOptions:{type:Array,required:!0},sourceOptions:{type:Array,required:!0},clientRoleOptions:{type:Array,default:()=>[]},userRoleOptions:{type:Array,default:()=>[]},paymentTypeOptions:{type:Array,required:!0}},emits:["close","submit"],setup(w,{emit:ne}){Qe();const _=x({}),B=w;H(()=>B.project,t=>{_.value=t||{}},{immediate:!0});const g=E(()=>{var t;return((t=_.value)==null?void 0:t.id)||null}),{permissions:j,loading:z,error:M}=Ze(g),y=et(_);E(()=>!!y.value),E(()=>{if(!y.value)return!1;const t=y.value.name,n=y.value.slug;return t==="Manager"||t==="Project Manager"||n==="manager"||n==="project-manager"});const{canDo:I,canView:k,canManage:V}=Fe(g),C=I("manage_projects",y),K=I("create_projects",y),te=I("create_clients",y),Q=I("upload_project_documents",y);V("project_expenses",y),V("project_income",y);const W=V("project_services_and_payments",y),U=I("add_project_notes",y),R=V("project_users",y),b=V("project_clients",y),c=V("project_basic_details",y),o=k("project_documents",y),s=k("project_services_and_payments",y),a=k("project_notes",y),f=k("project_users",y),P=k("project_clients",y),Z=k("project_transactions",y),O=x("basic"),Ne=E(()=>P.value&&f.value?"Clients and Users":P.value?"Clients":f.value?"Users":"Clients and Users"),re=t=>{if(!(t==="documents"&&!e.id)&&(O.value=t,e.id))switch(q.value=!0,t){case"basic":$e(e.id).finally(()=>{q.value=!1});break;case"client":P.value||b.value||f.value||R.value?Se(e.id).finally(()=>{q.value=!1}):q.value=!1;break;case"services":s.value||W.value?be(e.id).finally(()=>{q.value=!1}):q.value=!1;break;case"transactions":q.value=!1;break;case"documents":o.value?Ve(e.id).finally(()=>{q.value=!1}):q.value=!1;break;case"notes":a.value||U.value?Ce(e.id).finally(()=>{q.value=!1}):q.value=!1;break;default:q.value=!1;break}},de=x([]),ce=x([]),ue=x([]),me=x([]),Be=async()=>{try{const n=(await ge.get("/api/roles?type=client")).data;de.value=n.map(S=>({value:S.id,label:S.name}));const d=(await ge.get("/api/roles?type=project")).data;ce.value=d.map(S=>({value:S.id,label:S.name}))}catch(t){console.error("Error fetching roles:",t)}},je=async()=>{try{if(te.value){const t=await window.axios.get("/api/clients");ue.value=t.data.data||t.data}else if(g.value){const t=await window.axios.get(`/api/projects/${g.value}/clients`);ue.value=t.data}else{const t=await window.axios.get("/api/clients");ue.value=t.data.data||t.data}}catch(t){console.error("Error fetching clients:",t),A.value="Failed to load clients."}},Pe=async()=>{try{if(K.value){const t=await window.axios.get("/api/users");me.value=t.data}else if(g.value){const t=await window.axios.get(`/api/projects/${g.value}/users`);me.value=t.data}else{const t=await window.axios.get("/api/users");me.value=t.data}}catch(t){console.error("Error fetching users:",t),A.value="Failed to load users."}},qe=E(()=>de.value.length>0?de.value:B.clientRoleOptions),Le=E(()=>ce.value.length>0?ce.value:B.userRoleOptions),$e=async t=>{try{const u=(await window.axios.get(`/api/projects/${t}/sections/basic`)).data;return e.name=u.name||"",e.description=u.description||"",e.website=u.website||"",e.social_media_link=u.social_media_link||"",e.preferred_keywords=u.preferred_keywords||"",e.google_chat_id=u.google_chat_id||"",e.status=u.status||"active",e.project_type=u.project_type||"",e.source=u.source||"",e.google_drive_link=u.google_drive_link||"",u}catch(n){return console.error("Error fetching basic project data:",n),A.value="Failed to fetch basic project data.",null}},Se=async t=>{try{const u=(await window.axios.get(`/api/projects/${t}/sections/clients-users`)).data;return u.clients&&u.clients.length>0&&(e.client_ids=u.clients.map(d=>{var L;let S=((L=d.pivot)==null?void 0:L.role_id)||(de.value.length>0?de.value[0].value:1);return{id:d.id,role_id:S}})),u.users&&u.users.length>0&&(e.user_ids=u.users.map(d=>{var L;let S=((L=d.pivot)==null?void 0:L.role_id)||(ce.value.length>0?ce.value[0].value:2);return{id:d.id,role_id:S}})),u.contract_details!==void 0&&(e.contract_details=u.contract_details||""),u}catch(n){return console.error("Error fetching clients and users data:",n),A.value="Failed to fetch clients and users data.",null}},be=async t=>{try{const u=(await window.axios.get(`/api/projects/${t}/sections/services-payment`)).data;return e.services=u.services||[],e.service_details=u.service_details||[],e.total_amount=u.total_amount||"",e.payment_type=u.payment_type||"one_off",u}catch(n){return console.error("Error fetching services and payment data:",n),A.value="Failed to fetch services and payment data.",null}},Ve=async t=>{try{const u=(await window.axios.get(`/api/projects/${t}/sections/documents`)).data;return e.documents=u.documents||[],u}catch(n){return console.error("Error fetching documents data:",n),A.value="Failed to fetch documents data.",null}},Ce=async t=>{try{const u=(await window.axios.get(`/api/projects/${t}/sections/notes`)).data;return e.notes=u.map(d=>({content:d.content})),u}catch(n){return console.error("Error fetching notes data:",n),A.value="Failed to fetch notes data.",null}},ze=async t=>{try{switch(await $e(t),O.value){case"client":(P.value||b.value||f.value||R.value)&&await Se(t);break;case"services":(s.value||W.value)&&await be(t);break;case"transactions":break;case"documents":o.value&&await Ve(t);break;case"notes":(a.value||U.value)&&await Ce(t);break}}catch(n){console.error("Error fetching project data:",n),A.value="Failed to fetch project data."}};xe(()=>{Be(),je(),Pe(),g.value&&Ie(g.value).then(t=>{}).catch(t=>{})}),H(g,(t,n)=>{t&&t!==n&&(Ie(t).then(u=>{}).catch(u=>{}),Pe(),je())});const he=ne,$=x({}),A=x(""),q=x(!1),We=x(!1),pe=x(!1),ve=x(!1),se=x(""),ye=x(!1),fe=x(!1),ae=x(""),e=Oe({id:null,name:"",description:"",website:"",social_media_link:"",preferred_keywords:"",google_chat_id:"",logo:null,documents:[],client_ids:[],status:"active",project_type:"",services:[],service_details:[],source:"",total_amount:"",contract_details:"",google_drive_link:"",payment_type:"one_off",user_ids:[],transactions:[],notes:[]});H(()=>B.show,t=>{t&&(e.client_ids||(e.client_ids=[]),e.user_ids||(e.user_ids=[]),e.id&&ze(e.id))},{immediate:!0}),H(()=>B.project,t=>{const n=e.id;e.id=t.id||null,n&&!e.id&&O.value==="documents"&&re("basic"),e.name=t.name||"",e.description=t.description||"",e.website=t.website||"",e.social_media_link=t.social_media_link||"",e.preferred_keywords=t.preferred_keywords||"",e.google_chat_id=t.google_chat_id||"",e.logo=t.logo||null,e.documents=t.documents||[],e.client_ids=[],e.status=t.status||"active",e.project_type=t.project_type||"",e.services=t.services||[],e.service_details=t.service_details||[],e.source=t.source||"",e.total_amount=t.total_amount||"",e.contract_details=t.contract_details||"",e.google_drive_link=t.google_drive_link||"",e.payment_type=t.payment_type||"one_off",e.user_ids=[],e.transactions=t.transactions?t.transactions.map(u=>({description:u.description,amount:u.amount,currency:u.currency||"USD",user_id:u.user_id,hours_spent:u.hours_spent,type:u.type||"expense"})):[],e.notes=t.notes?t.notes.map(u=>({content:u.content})):[],$.value={},A.value=""},{immediate:!0});const Je=async()=>{$.value={},A.value="";try{const t={name:e.name,description:e.description,website:e.website,social_media_link:e.social_media_link,preferred_keywords:e.preferred_keywords,google_chat_id:e.google_chat_id,status:e.status,project_type:e.project_type,source:e.source,google_drive_link:e.google_drive_link,user_ids:e.user_ids},n=e.logo;typeof n=="object"&&n!==null&&"name"in n&&delete t.logo;const u=await window.axios.post("/api/projects",t);e.id=u.data.id,typeof n=="object"&&n!==null&&"name"in n&&await De(n,e.id),he("submit",u.data)}catch(t){Ue(t,"Failed to create project.")}},Ge=async()=>{$.value={},A.value="";try{const t={name:e.name,description:e.description,website:e.website,social_media_link:e.social_media_link,preferred_keywords:e.preferred_keywords,google_chat_id:e.google_chat_id,status:e.status,project_type:e.project_type,source:e.source,google_drive_link:e.google_drive_link},n=e.logo;typeof n=="object"&&n!==null&&"name"in n&&delete t.logo;const u=await window.axios.put(`/api/projects/${e.id}/sections/basic`,t);typeof n=="object"&&n!==null&&"name"in n&&await De(n,e.id),Ee("Basic information updated successfully!")}catch(t){Ue(t,"Failed to update basic information.")}},Ue=(t,n)=>{t.response&&t.response.status===422?$.value=t.response.data.errors:t.response&&t.response.data.message?A.value=t.response.data.message:(A.value=n,console.error("Error:",t))},_e=x(!1),we=x({});H(e,()=>{Object.keys(we.value).length>0&&(_e.value=!0)},{deep:!0}),H(()=>B.show,t=>{t&&setTimeout(()=>{we.value=JSON.parse(JSON.stringify(e)),_e.value=!1},100)});const Ae=()=>{_e.value?confirm("You have unsaved changes. Are you sure you want to close this form?")&&he("close"):he("close")},De=async(t,n)=>{try{const u=new FormData;u.append("logo",t);const d=await window.axios.post(`/api/projects/${n}/logo`,u,{headers:{"Content-Type":"multipart/form-data"}});return d.data&&d.data.logo&&(e.logo=d.data.logo),d}catch(u){console.error("Error uploading logo:",u)}},Ke=async()=>{if(!e.id){se.value="Please save the project first before saving clients.";return}if(!e.client_ids||e.client_ids.length===0){se.value="Please select at least one client to save.";return}pe.value=!0,ve.value=!1,se.value="";try{const t=await window.axios.post(`/api/projects/${e.id}/attach-clients`,{client_ids:e.client_ids});ve.value=!0,setTimeout(()=>{ve.value=!1},3e3)}catch(t){t.response&&t.response.status===422?se.value="Validation error. Please check your input.":t.response&&t.response.data.message?se.value=t.response.data.message:(se.value="Failed to save clients.",console.error("Error saving clients:",t))}finally{pe.value=!1}},Ye=async()=>{if(console.log("saveUsers called, projectForm.user_ids:",e.user_ids),!e.id){ae.value="Please save the project first before saving users.";return}if(!e.user_ids||e.user_ids.length===0){console.log("No users selected, projectForm.user_ids is empty or null"),ae.value="Please select at least one user to save.";return}ye.value=!0,fe.value=!1,ae.value="";try{console.log("Sending user_ids to API:",JSON.stringify(e.user_ids));const t=await window.axios.post(`/api/projects/${e.id}/attach-users`,{user_ids:e.user_ids});fe.value=!0,setTimeout(()=>{fe.value=!1},3e3)}catch(t){t.response&&t.response.status===422?ae.value="Validation error. Please check your input.":t.response&&t.response.data.message?ae.value=t.response.data.message:(ae.value="Failed to save users.",console.error("Error saving users:",t))}finally{ye.value=!1}},He=async()=>{if(!e.id){A.value="Please save the project first before uploading documents.";return}if(!e.documents||!e.documents.some(t=>typeof t=="object"&&t!==null&&"name"in t&&"size"in t&&"type"in t)){A.value="Please select documents to upload.";return}try{const t=new FormData;e.documents.filter(S=>typeof S=="object"&&S!==null&&"name"in S&&"size"in S&&"type"in S).forEach((S,L)=>{t.append(`documents[${L}]`,S)});const u=await window.axios.post(`/api/projects/${e.id}/documents`,t,{headers:{"Content-Type":"multipart/form-data"}});e.documents=u.data.documents||[],document.getElementById("documents").value="",alert("Documents uploaded successfully!");const d=JSON.parse(JSON.stringify(e));we.value=d,_e.value=!1}catch(t){t.response&&t.response.status===422?$.value=t.response.data.errors:t.response&&t.response.data.message?A.value=t.response.data.message:(A.value="Failed to upload documents.",console.error("Error uploading documents:",t))}};return(t,n)=>{var u;return r(),l("div",os,[i("div",ns,[i("h2",rs,h(e.id?"Edit Project":"Create New Project"),1),i("button",{onClick:Ae,class:"text-gray-400 hover:text-gray-500"},n[19]||(n[19]=[i("svg",{class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[i("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),A.value?(r(),l("div",ls,h(A.value),1)):v("",!0),g.value?(r(),l("div",is,[We.value?(r(),l("div",ds,[i("div",cs,"Project ID: "+h(g.value),1),i("div",null,h(m(y)?"Project Role: "+(((u=m(y).value)==null?void 0:u.name)||"None"):"No Project Role"),1),i("div",us,[n[21]||(n[21]=i("div",{class:"font-semibold"},"Project Permissions:",-1)),m(z)?(r(),l("div",ms,"Loading project permissions...")):m(M)?(r(),l("div",ps,"Error loading project permissions")):m(j)?(r(),l("div",vs,[J(" Count: "+h(m(j).permissions?m(j).permissions.length:0)+" ",1),m(j).permissions&&m(j).permissions.length>0?(r(),l("div",ys,[n[20]||(n[20]=i("div",{class:"font-semibold"},"Permissions:",-1)),i("ul",fs,[(r(!0),l(F,null,N(m(j).permissions.slice(0,5),d=>(r(),l("li",{key:d.slug},h(d.name)+" ("+h(d.source)+") ",1))),128)),m(j).permissions.length>5?(r(),l("li",_s," ... and "+h(m(j).permissions.length-5)+" more ",1)):v("",!0)])])):v("",!0)])):v("",!0)]),i("div",gs,"Can manage projects: "+h(m(C)?"Yes":"No"),1)])):v("",!0)])):v("",!0),i("div",bs,[i("nav",hs,[m(C)?(r(),l("button",{key:0,onClick:n[0]||(n[0]=d=>re("basic")),class:oe(["py-2 px-4 text-center border-b-2 font-medium text-sm",O.value==="basic"?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"])}," Basic Information ",2)):v("",!0),m(P)||m(f)?(r(),l("button",{key:1,onClick:n[1]||(n[1]=d=>re("client")),class:oe(["py-2 px-4 text-center border-b-2 font-medium text-sm",O.value==="client"?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"])},h(Ne.value),3)):v("",!0),e.id&&(m(W)||m(s))?(r(),l("button",{key:2,onClick:n[2]||(n[2]=d=>re("services")),class:oe(["py-2 px-4 text-center border-b-2 font-medium text-sm",O.value==="services"?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"])}," Services & Payment ",2)):v("",!0),e.id&&m(Z)?(r(),l("button",{key:3,onClick:n[3]||(n[3]=d=>re("transactions")),class:oe(["py-2 px-4 text-center border-b-2 font-medium text-sm",O.value==="transactions"?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"])}," Transactions ",2)):v("",!0),e.id&&m(o)?(r(),l("button",{key:4,onClick:n[4]||(n[4]=d=>re("documents")),class:oe(["py-2 px-4 text-center border-b-2 font-medium text-sm",O.value==="documents"?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"])}," Documents ",2)):v("",!0),e.id&&(m(U)||m(a))?(r(),l("button",{key:5,onClick:n[5]||(n[5]=d=>re("notes")),class:oe(["py-2 px-4 text-center border-b-2 font-medium text-sm",O.value==="notes"?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"])}," Notes ",2)):v("",!0)])]),i("form",{onSubmit:n[18]||(n[18]=tt(()=>{},["prevent"]))},[O.value==="basic"?(r(),l("div",ws,[i("div",ks,[p(D,{for:"name",value:"Project Name"}),p(G,{id:"name",type:"text",class:"mt-1 block w-full",modelValue:e.name,"onUpdate:modelValue":n[6]||(n[6]=d=>e.name=d),required:"",autofocus:"",disabled:!m(C)},null,8,["modelValue","disabled"]),p(T,{message:$.value.name?$.value.name[0]:"",class:"mt-2"},null,8,["message"])]),i("div",xs,[p(D,{for:"description",value:"Description"}),X(i("textarea",{id:"description",class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full","onUpdate:modelValue":n[7]||(n[7]=d=>e.description=d),disabled:!m(C)},null,8,js),[[ke,e.description]]),p(T,{message:$.value.description?$.value.description[0]:"",class:"mt-2"},null,8,["message"])]),i("div",Ps,[p(D,{for:"website",value:"Website"}),p(G,{id:"website",type:"url",class:"mt-1 block w-full",modelValue:e.website,"onUpdate:modelValue":n[8]||(n[8]=d=>e.website=d),disabled:!m(C)},null,8,["modelValue","disabled"]),p(T,{message:$.value.website?$.value.website[0]:"",class:"mt-2"},null,8,["message"])]),i("div",$s,[p(D,{for:"preferred_keywords",value:"Client Preferred Keywords"}),p(G,{id:"preferred_keywords",type:"text",class:"mt-1 block w-full",modelValue:e.preferred_keywords,"onUpdate:modelValue":n[9]||(n[9]=d=>e.preferred_keywords=d),disabled:!m(C)},null,8,["modelValue","disabled"]),p(T,{message:$.value.preferred_keywords?$.value.preferred_keywords[0]:"",class:"mt-2"},null,8,["message"])]),i("div",Ss,[p(D,{for:"status",value:"Status"}),X(i("select",{id:"status",class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full","onUpdate:modelValue":n[10]||(n[10]=d=>e.status=d),required:"",disabled:!m(C)},[(r(!0),l(F,null,N(w.statusOptions,d=>(r(),l("option",{key:d.value,value:d.value},h(d.label),9,Cs))),128))],8,Vs),[[ie,e.status]]),p(T,{message:$.value.status?$.value.status[0]:"",class:"mt-2"},null,8,["message"])]),i("div",Us,[p(D,{for:"source",value:"Source"}),X(i("select",{id:"source",class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full","onUpdate:modelValue":n[11]||(n[11]=d=>e.source=d),disabled:!m(C)},[n[22]||(n[22]=i("option",{value:"",disabled:""},"Select a Source",-1)),(r(!0),l(F,null,N(w.sourceOptions,d=>(r(),l("option",{key:d.value,value:d.value},h(d.label),9,Ds))),128))],8,As),[[ie,e.source]]),p(T,{message:$.value.source?$.value.source[0]:"",class:"mt-2"},null,8,["message"])]),m(C)?(r(),l("div",Is,[e.id&&m(c)||!e.id?(r(),Me(le,{key:0,onClick:n[12]||(n[12]=d=>e.id?Ge():Je()),disabled:!m(C)},{default:ee(()=>[J(h(e.id?"Update Basic Information":"Create Project"),1)]),_:1},8,["disabled"])):v("",!0)])):v("",!0)])):v("",!0),O.value==="client"?(r(),l("div",Rs,[m(P)?(r(),l("div",Os,[p(Re,{label:"Clients",items:ue.value,selectedItems:e.client_ids,"onUpdate:selectedItems":n[13]||(n[13]=d=>e.client_ids=d),roleOptions:qe.value,roleType:"client",error:$.value.client_ids?$.value.client_ids[0]:"",placeholder:"Select a client to add",disabled:!m(b),readonly:!m(b)&&m(P),showRemoveButton:m(b)},null,8,["items","selectedItems","roleOptions","error","disabled","readonly","showRemoveButton"]),m(b)?(r(),l("div",Fs,[p(le,{onClick:Ke,disabled:pe.value},{default:ee(()=>[J(h(pe.value?"Saving...":"Save Clients"),1)]),_:1},8,["disabled"])])):v("",!0),ve.value?(r(),l("div",Ms," Clients saved successfully! ")):v("",!0),se.value?(r(),l("div",Ts,h(se.value),1)):v("",!0)])):v("",!0),i("div",Es,[p(D,{for:"contract_details",value:"Contract Details"}),X(i("textarea",{id:"contract_details",class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full","onUpdate:modelValue":n[14]||(n[14]=d=>e.contract_details=d),disabled:!m(C)},null,8,Ns),[[ke,e.contract_details]]),p(T,{message:$.value.contract_details?$.value.contract_details[0]:"",class:"mt-2"},null,8,["message"])]),m(f)?(r(),l("div",Bs,[p(Re,{label:"Assign Users",items:me.value,selectedItems:e.user_ids,"onUpdate:selectedItems":n[15]||(n[15]=d=>e.user_ids=d),roleOptions:Le.value,roleType:"project",defaultRoleId:2,error:$.value.user_ids?$.value.user_ids[0]:"",placeholder:"Select a user to add",disabled:!m(R),readonly:!m(R)&&m(f),showRemoveButton:m(R)},null,8,["items","selectedItems","roleOptions","error","disabled","readonly","showRemoveButton"]),m(R)?(r(),l("div",qs,[p(le,{onClick:Ye,disabled:ye.value},{default:ee(()=>[J(h(ye.value?"Saving...":"Save Users"),1)]),_:1},8,["disabled"])])):v("",!0),fe.value?(r(),l("div",Ls," Users saved successfully! ")):v("",!0),ae.value?(r(),l("div",zs,h(ae.value),1)):v("",!0)])):v("",!0)])):v("",!0),O.value==="services"?(r(),l("div",Ws,[p(Vt,{projectId:e.id,departmentOptions:w.departmentOptions,paymentTypeOptions:w.paymentTypeOptions,canManageProjectServicesAndPayments:m(W),canViewProjectServicesAndPayments:m(s),onUpdated:n[16]||(n[16]=d=>be(e.id))},null,8,["projectId","departmentOptions","paymentTypeOptions","canManageProjectServicesAndPayments","canViewProjectServicesAndPayments"])])):v("",!0),O.value==="transactions"&&m(Z)?(r(),l("div",Js,[p(Gt,{projectId:e.id,userProjectRole:m(y).value},null,8,["projectId","userProjectRole"])])):v("",!0),O.value==="documents"?(r(),l("div",Gs,[i("div",Ks,[p(D,{value:"Project Documents"}),i("div",Ys,[m(Q)?(r(),l("div",Hs,[p(D,{for:"documents",value:"Upload Documents"}),i("input",{type:"file",id:"documents",onChange:n[17]||(n[17]=d=>{const S=Array.from(d.target.files);if(S.length>0){const L=Array.isArray(e.documents)?e.documents.filter(Y=>typeof Y=="object"&&"path"in Y):[];e.documents=[...L,...S],console.log("Files selected:",S),console.log("Are files File objects?",S.some(Y=>typeof Y=="object"&&Y!==null&&"name"in Y&&"size"in Y&&"type"in Y)),console.log("Updated documents array:",e.documents)}}),class:"mt-1 block w-full",multiple:"",accept:".pdf,.doc,.docx,.jpg,.png"},null,32),n[24]||(n[24]=i("p",{class:"text-sm text-gray-500 mt-1"},"Supported formats: PDF, DOC, DOCX, JPG, PNG",-1)),p(T,{message:$.value.documents?$.value.documents[0]:"",class:"mt-2"},null,8,["message"]),i("div",Xs,[p(le,{type:"button",onClick:He,disabled:!e.id||!e.documents||!e.documents.some(d=>typeof d=="object"&&d!==null&&"name"in d&&"size"in d&&"type"in d)},{default:ee(()=>n[23]||(n[23]=[J(" Upload Documents ")])),_:1,__:[23]},8,["disabled"]),e.id?v("",!0):(r(),l("p",Qs," Please save the project first before uploading documents. "))])])):v("",!0),e.documents&&e.documents.length>0&&typeof e.documents[0]=="object"&&"path"in e.documents[0]?(r(),l("div",Zs,[n[25]||(n[25]=i("h3",{class:"font-medium text-gray-700 mb-2"},"Existing Documents",-1)),(r(!0),l(F,null,N(e.documents,(d,S)=>(r(),l("div",{key:S,class:"flex items-center mb-2 p-2 border rounded"},[i("div",ea,[i("a",{href:"/storage/"+d.path,target:"_blank",class:"text-blue-600 hover:underline"},h(d.filename),9,ta)]),m(Q).value?(r(),l("button",{key:0,type:"button",class:"ml-2 text-red-600",onClick:()=>{e.documents=e.documents.filter((L,Y)=>Y!==S)}}," Remove ",8,sa)):v("",!0)]))),128))])):v("",!0),n[26]||(n[26]=i("div",{class:"mt-4"},[i("p",{class:"text-sm text-gray-500"}," Documents will be uploaded to the project's Google Drive folder. ")],-1))])])])):v("",!0),O.value==="notes"?(r(),l("div",aa,[i("div",oa,[p(D,{value:"Notes"}),i("div",na,[e.notes&&e.notes.length>0?(r(),l("div",ra,[(r(!0),l(F,null,N(e.notes,(d,S)=>(r(),l("div",{key:S,class:"mb-4"},[i("div",la,[X(i("textarea",{"onUpdate:modelValue":L=>d.content=L,readonly:!m(U),placeholder:"Note Content",class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full h-32"},null,8,ia),[[ke,d.content]])])]))),128))])):(r(),l("div",da," No notes found for this project. "))]),p(T,{message:$.value.notes?$.value.notes[0]:"",class:"mt-2"},null,8,["message"])])])):v("",!0),i("div",ca,[p(Te,{onClick:Ae},{default:ee(()=>n[27]||(n[27]=[J("Close")])),_:1,__:[27]})])],32)])}}};export{ga as _};
