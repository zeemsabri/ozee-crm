import{r as g,w as q,B as G,c as Q,o as i,a as z,b as e,t as b,d as X,i as r,g as T,f as U,l as Y,e as y,k as P,F as M,j as B,m as H,p as L,x as S,s as W,v as Z,h as F,y as ee}from"./app-C3yaEWHw.js";import{a as te,_ as ae}from"./AuthenticatedLayout-D_jMeXVX.js";import{_ as se}from"./Modal-m8p6qtnq.js";import{_ as E}from"./InputLabel-B3HTORX3.js";import{_ as R}from"./InputError-BR6XGHq-.js";import{P as le}from"./PrimaryButton-faqPYLh2.js";import{_ as oe}from"./SecondaryButton-DtGHlpRY.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./TextInput-Dlj3FaCT.js";import"./SelectDropdown-CpZMhpK5.js";import"./Checkbox-smfWY98V.js";import"./ApplicationLogo-CxqQ__H2.js";import"./DangerButton-Du8Q7TNm.js";const ie={class:"p-6"},re={class:"text-lg font-medium text-gray-900"},ne={class:"mt-6"},de={key:0,class:"mb-4 p-4 bg-green-100 border border-green-400 text-green-700 rounded"},ue={key:1,class:"mb-4 p-4 bg-red-100 border border-red-400 text-red-700 rounded"},ce={class:"mb-4"},ve={class:"flex items-center"},me={key:2,class:"mb-4"},ge={key:3,class:"mb-4"},fe={class:"flex-1"},pe=["id","onUpdate:modelValue"],he={class:"flex-1"},be=["id","onUpdate:modelValue"],ye={key:0,class:"flex items-end pb-1"},_e=["onClick"],we={class:"mt-6 flex justify-end space-x-3"},xe={key:0,class:"flex items-center"},ke={key:1},Se={__name:"SingleDateAvailabilityModal",props:{show:Boolean,date:{type:String,required:!0}},emits:["close","availability-saved"],setup(I,{emit:w}){const A=()=>{const o=localStorage.getItem("authToken");o&&!S.defaults.headers.common.Authorization&&(S.defaults.headers.common.Authorization=`Bearer ${o}`,console.log("Auth headers set in SingleDateAvailabilityModal"))},_=I,x=w,u=g(!0),c=g(""),d=g([{start_time:"",end_time:""}]),n=g({}),h=g(!1),f=g(""),k=g(""),D=o=>new Date(o).toLocaleDateString("en-US",{weekday:"long",month:"short",day:"numeric"}),$=async()=>{try{A();const o=await S.get("/api/availabilities",{params:{start_date:_.date,end_date:_.date}});if(o.data&&o.data.availabilities&&o.data.availabilities.length>0){const a=o.data.availabilities[0];u.value=a.is_available,a.is_available?d.value=a.time_slots&&a.time_slots.length>0?[...a.time_slots]:[{start_time:"",end_time:""}]:c.value=a.reason||""}else j()}catch(o){console.error("Error fetching existing availability:",o),j()}},j=()=>{u.value=!0,c.value="",d.value=[{start_time:"",end_time:""}]};q(()=>_.show,o=>{o&&(n.value={},f.value="",k.value=D(_.date),$())});const N=()=>{d.value.push({start_time:"",end_time:""})},V=o=>{d.value.length>1&&d.value.splice(o,1)},O=async()=>{h.value=!0,n.value={},f.value="";try{if(u.value){if(d.value.some(a=>!a.start_time||!a.end_time)){n.value.timeSlots="Please fill in all time slots or mark yourself as not available.",h.value=!1;return}for(const a of d.value){const m=a.start_time.split(":").map(Number),p=a.end_time.split(":").map(Number);if(m.length!==2||p.length!==2||isNaN(m[0])||isNaN(m[1])||isNaN(p[0])||isNaN(p[1])){n.value.timeSlots="Invalid time format. Please use HH:MM format.",h.value=!1;return}const C=m[0]*60+m[1],t=p[0]*60+p[1];if(C>=t){n.value.timeSlots="End time must be after start time.",h.value=!1;return}}}else if(!c.value.trim()){n.value.reason="Please provide a reason for unavailability.",h.value=!1;return}A();const o=await S.post("/api/availabilities",{date:_.date,is_available:u.value,reason:u.value?null:c.value,time_slots:u.value?d.value:null});f.value="Availability saved successfully!",x("availability-saved",o.data.availability),setTimeout(()=>{x("close")},1500)}catch(o){if(console.error("Error saving availability:",o),o.response&&o.response.data&&o.response.data.errors)n.value=o.response.data.errors;else if(o.response&&o.response.status===409)try{const a=o.response.data.availability.id,m=await S.put(`/api/availabilities/${a}`,{is_available:u.value,reason:u.value?null:c.value,time_slots:u.value?d.value:null});f.value="Availability updated successfully!",x("availability-saved",m.data.availability),setTimeout(()=>{x("close")},1500)}catch(a){console.error("Error updating availability:",a),n.value.general="An error occurred while updating your availability."}else n.value.general="An error occurred while saving your availability."}finally{h.value=!1}};return G(()=>{A()}),(o,a)=>(i(),Q(se,{show:I.show,onClose:a[3]||(a[3]=m=>o.$emit("close")),"max-width":"md"},{default:z(()=>[e("div",ie,[e("h2",re," Availability for "+b(k.value),1),a[9]||(a[9]=e("p",{class:"mt-1 text-sm text-gray-600"}," Please provide your availability for this date. This helps in planning meetings and work schedules. ",-1)),e("div",ne,[e("form",{onSubmit:X(O,["prevent"])},[f.value?(i(),r("div",de,b(f.value),1)):T("",!0),n.value.general?(i(),r("div",ue,b(n.value.general),1)):T("",!0),e("div",ce,[e("div",ve,[U(e("input",{type:"checkbox",id:"isAvailableToggle","onUpdate:modelValue":a[0]||(a[0]=m=>u.value=m),class:"rounded border-gray-300 text-indigo-600 shadow-sm focus:ring-indigo-500"},null,512),[[Y,u.value]]),a[4]||(a[4]=e("label",{for:"isAvailableToggle",class:"ml-2 block text-sm text-gray-700"}," I am available on this day ",-1))])]),u.value?T("",!0):(i(),r("div",me,[y(E,{for:"reason",value:"Reason for Not Available"}),U(e("textarea",{id:"reason","onUpdate:modelValue":a[1]||(a[1]=m=>c.value=m),rows:"3",class:"mt-1 block w-full border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm",placeholder:"e.g., Out of office, Holiday, Meeting all day"},null,512),[[P,c.value]]),y(R,{message:n.value.reason,class:"mt-2"},null,8,["message"])])),u.value?(i(),r("div",ge,[y(E,{value:"Available Time Slots"}),y(R,{message:n.value.timeSlots,class:"mt-2"},null,8,["message"]),(i(!0),r(M,null,B(d.value,(m,p)=>(i(),r("div",{key:p,class:"flex items-center space-x-2 mt-2"},[e("div",fe,[y(E,{for:`start_time_${p}`,value:"Start Time",class:"text-xs"},null,8,["for"]),U(e("input",{id:`start_time_${p}`,type:"time","onUpdate:modelValue":C=>m.start_time=C,class:"mt-1 block w-full border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm"},null,8,pe),[[P,m.start_time]])]),e("div",he,[y(E,{for:`end_time_${p}`,value:"End Time",class:"text-xs"},null,8,["for"]),U(e("input",{id:`end_time_${p}`,type:"time","onUpdate:modelValue":C=>m.end_time=C,class:"mt-1 block w-full border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm"},null,8,be),[[P,m.end_time]])]),d.value.length>1?(i(),r("div",ye,[e("button",{type:"button",onClick:C=>V(p),class:"p-2 text-red-600 hover:text-red-800"},a[5]||(a[5]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm6 0a1 1 0 012 0v6a1 1 0 11-2 0V8z","clip-rule":"evenodd"})],-1)]),8,_e)])):T("",!0)]))),128)),e("button",{type:"button",onClick:N,class:"mt-3 w-full flex items-center justify-center px-4 py-2 border border-dashed border-indigo-300 rounded-lg text-indigo-600 hover:bg-indigo-50 transition duration-150 ease-in-out"},a[6]||(a[6]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z","clip-rule":"evenodd"})],-1),H(" Add Another Time Slot ",-1)]))])):T("",!0),e("div",we,[y(oe,{onClick:a[2]||(a[2]=m=>o.$emit("close"))},{default:z(()=>a[7]||(a[7]=[H(" Cancel ",-1)])),_:1,__:[7]}),y(le,{disabled:h.value,class:L({"opacity-50":h.value})},{default:z(()=>[h.value?(i(),r("span",xe,a[8]||(a[8]=[e("svg",{class:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),H(" Saving... ",-1)]))):(i(),r("span",ke,"Save Availability"))]),_:1},8,["disabled","class"])])],32)])])]),_:1},8,["show"]))}},Ae={class:"bg-white rounded-lg shadow-md p-6","data-test":"availability-calendar"},De={class:"flex flex-col sm:flex-row justify-between items-center mb-6"},$e={class:"flex items-center space-x-4"},Ce={key:0,class:"w-48"},Te=["value"],Me={class:"flex items-center space-x-2"},Ie={class:"text-sm font-medium"},Be={key:0,class:"flex justify-center items-center py-12"},Ne={key:1,class:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-md"},Ve={key:2,class:"overflow-x-auto"},Ue={class:"min-w-full divide-y divide-gray-200"},ze={class:"flex flex-col items-center"},je={class:"text-lg font-bold"},Ee={class:"text-xs mt-1"},He={class:"bg-white divide-y divide-gray-200"},Oe={class:"min-h-[150px]"},Pe={class:"mb-3 flex justify-center"},Le=["onClick"],We={key:0},Fe={class:"flex items-center justify-between"},Re={key:0},qe={key:1,class:"text-xs text-gray-600 mt-1"},Ge={key:1,class:"flex items-center justify-center h-full text-gray-400 text-xs italic"},Je={__name:"AvailabilityCalendar",props:{userId:{type:Number,default:null},isAdmin:{type:Boolean,default:!1}},setup(I){const w=I,A=g([]),_=g([]),x=g(!1),u=g(""),c=g(""),d=g(""),n=g(w.userId);g("weekly");const h=g(!1),f=g(!1),k=g(""),D=()=>{const t=localStorage.getItem("authToken");t&&!S.defaults.headers.common.Authorization&&(S.defaults.headers.common.Authorization=`Bearer ${t}`,console.log("Auth headers set in AvailabilityCalendar"))},$=async()=>{x.value=!0,u.value="";try{D();let t="/api/availabilities";const s={};c.value&&(s.start_date=c.value),d.value&&(s.end_date=d.value),n.value&&w.isAdmin&&(s.user_id=n.value);const l=await S.get(t,{params:s});A.value=l.data.availabilities,l.data.start_date&&(c.value=l.data.start_date),l.data.end_date&&(d.value=l.data.end_date),w.isAdmin&&_.value.length===0&&j()}catch(t){console.error("Error fetching availabilities:",t),t.response&&t.response.status===401?u.value="Authentication error. Please refresh the page or log in again.":u.value="Failed to load availabilities. Please try again."}finally{x.value=!1}},j=async()=>{try{D();const t=await S.get("/api/users");_.value=t.data}catch(t){console.error("Error fetching users:",t),t.response&&t.response.status===401&&(u.value="Authentication error. Please refresh the page or log in again.")}},N=W(()=>{if(!c.value)return[];const t=[],s=new Date(c.value);for(let l=0;l<7;l++){const v=new Date(s);v.setDate(s.getDate()+l),t.push({date:v.toISOString().split("T")[0],label:v.toLocaleDateString("en-US",{weekday:"short"}),fullLabel:v.toLocaleDateString("en-US",{weekday:"long",month:"short",day:"numeric"})})}return t}),V=W(()=>{const t={};return N.value.forEach(s=>{t[s.date]=A.value.filter(l=>l.date.split("T")[0]===s.date)}),t}),O=()=>{const t=new Date(c.value);t.setDate(t.getDate()-7),c.value=t.toISOString().split("T")[0];const s=new Date(d.value);s.setDate(s.getDate()-7),d.value=s.toISOString().split("T")[0],$()},o=()=>{const t=new Date(c.value);t.setDate(t.getDate()+7),c.value=t.toISOString().split("T")[0];const s=new Date(d.value);s.setDate(s.getDate()+7),d.value=s.toISOString().split("T")[0],$()},a=t=>{n.value=t.target.value?parseInt(t.target.value):null,$()},m=t=>{k.value=t,f.value=!0},p=()=>{$()},C=t=>`${t.start_time} - ${t.end_time}`;return G(()=>{if(D(),!c.value){const t=new Date,s=t.getDay(),l=new Date(t);l.setDate(t.getDate()-s),c.value=l.toISOString().split("T")[0];const v=new Date(t);v.setDate(t.getDate()+(6-s)),d.value=v.toISOString().split("T")[0]}setTimeout(()=>{$()},100)}),q(()=>w.userId,t=>{t!==n.value&&(n.value=t,$())}),(t,s)=>(i(),r("div",Ae,[e("div",De,[s[6]||(s[6]=e("h2",{class:"text-2xl font-bold text-gray-800 mb-4 sm:mb-0"},"Weekly Availability",-1)),e("div",$e,[w.isAdmin?(i(),r("div",Ce,[U(e("select",{"onUpdate:modelValue":s[0]||(s[0]=l=>n.value=l),onChange:a,class:"w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"},[s[3]||(s[3]=e("option",{value:null},"All Users",-1)),(i(!0),r(M,null,B(_.value,l=>(i(),r("option",{key:l.id,value:l.id},b(l.name),9,Te))),128))],544),[[Z,n.value]])])):T("",!0),e("div",Me,[e("button",{onClick:O,class:"p-2 rounded-full bg-gray-100 hover:bg-gray-200 transition-colors"},s[4]||(s[4]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])),e("span",Ie,b(new Date(c.value).toLocaleDateString("en-US",{month:"short",day:"numeric"}))+" - "+b(new Date(d.value).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})),1),e("button",{onClick:o,class:"p-2 rounded-full bg-gray-100 hover:bg-gray-200 transition-colors"},s[5]||(s[5]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)]))])])]),x.value?(i(),r("div",Be,s[7]||(s[7]=[e("svg",{class:"animate-spin h-8 w-8 text-indigo-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)]))):u.value?(i(),r("div",Ne,b(u.value),1)):(i(),r("div",Ve,[e("table",Ue,[e("thead",null,[e("tr",null,[(i(!0),r(M,null,B(N.value,l=>(i(),r("th",{key:l.date,class:"px-6 py-3 bg-gray-50 text-center text-xs font-medium text-gray-500 uppercase tracking-wider"},[e("div",ze,[e("span",je,b(l.label),1),e("span",Ee,b(l.date),1)])]))),128))])]),e("tbody",He,[e("tr",null,[(i(!0),r(M,null,B(N.value,l=>(i(),r("td",{key:l.date,class:"px-2 py-4 whitespace-nowrap text-sm text-gray-500 border-r border-gray-100 align-top"},[e("div",Oe,[e("div",Pe,[e("button",{onClick:v=>m(l.date),class:"inline-flex items-center px-3 py-1 border border-transparent text-xs leading-4 font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-500 focus:outline-none focus:border-indigo-700 focus:shadow-outline-indigo active:bg-indigo-700 transition ease-in-out duration-150"},s[8]||(s[8]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})],-1),H(" Add ",-1)]),8,Le)]),V.value[l.date]&&V.value[l.date].length>0?(i(),r("div",We,[(i(!0),r(M,null,B(V.value[l.date],v=>(i(),r("div",{key:v.id,class:L(["mb-2 p-2 rounded-md",v.is_available?"bg-green-50 border border-green-100":"bg-red-50 border border-red-100"])},[e("div",Fe,[e("span",{class:L(["font-medium",v.is_available?"text-green-700":"text-red-700"])},b(v.user?v.user.name+" - ":"")+b(v.is_available?"Available":"Not Available"),3)]),v.is_available&&v.time_slots?(i(),r("div",Re,[(i(!0),r(M,null,B(v.time_slots,(J,K)=>(i(),r("div",{key:K,class:"text-xs text-gray-600 mt-1"},b(C(J)),1))),128))])):T("",!0),!v.is_available&&v.reason?(i(),r("div",qe," Reason: "+b(v.reason),1)):T("",!0)],2))),128))])):(i(),r("div",Ge," No availability set "))])]))),128))])])])])),y(te,{show:h.value,date:k.value,userId:n.value,onClose:s[1]||(s[1]=l=>h.value=!1),onAvailabilitySaved:p},null,8,["show","date","userId"]),y(Se,{show:f.value,date:k.value,onClose:s[2]||(s[2]=l=>f.value=!1),onAvailabilitySaved:p},null,8,["show","date"])]))}},Ke={class:"py-12"},Qe={class:"mx-auto max-w-7xl sm:px-6 lg:px-8"},Xe={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},Ye={class:"p-6 text-gray-900"},vt={__name:"Index",props:{auth:Object},setup(I){var _,x,u,c,d,n;const w=I,A=((u=(x=(_=w.auth)==null?void 0:_.user)==null?void 0:x.role_data)==null?void 0:u.slug)==="super-admin"||((n=(d=(c=w.auth)==null?void 0:c.user)==null?void 0:d.role_data)==null?void 0:n.slug)==="manager";return(h,f)=>(i(),r(M,null,[y(F(ee),{title:"Weekly Availability"}),y(ae,null,{header:z(()=>f[0]||(f[0]=[e("h2",{class:"text-xl font-semibold leading-tight text-gray-800"}," Weekly Availability ",-1)])),default:z(()=>{var k,D;return[e("div",Ke,[e("div",Qe,[e("div",Xe,[e("div",Ye,[f[1]||(f[1]=e("p",{class:"mb-6 text-gray-600"}," View and manage your weekly availability. This helps in planning meetings and work schedules. ",-1)),y(Je,{"user-id":(D=(k=w.auth)==null?void 0:k.user)==null?void 0:D.id,"is-admin":F(A)},null,8,["user-id","is-admin"])])])])])]}),_:1})],64))}};export{vt as default};
