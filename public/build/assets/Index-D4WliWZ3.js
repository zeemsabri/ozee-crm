import{Z as te,r as o,s as ae,B as oe,i as v,o as m,e as r,h as R,y as se,a as $,b as s,F as j,j as P,p as le,t as ie,c as ne,H as re,g as de,m as ue,x as H}from"./app-CCIvBE0H.js";import{_ as me}from"./AuthenticatedLayout-n0IvGKBU.js";import ce from"./TabPanel-BiqmWRGb.js";import pe from"./NewEmailsTab-B5AZuF3Q.js";import ve from"./AllEmailsTab-C5EtzjWu.js";import fe from"./WaitingApprovalTab-48jEnK7v.js";import{_ as he,E as be,a as we,b as Ee}from"./ComposeEmailModal-D_JpUY53.js";import"./PrimaryButton-CKeyix5K.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./Modal-N--bAL5c.js";import"./InputLabel-D4oa12P3.js";import"./InputError-B_Om2v21.js";import"./SecondaryButton-C9FY9eVA.js";import"./TextInput-DQOEgA7h.js";import"./SelectDropdown-C0DfOAIs.js";import"./Checkbox-BWcUN7oK.js";import"./ApplicationLogo-BfKXbvyl.js";import"./DangerButton-BBu2jm3k.js";import"./EmailList-Bert7gDR.js";import"./EmailEditor-MfaPRWBv.js";const ge={class:"flex justify-between items-center"},_e={class:"py-12"},xe={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},ye={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},Ce={class:"p-6 bg-white border-b border-gray-200"},Me={class:"border-b border-gray-200"},$e={class:"-mb-px flex space-x-8","aria-label":"Tabs"},je=["onClick"],Ae={class:"mt-6"},Qe={__name:"Index",setup(Te){const{canDo:E}=te(),g=E("view_emails").value,z=E("approve_emails").value,L=E("compose_emails").value,W=o([]),Z=o(null),f=o(!1),l=o({type:"",status:"",startDate:"",endDate:"",search:"",project_id:"",sender_id:""});ae(()=>!l.value.type&&!l.value.status&&!l.value.startDate&&!l.value.endDate&&!l.value.search&&!l.value.project_id&&!l.value.sender_id);const d=o("new"),A=[{id:"new",label:"New Emails",component:pe,visible:g},{id:"all",label:"All Emails",component:ve,visible:g},{id:"waiting",label:"Waiting Approval",component:fe,visible:z}],T=o({new:null,all:null,waiting:null}),n=o(null),u=o(!1),c=o(!1),_=o(""),x=o(""),y=o("post"),h=o(""),C=o(""),b=o(!1),k=o(null),S=o(""),M=o(""),D=o(""),B=o(null),F=o(!1),q=async e=>{n.value=e,u.value=!0,F.value=e.can_approve??!1;try{await H.post(`/api/inbox/emails/${e.id}/mark-as-read`)}catch(t){console.error("Failed to mark email as read:",t)}},G=()=>{u.value=!1,n.value=null,p()},J=async e=>{try{n.value=e;const i=(await H.get(`/api/emails/${e.id}/edit-content`)).data;i.template_id?(k.value=e.id,S.value=`/api/emails/${e.id}/edit-and-approve`,M.value="Approve & Send",i.type==="received"&&(M.value="Approve"),D.value="Email updated and approved successfully!",B.value=i.client_id,b.value=!0,u.value=!1):(_.value="Edit and Approve Email",x.value=`/api/emails/${e.id}/edit-and-approve`,y.value="post",h.value="Approve & Send",i.type==="received"&&(h.value="Approve"),C.value="Email updated and approved successfully!",c.value=!0,u.value=!1)}catch(t){console.error("Failed to determine email type:",t)}},K=e=>{n.value=e,_.value="Reject Email",x.value=`/api/emails/${e.id}/reject`,y.value="post",h.value="Reject Email",C.value="Email rejected successfully!",c.value=!0,u.value=!1},O=()=>{c.value=!1,p()},Q=()=>{c.value=!1,p()},U=()=>{b.value=!1,p()},X=()=>{b.value=!1,p()},p=()=>{const e=T.value[d.value];e&&typeof e.refresh=="function"?e.refresh():console.error(`Cannot refresh tab: ${d.value} Component reference not found or refresh method is missing.`)},Y=e=>{l.value=e},ee=e=>{d.value=e};return oe(()=>{g||(window.location.href="/dashboard")}),(e,t)=>(m(),v(j,null,[r(R(se),{title:"Inbox"}),r(me,null,{header:$(()=>[s("div",ge,[t[7]||(t[7]=s("h2",{class:"font-semibold text-xl text-gray-800 leading-tight"}," Inbox ",-1)),R(L)?(m(),v("button",{key:0,onClick:t[0]||(t[0]=i=>f.value=!0),class:"inline-flex items-center px-4 py-2 bg-indigo-600 border border-transparent rounded-md font-semibold text-xs text-white uppercase tracking-widest hover:bg-indigo-700 active:bg-indigo-900 focus:outline-none focus:border-indigo-900 focus:ring focus:ring-indigo-300 disabled:opacity-25 transition"},t[6]||(t[6]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})],-1),ue(" Compose Email ",-1)]))):de("",!0)])]),default:$(()=>{var i,V,I,N;return[s("div",_e,[s("div",xe,[s("div",ye,[s("div",Ce,[s("div",Me,[s("nav",$e,[(m(!0),v(j,null,P(A.filter(a=>a.visible),a=>(m(),v("button",{key:a.id,onClick:w=>ee(a.id),class:le([d.value===a.id?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300","whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm"])},ie(a.label),11,je))),128))])]),s("div",Ae,[(m(),v(j,null,P(A,a=>s("div",{key:a.id},[r(ce,{active:d.value===a.id},{default:$(()=>[(m(),ne(re(a.component),{ref_for:!0,ref:w=>{w&&(T.value[a.id]=w)},onViewEmail:q,onFiltersChanged:w=>a.id==="all"?Y:()=>{},"is-active":d.value===a.id},null,40,["onFiltersChanged","is-active"]))]),_:2},1032,["active"])])),64))])])])])]),r(he,{show:u.value,email:n.value,"can-approve-emails":F.value,onClose:G,onEdit:J,onReject:K},null,8,["show","email","can-approve-emails"]),r(be,{show:c.value,title:_.value,"api-endpoint":x.value,"http-method":y.value,"submit-button-text":h.value,"success-message":C.value,"email-id":(i=n.value)==null?void 0:i.id,"project-id":(N=(I=(V=n.value)==null?void 0:V.conversation)==null?void 0:I.project)==null?void 0:N.id,onClose:Q,onSubmitted:O,onError:t[1]||(t[1]=a=>console.error("EmailActionModal error:",a))},null,8,["show","title","api-endpoint","http-method","submit-button-text","success-message","email-id","project-id"]),r(we,{show:b.value,title:"Edit Template Email","api-endpoint":S.value,"http-method":"post","submit-button-text":M.value,"success-message":D.value,"email-id":k.value,"client-id":B.value,onClose:X,onSubmitted:U,onError:t[2]||(t[2]=a=>console.error("EditTemplateEmailModal error:",a))},null,8,["show","api-endpoint","submit-button-text","success-message","email-id","client-id"]),r(Ee,{show:f.value,title:"Compose New Email","api-endpoint":"/api/emails/templated","http-method":"post",clients:W.value,"submit-button-text":"Submit for Approval","success-message":"Email submitted for approval successfully!","project-id":Z.value,onClose:t[3]||(t[3]=a=>f.value=!1),onSubmitted:t[4]||(t[4]=a=>f.value=!1),onError:t[5]||(t[5]=a=>console.error("Email submission error:",a))},null,8,["show","clients","project-id"])]}),_:1})],64))}};export{Qe as default};
