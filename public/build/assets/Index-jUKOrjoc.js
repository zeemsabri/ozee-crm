import{p as $,z as I,r as g,s as ee,A as se,h as i,o as n,e as o,u as ae,q as le,a as u,b as l,g as h,k as f,t as p,F as M,i as j,c as z,d as L,f as O,v as Y}from"./app-CP7lE2wK.js";import{_ as te}from"./AuthenticatedLayout-tBQ5dGIv.js";import{P as N}from"./PrimaryButton-wMJKnIkM.js";import{D as G}from"./DangerButton-DOtYQHFO.js";import{_ as P,a as q}from"./SecondaryButton-Bk9GKpTL.js";import{_,a as y}from"./TextInput-CVyX9ZVz.js";import{_ as x}from"./InputError-U6zup5WJ.js";import"./ApplicationLogo-C3Wq8-0e.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const oe={class:"py-12"},re={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},de={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},ne={class:"p-6 text-gray-900"},ie={key:0,class:"mb-6"},ue={key:1,class:"text-gray-600"},me={key:2,class:"text-red-600"},pe={key:3,class:"text-gray-600"},ve={key:4},ce={class:"min-w-full divide-y divide-gray-200"},fe={class:"bg-white divide-y divide-gray-200"},_e={class:"px-6 py-4 whitespace-nowrap"},ge={class:"px-6 py-4 whitespace-nowrap"},we={class:"px-6 py-4 whitespace-nowrap capitalize"},ye={class:"px-6 py-4"},xe={key:0},be={key:1,class:"text-gray-400"},ke={class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium"},he={class:"flex items-center space-x-2"},Ue={class:"p-6"},Ve={key:0,class:"text-red-600 text-sm mb-4"},Ce={class:"mb-4"},$e={class:"mb-4"},Me={class:"mb-4"},Ne={class:"mb-4"},Se={class:"mb-4"},De=["value","disabled"],Ee={class:"mt-6 flex justify-end"},je={class:"p-6"},Pe={key:0,class:"text-red-600 text-sm mb-4"},qe={class:"mb-4"},Fe={class:"mb-4"},Ae={class:"mb-4"},Be={class:"mb-4"},Re={class:"mb-4"},ze=["disabled"],Le=["value","disabled"],Oe={class:"mt-6 flex justify-end"},Ye={class:"p-6"},Ge={key:0,class:"mt-4 text-gray-800"},He={key:1,class:"text-red-600 text-sm mb-4"},Je={class:"mt-6 flex justify-end"},ls={__name:"Index",setup(Ke){const m=$(()=>I().props.auth.user),w=g([]),S=g(!0),r=g({}),d=g(""),U=g(!1),V=g(!1),C=g(!1),t=ee({id:null,name:"",email:"",password:"",password_confirmation:"",role:"contractor",role_id:4}),c=g(null),v=g([]),H=async()=>{try{const s=await window.axios.get("/api/roles?type=application");v.value=s.data.map(e=>({value:e.id,slug:e.slug.replace(/-/g,"_"),label:e.name}))}catch(s){console.error("Error fetching roles:",s),v.value=[{value:1,slug:"super_admin",label:"Super Admin"},{value:2,slug:"manager",label:"Manager"},{value:3,slug:"employee",label:"Employee"},{value:4,slug:"contractor",label:"Contractor"}]}},b=$(()=>{var s;return m.value?((s=m.value.role_data)==null?void 0:s.slug)==="super-admin"||m.value.role==="super_admin"||m.value.role==="super-admin":!1}),F=$(()=>{var s;return m.value?((s=m.value.role_data)==null?void 0:s.slug)==="manager"||m.value.role==="manager"||m.value.role==="manager-role"||m.value.role==="manager_role":!1}),J=$(()=>b.value||F.value);$(()=>b.value);const D=async()=>{S.value=!0,d.value="";try{const s=await window.axios.get("/api/users");w.value=s.data}catch(s){d.value="Failed to fetch users.",console.error("Error fetching users:",s),s.response&&s.response.status===403?d.value="You do not have permission to view users.":s.response&&s.response.status===401&&(d.value="Session expired. Please log in again.",localStorage.removeItem("authToken"),localStorage.removeItem("userRole"),window.location.href="/login")}finally{S.value=!1}},K=()=>{t.id=null,t.name="",t.email="",t.password="",t.password_confirmation="";const s=v.value.find(e=>e.slug==="contractor");t.role_id=(s==null?void 0:s.value)||(v.value.length>0?v.value[0].value:4),t.role=(s==null?void 0:s.slug)||"contractor",r.value={},d.value="",U.value=!0},Q=async()=>{r.value={},d.value="";try{const s=await window.axios.post("/api/users",t);w.value.push(s.data),U.value=!1,alert("User created successfully!"),D()}catch(s){s.response&&s.response.status===422?r.value=s.response.data.errors:s.response&&s.response.data.message?d.value=s.response.data.message:(d.value="Failed to create user.",console.error("Error creating user:",s))}},W=s=>{if(t.id=s.id,t.name=s.name,t.email=s.email,s.role_data&&s.role_data.id)t.role_id=s.role_data.id,t.role=s.role_data.slug.replace(/-/g,"_");else{const e=typeof s.role=="string"?s.role.replace(/-/g,"_"):"employee",a=v.value.find(k=>k.slug===e);t.role_id=(a==null?void 0:a.value)||(v.value.length>0?v.value[0].value:null),t.role=e}t.password="",t.password_confirmation="",r.value={},d.value="",V.value=!0},X=async()=>{r.value={},d.value="";try{const s={...t};s.password||(delete s.password,delete s.password_confirmation);const e=await window.axios.put(`/api/users/${t.id}`,s),a=w.value.findIndex(k=>k.id===t.id);a!==-1&&(w.value[a]=e.data),V.value=!1,alert("User updated successfully!"),D()}catch(s){s.response&&s.response.status===422?r.value=s.response.data.errors:s.response&&s.response.data.message?d.value=s.response.data.message:(d.value="Failed to update user.",console.error("Error updating user:",s))}},Z=s=>{c.value=s,C.value=!0},T=async()=>{d.value="";try{await window.axios.delete(`/api/users/${c.value.id}`),w.value=w.value.filter(s=>s.id!==c.value.id),C.value=!1,c.value=null,alert("User deleted successfully!")}catch(s){d.value="Failed to delete user.",s.response&&s.response.data.message&&(d.value=s.response.data.message),console.error("Error deleting user:",s)}},A=()=>{const s=v.value.find(e=>e.value===t.role_id);s&&(t.role=s.slug)};return se(()=>{D(),H()}),(s,e)=>(n(),i(M,null,[o(ae(le),{title:"Users"}),o(te,null,{header:u(()=>e[16]||(e[16]=[l("h2",{class:"font-semibold text-xl text-gray-800 leading-tight"},"Users",-1)])),default:u(()=>[l("div",oe,[l("div",re,[l("div",de,[l("div",ne,[e[21]||(e[21]=l("h3",{class:"text-2xl font-bold mb-4"},"Manage Users",-1)),J.value?(n(),i("div",ie,[o(N,{onClick:K},{default:u(()=>e[17]||(e[17]=[f(" Create New User ")])),_:1,__:[17]})])):h("",!0),S.value?(n(),i("div",ue,"Loading users...")):d.value?(n(),i("div",me,p(d.value),1)):w.value.length===0?(n(),i("div",pe,"No users found.")):(n(),i("div",ve,[l("table",ce,[e[20]||(e[20]=l("thead",{class:"bg-gray-50"},[l("tr",null,[l("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Name"),l("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Email"),l("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Role"),l("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Projects"),l("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Actions")])],-1)),l("tbody",fe,[(n(!0),i(M,null,j(w.value,a=>{var k,B,R;return n(),i("tr",{key:a.id},[l("td",_e,p(a.name),1),l("td",ge,p(a.email),1),l("td",we,p(((k=a.role_data)==null?void 0:k.name)||(typeof a.role=="string"?a.role.replace(/_|-/g," "):"Employee")),1),l("td",ye,[a.projects&&a.projects.length?(n(),i("span",xe,p(a.projects.map(E=>E.name).join(", ")),1)):(n(),i("span",be,"None"))]),l("td",ke,[l("div",he,[b.value||F.value&&(((B=a.role_data)==null?void 0:B.slug)==="employee"||((R=a.role_data)==null?void 0:R.slug)==="contractor"||typeof a.role=="string"&&(a.role.replace(/-/g,"_")==="employee"||a.role.replace(/-/g,"_")==="contractor"))||m.value.id===a.id?(n(),z(N,{key:0,onClick:E=>W(a)},{default:u(()=>e[18]||(e[18]=[f(" Edit ")])),_:2,__:[18]},1032,["onClick"])):h("",!0),b.value&&a.id!==m.value.id?(n(),z(G,{key:1,onClick:E=>Z(a)},{default:u(()=>e[19]||(e[19]=[f(" Delete ")])),_:2,__:[19]},1032,["onClick"])):h("",!0)])])])}),128))])])]))])])])]),o(P,{show:U.value,onClose:e[6]||(e[6]=a=>U.value=!1)},{default:u(()=>[l("div",Ue,[e[24]||(e[24]=l("h2",{class:"text-lg font-medium text-gray-900 mb-4"},"Create New User",-1)),d.value?(n(),i("div",Ve,p(d.value),1)):h("",!0),l("form",{onSubmit:L(Q,["prevent"])},[l("div",Ce,[o(_,{for:"create_name",value:"Name"}),o(y,{id:"create_name",type:"text",class:"mt-1 block w-full",modelValue:t.name,"onUpdate:modelValue":e[0]||(e[0]=a=>t.name=a),required:"",autofocus:""},null,8,["modelValue"]),o(x,{message:r.value.name?r.value.name[0]:"",class:"mt-2"},null,8,["message"])]),l("div",$e,[o(_,{for:"create_email",value:"Email"}),o(y,{id:"create_email",type:"email",class:"mt-1 block w-full",modelValue:t.email,"onUpdate:modelValue":e[1]||(e[1]=a=>t.email=a),required:""},null,8,["modelValue"]),o(x,{message:r.value.email?r.value.email[0]:"",class:"mt-2"},null,8,["message"])]),l("div",Me,[o(_,{for:"create_password",value:"Password"}),o(y,{id:"create_password",type:"password",class:"mt-1 block w-full",modelValue:t.password,"onUpdate:modelValue":e[2]||(e[2]=a=>t.password=a),required:"",autocomplete:"new-password"},null,8,["modelValue"]),o(x,{message:r.value.password?r.value.password[0]:"",class:"mt-2"},null,8,["message"])]),l("div",Ne,[o(_,{for:"create_password_confirmation",value:"Confirm Password"}),o(y,{id:"create_password_confirmation",type:"password",class:"mt-1 block w-full",modelValue:t.password_confirmation,"onUpdate:modelValue":e[3]||(e[3]=a=>t.password_confirmation=a),required:"",autocomplete:"new-password"},null,8,["modelValue"])]),l("div",Se,[o(_,{for:"create_role",value:"Role"}),O(l("select",{id:"create_role",class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full","onUpdate:modelValue":e[4]||(e[4]=a=>t.role_id=a),onChange:A},[(n(!0),i(M,null,j(v.value,a=>(n(),i("option",{key:a.value,value:a.value,disabled:!b.value&&(a.slug==="super_admin"||a.slug==="manager")},p(a.label),9,De))),128))],544),[[Y,t.role_id]]),o(x,{message:r.value.role_id?r.value.role_id[0]:r.value.role?r.value.role[0]:"",class:"mt-2"},null,8,["message"])]),l("div",Ee,[o(q,{onClick:e[5]||(e[5]=a=>U.value=!1)},{default:u(()=>e[22]||(e[22]=[f("Cancel")])),_:1,__:[22]}),o(N,{class:"ms-3",type:"submit"},{default:u(()=>e[23]||(e[23]=[f("Create User")])),_:1,__:[23]})])],32)])]),_:1},8,["show"]),o(P,{show:V.value,onClose:e[13]||(e[13]=a=>V.value=!1)},{default:u(()=>[l("div",je,[e[27]||(e[27]=l("h2",{class:"text-lg font-medium text-gray-900 mb-4"},"Edit User",-1)),d.value?(n(),i("div",Pe,p(d.value),1)):h("",!0),l("form",{onSubmit:L(X,["prevent"])},[l("div",qe,[o(_,{for:"edit_name",value:"Name"}),o(y,{id:"edit_name",type:"text",class:"mt-1 block w-full",modelValue:t.name,"onUpdate:modelValue":e[7]||(e[7]=a=>t.name=a),required:"",autofocus:""},null,8,["modelValue"]),o(x,{message:r.value.name?r.value.name[0]:"",class:"mt-2"},null,8,["message"])]),l("div",Fe,[o(_,{for:"edit_email",value:"Email"}),o(y,{id:"edit_email",type:"email",class:"mt-1 block w-full",modelValue:t.email,"onUpdate:modelValue":e[8]||(e[8]=a=>t.email=a),required:""},null,8,["modelValue"]),o(x,{message:r.value.email?r.value.email[0]:"",class:"mt-2"},null,8,["message"])]),l("div",Ae,[o(_,{for:"edit_password",value:"Password (leave blank to keep current)"}),o(y,{id:"edit_password",type:"password",class:"mt-1 block w-full",modelValue:t.password,"onUpdate:modelValue":e[9]||(e[9]=a=>t.password=a),autocomplete:"new-password"},null,8,["modelValue"]),o(x,{message:r.value.password?r.value.password[0]:"",class:"mt-2"},null,8,["message"])]),l("div",Be,[o(_,{for:"edit_password_confirmation",value:"Confirm Password"}),o(y,{id:"edit_password_confirmation",type:"password",class:"mt-1 block w-full",modelValue:t.password_confirmation,"onUpdate:modelValue":e[10]||(e[10]=a=>t.password_confirmation=a),autocomplete:"new-password"},null,8,["modelValue"])]),l("div",Re,[o(_,{for:"edit_role",value:"Role"}),O(l("select",{id:"edit_role",class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full","onUpdate:modelValue":e[11]||(e[11]=a=>t.role_id=a),onChange:A,disabled:!b.value&&t.id!==m.value.id},[(n(!0),i(M,null,j(v.value,a=>(n(),i("option",{key:a.value,value:a.value,disabled:!b.value&&(a.slug==="super_admin"||a.slug==="manager")&&t.id!==m.value.id},p(a.label),9,Le))),128))],40,ze),[[Y,t.role_id]]),o(x,{message:r.value.role_id?r.value.role_id[0]:r.value.role?r.value.role[0]:"",class:"mt-2"},null,8,["message"])]),l("div",Oe,[o(q,{onClick:e[12]||(e[12]=a=>V.value=!1)},{default:u(()=>e[25]||(e[25]=[f("Cancel")])),_:1,__:[25]}),o(N,{class:"ms-3",type:"submit"},{default:u(()=>e[26]||(e[26]=[f("Update User")])),_:1,__:[26]})])],32)])]),_:1},8,["show"]),o(P,{show:C.value,onClose:e[15]||(e[15]=a=>C.value=!1)},{default:u(()=>{var a;return[l("div",Ye,[e[31]||(e[31]=l("h2",{class:"text-lg font-medium text-gray-900"}," Are you sure you want to delete this user? ",-1)),e[32]||(e[32]=l("p",{class:"mt-1 text-sm text-gray-600"}," This action cannot be undone. All data associated with this user will be removed. ",-1)),c.value?(n(),i("div",Ge,[e[28]||(e[28]=l("strong",null,"User:",-1)),f(" "+p(c.value.name)+" ("+p(c.value.email)+") - Role: "+p(((a=c.value.role_data)==null?void 0:a.name)||(typeof c.value.role=="string"?c.value.role:"Employee")),1)])):h("",!0),d.value?(n(),i("div",He,p(d.value),1)):h("",!0),l("div",Je,[o(q,{onClick:e[14]||(e[14]=k=>C.value=!1)},{default:u(()=>e[29]||(e[29]=[f("Cancel")])),_:1,__:[29]}),o(G,{class:"ms-3",onClick:T},{default:u(()=>e[30]||(e[30]=[f("Delete User")])),_:1,__:[30]})])])]}),_:1},8,["show"])]),_:1})],64))}};export{ls as default};
