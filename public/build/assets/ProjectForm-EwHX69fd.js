import{x as re,r as P,R as E,z as pe,w as le,B as me,i as n,o as l,b as e,m as F,g as x,e as o,f as ge,k as ke,c as Q,a as H,p as Y,Q as ae,s as K,F as ie,j as de,t as V,d as Ve,S as Te,I as We,h as I,v as Ce,Z as Oe,ak as Je,l as Ze,a8 as Xe,al as Qe,am as et,an as tt,$ as at}from"./app-CCIvBE0H.js";import{_ as A}from"./InputLabel-D4oa12P3.js";import{_ as G}from"./TextInput-DQOEgA7h.js";import{_ as R}from"./InputError-B_Om2v21.js";import{P as ee}from"./PrimaryButton-CKeyix5K.js";import{S as se}from"./SelectDropdown-C0DfOAIs.js";import{T as st}from"./AuthenticatedLayout-n0IvGKBU.js";import{P as lt,_ as ot}from"./ProjectTypeInput-Co3uIr1y.js";import{_ as be}from"./SecondaryButton-C9FY9eVA.js";import{D as Ie}from"./DangerButton-BBu2jm3k.js";import{_ as nt}from"./Modal-N--bAL5c.js";import{_ as rt}from"./Checkbox-BWcUN7oK.js";const it=P([]),dt=P([]),De=P([]),Ue=P([]),Me=async t=>{try{const f=(await re.get(`/api/roles?type=${t}`)).data.map(g=>({value:g.id,label:g.name}));return t==="client"?it.value=f:t==="project"&&(dt.value=f),f}catch(p){return console.error(`Error fetching ${t} roles:`,p),E(`Failed to load ${t} roles. Please refresh the page.`),[]}},ut=async(t,p)=>{try{let a;return p&&!t||t&&(a=await window.axios.get("/api/clients"),De.value=a.data.data||a.data),De.value}catch(a){return console.error("Error fetching clients:",a),E("Failed to load clients. Please try again."),[]}},ct=async(t,p)=>{try{let a;return p&&!t||t&&(a=await window.axios.get("/api/users"),Ue.value=a.data),Ue.value}catch(a){return console.error("Error fetching users:",a),E("Failed to load users. Please try again."),[]}},xe=async(t,p,a)=>{let f="",g=null;try{switch(p){case"basic":f=`/api/projects/${t}/sections/basic`;break;case"client":(a.canViewProjectClients||a.canManageProjectClients||a.canViewProjectUsers||a.canManageProjectUsers)&&(f=`/api/projects/${t}/sections/clients-users`);break;case"services":(a.canViewProjectServicesAndPayments||a.canManageProjectServicesAndPayments)&&(f=`/api/projects/${t}/sections/services-payment`);break;case"documents":a.canViewProjectDocuments&&(f=`/api/projects/${t}/sections/documents`);break;case"notes":(a.canViewProjectNotes||a.canAddProjectNotes)&&(f=`/api/projects/${t}/sections/notes?type=private`);break;case"transactions":return null;default:return console.warn(`Attempted to fetch data for unknown tab: ${p}`),null}return f&&(g=(await window.axios.get(f)).data),g}catch($){throw console.error(`Error fetching data for tab '${p}':`,$),E(`Failed to load data for ${p} section. Please try again.`),$}},mt={class:"space-y-6 bg-white p-6 rounded-lg border border-gray-100 font-inter"},vt={key:0,class:"text-center py-8 text-gray-500 text-lg"},pt={key:1,class:"grid grid-cols-1 md:grid-cols-2 gap-6"},gt={key:0},yt={key:1},ft={key:2},bt=["disabled"],ht={key:0,class:"mt-2"},wt=["src"],xt={class:"mt-6"},kt=["disabled"],jt={class:"mt-6"},_t={class:"mt-6"},Pt={class:"mt-6 flex justify-end"},$t={key:0,class:"flex items-center"},St={key:1},Vt={__name:"ProjectEditBasicInfo",props:{projectId:{type:[Number,String],required:!0},errors:{type:Object,default:()=>({})},statusOptions:{type:Array,required:!0,default:()=>[{value:"active",label:"Active"},{value:"completed",label:"Completed"},{value:"paid",label:"Paid"},{value:"on_hold",label:"On-hold"}]},sourceOptions:{type:Array,required:!0},canManageProjects:{type:Boolean,default:!1},canManageProjectBasicDetails:{type:Boolean,default:!1},isSaving:{type:Boolean,default:!1}},setup(t){const p=t,a=pe({id:null,name:"",description:"",website:"",social_media_link:"",preferred_keywords:"",google_chat_id:"",google_drive_link:"",logo:null,status:"active",project_type:"",source:"",tags:[],tags_data:[],timezone:null}),f=P(!1),g=P(!0),$=v=>{const u=v.target.files[0];u?a.logo=u:a.logo=null},B=async()=>{f.value=!0;const v=new FormData,u=["id","tags","tags_data","logo"];for(const s in a)u.includes(s)||a[s]!==null&&a[s]!==void 0&&v.append(s,a[s]);Array.isArray(a.tags)&&a.tags.forEach(s=>{const i=typeof s=="object"&&s!==null&&s.id?s.id:s;i!=null&&v.append("tags[]",i)}),a.logo instanceof File&&v.append("logo",a.logo),v.append("_method","PUT");try{const s=await window.axios.post(`/api/projects/${p.projectId}/sections/basic`,v,{headers:{"Content-Type":"multipart/form-data"}});ae("Project basic information updated successfully!"),s.data&&Object.assign(a,{name:s.data.name||a.name,description:s.data.description||a.description,website:s.data.website||a.website,social_media_link:s.data.social_media_link||a.social_media_link,preferred_keywords:s.data.preferred_keywords||a.preferred_keywords,google_chat_id:s.data.google_chat_id||a.google_chat_id,google_drive_link:s.data.google_drive_link||a.google_drive_link,logo:s.data.logo||a.logo,status:s.data.status||a.status,project_type:s.data.project_type||a.project_type,source:s.data.source||a.source,tags:s.data.tags||a.tags,tags_data:s.data.tags_data||a.tags_data,timezone:s.data.timezone||a.timezone})}catch(s){console.error("Error saving basic info:",s);let i="Failed to save basic information.";s.response&&s.response.data&&s.response.data.message&&(i=s.response.data.message),E(i)}finally{f.value=!1}},U=async()=>{if(!p.projectId){g.value=!1;return}g.value=!0;try{const v=await xe(p.projectId,"basic",{});v&&Object.assign(a,{id:v.id||p.projectId,name:v.name||"",description:v.description||"",website:v.website||"",social_media_link:v.social_media_link||"",preferred_keywords:v.preferred_keywords||"",google_chat_id:v.google_chat_id||"",google_drive_link:v.google_drive_link||"",logo:v.logo||null,status:v.status||"active",project_type:v.project_type||"",source:v.source||"",tags:v.tags||[],tags_data:v.tags_data||[],timezone:v.timezone||null})}catch(v){console.error("Error fetching basic info:",v),E("Failed to load basic project information.")}finally{g.value=!1}};return le(()=>p.projectId,async v=>{setTimeout(async()=>{v&&await U()},500)},{immediate:!0}),me(()=>{}),(v,u)=>(l(),n("div",mt,[g.value?(l(),n("div",vt,u[12]||(u[12]=[e("svg",{class:"animate-spin h-8 w-8 text-indigo-500 mx-auto mb-3",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),F(" Loading basic project information... ",-1)]))):(l(),n("div",pt,[e("div",null,[o(A,{for:"name",value:"Project Name"}),o(G,{id:"name",type:"text",class:"mt-1 block w-full rounded-lg shadow-sm",modelValue:a.name,"onUpdate:modelValue":u[0]||(u[0]=s=>a.name=s),required:"",autofocus:"",disabled:!t.canManageProjects||f.value||t.isSaving},null,8,["modelValue","disabled"]),o(R,{message:t.errors.name?t.errors.name[0]:"",class:"mt-2"},null,8,["message"])]),e("div",null,[o(A,{for:"website",value:"Website"}),o(G,{id:"website",type:"url",class:"mt-1 block w-full rounded-lg shadow-sm",modelValue:a.website,"onUpdate:modelValue":u[1]||(u[1]=s=>a.website=s),disabled:!t.canManageProjects||f.value||t.isSaving},null,8,["modelValue","disabled"]),o(R,{message:t.errors.website?t.errors.website[0]:"",class:"mt-2"},null,8,["message"])]),e("div",null,[o(A,{for:"social_media_link",value:"Social Media Link"}),o(G,{id:"social_media_link",type:"url",class:"mt-1 block w-full rounded-lg shadow-sm",modelValue:a.social_media_link,"onUpdate:modelValue":u[2]||(u[2]=s=>a.social_media_link=s),disabled:!t.canManageProjects||f.value||t.isSaving},null,8,["modelValue","disabled"]),o(R,{message:t.errors.social_media_link?t.errors.social_media_link[0]:"",class:"mt-2"},null,8,["message"])]),t.canManageProjectBasicDetails?(l(),n("div",gt,[o(A,{for:"google_chat_id",value:"Google Chat ID"}),o(G,{id:"google_chat_id",type:"text",class:"mt-1 block w-full rounded-lg shadow-sm",modelValue:a.google_chat_id,"onUpdate:modelValue":u[3]||(u[3]=s=>a.google_chat_id=s),disabled:!t.canManageProjects||f.value||t.isSaving},null,8,["modelValue","disabled"]),o(R,{message:t.errors.google_chat_id?t.errors.google_chat_id[0]:"",class:"mt-2"},null,8,["message"])])):x("",!0),t.canManageProjectBasicDetails?(l(),n("div",yt,[o(A,{for:"google_drive_link",value:"Google Drive Link"}),o(G,{id:"google_drive_link",type:"text",class:"mt-1 block w-full rounded-lg shadow-sm",modelValue:a.google_drive_link,"onUpdate:modelValue":u[4]||(u[4]=s=>a.google_drive_link=s),disabled:!t.canManageProjects||f.value||t.isSaving},null,8,["modelValue","disabled"]),o(R,{message:t.errors.google_drive_link?t.errors.google_drive_link[0]:"",class:"mt-2"},null,8,["message"])])):x("",!0),e("div",null,[o(A,{for:"status",value:"Status"}),o(se,{id:"status",modelValue:a.status,"onUpdate:modelValue":u[5]||(u[5]=s=>a.status=s),options:t.statusOptions,valueKey:"value",labelKey:"label",placeholder:"Select Project Status",disabled:!t.canManageProjects||f.value||t.isSaving,required:!0,class:"mt-1 block w-full"},null,8,["modelValue","options","disabled"]),o(R,{message:t.errors.status?t.errors.status[0]:"",class:"mt-2"},null,8,["message"])]),e("div",null,[o(lt,{id:"project_type",modelValue:a.project_type,"onUpdate:modelValue":u[6]||(u[6]=s=>a.project_type=s),disabled:!t.canManageProjects||f.value||t.isSaving,class:"mt-1 block w-full"},null,8,["modelValue","disabled"]),o(R,{message:t.errors.project_type?t.errors.project_type[0]:"",class:"mt-2"},null,8,["message"])]),e("div",null,[o(A,{for:"source",value:"Source"}),o(se,{id:"source",modelValue:a.source,"onUpdate:modelValue":u[7]||(u[7]=s=>a.source=s),options:t.sourceOptions,valueKey:"value",labelKey:"label",placeholder:"Select a Source",disabled:!t.canManageProjects||f.value||t.isSaving,class:"mt-1 block w-full"},null,8,["modelValue","options","disabled"]),o(R,{message:t.errors.source?t.errors.source[0]:"",class:"mt-2"},null,8,["message"])]),e("div",null,[o(ot,{id:"timezone",modelValue:a.timezone,"onUpdate:modelValue":u[8]||(u[8]=s=>a.timezone=s),disabled:!t.canManageProjects||f.value||t.isSaving,class:"mt-1 block w-full"},null,8,["modelValue","disabled"]),o(R,{message:t.errors.timezone?t.errors.timezone[0]:"",class:"mt-2"},null,8,["message"])]),t.canManageProjectBasicDetails?(l(),n("div",ft,[o(A,{for:"logo",value:"Project Logo"}),e("input",{type:"file",id:"logo",onChange:$,class:"mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100 cursor-pointer",accept:"image/*",disabled:!t.canManageProjectBasicDetails||f.value||t.isSaving},null,40,bt),a.logo&&typeof a.logo=="string"?(l(),n("div",ht,[u[13]||(u[13]=e("p",{class:"text-sm text-gray-600"},"Current Logo:",-1)),e("img",{src:a.logo,alt:"Project Logo",class:"h-20 w-20 object-contain rounded-lg shadow-md border border-gray-200"},null,8,wt)])):x("",!0),o(R,{message:t.errors.logo?t.errors.logo[0]:"",class:"mt-2"},null,8,["message"])])):x("",!0)])),e("div",xt,[o(A,{for:"description",value:"Description"}),ge(e("textarea",{id:"description",class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-lg shadow-sm mt-1 block w-full","onUpdate:modelValue":u[9]||(u[9]=s=>a.description=s),disabled:!t.canManageProjects||f.value||t.isSaving,rows:"4"},null,8,kt),[[ke,a.description]]),o(R,{message:t.errors.description?t.errors.description[0]:"",class:"mt-2"},null,8,["message"])]),e("div",jt,[o(A,{for:"preferred_keywords",value:"Client Preferred Keywords"}),o(G,{id:"preferred_keywords",type:"text",class:"mt-1 block w-full rounded-lg shadow-sm",modelValue:a.preferred_keywords,"onUpdate:modelValue":u[10]||(u[10]=s=>a.preferred_keywords=s),disabled:!t.canManageProjects||f.value||t.isSaving},null,8,["modelValue","disabled"]),o(R,{message:t.errors.preferred_keywords?t.errors.preferred_keywords[0]:"",class:"mt-2"},null,8,["message"])]),e("div",_t,[o(st,{modelValue:a.tags,"onUpdate:modelValue":u[11]||(u[11]=s=>a.tags=s),initialTags:a.tags_data,label:"Associated Tags",placeholder:"Search or add tags",error:t.errors.tags?t.errors.tags[0]:"",disabled:!t.canManageProjects||f.value||t.isSaving},null,8,["modelValue","initialTags","error","disabled"])]),e("div",Pt,[t.canManageProjectBasicDetails?(l(),Q(ee,{key:0,onClick:B,disabled:!t.canManageProjects||f.value||t.isSaving,class:Y([{"opacity-50 cursor-not-allowed":f.value||t.isSaving},"px-6 py-2 rounded-lg text-base shadow-md hover:shadow-lg transition-all"])},{default:H(()=>[f.value||t.isSaving?(l(),n("span",$t,u[14]||(u[14]=[e("svg",{class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),F(" Updating... ",-1)]))):(l(),n("span",St," Update Basic Information "))]),_:1},8,["disabled","class"])):x("",!0)])]))}},Ct={class:"mb-4"},It={class:"mt-2"},Dt={key:0,class:"text-gray-500 text-sm mb-2"},Ut={class:"mb-4"},Mt={key:1,class:"space-y-3"},At={class:"flex-grow text-gray-800 font-medium"},Nt={class:"text-gray-600 text-sm"},Bt={class:"flex items-center space-x-2"},Tt=["onClick"],Ot={key:2,class:"p-4 bg-gray-50 rounded-lg text-gray-600 text-center border border-dashed border-gray-200"},Ae={__name:"MultiSelectWithRoles",props:{label:{type:String,required:!0},items:{type:Array,default:()=>[]},endpoint:{type:String,default:""},selectedItems:{type:Array,default:()=>[]},itemText:{type:String,default:"name"},itemSubtext:{type:String,default:"email"},itemValue:{type:String,default:"id"},roleOptions:{type:Array,default:()=>[]},roleType:{type:String,default:"application"},defaultRoleId:{type:Number,default:null},error:{type:String,default:""},placeholder:{type:String,default:"Select an item"},showRemoveButton:{type:Boolean,default:!0},disabled:{type:Boolean,default:!1}},emits:["update:selectedItems"],setup(t,{emit:p}){const a=t,f=p,g=P([]),$=P([]),B=P([]),U=P([]),v=P(!1),u=async()=>{if(!(a.roleOptions.length>0))try{const b=(await re.get(`/api/roles?type=${a.roleType}`)).data;B.value=b.map(c=>({value:c.id,label:c.name}))}catch(h){console.error("Error fetching roles:",h)}},s=K(()=>B.value.length>0?B.value:a.roleOptions),i=()=>a.defaultRoleId?a.defaultRoleId:s.value.length>0?s.value[0].value:1,j=()=>{g.value=[],$.value=[],!(!a.selectedItems||a.selectedItems.length===0)&&a.selectedItems.forEach(h=>{const b=typeof h=="object"?h[a.itemValue]:h,c=typeof h=="object"&&h.role_id!==void 0?h.role_id:i();if(!g.value.includes(b))g.value.push(b),$.value.push({id:b,role_id:c});else{const C=$.value.find(z=>z.id===b);C&&C.role_id!==c&&(C.role_id=c)}})};le(()=>a.selectedItems,(h,b)=>{JSON.stringify(h)!==JSON.stringify(b)&&j()},{deep:!0,immediate:!0}),le($,h=>{f("update:selectedItems",h)},{deep:!0});const k=h=>{a.disabled||h&&!g.value.includes(h)&&(g.value.push(h),$.value.push({id:h,role_id:i()}))},N=h=>{a.disabled||(g.value=g.value.filter(b=>b!==h),$.value=$.value.filter(b=>b.id!==h))},W=(h,b)=>{if(a.disabled)return;const c=$.value.find(C=>C.id===h);c&&(c.role_id=parseInt(b))},J=h=>O.value.find(b=>b[a.itemValue]===h),Z=h=>{const b=$.value.find(c=>c.id===h);return b?b.role_id:i()},T=async()=>{if(a.endpoint){v.value=!0;try{const h=await re.get(a.endpoint);h.data&&Array.isArray(h.data)?U.value=h.data:h.data&&h.data.data&&Array.isArray(h.data.data)&&(U.value=h.data.data)}catch(h){console.error("Error fetching items from endpoint:",h)}finally{v.value=!1}}},O=K(()=>a.endpoint&&U.value.length>0?U.value:a.items),ne=K(()=>O.value.filter(h=>!g.value.includes(h[a.itemValue])).map(h=>({value:h[a.itemValue],label:`${h[a.itemText]} (${h[a.itemSubtext]})`})));return me(()=>{u(),a.endpoint&&T()}),(h,b)=>(l(),n("div",Ct,[o(A,{value:t.label},null,8,["value"]),e("div",It,[v.value?(l(),n("div",Dt,"Loading available items...")):x("",!0),e("div",Ut,[o(se,{modelValue:h.selectedItemToAdd,"onUpdate:modelValue":b[0]||(b[0]=c=>h.selectedItemToAdd=c),options:ne.value,valueKey:"value",labelKey:"label",placeholder:t.placeholder,disabled:v.value||t.disabled,onChange:k,class:"w-full"},null,8,["modelValue","options","placeholder","disabled"])]),g.value.length>0?(l(),n("div",Mt,[(l(!0),n(ie,null,de(g.value,c=>{var C,z;return l(),n("div",{key:c,class:"flex items-center p-3 border border-gray-200 rounded-lg bg-gray-50 shadow-sm"},[e("div",At,[F(V((C=J(c))==null?void 0:C[t.itemText])+" ",1),e("span",Nt,"("+V((z=J(c))==null?void 0:z[t.itemSubtext])+")",1)]),e("div",Bt,[o(se,{modelValue:Z(c),"onUpdate:modelValue":w=>W(c,w),options:s.value,valueKey:"value",labelKey:"label",placeholder:"Select Role",disabled:t.disabled,class:"w-32"},null,8,["modelValue","onUpdate:modelValue","options","disabled"]),t.showRemoveButton&&!t.disabled?(l(),n("button",{key:0,type:"button",class:"text-red-500 hover:text-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 rounded-full p-1 transition-colors duration-200",onClick:w=>N(c),"aria-label":"Remove item"},b[1]||(b[1]=[e("svg",{class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]),8,Tt)):x("",!0)])])}),128))])):(l(),n("div",Ot," No "+V(t.label.toLowerCase())+" selected. ",1))]),o(R,{message:t.error,class:"mt-2"},null,8,["message"])]))}},Rt={class:"space-y-8"},Ft={key:0,class:"bg-gray-50 p-6 rounded-lg shadow-inner border border-gray-200"},Et={key:0,class:"mt-6 flex justify-end"},zt={key:0},Lt={key:1},qt={key:1,class:"mt-3 text-green-600 text-sm flex items-center"},Kt={key:2,class:"mt-3 text-red-600 text-sm flex items-center"},Ht={class:"bg-gray-50 p-6 rounded-lg shadow-inner border border-gray-200"},Gt=["disabled"],Yt={key:1,class:"bg-gray-50 p-6 rounded-lg shadow-inner border border-gray-200"},Wt={key:0,class:"mt-6 flex justify-end"},Jt={key:0},Zt={key:1},Xt={key:1,class:"mt-3 text-green-600 text-sm flex items-center"},Qt={key:2,class:"mt-3 text-red-600 text-sm flex items-center"},ea={__name:"ProjectFormClientsUsers",props:{projectId:{type:[Number,String],required:!0},errors:{type:Object,default:()=>({})},clientRoleOptions:{type:Array,default:()=>[]},userRoleOptions:{type:Array,default:()=>[]},clients:{type:Array,default:()=>[]},users:{type:Array,default:()=>[]},canViewProjectClients:{type:Boolean,default:!1},canManageProjectClients:{type:Boolean,default:!1},canViewProjectUsers:{type:Boolean,default:!1},canManageProjectUsers:{type:Boolean,default:!1},isSaving:{type:Boolean,default:!1}},setup(t){const p=t,a=pe({client_ids:[],user_ids:[],contract_details:""}),f=P(!1),g=P(!1),$=P(""),B=P(!1),U=P(!1),v=P(""),u=async()=>{if(p.projectId)try{const j=await xe(p.projectId,"client",{canViewProjectClients:p.canViewProjectClients,canManageProjectClients:p.canManageProjectClients,canViewProjectUsers:p.canViewProjectUsers,canManageProjectUsers:p.canManageProjectUsers});j&&(a.client_ids=j.clients?j.clients.map(k=>{var N;return{id:k.id,role_id:((N=k.pivot)==null?void 0:N.role_id)||(p.clientRoleOptions.length>0?p.clientRoleOptions[0].value:null)}}):[],a.user_ids=j.users?j.users.map(k=>{var N;return{id:k.id,role_id:((N=k.pivot)==null?void 0:N.role_id)||(p.userRoleOptions.length>0?p.userRoleOptions[0].value:null)}}):[],a.contract_details=j.contract_details||"")}catch(j){console.error("Error fetching clients/users data:",j),E("Failed to load clients and users data.")}};le(()=>p.projectId,async j=>{j&&await u()},{immediate:!0});const s=async()=>{var j,k;if(!p.projectId){E("Project ID is missing. Cannot save clients.");return}if(!a.client_ids||a.client_ids.length===0){E("Please select at least one client to save.");return}f.value=!0,g.value=!1,$.value="";try{await window.axios.post(`/api/projects/${p.projectId}/attach-clients`,{client_ids:a.client_ids}),ae("Clients saved successfully!"),g.value=!0,await u()}catch(N){console.error("Error saving clients:",N),$.value=((k=(j=N.response)==null?void 0:j.data)==null?void 0:k.message)||"Failed to save clients.",E($.value)}finally{f.value=!1,setTimeout(()=>g.value=!1,3e3)}},i=async()=>{var j,k;if(!p.projectId){E("Project ID is missing. Cannot save users.");return}if(!a.user_ids||a.user_ids.length===0){E("Please select at least one user to save.");return}B.value=!0,U.value=!1,v.value="";try{await window.axios.post(`/api/projects/${p.projectId}/attach-users`,{user_ids:a.user_ids}),ae("Users saved successfully!"),U.value=!0,await u()}catch(N){console.error("Error saving users:",N),v.value=((k=(j=N.response)==null?void 0:j.data)==null?void 0:k.message)||"Failed to save users.",E(v.value)}finally{B.value=!1,setTimeout(()=>U.value=!1,3e3)}};return me(()=>{}),(j,k)=>(l(),n("div",Rt,[t.canViewProjectClients?(l(),n("div",Ft,[k[5]||(k[5]=e("h3",{class:"text-xl font-semibold text-gray-800 mb-5"},"Project Clients",-1)),o(Ae,{label:"Select Clients",items:t.clients,selectedItems:a.client_ids,"onUpdate:selectedItems":k[0]||(k[0]=N=>a.client_ids=N),roleOptions:t.clientRoleOptions,roleType:"client",error:t.errors.client_ids?t.errors.client_ids[0]:"",placeholder:"Search and select clients to add",disabled:!t.canManageProjectClients||t.isSaving||f.value,readonly:!t.canManageProjectClients&&t.canViewProjectClients,showRemoveButton:t.canManageProjectClients,class:"mb-4"},null,8,["items","selectedItems","roleOptions","error","disabled","readonly","showRemoveButton"]),t.canManageProjectClients?(l(),n("div",Et,[o(ee,{onClick:s,disabled:f.value||t.isSaving,class:"px-6 py-3 rounded-lg text-lg shadow-md hover:shadow-lg transition-all duration-200"},{default:H(()=>[f.value?(l(),n("span",zt,"Saving Clients...")):(l(),n("span",Lt,"Save Clients"))]),_:1},8,["disabled"])])):x("",!0),g.value?(l(),n("div",qt,k[3]||(k[3]=[e("svg",{class:"h-5 w-5 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1),F(" Clients saved successfully! ",-1)]))):x("",!0),$.value?(l(),n("div",Kt,[k[4]||(k[4]=e("svg",{class:"h-5 w-5 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),F(" "+V($.value),1)])):x("",!0)])):x("",!0),e("div",Ht,[k[6]||(k[6]=e("h3",{class:"text-xl font-semibold text-gray-800 mb-5"},"Contract Information",-1)),o(A,{for:"contract_details",value:"Contract Details",class:"mb-1"}),ge(e("textarea",{id:"contract_details",class:"block w-full px-4 py-2 border-gray-300 rounded-lg shadow-sm focus:border-indigo-500 focus:ring-indigo-500 transition-colors duration-200 resize-y min-h-[120px]","onUpdate:modelValue":k[1]||(k[1]=N=>a.contract_details=N),disabled:!t.canManageProjectClients||t.isSaving,placeholder:"Enter contract terms, agreements, or important notes about the client relationship."},null,8,Gt),[[ke,a.contract_details]]),o(R,{message:t.errors.contract_details?t.errors.contract_details[0]:"",class:"mt-2"},null,8,["message"])]),t.canViewProjectUsers?(l(),n("div",Yt,[k[9]||(k[9]=e("h3",{class:"text-xl font-semibold text-gray-800 mb-5"},"Assign Project Users",-1)),o(Ae,{label:"Assign Users",items:t.users,selectedItems:a.user_ids,"onUpdate:selectedItems":k[2]||(k[2]=N=>a.user_ids=N),roleOptions:t.userRoleOptions,roleType:"project",defaultRoleId:2,error:t.errors.user_ids?t.errors.user_ids[0]:"",placeholder:"Search and assign users to this project",disabled:!t.canManageProjectUsers||t.isSaving||B.value,readonly:!t.canManageProjectUsers&&t.canViewProjectUsers,showRemoveButton:t.canManageProjectUsers,class:"mb-4"},null,8,["items","selectedItems","roleOptions","error","disabled","readonly","showRemoveButton"]),t.canManageProjectUsers?(l(),n("div",Wt,[o(ee,{onClick:i,disabled:B.value||t.isSaving,class:"px-6 py-3 rounded-lg text-lg shadow-md hover:shadow-lg transition-all duration-200"},{default:H(()=>[B.value?(l(),n("span",Jt,"Saving Users...")):(l(),n("span",Zt,"Save Users"))]),_:1},8,["disabled"])])):x("",!0),U.value?(l(),n("div",Xt,k[7]||(k[7]=[e("svg",{class:"h-5 w-5 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1),F(" Users saved successfully! ",-1)]))):x("",!0),v.value?(l(),n("div",Qt,[k[8]||(k[8]=e("svg",{class:"h-5 w-5 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),F(" "+V(v.value),1)])):x("",!0)])):x("",!0)]))}},ta={class:"space-y-6"},aa={key:0,class:"bg-gray-50 p-6 rounded-lg shadow-inner border border-gray-200"},sa={class:"mt-6"},la={key:0},oa={key:1},na={key:0,class:"text-sm text-red-500 mt-3"},ra={key:1,class:"mt-8 bg-white p-6 rounded-lg shadow-md border border-gray-200"},ia={class:"space-y-3"},da={class:"flex items-center"},ua={class:"mr-3 text-indigo-500"},ca={key:0,class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},ma={key:1,class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},va={key:2,class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},pa={key:3,class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},ga=["href"],ya={key:1,class:"text-gray-700 font-medium break-all mr-4"},fa=["onClick","disabled"],ba={key:2,class:"p-6 bg-gray-50 rounded-lg text-gray-600 text-center border border-gray-200 shadow-sm"},ha={__name:"ProjectFormDocuments",props:{projectId:{type:[Number,String],required:!0},errors:{type:Object,default:()=>({})},canUploadProjectDocuments:{type:Boolean,default:!1},canViewProjectDocuments:{type:Boolean,default:!1},isSaving:{type:Boolean,default:!1}},setup(t){const p=t,a=pe({documents:[]}),f=P(null),g=P(!1),$=async()=>{if(p.projectId)try{const u=await xe(p.projectId,"documents",{canViewProjectDocuments:p.canViewProjectDocuments});u&&(a.documents=u||[])}catch(u){console.error("Error fetching documents data:",u),E("Failed to load documents data.")}};le(()=>p.projectId,async u=>{u&&await $()},{immediate:!0});const B=u=>{const s=Array.from(u.target.files);if(s.length>0){const i=Array.isArray(a.documents)?a.documents.filter(j=>typeof j=="object"&&"path"in j):[];a.documents=[...i,...s]}},U=async()=>{if(!p.projectId){E("Project ID is missing. Cannot upload documents.");return}const u=a.documents.filter(s=>s&&typeof s=="object"&&"name"in s&&"size"in s&&"type"in s);if(!u||u.length===0){E("Please select documents to upload.");return}g.value=!0;try{const s=new FormData;u.forEach((j,k)=>{s.append(`documents[${k}]`,j)});const i=await window.axios.post(`/api/projects/${p.projectId}/documents`,s,{headers:{"Content-Type":"multipart/form-data"}});a.documents=i.data.documents||[],ae("Documents uploaded successfully!"),await $()}catch(s){E("Failed to upload documents."),console.error("Error uploading documents:",s)}finally{g.value=!1,f.value&&(f.value.value="")}},v=u=>{a.documents=a.documents.filter((s,i)=>i!==u)};return me(()=>{}),(u,s)=>(l(),n("div",ta,[t.canUploadProjectDocuments?(l(),n("div",aa,[o(A,{for:"documents-upload",value:"Upload New Documents",class:"mb-2 text-lg"}),e("input",{type:"file",id:"documents-upload",ref_key:"documentFileInput",ref:f,onChange:B,class:"mt-2 block w-full text-sm text-gray-600 file:mr-4 file:py-2.5 file:px-5 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100 transition-colors duration-200 cursor-pointer",multiple:"",accept:".pdf,.doc,.docx,.jpg,.jpeg,.png,.gif"},null,544),s[0]||(s[0]=e("p",{class:"text-sm text-gray-500 mt-2"},"Supported formats: PDF, DOC, DOCX, JPG, JPEG, PNG, GIF. Max file size: 5MB.",-1)),o(R,{message:t.errors.documents?t.errors.documents[0]:"",class:"mt-2"},null,8,["message"]),e("div",sa,[o(ee,{type:"button",onClick:U,disabled:!t.projectId||!a.documents||!a.documents.some(i=>i&&typeof i=="object"&&"name"in i&&"size"in i&&"type"in i)||g.value||t.isSaving,class:"px-6 py-3 rounded-lg text-lg shadow-md hover:shadow-lg transition-all duration-200"},{default:H(()=>[g.value?(l(),n("span",la,"Uploading...")):(l(),n("span",oa,"Upload Selected Documents"))]),_:1},8,["disabled"]),t.projectId?x("",!0):(l(),n("p",na," Please save the project first before uploading documents. "))])])):x("",!0),t.canViewProjectDocuments&&a.documents&&a.documents.length>0?(l(),n("div",ra,[s[7]||(s[7]=e("h3",{class:"text-xl font-semibold text-gray-800 mb-5"},"Existing Project Documents",-1)),e("ul",ia,[(l(!0),n(ie,null,de(a.documents,(i,j)=>(l(),n("li",{key:j,class:"flex items-center justify-between p-4 bg-gray-50 rounded-md border border-gray-100 shadow-sm transition-shadow hover:shadow-md duration-200"},[e("div",da,[e("span",ua,[typeof i=="object"&&"type"in i&&i.type.includes("image")?(l(),n("svg",ca,s[1]||(s[1]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 002.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"},null,-1)]))):typeof i=="object"&&"type"in i&&i.type.includes("pdf")?(l(),n("svg",ma,s[2]||(s[2]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"},null,-1)]))):typeof i=="object"&&"type"in i&&(i.type.includes("word")||i.type.includes("document"))?(l(),n("svg",va,s[3]||(s[3]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"},null,-1)]))):(l(),n("svg",pa,s[4]||(s[4]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"},null,-1)])))]),typeof i=="object"&&"path"in i?(l(),n("a",{key:0,href:`/storage/${i.path}`,target:"_blank",class:"text-blue-600 hover:text-blue-800 hover:underline font-medium break-all mr-4"},V(i.filename),9,ga)):(l(),n("span",ya,[F(V(i.name)+" ",1),s[5]||(s[5]=e("span",{class:"text-gray-500 text-sm"},"(Pending Upload)",-1))]))]),t.canUploadProjectDocuments?(l(),n("button",{key:0,type:"button",onClick:k=>v(j),class:"p-2 rounded-full text-red-500 hover:bg-red-100 hover:text-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 transition-colors duration-200",title:"Remove document",disabled:g.value||t.isSaving},s[6]||(s[6]=[e("svg",{class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]),8,fa)):x("",!0)]))),128))])])):t.canViewProjectDocuments?(l(),n("div",ba," No documents found for this project. ")):x("",!0),s[8]||(s[8]=e("div",{class:"mt-6 p-4 bg-blue-50 rounded-lg text-blue-700 text-sm border border-blue-200"},[e("p",null,"Note: Uploaded documents will be stored in the project's designated Google Drive folder.")],-1))]))}},wa={class:"p-6 bg-white rounded-lg font-inter"},xa={key:0,class:"p-6 bg-gray-50 rounded-lg text-gray-600 text-center border border-gray-200 shadow-sm"},ka={key:1},ja={class:"mb-6 flex justify-between items-center"},_a={key:0,class:"flex items-center"},Pa={key:1},$a={key:0,class:"text-sm text-red-500 mb-4 bg-red-50 p-3 rounded-md border border-red-200"},Sa={key:1,class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6"},Va={class:"flex justify-between items-start mb-3"},Ca=["onClick","disabled"],Ia=["onUpdate:modelValue","readonly"],Da={class:"mt-auto pt-3 border-t border-gray-100 text-xs text-gray-500 flex justify-between items-center"},Ua={class:"font-medium text-gray-700"},Ma={key:2,class:"p-8 bg-gray-50 rounded-lg text-gray-600 text-center border border-gray-200 shadow-sm flex flex-col items-center justify-center h-64"},Aa={__name:"ProjectFormNotes",props:{projectId:{type:[Number,String],required:!0},errors:{type:Object,default:()=>({})},canAddProjectNotes:{type:Boolean,default:!1},canViewProjectNotes:{type:Boolean,default:!1},isSaving:{type:Boolean,default:!1}},setup(t){const p=t,a=pe({notes:[]}),f=P(!1),g=async()=>{if(p.projectId)try{const u=await xe(p.projectId,"notes",{canViewProjectNotes:p.canViewProjectNotes,canAddProjectNotes:p.canAddProjectNotes});u&&(a.notes=u.map(s=>{var i,j;return{id:s.id,content:s.content,created_at:s.created_at,creator_name:s.creator_name||((i=s.user)==null?void 0:i.name)||((j=s.creator)==null?void 0:j.name)||"Unknown"}})||[])}catch(u){console.error("Error fetching notes data:",u),E("Failed to load notes data.")}};le(()=>p.projectId,async u=>{u&&await g()},{immediate:!0});const $=()=>{p.canAddProjectNotes&&a.notes.push({id:null,content:"",created_at:new Date().toISOString(),creator_name:"You"})},B=u=>{p.canAddProjectNotes&&a.notes.splice(u,1)},U=async()=>{if(!p.projectId){E("Project ID is missing. Cannot save notes.");return}f.value=!0;const u=a.notes.map(s=>({id:s.id||null,content:s.content}));try{const s=await window.axios.put(`/api/projects/${p.projectId}/sections/notes?type=private`,{notes:u});a.notes=s.data.notes.map(i=>{var j,k;return{id:i.id,content:i.content,created_at:i.created_at,creator_name:i.creator_name||((j=i.user)==null?void 0:j.name)||((k=i.creator)==null?void 0:k.name)||"Unknown"}})||[],ae("Notes updated successfully!"),await g()}catch(s){console.error("Error updating notes:",s),E("Failed to update notes.")}finally{f.value=!1}},v=u=>u?new Date(u).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A";return me(()=>{}),(u,s)=>(l(),n("div",wa,[t.canViewProjectNotes?(l(),n("div",ka,[e("div",ja,[o(ee,{onClick:$,type:"button",class:"px-5 py-2.5 rounded-lg text-base shadow-sm hover:shadow-md transition-all duration-200",disabled:!t.canAddProjectNotes||f.value||t.isSaving},{default:H(()=>s[0]||(s[0]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 4v16m8-8H4"})],-1),F(" Add New Note ",-1)])),_:1,__:[0]},8,["disabled"]),o(ee,{onClick:U,disabled:!t.projectId||!t.canAddProjectNotes||f.value||t.isSaving,class:Y([{"opacity-50 cursor-not-allowed":f.value||t.isSaving},"px-6 py-3 rounded-lg text-lg shadow-md hover:shadow-lg transition-all duration-200"])},{default:H(()=>[f.value||t.isSaving?(l(),n("span",_a,s[1]||(s[1]=[e("svg",{class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),F(" Saving... ",-1)]))):(l(),n("span",Pa,"Save All Notes"))]),_:1},8,["disabled","class"])]),t.projectId?x("",!0):(l(),n("p",$a," Please save the project first before adding or editing notes. ")),a.notes&&a.notes.length>0?(l(),n("div",Sa,[(l(!0),n(ie,null,de(a.notes,(i,j)=>(l(),n("div",{key:i.id||`new-note-${j}`,class:Y(["relative bg-white p-5 rounded-lg shadow-md border border-gray-200 flex flex-col h-64 transition-all duration-200 ease-in-out hover:shadow-lg",{"opacity-75 cursor-not-allowed":!t.canAddProjectNotes||f.value||t.isSaving}])},[e("div",Va,[o(A,{value:`Note ${j+1}`,class:"text-sm font-semibold text-gray-700"},null,8,["value"]),t.canAddProjectNotes?(l(),n("button",{key:0,type:"button",onClick:k=>B(j),class:"p-1 rounded-full text-red-500 hover:bg-red-100 hover:text-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 transition-colors duration-200",title:"Remove note",disabled:f.value||t.isSaving},s[2]||(s[2]=[e("svg",{class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1)]),8,Ca)):x("",!0)]),ge(e("textarea",{"onUpdate:modelValue":k=>i.content=k,readonly:!t.canAddProjectNotes||f.value||t.isSaving,placeholder:"Type your note content here...",class:"flex-grow border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-lg shadow-sm block w-full resize-none transition-colors duration-200 p-3 text-sm overflow-auto",rows:"6"},null,8,Ia),[[ke,i.content]]),o(R,{message:t.errors[`notes.${j}.content`]?t.errors[`notes.${j}.content`][0]:"",class:"mt-2"},null,8,["message"]),e("div",Da,[e("span",null,[s[3]||(s[3]=F("By: ",-1)),e("span",Ua,V(i.creator_name||"Unknown"),1)]),e("span",null,"Last updated: "+V(v(i.created_at)),1)])],2))),128))])):(l(),n("div",Ma,s[4]||(s[4]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-16 w-16 text-gray-400 mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"1"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1),e("p",{class:"text-lg font-medium"},"No notes found for this project.",-1),e("p",{class:"text-sm mt-2"},'Click "Add New Note" to start creating your project notes.',-1)])))])):(l(),n("div",xa," You do not have permission to view project notes. "))]))}},Na=["value","rows"],Ba={__name:"TextareaInput",props:{modelValue:[String,Number],rows:{type:[String,Number],default:3}},emits:["update:modelValue"],setup(t){const p=P(null);return me(()=>{p.value.hasAttribute("autofocus")&&p.value.focus()}),(a,f)=>(l(),n("textarea",{class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full",value:t.modelValue,rows:t.rows,onInput:f[0]||(f[0]=g=>a.$emit("update:modelValue",g.target.value)),ref_key:"input",ref:p},null,40,Na))}};function Ta(t,p){return l(),n("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"fill-rule":"evenodd",d:"M8.75 1A2.75 2.75 0 0 0 6 3.75v.443c-.795.077-1.584.176-2.365.298a.75.75 0 1 0 .23 1.482l.149-.022.841 10.518A2.75 2.75 0 0 0 7.596 19h4.807a2.75 2.75 0 0 0 2.742-2.53l.841-10.52.149.023a.75.75 0 0 0 .23-1.482A41.03 41.03 0 0 0 14 4.193V3.75A2.75 2.75 0 0 0 11.25 1h-2.5ZM10 4c.84 0 1.673.025 2.5.075V3.75c0-.69-.56-1.25-1.25-1.25h-2.5c-.69 0-1.25.56-1.25 1.25v.325C8.327 4.025 9.16 4 10 4ZM8.58 7.72a.75.75 0 0 0-1.5.06l.3 7.5a.75.75 0 1 0 1.5-.06l-.3-7.5Zm4.34.06a.75.75 0 1 0-1.5-.06l-.3 7.5a.75.75 0 1 0 1.5.06l.3-7.5Z","clip-rule":"evenodd"})])}const Oa={class:"p-6 bg-gray-50 rounded-xl shadow-lg"},Ra={class:"flex justify-between items-center mb-6"},Fa={key:0,class:"flex justify-center py-8"},Ea={key:1,class:"bg-white p-8 rounded-lg text-center border border-dashed border-gray-300"},za={key:2,class:"space-y-6"},La={class:"flex justify-between items-start"},qa={class:"text-xl font-medium text-gray-900"},Ka={class:"mt-2 flex items-center flex-wrap space-x-4 text-sm text-gray-500"},Ha={key:0,class:"text-gray-700"},Ga={key:1,class:"text-gray-700"},Ya={key:0,class:"mt-4 text-base text-gray-600"},Wa={key:1,class:"mt-4 p-3 bg-gray-100 rounded-lg text-sm text-gray-700 border border-gray-200"},Ja={class:"space-y-1"},Za=["checked","onChange"],Xa={key:0,class:"flex space-x-2"},Qa={class:"p-6 bg-white rounded-lg"},es={class:"text-2xl font-bold text-gray-900 mb-6"},ts={class:"p-4 bg-indigo-50 rounded-lg border border-indigo-200"},as={class:"mt-4"},ss={class:"space-y-2"},ls={class:"flex justify-end space-x-3 mt-6"},os={__name:"ProjectDeliverables",props:{projectId:{type:[Number,String],required:!0},errors:{type:Object,default:()=>({})},isSaving:{type:Boolean,default:!1},canManageProjectDeliverables:{type:Boolean,default:!1},canViewProjectDeliverables:{type:Boolean,default:!0}},setup(t){const p=t,a=P([]),f=P([]),g=P(!0),$=P([]),B=P(!1),U=P("create"),v=P({id:null,name:"",description:"",milestone_id:null,status:"pending",due_date:"",details:{deliverable_type_key:null,checklist:[]}}),u=P({}),s=P([]),i=[{value:"pending",label:"Pending"},{value:"in_progress",label:"In Progress"},{value:"completed",label:"Completed"},{value:"cancelled",label:"Cancelled"}],j=K(()=>{const b=f.value.find(c=>{var C;return c.key===((C=v.value.details)==null?void 0:C.deliverable_type_key)});return(b==null?void 0:b.checklistItemPlaceholder)||"e.g., Task 1, Task 2, Task 3"});le(()=>p.projectId,k,{immediate:!0});async function k(){if(p.projectId){g.value=!0;try{const b=await re.get(`/api/projects/${p.projectId}/project-deliverables`);a.value=b.data;const c=await re.get(`/api/projects/${p.projectId}/milestones`);$.value=c.data;const C=await re.get("/api/project-deliverable-types");f.value=C.data}catch(b){console.error("Error fetching data:",b),E("Failed to load project data")}finally{g.value=!1}}}function N(){U.value="create",v.value={id:null,name:"",description:"",milestone_id:null,status:"pending",due_date:"",details:{deliverable_type_key:null,checklist:[{name:"",completed:!1}]}},u.value={},B.value=!0}function W(b){U.value="edit",v.value=JSON.parse(JSON.stringify(b)),v.value.details.checklist||(v.value.details.checklist=[]),(v.value.details.checklist.length===0||v.value.details.checklist[v.value.details.checklist.length-1].name!=="")&&v.value.details.checklist.push({name:"",completed:!1}),u.value={},B.value=!0}function J(b){v.value.details.checklist.splice(b,1)}function Z(b){b===v.value.details.checklist.length-1&&v.value.details.checklist.push({name:"",completed:!1})}async function T(){u.value={};try{let b;const c=v.value.details.checklist.filter(z=>z.name.trim()!==""),C={...v.value,details:{...v.value.details,checklist:c}};U.value==="create"?(b=await re.post(`/api/projects/${p.projectId}/project-deliverables`,C),ae("Project deliverable created successfully")):(b=await re.put(`/api/project-deliverables/${v.value.id}`,C),ae("Project deliverable updated successfully")),await k(),B.value=!1}catch(b){console.error("Error saving deliverable:",b),b.response&&b.response.data&&b.response.data.errors?u.value=b.response.data.errors:E("Failed to save project deliverable")}}async function O(b,c){const C=!b.details.checklist[c].completed;b.details.checklist[c].completed=C;try{const z={...b,details:b.details};await re.put(`/api/project-deliverables/${b.id}`,z),ae("Checklist item updated!")}catch(z){console.error("Error updating checklist item:",z),E("Failed to update checklist item"),b.details.checklist[c].completed=!C}}async function ne(b){if(confirm("Are you sure you want to delete this deliverable?"))try{await re.delete(`/api/project-deliverables/${b}`),ae("Project deliverable deleted successfully"),await k()}catch(c){console.error("Error deleting deliverable:",c),E("Failed to delete project deliverable")}}function h(b){return b?new Date(b).toLocaleDateString():"N/A"}return(b,c)=>(l(),n("div",Oa,[e("div",Ra,[c[10]||(c[10]=e("h3",{class:"text-2xl font-bold text-gray-900"},"Project Deliverables",-1)),t.canManageProjectDeliverables?(l(),Q(ee,{key:0,onClick:N,disabled:t.isSaving||g.value},{default:H(()=>c[9]||(c[9]=[F(" Add Deliverable ",-1)])),_:1,__:[9]},8,["disabled"])):x("",!0)]),g.value?(l(),n("div",Fa,c[11]||(c[11]=[e("div",{class:"animate-spin rounded-full h-10 w-10 border-b-2 border-indigo-600"},null,-1)]))):a.value.length===0?(l(),n("div",Ea,[c[13]||(c[13]=e("p",{class:"text-gray-600 text-lg"},"No deliverables have been added to this project yet.",-1)),t.canManageProjectDeliverables?(l(),Q(ee,{key:0,onClick:N,class:"mt-6"},{default:H(()=>c[12]||(c[12]=[F(" Add Your First Deliverable ",-1)])),_:1,__:[12]})):x("",!0)])):(l(),n("div",za,[(l(!0),n(ie,null,de(a.value,C=>{var z;return l(),n("div",{key:C.id,class:"bg-white border border-gray-200 rounded-xl p-6 shadow-sm hover:shadow-lg transition-all duration-300"},[e("div",La,[e("div",null,[e("h4",qa,V(C.name),1),e("div",Ka,[e("span",{class:Y({"font-medium py-1 px-3 rounded-full text-white":!0,"bg-yellow-500":C.status==="pending","bg-blue-500":C.status==="in_progress","bg-green-500":C.status==="completed","bg-red-500":C.status==="cancelled"})},V(C.status.replace("_"," ").toUpperCase()),3),C.milestone?(l(),n("span",Ha,[c[14]||(c[14]=e("span",{class:"font-semibold"},"Milestone:",-1)),F(" "+V(C.milestone.name),1)])):x("",!0),C.due_date?(l(),n("span",Ga,[c[15]||(c[15]=e("span",{class:"font-semibold"},"Due:",-1)),F(" "+V(h(C.due_date)),1)])):x("",!0)]),C.description?(l(),n("p",Ya,V(C.description),1)):x("",!0),(z=C.details)!=null&&z.checklist&&C.details.checklist.length>0?(l(),n("div",Wa,[c[16]||(c[16]=e("p",{class:"font-semibold text-gray-900 mb-2"},"Checklist:",-1)),e("ul",Ja,[(l(!0),n(ie,null,de(C.details.checklist,(w,d)=>(l(),n("li",{key:d,class:"flex items-center space-x-2"},[e("input",{type:"checkbox",checked:w.completed,onChange:r=>O(C,d),class:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"},null,40,Za),e("span",{class:Y({"line-through text-gray-500":w.completed})},V(w.name),3)]))),128))])])):x("",!0)]),t.canManageProjectDeliverables?(l(),n("div",Xa,[o(be,{onClick:w=>W(C),size:"sm"},{default:H(()=>c[17]||(c[17]=[F(" Edit ",-1)])),_:2,__:[17]},1032,["onClick"]),o(Ie,{onClick:w=>ne(C.id),size:"sm"},{default:H(()=>c[18]||(c[18]=[F(" Delete ",-1)])),_:2,__:[18]},1032,["onClick"])])):x("",!0)])])}),128))])),o(nt,{show:B.value,onClose:c[8]||(c[8]=C=>B.value=!1),maxWidth:"2xl"},{default:H(()=>{var C,z,w,d,r;return[e("div",Qa,[e("h3",es,V(U.value==="create"?"Add New Deliverable":"Edit Deliverable"),1),e("form",{onSubmit:Ve(T,["prevent"]),class:"space-y-6"},[e("div",null,[o(A,{for:"name",value:"Name"}),o(G,{id:"name",modelValue:v.value.name,"onUpdate:modelValue":c[0]||(c[0]=y=>v.value.name=y),type:"text",class:"mt-1 block w-full",required:""},null,8,["modelValue"]),o(R,{message:(C=u.value.name)==null?void 0:C[0],class:"mt-2"},null,8,["message"])]),e("div",null,[o(A,{for:"description",value:"Description"}),o(Ba,{id:"description",modelValue:v.value.description,"onUpdate:modelValue":c[1]||(c[1]=y=>v.value.description=y),class:"mt-1 block w-full",rows:"3"},null,8,["modelValue"]),o(R,{message:(z=u.value.description)==null?void 0:z[0],class:"mt-2"},null,8,["message"])]),e("div",null,[o(A,{for:"milestone_id",value:"Milestone (Optional)"}),o(se,{id:"milestone_id",modelValue:v.value.milestone_id,"onUpdate:modelValue":c[2]||(c[2]=y=>v.value.milestone_id=y),options:$.value,valueKey:"id",labelKey:"name",placeholder:"Select a milestone",class:"mt-1 block w-full"},null,8,["modelValue","options"]),o(R,{message:(w=u.value.milestone_id)==null?void 0:w[0],class:"mt-2"},null,8,["message"])]),e("div",null,[o(A,{for:"status",value:"Status"}),o(se,{id:"status",modelValue:v.value.status,"onUpdate:modelValue":c[3]||(c[3]=y=>v.value.status=y),options:i,valueKey:"value",labelKey:"label",placeholder:"Select a Status",class:"mt-1 block w-full"},null,8,["modelValue"]),o(R,{message:(d=u.value.status)==null?void 0:d[0],class:"mt-2"},null,8,["message"])]),e("div",null,[o(A,{for:"due_date",value:"Due Date (Optional)"}),o(G,{id:"due_date",modelValue:v.value.due_date,"onUpdate:modelValue":c[4]||(c[4]=y=>v.value.due_date=y),type:"date",class:"mt-1 block w-full"},null,8,["modelValue"]),o(R,{message:(r=u.value.due_date)==null?void 0:r[0],class:"mt-2"},null,8,["message"])]),e("div",ts,[c[19]||(c[19]=e("h4",{class:"text-lg font-semibold text-indigo-800 mb-4"},"Deliverable Checklist",-1)),e("div",null,[o(A,{for:"deliverable_type_key",value:"Deliverable Type"}),o(se,{id:"deliverable_type_key",modelValue:v.value.details.deliverable_type_key,"onUpdate:modelValue":[c[5]||(c[5]=y=>v.value.details.deliverable_type_key=y),c[6]||(c[6]=y=>v.value.details={deliverable_type_key:y,checklist:[{name:"",completed:!1}]})],options:f.value,valueKey:"key",labelKey:"name",placeholder:"Select a Deliverable Type",class:"mt-1 block w-full",required:""},null,8,["modelValue","options"])]),e("div",as,[o(A,{value:"Checklist Items"}),e("ul",ss,[(l(!0),n(ie,null,de(v.value.details.checklist,(y,D)=>(l(),n("li",{key:D,class:"flex items-center space-x-2"},[o(G,{modelValue:y.name,"onUpdate:modelValue":M=>y.name=M,type:"text",class:"flex-1",placeholder:D===v.value.details.checklist.length-1?j.value:"",onInput:M=>Z(D),onKeyup:Te(Ve(()=>{D<v.value.details.checklist.length-1&&We(()=>{var M;(M=s.value[D+1])==null||M.focus()})},["prevent"]),["enter"]),ref_for:!0,ref:M=>{M&&(s.value[D]=M)}},null,8,["modelValue","onUpdate:modelValue","placeholder","onInput","onKeyup"]),v.value.details.checklist.length>1?(l(),Q(Ie,{key:0,type:"button",onClick:M=>J(D)},{default:H(()=>[o(I(Ta),{class:"h-4 w-4"})]),_:2},1032,["onClick"])):x("",!0)]))),128))])])]),e("div",ls,[o(be,{onClick:c[7]||(c[7]=y=>B.value=!1),disabled:t.isSaving},{default:H(()=>c[20]||(c[20]=[F(" Cancel ",-1)])),_:1,__:[20]},8,["disabled"]),o(ee,{type:"submit",disabled:t.isSaving},{default:H(()=>[F(V(U.value==="create"?"Create":"Update"),1)]),_:1},8,["disabled"])])],32)])]}),_:1},8,["show"])]))}},ns={class:"p-6 bg-white rounded-lg font-inter"},rs={key:0,class:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4",role:"alert"},is={class:"block sm:inline ml-2"},ds={key:1,class:"flex items-center justify-center py-8"},us={key:2},cs={key:0,class:"bg-gradient-to-r from-blue-500 to-indigo-600 text-white p-6 rounded-lg shadow-md mb-6"},ms={class:"flex items-center justify-between"},vs={class:"text-3xl font-bold mt-1"},ps={class:"text-sm opacity-90 mt-2"},gs={class:"font-semibold"},ys={class:"font-semibold"},fs={key:1,class:"bg-gray-100 text-gray-600 p-4 rounded-lg shadow-sm mb-6 text-center"},bs={class:"bg-gray-50 p-6 rounded-lg shadow-sm mb-6 border border-gray-200"},hs={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},ws=["disabled"],xs=["value"],ks={class:"bg-gray-50 p-6 rounded-lg shadow-sm mb-6 border border-gray-200"},js={class:"mb-4"},_s={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-1 gap-4"},Ps={class:"flex items-center justify-between"},$s=["for"],Ss={class:"ms-2 text-base font-medium text-gray-800"},Vs=["onClick"],Cs={key:0,class:"mt-4 pt-4 border-t border-gray-200"},Is={class:"grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4"},Ds={class:"grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4"},Us=["id","onUpdate:modelValue","disabled"],Ms={key:0,class:"mt-4 p-4 bg-blue-50 rounded-lg border border-blue-200"},As={class:"flex justify-between items-center mb-3"},Ns={class:"space-y-4"},Bs={class:"flex justify-between items-center mb-2"},Ts=["onClick"],Os={class:"grid grid-cols-1 sm:grid-cols-2 gap-4"},Rs=["onClick"],Fs={key:0},Es={class:"mt-6 pt-4 border-t border-gray-200"},zs={key:1,class:"mt-4 flex items-center"},Ls={key:2,class:"mt-6 flex justify-end"},qs={__name:"ServicesAndPaymentForm",props:{projectId:{type:[Number,String],required:!0},paymentTypeOptions:{type:Array,required:!0},canManageProjectServicesAndPayments:{type:Boolean,required:!0},canViewProjectServicesAndPayments:{type:Boolean,required:!0}},emits:["updated"],setup(t,{emit:p}){const a=t,f=p,g=P({}),$=P(!1),B=[{value:"PKR",label:"PKR"},{value:"AUD",label:"AUD"},{value:"INR",label:"INR"},{value:"USD",label:"USD"},{value:"EUR",label:"EUR"},{value:"GBP",label:"GBP"}],v=P([...[{value:"Website Designing",label:"Website Designing"},{value:"SEO",label:"SEO"},{value:"Social Media",label:"Social Media"},{value:"Content Writing",label:"Content Writing"},{value:"Graphic Design",label:"Graphic Design"}]]),u=P(""),s=P(!1),i=pe({services:[],service_details:[],payment_type:"one_off",currency:"AUD"}),j=pe({}),k=K(()=>{let w=0;return i.services.forEach(d=>{const r=h(d);r&&r.amount&&(w+=parseFloat(r.amount))}),w.toFixed(2)}),N=K(()=>{let w=null,d=null;const r=new Date;return r.setHours(0,0,0,0),i.service_details.forEach(y=>{y.frequency==="one_off"&&y.payment_breakdown&&y.payment_breakdown.forEach(D=>{var M;if(D.due_date){const q=new Date(D.due_date);q.setHours(0,0,0,0),q>=r&&(!w||q<w.date)&&(w={date:q,serviceId:y.service_id,paymentLabel:D.label},d=((M=v.value.find(ve=>ve.value===y.service_id))==null?void 0:M.label)||y.service_id)}})}),w?{date:w.date.toLocaleDateString(),serviceLabel:d,paymentLabel:w.paymentLabel}:null}),W=K(()=>{const w=i.services.filter(d=>{const r=h(d);return r&&r.frequency!=="monthly"});return w.length===0?!0:w.every(d=>b(d)===100)}),J=K(()=>!a.projectId||!a.canManageProjectServicesAndPayments||!W.value),Z=()=>{const w=u.value.trim();w&&!v.value.some(d=>d.label.toLowerCase()===w.toLowerCase())&&(v.value.push({value:w,label:w}),u.value="",s.value=!1)},T=async()=>{if(a.projectId){$.value=!0;try{const d=(await window.axios.get(`/api/projects/${a.projectId}/sections/services-payment`)).data;return i.services=d.services||[],i.service_details=d.service_details||[],i.payment_type=d.payment_type||"one_off",i.currency=d.currency||"AUD",i.services.forEach(r=>{v.value.some(y=>y.value===r)||v.value.push({value:r,label:r}),j[r]=!1}),i.service_details.forEach(r=>{if(r.payment_breakdown&&!Array.isArray(r.payment_breakdown)){const y=r.payment_breakdown;r.payment_breakdown=[{label:"First",percentage:parseInt(y.first)||30,due_date:null},{label:"Second",percentage:parseInt(y.second)||30,due_date:null},{label:"Third",percentage:parseInt(y.third)||40,due_date:null}]}else!r.payment_breakdown||r.payment_breakdown.length===0?r.payment_breakdown=[{label:"Payment 1",percentage:100,due_date:null}]:r.payment_breakdown.forEach(y=>{y.due_date===void 0&&(y.due_date=null)})}),d}catch(w){return console.error("Error fetching services and payment data:",w),g.value.general="Failed to fetch services and payment data.",null}finally{$.value=!1}}},O=async()=>{g.value={},$.value=!0;try{const w={services:i.services,service_details:i.service_details,total_amount:parseFloat(k.value),payment_type:i.payment_type,currency:i.currency},d=await window.axios.put(`/api/projects/${a.projectId}/sections/services-payment`,w);ae("Services and payment information updated successfully!"),f("updated")}catch(w){w.response&&w.response.status===422?g.value=w.response.data.errors:w.response&&w.response.data.message?g.value.general=w.response.data.message:(g.value.general="Failed to update services and payment information.",console.error("Error:",w))}finally{$.value=!1}},ne=(w,d)=>{d?(i.service_details.some(r=>r.service_id===w)||i.service_details.push({service_id:w,amount:"",frequency:"one_off",start_date:"",payment_breakdown:[{label:"Payment 1",percentage:100,due_date:null}],currency:i.currency}),j[w]=!0):(i.service_details=i.service_details.filter(r=>r.service_id!==w),j[w]=!1)},h=w=>{let d=i.service_details.find(r=>r.service_id===w);if(!d)d={service_id:w,amount:"",frequency:"one_off",start_date:"",payment_breakdown:[{label:"Payment 1",percentage:100,due_date:null}],currency:i.currency},i.service_details.push(d);else if(d.payment_breakdown&&!Array.isArray(d.payment_breakdown)){const r=d.payment_breakdown;d.payment_breakdown=[{label:"First",percentage:parseInt(r.first)||30,due_date:null},{label:"Second",percentage:parseInt(r.second)||30,due_date:null},{label:"Third",percentage:parseInt(r.third)||40,due_date:null}]}else!d.payment_breakdown||d.payment_breakdown.length===0?d.payment_breakdown=[{label:"Payment 1",percentage:100,due_date:null}]:d.payment_breakdown.forEach(r=>{r.due_date===void 0&&(r.due_date=null)});return d},b=w=>{const d=h(w);return!d.payment_breakdown||!Array.isArray(d.payment_breakdown)?0:d.payment_breakdown.reduce((r,y)=>r+(parseInt(y.percentage)||0),0)},c=w=>{const d=h(w);if(d.payment_breakdown||(d.payment_breakdown=[]),!Array.isArray(d.payment_breakdown)){const D=d.payment_breakdown;d.payment_breakdown=[{label:"First",percentage:parseInt(D.first)||30,due_date:null},{label:"Second",percentage:parseInt(D.second)||30,due_date:null},{label:"Third",percentage:parseInt(D.third)||40,due_date:null}]}const r=d.payment_breakdown.length;let y=0;if(r>0){const D=d.payment_breakdown[r-1];y=Math.floor(D.percentage/2),D.percentage-=y}else y=100;d.payment_breakdown.push({label:`Payment ${r+1}`,percentage:y,due_date:null})},C=(w,d)=>{const r=h(w);if(!r.payment_breakdown||!Array.isArray(r.payment_breakdown)||r.payment_breakdown.length<=1)return;const y=parseInt(r.payment_breakdown[d].percentage)||0;if(r.payment_breakdown.splice(d,1),y>0&&r.payment_breakdown.length>0){const D=d>0&&d<=r.payment_breakdown.length?d-1:0;r.payment_breakdown[D].percentage=(parseInt(r.payment_breakdown[D].percentage)||0)+y}r.payment_breakdown.forEach((D,M)=>{D.label=`Payment ${M+1}`})},z=w=>{j[w]=!j[w]};return le(()=>a.projectId,w=>{w&&T()},{immediate:!0}),(w,d)=>(l(),n("div",ns,[g.value.general?(l(),n("div",rs,[d[6]||(d[6]=e("strong",{class:"font-bold"},"Error!",-1)),e("span",is,V(g.value.general),1)])):x("",!0),$.value?(l(),n("div",ds,d[7]||(d[7]=[e("svg",{class:"animate-spin -ml-1 mr-3 h-8 w-8 text-blue-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),e("span",{class:"text-gray-600"},"Loading services and payment data...",-1)]))):(l(),n("div",us,[N.value?(l(),n("div",cs,[e("div",ms,[e("div",null,[d[10]||(d[10]=e("p",{class:"text-sm opacity-90"},"Next Payment Due",-1)),e("p",vs,V(N.value.date),1),e("p",ps,[d[8]||(d[8]=F(" For: ",-1)),e("span",gs,V(N.value.serviceLabel),1),d[9]||(d[9]=F(" - ",-1)),e("span",ys,V(N.value.paymentLabel),1)])]),d[11]||(d[11]=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-12 w-12 opacity-70",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1))])])):(l(),n("div",fs," No upcoming payment due dates found for one-off services. ")),e("div",bs,[d[13]||(d[13]=e("h4",{class:"text-xl font-semibold text-gray-700 mb-4"},"Overall Project Payment Details",-1)),e("div",hs,[e("div",null,[o(A,{for:"calculated_total_amount",value:"Calculated Total Amount"}),o(G,{id:"calculated_total_amount",type:"text",class:"mt-1 block w-full bg-gray-100 cursor-not-allowed",value:k.value,disabled:""},null,8,["value"]),d[12]||(d[12]=e("p",{class:"text-sm text-gray-500 mt-1"},"This amount is automatically calculated from selected services.",-1))]),e("div",null,[o(A,{for:"payment_type",value:"Payment Type"}),ge(e("select",{id:"payment_type",class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full p-2.5","onUpdate:modelValue":d[0]||(d[0]=r=>i.payment_type=r),required:"",disabled:!t.canManageProjectServicesAndPayments},[(l(!0),n(ie,null,de(t.paymentTypeOptions,r=>(l(),n("option",{key:r.value,value:r.value},V(r.label),9,xs))),128))],8,ws),[[Ce,i.payment_type]]),o(R,{message:g.value.payment_type?g.value.payment_type[0]:"",class:"mt-2"},null,8,["message"])]),e("div",null,[o(A,{for:"overall_currency",value:"Overall Project Currency"}),o(se,{id:"overall_currency",modelValue:i.currency,"onUpdate:modelValue":d[1]||(d[1]=r=>i.currency=r),options:B,"value-key":"value","label-key":"label",class:"w-full mt-1",disabled:!t.canManageProjectServicesAndPayments},null,8,["modelValue","disabled"]),o(R,{message:g.value.currency?g.value.currency[0]:"",class:"mt-2"},null,8,["message"])])])]),e("div",ks,[d[20]||(d[20]=e("h4",{class:"text-xl font-semibold text-gray-700 mb-4"},"Manage Services",-1)),e("div",js,[o(A,{for:"services",value:"Select Services",class:"mb-2"}),e("div",_s,[(l(!0),n(ie,null,de(v.value,r=>(l(),n("div",{key:r.value,class:"bg-white p-4 rounded-lg shadow-sm border border-gray-200"},[e("div",Ps,[e("label",{for:`service_${r.value}`,class:"flex items-center cursor-pointer"},[o(rt,{id:`service_${r.value}`,value:r.value,checked:i.services,"onUpdate:checked":[d[2]||(d[2]=y=>i.services=y),y=>ne(r.value,y)],disabled:!t.canManageProjectServicesAndPayments},null,8,["id","value","checked","onUpdate:checked","disabled"]),e("span",Ss,V(r.label),1)],8,$s),(i.services||[]).includes(r.value)?(l(),n("button",{key:0,onClick:y=>z(r.value),type:"button",class:Y(["text-gray-500 hover:text-gray-700 transition-transform duration-200",{"rotate-180":j[r.value]}])},d[14]||(d[14]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"})],-1)]),10,Vs)):x("",!0)]),(i.services||[]).includes(r.value)&&j[r.value]?(l(),n("div",Cs,[e("div",Is,[e("div",null,[o(A,{for:`service_amount_${r.value}`,value:"Amount"},null,8,["for"]),o(G,{id:`service_amount_${r.value}`,type:"number",step:"0.01",placeholder:"Service Amount",class:"w-full mt-1",modelValue:h(r.value).amount,"onUpdate:modelValue":y=>h(r.value).amount=y,disabled:!t.canManageProjectServicesAndPayments},null,8,["id","modelValue","onUpdate:modelValue","disabled"])]),e("div",null,[o(A,{for:`service_currency_${r.value}`,value:"Currency"},null,8,["for"]),o(se,{id:`service_currency_${r.value}`,modelValue:h(r.value).currency,"onUpdate:modelValue":y=>h(r.value).currency=y,options:B,"value-key":"value","label-key":"label",class:"w-full mt-1",disabled:!t.canManageProjectServicesAndPayments},null,8,["id","modelValue","onUpdate:modelValue","disabled"])])]),e("div",Ds,[e("div",null,[o(A,{for:`service_frequency_${r.value}`,value:"Frequency"},null,8,["for"]),ge(e("select",{id:`service_frequency_${r.value}`,class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full p-2.5","onUpdate:modelValue":y=>h(r.value).frequency=y,disabled:!t.canManageProjectServicesAndPayments},d[15]||(d[15]=[e("option",{value:"monthly"},"Monthly",-1),e("option",{value:"one_off"},"One off",-1)]),8,Us),[[Ce,h(r.value).frequency]])]),e("div",null,[o(A,{for:`service_start_date_${r.value}`,value:"Start Date"},null,8,["for"]),o(G,{id:`service_start_date_${r.value}`,type:"date",class:"w-full mt-1",modelValue:h(r.value).start_date,"onUpdate:modelValue":y=>h(r.value).start_date=y,disabled:!t.canManageProjectServicesAndPayments},null,8,["id","modelValue","onUpdate:modelValue","disabled"])])]),h(r.value).frequency!=="monthly"?(l(),n("div",Ms,[e("div",As,[o(A,{value:"Payment Breakdown (%)",class:"text-base font-medium text-blue-800"}),t.canManageProjectServicesAndPayments?(l(),Q(ee,{key:0,type:"button",onClick:y=>c(r.value),class:"px-4 py-2 text-sm"},{default:H(()=>d[16]||(d[16]=[F(" + Add Payment Step ",-1)])),_:2,__:[16]},1032,["onClick"])):x("",!0)]),e("div",Ns,[(l(!0),n(ie,null,de(h(r.value).payment_breakdown,(y,D)=>(l(),n("div",{key:D,class:"bg-white p-4 rounded-md shadow-sm border border-blue-100"},[e("div",Bs,[o(A,{for:`payment_label_${D}_${r.value}`,value:y.label,class:"font-semibold"},null,8,["for","value"]),t.canManageProjectServicesAndPayments&&h(r.value).payment_breakdown.length>1?(l(),n("button",{key:0,type:"button",class:"text-red-500 hover:text-red-700 p-1 rounded-full hover:bg-red-100 transition-colors",onClick:M=>C(r.value,D),title:"Remove payment step"},d[17]||(d[17]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 011-1h4a1 1 0 110 2H8a1 1 0 01-1-1zm-1 3a1 1 0 100 2h8a1 1 0 100-2H6z","clip-rule":"evenodd"})],-1)]),8,Ts)):x("",!0)]),e("div",Os,[e("div",null,[o(A,{for:`payment_percentage_${D}_${r.value}`,value:"Percentage (%)",class:"text-sm"},null,8,["for"]),o(G,{id:`payment_percentage_${D}_${r.value}`,type:"number",min:"0",max:"100",class:"w-full mt-1",modelValue:y.percentage,"onUpdate:modelValue":M=>y.percentage=M,modelModifiers:{number:!0},onInput:M=>{y.percentage=Math.max(0,Math.min(100,parseInt(M.target.value)||0))},disabled:!t.canManageProjectServicesAndPayments},null,8,["id","modelValue","onUpdate:modelValue","onInput","disabled"])]),e("div",null,[o(A,{for:`payment_due_date_${D}_${r.value}`,value:"Due Date (Optional)",class:"text-sm"},null,8,["for"]),o(G,{id:`payment_due_date_${D}_${r.value}`,type:"date",class:"w-full mt-1",modelValue:y.due_date,"onUpdate:modelValue":M=>y.due_date=M,disabled:!t.canManageProjectServicesAndPayments},null,8,["id","modelValue","onUpdate:modelValue","disabled"]),t.canManageProjectServicesAndPayments&&y.due_date?(l(),n("button",{key:0,type:"button",class:"text-xs text-red-500 hover:text-red-700 mt-1",onClick:M=>y.due_date=null}," Clear Date ",8,Rs)):x("",!0)])])]))),128))]),e("div",{class:Y(["text-sm mt-4 p-2 rounded-md",{"bg-green-100 text-green-700":b(r.value)===100,"bg-red-100 text-red-700 font-bold":b(r.value)!==100}])},[F(" Total Percentage: "+V(b(r.value))+"% ",1),b(r.value)!==100?(l(),n("span",Fs," (Total must be 100%) ")):x("",!0)],2)])):x("",!0)])):x("",!0)]))),128))])]),e("div",Es,[t.canManageProjectServicesAndPayments&&!s.value?(l(),n("button",{key:0,type:"button",class:"inline-flex items-center px-4 py-2 bg-blue-600 border border-transparent rounded-md font-semibold text-xs text-white uppercase tracking-widest hover:bg-blue-700 active:bg-blue-900 focus:outline-none focus:border-blue-900 focus:ring ring-blue-300 disabled:opacity-25 transition ease-in-out duration-150 shadow-md",onClick:d[3]||(d[3]=r=>s.value=!0)},d[18]||(d[18]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 4v16m8-8H4"})],-1),F(" Add New Service/Department ",-1)]))):x("",!0),t.canManageProjectServicesAndPayments&&s.value?(l(),n("div",zs,[o(G,{type:"text",class:"flex-grow mr-2 border-gray-300 rounded-md shadow-sm p-2.5",modelValue:u.value,"onUpdate:modelValue":d[4]||(d[4]=r=>u.value=r),placeholder:"Enter new service/department name",onKeyup:Te(Z,["enter"])},null,8,["modelValue"]),o(ee,{onClick:Z},{default:H(()=>d[19]||(d[19]=[F("Add",-1)])),_:1,__:[19]}),e("button",{type:"button",class:"ml-2 text-sm text-gray-500 hover:text-gray-700 px-3 py-2 rounded-md transition-colors",onClick:d[5]||(d[5]=r=>{s.value=!1,u.value=""})}," Cancel ")])):x("",!0)]),o(R,{message:g.value.services?g.value.services[0]:"",class:"mt-2"},null,8,["message"])]),t.canManageProjectServicesAndPayments?(l(),n("div",Ls,[o(ee,{onClick:O,disabled:J.value,class:Y([{"opacity-50 cursor-not-allowed":J.value},"px-6 py-3 text-base"])},{default:H(()=>d[21]||(d[21]=[F(" Update Services & Payment ",-1)])),_:1,__:[21]},8,["disabled","class"])])):x("",!0)]))]))}},X=P({}),Ks=localStorage.getItem("displayCurrency"),Re=P(Ks||"USD");le(Re,t=>{localStorage.setItem("displayCurrency",t)});const Ne=async()=>{try{const t=await window.axios.get("/api/currency-rates");X.value=t.data,console.log("Fetched currency rates:",X.value)}catch(t){console.error("Failed to fetch currency rates:",t),X.value={PKR:.0034,AUD:.65,INR:.012,EUR:1.08,GBP:1.28,USD:1}}},oe=(t,p="USD")=>{if(isNaN(t)||t==null)return"0.00";try{return new Intl.NumberFormat("en-US",{style:"currency",currency:p,minimumFractionDigits:2,maximumFractionDigits:2}).format(t)}catch(a){return console.warn(`Error formatting currency for ${t} ${p}:`,a),`${p} ${parseFloat(t).toFixed(2)}`}},fe=(t,p,a)=>{if(isNaN(t)||t==null||!p||!a)return 0;if(p.toUpperCase()===a.toUpperCase())return Number(t);const f=X.value,g=f[p.toUpperCase()],$=f[a.toUpperCase()];if(!g||!$)return console.warn(`Missing conversion rates for: ${p} or ${a}. Cannot perform conversion.`),Number(t);const U=Number(t)*g/$;return Number(U.toFixed(2))},Hs={class:"p-6 bg-white rounded-lg"},Gs={key:0,class:"text-red-600 text-sm mb-4"},Ys={key:1,class:"mb-6 p-4 bg-gray-50 rounded-md"},Ws={class:"mb-6"},Js={class:"flex justify-end items-center mb-4"},Zs={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},Xs={class:"p-3 bg-blue-100 rounded-md"},Qs={class:"text-lg font-bold text-blue-800"},el={class:"p-3 bg-red-100 rounded-md"},tl={class:"text-lg font-bold text-red-800"},al={class:"text-xs text-gray-500"},sl={class:"p-3 bg-purple-100 rounded-md"},ll={class:"text-lg font-bold text-purple-800"},ol={class:"p-3 bg-green-100 rounded-md"},nl={class:"text-lg font-bold text-green-800"},rl={class:"p-3 bg-yellow-100 rounded-md col-span-full md:col-span-1"},il={class:"text-lg font-bold text-yellow-800"},dl={class:"text-xs text-gray-500"},ul={class:"p-3 bg-orange-100 rounded-md col-span-full md:col-span-1"},cl={class:"text-lg font-bold text-orange-900 mt-1"},ml={class:"text-xs text-gray-500"},vl={class:"p-3 bg-gray-100 rounded-md col-span-full md:col-span-1"},pl={class:"text-lg font-bold mt-1 text-green-400"},gl={class:"p-3 bg-gray-100 rounded-md col-span-full md:col-span-1"},yl={class:"text-lg font-bold text-red-400 mt-1"},fl={class:"grid grid-cols-1 gap-4 md:grid-cols-2"},bl={key:0},hl={key:1},wl={class:"mt-4 flex justify-end"},xl={key:2},kl={key:0,class:"space-y-3"},jl={key:1,class:"p-4 bg-gray-50 rounded-md text-gray-600 text-center"},_l={key:2,class:"space-y-4"},Pl={class:"flex justify-between items-start mb-2"},$l={class:"flex-grow"},Sl={class:"font-medium text-gray-900 text-lg"},Vl={class:"text-xs text-gray-500 mt-1"},Cl={class:"flex-shrink-0 text-right"},Il={key:0,class:"text-sm text-gray-600"},Dl={class:"flex justify-between items-end text-xs text-gray-600 mt-2 border-t border-gray-200 pt-2"},Ul={key:0,class:"block"},Ml={key:1,class:"block"},Al={key:2,class:"block mt-1 text-gray-500"},Nl={class:"flex space-x-2 mt-2"},Bl={key:0,class:"mt-4 p-4 bg-blue-50 rounded-md border border-blue-200"},Tl={class:"text-md font-medium text-gray-900 mb-4"},Ol={class:"mb-4"},Rl={class:"mb-4"},Fl={class:"flex items-center"},El=["disabled"],zl={class:"text-sm text-gray-700"},Ll={key:0,class:"mb-4"},ql={class:"flex justify-end space-x-2"},Be=.25,Kl={__name:"ProjectTransactions",props:{projectId:{type:[Number,String],required:!0},userProjectRole:{type:Object,default:()=>({})}},setup(t){const p=t,{canDo:a,canManage:f}=Oe(()=>p.projectId),g=f("project_expenses",p.userProjectRole),$=f("project_income",p.userProjectRole),B=a("view_project_transactions",p.userProjectRole),U=P([]),v=P([]),u=P({}),s=P(""),i=P(!1),j=P(null),k=P(""),N=P(!1),W=P({}),J=P(null),Z=P(""),T=P({description:"",amount:"",currency:"PKR",user_id:null,hours_spent:"",type:"expense"}),O=Re,ne=[{value:"PKR",label:"PKR"},{value:"AUD",label:"AUD"},{value:"INR",label:"INR"},{value:"USD",label:"USD"},{value:"EUR",label:"EUR"},{value:"GBP",label:"GBP"}],h=[{value:"expense",label:"Expense"},{value:"income",label:"Income"},{value:"bonus",label:"Bonus"}],b=K(()=>v.value.map(_=>({value:_.id,label:_.name||"Unknown User"}))),c=()=>{const _=new Date,m=_.getFullYear(),L=String(_.getMonth()+1).padStart(2,"0"),te=String(_.getDate()).padStart(2,"0");return`${m}-${L}-${te}`},C=async()=>{if(!(!p.projectId||!B.value))try{const _=await window.axios.get(`/api/projects/${p.projectId}/sections/clients-users`);v.value=_.data.users||[]}catch(_){s.value="Failed to fetch users.",console.error("Error fetching users:",_)}},z=async()=>{if(!(!p.projectId||!B.value)){i.value=!0;try{(!X.value||Object.keys(X.value).length===0)&&await Ne();const _=await window.axios.get(`/api/projects/${p.projectId}/sections/transactions`);U.value=_.data}catch(_){s.value="Failed to fetch transactions.",console.error("Error fetching transactions:",_)}finally{i.value=!1}}},w=async()=>{var _;if(!g.value&&!$.value){E("You do not have permission to manage transactions.");return}if(!T.value.amount||isNaN(T.value.amount)){u.value.amount=["Please enter a valid amount"];return}if(T.value.type==="expense"&&!g.value){E("You do not have permission to add expenses.");return}if(T.value.type==="income"&&!$.value){E("You do not have permission to add income.");return}if(T.value.type==="bonus"&&!g.value){E("You do not have permission to add bonuses.");return}u.value={},s.value="",i.value=!0;try{const m={...T.value,amount:Number(T.value.amount)},L=await window.axios.post(`/api/projects/${p.projectId}/transactions`,m);await z(),d(),ae("Transaction saved successfully!")}catch(m){((_=m.response)==null?void 0:_.status)===422?u.value=m.response.data.errors:(s.value="Failed to save transaction.",console.error("Error saving transaction:",m))}finally{i.value=!1}},d=()=>{T.value={description:"",amount:"",currency:"PKR",user_id:null,hours_spent:"",type:"expense"}},r=async _=>{if(!g.value&&!$.value){E("You do not have permission to delete transactions.");return}if(window.confirm("Are you sure you want to delete this transaction?"))try{const m=U.value[_].id;await window.axios.delete(`/api/projects/${p.projectId}/transactions/${m}`),await z(),ae("Transaction deleted successfully!")}catch(m){s.value="Failed to delete transaction.",console.error("Error deleting transaction:",m)}},y=_=>{if(!g.value&&!$.value){E("You do not have permission to manage transactions.");return}const m=U.value[_];j.value===m.id?(j.value=null,J.value=null,Z.value=""):(J.value=_,j.value=m.id,k.value=m.amount,N.value=!1,W.value={},Z.value=c(),(Number(m.amount)===0||Math.abs(Number(k.value)-Number(m.amount))<.01)&&(N.value=!0))};le(k,_=>{if(J.value!==null){const m=U.value[J.value];N.value=Math.abs(Number(_)-Number(m.amount))<.01}});const D=()=>{j.value=null,J.value=null,k.value="",N.value=!1,W.value={},Z.value=""},M=async()=>{var te;if(!g.value&&!$.value){E("You do not have permission to manage transactions.");return}const _=J.value,m=U.value[_],L=Number(k.value);if(!N.value&&(!k.value||isNaN(L)||L<=0||L>Number(m.amount))){W.value.amount=["Please enter a valid amount between 0 and "+oe(Number(m.amount),m.currency)];return}if(!Z.value){W.value.date=["Please select a payment date."];return}W.value={},i.value=!0;try{const ce=m.id,ye=N.value||Math.abs(L-Number(m.amount))<.01,we={payment_amount:ye?Number(m.amount):L,pay_in_full:ye,transaction_currency:m.currency,transaction_type:m.type,original_description:m.description,payment_date:Z.value};await window.axios.patch(`/api/projects/${p.projectId}/transactions/${ce}/process-payment`,we),await z(),ae("Payment processed successfully!"),D()}catch(ce){((te=ce.response)==null?void 0:te.status)===422?W.value=ce.response.data.errors:(s.value="Failed to process payment.",console.error("Error processing payment:",ce))}finally{i.value=!1}},q=K(()=>!X.value||Object.keys(X.value).length===0?0:U.value.filter(_=>_.type==="income").reduce((_,m)=>_+fe(parseFloat(m.amount||0),m.currency,O.value),0)),ve=K(()=>!X.value||Object.keys(X.value).length===0?0:U.value.filter(_=>_.type==="expense").reduce((_,m)=>_+fe(parseFloat(m.amount||0),m.currency,O.value),0)),he=K(()=>!X.value||Object.keys(X.value).length===0?0:U.value.filter(_=>_.type==="bonus").reduce((_,m)=>_+fe(parseFloat(m.amount||0),m.currency,O.value),0)),Fe=K(()=>oe(q.value,O.value)),Ee=K(()=>oe(ve.value,O.value)),ze=K(()=>oe(he.value,O.value)),Le=K(()=>{if(!X.value||Object.keys(X.value).length===0)return oe(0,O.value);const _=ve.value+he.value;return oe(q.value-_,O.value)}),qe=K(()=>q.value===0?"0.00%":`${(ve.value/q.value*100).toFixed(2)}%`),Ke=K(()=>q.value===0?"0.00%":`${((ve.value+he.value)/q.value*100).toFixed(2)}%`),He=K(()=>{if(q.value<=0)return oe(0,O.value);const _=q.value*Be;return oe(_,O.value)}),Ge=K(()=>{const _=U.value.filter(L=>(L.type==="expense"||L.type==="bonus")&&L.is_paid&&L.payment_date);if(_.length===0)return"N/A";const m=_.reduce((L,te)=>new Date(te.payment_date)>new Date(L.payment_date)?te:L);return new Date(m.payment_date).toLocaleDateString()}),Ye=K(()=>{const _=U.value.filter(L=>L.type==="income"&&L.payment_date);if(_.length===0)return"N/A";const m=_.reduce((L,te)=>new Date(te.payment_date)>new Date(L.payment_date)?te:L);return new Date(m.payment_date).toLocaleDateString()});return me(async()=>{const _=localStorage.getItem("displayCurrency");_&&(O.value=_),await Ne(),z(),C()}),le([()=>p.projectId,O,X],()=>{p.projectId&&X.value&&Object.keys(X.value).length>0&&(z(),C())},{deep:!0}),le(O,_=>{_&&localStorage.setItem("displayCurrency",_)},{deep:!0}),(_,m)=>{var L,te,ce,ye,we,je;return l(),n("div",Hs,[s.value?(l(),n("div",Gs,V(s.value),1)):x("",!0),I(g)||I($)?(l(),n("div",Ys,[e("div",Ws,[e("div",Js,[m[10]||(m[10]=e("span",{class:"text-sm font-medium text-gray-700 mr-2"},"Currency:",-1)),o(se,{id:"transactions-display-currency-switcher",modelValue:I(O),"onUpdate:modelValue":m[0]||(m[0]=S=>Je(O)?O.value=S:null),options:ne,"value-key":"value","label-key":"label",class:"w-24"},null,8,["modelValue"])]),m[19]||(m[19]=e("h4",{class:"text-md font-medium text-gray-700 mb-2"},"Summary",-1)),e("div",Zs,[e("div",Xs,[m[11]||(m[11]=e("p",{class:"text-sm text-gray-600"},"Total Income",-1)),e("p",Qs,V(Fe.value),1)]),e("div",el,[m[12]||(m[12]=e("p",{class:"text-sm text-gray-600"},"Total Expenses",-1)),e("p",tl,V(Ee.value),1),e("p",al,"("+V(qe.value)+" of Income)",1)]),e("div",sl,[m[13]||(m[13]=e("p",{class:"text-sm text-gray-600"},"Total Bonuses",-1)),e("p",ll,V(ze.value),1)]),e("div",ol,[m[14]||(m[14]=e("p",{class:"text-sm text-gray-600"},"Balance",-1)),e("p",nl,V(Le.value),1)]),e("div",rl,[m[15]||(m[15]=e("p",{class:"text-sm text-gray-600"},"Expense + Bonus",-1)),e("p",il,V(I(oe)(ve.value+he.value,I(O))),1),e("p",dl,"("+V(Ke.value)+" of Income)",1)]),e("div",ul,[m[16]||(m[16]=e("p",{class:"text-sm font-medium text-orange-800"},"Estimated Income Tax (AUD)",-1)),e("p",cl,V(He.value),1),e("p",ml," (Based on "+V((Be*100).toFixed(1))+"% of Total Income. This is an estimation.) ",1)]),e("div",vl,[m[17]||(m[17]=e("p",{class:"text-sm font-medium text-gray-800"},"Last Payment Received Date",-1)),e("p",pl,V(Ye.value),1)]),e("div",gl,[m[18]||(m[18]=e("p",{class:"text-sm font-medium text-gray-800"},"Last Payment Sent Date",-1)),e("p",yl,V(Ge.value),1)])])]),m[20]||(m[20]=e("h4",{class:"text-md font-medium text-gray-700 mb-4"},"Add Transaction",-1)),e("div",fl,[e("div",null,[o(A,{for:"description",value:"Description"}),o(G,{id:"description",modelValue:T.value.description,"onUpdate:modelValue":m[1]||(m[1]=S=>T.value.description=S),class:"mt-1 block w-full",disabled:i.value},null,8,["modelValue","disabled"]),o(R,{message:(L=u.value.description)==null?void 0:L[0],class:"mt-2"},null,8,["message"])]),e("div",null,[o(A,{for:"amount",value:"Amount"}),o(G,{id:"amount",type:"number",modelValue:T.value.amount,"onUpdate:modelValue":m[2]||(m[2]=S=>T.value.amount=S),class:"mt-1 block w-full",disabled:i.value},null,8,["modelValue","disabled"]),o(R,{message:(te=u.value.amount)==null?void 0:te[0],class:"mt-2"},null,8,["message"])]),e("div",null,[o(A,{for:"currency",value:"Currency"}),o(se,{id:"currency",modelValue:T.value.currency,"onUpdate:modelValue":m[3]||(m[3]=S=>T.value.currency=S),options:ne,disabled:i.value},null,8,["modelValue","disabled"]),o(R,{message:(ce=u.value.currency)==null?void 0:ce[0],class:"mt-2"},null,8,["message"])]),e("div",null,[o(A,{for:"type",value:"Type"}),o(se,{id:"type",modelValue:T.value.type,"onUpdate:modelValue":m[4]||(m[4]=S=>T.value.type=S),options:h,disabled:i.value||!I(g)&&T.value.type==="expense"&&T.value.type!=="bonus"||!I($)&&T.value.type==="income"},null,8,["modelValue","disabled"]),o(R,{message:(ye=u.value.type)==null?void 0:ye[0],class:"mt-2"},null,8,["message"])]),T.value.type==="expense"||T.value.type==="bonus"?(l(),n("div",bl,[o(A,{for:"user_id",value:"User"}),o(se,{id:"user_id",modelValue:T.value.user_id,"onUpdate:modelValue":m[5]||(m[5]=S=>T.value.user_id=S),options:b.value,disabled:i.value||!v.value.length,placeholder:"Select a user"},null,8,["modelValue","options","disabled"]),o(R,{message:(we=u.value.user_id)==null?void 0:we[0],class:"mt-2"},null,8,["message"])])):x("",!0),T.value.type==="expense"||T.value.type==="bonus"?(l(),n("div",hl,[o(A,{for:"hours_spent",value:"Hours Spent (Optional)"}),o(G,{id:"hours_spent",type:"number",modelValue:T.value.hours_spent,"onUpdate:modelValue":m[6]||(m[6]=S=>T.value.hours_spent=S),class:"mt-1 block w-full",disabled:i.value},null,8,["modelValue","disabled"]),o(R,{message:(je=u.value.hours_spent)==null?void 0:je[0],class:"mt-2"},null,8,["message"])])):x("",!0)]),e("div",wl,[o(ee,{onClick:w,disabled:i.value},{default:H(()=>[F(V(i.value?"Saving...":"Save Transaction"),1)]),_:1},8,["disabled"])])])):x("",!0),I(B)?(l(),n("div",xl,[m[24]||(m[24]=e("h4",{class:"text-md font-medium text-gray-700 mb-4"},"Transaction History",-1)),i.value?(l(),n("div",kl,m[21]||(m[21]=[e("div",{class:"h-4 bg-gray-200 rounded animate-pulse w-full"},null,-1),e("div",{class:"h-4 bg-gray-200 rounded animate-pulse w-5/6"},null,-1),e("div",{class:"h-4 bg-gray-200 rounded animate-pulse w-3/4"},null,-1)]))):U.value.length===0?(l(),n("div",jl," No transactions found for this project. ")):(l(),n("div",_l,[(l(!0),n(ie,null,de(U.value,(S,_e)=>{var Pe,$e,Se;return l(),n("div",{key:S.id,class:Y([{"bg-green-50 border-green-200":S.type==="income","bg-red-50 border-red-200":S.type==="expense","bg-purple-50 border-purple-200":S.type==="bonus","border-l-4":!0},"p-4 rounded-md shadow-sm transition-all duration-200 ease-in-out hover:shadow-md"])},[e("div",Pl,[e("div",$l,[e("p",Sl,V(S.description),1),e("p",Vl,V(S.type==="income"?"Income":S.type==="expense"?"Expense":"Bonus")+" on "+V(new Date(S.created_at).toLocaleDateString()),1)]),e("div",Cl,[e("p",{class:Y(["text-lg font-bold",{"text-green-700":S.type==="income","text-red-700":S.type==="expense","text-purple-700":S.type==="bonus"}])},V(I(oe)(S.amount,S.currency)),3),S.currency.toUpperCase()!==I(O).toUpperCase()?(l(),n("p",Il," ("+V(I(oe)(I(fe)(S.amount,S.currency,I(O)),I(O)))+") ",1)):x("",!0),e("span",{class:Y(["block text-xs mt-1",S.is_paid?"text-green-600":"text-red-600"])},V(S.is_paid?"Paid":"Unpaid"),3)])]),e("div",Dl,[e("div",null,[S.user_id?(l(),n("span",Ul,"User: "+V(((Pe=v.value.find(ue=>ue.id===S.user_id))==null?void 0:Pe.name)||"Unknown"),1)):x("",!0),S.hours_spent?(l(),n("span",Ml,"Hours: "+V(S.hours_spent),1)):x("",!0),(S.type==="expense"||S.type==="bonus")&&q.value>0?(l(),n("span",Al,V((I(fe)(S.amount,S.currency,I(O))/q.value*100).toFixed(2))+"% of Income ",1)):x("",!0)]),e("div",Nl,[!S.is_paid&&(I(g)||I($))?(l(),Q(be,{key:0,onClick:ue=>y(_e),class:Y({"text-green-600":S.type!=="income","text-blue-600":S.type==="income"})},{default:H(()=>[F(V(S.type==="income"?"Receive":"Pay"),1)]),_:2},1032,["onClick","class"])):x("",!0),I(g)||I($)?(l(),Q(be,{key:1,onClick:ue=>r(_e),class:"text-red-600"},{default:H(()=>m[22]||(m[22]=[F(" Delete ",-1)])),_:2,__:[22]},1032,["onClick"])):x("",!0)])]),j.value===S.id?(l(),n("div",Bl,[e("h4",Tl,V(S.type==="income"?"Record Receipt":"Make Payment"),1),e("div",Ol,[o(A,{for:"payment_date",value:"Date"}),o(G,{id:"payment_date",type:"date",modelValue:Z.value,"onUpdate:modelValue":m[7]||(m[7]=ue=>Z.value=ue),class:"mt-1 block w-full",disabled:i.value},null,8,["modelValue","disabled"]),o(R,{message:($e=W.value.date)==null?void 0:$e[0],class:"mt-2"},null,8,["message"])]),e("div",Rl,[e("label",Fl,[ge(e("input",{type:"checkbox","onUpdate:modelValue":m[8]||(m[8]=ue=>N.value=ue),class:"mr-2 rounded text-blue-600 focus:ring-blue-500",disabled:i.value},null,8,El),[[Ze,N.value]]),e("span",zl,V(S.type==="income"?"Receive in Full":"Pay in Full"),1)])]),N.value?x("",!0):(l(),n("div",Ll,[o(A,{for:"payment_amount",value:"Amount"}),o(G,{id:"payment_amount",type:"number",modelValue:k.value,"onUpdate:modelValue":m[9]||(m[9]=ue=>k.value=ue),class:"mt-1 block w-full",disabled:i.value,placeholder:"Enter partial "+(S.type==="income"?"receipt":"payment")+" amount (Max: "+I(oe)(S.amount,S.currency)+")"},null,8,["modelValue","disabled","placeholder"]),o(R,{message:(Se=W.value.amount)==null?void 0:Se[0],class:"mt-2"},null,8,["message"])])),e("div",ql,[o(be,{onClick:D,disabled:i.value},{default:H(()=>m[23]||(m[23]=[F(" Cancel ",-1)])),_:1,__:[23]},8,["disabled"]),o(ee,{onClick:M,disabled:i.value},{default:H(()=>[F(V(i.value?"Processing...":S.type==="income"?"Record Receipt":"Submit Payment"),1)]),_:2},1032,["disabled"])])])):x("",!0)],2)}),128))]))])):x("",!0)])}}},Hl={class:"p-6 w-full mx-auto bg-white rounded-xl shadow-2xl transition-all duration-300"},Gl={class:"border-b border-gray-200 mb-6"},Yl={class:"flex -mb-px space-x-4 overflow-x-auto pb-2"},Wl={class:"py-4"},io={__name:"ProjectForm",props:{projectId:{type:[Number,String],default:null},statusOptions:{type:Array,required:!0},departmentOptions:{type:Array,required:!0},sourceOptions:{type:Array,required:!0},clientRoleOptions:{type:Array,default:()=>[]},userRoleOptions:{type:Array,default:()=>[]},paymentTypeOptions:{type:Array,required:!0},errors:{type:Object,default:()=>({})},isSaving:{type:Boolean,default:!1}},emits:["close"],setup(t,{emit:p}){Xe();const a=t,f=P(a.projectId);le(()=>a.projectId,D=>{f.value=D,D&&Qe(D)},{immediate:!0}),et(f);const g=tt(f),{canDo:$,canView:B,canManage:U}=Oe(f),v=$("manage_projects",g);$("create_clients",g);const u=$("upload_project_documents",g),s=U("project_services_and_payments",g),i=$("add_project_notes",g),j=U("project_users",g),k=U("project_clients",g),N=$("manage_project_basic_details",g),W=B("project_documents",g),J=B("project_services_and_payments",g),Z=B("project_notes",g),T=B("project_users",g),O=B("project_clients",g),ne=B("project_transactions",g),h=B("project_deliverables"),b=U("project_deliverables"),c=P("basic"),C=K(()=>O.value&&T.value?"Clients and Users":O.value?"Clients":T.value?"Users":"Clients and Users"),z=P([]),w=P([]),d=P([]),r=P([]),y=D=>{if(D!=="basic"&&!a.projectId){at("Please create the project first before managing this section."),c.value="basic";return}c.value=D};return me(async()=>{try{z.value=await Me("client"),w.value=await Me("project"),d.value=await ut(!0,null),r.value=await ct(!0,null)}catch(D){console.error("Error fetching global data for ProjectForm:",D)}}),(D,M)=>(l(),n("div",Hl,[M[7]||(M[7]=e("div",{class:"flex justify-between items-center pb-4 mb-6 border-b border-gray-200"},[e("h2",{class:"text-2xl font-semibold text-gray-800"},"Edit Project")],-1)),e("div",Gl,[e("nav",Yl,[e("button",{onClick:M[0]||(M[0]=q=>y("basic")),class:Y(["py-3 px-5 text-center border-b-2 font-medium text-base rounded-t-lg transition-colors duration-200 whitespace-nowrap",c.value==="basic"?"border-indigo-600 text-indigo-700 bg-indigo-50":"border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300 hover:bg-gray-50"])}," Basic Information ",2),t.projectId&&(I(O)||I(T))?(l(),n("button",{key:0,onClick:M[1]||(M[1]=q=>y("client")),class:Y(["py-3 px-5 text-center border-b-2 font-medium text-base rounded-t-lg transition-colors duration-200 whitespace-nowrap",c.value==="client"?"border-indigo-600 text-indigo-700 bg-indigo-50":"border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300 hover:bg-gray-50"])},V(C.value),3)):x("",!0),t.projectId&&(I(s)||I(J))?(l(),n("button",{key:1,onClick:M[2]||(M[2]=q=>y("services")),class:Y(["py-3 px-5 text-center border-b-2 font-medium text-base rounded-t-lg transition-colors duration-200 whitespace-nowrap",c.value==="services"?"border-indigo-600 text-indigo-700 bg-indigo-50":"border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300 hover:bg-gray-50"])}," Services & Payment ",2)):x("",!0),t.projectId&&I(ne)?(l(),n("button",{key:2,onClick:M[3]||(M[3]=q=>y("transactions")),class:Y(["py-3 px-5 text-center border-b-2 font-medium text-base rounded-t-lg transition-colors duration-200 whitespace-nowrap",c.value==="transactions"?"border-indigo-600 text-indigo-700 bg-indigo-50":"border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300 hover:bg-gray-50"])}," Transactions ",2)):x("",!0),t.projectId&&I(W)?(l(),n("button",{key:3,onClick:M[4]||(M[4]=q=>y("documents")),class:Y(["py-3 px-5 text-center border-b-2 font-medium text-base rounded-t-lg transition-colors duration-200 whitespace-nowrap",c.value==="documents"?"border-indigo-600 text-indigo-700 bg-indigo-50":"border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300 hover:bg-gray-50"])}," Documents ",2)):x("",!0),t.projectId&&(I(i)||I(Z))?(l(),n("button",{key:4,onClick:M[5]||(M[5]=q=>y("notes")),class:Y(["py-3 px-5 text-center border-b-2 font-medium text-base rounded-t-lg transition-colors duration-200 whitespace-nowrap",c.value==="notes"?"border-indigo-600 text-indigo-700 bg-indigo-50":"border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300 hover:bg-gray-50"])}," Notes ",2)):x("",!0),t.projectId&&(I(b)||I(h))?(l(),n("button",{key:5,onClick:M[6]||(M[6]=q=>y("deliverables")),class:Y(["py-3 px-5 text-center border-b-2 font-medium text-base rounded-t-lg transition-colors duration-200 whitespace-nowrap",c.value==="deliverables"?"border-indigo-600 text-indigo-700 bg-indigo-50":"border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300 hover:bg-gray-50"])}," Deliverables ",2)):x("",!0)])]),e("div",Wl,[c.value==="basic"?(l(),Q(Vt,{key:0,projectId:t.projectId,errors:a.errors,statusOptions:t.statusOptions,sourceOptions:t.sourceOptions,canManageProjects:I(v),canManageProjectBasicDetails:I(N),isSaving:a.isSaving},null,8,["projectId","errors","statusOptions","sourceOptions","canManageProjects","canManageProjectBasicDetails","isSaving"])):x("",!0),c.value==="client"?(l(),Q(ea,{key:1,projectId:t.projectId,errors:a.errors,clientRoleOptions:z.value,userRoleOptions:w.value,clients:d.value,users:r.value,canViewProjectClients:I(O),canManageProjectClients:I(k),canViewProjectUsers:I(T),canManageProjectUsers:I(j),isSaving:a.isSaving},null,8,["projectId","errors","clientRoleOptions","userRoleOptions","clients","users","canViewProjectClients","canManageProjectClients","canViewProjectUsers","canManageProjectUsers","isSaving"])):x("",!0),c.value==="services"?(l(),Q(qs,{key:2,projectId:t.projectId,departmentOptions:t.departmentOptions,paymentTypeOptions:t.paymentTypeOptions,canManageProjectServicesAndPayments:I(s),canViewProjectServicesAndPayments:I(J),isSaving:a.isSaving},null,8,["projectId","departmentOptions","paymentTypeOptions","canManageProjectServicesAndPayments","canViewProjectServicesAndPayments","isSaving"])):x("",!0),c.value==="transactions"&&I(ne)?(l(),Q(Kl,{key:3,projectId:t.projectId,userProjectRole:I(g),isSaving:a.isSaving},null,8,["projectId","userProjectRole","isSaving"])):x("",!0),c.value==="documents"?(l(),Q(ha,{key:4,projectId:t.projectId,errors:a.errors,canUploadProjectDocuments:I(u),canViewProjectDocuments:I(W),isSaving:a.isSaving},null,8,["projectId","errors","canUploadProjectDocuments","canViewProjectDocuments","isSaving"])):x("",!0),c.value==="notes"?(l(),Q(Aa,{key:5,projectId:t.projectId,errors:a.errors,canAddProjectNotes:I(i),canViewProjectNotes:I(Z),"is-saving":a.isSaving},null,8,["projectId","errors","canAddProjectNotes","canViewProjectNotes","is-saving"])):x("",!0),c.value==="deliverables"?(l(),Q(os,{key:6,projectId:t.projectId,errors:a.errors,canManageProjectDeliverables:I(b),canViewProjectDeliverables:I(h),isSaving:a.isSaving},null,8,["projectId","errors","canManageProjectDeliverables","canViewProjectDeliverables","isSaving"])):x("",!0)])]))}};export{io as _,fe as a,Ne as b,X as c,Re as d,oe as f};
