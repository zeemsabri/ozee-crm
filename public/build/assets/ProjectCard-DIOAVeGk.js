import{r as v,c as S,e as X,f as q,B as G,a as o,o as a,b as t,i as k,d as I,t as n,j as u,w as J,m as p,u as K,D as Q,F as w,l as j,k as Y,X as Z}from"./app-DDzbo8Mi.js";import{d as ee,c as _,f as H}from"./currency-Ct0jjJEz.js";const te={class:"flex items-center justify-between mb-4"},se={class:"flex items-center gap-2"},oe={class:"text-xl font-semibold text-gray-900"},ae={key:0,class:"px-2 py-1 text-xs font-semibold text-blue-800 bg-blue-100 rounded-full"},le={key:1,class:"px-2 py-1 text-xs font-semibold text-green-800 bg-green-100 rounded-full"},ne=["title","aria-label"],re={key:0,class:"flex items-start gap-4 p-4 mb-6 border-l-4 border-red-500 bg-red-50 rounded-lg"},ie={class:"flex-grow"},de={class:"font-medium text-sm text-red-800"},ue={class:"flex justify-between items-center mt-2"},ce={class:"text-xs font-semibold text-red-600"},me={key:0,class:"text-xs text-red-600"},xe={key:1,class:"tabs"},ve={class:"flex border-b border-gray-200"},ye={key:0,class:"tab-content pt-4"},ge={class:"space-y-3 text-sm text-gray-700"},be={class:"flex justify-between items-center"},fe={class:"flex justify-between items-center"},pe={key:0,class:"text-gray-500"},he={key:1},ke={key:2},we={class:"flex justify-between items-center"},je={class:"px-2 py-0.5 text-xs font-medium text-green-800 bg-green-200 rounded-full"},_e={key:1,class:"tab-content pt-4"},Ce={class:"flex space-x-2 border-b border-gray-200 mb-3"},Te={class:"ml-1 px-2 py-0.5 text-xs font-medium text-gray-600 bg-gray-200 rounded-full"},Ve={class:"ml-1 px-2 py-0.5 text-xs font-medium text-gray-600 bg-gray-200 rounded-full"},$e={key:0},Le={key:0,class:"space-y-2 text-sm text-gray-700"},Se={class:"flex items-center space-x-2"},Me=["aria-label"],Ne={key:1,class:"mt-4 text-center text-sm text-gray-500"},Be={key:1},De={key:0,class:"space-y-2 text-sm text-gray-700"},Ee={class:"flex items-center space-x-2"},Pe=["aria-label"],ze={key:1,class:"mt-4 text-center text-sm text-gray-500"},Ae={class:"mt-4 pt-4 border-t border-gray-200"},Fe={key:0,class:"text-sm text-gray-500"},He={key:1,class:"text-sm text-red-600"},Re={key:2,class:"text-sm text-gray-500"},Ue={class:"line-through"},Oe={class:"flex items-center space-x-2"},We=["aria-label"],Xe=["aria-expanded"],qe={key:0},Ge={key:1},Ie={key:2,class:"tab-content pt-4"},Je={class:"space-y-3 text-sm text-gray-700"},Ke={class:"font-semibold"},Qe={class:"font-semibold text-yellow-700"},Ye={key:2},Ze={class:"mb-6"},et={class:"flex space-x-2 border-b border-gray-200 mb-3"},tt={class:"ml-1 px-2 py-0.5 text-xs font-medium text-gray-600 bg-gray-200 rounded-full"},st={class:"ml-1 px-2 py-0.5 text-xs font-medium text-gray-600 bg-gray-200 rounded-full"},ot={key:0},at={key:0,class:"space-y-2 text-sm text-gray-700"},lt={class:"max-w-[80%]"},nt={class:"flex items-center space-x-2"},rt=["aria-label"],it={key:1,class:"mt-4 text-center text-sm text-gray-500"},dt={key:1},ut={key:0,class:"space-y-2 text-sm text-gray-700"},ct={class:"flex items-center space-x-2"},mt=["aria-label"],xt={key:1,class:"mt-4 text-center text-sm text-gray-500"},vt={class:"mt-4 pt-4 border-t border-gray-200"},yt={key:0,class:"text-sm text-gray-500"},gt={key:1,class:"text-sm text-red-600"},bt={key:2,class:"text-sm text-gray-500"},ft={class:"line-through"},pt={class:"flex items-center space-x-2"},ht=["aria-label"],kt=["aria-expanded"],wt={key:0},jt={key:1},_t={class:"p-4 bg-indigo-50 rounded-lg mt-6"},Ct={class:"text-base font-semibold text-indigo-900 mb-2"},Tt={class:"text-sm text-indigo-700 mb-1"},Vt={key:0},$t={key:1},Lt={class:"w-full bg-gray-200 rounded-full h-2.5 mb-2"},St={class:"text-right text-xs font-medium text-indigo-600"},Mt={class:"text-xs text-indigo-800 italic mt-3"},Et={__name:"ProjectCard",props:{project:Object},setup(l){const i=l,m=v("overview"),d=v("today"),y=v(!1),b=v(!1),C=v(!1),h=v(null),B=v([]),f=S(()=>{var r;return b.value?B.value:((r=i.project.tasks)==null?void 0:r.completed)||[]}),g=S(()=>Array.isArray(f.value)?f.value.length:0);function c(r){const e=String(r||"").toLowerCase();return e==="to do"||e==="started"?{label:"To Do",classes:"px-2 py-1 text-xs font-semibold text-yellow-800 bg-yellow-100 rounded-full"}:e==="in progress"||e==="started"?{label:"Started",classes:"px-2 py-1 text-xs font-semibold text-yellow-800 bg-yellow-100 rounded-full"}:e==="blocked"?{label:"Blocked",classes:"px-2 py-1 text-xs font-semibold text-red-800 bg-red-100 rounded-full"}:e==="paused"?{label:"Paused",classes:"px-2 py-1 text-xs font-semibold text-gray-800 bg-gray-100 rounded-full"}:e==="done"||e==="complete"||e==="completed"?{label:"Complete",classes:"px-2 py-1 text-xs font-semibold text-green-800 bg-green-100 rounded-full"}:null}async function R(){var r,e;if(!(!i.project||!i.project.id)){C.value=!0,h.value=null;try{const{data:s}=await window.axios.get(`/api/workspace/projects/${i.project.id}/completed-tasks`);B.value=Array.isArray(s)?s:[],b.value=!0}catch(s){console.error(`Failed to load completed tasks for project ${i.project.id}`,s),h.value=((e=(r=s==null?void 0:s.response)==null?void 0:r.data)==null?void 0:e.message)||"Failed to load completed tasks"}finally{C.value=!1}}}function $(){!b.value&&!C.value?R().then(()=>{y.value=!0}):y.value=!y.value}const x=v(null),L=v(!1),M=v(null),U=ee,T=S(()=>{if(!x.value)return null;const r=x.value.currency||"AUD",e=U.value||"USD";return{total_budget:_(x.value.total_budget??0,r,e),total_assigned_milestone_amount:_(x.value.total_assigned_milestone_amount??0,r,e),total_pending_contract_amount:_(x.value.total_pending_contract_amount??0,r,e),total_approved_contract_amount:_(x.value.total_approved_contract_amount??0,r,e),total_expendable_amount:_(x.value.total_expendable_amount??0,r,e),available_for_new_milestones:_(x.value.available_for_new_milestones??0,r,e),currency:e}}),D=S(()=>{if(!T.value)return null;const r=H(T.value.available_for_new_milestones,T.value.currency),e=H(T.value.total_budget,T.value.currency);return`${r} available of ${e}`});async function O(){var r,e;if(!i.project||!i.project.id||i.project.role!=="Manager"){x.value=null,M.value=null,L.value=!1;return}L.value=!0,M.value=null;try{const{data:s}=await window.axios.get(`/api/projects/${i.project.id}/expendable-budget`);x.value=s}catch(s){console.error(`Failed to load expendable budget for project ${i.project.id}`,s),M.value=((e=(r=s==null?void 0:s.response)==null?void 0:r.data)==null?void 0:e.message)||"Unable to load budget",x.value=null}finally{L.value=!1}}X(()=>{var r,e;return[(r=i.project)==null?void 0:r.id,(e=i.project)==null?void 0:e.role]},()=>{O()},{immediate:!0});const V=v(null);function E(r){var P,z,A;const e=r.target.closest("a");if(!e)return;const s=e.getAttribute("aria-label")||"";if(!s.startsWith("View details for task:"))return;r.preventDefault();const W=s.replace("View details for task: ","").trim(),N=[...((P=i.project.tasks)==null?void 0:P.today)||[],...((z=i.project.tasks)==null?void 0:z.tomorrow)||[],...f&&f.value?f.value:((A=i.project.tasks)==null?void 0:A.completed)||[]].find(F=>F&&F.name===W);N&&N.id&&Z(N.id,i.project.id)}return q(()=>{V.value&&V.value.addEventListener("click",E)}),G(()=>{V.value&&V.value.removeEventListener("click",E)}),(r,e)=>(a(),o("div",{class:"bg-white rounded-xl shadow-md p-6",ref_key:"cardRef",ref:V},[t("div",te,[t("div",se,[t("h2",oe,n(l.project.name),1),l.project.role==="Manager"?(a(),o("span",ae,"Manager")):(a(),o("span",le,"Contributor")),t("div",{class:u([{"bg-red-500":l.project.health==="at-risk","bg-yellow-500":l.project.health==="needs-attention","bg-green-500":l.project.health==="on-track"},"w-3 h-3 rounded-full"]),title:`Project health status: ${l.project.health.replace("-"," ")}`,"aria-label":`Project health status: ${l.project.health.replace("-"," ")}`},null,10,ne)]),I(K(Q),{href:r.route("projects.show",l.project.id),class:"text-indigo-600 text-sm font-medium hover:underline"},{default:J(()=>e[7]||(e[7]=[p("View Project",-1)])),_:1,__:[7]},8,["href"])]),l.project.alert?(a(),o("div",re,[e[8]||(e[8]=t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-6 h-6 text-red-500 flex-shrink-0",viewBox:"0 0 24 24",fill:"currentColor"},[t("path",{d:"M12 2C6.486 2 2 6.486 2 12s4.486 10 10 10 10-4.486 10-10S17.514 2 12 2zm0 18c-4.411 0-8-3.589-8-8s3.589-8 8-8 8 3.589 8 8-3.589 8-8 8z"}),t("path",{d:"M11 12H9V8h2v4zM11 16H9v-2h2v2z"})],-1)),t("div",ie,[t("p",de,n(l.project.alert.text),1),t("div",ue,[t("span",ce,n(l.project.alert.timer)+" remaining",1),l.project.alert.incentive?(a(),o("span",me,n(l.project.alert.incentive),1)):k("",!0)])])])):k("",!0),l.project.role==="Manager"?(a(),o("div",xe,[t("div",ve,[t("button",{class:u([{"active text-gray-900 border-b-2 border-indigo-600":m.value==="overview","text-gray-500 hover:text-gray-900":m.value!=="overview"},"tab-button flex-1 py-2 text-sm font-medium focus:outline-none transition-all-colors"]),onClick:e[0]||(e[0]=s=>m.value="overview")}," Overview ",2),t("button",{class:u([{"active text-gray-900 border-b-2 border-indigo-600":m.value==="tasks","text-gray-500 hover:text-gray-900":m.value!=="tasks"},"tab-button flex-1 py-2 text-sm font-medium focus:outline-none transition-all-colors"]),onClick:e[1]||(e[1]=s=>m.value="tasks")}," Team's Tasks ",2),t("button",{class:u([{"active text-gray-900 border-b-2 border-indigo-600":m.value==="communication","text-gray-500 hover:text-gray-900":m.value!=="communication"},"tab-button flex-1 py-2 text-sm font-medium focus:outline-none transition-all-colors"]),onClick:e[2]||(e[2]=s=>m.value="communication")}," Communication ",2)]),m.value==="overview"?(a(),o("div",ye,[t("div",ge,[t("p",be,[e[9]||(e[9]=t("span",{class:"font-medium"},"Milestone:",-1)),t("span",null,n(l.project.overview.milestone),1)]),t("p",fe,[e[10]||(e[10]=t("span",{class:"font-medium"},"Budget:",-1)),t("span",null,[L.value?(a(),o("span",pe,"Loading...")):D.value?(a(),o("span",he,n(D.value),1)):(a(),o("span",ke,n(l.project.overview.budget),1))])]),t("p",we,[e[11]||(e[11]=t("span",{class:"font-medium"},"Project Status:",-1)),t("span",je,n(l.project.overview.status),1)])])])):m.value==="tasks"?(a(),o("div",_e,[t("div",null,[e[18]||(e[18]=t("h4",{class:"text-base font-semibold text-gray-900 mb-2"},"Team Tasks",-1)),t("div",Ce,[t("button",{class:u(["task-tab-button flex-1 text-sm font-medium py-1 transition-all-colors",{"text-gray-900 border-b-2 border-indigo-600":d.value==="today","text-gray-500 hover:text-gray-900":d.value!=="today"}]),onClick:e[3]||(e[3]=s=>d.value="today")},[e[12]||(e[12]=p(" Today ",-1)),t("span",Te,n(l.project.tasks.today.length),1)],2),t("button",{class:u(["task-tab-button flex-1 text-sm font-medium py-1 transition-all-colors",{"text-gray-900 border-b-2 border-indigo-600":d.value==="tomorrow","text-gray-500 hover:text-gray-900":d.value!=="tomorrow"}]),onClick:e[4]||(e[4]=s=>d.value="tomorrow")},[e[13]||(e[13]=p(" Tomorrow ",-1)),t("span",Ve,n(l.project.tasks.tomorrow.length),1)],2)]),d.value==="today"?(a(),o("div",$e,[l.project.tasks.today.length?(a(),o("div",Le,[(a(!0),o(w,null,j(l.project.tasks.today,s=>(a(),o("div",{key:s.name,class:"flex items-center justify-between p-2 rounded-lg bg-gray-50"},[t("span",null,n(s.name),1),t("div",Se,[c(s.status)?(a(),o("span",{key:0,class:u(c(s.status).classes)},n(c(s.status).label),3)):k("",!0),t("a",{href:"#",class:"text-xs text-indigo-600 font-medium hover:underline transition-all-colors","aria-label":`View details for task: ${s.name}`},"View",8,Me)])]))),128))])):(a(),o("div",Ne,e[14]||(e[14]=[t("p",null,"No tasks due today. Nice work!",-1)])))])):(a(),o("div",Be,[l.project.tasks.tomorrow.length?(a(),o("div",De,[(a(!0),o(w,null,j(l.project.tasks.tomorrow,s=>(a(),o("div",{key:s.name,class:"flex items-center justify-between p-2 rounded-lg bg-gray-50"},[t("span",null,n(s.name),1),t("div",Ee,[c(s.status)?(a(),o("span",{key:0,class:u(c(s.status).classes)},n(c(s.status).label),3)):k("",!0),t("a",{href:"#",class:"text-xs text-indigo-600 font-medium hover:underline transition-all-colors","aria-label":`View details for task: ${s.name}`},"View",8,Pe)])]))),128))])):(a(),o("div",ze,e[15]||(e[15]=[t("p",null,"No tasks due tomorrow. Enjoy your day!",-1)])))])),t("div",Ae,[e[17]||(e[17]=t("h5",{class:"text-sm font-semibold text-gray-500 mb-2"},"Completed Tasks",-1)),C.value?(a(),o("div",Fe,"Loading completed tasks...")):h.value?(a(),o("div",He,n(h.value),1)):b.value&&g.value===0?(a(),o("div",Re," No completed tasks yet. ")):(a(),o("div",{key:3,class:u([{hidden:!y.value},"space-y-2 text-sm text-gray-400"])},[(a(!0),o(w,null,j(f.value,s=>(a(),o("div",{key:s.name,class:"flex items-center justify-between p-2 rounded-lg bg-gray-50"},[t("span",Ue,n(s.name),1),t("div",Oe,[e[16]||(e[16]=t("span",{class:"px-2 py-1 text-xs font-semibold text-green-800 bg-green-100 rounded-full"},"Complete",-1)),t("a",{href:"#",class:"text-xs text-indigo-600 font-medium hover:underline transition-all-colors","aria-label":`View details for task: ${s.name}`},"View",8,We)])]))),128))],2)),b.value?(a(),o("button",{key:5,onClick:$,class:"mt-4 text-indigo-600 text-sm font-medium hover:underline transition-all-colors","aria-expanded":y.value},[y.value?(a(),o("span",Ge,"Hide Completed ("+n(g.value)+")",1)):(a(),o("span",qe,"Show "+n(g.value)+" Completed Task"+n(g.value>1?"s":""),1))],8,Xe)):(a(),o("button",{key:4,onClick:$,class:"mt-4 text-indigo-600 text-sm font-medium hover:underline transition-all-colors"}," View Completed Tasks "))])])])):(a(),o("div",Ie,[t("div",Je,[t("p",null,[e[19]||(e[19]=p("Last Email Sent: ",-1)),t("span",Ke,n(l.project.communication.lastSent),1)]),t("p",null,[e[20]||(e[20]=p("Last Email Received: ",-1)),t("span",Qe,n(l.project.communication.lastReceived),1)])])]))])):(a(),o("div",Ye,[t("div",Ze,[e[27]||(e[27]=t("h3",{class:"text-lg font-semibold text-gray-900 mb-3"},"My Tasks",-1)),t("div",et,[t("button",{class:u(["task-tab-button flex-1 text-sm font-medium py-1 transition-all-colors",{"text-gray-900 border-b-2 border-indigo-600":d.value==="today","text-gray-500 hover:text-gray-900":d.value!=="today"}]),onClick:e[5]||(e[5]=s=>d.value="today")},[e[21]||(e[21]=p(" Today ",-1)),t("span",tt,n(l.project.tasks.today.length),1)],2),t("button",{class:u(["task-tab-button flex-1 text-sm font-medium py-1 transition-all-colors",{"text-gray-900 border-b-2 border-indigo-600":d.value==="tomorrow","text-gray-500 hover:text-gray-900":d.value!=="tomorrow"}]),onClick:e[6]||(e[6]=s=>d.value="tomorrow")},[e[22]||(e[22]=p(" Tomorrow ",-1)),t("span",st,n(l.project.tasks.tomorrow.length),1)],2)]),d.value==="today"?(a(),o("div",ot,[l.project.tasks.today.length?(a(),o("div",at,[(a(!0),o(w,null,j(l.project.tasks.today,s=>(a(),o("div",{key:s.name,class:"flex items-center justify-between p-2 rounded-lg bg-gray-50"},[t("span",lt,n(s.name),1),t("div",nt,[c(s.status)?(a(),o("span",{key:0,class:u(c(s.status).classes)},n(c(s.status).label),3)):k("",!0),t("a",{href:"#",class:"text-xs text-indigo-600 font-medium hover:underline transition-all-colors","aria-label":`View details for task: ${s.name}`},"View",8,rt)])]))),128))])):(a(),o("div",it,e[23]||(e[23]=[t("p",null,"No tasks due today. Well done!",-1)])))])):(a(),o("div",dt,[l.project.tasks.tomorrow.length?(a(),o("div",ut,[(a(!0),o(w,null,j(l.project.tasks.tomorrow,s=>(a(),o("div",{key:s.name,class:"flex items-center justify-between p-2 rounded-lg bg-gray-50"},[t("span",null,n(s.name),1),t("div",ct,[c(s.status)?(a(),o("span",{key:0,class:u(c(s.status).classes)},n(c(s.status).label),3)):k("",!0),t("a",{href:"#",class:"text-xs text-indigo-600 font-medium hover:underline transition-all-colors","aria-label":`View details for task: ${s.name}`},"View",8,mt)])]))),128))])):(a(),o("div",xt,e[24]||(e[24]=[t("p",null,"No tasks due tomorrow. Enjoy your day!",-1)])))])),t("div",vt,[e[26]||(e[26]=t("h5",{class:"text-sm font-semibold text-gray-500 mb-2"},"Completed Tasks",-1)),C.value?(a(),o("div",yt,"Loading completed tasks...")):h.value?(a(),o("div",gt,n(h.value),1)):b.value&&g.value===0?(a(),o("div",bt," No completed tasks yet. ")):(a(),o("div",{key:3,class:u([{hidden:!y.value},"space-y-2 text-sm text-gray-400"])},[(a(!0),o(w,null,j(f.value,s=>(a(),o("div",{key:s.name,class:"flex items-center justify-between p-2 rounded-lg bg-gray-50"},[t("span",ft,n(s.name),1),t("div",pt,[e[25]||(e[25]=t("span",{class:"px-2 py-1 text-xs font-semibold text-green-800 bg-green-100 rounded-full"},"Complete",-1)),t("a",{href:"#",class:"text-xs text-indigo-600 font-medium hover:underline transition-all-colors","aria-label":`View details for task: ${s.name}`},"View",8,ht)])]))),128))],2)),b.value?(a(),o("button",{key:5,onClick:$,class:"mt-4 text-indigo-600 text-sm font-medium hover:underline transition-all-colors","aria-expanded":y.value},[y.value?(a(),o("span",jt,"Hide Completed ("+n(g.value)+")",1)):(a(),o("span",wt,"Show "+n(g.value)+" Completed Task"+n(g.value>1?"s":""),1))],8,kt)):(a(),o("button",{key:4,onClick:$,class:"mt-4 text-indigo-600 text-sm font-medium hover:underline transition-all-colors"}," View Completed Tasks "))])]),t("div",_t,[t("h3",Ct,"Current Milestone: "+n(l.project.milestone.name),1),t("p",Tt,[l.project.milestone.completed!=null&&l.project.milestone.left!=null?(a(),o("span",Vt,n(l.project.milestone.completed)+" completed • "+n(l.project.milestone.left)+" left ",1)):(a(),o("span",$t,"Progress overview"))]),t("div",Lt,[t("div",{class:"bg-indigo-600 h-2.5 rounded-full",style:Y(`width: ${l.project.milestone.progress}%`)},null,4)]),t("p",St,n(l.project.milestone.progress)+"% Complete",1),t("p",Mt,n(l.project.milestone.incentive),1)])]))],512))}};export{Et as default};
