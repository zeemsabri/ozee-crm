import{c as g,r as c,f as L,e as C,a as i,o as r,b as t,d as n,m as U,u as h,F as S,l as M,v as V,x as _,i as B}from"./app-uz7jLOH9.js";import{u as K}from"./workflowStore-D4SanAPs.js";import{S as f}from"./SelectDropdown-tY2220Dt.js";import T from"./VariablePicker-Dy4X-qL4.js";import{P as A}from"./plus-DLaMPQe8.js";import{c as E}from"./createLucideIcon-lO9WsaxY.js";/* empty css                                                                       */import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./chevron-down-7cvHRzRk.js";/**
 * @license lucide-vue-next v0.536.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $=E("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]),P={class:"space-y-4"},R={class:"flex items-center justify-between"},H={key:0,class:"mt-2 space-y-2"},I={class:"flex items-center gap-2"},Q={class:"w-1/2 flex items-center gap-2"},W=["onUpdate:modelValue"],q=["onClick"],z={key:1,class:"text-center text-xs text-gray-500 py-4 border-2 border-dashed rounded-lg mt-2"},G={class:"grid grid-cols-2 gap-4"},J={class:"flex items-center justify-between"},X={key:0,class:"mt-2 space-y-2"},Y={class:"flex items-center gap-2"},Z=["onClick"],re={__name:"QueryDataConfig",setup(ee){const y=K(),d=g(()=>y.selectedStep),j=g(()=>y.automationSchema),k=g(()=>{var a;return((a=j.value)==null?void 0:a.models)||[]}),u=c(null),m=c([]),b=c(50),p=c([]),x=c(""),w=g(()=>{if(!u.value)return[];const a=k.value.find(s=>s.name===u.value);if(!a)return[];const e=(a.columns||[]).map(s=>({value:s,label:s})),l=(a.relationships||[]).flatMap(s=>(s.columns||[]).map(o=>({value:`${s.name}.${o}`,label:`${s.name}.${o}`})));return[...e,...l]});L(()=>{Object.keys(y.automationSchema).length||y.fetchAutomationSchema()}),C(d,a=>{if(!a)return;const e=a.step_config||{};u.value=e.model||e.target_model||null,m.value=Array.isArray(e.conditions)?e.conditions.map(l=>({field:l.field||"",op:l.op||l.operator||"=",value:l.value??""})):[],b.value=e.limit??50,p.value=Array.isArray(e.order)?e.order.map(l=>({field:l.field||"",dir:(l.dir||"asc").toLowerCase()})):[],x.value=e.output_key||""},{immediate:!0}),C([u,m,b,p,x],([a,e,l,s,o])=>{d.value&&((!d.value.step_config||typeof d.value.step_config!="object"||Array.isArray(d.value.step_config))&&(d.value.step_config={}),d.value.step_config.model=a,d.value.step_config.conditions=e.map(v=>({field:v.field,op:v.op,value:v.value})),d.value.step_config.limit=l,d.value.step_config.order=s.map(v=>({field:v.field,dir:v.dir})),d.value.step_config.output_key=o)},{deep:!0});function O(){m.value.push({field:"",op:"=",value:""})}function F(a){m.value.splice(a,1)}function N(){p.value.push({field:"",dir:"asc"})}function D(a){p.value.splice(a,1)}return(a,e)=>(r(),i("div",P,[t("div",null,[e[3]||(e[3]=t("label",{class:"block text-xs font-medium text-gray-700"},"Model",-1)),n(f,{modelValue:u.value,"onUpdate:modelValue":e[0]||(e[0]=l=>u.value=l),options:k.value,valueKey:"name",labelKey:"name",placeholder:"Select a model...",class:"w-full mt-1"},null,8,["modelValue","options"])]),t("div",null,[t("div",R,[e[5]||(e[5]=t("label",{class:"text-xs font-medium text-gray-700"},"Conditions",-1)),t("button",{onClick:O,class:"flex items-center gap-1 px-2 py-1 text-xs rounded-md bg-gray-100 hover:bg-gray-200"},[n(h(A),{class:"w-3 h-3"}),e[4]||(e[4]=U(" Add Condition ",-1))])]),m.value.length?(r(),i("div",H,[(r(!0),i(S,null,M(m.value,(l,s)=>(r(),i("div",{key:s,class:"p-2 border rounded-md bg-gray-50/50 space-y-2"},[t("div",I,[n(f,{modelValue:l.field,"onUpdate:modelValue":o=>l.field=o,options:w.value,placeholder:"Field...",class:"w-1/3",disabled:!u.value},null,8,["modelValue","onUpdate:modelValue","options","disabled"]),n(f,{modelValue:l.op,"onUpdate:modelValue":o=>l.op=o,options:[{value:"=",label:"="},{value:"!=",label:"!="},{value:">",label:">"},{value:">=",label:">="},{value:"<",label:"<"},{value:"<=",label:"<="},{value:"in",label:"in"},{value:"not in",label:"not in"},{value:"null",label:"is null"},{value:"not null",label:"is not null"}],class:"w-1/6"},null,8,["modelValue","onUpdate:modelValue"]),t("div",Q,[V(t("input",{"onUpdate:modelValue":o=>l.value=o,type:"text",class:"w-full border rounded px-2 py-1 text-sm",placeholder:"Value or {{ variable }}"},null,8,W),[[_,l.value]]),n(T,{onSelect:o=>l.value=(l.value||"")+(l.value?" ":"")+o},null,8,["onSelect"])]),t("button",{onClick:o=>F(s),class:"text-red-500 hover:text-red-700 p-1",title:"Remove"},[n(h($),{class:"w-3 h-3"})],8,q)])]))),128))])):(r(),i("div",z,"No conditions defined."))]),t("div",G,[t("div",null,[e[6]||(e[6]=t("label",{class:"block text-xs font-medium text-gray-700"},"Limit",-1)),V(t("input",{"onUpdate:modelValue":e[1]||(e[1]=l=>b.value=l),type:"number",min:"1",class:"mt-1 w-full border rounded px-2 py-1 text-sm"},null,512),[[_,b.value,void 0,{number:!0}]])]),t("div",null,[e[7]||(e[7]=t("label",{class:"block text-xs font-medium text-gray-700"},"Output key (optional)",-1)),V(t("input",{"onUpdate:modelValue":e[2]||(e[2]=l=>x.value=l),type:"text",class:"mt-1 w-full border rounded px-2 py-1 text-sm",placeholder:"e.g., open_tasks"},null,512),[[_,x.value]])])]),t("div",null,[t("div",J,[e[9]||(e[9]=t("label",{class:"text-xs font-medium text-gray-700"},"Order (optional)",-1)),t("button",{onClick:N,class:"flex items-center gap-1 px-2 py-1 text-xs rounded-md bg-gray-100 hover:bg-gray-200"},[n(h(A),{class:"w-3 h-3"}),e[8]||(e[8]=U(" Add Order ",-1))])]),p.value.length?(r(),i("div",X,[(r(!0),i(S,null,M(p.value,(l,s)=>(r(),i("div",{key:s,class:"p-2 border rounded-md bg-gray-50/50"},[t("div",Y,[n(f,{modelValue:l.field,"onUpdate:modelValue":o=>l.field=o,options:w.value,placeholder:"Field...",class:"w-2/3",disabled:!u.value},null,8,["modelValue","onUpdate:modelValue","options","disabled"]),n(f,{modelValue:l.dir,"onUpdate:modelValue":o=>l.dir=o,options:[{value:"asc",label:"ASC"},{value:"desc",label:"DESC"}],class:"w-1/3"},null,8,["modelValue","onUpdate:modelValue"]),t("button",{onClick:o=>D(s),class:"text-red-500 hover:text-red-700 p-1",title:"Remove"},[n(h($),{class:"w-3 h-3"})],8,Z)])]))),128))])):B("",!0)])]))}};export{re as default};
