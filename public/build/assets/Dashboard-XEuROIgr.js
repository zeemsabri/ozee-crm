import{a as K,_ as Q}from"./AuthenticatedLayout-CJRHwKwr.js";import{r as i,s as G,D as R,B as J,E as X,i as s,g as U,o as a,b as e,e as w,m as h,t as r,a as B,n as F,x as C,G as H,h as V,y as Z,F as P,j as M,l as q}from"./app-BEGXechp.js";import{_ as ee}from"./NotesModal-CnVYymEV.js";import{P as te}from"./PrimaryButton-DBVTQtvu.js";import"./ApplicationLogo-Zvxb_wRT.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./SecondaryButton-DO21bkX7.js";import"./InputError-QsKi4b0m.js";import"./TextInput-DFsgeRCC.js";const se={class:"flex"},ae={class:"flex-shrink-0"},le={key:0,class:"h-5 w-5 text-red-500",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},oe={key:1,class:"h-5 w-5 text-indigo-500",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},ie={class:"ml-3 flex-1 md:flex md:justify-between"},ne={key:0,class:"text-sm text-indigo-700"},re={key:1,class:"text-sm text-green-700"},de={key:2,class:"text-sm text-red-700 font-medium"},ue={key:3,class:"text-sm text-green-700"},ce={class:"mt-3 text-sm md:mt-0 md:ml-6"},ve={__name:"AvailabilityPrompt",setup(O){const T=i(!1),y=i(!0),g=i([]),_=i(!1),k=i(""),v=i(!1),p=i(!1),m=i(null),b=i(!1),d=G(()=>{var l;return((l=R().props.auth.user)==null?void 0:l.id)||null}),$=()=>{const l=localStorage.getItem("authToken");l&&!C.defaults.headers.common.Authorization&&(C.defaults.headers.common.Authorization=`Bearer ${l}`,console.log("Auth headers set in AvailabilityPrompt"))},x=async()=>{y.value=!0,k.value="";try{$();const l=await C.get("/api/availability-prompt");T.value=l.data.should_show_prompt,v.value=l.data.should_block_user,p.value=l.data.all_weekdays_covered,m.value=l.data.current_day,b.value=l.data.is_thursday_to_saturday,T.value&&j(l.data.next_week_start,l.data.next_week_end),localStorage.setItem("shouldBlockUser",v.value),localStorage.setItem("allWeekdaysCovered",p.value);const c=new CustomEvent("availability-status-updated",{detail:{shouldBlockUser:v.value,allWeekdaysCovered:p.value}});window.dispatchEvent(c)}catch(l){console.error("Error checking availability prompt:",l),T.value=!1,l.response&&l.response.status===401&&(l.value="Authentication error. Please refresh the page or log in again.")}finally{y.value=!1}},j=(l,c)=>{const E=[],W=new Date(l),n=new Date(c),t=new Date(W);for(;t<=n;)E.push({value:t.toISOString().split("T")[0],label:t.toLocaleDateString("en-US",{weekday:"long",month:"short",day:"numeric"})}),t.setDate(t.getDate()+1);g.value=E},I=()=>{_.value=!0},L=()=>{x()},N=()=>{document.visibilityState==="visible"&&H(()=>{x()})},z=l=>{(l.key==="shouldBlockUser"||l.key==="allWeekdaysCovered")&&H(()=>{x()})};return J(()=>{x(),document.addEventListener("visibilitychange",N),window.addEventListener("storage",z)}),X(()=>{document.removeEventListener("visibilitychange",N),window.removeEventListener("storage",z)}),(l,c)=>T.value&&!y.value?(a(),s("div",{key:0,class:F(["border-l-4 p-4 mb-6 rounded-md shadow-sm",v.value?"bg-red-50 border-red-500":"bg-indigo-50 border-indigo-500"])},[e("div",se,[e("div",ae,[v.value?(a(),s("svg",le,c[1]||(c[1]=[e("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"},null,-1)]))):(a(),s("svg",oe,c[2]||(c[2]=[e("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z","clip-rule":"evenodd"},null,-1)])))]),e("div",ie,[m.value===4&&!p.value?(a(),s("p",ne," Please submit your availability for next week. This helps in planning meetings and work schedules. ")):m.value===4&&p.value?(a(),s("p",re," Thank you for submitting your availability for next week! You can still update it if needed. ")):(m.value===5||m.value===6)&&!p.value?(a(),s("p",de,[c[3]||(c[3]=e("span",{class:"font-bold"},"Action Required:",-1)),h(" You must submit your availability for all weekdays of next week. "+r(v.value?"Other features are currently blocked until you complete this task.":""),1)])):(m.value===5||m.value===6)&&p.value?(a(),s("p",ue," Thank you for submitting your availability for next week! You can still update it if needed. ")):U("",!0),e("p",ce,[w(te,{onClick:I,class:F(["whitespace-nowrap",{"bg-red-600 hover:bg-red-700":v.value}])},{default:B(()=>[h(r(p.value?"Update Availability":"Submit Availability"),1)]),_:1},8,["class"])])])]),w(K,{show:_.value,"next-week-dates":g.value,date:g.value.length>0?g.value[0].value:"",userId:d.value,onClose:c[0]||(c[0]=E=>_.value=!1),onAvailabilitySaved:L},null,8,["show","next-week-dates","date","userId"])],2)):U("",!0)}},pe={class:"py-12"},me={class:"mx-auto max-w-7xl sm:px-6 lg:px-8 space-y-6"},xe={class:"overflow-hidden bg-white shadow-sm sm:rounded-lg"},he={class:"p-6 text-gray-900"},ye={class:"mt-1 text-sm text-gray-600"},ge={class:"font-medium"},_e={class:"mt-4"},fe={key:0,class:"text-sm text-gray-500"},we={key:1,class:"text-sm text-red-500"},ke={key:2,class:"text-sm text-gray-500"},be={key:3,class:"mt-3"},De={class:"grid grid-cols-7 gap-2 mt-2"},Se={key:0,class:"text-sm"},Ae={key:1,class:"text-gray-400"},Te={key:1,class:"text-sm text-gray-400"},Ce={class:"overflow-hidden bg-white shadow-sm sm:rounded-lg"},$e={class:"p-6 text-gray-900"},je={class:"flex justify-between items-center"},Ne={class:"mt-1 text-sm text-gray-600"},Ee={class:"font-bold"},Pe={key:0,class:"mt-4"},Be={key:0,class:"text-sm text-gray-500"},Ie={key:1,class:"text-sm text-red-500"},Le={key:2,class:"text-sm text-gray-500"},ze={key:3,class:"mt-3"},Me={class:"min-w-full divide-y divide-gray-200"},Ue={class:"bg-white divide-y divide-gray-200"},We={class:"px-3 py-2 whitespace-nowrap text-sm"},Ve={class:"px-3 py-2 whitespace-nowrap text-sm capitalize"},Fe={class:"px-3 py-2 whitespace-nowrap text-sm"},Oe={class:"flex space-x-2"},Ye=["onClick"],He={class:"overflow-hidden bg-white shadow-sm sm:rounded-lg"},qe={class:"p-6 text-gray-900"},Ge={class:"flex justify-between items-center"},Re={class:"mt-1 text-sm text-gray-600"},Je={class:"font-bold"},Ke={key:0,class:"mt-4"},Qe={key:0,class:"text-sm text-gray-500"},Xe={key:1,class:"text-sm text-red-500"},Ze={key:2,class:"text-sm text-gray-500"},et={key:3,class:"mt-3"},tt={class:"min-w-full divide-y divide-gray-200"},st={class:"bg-white divide-y divide-gray-200"},at={class:"px-3 py-2 whitespace-nowrap text-sm"},lt={class:"px-3 py-2 whitespace-nowrap text-sm"},ot={class:"px-3 py-2 whitespace-nowrap text-sm"},it={class:"px-3 py-2 whitespace-nowrap text-sm"},nt={class:"px-3 py-2 whitespace-nowrap text-sm"},rt={class:"flex space-x-2"},gt={__name:"Dashboard",props:{projectCount:Number},setup(O){const T=G(()=>R().props.auth.user),y=i([]),g=i(!0),_=i(""),k=i(!1),v=i({total_due_tasks:0,projects:[]}),p=i(!1),m=i(""),b=i(!1),d=i({availabilities:[],start_date:"",end_date:""}),$=i(!1),x=i(""),j=i(!1),I=i(null),L=async()=>{g.value=!0,_.value="";try{const n=await C.get("/api/projects-simplified");y.value=n.data}catch(n){_.value="Failed to load projects",console.error("Error fetching projects:",n)}finally{g.value=!1}},N=async()=>{p.value=!0,m.value="";try{const n=await C.get("/api/task-statistics");v.value=n.data}catch(n){m.value="Failed to load task statistics",console.error("Error fetching task statistics:",n)}finally{p.value=!1}},z=()=>{k.value=!k.value,k.value&&y.value.length===0&&L()},l=()=>{b.value=!b.value,b.value&&v.value.projects.length===0&&N()},c=n=>{I.value=n,j.value=!0},E=()=>{L()},W=async()=>{$.value=!0,x.value="";try{const n=new Date,t=new Date(n);t.setDate(n.getDate()-n.getDay()+(n.getDay()===0?-6:1));const o=new Date(t);o.setDate(t.getDate()+6);const u=S=>S.toISOString().split("T")[0],D=await C.get("/api/availabilities",{params:{user_id:T.value.id,start_date:u(t),end_date:u(o)}});d.value=D.data}catch(n){x.value="Failed to load availability data",console.error("Error fetching weekly availability:",n)}finally{$.value=!1}};return J(()=>{N(),W()}),(n,t)=>(a(),s(P,null,[w(V(Z),{title:"Dashboard"}),w(Q,null,{header:B(()=>t[1]||(t[1]=[e("h2",{class:"text-xl font-semibold leading-tight text-gray-800"}," Dashboard ",-1)])),default:B(()=>[e("div",pe,[e("div",me,[w(ve),e("div",xe,[e("div",he,[t[3]||(t[3]=e("h3",{class:"text-lg font-medium text-gray-900"},"Your Weekly Availability",-1)),e("p",ye,[t[2]||(t[2]=h(" Current week: ",-1)),e("span",ge,r(d.value.start_date?new Date(d.value.start_date).toLocaleDateString():"")+" to "+r(d.value.end_date?new Date(d.value.end_date).toLocaleDateString():""),1)]),e("div",_e,[$.value?(a(),s("div",fe,"Loading availability data...")):x.value?(a(),s("div",we,r(x.value),1)):!d.value.availabilities||d.value.availabilities.length===0?(a(),s("div",ke," No availability data found for this week. ")):(a(),s("div",be,[e("div",De,[(a(),s(P,null,M(["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],o=>e("div",{key:o,class:"text-center text-xs font-medium text-gray-500"},r(o),1)),64)),(a(),s(P,null,M(7,o=>e("div",{key:"day-"+o,class:"h-10 border rounded-md flex items-center justify-center"},[d.value.start_date?(a(),s("div",Se,[(()=>{const u=new Date(d.value.start_date);u.setDate(u.getDate()+o-1);const D=u.toISOString().split("T")[0];return d.value.availabilities.filter(S=>S.date.split("T")[0]===D).length>0})()?(a(),s("span",{key:0,class:F((()=>{const u=new Date(d.value.start_date);u.setDate(u.getDate()+o-1);const D=u.toISOString().split("T")[0];return d.value.availabilities.filter(A=>A.date.split("T")[0]===D).some(A=>!A.is_available)?"text-red-600":"text-green-600"})())},r((()=>{const u=new Date(d.value.start_date);u.setDate(u.getDate()+o-1);const D=u.toISOString().split("T")[0],S=d.value.availabilities.filter(f=>f.date.split("T")[0]===D);if(S.some(f=>!f.is_available))return"Unavailable";const A=[];return S.forEach(f=>{f.is_available&&f.time_slots&&Array.isArray(f.time_slots)&&f.time_slots.forEach(Y=>{A.push(`${Y.start_time} - ${Y.end_time}`)})}),A.length>0?A.join(", "):"Available (No time slots)"})()),3)):(a(),s("span",Ae,"-"))])):(a(),s("div",Te,"-"))])),64))])]))])])]),e("div",Ce,[e("div",$e,[e("div",je,[t[4]||(t[4]=e("h3",{class:"text-lg font-medium text-gray-900"},"Projects",-1)),e("button",{onClick:z,class:"text-sm text-blue-600 hover:text-blue-800"},r(k.value?"Collapse":"Expand"),1)]),e("p",Ne,[t[5]||(t[5]=h(" You have access to ",-1)),e("span",Ee,r(O.projectCount),1),t[6]||(t[6]=h(" project(s). ",-1))]),k.value?(a(),s("div",Pe,[g.value?(a(),s("div",Be,"Loading projects...")):_.value?(a(),s("div",Ie,r(_.value),1)):y.value.length===0?(a(),s("div",Le,"No projects found.")):(a(),s("div",ze,[e("table",Me,[t[8]||(t[8]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{scope:"col",class:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Name"),e("th",{scope:"col",class:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Status"),e("th",{scope:"col",class:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Actions")])],-1)),e("tbody",Ue,[(a(!0),s(P,null,M(y.value,o=>(a(),s("tr",{key:o.id},[e("td",We,r(o.name),1),e("td",Ve,r(o.status.replace("_"," ")),1),e("td",Fe,[e("div",Oe,[w(V(q),{href:`/projects/${o.id}`,class:"text-xs bg-blue-500 hover:bg-blue-700 text-white py-1 px-2 rounded"},{default:B(()=>t[7]||(t[7]=[h(" View ",-1)])),_:2,__:[7]},1032,["href"]),e("button",{onClick:u=>c(o.id),class:"text-xs bg-purple-500 hover:bg-purple-700 text-white py-1 px-2 rounded"}," Notes ",8,Ye)])])]))),128))])])]))])):U("",!0)])]),e("div",He,[e("div",qe,[e("div",Ge,[t[9]||(t[9]=e("h3",{class:"text-lg font-medium text-gray-900"},"Due Tasks",-1)),e("button",{onClick:l,class:"text-sm text-blue-600 hover:text-blue-800"},r(b.value?"Collapse":"Expand"),1)]),e("p",Re,[t[10]||(t[10]=h(" You have ",-1)),e("span",Je,r(v.value.total_due_tasks),1),t[11]||(t[11]=h(" task(s) due. ",-1))]),b.value?(a(),s("div",Ke,[p.value?(a(),s("div",Qe,"Loading tasks...")):m.value?(a(),s("div",Xe,r(m.value),1)):v.value.projects.length===0?(a(),s("div",Ze,"No due tasks found.")):(a(),s("div",et,[e("table",tt,[t[13]||(t[13]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{scope:"col",class:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Project Name"),e("th",{scope:"col",class:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Due Tasks"),e("th",{scope:"col",class:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Due Today"),e("th",{scope:"col",class:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Assigned Me"),e("th",{scope:"col",class:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Actions")])],-1)),e("tbody",st,[(a(!0),s(P,null,M(v.value.projects,o=>(a(),s("tr",{key:o.id},[e("td",at,r(o.name),1),e("td",lt,r(o.due_tasks),1),e("td",ot,r(o.due_today),1),e("td",it,r(o.assigned_to_me),1),e("td",nt,[e("div",rt,[w(V(q),{href:`/projects/${o.id}`,class:"text-xs bg-blue-500 hover:bg-blue-700 text-white py-1 px-2 rounded"},{default:B(()=>t[12]||(t[12]=[h(" View ",-1)])),_:2,__:[12]},1032,["href"])])])]))),128))])])]))])):U("",!0)])]),t[14]||(t[14]=e("div",{class:"overflow-hidden bg-white shadow-sm sm:rounded-lg"},[e("div",{class:"p-6 text-gray-900"},[e("h3",{class:"text-lg font-medium text-gray-900"},"Notice Board"),e("p",{class:"mt-1 text-sm text-gray-600"}," No new announcements at this time. ")])],-1))])]),w(ee,{show:j.value,"project-id":I.value,onClose:t[0]||(t[0]=o=>j.value=!1),onNoteAdded:E},null,8,["show","project-id"])]),_:1})],64))}};export{gt as default};
