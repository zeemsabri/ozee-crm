import{r as v,s as j,c as k,p as S,e as A,g as N,o as T,w as q,b as d,t as F,d as s,q as h,v as z,m as P}from"./app-cfLvAf14.js";import{_ as B}from"./Modal-BffzNclU.js";import{_ as r}from"./InputLabel-D-91TLny.js";import{_ as g}from"./TextInput-DKI04P3v.js";import{_ as m}from"./InputError-BghqWSy7.js";import{_ as E}from"./PrimaryButton-CXpmVcsZ.js";import{_ as M}from"./SecondaryButton-DUH3s1jv.js";import{S as D}from"./SelectDropdown-BFDCWom8.js";function I(){const y=v([]),w=v(!1),c=v(""),p=v(1),V=v(15),b=v(0),n=v(1),u=j({q:"",status:"",source:"",assigned_to_id:""}),e=v([]),L=async()=>{try{const{data:o}=await S.get("/api/users");e.value=o}catch(o){console.error("Failed to load users",o)}},_=async()=>{var o,f;w.value=!0,c.value="";try{const i={page:p.value,per_page:V.value};u.q&&(i.q=u.q),u.status&&(i.status=u.status),u.source&&(i.source=u.source),u.assigned_to_id&&(i.assigned_to_id=u.assigned_to_id);const{data:x}=await S.get("/api/leads",{params:i});y.value=x.data??x;const U=x.meta??null;U?(p.value=U.current_page,V.value=U.per_page,b.value=U.total,n.value=U.last_page):(b.value=Array.isArray(y.value)?y.value.length:0,n.value=1)}catch(i){console.error("Error fetching leads",i),c.value=((f=(o=i==null?void 0:i.response)==null?void 0:o.data)==null?void 0:f.message)||"Failed to fetch leads.",i.response&&i.response.status===401&&(localStorage.removeItem("authToken"),window.location.href="/login")}finally{w.value=!1}},O=async o=>{o<1||o>n.value||(p.value=o,await _())},C=async()=>{u.q="",u.status="",u.source="",u.assigned_to_id="",p.value=1,await _()},$=async o=>{c.value="";const{data:f}=await S.post("/api/leads",o);return await _(),f},l=async(o,f)=>{c.value="";const{data:i}=await S.put(`/api/leads/${o}`,f);return await _(),i},a=async o=>{c.value="",await S.delete(`/api/leads/${o}`),await _()},t=k(()=>{const o={new:[],contacted:[],qualified:[],converted:[],lost:[]};for(const f of y.value){const i=(f.status||"new").toLowerCase();o[i]||(o[i]=[]),o[i].push(f)}return o});return{leads:y,loading:w,generalError:c,currentPage:p,perPage:V,total:b,lastPage:n,filters:u,users:e,leadsByStatus:t,fetchUsers:L,fetchLeads:_,changePage:O,resetFilters:C,createLead:$,updateLead:l,deleteLead:a}}const W={class:"p-6"},G={class:"text-lg font-semibold mb-4"},H={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},J={class:"md:col-span-2"},K={class:"mt-6 flex justify-end gap-2"},Q={__name:"LeadFormModal",props:{show:{type:Boolean,default:!1},lead:{type:Object,default:null},users:{type:Array,default:()=>[]},sourceOptions:{type:Array,default:()=>[]},statusOptions:{type:Array,default:()=>[]}},emits:["close","lead-created","lead-updated"],setup(y,{emit:w}){const c=y,p=w,{createLead:V,updateLead:b}=I(),n=v({}),u=v(!1),e=j({id:null,first_name:"",last_name:"",email:"",phone:"",company:"",title:"",status:"new",source:"",pipeline_stage:"",estimated_value:"",currency:"USD",assigned_to_id:null,website:"",country:"",state:"",city:"",address:"",zip:"",tags:"",notes:""}),L=k(()=>(c.users||[]).map(l=>({label:l.name,value:l.id}))),_=k(()=>c.statusOptions||[]),O=k(()=>c.sourceOptions||[]),C=l=>{if(!l){Object.assign(e,{id:null,first_name:"",last_name:"",email:"",phone:"",company:"",title:"",status:"new",source:"",pipeline_stage:"",estimated_value:"",currency:"USD",assigned_to_id:null,website:"",country:"",state:"",city:"",address:"",zip:"",tags:"",notes:""}),n.value={};return}Object.assign(e,{id:l.id,first_name:l.first_name||"",last_name:l.last_name||"",email:l.email||"",phone:l.phone||"",company:l.company||"",title:l.title||"",status:l.status||"new",source:l.source||"",pipeline_stage:l.pipeline_stage||"",estimated_value:l.estimated_value??"",currency:l.currency||"USD",assigned_to_id:l.assigned_to_id||null,website:l.website||"",country:l.country||"",state:l.state||"",city:l.city||"",address:l.address||"",zip:l.zip||"",tags:l.tags||"",notes:l.notes||""}),n.value={}};A(()=>c.lead,l=>C(l),{immediate:!0});const $=async()=>{var t;u.value=!0,n.value={};const l=(e.first_name||"").trim(),a=(e.last_name||"").trim();if(!l&&!a){n.value={first_name:"Please enter at least a first or last name."},u.value=!1;return}try{if(e.id){const o=await b(e.id,e);p("lead-updated",o)}else{const o=await V(e);p("lead-created",o)}p("close")}catch(o){((t=o==null?void 0:o.response)==null?void 0:t.status)===422?n.value=o.response.data.errors||{}:console.error("Save failed",o)}finally{u.value=!1}};return(l,a)=>(T(),N(B,{show:c.show,onClose:a[15]||(a[15]=t=>p("close"))},{default:q(()=>[d("div",W,[d("h3",G,F(e.id?"Edit Lead":"Create Lead"),1),d("div",H,[d("div",null,[s(r,{value:"First Name"}),s(g,{modelValue:e.first_name,"onUpdate:modelValue":a[0]||(a[0]=t=>e.first_name=t),class:"mt-1 block w-full"},null,8,["modelValue"]),s(m,{message:n.value.first_name,class:"mt-1"},null,8,["message"])]),d("div",null,[s(r,{value:"Last Name"}),s(g,{modelValue:e.last_name,"onUpdate:modelValue":a[1]||(a[1]=t=>e.last_name=t),class:"mt-1 block w-full"},null,8,["modelValue"]),s(m,{message:n.value.last_name,class:"mt-1"},null,8,["message"])]),d("div",null,[s(r,{value:"Email"}),s(g,{modelValue:e.email,"onUpdate:modelValue":a[2]||(a[2]=t=>e.email=t),class:"mt-1 block w-full"},null,8,["modelValue"]),s(m,{message:n.value.email,class:"mt-1"},null,8,["message"])]),d("div",null,[s(r,{value:"Phone"}),s(g,{modelValue:e.phone,"onUpdate:modelValue":a[3]||(a[3]=t=>e.phone=t),class:"mt-1 block w-full"},null,8,["modelValue"]),s(m,{message:n.value.phone,class:"mt-1"},null,8,["message"])]),d("div",null,[s(r,{value:"Company"}),s(g,{modelValue:e.company,"onUpdate:modelValue":a[4]||(a[4]=t=>e.company=t),class:"mt-1 block w-full"},null,8,["modelValue"]),s(m,{message:n.value.company,class:"mt-1"},null,8,["message"])]),d("div",null,[s(r,{value:"Title"}),s(g,{modelValue:e.title,"onUpdate:modelValue":a[5]||(a[5]=t=>e.title=t),class:"mt-1 block w-full"},null,8,["modelValue"]),s(m,{message:n.value.title,class:"mt-1"},null,8,["message"])]),d("div",null,[s(r,{value:"Status"}),s(D,{options:_.value,modelValue:e.status,"onUpdate:modelValue":a[6]||(a[6]=t=>e.status=t),placeholder:"Select status"},null,8,["options","modelValue"]),s(m,{message:n.value.status,class:"mt-1"},null,8,["message"])]),d("div",null,[s(r,{value:"Source"}),s(D,{options:O.value,modelValue:e.source,"onUpdate:modelValue":a[7]||(a[7]=t=>e.source=t),placeholder:"Select source"},null,8,["options","modelValue"]),s(m,{message:n.value.source,class:"mt-1"},null,8,["message"])]),d("div",null,[s(r,{value:"Assigned To"}),s(D,{options:L.value,modelValue:e.assigned_to_id,"onUpdate:modelValue":a[8]||(a[8]=t=>e.assigned_to_id=t),placeholder:"Unassigned"},null,8,["options","modelValue"]),s(m,{message:n.value.assigned_to_id,class:"mt-1"},null,8,["message"])]),d("div",null,[s(r,{value:"Estimated Value"}),s(g,{modelValue:e.estimated_value,"onUpdate:modelValue":a[9]||(a[9]=t=>e.estimated_value=t),type:"number",step:"0.01",class:"mt-1 block w-full"},null,8,["modelValue"]),s(m,{message:n.value.estimated_value,class:"mt-1"},null,8,["message"])]),d("div",null,[s(r,{value:"Currency (ISO 4217)"}),s(g,{modelValue:e.currency,"onUpdate:modelValue":a[10]||(a[10]=t=>e.currency=t),maxlength:"3",class:"mt-1 block w-full uppercase",onInput:a[11]||(a[11]=t=>e.currency=(e.currency||"").toUpperCase().slice(0,3)),placeholder:"USD"},null,8,["modelValue"]),s(m,{message:n.value.currency,class:"mt-1"},null,8,["message"])]),d("div",null,[s(r,{value:"Website"}),s(g,{modelValue:e.website,"onUpdate:modelValue":a[12]||(a[12]=t=>e.website=t),class:"mt-1 block w-full"},null,8,["modelValue"]),s(m,{message:n.value.website,class:"mt-1"},null,8,["message"])]),d("div",J,[s(r,{value:"Notes"}),h(d("textarea",{"onUpdate:modelValue":a[13]||(a[13]=t=>e.notes=t),class:"mt-1 block w-full border-gray-300 rounded-md",rows:"3"},null,512),[[z,e.notes]]),s(m,{message:n.value.notes,class:"mt-1"},null,8,["message"])])]),d("div",K,[s(M,{disabled:u.value,onClick:a[14]||(a[14]=t=>p("close"))},{default:q(()=>a[16]||(a[16]=[P("Cancel",-1)])),_:1,__:[16]},8,["disabled"]),s(E,{disabled:u.value,onClick:$},{default:q(()=>[P(F(u.value?"Saving...":e.id?"Update":"Create"),1)]),_:1},8,["disabled"])])])]),_:1},8,["show"]))}},le=Object.freeze(Object.defineProperty({__proto__:null,default:Q},Symbol.toStringTag,{value:"Module"}));export{le as L,Q as _,I as u};
