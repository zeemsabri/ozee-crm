import{p as x,z as F,r as d,s as A,w as M,A as N,h as n,o as r,e as l,u as P,q as D,a as c,b as s,g as j,t as p,F as R,i as I,k as _,d as L,c as U}from"./app-C1kCDZc3.js";import{_ as Y}from"./AuthenticatedLayout-tmoCbwqQ.js";import{P as E}from"./PrimaryButton-kJU6-6nb.js";import{_ as q,a as z}from"./SecondaryButton-BWEMHKfv.js";import{_ as V,a as T}from"./TextInput-Dd1PNkJW.js";import{_ as $}from"./InputError-H7Azy3Wi.js";import"./vue-multiselect-COcmoxJB.js";import{R as O}from"./RichTextEditor-DnR7sY21.js";import"./ApplicationLogo-C3MD2Sbk.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const G={class:"py-12"},H={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},J={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},K={class:"p-6 text-gray-900"},Q={key:0,class:"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative mb-4",role:"alert"},W={class:"block sm:inline"},X={key:1,class:"text-gray-600"},Z={key:2,class:"text-red-600"},ee={key:3,class:"text-gray-600"},te={key:4},se={class:"min-w-full divide-y divide-gray-200"},ae={class:"bg-white divide-y divide-gray-200"},oe={class:"px-6 py-4 truncate max-w-xs"},le={class:"px-6 py-4 truncate max-w-xs"},ie={class:"px-6 py-4 whitespace-nowrap"},re={class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium"},de={class:"p-6"},ne={key:0},ue={class:"mb-2"},ce={class:"mb-4"},me={class:"mb-6"},pe={class:"mt-6 flex justify-end space-x-2"},Re={__name:"Rejected",setup(ve){const k=x(()=>F().props.auth.user),b=d([]),y=d([]),g=d([]),w=d(!0),i=d(""),m=d(""),v=d(!1),f=d(null),o=A({project_id:"",client_id:"",client_ids:[],subject:"",body:""}),u=d({});x(()=>k.value.role==="contractor"?y.value.filter(e=>e.users&&e.users.some(t=>t.id===k.value.id)):y.value),x(()=>{const e=y.value.find(t=>t.id===o.project_id);return e&&Array.isArray(g.value)?g.value.find(t=>t.id===e.client_id):null}),x(()=>{if(!o.project_id)return[];const e=y.value.find(a=>a.id===o.project_id);if(!e||!e.clients)return[];const t=e.clients.map(a=>a.id);return g.value.filter(a=>t.includes(a.id))});const h=async()=>{w.value=!0,i.value="";try{const e=await window.axios.get("/api/emails/rejected-simplified");b.value=e.data}catch(e){i.value="Failed to load data.",console.error("Error fetching initial data:",e),e.response&&(e.response.status===401||e.response.status===403)&&(i.value="You are not authorized to view this content or your session expired. Please log in.")}finally{w.value=!1}},C=e=>{f.value=e,o.subject=e.subject,o.body=e.body,u.value={},v.value=!0},S=async()=>{u.value={},i.value="";try{const e={subject:o.subject,body:o.body};await window.axios.put(`/api/emails/${f.value.id}`,e),m.value="Email updated successfully! You can now resubmit it.",await h()}catch(e){e.response&&e.response.status===422?u.value=e.response.data.errors:e.response&&e.response.data.message?i.value=e.response.data.message:(i.value="Failed to update email.",console.error("Error updating email:",e))}},B=async()=>{u.value={},i.value="";try{await window.axios.post(`/api/emails/${f.value.id}/resubmit`),m.value="Email resubmitted for approval successfully!",v.value=!1,await h()}catch(e){e.response&&e.response.data.message?i.value=e.response.data.message:(i.value="Failed to resubmit email.",console.error("Error resubmitting email:",e))}};return M(()=>o.project_id,e=>{o.client_ids=[]}),N(()=>{h()}),(e,t)=>(r(),n(R,null,[l(P(D),{title:"Rejected Emails"}),l(Y,null,{header:c(()=>t[4]||(t[4]=[s("h2",{class:"font-semibold text-xl text-gray-800 leading-tight"},"Rejected Emails",-1)])),default:c(()=>[s("div",G,[s("div",H,[s("div",J,[s("div",K,[t[7]||(t[7]=s("h3",{class:"text-2xl font-bold mb-4"},"Your Rejected Emails",-1)),m.value?(r(),n("div",Q,[s("span",W,p(m.value),1)])):j("",!0),w.value?(r(),n("div",X,"Loading rejected emails...")):i.value?(r(),n("div",Z,p(i.value),1)):b.value.length===0?(r(),n("div",ee,"No rejected emails found.")):(r(),n("div",te,[s("table",se,[t[6]||(t[6]=s("thead",{class:"bg-gray-50"},[s("tr",null,[s("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Subject"),s("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Rejection Reason"),s("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Submitted On"),s("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Actions")])],-1)),s("tbody",ae,[(r(!0),n(R,null,I(b.value,a=>(r(),n("tr",{key:a.id},[s("td",oe,p(a.subject),1),s("td",le,p(a.rejection_reason),1),s("td",ie,p(new Date(a.created_at).toLocaleString()),1),s("td",re,[l(E,{onClick:fe=>C(a)},{default:c(()=>t[5]||(t[5]=[_("View/Edit")])),_:2,__:[5]},1032,["onClick"])])]))),128))])])]))])])])]),l(q,{show:v.value,onClose:t[3]||(t[3]=a=>v.value=!1),"max-width":"3xl"},{default:c(()=>[s("div",de,[t[13]||(t[13]=s("h2",{class:"text-2xl font-bold text-gray-900 mb-4"},"Edit Rejected Email",-1)),f.value?(r(),n("div",ne,[s("p",ue,[t[8]||(t[8]=s("strong",null,"Rejection Reason:",-1)),_(" "+p(f.value.rejection_reason),1)]),t[12]||(t[12]=s("hr",{class:"my-4"},null,-1)),s("form",{onSubmit:L(S,["prevent"])},[s("div",ce,[l(V,{for:"subject",value:"Subject"}),l(T,{id:"subject",type:"text",class:"mt-1 block w-full",modelValue:o.subject,"onUpdate:modelValue":t[0]||(t[0]=a=>o.subject=a),required:""},null,8,["modelValue"]),l($,{message:u.value.subject?u.value.subject[0]:"",class:"mt-2"},null,8,["message"])]),s("div",me,[l(V,{for:"body",value:"Email Body"}),l(O,{id:"body",modelValue:o.body,"onUpdate:modelValue":t[1]||(t[1]=a=>o.body=a),placeholder:"Edit your email here...",height:"300px"},null,8,["modelValue"]),l($,{message:u.value.body?u.value.body[0]:"",class:"mt-2"},null,8,["message"])]),s("div",pe,[l(z,{onClick:t[2]||(t[2]=a=>v.value=!1)},{default:c(()=>t[9]||(t[9]=[_("Cancel")])),_:1,__:[9]}),l(E,{type:"submit"},{default:c(()=>t[10]||(t[10]=[_("Save Changes")])),_:1,__:[10]}),m.value?(r(),U(E,{key:0,onClick:B,disabled:!m.value},{default:c(()=>t[11]||(t[11]=[_("Resubmit for Approval")])),_:1,__:[11]},8,["disabled"])):j("",!0)])],32)])):j("",!0)])]),_:1},8,["show"])]),_:1})],64))}};export{Re as default};
