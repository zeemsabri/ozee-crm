import{r as s,f as z,B as H,a as n,o as i,b as a,d as I,t as c,w as J,m as B,u as O,G as Q,y as X,i as U,F as Z,l as R}from"./app-BXwNPRau.js";import{_ as ee,a as te}from"./NoticeboardModal-CztiEtks.js";const ae={class:"bg-white rounded-xl shadow-md p-6 mb-6"},se={class:"flex items-center justify-between mb-4"},le={class:"flex-1"},oe={class:"text-5xl font-bold text-indigo-600"},ne={class:"flex-1 text-right"},ie={class:"text-5xl font-bold text-gray-900"},de={class:"bg-white rounded-xl shadow-md p-6 mb-6"},re={class:"flex items-center space-x-2 mb-4"},ue={class:"space-y-3"},ce=["value"],ve={key:0,class:"text-xs text-gray-500"},me={class:"bg-white rounded-xl shadow-md p-6 mb-6"},xe={key:0,class:"text-sm text-gray-500"},he={key:1,class:"text-sm text-red-600"},pe={key:2},fe={key:0,class:"text-sm text-gray-500"},ge={key:1,class:"space-y-3"},ye={class:"text-sm text-gray-800 font-semibold truncate"},_e={class:"text-xs text-gray-600 mt-1"},we={class:"mt-2"},ke=["onClick"],be={key:2,class:"mt-3"},Fe={__name:"Sidebar",props:{checklistItems:Array,notes:String},emits:["add-checklist-item","remove-checklist-item","update-notes"],setup(Ce,{emit:$}){const M=$,p=s(null),b=s(!0),C=s(0),v=s(null),d=s([]),m=s(""),N=s(null),A=s(!1),o=s([]),x=s(!1),u=s(null),f=s(!1),g=s([]);z(async()=>{var e,t,l,h,F,S;try{const y=(e=H().props.auth)==null?void 0:e.user;x.value=!0;const[_,w,r,k]=await Promise.all([window.axios.get("/api/leaderboard/stats"),window.axios.get("/api/leaderboard/monthly"),window.axios.get("/api/user/workspace"),window.axios.get("/api/notices/unread")]);console.log("fetching points"),console.log(_),C.value=((t=_==null?void 0:_.data)==null?void 0:t.userMonthlyPoints)??0;const L=Array.isArray((l=w==null?void 0:w.data)==null?void 0:l.leaderboard)?w.data.leaderboard:[];if(y&&L.length>0){const P=L.findIndex(q=>String(q.id)===String(y.id));v.value=P>=0?P+1:null}else v.value=null;d.value=Array.isArray((h=r==null?void 0:r.data)==null?void 0:h.checklist)?r.data.checklist:[],m.value=((F=r==null?void 0:r.data)==null?void 0:F.notes)??"",o.value=Array.isArray((S=k==null?void 0:k.data)==null?void 0:S.data)?k.data.data:[],u.value=null}catch(y){console.error("Failed to load leaderboard/workspace data",y),C.value=0,v.value=null,d.value=[],m.value="",o.value=[],u.value="Failed to load updates"}finally{b.value=!1,x.value=!1}});async function D(){try{await window.axios.put("/api/user/checklist",{items:d.value})}catch(e){console.error("Failed to save checklist",e)}}function E(e,t=140){return e?e.length<=t?e:e.slice(0,t).trim()+"…":""}async function T(){try{x.value=!0;const{data:e}=await window.axios.get("/api/notices/unread");o.value=Array.isArray(e==null?void 0:e.data)?e.data:[],u.value=null}catch(e){console.error("Failed to load updates",e),o.value=[],u.value="Failed to load updates"}finally{x.value=!1}}function K(e){g.value=[e],f.value=!0}function j(){g.value=o.value.slice(),g.value.length&&(f.value=!0)}function G(){f.value=!1,T()}async function V(){var t,l;const e=(l=(t=p.value)==null?void 0:t.value)==null?void 0:l.trim();if(e){const h=[...d.value,{name:e,completed:!1}];d.value=h,M("add-checklist-item",e);try{await D()}catch{}p.value.value="",p.value.focus()}}function W(e){d.value=e}function Y(e){const t=e.target.value;m.value=t,M("update-notes",t),N.value&&clearTimeout(N.value),N.value=setTimeout(async()=>{try{A.value=!0,await window.axios.put("/api/user/notes",{text:m.value})}catch(l){console.error("Failed to update notes",l)}finally{A.value=!1}},600)}return(e,t)=>(i(),n("div",null,[a("div",ae,[t[3]||(t[3]=a("h3",{class:"text-xl font-semibold text-gray-900 mb-4"},"My Performance",-1)),a("div",se,[a("div",le,[t[0]||(t[0]=a("p",{class:"text-sm text-gray-500"},"Total Points",-1)),a("span",oe,c(b.value?"—":C.value??0),1)]),a("div",ne,[t[1]||(t[1]=a("p",{class:"text-sm text-gray-500"},"Leaderboard Rank",-1)),a("span",ie,c(b.value?"#":v.value?`#${v.value}`:"#-"),1)])]),I(O(Q),{href:e.route("leaderboard.index"),class:"block text-center text-indigo-600 text-sm font-medium mt-4 hover:underline transition-all-colors"},{default:J(()=>t[2]||(t[2]=[B("View Leaderboard Details →",-1)])),_:1,__:[2]},8,["href"])]),a("div",de,[t[4]||(t[4]=a("h3",{class:"text-xl font-semibold text-gray-900 mb-4"},"My Checklist",-1)),a("div",re,[a("input",{ref_key:"newChecklistItemInput",ref:p,type:"text",class:"flex-1 p-2 border rounded-lg",placeholder:"Add a new checklist item...",onKeyup:X(V,["enter"])},null,544),a("button",{onClick:V,class:"px-3 py-2 bg-indigo-600 text-white rounded-lg"},"Add")]),I(ee,{items:d.value,"api-endpoint":"/api/user/checklist",title:"","container-class":"mt-2","success-message":"Checklist updated","error-message":"Failed to update checklist","onUpdate:items":W},null,8,["items"]),t[5]||(t[5]=a("h3",{class:"text-xl font-semibold text-gray-900 mb-4 mt-6"},"My Notes",-1)),a("div",ue,[a("textarea",{value:m.value,onInput:Y,class:"w-full h-32 p-3 rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",placeholder:"Write your notes here..."},null,40,ce),A.value?(i(),n("p",ve,"Saving...")):U("",!0)])]),a("div",me,[t[6]||(t[6]=a("h3",{class:"text-xl font-semibold text-gray-900 mb-4"},"Company Updates",-1)),x.value?(i(),n("div",xe,"Loading updates...")):u.value?(i(),n("div",he,[B(c(u.value)+" ",1),a("button",{class:"ml-2 text-indigo-600 underline",onClick:T},"Retry")])):(i(),n("div",pe,[!o.value||o.value.length===0?(i(),n("div",fe," You're all caught up. No new updates. ")):(i(),n("ul",ge,[(i(!0),n(Z,null,R(o.value.slice(0,3),(l,h)=>(i(),n("li",{key:l.id,class:"p-3 bg-gray-50 rounded-lg"},[a("p",ye,c(l.title),1),a("p",_e,c(E(l.description,120)),1),a("div",we,[a("button",{class:"text-indigo-600 text-xs font-medium hover:underline",onClick:F=>K(l)},"View",8,ke)])]))),128))])),o.value.length>3?(i(),n("div",be,[a("button",{class:"text-indigo-600 text-sm font-medium hover:underline",onClick:j},"View all ("+c(o.value.length)+")",1)])):U("",!0)]))]),I(te,{show:f.value,"unread-notices":g.value,onClose:G},null,8,["show","unread-notices"])]))}};export{Fe as default};
