import{B as ke,r as u,s as H,D as Ce,p as ae,A as Oe,J as $e,h as r,o as l,e as a,u as C,q as Pe,a as d,b as s,f as g,k as v,K as I,t as c,F as W,i as J,c as F,g as w,d as ne,v as K,m as le}from"./app-C1kCDZc3.js";import{_ as De}from"./AuthenticatedLayout-tmoCbwqQ.js";import{_ as re}from"./ProjectForm-DdDwCvgQ.js";import{P as O}from"./PrimaryButton-kJU6-6nb.js";import{D as ie}from"./DangerButton-Be7MVUrO.js";import{_ as U,a as Q}from"./SecondaryButton-BWEMHKfv.js";import{_ as $,a as X}from"./TextInput-Dd1PNkJW.js";import{_ as P}from"./InputError-H7Azy3Wi.js";import{_ as Me}from"./NotesModal-DtXzWKRE.js";import"./ApplicationLogo-C3MD2Sbk.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./Checkbox-DchCd7nL.js";const Ae={class:"py-12"},Re={class:"max-w-12xl mx-auto sm:px-6 lg:px-12"},Te={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},Ne={class:"p-6 text-gray-900"},Ve={class:"mb-6"},Ie={key:0,class:"text-gray-600"},Ue={key:1,class:"text-red-600"},Se={key:2,class:"text-gray-600"},Ee={key:3},We={class:"min-w-full divide-y divide-gray-200"},Fe={class:"bg-white divide-y divide-gray-200"},Ye={class:"px-6 py-4 whitespace-nowrap"},Be={class:"px-6 py-4"},qe={key:0},ze={key:1,class:"text-gray-400"},Ge={class:"px-6 py-4 whitespace-nowrap capitalize"},Le={class:"px-6 py-4 whitespace-nowrap"},He={class:"px-6 py-4"},Je={key:0},Ke={key:1,class:"text-gray-400"},Qe={class:"px-6 py-4"},Xe={key:0},Ze={key:1,class:"text-gray-400"},et={class:"px-6 py-4 whitespace-nowrap capitalize"},tt={class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium"},st={class:"flex items-center space-x-2"},ot={class:"p-6"},at={key:0,class:"mt-4 text-gray-800"},nt={key:0},lt={key:1,class:"text-red-600 text-sm mb-4"},rt={class:"mt-6 flex justify-end"},it={class:"p-6"},ut={key:0,class:"text-red-600 text-sm mb-4"},dt={class:"mb-4"},pt={class:"mb-4"},ct={class:"mb-4"},vt={key:0,class:"mb-4"},mt=["value"],_t={key:1,class:"mb-4"},ft={class:"mt-6 flex justify-end"},yt={class:"p-6"},gt={key:0,class:"text-red-600 text-sm mb-4"},xt={class:"mb-4"},wt=["value"],bt={class:"mt-6 flex justify-end"},Vt={__name:"Index",setup(ht){const D=ke(),_=u([]),ue=u([]),de=u([]),Y=u([]),B=u(!0),p=u({}),n=u(""),b=u(!1),h=u(!1),M=u(!1),A=u(!1),q=u(!1),S=u(!1),E=u({}),i=H({project_id:null,description:"",amount:"",user_id:null,hours_spent:"",type:"expense"}),z=H({project_id:null,content:""}),R=H({project_id:null,payment_type:"one_off"}),y=u(null),pe=u(null),{canDo:f,canView:ce}=Ce();ae(()=>D.value?D.value.role_data&&D.value.role_data.slug==="super-admin"||D.value.role==="super_admin"||D.value.role==="super-admin":!1),f("create_projects");const ve=ae(()=>ce("projects").value),me=f("manage_projects"),Z=[{value:"active",label:"Active"},{value:"completed",label:"Completed"},{value:"on_hold",label:"On Hold"},{value:"archived",label:"Archived"}],ee=[{value:"Website Designing",label:"Website Designing"},{value:"SEO",label:"SEO"},{value:"Social Media",label:"Social Media"},{value:"Content Writing",label:"Content Writing"},{value:"Graphic Design",label:"Graphic Design"}],te=[{value:"UpWork",label:"UpWork"},{value:"Direct",label:"Direct Client"},{value:"Wix Marketplace",label:"Wix Marketplace"},{value:"Referral",label:"Referral"}],j=u([]),T=u([]),_e=async()=>{try{const o=await le.get("/api/roles?type=client");j.value=o.data.map(t=>({value:t.id,label:t.name}));const e=await le.get("/api/roles?type=project");T.value=e.data.map(t=>({value:t.id,label:t.name}))}catch(o){console.error("Error fetching roles:",o),j.value=[{value:1,label:"Client Admin"},{value:2,label:"Client User"},{value:3,label:"Client Viewer"}],T.value=[{value:1,label:"Project Manager"},{value:2,label:"Project Member"},{value:3,label:"Project Viewer"}]}},G=[{value:"one_off",label:"One-Off"},{value:"monthly",label:"Monthly"}],se=[{value:"website_design",label:"Website Design"},{value:"seo",label:"SEO"},{value:"social_media",label:"Social Media"},{value:"content_writing",label:"Content Writing"},{value:"graphic_design",label:"Graphic Design"}],N=async()=>{B.value=!0,n.value="";try{const o=await window.axios.get("/api/projects");if(_.value=o.data,me.value){const e=await window.axios.get("/api/clients");ue.value=e.data.data;const t=await window.axios.get("/api/users");de.value=t.data}}catch(o){n.value="Failed to load data.",console.error("Error fetching initial data:",o),o.response&&(o.response.status===401||o.response.status===403)&&(n.value="You are not authorized to view this content or your session expired. Please log in.")}finally{B.value=!1}},fe=()=>{if(!f("create_projects").value){alert("You do not have permission to create projects.");return}E.value={},b.value=!0},ye=o=>{if(!f("manage_projects").value){alert("You do not have permission to edit this project.");return}E.value=o,h.value=!0},oe=o=>{const e=_.value.findIndex(t=>t.id===o.id);e!==-1?_.value[e]=o:_.value.push(o),b.value=!1,h.value=!1,alert(o.id?"Project updated successfully!":"Project created successfully!"),N()},ge=o=>{if(!f("delete_projects").value){alert("You do not have permission to delete this project.");return}y.value=o,M.value=!0},xe=async()=>{var e;n.value="";const o=(e=y.value)==null?void 0:e.id;if(!o){n.value="Invalid project.";return}if(!f("delete_projects").value){n.value="You do not have permission to delete this project.";return}try{await window.axios.delete(`/api/projects/${o}`),_.value=_.value.filter(t=>t.id!==o),M.value=!1,y.value=null,alert("Project deleted successfully!")}catch(t){n.value="Failed to delete project.",t.response&&t.response.data.message&&(n.value=t.response.data.message),console.error("Error deleting project:",t)}},we=async o=>{if(!f("manage_project_transactions").value){alert("You do not have permission to add transactions to this project.");return}const e=o.id;if(!e){console.error("No project ID found in project object:",o);return}i.project_id=e,i.description="",i.amount="",i.user_id=null,i.hours_spent="",i.type="expense",p.value={},n.value="";try{const t=await window.axios.get(`/api/projects/${e}`);Y.value=t.data.users||[]}catch(t){console.error("Error fetching project users:",t),Y.value=[]}A.value=!0},be=async()=>{p.value={},n.value="";const o=i.project_id;if(!o){n.value="Invalid project.";return}if(!f("manage_project_transactions").value){n.value="You do not have permission to add transactions to this project.";return}try{await window.axios.post(`/api/projects/${o}/expenses`,{expenses:[i]}),A.value=!1,alert("Transaction added successfully!"),N()}catch(e){e.response&&e.response.status===422?p.value=e.response.data.errors:e.response&&e.response.data.message?n.value=e.response.data.message:(n.value="Failed to add transaction.",console.error("Error adding transaction:",e))}},he=o=>{if(!f("add_project_notes").value){alert("You do not have permission to add notes to this project.");return}const e=o.id;if(!e){console.error("No project ID found in project object:",o);return}z.project_id=e,z.content="",p.value={},n.value="",q.value=!0},je=async()=>{n.value="";const o=R.project_id;if(!o){n.value="Invalid project.";return}if(!f("manage_project_services_and_payments").value){n.value="You do not have permission to convert payment type for this project.";return}try{await window.axios.post(`/api/projects/${o}/convert-payment-type`,{payment_type:R.payment_type});const e=_.value.findIndex(t=>t.id===o);e!==-1&&(_.value[e].payment_type=R.payment_type),S.value=!1,pe.value=null,alert("Payment type converted successfully!"),N()}catch(e){n.value="Failed to convert payment type.",e.response&&e.response.data.message&&(n.value=e.response.data.message),console.error("Error converting payment type:",e)}};return Oe(()=>{if(!ve.value){window.location.href=route("dashboard");return}N(),_e();const o=document.querySelector("#app").__vue_app__;o&&$e(o)}),(o,e)=>(l(),r(W,null,[a(C(Pe),{title:"Projects"}),a(De,null,{header:d(()=>e[17]||(e[17]=[s("h2",{class:"font-semibold text-xl text-gray-800 leading-tight"},"Projects",-1)])),default:d(()=>[s("div",Ae,[s("div",Re,[s("div",Te,[s("div",Ne,[e[24]||(e[24]=s("h3",{class:"text-2xl font-bold mb-4"},"Project List",-1)),g((l(),r("div",Ve,[a(O,{onClick:fe},{default:d(()=>e[18]||(e[18]=[v(" Create New Project ")])),_:1,__:[18]})])),[[C(I),"create_projects"]]),B.value?(l(),r("div",Ie,"Loading projects...")):n.value?(l(),r("div",Ue,c(n.value),1)):_.value.length===0?(l(),r("div",Se,"No projects found.")):(l(),r("div",Ee,[s("table",We,[e[23]||(e[23]=s("thead",{class:"bg-gray-50"},[s("tr",null,[s("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Name"),s("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Clients"),s("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Status"),s("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Type"),s("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Departments"),s("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Assigned Users"),s("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Payment Type"),s("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Actions")])],-1)),s("tbody",Fe,[(l(!0),r(W,null,J(_.value,t=>(l(),r("tr",{key:t.id},[s("td",Ye,c(t.name),1),s("td",Be,[t.clients&&t.clients.length?(l(),r("span",qe,c(t.clients.map(m=>{const k=m.pivot.role_id,x=j.value.find(L=>L.value===k),V=x?x.label:"Unknown Role";return`${m.name} (${V})`}).join(", ")),1)):(l(),r("span",ze,"None"))]),s("td",Ge,c(t.status.replace("_"," ")),1),s("td",Le,c(t.project_type||"N/A"),1),s("td",He,[t.departments&&t.departments.length?(l(),r("span",Je,c(t.departments.join(", ")),1)):(l(),r("span",Ke,"None"))]),s("td",Qe,[t.users&&t.users.length?(l(),r("span",Xe,c(t.users.map(m=>{const k=m.pivot.role_id,x=T.value.find(L=>L.value===k),V=x?x.label:"Unknown Role";return`${m.name} (${V})`}).join(", ")),1)):(l(),r("span",Ze,"None"))]),s("td",et,c(t.payment_type.replace("_"," ")),1),s("td",tt,[s("div",st,[g((l(),F(O,{onClick:m=>ye(t)},{default:d(()=>e[19]||(e[19]=[v("Edit")])),_:2,__:[19]},1032,["onClick"])),[[C(I),"manage_projects"]]),g((l(),F(O,{onClick:m=>we(t)},{default:d(()=>e[20]||(e[20]=[v("Add Transactions")])),_:2,__:[20]},1032,["onClick"])),[[C(I),"manage_project_transactions"]]),g((l(),F(O,{onClick:m=>he(t)},{default:d(()=>e[21]||(e[21]=[v("Add Note")])),_:2,__:[21]},1032,["onClick"])),[[C(I),"add_project_notes"]]),g((l(),F(ie,{onClick:m=>ge(t)},{default:d(()=>e[22]||(e[22]=[v("Delete")])),_:2,__:[22]},1032,["onClick"])),[[C(I),"delete_projects"]])])])]))),128))])])]))])])])]),a(U,{show:b.value,onClose:e[1]||(e[1]=t=>b.value=!1)},{default:d(()=>[a(re,{show:b.value,project:E.value,statusOptions:Z,serviceOptions:se,departmentOptions:ee,sourceOptions:te,clientRoleOptions:j.value,userRoleOptions:T.value,paymentTypeOptions:G,onClose:e[0]||(e[0]=t=>b.value=!1),onSubmit:oe},null,8,["show","project","clientRoleOptions","userRoleOptions"])]),_:1},8,["show"]),a(U,{show:h.value,onClose:e[3]||(e[3]=t=>h.value=!1)},{default:d(()=>[a(re,{show:h.value,project:E.value,statusOptions:Z,serviceOptions:se,departmentOptions:ee,sourceOptions:te,clientRoleOptions:j.value,userRoleOptions:T.value,paymentTypeOptions:G,onClose:e[2]||(e[2]=t=>h.value=!1),onSubmit:oe},null,8,["show","project","clientRoleOptions","userRoleOptions"])]),_:1},8,["show"]),a(U,{show:M.value,onClose:e[5]||(e[5]=t=>M.value=!1)},{default:d(()=>[s("div",ot,[e[28]||(e[28]=s("h2",{class:"text-lg font-medium text-gray-900"}," Are you sure you want to delete this project? ",-1)),e[29]||(e[29]=s("p",{class:"mt-1 text-sm text-gray-600"}," This action cannot be undone. All associated conversations and emails will also be deleted. ",-1)),y.value?(l(),r("div",at,[e[25]||(e[25]=s("strong",null,"Project:",-1)),v(" "+c(y.value.name)+" ",1),y.value.clients&&y.value.clients.length?(l(),r("span",nt," (Clients: "+c(y.value.clients.map(t=>{const m=t.pivot.role_id,k=j.value.find(V=>V.value===m),x=k?k.label:"Unknown Role";return`${t.name} (${x})`}).join(", "))+") ",1)):w("",!0)])):w("",!0),n.value?(l(),r("div",lt,c(n.value),1)):w("",!0),s("div",rt,[a(Q,{onClick:e[4]||(e[4]=t=>M.value=!1)},{default:d(()=>e[26]||(e[26]=[v("Cancel")])),_:1,__:[26]}),a(ie,{class:"ms-3",onClick:xe},{default:d(()=>e[27]||(e[27]=[v("Delete Project")])),_:1,__:[27]})])])]),_:1},8,["show"]),a(U,{show:A.value,onClose:e[12]||(e[12]=t=>A.value=!1)},{default:d(()=>[s("div",it,[e[34]||(e[34]=s("h2",{class:"text-lg font-medium text-gray-900 mb-4"},"Add Transactions",-1)),n.value?(l(),r("div",ut,c(n.value),1)):w("",!0),s("form",{onSubmit:ne(be,["prevent"])},[s("div",dt,[a($,{for:"transaction_type",value:"Type"}),g(s("select",{id:"transaction_type",class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full","onUpdate:modelValue":e[6]||(e[6]=t=>i.type=t)},e[30]||(e[30]=[s("option",{value:"income"},"Income",-1),s("option",{value:"expense"},"Expense",-1)]),512),[[K,i.type]]),a(P,{message:p.value["expenses.0.type"]?p.value["expenses.0.type"][0]:"",class:"mt-2"},null,8,["message"])]),s("div",pt,[a($,{for:"transaction_description",value:"Description"}),a(X,{id:"transaction_description",type:"text",class:"mt-1 block w-full",modelValue:i.description,"onUpdate:modelValue":e[7]||(e[7]=t=>i.description=t),required:""},null,8,["modelValue"]),a(P,{message:p.value["expenses.0.description"]?p.value["expenses.0.description"][0]:"",class:"mt-2"},null,8,["message"])]),s("div",ct,[a($,{for:"transaction_amount",value:"Amount"}),a(X,{id:"transaction_amount",type:"number",step:"0.01",class:"mt-1 block w-full",modelValue:i.amount,"onUpdate:modelValue":e[8]||(e[8]=t=>i.amount=t),required:""},null,8,["modelValue"]),a(P,{message:p.value["expenses.0.amount"]?p.value["expenses.0.amount"][0]:"",class:"mt-2"},null,8,["message"])]),i.type==="expense"?(l(),r("div",vt,[a($,{for:"transaction_user_id",value:"User (Optional)"}),g(s("select",{id:"transaction_user_id",class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full","onUpdate:modelValue":e[9]||(e[9]=t=>i.user_id=t)},[e[31]||(e[31]=s("option",{value:"",disabled:""},"Select User",-1)),(l(!0),r(W,null,J(Y.value,t=>(l(),r("option",{key:t.id,value:t.id},c(t.name),9,mt))),128))],512),[[K,i.user_id]]),a(P,{message:p.value["expenses.0.user_id"]?p.value["expenses.0.user_id"][0]:"",class:"mt-2"},null,8,["message"])])):w("",!0),i.type==="expense"?(l(),r("div",_t,[a($,{for:"transaction_hours_spent",value:"Hours Spent (Optional)"}),a(X,{id:"transaction_hours_spent",type:"number",step:"0.01",class:"mt-1 block w-full",modelValue:i.hours_spent,"onUpdate:modelValue":e[10]||(e[10]=t=>i.hours_spent=t)},null,8,["modelValue"]),a(P,{message:p.value["expenses.0.hours_spent"]?p.value["expenses.0.hours_spent"][0]:"",class:"mt-2"},null,8,["message"])])):w("",!0),s("div",ft,[a(Q,{onClick:e[11]||(e[11]=t=>A.value=!1)},{default:d(()=>e[32]||(e[32]=[v("Cancel")])),_:1,__:[32]}),a(O,{class:"ms-3",type:"submit"},{default:d(()=>e[33]||(e[33]=[v("Add Transaction")])),_:1,__:[33]})])],32)])]),_:1},8,["show"]),a(Me,{show:q.value,"project-id":z.project_id,onClose:e[13]||(e[13]=t=>q.value=!1),onNoteAdded:N},null,8,["show","project-id"]),a(U,{show:S.value,onClose:e[16]||(e[16]=t=>S.value=!1)},{default:d(()=>[s("div",yt,[e[37]||(e[37]=s("h2",{class:"text-lg font-medium text-gray-900 mb-4"},"Convert Payment Type",-1)),n.value?(l(),r("div",gt,c(n.value),1)):w("",!0),s("form",{onSubmit:ne(je,["prevent"])},[s("div",xt,[a($,{for:"convert_payment_type",value:"Payment Type"}),g(s("select",{id:"convert_payment_type",class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full","onUpdate:modelValue":e[14]||(e[14]=t=>R.payment_type=t),required:""},[(l(),r(W,null,J(G,t=>s("option",{key:t.value,value:t.value},c(t.label),9,wt)),64))],512),[[K,R.payment_type]]),a(P,{message:p.value.payment_type?p.value.payment_type[0]:"",class:"mt-2"},null,8,["message"])]),s("div",bt,[a(Q,{onClick:e[15]||(e[15]=t=>S.value=!1)},{default:d(()=>e[35]||(e[35]=[v("Cancel")])),_:1,__:[35]}),a(O,{class:"ms-3",type:"submit"},{default:d(()=>e[36]||(e[36]=[v("Convert")])),_:1,__:[36]})])],32)])]),_:1},8,["show"])]),_:1})],64))}};export{Vt as default};
