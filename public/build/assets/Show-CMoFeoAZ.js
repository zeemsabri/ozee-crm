import{r as c,f as ee,a as l,o,d as y,u as s,h as te,w as g,b as t,i as u,t as i,m as p,F as f,l as T,j as R,v as se,x as ae,g as oe,p as W}from"./app-D1p4MqVE.js";import{R as le,_ as ie}from"./AuthenticatedLayout-pi58aoE1.js";import{_ as x}from"./PrimaryButton-CscIUh91.js";import{_ as ne}from"./SecondaryButton-BNhmUgdI.js";import{_ as de}from"./Modal-Jm6HR-96.js";import re from"./CustomComposeEmailContent-QzyPoN2h.js";import ue from"./CustomEmailApprovalContent-EAU4gaHU.js";import{_ as me}from"./EmailDetailsContent-x5ukWhru.js";import pe from"./EmailActionContent-DqP3b6oq.js";import ve from"./ReceivedEmailActionContent-BjT5F46r.js";import{u as ye}from"./useLeadDetails-DK4-fBzM.js";import"./InputLabel-B69KKU2j.js";import"./InputError-C5fYPmEi.js";import"./index-CD8YGcKc.js";import"./BaseFormModal-C4fiLdkR.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./TextInput-Dx_Sn8fx.js";import"./SelectDropdown--TVRfKco.js";/* empty css                                                                       */import"./debounce-C-hnF4Z3.js";import"./ApplicationLogo-vXZP6Iao.js";import"./createLucideIcon-DmLtMmsd.js";import"./plus-fpULpD3i.js";import"./DangerButton-CSTnlvV0.js";import"./moment-BLMuvzoS.js";import"./NoticeboardModal-BOUVavf-.js";import"./CustomMultiSelect-D51Gg0qE.js";import"./EmailEditor-BTO8uGEj.js";import"./EmailEditor.vue_vue_type_style_index_0_lang-rOXGHeGp.js";import"./useEmailSignature-C1NYSkSK.js";import"./useEmailTemplate-RfxZL-R9.js";import"./EmailAttachmentsList-kENd_UBV.js";import"./TrashIcon-Cya6cvWu.js";import"./TaskCreationForm-BMLD1520.js";const ce={class:"flex items-center justify-between w-full"},ge={class:"flex items-center gap-3"},_e={class:"flex items-center gap-2"},fe={key:1,class:"text-sm text-gray-500"},xe={class:"py-6 min-h-screen w-full"},be={class:"w-full px-4 sm:px-6 lg:px-8"},we={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},ke={class:"p-6 text-gray-900"},he={key:0,class:"mb-4 text-red-600"},Ce={key:1,class:"animate-pulse space-y-3"},Ee={key:2,class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},Le={class:"lg:col-span-2 space-y-6"},$e={class:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm"},Se={class:"font-medium"},je={key:0},Ne={class:"font-medium"},Ae={key:1},Pe={class:"font-medium"},De={key:2},Te={class:"font-medium"},Fe={key:3},Ve={class:"font-medium"},ze={key:4},Be={class:"font-medium"},Ue={key:5},qe={class:"font-medium"},Ie={key:6},Me={class:"font-medium"},Oe={key:7},Re={class:"font-medium"},We={key:8},Ge={class:"font-medium"},He={key:9},Je={class:"font-medium"},Ke={key:10},Qe={class:"font-medium"},Xe={key:11},Ye={class:"font-medium"},Ze={class:"flex items-center justify-between mb-2"},et={key:0,class:"text-gray-500 text-sm"},tt={key:1,class:"text-red-600 text-sm"},st={key:2,class:"text-gray-500 text-sm"},at={key:3,class:"overflow-x-auto shadow rounded-md border border-gray-100"},ot={class:"min-w-full divide-y divide-gray-200"},lt={class:"bg-white divide-y divide-gray-200"},it=["onClick"],nt={class:"px-4 py-2 text-sm text-gray-900"},dt={class:"px-4 py-2 text-sm"},rt={class:"px-4 py-2 text-sm text-gray-500"},ut={class:"px-4 py-2 text-sm text-gray-500"},mt={key:0,class:"p-2 flex justify-end gap-1"},pt=["disabled"],vt={class:"px-2 py-1 text-sm"},yt=["disabled"],ct={class:"lg:col-span-1 space-y-6"},gt={key:0,class:"text-gray-500 text-sm"},_t={key:1,class:"text-red-600 text-sm"},ft={key:2,class:"text-gray-500 text-sm"},xt={key:3,class:"divide-y divide-gray-200 rounded-md border border-gray-200"},bt={class:"font-medium"},wt={class:"text-xs text-gray-500"},kt={class:"flex items-center gap-2"},ht={class:"mb-3 flex gap-2"},Ct={key:0,class:"text-red-600 text-sm mb-2"},Et={key:1,class:"text-gray-500 text-sm"},Lt={class:"relative"},$t={class:"space-y-4"},St={class:"border rounded-md p-3 bg-white"},jt={class:"text-sm whitespace-pre-wrap"},Nt={class:"text-xs text-gray-500 mt-1 flex items-center gap-2"},At={key:0,class:"inline-flex items-center px-2 py-0.5 rounded bg-gray-100 text-gray-600"},Pt={key:0,class:"text-sm text-gray-500"},Dt={class:"p-6"},Tt={key:0,class:"text-red-600 text-sm mt-2"},Ft={class:"mt-6 flex justify-end gap-2"},Vt={key:0},zt={key:1},Bt={key:2},Ut={key:3},qt={key:4},ks={__name:"Show",props:{id:{type:Number,required:!0},lead:{type:Object,default:null}},setup(G){const j=c([]),N=c(!1),C=c(""),H=async v=>{var e,m;if(v!=null&&v.value){N.value=!0,C.value="";try{const{data:r}=await W.get(`/api/leads/${v.value}/presentations`);j.value=Array.isArray(r)?r:(r==null?void 0:r.data)??[]}catch(r){console.error("Failed to load presentations",r),C.value=((m=(e=r==null?void 0:r.response)==null?void 0:e.data)==null?void 0:m.message)||"Failed to load presentations"}finally{N.value=!1}}},E=c(G.id),{loading:F,error:V,lead:a,fullName:z,notes:B,notesLoading:U,notesError:q,savingNote:I,fetchLead:J,fetchNotes:K,addNote:Q}=ye(E),b=c(""),w=c(!1),k=c(!1),L=c(""),X=async()=>{var v,e;if(a.value){k.value=!0,L.value="";try{const{data:m}=await window.axios.post(`/api/leads/${a.value.id}/convert`),r=(m==null?void 0:m.client_id)||(m==null?void 0:m.id)||m;w.value=!1,r&&(window.location.href=`/clients/${r}`)}catch(m){console.error("Conversion failed",m),L.value=((e=(v=m==null?void 0:m.response)==null?void 0:v.data)==null?void 0:e.message)||"Failed to convert lead"}finally{k.value=!1}}},A=c([]),P=c(!1),$=c(""),_=c({current_page:1,last_page:1,total:0}),D=async(v=1)=>{var e,m;P.value=!0,$.value="";try{const{data:r}=await W.get(`/api/leads/${E.value}/emails`,{params:{page:v}});A.value=r.data||[],_.value={current_page:r.current_page||1,last_page:r.last_page||1,total:r.total||(Array.isArray(r.data)?r.data.length:0)}}catch(r){console.error("Failed to load lead emails",r),$.value=((m=(e=r==null?void 0:r.response)==null?void 0:e.data)==null?void 0:m.message)||"Failed to load emails"}finally{P.value=!1}},d=c({show:!1,mode:null,title:"",data:null,loading:!1}),M=()=>{d.value={show:!0,mode:"custom-compose",title:"Compose Email to Lead",data:null,loading:!1}},Y=v=>{d.value={show:!0,mode:"view-email",title:"Email Details",data:v,loading:!1}},Z=v=>{d.value.show=!0,d.value.data=v,v.type==="received"&&(v.status==="pending_approval_received"||v.status==="received")?(d.value.mode="received-edit",d.value.title="Approve Received Email"):v.template_id?(d.value.mode="edit",d.value.title="Edit & Approve Template Email"):(d.value.mode="custom-edit",d.value.title="Edit & Approve Custom Email")},S=()=>{d.value.show=!1,D(_.value.current_page)},O=v=>{v<1||v>_.value.last_page||D(v)};return ee(async()=>{await J(),await K(),await D(1),await H(E)}),(v,e)=>(o(),l(f,null,[y(s(te),{title:`Lead: ${s(z)}`},null,8,["title"]),y(ie,null,{header:g(()=>{var m;return[t("div",ce,[t("div",null,[t("div",ge,[e[9]||(e[9]=t("h2",{class:"font-semibold text-xl text-gray-800 leading-tight"},"Lead Details",-1)),s(a)?(o(),l("span",{key:0,class:R(["text-xs px-2 py-0.5 rounded-full capitalize",{"bg-gray-100 text-gray-700":!s(a).status||s(a).status.toLowerCase()==="new","bg-blue-100 text-blue-700":s(a).status&&s(a).status.toLowerCase()==="contacted","bg-amber-100 text-amber-700":s(a).status&&s(a).status.toLowerCase()==="qualified","bg-emerald-100 text-emerald-700":s(a).status&&s(a).status.toLowerCase()==="converted","bg-rose-100 text-rose-700":s(a).status&&s(a).status.toLowerCase()==="lost"}])},i(s(a).status||"new"),3)):u("",!0)])]),t("div",_e,[y(x,{onClick:M},{default:g(()=>e[10]||(e[10]=[p("Compose Email",-1)])),_:1,__:[10]}),(((m=s(a))==null?void 0:m.status)||"").toLowerCase()!=="converted"?(o(),oe(x,{key:0,onClick:e[0]||(e[0]=r=>w.value=!0)},{default:g(()=>e[11]||(e[11]=[p("Convert to Client",-1)])),_:1,__:[11]})):(o(),l("span",fe,"Already converted"))])])]}),default:g(()=>{var m,r;return[t("div",xe,[t("div",be,[t("div",we,[t("div",ke,[s(V)?(o(),l("div",he,i(s(V)),1)):u("",!0),s(F)?(o(),l("div",Ce,e[12]||(e[12]=[t("div",{class:"h-5 bg-gray-200 rounded w-1/3"},null,-1),t("div",{class:"h-4 bg-gray-200 rounded w-1/2"},null,-1),t("div",{class:"h-32 bg-gray-100 rounded"},null,-1)]))):u("",!0),s(a)&&!s(F)?(o(),l("div",Ee,[t("section",Le,[t("div",null,[e[37]||(e[37]=t("h3",{class:"text-lg font-semibold mb-2"},"Profile",-1)),t("div",$e,[t("div",null,[e[13]||(e[13]=t("span",{class:"text-gray-500"},"Name:",-1)),e[14]||(e[14]=p()),t("span",Se,i(s(z)),1)]),s(a).email?(o(),l("div",je,[e[15]||(e[15]=t("span",{class:"text-gray-500"},"Email:",-1)),e[16]||(e[16]=p()),t("span",Ne,i(s(a).email),1)])):u("",!0),s(a).phone?(o(),l("div",Ae,[e[17]||(e[17]=t("span",{class:"text-gray-500"},"Phone:",-1)),e[18]||(e[18]=p()),t("span",Pe,i(s(a).phone),1)])):u("",!0),s(a).company?(o(),l("div",De,[e[19]||(e[19]=t("span",{class:"text-gray-500"},"Company:",-1)),e[20]||(e[20]=p()),t("span",Te,i(s(a).company),1)])):u("",!0),s(a).title?(o(),l("div",Fe,[e[21]||(e[21]=t("span",{class:"text-gray-500"},"Title:",-1)),e[22]||(e[22]=p()),t("span",Ve,i(s(a).title),1)])):u("",!0),s(a).source?(o(),l("div",ze,[e[23]||(e[23]=t("span",{class:"text-gray-500"},"Source:",-1)),e[24]||(e[24]=p()),t("span",Be,i(s(a).source),1)])):u("",!0),s(a).pipeline_stage?(o(),l("div",Ue,[e[25]||(e[25]=t("span",{class:"text-gray-500"},"Pipeline Stage:",-1)),e[26]||(e[26]=p()),t("span",qe,i(s(a).pipeline_stage),1)])):u("",!0),s(a).estimated_value?(o(),l("div",Ie,[e[27]||(e[27]=t("span",{class:"text-gray-500"},"Estimated Value:",-1)),e[28]||(e[28]=p()),t("span",Me,i(s(a).estimated_value)+" "+i(s(a).currency||"USD"),1)])):u("",!0),s(a).website?(o(),l("div",Oe,[e[29]||(e[29]=t("span",{class:"text-gray-500"},"Website:",-1)),e[30]||(e[30]=p()),t("span",Re,i(s(a).website),1)])):u("",!0),s(a).address||s(a).city||s(a).state||s(a).zip||s(a).country?(o(),l("div",We,[e[31]||(e[31]=t("span",{class:"text-gray-500"},"Address:",-1)),t("div",Ge,[p(i(s(a).address)+" ",1),s(a).city?(o(),l(f,{key:0},[p(", "+i(s(a).city),1)],64)):u("",!0),s(a).state?(o(),l(f,{key:1},[p(", "+i(s(a).state),1)],64)):u("",!0),s(a).zip?(o(),l(f,{key:2},[p(i(s(a).zip),1)],64)):u("",!0),s(a).country?(o(),l(f,{key:3},[p(", "+i(s(a).country),1)],64)):u("",!0)])])):u("",!0),(m=s(a).assigned_to)!=null&&m.name||s(a).assigned_to_id?(o(),l("div",He,[e[32]||(e[32]=t("span",{class:"text-gray-500"},"Assigned:",-1)),t("span",Je,i(((r=s(a).assigned_to)==null?void 0:r.name)||`User #${s(a).assigned_to_id}`),1)])):u("",!0),s(a).tags?(o(),l("div",Ke,[e[33]||(e[33]=t("span",{class:"text-gray-500"},"Tags:",-1)),e[34]||(e[34]=p()),t("span",Qe,i(s(a).tags),1)])):u("",!0),s(a).notes?(o(),l("div",Xe,[e[35]||(e[35]=t("span",{class:"text-gray-500"},"Notes:",-1)),e[36]||(e[36]=p()),t("span",Ye,i(s(a).notes),1)])):u("",!0)])]),t("div",null,[t("div",Ze,[e[39]||(e[39]=t("h3",{class:"text-lg font-semibold"},"Emails",-1)),y(x,{onClick:M},{default:g(()=>e[38]||(e[38]=[p("Compose Email",-1)])),_:1,__:[38]})]),P.value?(o(),l("div",et,"Loading emails...")):$.value?(o(),l("div",tt,i($.value),1)):A.value.length===0?(o(),l("div",st,"No emails found for this lead.")):(o(),l("div",at,[t("table",ot,[e[40]||(e[40]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase"},"Subject"),t("th",{class:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase"},"Status"),t("th",{class:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase"},"Type"),t("th",{class:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase"},"Date")])],-1)),t("tbody",lt,[(o(!0),l(f,null,T(A.value,n=>(o(),l("tr",{key:n.id,class:"hover:bg-gray-50 cursor-pointer",onClick:h=>Y(n)},[t("td",nt,i(n.subject),1),t("td",dt,[t("span",{class:R({"px-2 py-1 rounded-full text-xs font-medium":!0,"bg-green-100 text-green-800":n.status==="sent","bg-yellow-100 text-yellow-800":n.status==="pending_approval"||n.status==="pending_approval_received","bg-blue-100 text-blue-800":n.status==="received"})},i((n.status||"n/a").replace(/_/g," ").toUpperCase()),3)]),t("td",rt,i(n.type),1),t("td",ut,i(new Date(n.created_at).toLocaleString()),1)],8,it))),128))])]),_.value.last_page>1?(o(),l("div",mt,[t("button",{class:"px-2 py-1 text-sm border rounded",disabled:_.value.current_page===1,onClick:e[1]||(e[1]=n=>O(_.value.current_page-1))},"Prev",8,pt),t("span",vt,"Page "+i(_.value.current_page)+" of "+i(_.value.last_page),1),t("button",{class:"px-2 py-1 text-sm border rounded",disabled:_.value.current_page===_.value.last_page,onClick:e[2]||(e[2]=n=>O(_.value.current_page+1))},"Next",8,yt)])):u("",!0)]))])]),t("aside",ct,[t("div",null,[e[43]||(e[43]=t("div",{class:"flex items-center justify-between mb-2"},[t("h3",{class:"text-lg font-semibold"},"Presentations")],-1)),N.value?(o(),l("div",gt,"Loading presentations...")):C.value?(o(),l("div",_t,i(C.value),1)):j.value.length===0?(o(),l("div",ft,"No presentations found for this lead.")):(o(),l("ul",xt,[(o(!0),l(f,null,T(j.value,n=>(o(),l("li",{key:n.id,class:"p-3 flex items-center justify-between"},[t("div",null,[t("div",bt,i(n.title),1),t("div",wt,"Type: "+i(n.type),1)]),t("div",kt,[y(x,{as:"a",href:`/view/${n.share_token}`,target:"_blank",title:"Open public preview"},{default:g(()=>e[41]||(e[41]=[p("View",-1)])),_:2,__:[41]},1032,["href"]),y(x,{as:"a",href:`/presentations/${n.id}/edit`,title:"Edit in builder"},{default:g(()=>e[42]||(e[42]=[p("Edit",-1)])),_:2,__:[42]},1032,["href"])])]))),128))]))]),t("div",null,[e[46]||(e[46]=t("h3",{class:"text-lg font-semibold mb-2"},"Notes",-1)),t("div",ht,[se(t("input",{"onUpdate:modelValue":e[3]||(e[3]=n=>b.value=n),type:"text",class:"flex-1 rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",placeholder:"Add a note..."},null,512),[[ae,b.value]]),y(x,{disabled:s(I)||!b.value.trim(),onClick:e[4]||(e[4]=async()=>{await s(Q)(b.value),b.value=""})},{default:g(()=>[p(i(s(I)?"Saving...":"Save"),1)]),_:1},8,["disabled"])]),s(q)?(o(),l("div",Ct,i(s(q)),1)):u("",!0),s(U)?(o(),l("div",Et,"Loading notes...")):u("",!0),t("div",Lt,[e[45]||(e[45]=t("div",{class:"absolute left-3 top-0 bottom-0 w-px bg-gray-200","aria-hidden":"true"},null,-1)),t("ul",$t,[(o(!0),l(f,null,T(s(B),n=>{var h;return o(),l("li",{key:n.id,class:"relative pl-8"},[e[44]||(e[44]=t("div",{class:"absolute left-0 top-1.5 w-2 h-2 bg-indigo-400 rounded-full"},null,-1)),t("div",St,[t("div",jt,i(n.body||n.content||n.note||""),1),t("div",Nt,[n.type?(o(),l("span",At,i(n.type),1)):u("",!0),t("span",null,"By "+i(((h=n.user)==null?void 0:h.name)||"User")+" • "+i(new Date(n.created_at).toLocaleString()),1)])])])}),128)),!s(U)&&s(B).length===0?(o(),l("li",Pt,"No notes have been added yet.")):u("",!0)])])])])])):u("",!0)])])])]),y(de,{show:w.value,onClose:e[6]||(e[6]=n=>w.value=!1)},{default:g(()=>[t("div",Dt,[e[48]||(e[48]=t("h3",{class:"text-lg font-semibold mb-2"},"Convert to Client",-1)),e[49]||(e[49]=t("p",null,"Are you sure you want to convert this lead into a client?",-1)),L.value?(o(),l("div",Tt,i(L.value),1)):u("",!0),t("div",Ft,[y(ne,{disabled:k.value,onClick:e[5]||(e[5]=n=>w.value=!1)},{default:g(()=>e[47]||(e[47]=[p("Cancel",-1)])),_:1,__:[47]},8,["disabled"]),y(x,{disabled:k.value,onClick:X},{default:g(()=>[p(i(k.value?"Converting...":"Convert"),1)]),_:1},8,["disabled"])])])]),_:1},8,["show"]),y(le,{show:d.value.show,title:d.value.title,onClose:e[8]||(e[8]=n=>d.value.show=!1)},{content:g(()=>{var n;return[d.value.mode==="custom-compose"?(o(),l("div",Vt,[y(re,{"project-id":null,"user-project-role":{},"force-recipient-mode":"leads","preset-lead-ids":[E.value],"hide-recipient-controls":!0,onSubmitted:S,onError:()=>{}},null,8,["preset-lead-ids"])])):d.value.mode==="view-email"?(o(),l("div",zt,[y(me,{email:d.value.data,"can-approve-emails":(n=d.value.data)==null?void 0:n.can_approve,onEdit:Z,onReject:e[7]||(e[7]=h=>{d.value.mode="reject",d.value.data=h,d.value.title="Reject Email"})},null,8,["email","can-approve-emails"])])):d.value.mode==="edit"||d.value.mode==="reject"?(o(),l("div",Bt,[y(pe,{email:d.value.data,mode:d.value.mode,onSubmitted:S},null,8,["email","mode"])])):d.value.mode==="received-edit"?(o(),l("div",Ut,[y(ve,{email:d.value.data,onSubmitted:S,onError:()=>{}},null,8,["email"])])):d.value.mode==="custom-edit"?(o(),l("div",qt,[y(ue,{email:d.value.data,onSubmitted:S,onError:()=>{}},null,8,["email"])])):u("",!0)]}),_:1},8,["show","title"])]}),_:1})],64))}};export{ks as default};
