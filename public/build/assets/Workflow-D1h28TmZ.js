import{d as L}from"./vuedraggable.umd-B-j6RFGW.js";import V from"./TriggerStep-DgsbueqJ.js";import B from"./ConditionStep-CHQ3T2Ro.js";import M from"./ActionStep-DI1Rkdc9.js";import P from"./AIStep-B_OcwjWm.js";import j from"./ForEachStep-_bI0nKPa.js";import W from"./FetchRecordsStep-CJtzW0Je.js";import q from"./ScheduleTriggerStep-DVFXDUby.js";import O from"./AddStepButton-BLbMQytE.js";import{u as K}from"./workflowStore-Bj2P6NRO.js";import Y from"./TransformStep-CAhEfhyH.js";import z from"./DefineVariableStep-BW6WP7mI.js";import{l as A,C as J,c as d,o as c,q as v,F as N,a as p,e as g,w as Q,k as y,K as X,u as Z}from"./app-DdN7Mxvn.js";import"./index-v3z0kSKS.js";import"./StepCard-BHZgfia6.js";import"./createLucideIcon-BXbmwqJx.js";import"./x-DGBM-pIh.js";import"./trash-CaZQyYRH.js";import"./SelectDropdown-u4-e266e.js";/* empty css                                                                       */import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./RelationshipPathPicker-xNnZ6yhX.js";import"./plus-Buz5Bsfi.js";import"./DataTokenInserter-Djd729iT.js";import"./RelatedDataPicker-B6POLWZx.js";import"./BaseFormModal-BYgNgfCI.js";import"./Modal-BcCWKK72.js";import"./PrimaryButton-DXqku6c5.js";import"./SecondaryButton-B7cHuvDb.js";import"./PromptForm-ocVc_r4G.js";import"./ResponseBuilder-l9Q6qchv.js";import"./FieldBuilder-C1-q6N97.js";import"./chevron-down-DwNpnNnU.js";import"./circle-x-B-QYpxnl.js";const tt={class:"flex flex-col items-center w-full space-y-4"},et={key:0,class:"text-center p-8 border-2 border-dashed rounded-lg w-full max-w-md"},ot={class:"flex justify-center"},st=["id"],nt={key:1,class:"w-full flex mt-4 space-x-4"},lt={class:"flex-1 bg-green-50/50 p-4 rounded-lg border border-green-200"},rt={class:"flex-1 bg-red-50/50 p-4 rounded-lg border border-red-200"},at={key:2,class:"w-full mt-4 p-4 rounded-lg border border-purple-300 bg-purple-50/50"},Mt={__name:"Workflow",props:{steps:{type:Array,required:!0},fullContextSteps:{type:Array,default:()=>[]},loopContextSchema:{type:Object,default:null},allowTrigger:{type:Boolean,default:!0}},emits:["update:steps","add-trigger"],setup(r,{emit:k}){const F=K(),D=A(()=>F.automationSchema||[]),f=r,x=k,$={TRIGGER:V,SCHEDULE_TRIGGER:q,FETCH_RECORDS:W,CONDITION:B,ACTION:M,AI_PROMPT:P,FOR_EACH:j,TRANSFORM_CONTENT:Y,DEFINE_VARIABLE:z},S=l=>$[l]||null,w=A({get(){return f.steps},set(l){x("update:steps",l)}});function H(l){const{draggedContext:t,relatedContext:s}=l,o=t.element,n=t.futureIndex;if(o.step_type==="TRIGGER"||o.step_type==="SCHEDULE_TRIGGER")return!1;const e=f.steps;if(e.length>0){const i=e[0];if((i.step_type==="TRIGGER"||i.step_type==="SCHEDULE_TRIGGER")&&n===0)return!1}return!0}function U(l){var h,E,R,T,I;const t=(h=l.step_config)==null?void 0:h.sourceArray;if(!t)return null;const s=t.match(/{{step_(\w+)\.(.+)}}/);if(!s)return null;const o=s[1],n=s[2],e=f.fullContextSteps.find(a=>a.id==o),i=a=>{const m=String((a==null?void 0:a.type)||"").toLowerCase(),_=String((a==null?void 0:a.itemType)||"").toLowerCase();return m==="array of objects"||m==="array"&&_==="object"};if((e==null?void 0:e.step_type)==="AI_PROMPT"||(e==null?void 0:e.step_type)==="ACTION"&&((E=e==null?void 0:e.step_config)==null?void 0:E.action_type)==="FETCH_API_DATA"){const a=n.replace(/^parsed\./,""),m=(T=(R=e.step_config)==null?void 0:R.responseStructure)==null?void 0:T.find(_=>_.name===a);return i(m)?{name:"Loop Item",columns:m.schema||[]}:null}if((e==null?void 0:e.step_type)==="FETCH_RECORDS"&&n==="records"){const a=(I=e.step_config)==null?void 0:I.model;if(!a)return null;const m=D.value.find(u=>u.name===a);return m?{name:"Loop Item",columns:(m.columns||[]).map(u=>typeof u=="string"?{name:u}:u)}:null}return null}function C(l,t){const s=[...f.steps];s[l]=t,x("update:steps",s)}function b(l,t){const s={id:`temp_${Date.now()}`,step_type:t,name:`New ${t.replace("_"," ")} Step`,step_config:{}};if(t==="CONDITION"&&(s.if_true=[],s.if_false=[]),t==="FOR_EACH"&&(s.children=[]),t==="FETCH_RECORDS"){const e=f.steps.slice(0,l).slice().reverse().find(i=>i&&i.step_type==="FETCH_RECORDS"&&i.step_config&&i.step_config.model);e&&(s.step_config={model:e.step_config.model,conditions:[]})}const o=[...f.steps];o.splice(l,0,s),x("update:steps",o)}function G(l){const t=f.steps.filter((s,o)=>o!==l);x("update:steps",t)}return(l,t)=>{const s=J("Workflow",!0);return c(),d("div",tt,[r.steps.length===0?(c(),d("div",et,[r.allowTrigger?(c(),d(N,{key:0},[t[3]||(t[3]=p("h3",{class:"text-lg font-semibold text-gray-700"},"Start your Automation",-1)),t[4]||(t[4]=p("p",{class:"text-sm text-gray-500 mt-1 mb-4"},"Every workflow starts with a trigger. How should this one begin?",-1)),p("button",{onClick:t[0]||(t[0]=o=>l.$emit("add-trigger")),class:"px-4 py-2 text-sm font-semibold rounded-md bg-indigo-600 text-white hover:bg-indigo-700"}," Add Trigger ")],64)):(c(),d(N,{key:1},[t[5]||(t[5]=p("h3",{class:"text-lg font-semibold text-gray-700"},"Start this flow",-1)),t[6]||(t[6]=p("p",{class:"text-sm text-gray-500 mt-1 mb-4"},"Choose a step to add in this branch.",-1)),p("div",ot,[g(O,{onSelect:t[1]||(t[1]=o=>b(0,o))})])],64))])):(c(),v(Z(L),{key:1,modelValue:w.value,"onUpdate:modelValue":t[2]||(t[2]=o=>w.value=o),group:"workflow",handle:".drag-handle","item-key":"id",move:H,class:"flex flex-col items-center w-full space-y-4","ghost-class":"opacity-40","drag-class":"rotate-1 scale-105 shadow-xl"},{item:Q(({element:o,index:n})=>[p("div",{id:`step-card-${o.id}`,class:"w-full flex flex-col items-center transition-all duration-300"},[S(o.step_type)?(c(),v(X(S(o.step_type)),{key:0,step:o,"all-steps-before":[...r.fullContextSteps,...r.steps.slice(0,n)],"loop-context-schema":r.loopContextSchema,onDelete:!r.allowTrigger||n>0?()=>G(n):null,"onUpdate:step":e=>C(n,e)},null,40,["step","all-steps-before","loop-context-schema","onDelete","onUpdate:step"])):y("",!0),o.step_type==="CONDITION"?(c(),d("div",nt,[p("div",lt,[t[7]||(t[7]=p("p",{class:"text-center font-bold text-green-700 mb-4"},"IF YES",-1)),g(s,{steps:o.if_true||[],"onUpdate:steps":e=>C(n,{...o,if_true:e}),"full-context-steps":[...r.fullContextSteps,...r.steps.slice(0,n+1)],"loop-context-schema":r.loopContextSchema,"allow-trigger":!1},null,8,["steps","onUpdate:steps","full-context-steps","loop-context-schema"])]),p("div",rt,[t[8]||(t[8]=p("p",{class:"text-center font-bold text-red-700 mb-4"},"IF NO",-1)),g(s,{steps:o.if_false||[],"onUpdate:steps":e=>C(n,{...o,if_false:e}),"full-context-steps":[...r.fullContextSteps,...r.steps.slice(0,n+1)],"loop-context-schema":r.loopContextSchema,"allow-trigger":!1},null,8,["steps","onUpdate:steps","full-context-steps","loop-context-schema"])])])):y("",!0),o.step_type==="FOR_EACH"?(c(),d("div",at,[t[9]||(t[9]=p("p",{class:"text-center font-bold text-purple-700 mb-4"},"DO THIS FOR EACH ITEM",-1)),g(s,{steps:o.children||[],"onUpdate:steps":e=>C(n,{...o,children:e}),"full-context-steps":[...r.fullContextSteps,...r.steps.slice(0,n+1)],"loop-context-schema":U(o),"allow-trigger":!1},null,8,["steps","onUpdate:steps","full-context-steps","loop-context-schema"])])):y("",!0),g(O,{onSelect:e=>b(n+1,e)},null,8,["onSelect"])],8,st)]),_:1},8,["modelValue"]))])}}};export{Mt as default};
