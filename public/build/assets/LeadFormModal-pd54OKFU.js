import{r as v,s as j,c as k,p as S,e as A,g as B,o as D,w as P,b as d,t as q,d as s,q as N,v as T,m as F}from"./app-DISKht3j.js";import{_ as z}from"./Modal-CVZ63Sco.js";import{_ as m}from"./InputLabel-Z506aO7S.js";import{_}from"./TextInput-pYzuy-6l.js";import{_ as c}from"./InputError-C6KY5JMQ.js";import{P as E}from"./PrimaryButton-angFb9vz.js";import{_ as M}from"./SecondaryButton-CVp2-APy.js";import{S as h}from"./SelectDropdown-BxQFBrAw.js";function I(){const y=v([]),w=v(!1),r=v(""),p=v(1),V=v(15),b=v(0),o=v(1),u=j({q:"",status:"",source:"",assigned_to_id:""}),a=v([]),L=async()=>{try{const{data:n}=await S.get("/api/users");a.value=n}catch(n){console.error("Failed to load users",n)}},f=async()=>{var n,g;w.value=!0,r.value="";try{const i={page:p.value,per_page:V.value};u.q&&(i.q=u.q),u.status&&(i.status=u.status),u.source&&(i.source=u.source),u.assigned_to_id&&(i.assigned_to_id=u.assigned_to_id);const{data:$}=await S.get("/api/leads",{params:i});y.value=$.data??$;const U=$.meta??null;U?(p.value=U.current_page,V.value=U.per_page,b.value=U.total,o.value=U.last_page):(b.value=Array.isArray(y.value)?y.value.length:0,o.value=1)}catch(i){console.error("Error fetching leads",i),r.value=((g=(n=i==null?void 0:i.response)==null?void 0:n.data)==null?void 0:g.message)||"Failed to fetch leads.",i.response&&i.response.status===401&&(localStorage.removeItem("authToken"),window.location.href="/login")}finally{w.value=!1}},O=async n=>{n<1||n>o.value||(p.value=n,await f())},x=async()=>{u.q="",u.status="",u.source="",u.assigned_to_id="",p.value=1,await f()},C=async n=>{r.value="";const{data:g}=await S.post("/api/leads",n);return await f(),g},t=async(n,g)=>{r.value="";const{data:i}=await S.put(`/api/leads/${n}`,g);return await f(),i},e=async n=>{r.value="",await S.delete(`/api/leads/${n}`),await f()},l=k(()=>{const n={new:[],contacted:[],qualified:[],converted:[],lost:[]};for(const g of y.value){const i=(g.status||"new").toLowerCase();n[i]||(n[i]=[]),n[i].push(g)}return n});return{leads:y,loading:w,generalError:r,currentPage:p,perPage:V,total:b,lastPage:o,filters:u,users:a,leadsByStatus:l,fetchUsers:L,fetchLeads:f,changePage:O,resetFilters:x,createLead:C,updateLead:t,deleteLead:e}}const W={class:"p-6"},G={class:"text-lg font-semibold mb-4"},H={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},J={class:"md:col-span-2"},K={class:"mt-6 flex justify-end gap-2"},Q={__name:"LeadFormModal",props:{show:{type:Boolean,default:!1},lead:{type:Object,default:null},users:{type:Array,default:()=>[]},sourceOptions:{type:Array,default:()=>[]},statusOptions:{type:Array,default:()=>[]}},emits:["close","lead-created","lead-updated"],setup(y,{emit:w}){const r=y,p=w,{createLead:V,updateLead:b}=I(),o=v({}),u=v(!1),a=j({id:null,first_name:"",last_name:"",email:"",phone:"",company:"",title:"",status:"new",source:"",pipeline_stage:"",estimated_value:"",currency:"USD",assigned_to_id:null,website:"",country:"",state:"",city:"",address:"",zip:"",tags:"",notes:""}),L=k(()=>(r.users||[]).map(t=>({label:t.name,value:t.id}))),f=k(()=>r.statusOptions||[]),O=k(()=>r.sourceOptions||[]),x=t=>{if(!t){Object.assign(a,{id:null,first_name:"",last_name:"",email:"",phone:"",company:"",title:"",status:"new",source:"",pipeline_stage:"",estimated_value:"",currency:"USD",assigned_to_id:null,website:"",country:"",state:"",city:"",address:"",zip:"",tags:"",notes:""}),o.value={};return}Object.assign(a,{id:t.id,first_name:t.first_name||"",last_name:t.last_name||"",email:t.email||"",phone:t.phone||"",company:t.company||"",title:t.title||"",status:t.status||"new",source:t.source||"",pipeline_stage:t.pipeline_stage||"",estimated_value:t.estimated_value??"",currency:t.currency||"USD",assigned_to_id:t.assigned_to_id||null,website:t.website||"",country:t.country||"",state:t.state||"",city:t.city||"",address:t.address||"",zip:t.zip||"",tags:t.tags||"",notes:t.notes||""}),o.value={}};A(()=>r.lead,t=>x(t),{immediate:!0});const C=async()=>{var t;u.value=!0,o.value={};try{if(a.id){const e=await b(a.id,a);p("lead-updated",e)}else{const e=await V(a);p("lead-created",e)}p("close")}catch(e){((t=e==null?void 0:e.response)==null?void 0:t.status)===422?o.value=e.response.data.errors||{}:console.error("Save failed",e)}finally{u.value=!1}};return(t,e)=>(D(),B(z,{show:r.show,onClose:e[13]||(e[13]=l=>p("close"))},{default:P(()=>[d("div",W,[d("h3",G,q(a.id?"Edit Lead":"Create Lead"),1),d("div",H,[d("div",null,[s(m,{value:"First Name"}),s(_,{modelValue:a.first_name,"onUpdate:modelValue":e[0]||(e[0]=l=>a.first_name=l),class:"mt-1 block w-full"},null,8,["modelValue"]),s(c,{message:o.value.first_name,class:"mt-1"},null,8,["message"])]),d("div",null,[s(m,{value:"Last Name"}),s(_,{modelValue:a.last_name,"onUpdate:modelValue":e[1]||(e[1]=l=>a.last_name=l),class:"mt-1 block w-full"},null,8,["modelValue"]),s(c,{message:o.value.last_name,class:"mt-1"},null,8,["message"])]),d("div",null,[s(m,{value:"Email"}),s(_,{modelValue:a.email,"onUpdate:modelValue":e[2]||(e[2]=l=>a.email=l),class:"mt-1 block w-full"},null,8,["modelValue"]),s(c,{message:o.value.email,class:"mt-1"},null,8,["message"])]),d("div",null,[s(m,{value:"Phone"}),s(_,{modelValue:a.phone,"onUpdate:modelValue":e[3]||(e[3]=l=>a.phone=l),class:"mt-1 block w-full"},null,8,["modelValue"]),s(c,{message:o.value.phone,class:"mt-1"},null,8,["message"])]),d("div",null,[s(m,{value:"Company"}),s(_,{modelValue:a.company,"onUpdate:modelValue":e[4]||(e[4]=l=>a.company=l),class:"mt-1 block w-full"},null,8,["modelValue"]),s(c,{message:o.value.company,class:"mt-1"},null,8,["message"])]),d("div",null,[s(m,{value:"Title"}),s(_,{modelValue:a.title,"onUpdate:modelValue":e[5]||(e[5]=l=>a.title=l),class:"mt-1 block w-full"},null,8,["modelValue"]),s(c,{message:o.value.title,class:"mt-1"},null,8,["message"])]),d("div",null,[s(m,{value:"Status"}),s(h,{options:f.value,modelValue:a.status,"onUpdate:modelValue":e[6]||(e[6]=l=>a.status=l),placeholder:"Select status"},null,8,["options","modelValue"]),s(c,{message:o.value.status,class:"mt-1"},null,8,["message"])]),d("div",null,[s(m,{value:"Source"}),s(h,{options:O.value,modelValue:a.source,"onUpdate:modelValue":e[7]||(e[7]=l=>a.source=l),placeholder:"Select source"},null,8,["options","modelValue"]),s(c,{message:o.value.source,class:"mt-1"},null,8,["message"])]),d("div",null,[s(m,{value:"Assigned To"}),s(h,{options:L.value,modelValue:a.assigned_to_id,"onUpdate:modelValue":e[8]||(e[8]=l=>a.assigned_to_id=l),placeholder:"Unassigned"},null,8,["options","modelValue"]),s(c,{message:o.value.assigned_to_id,class:"mt-1"},null,8,["message"])]),d("div",null,[s(m,{value:"Estimated Value"}),s(_,{modelValue:a.estimated_value,"onUpdate:modelValue":e[9]||(e[9]=l=>a.estimated_value=l),type:"number",step:"0.01",class:"mt-1 block w-full"},null,8,["modelValue"]),s(c,{message:o.value.estimated_value,class:"mt-1"},null,8,["message"])]),d("div",null,[s(m,{value:"Website"}),s(_,{modelValue:a.website,"onUpdate:modelValue":e[10]||(e[10]=l=>a.website=l),class:"mt-1 block w-full"},null,8,["modelValue"]),s(c,{message:o.value.website,class:"mt-1"},null,8,["message"])]),d("div",J,[s(m,{value:"Notes"}),N(d("textarea",{"onUpdate:modelValue":e[11]||(e[11]=l=>a.notes=l),class:"mt-1 block w-full border-gray-300 rounded-md",rows:"3"},null,512),[[T,a.notes]]),s(c,{message:o.value.notes,class:"mt-1"},null,8,["message"])])]),d("div",K,[s(M,{disabled:u.value,onClick:e[12]||(e[12]=l=>p("close"))},{default:P(()=>e[14]||(e[14]=[F("Cancel",-1)])),_:1,__:[14]},8,["disabled"]),s(E,{disabled:u.value,onClick:C},{default:P(()=>[F(q(u.value?"Saving...":a.id?"Update":"Create"),1)]),_:1},8,["disabled"])])])]),_:1},8,["show"]))}},le=Object.freeze(Object.defineProperty({__proto__:null,default:Q},Symbol.toStringTag,{value:"Module"}));export{le as L,Q as _,I as u};
