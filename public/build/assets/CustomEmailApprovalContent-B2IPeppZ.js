import{r as n,c as E,e as $,a as u,o as c,b as r,i as k,d as o,u as b,w as _,m as v,j as y,s as S,p}from"./app-DhS7b-58.js";import{_ as j}from"./InputLabel-DUZhrcWT.js";import{_ as A}from"./TextInput-DDr4kSks.js";import{_ as B}from"./EmailEditor-DJvtRfLV.js";import{_ as x}from"./InputError-Dx3yOgQ_.js";import{_ as N}from"./PrimaryButton-BYcqXGYm.js";import{_ as M}from"./SecondaryButton-6uVAggoj.js";import{u as R}from"./useEmailSignature-Dp6nnSTb.js";import{_ as T}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./EmailEditor.vue_vue_type_style_index_0_lang-BXltYwyB.js";const q={key:0,class:"flex justify-center py-8"},H={key:1,class:"p-4 space-y-6"},L={class:"mb-4"},U={class:"mb-6"},z=["innerHTML"],D={class:"flex items-center justify-end space-x-2"},F={__name:"CustomEmailApprovalContent",props:{email:{type:Object,required:!0}},emits:["submitted","error"],setup(g,{emit:V}){const l=g,i=V,m=n(!1),t=n(!1),s=n({subject:"",body:""}),{userSignature:f}=R(E(()=>({}))),h=async()=>{var a;if((a=l.email)!=null&&a.id){m.value=!0;try{const{data:e}=await p.get(`/api/emails/${l.email.id}/edit-content`);s.value.subject=e.subject,s.value.body=e.body_html||e.body}catch(e){console.error("Failed to load email content",e),i("error",e)}finally{m.value=!1}}},w=async()=>{t.value=!0;try{await p.post(`/api/emails/${l.email.id}/edit-and-approve`,{subject:s.value.subject,body:s.value.body,composition_type:"custom"}),i("submitted")}catch(a){console.error("Approve custom email failed",a),i("error",a)}finally{t.value=!1}},C=async()=>{t.value=!0;try{await p.post(`/api/emails/${l.email.id}/reject`,{rejection_reason:"Rejected by approver."}),i("submitted")}catch(a){console.error("Reject custom email failed",a),i("error",a)}finally{t.value=!1}};return $(()=>l.email,a=>{a&&h()},{immediate:!0}),(a,e)=>m.value?(c(),u("div",q,e[3]||(e[3]=[r("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-500"},null,-1)]))):(c(),u("div",H,[r("form",{onSubmit:e[2]||(e[2]=S(()=>{},["prevent"]))},[r("div",L,[o(j,{for:"subject",value:"Subject"}),o(A,{id:"subject",type:"text",class:"mt-1 block w-full",modelValue:s.value.subject,"onUpdate:modelValue":e[0]||(e[0]=d=>s.value.subject=d),required:""},null,8,["modelValue"]),o(x,{message:"",class:"mt-2"})]),r("div",U,[o(j,{for:"body",value:"Email Body",class:"sr-only"}),o(B,{id:"body",modelValue:s.value.body,"onUpdate:modelValue":e[1]||(e[1]=d=>s.value.body=d),placeholder:"Edit the email here...",height:"300px"},null,8,["modelValue"]),o(x,{message:"",class:"mt-2"})]),b(f)?(c(),u("div",{key:0,class:"unselectable-signature",innerHTML:b(f)},null,8,z)):k("",!0),r("div",D,[o(N,{onClick:w,class:y({"opacity-25":t.value}),disabled:t.value},{default:_(()=>e[4]||(e[4]=[v(" Approve & Send ",-1)])),_:1,__:[4]},8,["class","disabled"]),o(M,{onClick:C,class:y({"opacity-25":t.value}),disabled:t.value},{default:_(()=>e[5]||(e[5]=[v(" Reject ",-1)])),_:1,__:[5]},8,["class","disabled"])])],32)]))}},Z=T(F,[["__scopeId","data-v-c3d683bb"]]);export{Z as default};
