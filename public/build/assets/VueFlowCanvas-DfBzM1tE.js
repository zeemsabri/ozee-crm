import{u as J,P as ce,_ as ue,W as fe,a as de}from"./WorkflowNode-BNBs2xC7.js";import{aD as te,l as oe,aP as G,c as k,o as m,Z as C,a as b,q as A,k as V,u as y,j as pe,ab as ne,w as P,F as se,e as N,K as j,m as me,b as he}from"./app-ecDjzow_.js";import _e from"./AddStepButton-Dh3LZylM.js";import{u as ge}from"./workflowStore-TEG-3-w7.js";import"./TriggerStep-84vICwz4.js";import"./StepCard-C_nmP-nE.js";import"./createLucideIcon-BIh9yAL0.js";import"./x-CLZAJqYk.js";import"./trash-CwFZXVNc.js";import"./SelectDropdown-B0ANJPd7.js";/* empty css                                                                       */import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./ConditionStep-CAIUGkF_.js";import"./RelationshipPathPicker-CWdUpvch.js";import"./plus-CebPoM9L.js";import"./ActionStep-C1L-2VTg.js";import"./DataTokenInserter-DjSFGI8h.js";import"./AIStep-HkLspjt6.js";import"./RelatedDataPicker-C0jT3Xu3.js";import"./BaseFormModal-CFuvA4Pl.js";import"./Modal-Drh2rcDC.js";import"./PrimaryButton-DJS6EVDj.js";import"./SecondaryButton-CS308GJ3.js";import"./PromptForm-DHPj9VK2.js";import"./ResponseBuilder-5-QZuwdF.js";import"./FieldBuilder-DeH9Ur9F.js";import"./chevron-down-B-wBYrEE.js";import"./circle-x-Bv2jCZKr.js";import"./ForEachStep-B-lAyMiC.js";import"./FetchRecordsStep-Dgd59y0s.js";import"./ScheduleTriggerStep-BSH7-Fca.js";import"./TransformStep-BHXEdsue.js";import"./DefineVariableStep-rNm3YfH2.js";var D=(n=>(n.Lines="lines",n.Dots="dots",n))(D||{});const ie=function({dimensions:n,size:h,color:a}){return ne("path",{stroke:a,"stroke-width":h,d:`M${n[0]/2} 0 V${n[1]} M0 ${n[1]/2} H${n[0]}`})},re=function({radius:n,color:h}){return ne("circle",{cx:n,cy:n,r:n,fill:h})};D.Lines+"",D.Dots+"";const ve={[D.Dots]:"#81818a",[D.Lines]:"#eee"},we=["id","x","y","width","height","patternTransform"],ye={key:2,height:"100",width:"100"},$e=["fill"],Ce=["x","y","fill"],Se={name:"Background",compatConfig:{MODE:3}},xe=te({...Se,props:{id:{},variant:{default:()=>D.Dots},gap:{default:20},size:{default:1},lineWidth:{default:1},patternColor:{},color:{},bgColor:{},height:{default:100},width:{default:100},x:{default:0},y:{default:0},offset:{default:0}},setup(n){const{id:h,viewport:a}=J(),_=oe(()=>{const c=a.value.zoom,[I,T]=Array.isArray(n.gap)?n.gap:[n.gap,n.gap],O=[I*c||1,T*c||1],L=n.size*c,[R,B]=Array.isArray(n.offset)?n.offset:[n.offset,n.offset],Z=[R*c||1+O[0]/2,B*c||1+O[1]/2];return{scaledGap:O,offset:Z,size:L}}),H=G(()=>`pattern-${h}${n.id?`-${n.id}`:""}`),E=G(()=>n.color||n.patternColor||ve[n.variant||D.Dots]);return(c,I)=>(m(),k("svg",{class:"vue-flow__background vue-flow__container",style:pe({height:`${c.height>100?100:c.height}%`,width:`${c.width>100?100:c.width}%`})},[C(c.$slots,"pattern-container",{id:H.value},()=>[b("pattern",{id:H.value,x:y(a).x%_.value.scaledGap[0],y:y(a).y%_.value.scaledGap[1],width:_.value.scaledGap[0],height:_.value.scaledGap[1],patternTransform:`translate(-${_.value.offset[0]},-${_.value.offset[1]})`,patternUnits:"userSpaceOnUse"},[C(c.$slots,"pattern",{},()=>[c.variant===y(D).Lines?(m(),A(y(ie),{key:0,size:c.lineWidth,color:E.value,dimensions:_.value.scaledGap},null,8,["size","color","dimensions"])):c.variant===y(D).Dots?(m(),A(y(re),{key:1,color:E.value,radius:_.value.size/2},null,8,["color","radius"])):V("",!0),c.bgColor?(m(),k("svg",ye,[b("rect",{width:"100%",height:"100%",fill:c.bgColor},null,8,$e)])):V("",!0)])],8,we)]),b("rect",{x:c.x,y:c.y,width:"100%",height:"100%",fill:`url(#${H.value})`},null,8,Ce),C(c.$slots,"default",{id:H.value})],4))}}),ze={name:"ControlButton",compatConfig:{MODE:3}},be=(n,h)=>{const a=n.__vccOpts||n;for(const[_,H]of h)a[_]=H;return a},ke={type:"button",class:"vue-flow__controls-button"};function He(n,h,a,_,H,E){return m(),k("button",ke,[C(n.$slots,"default")])}const q=be(ze,[["render",He]]),Ve={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32"},Ae=b("path",{d:"M32 18.133H18.133V32h-4.266V18.133H0v-4.266h13.867V0h4.266v13.867H32z"},null,-1),De=[Ae];function Oe(n,h){return m(),k("svg",Ve,De)}const Be={render:Oe},Ee={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 5"},Ne=b("path",{d:"M0 0h32v4.2H0z"},null,-1),Me=[Ne];function Fe(n,h){return m(),k("svg",Ee,Me)}const Pe={render:Fe},Ie={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 30"},Te=b("path",{d:"M3.692 4.63c0-.53.4-.938.939-.938h5.215V0H4.708C2.13 0 0 2.054 0 4.63v5.216h3.692V4.631zM27.354 0h-5.2v3.692h5.17c.53 0 .984.4.984.939v5.215H32V4.631A4.624 4.624 0 0 0 27.354 0zm.954 24.83c0 .532-.4.94-.939.94h-5.215v3.768h5.215c2.577 0 4.631-2.13 4.631-4.707v-5.139h-3.692v5.139zm-23.677.94a.919.919 0 0 1-.939-.94v-5.138H0v5.139c0 2.577 2.13 4.707 4.708 4.707h5.138V25.77H4.631z"},null,-1),Le=[Te];function Re(n,h){return m(),k("svg",Ie,Le)}const Ze={render:Re},Ye={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32"},je=b("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0 8 0 4.571 3.429 4.571 7.619v3.048H3.048A3.056 3.056 0 0 0 0 13.714v15.238A3.056 3.056 0 0 0 3.048 32h18.285a3.056 3.056 0 0 0 3.048-3.048V13.714a3.056 3.056 0 0 0-3.048-3.047zM12.19 24.533a3.056 3.056 0 0 1-3.047-3.047 3.056 3.056 0 0 1 3.047-3.048 3.056 3.056 0 0 1 3.048 3.048 3.056 3.056 0 0 1-3.048 3.047zm4.724-13.866H7.467V7.619c0-2.59 2.133-4.724 4.723-4.724 2.591 0 4.724 2.133 4.724 4.724v3.048z"},null,-1),Ge=[je];function Ue(n,h){return m(),k("svg",Ye,Ge)}const We={render:Ue},qe={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32"},Xe=b("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0c-4.114 1.828-1.37 2.133.305 2.438 1.676.305 4.42 2.59 4.42 5.181v3.048H3.047A3.056 3.056 0 0 0 0 13.714v15.238A3.056 3.056 0 0 0 3.048 32h18.285a3.056 3.056 0 0 0 3.048-3.048V13.714a3.056 3.056 0 0 0-3.048-3.047zM12.19 24.533a3.056 3.056 0 0 1-3.047-3.047 3.056 3.056 0 0 1 3.047-3.048 3.056 3.056 0 0 1 3.048 3.048 3.056 3.056 0 0 1-3.048 3.047z"},null,-1),Ke=[Xe];function Je(n,h){return m(),k("svg",qe,Ke)}const Qe={render:Je},et={name:"Controls",compatConfig:{MODE:3}},tt=te({...et,props:{showZoom:{type:Boolean,default:!0},showFitView:{type:Boolean,default:!0},showInteractive:{type:Boolean,default:!0},fitViewParams:{},position:{default:()=>ce.BottomLeft}},emits:["zoomIn","zoomOut","fitView","interactionChange"],setup(n,{emit:h}){const{nodesDraggable:a,nodesConnectable:_,elementsSelectable:H,setInteractive:E,zoomIn:c,zoomOut:I,fitView:T,viewport:O,minZoom:L,maxZoom:R}=J(),B=G(()=>a.value||_.value||H.value),Z=G(()=>O.value.zoom<=L.value),X=G(()=>O.value.zoom>=R.value);function Q(){c(),h("zoomIn")}function K(){I(),h("zoomOut")}function M(){T(n.fitViewParams),h("fitView")}function F(){E(!B.value),h("interactionChange",!B.value)}return(g,Y)=>(m(),A(y(ue),{class:"vue-flow__controls",position:g.position},{default:P(()=>[C(g.$slots,"top"),g.showZoom?(m(),k(se,{key:0},[C(g.$slots,"control-zoom-in",{},()=>[N(q,{class:"vue-flow__controls-zoomin",disabled:X.value,onClick:Q},{default:P(()=>[C(g.$slots,"icon-zoom-in",{},()=>[(m(),A(j(y(Be))))])]),_:3},8,["disabled"])]),C(g.$slots,"control-zoom-out",{},()=>[N(q,{class:"vue-flow__controls-zoomout",disabled:Z.value,onClick:K},{default:P(()=>[C(g.$slots,"icon-zoom-out",{},()=>[(m(),A(j(y(Pe))))])]),_:3},8,["disabled"])])],64)):V("",!0),g.showFitView?C(g.$slots,"control-fit-view",{key:1},()=>[N(q,{class:"vue-flow__controls-fitview",onClick:M},{default:P(()=>[C(g.$slots,"icon-fit-view",{},()=>[(m(),A(j(y(Ze))))])]),_:3})]):V("",!0),g.showInteractive?C(g.$slots,"control-interactive",{key:2},()=>[g.showInteractive?(m(),A(q,{key:0,class:"vue-flow__controls-interactive",onClick:F},{default:P(()=>[B.value?C(g.$slots,"icon-unlock",{key:0},()=>[(m(),A(j(y(Qe))))]):V("",!0),B.value?V("",!0):C(g.$slots,"icon-lock",{key:1},()=>[(m(),A(j(y(We))))])]),_:3})):V("",!0)]):V("",!0),C(g.$slots,"default")]),_:3},8,["position"]))}}),ot={class:"h-full w-full border-2 border-dashed border-gray-300 rounded-xl overflow-hidden bg-gray-50 relative"},nt={class:"absolute top-4 left-4 z-50 flex items-center space-x-4 bg-white p-2 rounded-full shadow-lg border"},st={key:0,class:"absolute inset-0 flex items-center justify-center p-8 z-10 pointer-events-none"},it={class:"text-center p-8 border-2 border-dashed rounded-lg bg-white/80 backdrop-blur-sm pointer-events-auto"},It={__name:"VueFlowCanvas",props:{steps:{type:Array,required:!0},fullContextSteps:{type:Array,default:()=>[]},loopContextSchema:{type:Object,default:null},allowTrigger:{type:Boolean,default:!0}},emits:["update:steps","add-trigger"],setup(n,{emit:h}){const a=n,_=h,H=ge(),E=oe(()=>H.automationSchema||[]),{onConnect:c,addEdges:I,removeEdges:T,nodes:O,edges:L,setNodes:R,setEdges:B,fitView:Z,onNodeDragStop:X,findNode:Q}=J(),K={workflow:fe};function M(i,t){let s=null;return{steps:i.filter(l=>String(l.id)===String(t)?(s=l,!1):!0).map(l=>{const r={...l};if(r.if_true){const e=M(r.if_true,t);r.if_true=e.steps,e.removed&&(s=e.removed)}if(r.if_false){const e=M(r.if_false,t);r.if_false=e.steps,e.removed&&(s=e.removed)}if(r.children){const e=M(r.children,t);r.children=e.steps,e.removed&&(s=e.removed)}return r}),removed:s}}function F(i,t,s,o){return i.map(l=>{if(String(l.id)===String(t)){const e={...l};return s==="yes"?e.if_true=[...e.if_true||[],o]:s==="no"?e.if_false=[...e.if_false||[],o]:s==="children"&&(e.children=[...e.children||[],o]),e}const r={...l};return r.if_true&&(r.if_true=F(r.if_true,t,s,o)),r.if_false&&(r.if_false=F(r.if_false,t,s,o)),r.children&&(r.children=F(r.children,t,s,o)),r})}c(i=>{const t=i.source.replace("step-",""),s=i.target.replace("step-","");if(t===s)return;const o=i.sourceHandle??null,l=`vueflow__edge-${i.source}${i.sourceHandle??""}-${i.target}${i.targetHandle??""}`;T([l]);const{steps:r,removed:e}=M([...a.steps],s);if(!e)return;let f;if(o)f=F(r,t,o,e);else{const d=w=>{const u=w.findIndex(S=>String(S.id)===String(t));if(u!==-1){const S=[...w];return S.splice(u+1,0,e),S}return w.map(S=>{const p={...S};return p.if_true&&(p.if_true=d(p.if_true)),p.if_false&&(p.if_false=d(p.if_false)),p.children&&(p.children=d(p.children)),p})};f=d(r)}_("update:steps",f)}),X(({node:i})=>{const t=String(i.data.step.id),s=i.position,o=l=>l.map(r=>{if(String(r.id)===t)return{...r,step_config:{...r.step_config||{},position:s}};const e={...r};return e.if_true&&(e.if_true=o(e.if_true)),e.if_false&&(e.if_false=o(e.if_false)),e.children&&(e.children=o(e.children)),e});_("update:steps",o([...a.steps]))});function g(i,t){var d,w,u,S,p;const s=(d=i.step_config)==null?void 0:d.sourceArray;if(!s)return null;const o=s.match(/{{step_(\w+)\.(.+)}}/);if(!o)return null;const l=o[1],r=o[2],e=t.find(v=>String(v.id)===String(l)),f=v=>{const x=String((v==null?void 0:v.type)||"").toLowerCase(),z=String((v==null?void 0:v.itemType)||"").toLowerCase();return x==="array of objects"||x==="array"&&z==="object"};if((e==null?void 0:e.step_type)==="AI_PROMPT"||(e==null?void 0:e.step_type)==="ACTION"&&((w=e==null?void 0:e.step_config)==null?void 0:w.action_type)==="FETCH_API_DATA"){const v=r.replace(/^parsed\./,""),x=(S=(u=e.step_config)==null?void 0:u.responseStructure)==null?void 0:S.find(z=>z.name===v);return f(x)?{name:"Loop Item",columns:x.schema||[]}:null}if((e==null?void 0:e.step_type)==="FETCH_RECORDS"&&r==="records"){const v=(p=e.step_config)==null?void 0:p.model;if(!v)return null;const x=E.value.find($=>$.name===v);return x?{name:"Loop Item",columns:(x.columns||[]).map($=>typeof $=="string"?{name:$}:$)}:null}return null}function Y(i,t=null,s=null,o=0,l={x:0,y:0},r=[],e=null){let f=[],d=[],w=l.y;return i.forEach((u,S)=>{const p=`step-${u.id}`,v=u.step_config&&u.step_config.position?u.step_config.position:{x:l.x,y:w},x=[...r,...i.slice(0,S)];if(f.push({id:p,type:"workflow",position:v,data:{step:u,allStepsBefore:[...a.fullContextSteps,...x],loopContextSchema:e||a.loopContextSchema,onUpdate:z=>le(u.id,z),onDelete:()=>ae(u.id),onAddStep:(z,$)=>ee(z,u.id,$)}}),S>0?d.push({id:`e-step-${i[S-1].id}-${u.id}`,source:`step-${i[S-1].id}`,target:p,animated:!0}):t&&d.push({id:`e-${t}-${p}`,source:t,target:p,sourceHandle:s,animated:!0,label:s?s.toUpperCase():""}),w+=450,u.step_type==="CONDITION"){const z=Y(u.if_true||[],p,"yes",o+1,{x:v.x-300,y:w},[...x,u],e||a.loopContextSchema),$=Y(u.if_false||[],p,"no",o+1,{x:v.x+300,y:w},[...x,u],e||a.loopContextSchema);f.push(...z.nodes,...$.nodes),d.push(...z.edges,...$.edges),w=Math.max(w,z.maxY,$.maxY)}if(u.step_type==="FOR_EACH"){const z=g(u,[...a.fullContextSteps,...x]),$=Y(u.children||[],p,"children",o+1,{x:v.x,y:w},[...x,u],z);f.push(...$.nodes),d.push(...$.edges),w=Math.max(w,$.maxY)}}),{nodes:f,edges:d,maxY:w}}me(()=>a.steps,i=>{const{nodes:t,edges:s}=Y(i);R(t),B(s)},{deep:!0,immediate:!0});function U(i,t,s){return i.map(o=>{if(o.id===t)return s;const l={...o};return l.if_true&&(l.if_true=U(l.if_true,t,s)),l.if_false&&(l.if_false=U(l.if_false,t,s)),l.children&&(l.children=U(l.children,t,s)),l})}function le(i,t){_("update:steps",U([...a.steps],i,t))}function W(i,t){return i.filter(s=>s.id!==t).map(s=>{const o={...s};return o.if_true&&(o.if_true=W(o.if_true,t)),o.if_false&&(o.if_false=W(o.if_false,t)),o.children&&(o.children=W(o.children,t)),o})}function ae(i){_("update:steps",W([...a.steps],i))}function ee(i,t=null,s=null){const o={id:`temp_${Date.now()}`,step_type:i,name:`New ${i.replace("_"," ")} Step`,step_config:{}};if(i==="CONDITION"&&(o.if_true=[],o.if_false=[]),i==="FOR_EACH"&&(o.children=[]),!t)_("update:steps",[...a.steps,o]);else{const l=r=>r.map(e=>{if(e.id===t){const d={...e};return s==="yes"?d.if_true=[...d.if_true||[],o]:s==="no"?d.if_false=[...d.if_false||[],o]:s==="children"&&(d.children=[...d.children||[],o]),d}const f={...e};return f.if_true&&(f.if_true=l(f.if_true)),f.if_false&&(f.if_false=l(f.if_false)),f.children&&(f.children=l(f.children)),f});_("update:steps",l([...a.steps]))}}return he(()=>{setTimeout(()=>Z(),100)}),(i,t)=>(m(),k("div",ot,[N(y(de),{nodes:y(O),edges:y(L),"node-types":K,"min-zoom":.2,"max-zoom":4,"fit-view-on-init":""},{default:P(()=>[N(y(xe),{"pattern-color":"#aaa",gap:16}),N(y(tt)),b("div",nt,[t[2]||(t[2]=b("span",{class:"text-xs font-bold text-gray-500 ml-4"},"ADD STEP:",-1)),N(_e,{onSelect:t[0]||(t[0]=s=>ee(s))})]),n.steps.length===0?(m(),k("div",st,[b("div",it,[n.allowTrigger?(m(),k(se,{key:0},[t[3]||(t[3]=b("h3",{class:"text-lg font-semibold text-gray-700"},"Start your Automation",-1)),t[4]||(t[4]=b("p",{class:"text-sm text-gray-500 mt-1 mb-4"},"Every workflow starts with a trigger. How should this one begin?",-1)),b("button",{onClick:t[1]||(t[1]=s=>i.$emit("add-trigger")),class:"px-6 py-2 text-sm font-semibold rounded-md bg-indigo-600 text-white hover:bg-indigo-700 shadow-md transition-all"}," Add Trigger ")],64)):V("",!0)])])):V("",!0)]),_:1},8,["nodes","edges"])]))}};export{It as default};
