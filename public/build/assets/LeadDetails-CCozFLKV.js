import{r as c,f as ee,a as l,o,d as y,u as s,h as te,w as g,b as t,i as u,t as i,m,F as f,l as T,j as O,q as se,v as ae,g as oe,p as W}from"./app-BXwNPRau.js";import{R as le,_ as ie}from"./AuthenticatedLayout-BMEcVAiY.js";import{_ as b}from"./PrimaryButton-DDR27hXv.js";import{_ as ne}from"./SecondaryButton-DxVzHrUO.js";import{_ as de}from"./Modal-CyQll2yY.js";import re from"./CustomComposeEmailContent-Bi92zWnf.js";import ue from"./CustomEmailApprovalContent-DW_oJ8zy.js";import{_ as me}from"./EmailDetailsContent--iXhEgv3.js";import pe from"./EmailActionContent-DPS8YlpT.js";import ve from"./ReceivedEmailActionContent-fTGkgIuo.js";import{u as ye}from"./useLeadDetails-DYkLQBrr.js";import"./InputLabel-xP1ePHj0.js";import"./InputError-C5PNSPQA.js";import"./index-BYXC290y.js";import"./BaseFormModal-pcrUNZXB.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./TextInput-BpHbgyBH.js";import"./SelectDropdown-DM-nWwpK.js";/* empty css                                                                       */import"./debounce-C-hnF4Z3.js";import"./Checkbox-MWSF-P8H.js";import"./ApplicationLogo-D-Jv_k0y.js";import"./DangerButton-042f3578.js";import"./moment-BLMuvzoS.js";import"./NoticeboardModal-CztiEtks.js";import"./CustomMultiSelect-DIFr_ut3.js";import"./EmailEditor-YoB9HK2s.js";import"./EmailEditor.vue_vue_type_style_index_0_lang-VYqhbuCb.js";import"./useEmailSignature-HOD31L87.js";import"./useEmailTemplate-DnLo4YmX.js";import"./EmailAttachmentsList-CB1Sp0Ou.js";import"./TrashIcon-4vlBF9h4.js";import"./TaskCreationForm-DZvi6TSf.js";const ce={class:"flex items-center justify-between w-full"},ge={class:"flex items-center gap-3"},_e={class:"flex items-center gap-2"},fe={key:1,class:"text-sm text-gray-500"},xe={class:"py-6 min-h-screen w-full"},be={class:"w-full px-4 sm:px-6 lg:px-8"},we={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},ke={class:"p-6 text-gray-900"},he={key:0,class:"mb-4 text-red-600"},Ce={key:1,class:"animate-pulse space-y-3"},Ee={key:2,class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},Le={class:"lg:col-span-2 space-y-6"},$e={class:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm"},Se={class:"font-medium"},je={key:0},Ne={class:"font-medium"},Ae={key:1},De={class:"font-medium"},Pe={key:2},Te={class:"font-medium"},Fe={key:3},Ve={class:"font-medium"},ze={key:4},Be={class:"font-medium"},Ue={key:5},Re={class:"font-medium"},qe={key:6},Ie={class:"font-medium"},Me={key:7},Oe={class:"font-medium"},We={key:8},Ge={class:"font-medium"},He={key:9},Je={class:"font-medium"},Ke={key:10},Qe={class:"font-medium"},Xe={key:11},Ye={class:"font-medium"},Ze={class:"flex items-center justify-between mb-2"},et={key:0,class:"text-gray-500 text-sm"},tt={key:1,class:"text-red-600 text-sm"},st={key:2,class:"text-gray-500 text-sm"},at={key:3,class:"overflow-x-auto shadow rounded-md border border-gray-100"},ot={class:"min-w-full divide-y divide-gray-200"},lt={class:"bg-white divide-y divide-gray-200"},it=["onClick"],nt={class:"px-4 py-2 text-sm text-gray-900"},dt={class:"px-4 py-2 text-sm"},rt={class:"px-4 py-2 text-sm text-gray-500"},ut={class:"px-4 py-2 text-sm text-gray-500"},mt={key:0,class:"p-2 flex justify-end gap-1"},pt=["disabled"],vt={class:"px-2 py-1 text-sm"},yt=["disabled"],ct={class:"lg:col-span-1 space-y-6"},gt={key:0,class:"text-gray-500 text-sm"},_t={key:1,class:"text-red-600 text-sm"},ft={key:2,class:"text-gray-500 text-sm"},xt={key:3,class:"divide-y divide-gray-200 rounded-md border border-gray-200"},bt={class:"font-medium"},wt={class:"text-xs text-gray-500"},kt={class:"flex items-center gap-2"},ht={class:"mb-3 flex gap-2"},Ct={key:0,class:"text-red-600 text-sm mb-2"},Et={key:1,class:"text-gray-500 text-sm"},Lt={class:"relative"},$t={class:"space-y-4"},St={class:"border rounded-md p-3 bg-white"},jt={class:"text-sm whitespace-pre-wrap"},Nt={class:"text-xs text-gray-500 mt-1 flex items-center gap-2"},At={key:0,class:"inline-flex items-center px-2 py-0.5 rounded bg-gray-100 text-gray-600"},Dt={key:0,class:"text-sm text-gray-500"},Pt={class:"p-6"},Tt={key:0,class:"text-red-600 text-sm mt-2"},Ft={class:"mt-6 flex justify-end gap-2"},Vt={key:0},zt={key:1},Bt={key:2},Ut={key:3},Rt={key:4},ws={__name:"LeadDetails",props:{id:{type:Number,required:!0},lead:{type:Object,default:null}},setup(G){const j=c([]),N=c(!1),E=c(""),H=async()=>{var p,e;if(x!=null&&x.value){N.value=!0,E.value="";try{const{data:d}=await W.get(`/api/leads/${x.value}/presentations`);j.value=Array.isArray(d)?d:(d==null?void 0:d.data)??[]}catch(d){console.error("Failed to load presentations",d),E.value=((e=(p=d==null?void 0:d.response)==null?void 0:p.data)==null?void 0:e.message)||"Failed to load presentations"}finally{N.value=!1}}},x=c(G.id),{loading:F,error:V,lead:a,fullName:z,notes:B,notesLoading:U,notesError:R,savingNote:q,fetchLead:J,fetchNotes:K,addNote:Q}=ye(x),w=c(""),k=c(!1),h=c(!1),L=c(""),X=async()=>{var p,e;if(a.value){h.value=!0,L.value="";try{const{data:d}=await window.axios.post(`/api/leads/${a.value.id}/convert`),v=(d==null?void 0:d.client_id)||(d==null?void 0:d.id)||d;k.value=!1,v&&(window.location.href=`/clients/${v}`)}catch(d){console.error("Conversion failed",d),L.value=((e=(p=d==null?void 0:d.response)==null?void 0:p.data)==null?void 0:e.message)||"Failed to convert lead"}finally{h.value=!1}}},A=c([]),D=c(!1),$=c(""),_=c({current_page:1,last_page:1,total:0}),P=async(p=1)=>{var e,d;D.value=!0,$.value="";try{const{data:v}=await W.get(`/api/leads/${x.value}/emails`,{params:{page:p}});A.value=v.data||[],_.value={current_page:v.current_page||1,last_page:v.last_page||1,total:v.total||(Array.isArray(v.data)?v.data.length:0)}}catch(v){console.error("Failed to load lead emails",v),$.value=((d=(e=v==null?void 0:v.response)==null?void 0:e.data)==null?void 0:d.message)||"Failed to load emails"}finally{D.value=!1}},r=c({show:!1,mode:null,title:"",data:null,loading:!1}),I=()=>{r.value={show:!0,mode:"custom-compose",title:"Compose Email to Lead",data:null,loading:!1}},Y=p=>{r.value={show:!0,mode:"view-email",title:"Email Details",data:p,loading:!1}},Z=p=>{r.value.show=!0,r.value.data=p,p.type==="received"&&(p.status==="pending_approval_received"||p.status==="received")?(r.value.mode="received-edit",r.value.title="Approve Received Email"):p.template_id?(r.value.mode="edit",r.value.title="Edit & Approve Template Email"):(r.value.mode="custom-edit",r.value.title="Edit & Approve Custom Email")},S=()=>{r.value.show=!1,P(_.value.current_page)},M=p=>{p<1||p>_.value.last_page||P(p)};return ee(async()=>{await J(),await K(),await P(1),await H()}),(p,e)=>(o(),l(f,null,[y(s(te),{title:`Lead: ${s(z)}`},null,8,["title"]),y(ie,null,{header:g(()=>{var d;return[t("div",ce,[t("div",null,[t("div",ge,[e[9]||(e[9]=t("h2",{class:"font-semibold text-xl text-gray-800 leading-tight"},"Lead Details",-1)),s(a)?(o(),l("span",{key:0,class:O(["text-xs px-2 py-0.5 rounded-full capitalize",{"bg-gray-100 text-gray-700":!s(a).status||s(a).status.toLowerCase()==="new","bg-blue-100 text-blue-700":s(a).status&&s(a).status.toLowerCase()==="contacted","bg-amber-100 text-amber-700":s(a).status&&s(a).status.toLowerCase()==="qualified","bg-emerald-100 text-emerald-700":s(a).status&&s(a).status.toLowerCase()==="converted","bg-rose-100 text-rose-700":s(a).status&&s(a).status.toLowerCase()==="lost"}])},i(s(a).status||"new"),3)):u("",!0)])]),t("div",_e,[y(b,{onClick:I},{default:g(()=>e[10]||(e[10]=[m("Compose Email",-1)])),_:1,__:[10]}),(((d=s(a))==null?void 0:d.status)||"").toLowerCase()!=="converted"?(o(),oe(b,{key:0,onClick:e[0]||(e[0]=v=>k.value=!0)},{default:g(()=>e[11]||(e[11]=[m("Convert to Client",-1)])),_:1,__:[11]})):(o(),l("span",fe,"Already converted"))])])]}),default:g(()=>{var d,v;return[t("div",xe,[t("div",be,[t("div",we,[t("div",ke,[s(V)?(o(),l("div",he,i(s(V)),1)):u("",!0),s(F)?(o(),l("div",Ce,e[12]||(e[12]=[t("div",{class:"h-5 bg-gray-200 rounded w-1/3"},null,-1),t("div",{class:"h-4 bg-gray-200 rounded w-1/2"},null,-1),t("div",{class:"h-32 bg-gray-100 rounded"},null,-1)]))):u("",!0),s(a)&&!s(F)?(o(),l("div",Ee,[t("section",Le,[t("div",null,[e[37]||(e[37]=t("h3",{class:"text-lg font-semibold mb-2"},"Profile",-1)),t("div",$e,[t("div",null,[e[13]||(e[13]=t("span",{class:"text-gray-500"},"Name:",-1)),e[14]||(e[14]=m()),t("span",Se,i(s(z)),1)]),s(a).email?(o(),l("div",je,[e[15]||(e[15]=t("span",{class:"text-gray-500"},"Email:",-1)),e[16]||(e[16]=m()),t("span",Ne,i(s(a).email),1)])):u("",!0),s(a).phone?(o(),l("div",Ae,[e[17]||(e[17]=t("span",{class:"text-gray-500"},"Phone:",-1)),e[18]||(e[18]=m()),t("span",De,i(s(a).phone),1)])):u("",!0),s(a).company?(o(),l("div",Pe,[e[19]||(e[19]=t("span",{class:"text-gray-500"},"Company:",-1)),e[20]||(e[20]=m()),t("span",Te,i(s(a).company),1)])):u("",!0),s(a).title?(o(),l("div",Fe,[e[21]||(e[21]=t("span",{class:"text-gray-500"},"Title:",-1)),e[22]||(e[22]=m()),t("span",Ve,i(s(a).title),1)])):u("",!0),s(a).source?(o(),l("div",ze,[e[23]||(e[23]=t("span",{class:"text-gray-500"},"Source:",-1)),e[24]||(e[24]=m()),t("span",Be,i(s(a).source),1)])):u("",!0),s(a).pipeline_stage?(o(),l("div",Ue,[e[25]||(e[25]=t("span",{class:"text-gray-500"},"Pipeline Stage:",-1)),e[26]||(e[26]=m()),t("span",Re,i(s(a).pipeline_stage),1)])):u("",!0),s(a).estimated_value?(o(),l("div",qe,[e[27]||(e[27]=t("span",{class:"text-gray-500"},"Estimated Value:",-1)),e[28]||(e[28]=m()),t("span",Ie,i(s(a).estimated_value)+" "+i(s(a).currency||"USD"),1)])):u("",!0),s(a).website?(o(),l("div",Me,[e[29]||(e[29]=t("span",{class:"text-gray-500"},"Website:",-1)),e[30]||(e[30]=m()),t("span",Oe,i(s(a).website),1)])):u("",!0),s(a).address||s(a).city||s(a).state||s(a).zip||s(a).country?(o(),l("div",We,[e[31]||(e[31]=t("span",{class:"text-gray-500"},"Address:",-1)),t("div",Ge,[m(i(s(a).address)+" ",1),s(a).city?(o(),l(f,{key:0},[m(", "+i(s(a).city),1)],64)):u("",!0),s(a).state?(o(),l(f,{key:1},[m(", "+i(s(a).state),1)],64)):u("",!0),s(a).zip?(o(),l(f,{key:2},[m(i(s(a).zip),1)],64)):u("",!0),s(a).country?(o(),l(f,{key:3},[m(", "+i(s(a).country),1)],64)):u("",!0)])])):u("",!0),(d=s(a).assigned_to)!=null&&d.name||s(a).assigned_to_id?(o(),l("div",He,[e[32]||(e[32]=t("span",{class:"text-gray-500"},"Assigned:",-1)),t("span",Je,i(((v=s(a).assigned_to)==null?void 0:v.name)||`User #${s(a).assigned_to_id}`),1)])):u("",!0),s(a).tags?(o(),l("div",Ke,[e[33]||(e[33]=t("span",{class:"text-gray-500"},"Tags:",-1)),e[34]||(e[34]=m()),t("span",Qe,i(s(a).tags),1)])):u("",!0),s(a).notes?(o(),l("div",Xe,[e[35]||(e[35]=t("span",{class:"text-gray-500"},"Notes:",-1)),e[36]||(e[36]=m()),t("span",Ye,i(s(a).notes),1)])):u("",!0)])]),t("div",null,[t("div",Ze,[e[39]||(e[39]=t("h3",{class:"text-lg font-semibold"},"Emails",-1)),y(b,{onClick:I},{default:g(()=>e[38]||(e[38]=[m("Compose Email",-1)])),_:1,__:[38]})]),D.value?(o(),l("div",et,"Loading emails...")):$.value?(o(),l("div",tt,i($.value),1)):A.value.length===0?(o(),l("div",st,"No emails found for this lead.")):(o(),l("div",at,[t("table",ot,[e[40]||(e[40]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase"},"Subject"),t("th",{class:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase"},"Status"),t("th",{class:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase"},"Type"),t("th",{class:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase"},"Date")])],-1)),t("tbody",lt,[(o(!0),l(f,null,T(A.value,n=>(o(),l("tr",{key:n.id,class:"hover:bg-gray-50 cursor-pointer",onClick:C=>Y(n)},[t("td",nt,i(n.subject),1),t("td",dt,[t("span",{class:O({"px-2 py-1 rounded-full text-xs font-medium":!0,"bg-green-100 text-green-800":n.status==="sent","bg-yellow-100 text-yellow-800":n.status==="pending_approval"||n.status==="pending_approval_received","bg-blue-100 text-blue-800":n.status==="received"})},i((n.status||"n/a").replace(/_/g," ").toUpperCase()),3)]),t("td",rt,i(n.type),1),t("td",ut,i(new Date(n.created_at).toLocaleString()),1)],8,it))),128))])]),_.value.last_page>1?(o(),l("div",mt,[t("button",{class:"px-2 py-1 text-sm border rounded",disabled:_.value.current_page===1,onClick:e[1]||(e[1]=n=>M(_.value.current_page-1))},"Prev",8,pt),t("span",vt,"Page "+i(_.value.current_page)+" of "+i(_.value.last_page),1),t("button",{class:"px-2 py-1 text-sm border rounded",disabled:_.value.current_page===_.value.last_page,onClick:e[2]||(e[2]=n=>M(_.value.current_page+1))},"Next",8,yt)])):u("",!0)]))])]),t("aside",ct,[t("div",null,[e[43]||(e[43]=t("div",{class:"flex items-center justify-between mb-2"},[t("h3",{class:"text-lg font-semibold"},"Presentations")],-1)),N.value?(o(),l("div",gt,"Loading presentations...")):E.value?(o(),l("div",_t,i(E.value),1)):j.value.length===0?(o(),l("div",ft,"No presentations found for this lead.")):(o(),l("ul",xt,[(o(!0),l(f,null,T(j.value,n=>(o(),l("li",{key:n.id,class:"p-3 flex items-center justify-between"},[t("div",null,[t("div",bt,i(n.title),1),t("div",wt,"Type: "+i(n.type),1)]),t("div",kt,[y(b,{as:"a",href:`/view/${n.share_token}`,target:"_blank",title:"Open public preview"},{default:g(()=>e[41]||(e[41]=[m("View",-1)])),_:2,__:[41]},1032,["href"]),y(b,{as:"a",href:`/presentations/${n.id}/edit`,title:"Edit in builder"},{default:g(()=>e[42]||(e[42]=[m("Edit",-1)])),_:2,__:[42]},1032,["href"])])]))),128))]))]),e[46]||(e[46]=t("h3",{class:"text-lg font-semibold mb-2"},"Notes",-1)),t("div",ht,[se(t("input",{"onUpdate:modelValue":e[3]||(e[3]=n=>w.value=n),type:"text",class:"flex-1 rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",placeholder:"Add a note..."},null,512),[[ae,w.value]]),y(b,{disabled:s(q)||!w.value.trim(),onClick:e[4]||(e[4]=async()=>{await s(Q)(w.value),w.value=""})},{default:g(()=>[m(i(s(q)?"Saving...":"Save"),1)]),_:1},8,["disabled"])]),s(R)?(o(),l("div",Ct,i(s(R)),1)):u("",!0),s(U)?(o(),l("div",Et,"Loading notes...")):u("",!0),t("div",Lt,[e[45]||(e[45]=t("div",{class:"absolute left-3 top-0 bottom-0 w-px bg-gray-200","aria-hidden":"true"},null,-1)),t("ul",$t,[(o(!0),l(f,null,T(s(B),n=>{var C;return o(),l("li",{key:n.id,class:"relative pl-8"},[e[44]||(e[44]=t("div",{class:"absolute left-0 top-1.5 w-2 h-2 bg-indigo-400 rounded-full"},null,-1)),t("div",St,[t("div",jt,i(n.body||n.content||n.note||""),1),t("div",Nt,[n.type?(o(),l("span",At,i(n.type),1)):u("",!0),t("span",null,"By "+i(((C=n.user)==null?void 0:C.name)||"User")+" â€¢ "+i(new Date(n.created_at).toLocaleString()),1)])])])}),128)),!s(U)&&s(B).length===0?(o(),l("li",Dt,"No notes have been added yet.")):u("",!0)])])])])):u("",!0)])])])]),y(de,{show:k.value,onClose:e[6]||(e[6]=n=>k.value=!1)},{default:g(()=>[t("div",Pt,[e[48]||(e[48]=t("h3",{class:"text-lg font-semibold mb-2"},"Convert to Client",-1)),e[49]||(e[49]=t("p",null,"Are you sure you want to convert this lead into a client?",-1)),L.value?(o(),l("div",Tt,i(L.value),1)):u("",!0),t("div",Ft,[y(ne,{disabled:h.value,onClick:e[5]||(e[5]=n=>k.value=!1)},{default:g(()=>e[47]||(e[47]=[m("Cancel",-1)])),_:1,__:[47]},8,["disabled"]),y(b,{disabled:h.value,onClick:X},{default:g(()=>[m(i(h.value?"Converting...":"Convert"),1)]),_:1},8,["disabled"])])])]),_:1},8,["show"]),y(le,{show:r.value.show,title:r.value.title,onClose:e[8]||(e[8]=n=>r.value.show=!1)},{content:g(()=>{var n;return[r.value.mode==="custom-compose"?(o(),l("div",Vt,[y(re,{"project-id":null,"user-project-role":{},"force-recipient-mode":"leads","preset-lead-ids":[x.value],"hide-recipient-controls":!0,onSubmitted:S,onError:()=>{}},null,8,["preset-lead-ids"])])):r.value.mode==="view-email"?(o(),l("div",zt,[y(me,{email:r.value.data,"can-approve-emails":(n=r.value.data)==null?void 0:n.can_approve,onEdit:Z,onReject:e[7]||(e[7]=C=>{r.value.mode="reject",r.value.data=C,r.value.title="Reject Email"})},null,8,["email","can-approve-emails"])])):r.value.mode==="edit"||r.value.mode==="reject"?(o(),l("div",Bt,[y(pe,{email:r.value.data,mode:r.value.mode,onSubmitted:S},null,8,["email","mode"])])):r.value.mode==="received-edit"?(o(),l("div",Ut,[y(ve,{email:r.value.data,onSubmitted:S,onError:()=>{}},null,8,["email"])])):r.value.mode==="custom-edit"?(o(),l("div",Rt,[y(ue,{email:r.value.data,onSubmitted:S,onError:()=>{}},null,8,["email"])])):u("",!0)]}),_:1},8,["show","title"])]}),_:1})],64))}};export{ws as default};
