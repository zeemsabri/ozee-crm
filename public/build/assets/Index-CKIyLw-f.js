import{a as r,o as a,b as e,r as x,c as M,e as pe,g as Q,w as E,i as A,d as u,t as p,y as tt,L as H,m as L,v as Ae,x as st,M as ot,C as Se,j as J,s as X,F as se,l as ne,u as c,n as jt,k as $e,D as St,f as At,h as Bt,K as Nt,N as Pt,A as Tt,O as fe}from"./app-BVX1Xzgm.js";import{c as Ut,_ as Vt}from"./AuthenticatedLayout-Nxxzrcgy.js";import{S as be}from"./SelectDropdown-CAzD4PBf.js";import{_ as ce}from"./PrimaryButton-CSPVqQc4.js";import{_ as Be}from"./SecondaryButton-MUG3LyAH.js";import{c as W,d as Rt,f as te,a as Lt}from"./currency-BwKnTDqz.js";import{B as xe}from"./BaseFormModal-5czfdIGu.js";import{_ as oe}from"./InputLabel-BUJhUizc.js";import{_ as ie}from"./TextInput-CzwDI2b_.js";import{_ as le}from"./InputError-CFdo2J7R.js";import{_ as lt}from"./Modal-g15qzrXp.js";import{r as Me}from"./PlusIcon-D4buUb4F.js";import{r as Ft}from"./MagnifyingGlassIcon-d_Th93z2.js";import{a as je,r as It}from"./PlusCircleIcon-Y1zOiWLF.js";import{r as Ze}from"./CheckCircleIcon-B8RFBjmu.js";import{r as Et}from"./PencilSquareIcon-RzBFLPFp.js";import{r as Ot}from"./InformationCircleIcon-BkYPSjT-.js";import{r as qt}from"./ChevronDownIcon-Dofu8BCV.js";import{r as Kt}from"./XCircleIcon-BMB9FRIz.js";import{r as Ht}from"./TrashIcon-wt9bp4wj.js";import"./index-CHJvA3mY.js";import"./debounce-C-hnF4Z3.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./ApplicationLogo-JJBMKcky.js";import"./MultiSelectDropdown-B3VcmzFf.js";import"./createLucideIcon-Cqz0PmdE.js";import"./plus-D5eC1iXN.js";import"./DangerButton-Bg47W890.js";import"./moment-BLMuvzoS.js";import"./NoticeboardModal-sriidC3u.js";/* empty css                                                                       */function Yt(h,O){return a(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M21 12a2.25 2.25 0 0 0-2.25-2.25H15a3 3 0 1 1-6 0H5.25A2.25 2.25 0 0 0 3 12m18 0v6a2.25 2.25 0 0 1-2.25 2.25H5.25A2.25 2.25 0 0 1 3 18v-6m18 0V9M3 12V9m18 0a2.25 2.25 0 0 0-2.25-2.25H5.25A2.25 2.25 0 0 0 3 9m18 0V6a2.25 2.25 0 0 0-2.25-2.25H5.25A2.25 2.25 0 0 0 3 6v3"})])}const zt={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Gt={key:0,class:"text-xs text-gray-500 mt-1"},Xt={key:0},Jt={class:"md:col-span-2"},et={__name:"MilestoneExpendableModal",props:{show:Boolean,title:String,milestone:Object,users:Object,currencyOptions:Array,isBudgetForm:{type:Boolean,default:!1},isUserSelectionRequired:{type:Boolean,default:!1},projectTotalBudget:Number,projectBudgetCurrency:String,milestoneStats:Object,availableForNewMilestones:{type:Number,default:0},budgetBaseCurrency:{type:String,default:"AUD"}},emits:["close","submitted"],setup(h,{emit:O}){const l=h,U=O,o=x({}),b=x(""),D=x("post"),C=x(""),B=x(""),_=x({}),N=M(()=>{var m;return((Array.isArray((m=l.users)==null?void 0:m.users)?l.users.users:l.users)||[]).map(d=>({value:d.id,label:d.name}))});pe(()=>l.show,n=>{n&&l.milestone&&(_.value={},l.isBudgetForm?(o.value=l.milestone.budget?{...l.milestone.budget,amount:Number(l.milestone.budget.amount)}:{name:"Milestone Budget",description:"",amount:"",currency:"PKR"},b.value=l.milestone.budget?`/api/projects/${l.milestone.project_id}/expendables/${l.milestone.budget.id}`:`/api/projects/${l.milestone.project_id}/expendables`,D.value=l.milestone.budget?"put":"post",C.value=l.milestone.budget?"Update Budget":"Create Budget",B.value=l.milestone.budget?"Milestone budget updated successfully":"Milestone budget created successfully"):(o.value={name:"",description:"",amount:"",currency:"PKR",user_id:null},b.value=`/api/projects/${l.milestone.project_id}/expendables`,D.value="post",C.value="Create Contract",B.value="Contract created and sent for approval"))},{immediate:!0,deep:!0});const $=()=>{var d,F,S,f;_.value={};let n=!1;o.value.name||(_.value.name=["Name is required."],n=!0),(!o.value.amount||Number(o.value.amount)<=0)&&(_.value.amount=_.value.amount||[],_.value.amount.push("Amount must be a positive number."),n=!0),l.isUserSelectionRequired&&!o.value.user_id&&(_.value.user_id=["User selection is required for contracts."],n=!0);const m=W(Number(o.value.amount||0),o.value.currency,l.budgetBaseCurrency);if(l.isBudgetForm){const v=(d=l.milestone)!=null&&d.budget?W(Number(l.milestone.budget.amount||0),l.milestone.budget.currency,l.budgetBaseCurrency):0,G=Number(l.availableForNewMilestones||0)+((F=l.milestone)!=null&&F.budget?v:0);m>G+1e-8&&(_.value.amount=[`Amount exceeds allowed limit for milestone budget. Max allowed: ${W(G,l.budgetBaseCurrency,o.value.currency).toFixed(2)} ${o.value.currency}`],n=!0)}else W(Number(o.value.amount||0),o.value.currency,((S=l.milestone.budget)==null?void 0:S.currency)||"PKR")>Number(((f=l.milestoneStats)==null?void 0:f.remaining)||0)+1e-8&&(_.value.amount=["Cannot add a contract more than the remaining milestone budget."],n=!0);return!n},y=n=>({...n,amount:Number(n.amount||0),user_id:l.isBudgetForm?null:n.user_id,expendable_type:"Milestone",expendable_id:l.milestone.id}),P=n=>{U("submitted",n)},T=()=>{U("close")},g=M(()=>{var m,d;if(!l.isBudgetForm)return 0;const n=(m=l.milestone)!=null&&m.budget?W(Number(l.milestone.budget.amount||0),l.milestone.budget.currency,l.budgetBaseCurrency):0;return Number(l.availableForNewMilestones||0)+((d=l.milestone)!=null&&d.budget?n:0)}),z=M(()=>{var n;return W(Number(g.value||0),l.budgetBaseCurrency,((n=o.value)==null?void 0:n.currency)||"PKR")});return(n,m)=>(a(),Q(xe,{show:h.show,title:h.title,"api-endpoint":b.value,"http-method":D.value,"form-data":o.value,"submit-button-text":C.value,"success-message":B.value,"format-data-for-api":y,"before-submit":$,onSubmitted:P,onClose:T},{default:E(({errors:d})=>{var F,S,f,v,G,w,R,I,V,ae;return[e("div",zt,[e("div",null,[u(oe,{for:"name",value:"Name"}),u(ie,{id:"name",modelValue:o.value.name,"onUpdate:modelValue":m[0]||(m[0]=q=>o.value.name=q),class:"mt-1 w-full",placeholder:"e.g., Asset Purchase"},null,8,["modelValue"]),u(le,{message:((F=_.value.name)==null?void 0:F[0])||((S=d.name)==null?void 0:S[0]),class:"mt-1"},null,8,["message"])]),e("div",null,[u(oe,{for:"amount",value:"Amount"}),u(ie,{id:"amount",type:"number",step:"0.01",modelValue:o.value.amount,"onUpdate:modelValue":m[1]||(m[1]=q=>o.value.amount=q),class:"mt-1 w-full",max:h.isBudgetForm?Number(z.value.toFixed?z.value.toFixed(2):z.value):null},null,8,["modelValue","max"]),u(le,{message:((f=_.value.amount)==null?void 0:f[0])||((v=d.amount)==null?void 0:v[0]),class:"mt-1"},null,8,["message"])]),e("div",null,[u(oe,{for:"currency",value:"Currency"}),u(be,{id:"currency",modelValue:o.value.currency,"onUpdate:modelValue":m[2]||(m[2]=q=>o.value.currency=q),options:h.currencyOptions,"value-key":"value","label-key":"label",class:"mt-1 w-full"},null,8,["modelValue","options"]),u(le,{message:((G=_.value.currency)==null?void 0:G[0])||((w=d.currency)==null?void 0:w[0]),class:"mt-1"},null,8,["message"]),h.isBudgetForm?(a(),r("p",Gt,"Max allowed in selected currency: "+p(z.value.toFixed?z.value.toFixed(2):z.value)+" "+p(o.value.currency),1)):A("",!0)]),h.isBudgetForm?A("",!0):(a(),r("div",Xt,[u(oe,{for:"user",value:"User"}),u(be,{id:"user",modelValue:o.value.user_id,"onUpdate:modelValue":m[3]||(m[3]=q=>o.value.user_id=q),options:N.value,"value-key":"value","label-key":"label",class:"mt-1 w-full",placeholder:"Select user"},null,8,["modelValue","options"]),u(le,{message:((R=_.value.user_id)==null?void 0:R[0])||((I=d.user_id)==null?void 0:I[0]),class:"mt-1"},null,8,["message"])])),e("div",Jt,[u(oe,{for:"description",value:"Description (optional)"}),u(ie,{id:"description",modelValue:o.value.description,"onUpdate:modelValue":m[4]||(m[4]=q=>o.value.description=q),class:"mt-1 w-full",placeholder:"Details"},null,8,["modelValue"]),u(le,{message:((V=_.value.description)==null?void 0:V[0])||((ae=d.description)==null?void 0:ae[0]),class:"mt-1"},null,8,["message"])])])]}),_:1},8,["show","title","api-endpoint","http-method","form-data","submit-button-text","success-message"]))}},Qt={class:"text-sm text-gray-600 mb-4"},Wt={class:"mt-2"},Zt={__name:"ReasonModal",props:{show:{type:Boolean,default:!1},title:{type:String,default:"Reason Required"},message:{type:String,required:!0},type:{type:String,default:"info",validator:h=>["info","warning"].includes(h)},apiEndpoint:{type:String,required:!0},httpMethod:{type:String,required:!0}},emits:["submitted","close"],setup(h,{emit:O}){const l=h,U=O,o=x({reason:""}),b=x({}),D=()=>!o.value.reason||!o.value.reason.trim()?(H("Reason is required."),b.value.reason=["Reason is required."],!1):(b.value={},!0),C=()=>{U("submitted")},B=()=>{U("close")};return pe(()=>l.show,_=>{_&&(o.value={reason:""},b.value={})}),(_,N)=>(a(),Q(xe,{show:h.show,title:h.title,"api-endpoint":h.apiEndpoint,"http-method":h.httpMethod,"form-data":o.value,"submit-button-text":"Submit","success-message":"Operation successful!","before-submit":D,onClose:B,onSubmitted:C},{default:E(({errors:$})=>{var y,P;return[e("p",Qt,p(h.message),1),e("div",Wt,[u(oe,{for:"reason-input",value:"Reason"}),u(ie,{id:"reason-input",modelValue:o.value.reason,"onUpdate:modelValue":N[0]||(N[0]=T=>o.value.reason=T),class:"mt-1 block w-full",onKeyup:tt(C,["enter"])},null,8,["modelValue"]),u(le,{message:((y=$.reason)==null?void 0:y[0])||((P=b.value.reason)==null?void 0:P[0]),class:"mt-1"},null,8,["message"])])]}),_:1},8,["show","title","api-endpoint","http-method","form-data"]))}},es={class:"p-6"},ts={class:"mb-4"},ss={class:"text-sm text-gray-600 mt-1"},os={key:0},ls={class:"space-y-4"},as={key:0,class:"p-3 bg-blue-50 border border-blue-200 rounded-lg"},ns={class:"text-sm text-gray-600"},is={class:"text-blue-900"},rs={class:"mt-6 flex justify-end gap-3"},us={__name:"UpdateMilestoneDueDateModal",props:{show:{type:Boolean,default:!1},milestone:{type:Object,default:null}},emits:["submitted","close"],setup(h,{emit:O}){const l=h,U=O,o=x({newDueDate:"",reason:""}),b=x({}),D=x(!1),C=x("");pe(()=>l.show,$=>{$&&l.milestone&&(C.value=l.milestone.completion_date?new Date(l.milestone.completion_date).toISOString().split("T")[0]:"",o.value={newDueDate:"",reason:""},b.value={})});const B=()=>{if(b.value={},!o.value.newDueDate)return b.value.newDueDate=["New due date is required"],!1;if(!o.value.reason||!o.value.reason.trim())return b.value.reason=["Reason for change is required"],!1;if(o.value.reason.trim().length<10)return b.value.reason=["Reason must be at least 10 characters"],!1;const $=new Date(o.value.newDueDate),y=new Date;return y.setHours(0,0,0,0),$<y?(b.value.newDueDate=["Due date cannot be in the past"],!1):!0},_=async()=>{var $,y,P;if(B()){D.value=!0;try{const T=await window.axios.post(`/api/milestones/${l.milestone.id}/update-due-date`,{completion_date:o.value.newDueDate,reason:o.value.reason});ot("Due date updated successfully!"),U("submitted"),N()}catch(T){(($=T.response)==null?void 0:$.status)===422?b.value=T.response.data.errors||{}:(P=(y=T.response)==null?void 0:y.data)!=null&&P.message?H(T.response.data.message):H("Failed to update due date"),console.error(T)}finally{D.value=!1}}},N=()=>{o.value={newDueDate:"",reason:""},b.value={},U("close")};return($,y)=>(a(),Q(lt,{show:h.show,onClose:N,"max-width":"md"},{default:E(()=>{var P,T;return[e("div",es,[e("div",ts,[y[3]||(y[3]=e("h3",{class:"text-lg font-semibold text-gray-900"},"Update Milestone Due Date",-1)),e("p",ss,[h.milestone?(a(),r("span",os,[y[2]||(y[2]=L("Milestone: ",-1)),e("strong",null,p(h.milestone.name),1)])):A("",!0)])]),e("div",ls,[C.value?(a(),r("div",as,[e("p",ns,[y[4]||(y[4]=L(" Current due date: ",-1)),e("strong",is,p(new Date(C.value).toLocaleDateString()),1)])])):A("",!0),e("div",null,[u(oe,{for:"new-due-date",value:"New Due Date"}),u(ie,{id:"new-due-date",modelValue:o.value.newDueDate,"onUpdate:modelValue":y[0]||(y[0]=g=>o.value.newDueDate=g),type:"date",class:"mt-1 block w-full"},null,8,["modelValue"]),u(le,{message:(P=b.value.newDueDate)==null?void 0:P[0],class:"mt-1"},null,8,["message"])]),e("div",null,[u(oe,{for:"reason",value:"Reason for Change"}),Ae(e("textarea",{id:"reason","onUpdate:modelValue":y[1]||(y[1]=g=>o.value.reason=g),class:"mt-1 block w-full border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm text-sm",rows:"3",placeholder:"Please explain why the due date is being changed..."},null,512),[[st,o.value.reason]]),u(le,{message:(T=b.value.reason)==null?void 0:T[0],class:"mt-1"},null,8,["message"]),y[5]||(y[5]=e("p",{class:"text-xs text-gray-500 mt-1"},"Minimum 10 characters",-1))])]),e("div",rs,[u(Be,{onClick:N,disabled:D.value},{default:E(()=>y[6]||(y[6]=[L(" Cancel ",-1)])),_:1,__:[6]},8,["disabled"]),u(ce,{onClick:_,disabled:D.value},{default:E(()=>[L(p(D.value?"Updating...":"Update Due Date"),1)]),_:1},8,["disabled"])])])]}),_:1},8,["show"]))}},ds={class:"space-y-4"},cs={key:1,id:"final-task-list",class:"space-y-3"},ps={class:"flex items-center justify-between"},ms={class:"flex-1"},vs=["onClick"],gs={key:0,class:"mt-0.5 text-xs text-gray-600 truncate"},fs=["id","value","onBlur","onKeyup"],bs={class:"flex items-center space-x-2 ml-4"},xs=["onClick"],ys=["onClick"],_s={key:0,class:"mt-4"},hs=["onUpdate:modelValue"],ws={class:"flex flex-col sm:flex-row sm:items-center space-y-2 sm:space-y-0 sm:space-x-4 text-xs text-gray-500 mt-2"},ks={class:"flex items-center space-x-2"},Ds=["onClick"],Cs=["onClick"],$s=["value","onChange","min","max"],Ms={class:"flex items-center space-x-2"},js=["onClick"],Ss=["onClick"],As=["onClick"],Bs={class:"flex justify-end space-x-3"},Ns={__name:"BulkTaskModal",props:{show:{type:Boolean,default:!1},contractId:{type:Number,required:!0},completionDate:{type:String,required:!1,default:null}},emits:["close","tasks-submitted"],setup(h,{emit:O}){const l=h,U=O,o=Se([]),b=x(""),D=x({show:!1,text:"",type:"success"}),C=new Date,B=new Date(C);B.setDate(C.getDate()+1);const _=x("");pe(()=>l.show,f=>{f||(o.splice(0,o.length),b.value="",_.value="",D.value={show:!1,text:"",type:"success"})});const N=()=>{_.value&&_.value.trim()!==""&&(o.push({name:_.value,dueDate:"",priority:"Medium",contract_id:l.contractId,description:"",isEditingName:!1,showDescription:!1}),_.value="",D.value.show=!1)},$=f=>{o.splice(f,1)},y=(f,v)=>{o[f].priority=v},P=(f,v)=>{const G=new Date(C.getFullYear(),C.getMonth(),C.getDate()),w=l.completionDate?new Date(l.completionDate):null,R=new Date(v);if(D.value.show=!1,w&&R>w){D.value={show:!0,text:"The selected due date is after the milestone completion date.",type:"error"},o[f].dueDate="";return}if(R<G){D.value={show:!0,text:"The selected due date cannot be in the past.",type:"error"},o[f].dueDate="";return}o[f].dueDate=v},T=f=>{o[f].showDescription=!o[f].showDescription},g=f=>{o[f].isEditingName=!0,jt(()=>{document.getElementById(`task-name-input-${f}`).focus()})},z=(f,v)=>{v.trim()&&(o[f].name=v),o[f].isEditingName=!1},n=f=>({tasks:f}),m=M(()=>o.length===0||o.some(f=>!f.name.trim()||!f.dueDate||!f.priority)),d=f=>{console.log("Submitting tasks to API:",o),D.value={show:!0,text:"Tasks submitted successfully!",type:"success"},setTimeout(()=>{D.value.show=!1,U("tasks-submitted"),f()},1500)},F=M(()=>o),S=f=>{const v=l.completionDate?new Date(l.completionDate):null,G=new Date(C.getFullYear(),C.getMonth(),C.getDate()),w=new Date(f);return w>=G&&(!v||w<=v)};return(f,v)=>(a(),Q(xe,{show:h.show,title:"Create Tasks in Bulk","api-endpoint":"/api/tasks/bulk","http-method":"post","form-data":F.value,"format-data-for-api":n,"submit-button-text":"Create Tasks",onClose:v[1]||(v[1]=G=>f.$emit("close")),onSubmitted:d},{default:E(({errors:G})=>[e("div",ds,[D.value.show?(a(),r("div",{key:0,class:J(["mb-4 p-4 rounded-lg transition-all duration-300 ease-in-out",{"bg-green-100 text-green-700 border border-green-200":D.value.type==="success","bg-red-100 text-red-700 border border-red-200":D.value.type==="error"}])},p(D.value.text),3)):A("",!0),e("form",{onSubmit:X(N,["prevent"]),class:"relative"},[u(ie,{modelValue:_.value,"onUpdate:modelValue":v[0]||(v[0]=w=>_.value=w),id:"task-name-input",placeholder:"e.g., 'Finish project report'",class:"w-full p-4 pr-12 text-lg border border-gray-300 rounded-xl focus:ring-indigo-500 focus:border-indigo-500 shadow-sm transition-all duration-200 ease-in-out"},null,8,["modelValue"]),v[2]||(v[2]=e("button",{type:"submit",class:"absolute right-4 top-1/2 -translate-y-1/2 p-2 text-indigo-600 hover:text-indigo-800"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})])],-1))],32),v[8]||(v[8]=e("hr",{class:"my-6 border-gray-200"},null,-1)),o.length>0?(a(),r("div",cs,[v[7]||(v[7]=e("h2",{class:"text-lg font-semibold text-gray-800"},"Tasks to Create:",-1)),(a(!0),r(se,null,ne(o,(w,R)=>(a(),r("div",{key:R,class:"flex flex-col p-4 bg-gray-50 rounded-xl border border-gray-200 group transition-all duration-200 ease-in-out"},[e("div",ps,[e("div",ms,[w.isEditingName?(a(),r("input",{key:1,id:`task-name-input-${R}`,type:"text",value:w.name,onBlur:I=>z(R,I.target.value),onKeyup:tt(I=>z(R,I.target.value),["enter"]),class:"text-sm font-semibold text-gray-800 w-full rounded-md border-gray-300 focus:ring-indigo-500 focus:border-indigo-500 shadow-sm"},null,40,fs)):(a(),r(se,{key:0},[e("p",{onClick:I=>g(R),class:"text-sm font-semibold text-gray-800 truncate cursor-pointer hover:underline"},p(w.name),9,vs),w.description&&w.description.trim().length?(a(),r("p",gs,p(w.description),1)):A("",!0)],64))]),e("div",bs,[e("button",{type:"button",onClick:I=>T(R),class:J(["p-1 rounded-full transition-all duration-200 ease-in-out",[w.showDescription||w.description&&w.description.trim().length?"text-indigo-600 hover:text-indigo-700":"text-gray-400 hover:text-indigo-500"]]),title:"Add description"},v[3]||(v[3]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",class:"h-5 w-5"},[e("path",{d:"M19.5 14.25h-15m15-5.25h-15M9 19.5H4.5A1.5 1.5 0 013 18V6a1.5 1.5 0 011.5-1.5H15L21 9v9a1.5 1.5 0 01-1.5 1.5H15"})],-1)]),10,xs),e("button",{type:"button",onClick:I=>$(R),class:"remove-final-task p-1 rounded-full text-red-500 opacity-0 group-hover:opacity-100 transition-all duration-200 ease-in-out"},v[4]||(v[4]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z","clip-rule":"evenodd"})],-1)]),8,ys)])]),w.showDescription?(a(),r("div",_s,[Ae(e("textarea",{"onUpdate:modelValue":I=>w.description=I,rows:"2",placeholder:"Add an optional description...",class:"w-full rounded-md border-gray-300 focus:ring-indigo-500 focus:border-indigo-500 shadow-sm text-sm"},null,8,hs),[[st,w.description]])])):A("",!0),e("div",ws,[e("div",ks,[v[5]||(v[5]=e("span",{class:"font-medium"},"Due:",-1)),S(c(C).toISOString().split("T")[0])?(a(),r("button",{key:0,type:"button",onClick:I=>P(R,c(C).toISOString().split("T")[0]),class:J(["px-2 py-0.5 rounded-full text-indigo-600 bg-indigo-100 text-xs hover:bg-indigo-200",{"bg-indigo-300 font-semibold":w.dueDate===c(C).toISOString().split("T")[0]}])},"Today",10,Ds)):A("",!0),S(c(B).toISOString().split("T")[0])?(a(),r("button",{key:1,type:"button",onClick:I=>P(R,c(B).toISOString().split("T")[0]),class:J(["px-2 py-0.5 rounded-full text-indigo-600 bg-indigo-100 text-xs hover:bg-indigo-200",{"bg-indigo-300 font-semibold":w.dueDate===c(B).toISOString().split("T")[0]}])},"Tomorrow",10,Cs)):A("",!0),e("input",{type:"date",value:w.dueDate,onChange:I=>P(R,I.target.value),min:c(C).toISOString().split("T")[0],max:h.completionDate,required:"",class:J([w.dueDate?"border-gray-300":"border-red-300","p-1 rounded-lg border text-xs focus:ring-indigo-500 focus:border-indigo-500 shadow-sm transition-all duration-200 ease-in-out"])},null,42,$s)]),e("div",Ms,[v[6]||(v[6]=e("span",{class:"font-medium"},"Priority:",-1)),e("button",{type:"button",onClick:I=>y(R,"Low"),class:J(["px-2 py-0.5 rounded-full text-gray-500 bg-gray-100 text-xs hover:bg-gray-200",{"bg-gray-200 font-semibold":w.priority==="Low"}])},"Low",10,js),e("button",{type:"button",onClick:I=>y(R,"Medium"),class:J(["px-2 py-0.5 rounded-full text-blue-600 bg-blue-100 text-xs hover:bg-blue-200",{"bg-blue-200 font-semibold":w.priority==="Medium"}])},"Medium",10,Ss),e("button",{type:"button",onClick:I=>y(R,"High"),class:J(["px-2 py-0.5 rounded-full text-red-600 bg-red-100 text-xs hover:bg-red-200",{"bg-red-200 font-semibold":w.priority==="High"}])},"High",10,As)])])]))),128))])):A("",!0)])]),footer:E(({close:G})=>[e("div",Bs,[u(Be,{onClick:G,type:"button"},{default:E(()=>v[9]||(v[9]=[L(" Cancel ",-1)])),_:2,__:[9]},1032,["onClick"]),u(ce,{type:"submit",disabled:m.value,class:J({"opacity-50 cursor-not-allowed":m.value})},{default:E(()=>v[10]||(v[10]=[L(" Create Tasks ",-1)])),_:1,__:[10]},8,["disabled","class"])])]),_:1},8,["show","form-data"]))}},Ps={class:"space-y-3"},Ts={__name:"MilestoneCompletionDateModal",props:{show:{type:Boolean,default:!1},milestoneId:{type:[Number,String],required:!0},initialCompletionDate:{type:String,default:null}},emits:["close","updated"],setup(h,{emit:O}){const l=h,U=O,o=Se({completion_date:l.initialCompletionDate||null}),b=Se({completion_date:null});pe(()=>l.show,N=>{N&&(o.completion_date=l.initialCompletionDate||null,b.completion_date=null)});const D=M(()=>`/api/milestones/${l.milestoneId}`),C=()=>(b.completion_date=null,o.completion_date?!0:(b.completion_date=["Completion date is required."],!1)),B=N=>{U("updated",N),U("close")},_=()=>U("close");return(N,$)=>(a(),Q(xe,{show:h.show,title:"Set Milestone Completion Date","api-endpoint":D.value,"http-method":"put","form-data":o,"submit-button-text":"Save Date","success-message":"Milestone updated","before-submit":C,onClose:_,onSubmitted:B},{default:E(({errors:y})=>{var P,T;return[e("div",Ps,[$[1]||($[1]=e("p",{class:"text-sm text-gray-600"}," This milestone does not have a completion date. Please set it to continue creating tasks for its contracts. ",-1)),e("div",null,[u(oe,{for:"milestone-completion-date",value:"Completion Date"}),u(ie,{id:"milestone-completion-date",modelValue:o.completion_date,"onUpdate:modelValue":$[0]||($[0]=g=>o.completion_date=g),type:"date",class:"mt-1 block w-full",required:""},null,8,["modelValue"]),u(le,{message:((P=y.completion_date)==null?void 0:P[0])||((T=b.completion_date)==null?void 0:T[0]),class:"mt-1"},null,8,["message"])])])]}),_:1},8,["show","api-endpoint","form-data"]))}},Us={class:"mt-8 p-6 md:p-8 bg-white rounded-2xl shadow-xl space-y-8 font-sans"},Vs={class:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 border-b pb-4"},Rs={class:"flex-1"},Ls={class:"text-xl font-bold text-gray-900"},Fs={class:"text-sm text-gray-500 mt-1"},Is={key:0},Es={class:"flex items-center gap-4 flex-shrink-0"},Os={class:"relative w-28 h-28"},qs={class:"w-full h-full transform -rotate-90"},Ks=["stroke-dashoffset"],Hs=["stroke-dashoffset"],Ys={class:"absolute inset-0 flex items-center justify-center"},zs={class:"text-2xl font-bold text-gray-900"},Gs={class:"space-y-8 px-4"},Xs={class:"relative w-full h-2 rounded-full bg-gray-200"},Js={class:"absolute -top-6 left-1/2 -translate-x-1/2 text-xs font-medium text-indigo-700 w-max"},Qs={class:"relative w-full h-4 mt-4 -top-8"},Ws={class:"w-2 h-2 rounded-full bg-gray-400 shadow-sm z-10 group relative"},Zs={key:0,class:"absolute -top-1 -right-1 w-3 h-3 text-xs bg-gray-500 text-white rounded-full flex items-center justify-center font-bold"},eo={class:"absolute top-full mt-2 w-max p-2 text-xs text-center text-white bg-gray-800 rounded-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none z-20"},to={class:"font-bold border-b pb-1 mb-1"},so={class:"absolute top-full mt-2 w-max min-w-[70px]"},oo={class:"text-gray-500 text-xs truncate"},lo={__name:"ProjectProgressTimeline",props:{milestones:{type:Array,default:()=>[]},showTicks:{type:Boolean,default:!0},title:{type:String,default:"Project Progress & Timeline"},progressLabel:{type:String,default:"Project Progress"},timelineLabel:{type:String,default:"Timeline"}},setup(h){const O=h,l=M(()=>(O.milestones||[]).filter(n=>!!(n!=null&&n.completion_date))),U=M(()=>[...l.value].sort((n,m)=>{const d=new Date(n.completion_date),F=new Date(m.completion_date);return d-F})),o=M(()=>(O.milestones||[]).length),b=M(()=>(O.milestones||[]).filter(n=>((n==null?void 0:n.status)||"").toLowerCase()==="completed")),D=M(()=>(O.milestones||[]).filter(n=>((n==null?void 0:n.status)||"").toLowerCase()==="approved")),C=M(()=>b.value.length+D.value.length);M(()=>o.value?Math.round(b.value.length/o.value*100):0);const B=M(()=>o.value?Math.round(D.value.length/o.value*100):0),_=M(()=>o.value?Math.round(C.value/o.value*100):0),N=M(()=>U.value.length?new Date(U.value[0].completion_date):null),$=M(()=>U.value.length?new Date(U.value[U.value.length-1].completion_date):null),y=M(()=>{if(!N.value||!$.value)return 0;const n=v=>new Date(v.getFullYear(),v.getMonth(),v.getDate(),12,0,0),m=n(N.value),d=n($.value),F=n(new Date),S=d-m;if(S<=0)return 100;let f=(F-m)/S*100;return f<0&&(f=0),f>100&&(f=100),Math.round(f)}),P=n=>{const m=new Date,F=new Date(n)-m,S=Math.ceil(F/(1e3*60*60*24));return S===0?"Due Today":S>0?`${S} day${S===1?"":"s"} left`:`${Math.abs(S)} day${Math.abs(S)===1?"":"s"} overdue`},T=n=>{if(!N.value||!$.value)return 0;const m=new Date(N.value),d=new Date($.value),F=new Date(n),S=d-m;return S<=0?100:(F-m)/S*100},g=M(()=>{const n={};return U.value.forEach(m=>{const d=new Date(m.completion_date).toLocaleDateString();n[d]||(n[d]={date:m.completion_date,milestones:[]}),n[d].milestones.push(m)}),Object.values(n)}),z=n=>{const m=Math.max(2,Math.min(98,n)),d=n<5?"0%":n>95?"-100%":"-50%";return{left:`${m}%`,transform:`translateX(${d})`}};return(n,m)=>(a(),r("div",Us,[e("header",Vs,[e("div",Rs,[e("h2",Ls,p(h.title),1),e("p",Fs,[L(p(C.value)+" of "+p(o.value)+" milestones completed. ",1),N.value&&$.value?(a(),r("span",Is," Project timeline: "+p(new Date(N.value).toLocaleDateString())+" — "+p(new Date($.value).toLocaleDateString())+". ",1)):A("",!0)])]),e("div",Es,[e("div",Os,[(a(),r("svg",qs,[m[0]||(m[0]=e("circle",{class:"text-gray-200","stroke-width":"8",stroke:"currentColor",fill:"transparent",r:"44",cx:"56",cy:"56"},null,-1)),e("circle",{class:"text-indigo-500","stroke-width":"8","stroke-dasharray":276.46,"stroke-dashoffset":276.46-276.46*_.value/100,"stroke-linecap":"round",stroke:"currentColor",fill:"transparent",r:"44",cx:"56",cy:"56",style:{transition:"stroke-dashoffset 0.5s ease-in-out"}},null,8,Ks),m[1]||(m[1]=e("circle",{class:"text-gray-300","stroke-width":"8",stroke:"currentColor",fill:"transparent",r:"32",cx:"56",cy:"56"},null,-1)),e("circle",{class:"text-green-500","stroke-width":"8","stroke-dasharray":201.06,"stroke-dashoffset":201.06-201.06*B.value/100,"stroke-linecap":"round",stroke:"currentColor",fill:"transparent",r:"32",cx:"56",cy:"56",style:{transition:"stroke-dashoffset 0.5s ease-in-out"}},null,8,Hs)])),e("div",Ys,[e("span",zs,p(_.value)+"%",1)])])])]),e("div",Gs,[e("div",Xs,[e("div",{class:"h-full bg-indigo-500 rounded-full",style:$e({width:y.value+"%"})},null,4),N.value&&$.value?(a(),r("div",{key:0,class:"absolute top-1/2 -translate-y-1/2",style:$e({left:`calc(${y.value}% - 8px)`})},[e("div",Js," Today: "+p(new Date().toLocaleDateString()),1),m[2]||(m[2]=e("div",{class:"w-4 h-4 rounded-full bg-indigo-700 border-2 border-white shadow-md transform scale-125 transition-transform duration-200",title:"Today"},null,-1))],4)):A("",!0)]),e("div",Qs,[(a(!0),r(se,null,ne(g.value,(d,F)=>(a(),r("div",{key:F,class:"absolute top-0 flex flex-col items-center text-center",style:$e(z(T(d.date)))},[e("div",Ws,[d.milestones.length>1?(a(),r("div",Zs,p(d.milestones.length),1)):A("",!0),e("div",eo,[e("p",to,p(new Date(d.date).toLocaleDateString()),1),(a(!0),r(se,null,ne(d.milestones,S=>(a(),r("p",{key:S.id,class:"text-left text-gray-300"}," - "+p(S.name),1))),128))])]),e("div",so,[e("p",oo,p(new Date(d.date).toLocaleDateString()),1),e("p",{class:J(["text-xs font-medium truncate",{"text-red-500":P(d.date).includes("overdue"),"text-gray-600":!P(d.date).includes("overdue")}])},p(P(d.date)),3)])],4))),128))])])]))}},ao={class:"flex flex-col md:flex-row items-start md:items-center justify-between gap-4"},no={class:"flex items-center gap-3 w-full md:w-auto"},io={class:"flex-grow md:flex-grow-0 w-full md:w-64"},ro={class:"w-24 md:w-32 flex-shrink-0"},uo={class:"py-8"},co={class:"max-w-7xl mx-auto sm:px-6 lg:px-8 space-y-6"},po={key:0},mo={class:"bg-white rounded-xl p-6 shadow-sm"},vo={class:"grid grid-cols-1 md:grid-cols-3 gap-6"},go={class:"bg-indigo-50 rounded-lg p-5 shadow-sm flex flex-col justify-between"},fo={class:"text-3xl font-bold text-indigo-900"},bo={class:"bg-purple-50 rounded-lg p-5 shadow-sm flex flex-col justify-between"},xo={class:"text-3xl font-bold text-purple-900"},yo={class:"bg-green-50 rounded-lg p-5 shadow-sm flex flex-col justify-between"},_o={class:"text-3xl font-bold text-green-900"},ho={class:"bg-yellow-50 rounded-lg p-5 shadow-sm flex flex-col justify-between"},wo={class:"text-3xl font-bold text-yellow-900"},ko={class:"bg-blue-50 rounded-lg p-5 shadow-sm flex flex-col justify-between"},Do={class:"text-3xl font-bold text-blue-900"},Co={class:"bg-teal-50 rounded-lg p-5 shadow-sm flex flex-col justify-between"},$o={class:"text-3xl font-bold text-teal-900"},Mo={class:"bg-white rounded-xl shadow-sm p-6"},jo={class:"flex flex-col sm:flex-row items-start sm:items-center justify-between border-b pb-4 mb-4"},So={class:"flex items-center gap-2"},Ao={class:"flex space-x-2 mt-2 sm:mt-0"},Bo=["onClick"],No={key:0,class:"text-center text-gray-500 py-12"},Po={key:1},To={key:0,class:"text-center text-gray-500 py-12"},Uo={key:1,class:"text-center text-gray-500 py-12"},Vo={key:2,class:"space-y-4"},Ro=["onClick"],Lo={class:"flex-grow"},Fo={class:"font-bold text-lg text-gray-900 mb-1"},Io={key:0,class:"text-sm text-gray-600"},Eo={class:"mt-1 text-xs text-gray-500 flex items-center gap-2"},Oo={key:0},qo=["onClick"],Ko={key:1,class:"font-medium text-gray-700"},Ho={key:1},Yo={class:"flex items-center gap-4 text-sm text-gray-700"},zo={class:"hidden sm:flex items-center gap-4"},Go={class:"inline-flex items-center gap-1 text-gray-600"},Xo={class:"font-semibold text-gray-800"},Jo={class:"inline-flex items-center gap-1 text-gray-600"},Qo={class:"font-semibold text-green-700"},Wo={class:"inline-flex items-center gap-1 text-gray-600"},Zo={class:"font-semibold text-blue-700"},el=["onClick"],tl={class:"flex items-center gap-2"},sl=["onClick"],ol=["onClick"],ll={class:"border-t border-gray-200 p-5 bg-white rounded-b-xl"},al={class:"mb-5"},nl={class:"flex flex-wrap gap-2 text-xs"},il={class:"inline-flex items-center gap-1 px-2 py-1 rounded-full bg-gray-100 text-gray-700"},rl={class:"font-semibold"},ul={class:"inline-flex items-center gap-1 px-2 py-1 rounded-full bg-slate-100 text-slate-700"},dl={class:"font-semibold"},cl={class:"inline-flex items-center gap-1 px-2 py-1 rounded-full bg-blue-100 text-blue-700"},pl={class:"font-semibold"},ml={class:"inline-flex items-center gap-1 px-2 py-1 rounded-full bg-yellow-100 text-yellow-700"},vl={class:"font-semibold"},gl={class:"inline-flex items-center gap-1 px-2 py-1 rounded-full bg-orange-100 text-orange-700"},fl={class:"font-semibold"},bl={class:"inline-flex items-center gap-1 px-2 py-1 rounded-full bg-green-100 text-green-700"},xl={class:"font-semibold"},yl={class:"inline-flex items-center gap-1 px-2 py-1 rounded-full bg-red-100 text-red-700"},_l={class:"font-semibold"},hl={class:"flex justify-between items-center mb-4"},wl={class:"flex items-center gap-2"},kl={key:0,class:"text-center text-gray-500 text-sm py-4"},Dl={key:1,class:"space-y-2"},Cl={class:"flex items-center gap-2"},$l={key:0,class:"text-gray-600 text-xs sm:text-sm"},Ml={class:"font-medium"},jl={class:"flex items-center gap-4 mt-2 sm:mt-0"},Sl={class:"text-right"},Al={class:"font-semibold"},Bl={key:0,class:"text-gray-500 block text-xs"},Nl={class:"flex gap-1.5"},Pl=["onClick"],Tl=["onClick"],Ul=["onClick"],Vl=["onClick"],Rl={class:"mt-6 pt-4 border-t border-gray-200 flex flex-col items-start gap-2"},Ll={class:"flex flex-wrap items-center gap-3"},Fl={key:0,class:"text-sm text-red-600"},Il={class:"p-6 bg-white rounded-lg shadow-xl"},El={class:"flex items-center justify-between mb-4"},Ol={key:0,class:"text-gray-500 text-center py-4"},ql={key:1},Kl={key:0,class:"text-gray-500 text-center py-4"},Hl={key:1,class:"space-y-3 max-h-96 overflow-y-auto pr-2"},Yl={class:"text-sm text-gray-600 flex justify-between items-center mb-1"},zl={class:"font-medium"},Gl={class:"text-xs text-gray-400"},Xl={class:"mt-1 text-gray-800 text-sm whitespace-pre-line"},Ma={__name:"Index",setup(h){const O=x([]),l=x(null),U=x(!1),o=x("active"),b=x([]),D=x(!1),C=x(!1),B=x(!1),_=x(!1),N=x(!1),$=x([]),y=x(!1),P=x(!1),T=x(null),g=x(null),z=x(!1),n=x(null),m=x(null),d=x(null),F=x(!1),S=x(null),f=[{value:"PKR",label:"PKR"},{value:"AUD",label:"AUD"},{value:"INR",label:"INR"},{value:"USD",label:"USD"},{value:"EUR",label:"EUR"},{value:"GBP",label:"GBP"}],{canDo:v}=St();v("manage_project_financial");const G=v("approve_milestone_expendables"),w=v("approve_expendables"),R=v("approve_milestones");v("view_monthly_budgets");const I=v("update_milestone_due_date"),V=Rt,ae=x(null),q=x("PKR"),K=x({total_budget:0,total_assigned_milestone_amount:0,total_pending_contract_amount:0,total_approved_contract_amount:0,total_expendable_amount:0,available_for_new_milestones:0,currency:"AUD"}),re=x([]),at=[{id:"active",label:"Active Milestones"},{id:"completed",label:"Completed"},{id:"approved",label:"Approved"}],nt=M(()=>(b.value||[]).filter(s=>!!s.completion_date)),me=M(()=>[...nt.value].sort((s,t)=>{const j=new Date(s.completion_date),Y=new Date(t.completion_date);return j-Y})),Ne=M(()=>(b.value||[]).length),it=M(()=>(b.value||[]).filter(s=>{const t=(s.status||"").toLowerCase();return t==="completed"||t==="approved"}).length);M(()=>Ne.value?Math.round(it.value/Ne.value*100):0);const Pe=M(()=>me.value.length?new Date(me.value[0].completion_date):null),Te=M(()=>me.value.length?new Date(me.value[me.value.length-1].completion_date):null);M(()=>{if(!Pe.value||!Te.value)return 0;const s=de=>new Date(de.getFullYear(),de.getMonth(),de.getDate(),12,0,0),t=s(Pe.value),j=s(Te.value),Y=s(new Date),Z=j-t;if(Z<=0)return 100;let ee=(Y-t)/Z*100;return ee<0&&(ee=0),ee>100&&(ee=100),Math.round(ee)});const Ue=M(()=>b.value?o.value==="active"?b.value.filter(s=>s.status.toLowerCase()==="in progress"||s.status.toLowerCase()==="not started"||s.status.toLowerCase()==="pending"):o.value==="completed"?b.value.filter(s=>s.status.toLowerCase()==="completed"):o.value==="approved"?b.value.filter(s=>s.status.toLowerCase()==="approved"):b.value:[]),rt=M(()=>{const s=Number(K.value.total_approved_contract_amount||0);return W(s,K.value.currency||q.value||"AUD",V.value)}),ut=M(()=>{const s=Number(K.value.total_pending_contract_amount||0);return W(s,K.value.currency||q.value||"AUD",V.value)});M(()=>{const s=Number(K.value.available_for_new_milestones??K.value.total_expendable_amount??0),t=W(s,K.value.currency||q.value||"AUD",V.value);return te(t,V.value)});const ge=s=>{const t=Number(s||0),j=W(t,K.value.currency||q.value||"AUD",V.value);return te(j,V.value)};M(()=>{var t;return((Array.isArray((t=re.value)==null?void 0:t.users)?re.value.users:re.value)||[]).map(j=>({value:j.id,label:j.name}))});const ve=s=>{if(!s)return{};const t=s.budget?W(Number(s.budget.amount||0),s.budget.currency,V.value):0,j=(s.expendable||[]).filter(Y=>Y.status==="Accepted").reduce((Y,Z)=>Y+W(Number(Z.amount||0),Z.currency,V.value),0);return{budgetAmt:t,approvedAmt:j,remaining:t-j}},Ve=s=>s?s.budget!==null:null,dt=(s,t)=>{if(!(!s||!t)){if(!s.completion_date){n.value=s,m.value=t.id,z.value=!0;return}g.value=s,T.value=t.id,P.value=!0}},ct=s=>{try{if(s&&s.id){const j=(b.value||[]).findIndex(Y=>Y.id===s.id);j!==-1&&(b.value[j]={...b.value[j],...s})}}catch(j){console.error("Failed to merge updated milestone",j)}const t=(b.value||[]).find(j=>{var Y;return j.id===((s==null?void 0:s.id)||((Y=n.value)==null?void 0:Y.id))});g.value=t||s||n.value,T.value=m.value,z.value=!1,P.value=!0,n.value=null,m.value=null},pt=async()=>{try{const{data:s}=await window.axios.get("/api/projects-simplified");O.value=(s||[]).map(t=>({value:t.id,label:t.name}))}catch(s){console.error(s),H("Failed to load projects")}},ue=async()=>{if(l.value){U.value=!0;try{const{data:s}=await window.axios.get(`/api/projects/${l.value}/milestones-with-expendables`);b.value=(s||[]).map(t=>({...t,_collapsed:!0}))}catch(s){console.error(s),H("Failed to load milestones")}finally{U.value=!1}}},mt=async s=>{if(!s||!s.id){H("Invalid milestone selected.");return}g.value=s,N.value=!0,_.value=!0;try{const{data:t}=await window.axios.get(`/api/milestones/${s.id}/reasons`);$.value=Array.isArray(t)?t:[]}catch(t){console.error(t),H("Failed to load reasons")}finally{N.value=!1}},vt=async()=>{if(l.value)try{const{data:s}=await window.axios.get(`/api/projects/${l.value}/sections/users?type=users`);re.value=s||[]}catch(s){console.error(s),H("Failed to load users")}},ye=async()=>{if(l.value)try{const{data:s}=await window.axios.get(`/api/projects/${l.value}/expendable-budget`);K.value={total_budget:Number(s.total_budget||0),total_assigned_milestone_amount:Number(s.total_assigned_milestone_amount||0),total_pending_contract_amount:Number(s.total_pending_contract_amount||0),total_approved_contract_amount:Number(s.total_approved_contract_amount||0),total_expendable_amount:Number(s.total_expendable_amount||0),available_for_new_milestones:Number(s.available_for_new_milestones||0),currency:s.currency||"AUD"},ae.value=Number(s.total_expendable_amount||0),q.value=s.currency||"AUD"}catch(s){console.error(s)}},_e=async()=>{if(!l.value){b.value=[],ae.value=0,q.value="PKR",K.value={total_budget:0,total_assigned_milestone_amount:0,total_pending_contract_amount:0,total_approved_contract_amount:0,total_expendable_amount:0,available_for_new_milestones:0,currency:"AUD"};return}await Promise.all([ue(),vt(),ye()])},he=async()=>{ot("Operation successful!"),B.value=!1,g.value=null,d.value=null,l.value?await Promise.all([ue(),ye()]):await ue()},gt=s=>{if(!s||!s.id){H("Invalid milestone selected.");return}g.value=s,D.value=!0},ft=s=>{if(!s||!s.id){H("Invalid milestone selected.");return}g.value=s,C.value=!0},bt=()=>{B.value=!1,g.value=null,d.value=null},xt=s=>{if(!s||!s.id){H("Invalid milestone selected.");return}S.value=s,F.value=!0},yt=async()=>{F.value=!1,S.value=null,l.value&&await ue()},_t=async s=>{if(!s||!s.id){H("Invalid milestone.");return}await fe("Mark this milestone as complete?")&&(g.value={...s,action:"complete",apiEndpoint:`/api/milestones/${s.id}/complete`,httpMethod:"post"},B.value=!0)},ht=async s=>{if(!s||!s.id){H("Invalid milestone.");return}await fe("Approve this completed milestone?")&&(g.value={...s,action:"approve",apiEndpoint:`/api/milestones/${s.id}/approve`,httpMethod:"post"},B.value=!0)},wt=async s=>{if(!s||!s.id){H("Invalid milestone.");return}await fe("Reject this completed milestone?")&&(g.value={...s,action:"reject",apiEndpoint:`/api/milestones/${s.id}/reject`,httpMethod:"post"},B.value=!0)},kt=async s=>{if(!s||!s.id){H("Invalid contract.");return}d.value={...s,action:"accept",apiEndpoint:`/api/projects/${l.value}/expendables/${s.id}/accept`,httpMethod:"post"},B.value=!0},Dt=async s=>{if(!s||!s.id){H("Invalid contract.");return}d.value={...s,action:"reject",apiEndpoint:`/api/projects/${l.value}/expendables/${s.id}/reject`,httpMethod:"post"},B.value=!0},Ct=async s=>{if(!s||!s.id){H("Invalid contract.");return}d.value={...s,action:"delete",apiEndpoint:`/api/projects/${l.value}/expendables/${s.id}`,httpMethod:"delete"},B.value=!0},$t=async s=>{if(!s||!s.id){H("Invalid milestone.");return}await fe("Reopen this milestone to move it back to active?")&&(g.value={...s,action:"reopen",apiEndpoint:`/api/milestones/${s.id}/reopen`,httpMethod:"post"},B.value=!0)},Re=s=>{s._collapsed=!s._collapsed},we=s=>!s||!Array.isArray(s.expendable)?!1:s.expendable.some(t=>((t==null?void 0:t.status)||"Pending Approval")==="Pending Approval"),ke=s=>!!(s&&Array.isArray(s.expendable)&&s.expendable.length>0),De=s=>{try{if(!s)return null;const t=new Date(s),j=new Date,Y=new Date(t.getFullYear(),t.getMonth(),t.getDate(),12,0,0),Z=new Date(j.getFullYear(),j.getMonth(),j.getDate(),12,0,0),ee=1440*60*1e3;return Math.round((Y-Z)/ee)}catch{return null}},Mt=s=>{const t=De(s);return t===null?"":t<0?`Overdue by ${Math.abs(t)} day${Math.abs(t)===1?"":"s"}`:t===0?"Due today":`${t} day${t===1?"":"s"} remaining`};return At(async()=>{const s=localStorage.getItem("displayCurrency");s&&(V.value=s),await Lt(),await pt(),l.value&&await _e()}),pe(V,async s=>{s&&(localStorage.setItem("displayCurrency",s),l.value&&await Promise.all([ye(),ue()]))}),(s,t)=>(a(),Q(Vt,null,{header:E(()=>[e("div",ao,[t[14]||(t[14]=e("h2",{class:"font-semibold text-2xl text-gray-800"},"Project Financials",-1)),e("div",no,[e("button",{onClick:_e,class:"p-2 rounded-full text-gray-500 hover:bg-gray-100 transition-colors",title:"Refresh"},[u(c(je),{class:"h-5 w-5"})]),e("div",io,[u(be,{id:"project-select",modelValue:l.value,"onUpdate:modelValue":[t[0]||(t[0]=j=>l.value=j),_e],options:O.value,placeholder:"Select a project"},null,8,["modelValue","options"])]),e("div",ro,[u(be,{id:"expendables-display-currency",modelValue:c(V),"onUpdate:modelValue":t[1]||(t[1]=j=>Pt(V)?V.value=j:null),options:f,placeholder:"Currency"},null,8,["modelValue"])]),u(c(Tt),{href:s.route("admin.pm-payout-calculator.index"),class:"inline-flex items-center px-3 py-1 border border-transparent text-xs leading-4 font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:border-indigo-700 focus:ring active:bg-indigo-700 transition ease-in-out duration-150"},{default:E(()=>t[13]||(t[13]=[L(" Payout Calculator ",-1)])),_:1,__:[13]},8,["href"])])])]),default:E(()=>{var j,Y,Z,ee,de,Le,Fe,Ie,Ee,Oe,qe,Ke,He,Ye,ze,Ge,Xe,Je;return[u(c(Bt),{title:"Project Financials Dashboard"}),e("div",uo,[e("div",co,[l.value?(a(),r("section",po,[e("div",mo,[t[27]||(t[27]=e("h3",{class:"text-xl font-semibold text-gray-900 mb-4"},"Financial Summary",-1)),e("div",vo,[e("div",go,[e("div",null,[t[15]||(t[15]=e("div",{class:"text-sm font-medium text-indigo-700 mb-1"},"Total Project Budget",-1)),e("div",fo,p(ge(K.value.total_budget)),1)]),t[16]||(t[16]=e("p",{class:"text-xs text-indigo-600 mt-2"},"Overall budget allocated to the project.",-1))]),e("div",bo,[e("div",null,[t[17]||(t[17]=e("div",{class:"text-sm font-medium text-purple-700 mb-1"},"Assigned to Milestones",-1)),e("div",xo,p(ge(K.value.total_assigned_milestone_amount)),1)]),t[18]||(t[18]=e("p",{class:"text-xs text-purple-600 mt-2"},"Amount already assigned to milestones.",-1))]),e("div",yo,[e("div",null,[t[19]||(t[19]=e("div",{class:"text-sm font-medium text-green-700 mb-1"},"Approved Contracts",-1)),e("div",_o,p(c(te)(rt.value,c(V))),1)]),t[20]||(t[20]=e("p",{class:"text-xs text-green-600 mt-2"},"Total value of all accepted contracts.",-1))]),e("div",ho,[e("div",null,[t[21]||(t[21]=e("div",{class:"text-sm font-medium text-yellow-700 mb-1"},"Pending Approval",-1)),e("div",wo,p(c(te)(ut.value,c(V))),1)]),t[22]||(t[22]=e("p",{class:"text-xs text-yellow-600 mt-2"},"Contracts awaiting review and approval.",-1))]),e("div",ko,[e("div",null,[t[23]||(t[23]=e("div",{class:"text-sm font-medium text-blue-700 mb-1"},"Expendable Remaining",-1)),e("div",Do,p(ge(K.value.total_expendable_amount)),1)]),t[24]||(t[24]=e("p",{class:"text-xs text-blue-600 mt-2"},"Remaining after approved contracts.",-1))]),e("div",Co,[e("div",null,[t[25]||(t[25]=e("div",{class:"text-sm font-medium text-teal-700 mb-1"},"Available for New Milestones",-1)),e("div",$o,p(ge(K.value.available_for_new_milestones)),1)]),t[26]||(t[26]=e("p",{class:"text-xs text-teal-600 mt-2"},"Budget still available to allocate to new milestones.",-1))])]),u(lo,{milestones:b.value},null,8,["milestones"])])])):A("",!0),e("section",Mo,[e("div",jo,[e("div",So,[t[28]||(t[28]=e("h3",{class:"text-xl font-semibold text-gray-900"},"Project Milestones",-1)),l.value?(a(),r("button",{key:0,onClick:t[2]||(t[2]=i=>y.value=!0),class:"p-1.5 rounded-full text-white bg-indigo-600 hover:bg-indigo-700 disabled:opacity-50",title:"Add Milestone"},[u(c(Me),{class:"h-4 w-4"})])):A("",!0)]),e("div",Ao,[(a(),r(se,null,ne(at,i=>e("button",{key:i.id,onClick:k=>o.value=i.id,class:J(["py-2 px-4 rounded-full text-sm font-medium transition",o.value===i.id?"bg-indigo-600 text-white shadow":"bg-gray-100 text-gray-700 hover:bg-gray-200"])},p(i.label),11,Bo)),64))])]),l.value?(a(),r("div",Po,[U.value?(a(),r("div",To,[u(c(je),{class:"animate-spin h-8 w-8 mx-auto mb-2 text-indigo-500"}),t[30]||(t[30]=e("p",null,"Loading milestones...",-1))])):Ue.value.length?(a(),r("div",Vo,[(a(!0),r(se,null,ne(Ue.value,i=>(a(),r("div",{key:i.id,class:"border border-gray-200 rounded-xl bg-gray-50 shadow-sm transition-all duration-300 hover:shadow-lg"},[e("div",{class:"p-5 flex items-center justify-between cursor-pointer",onClick:k=>Re(i)},[e("div",Lo,[e("div",Fo,p(i.name),1),i.description?(a(),r("div",Io,p(i.description),1)):A("",!0),e("div",Eo,[i.completion_date?(a(),r("span",Oo,[t[32]||(t[32]=L(" Due by: ",-1)),c(I)&&o.value==="active"?(a(),r("span",{key:0,onClick:X(k=>xt(i),["stop"]),class:"font-medium text-gray-700 cursor-pointer hover:text-indigo-600 hover:underline transition-colors",title:"Click to update due date"},p(new Date(i.completion_date).toLocaleDateString()),9,qo)):(a(),r("span",Ko,p(new Date(i.completion_date).toLocaleDateString()),1))])):(a(),r("span",Ho,"No completion date")),i.completion_date?(a(),r("span",{key:2,class:J([De(i.completion_date)<0?"text-red-600":De(i.completion_date)===0?"text-orange-600":"text-green-600"])}," • "+p(Mt(i.completion_date)),3)):A("",!0)])]),e("div",Yo,[e("div",zo,[e("span",Go,[u(c(Yt),{class:"h-4 w-4 text-gray-500"}),t[33]||(t[33]=L(" Budget: ",-1)),e("span",Xo,p(c(te)(ve(i).budgetAmt,c(V))),1)]),e("span",Jo,[u(c(Ze),{class:"h-4 w-4 text-green-600"}),t[34]||(t[34]=L(" Approved: ",-1)),e("span",Qo,p(c(te)(ve(i).approvedAmt,c(V))),1)]),e("span",Wo,[u(c(je),{class:"h-4 w-4 text-blue-600"}),t[35]||(t[35]=L(" Remaining: ",-1)),e("span",Zo,p(c(te)(ve(i).remaining,c(V))),1)])]),o.value==="active"?(a(),r("button",{key:0,onClick:X(k=>ft(i),["stop"]),class:"p-2 rounded-full text-gray-500 hover:text-blue-500 hover:bg-gray-100 transition-colors"},[Ve(i)?(a(),Q(c(Et),{key:0,class:"h-5 w-5"})):(a(),Q(c(It),{key:1,class:"h-5 w-5"}))],8,el)):A("",!0),e("div",tl,[e("button",{onClick:X(k=>mt(i),["stop"]),class:"p-2 rounded-full text-blue-600 hover:bg-blue-100 transition-colors",title:"View reasons"},[u(c(Ot),{class:"h-5 w-5"})],8,sl),e("button",{onClick:X(k=>Re(i),["stop"]),class:"p-2 transition-transform duration-300"},[u(c(qt),{class:J(["h-6 w-6 text-gray-500",i._collapsed?"":"rotate-180"])},null,8,["class"])],8,ol)])])],8,Ro),Ae(e("div",ll,[e("div",al,[t[43]||(t[43]=e("h5",{class:"text-sm font-semibold text-gray-800 mb-2"},"Task Stats",-1)),e("div",nl,[e("span",il,[t[36]||(t[36]=L(" Total ",-1)),e("span",rl,p(i.tasks_total_count||0),1)]),e("span",ul,[t[37]||(t[37]=L(" To Do ",-1)),e("span",dl,p(i.tasks_todo_count||0),1)]),e("span",cl,[t[38]||(t[38]=L(" In Progress ",-1)),e("span",pl,p(i.tasks_in_progress_count||0),1)]),e("span",ml,[t[39]||(t[39]=L(" Paused ",-1)),e("span",vl,p(i.tasks_paused_count||0),1)]),e("span",gl,[t[40]||(t[40]=L(" Blocked ",-1)),e("span",fl,p(i.tasks_blocked_count||0),1)]),e("span",bl,[t[41]||(t[41]=L(" Done ",-1)),e("span",xl,p(i.tasks_done_count||0),1)]),e("span",yl,[t[42]||(t[42]=L(" Archived ",-1)),e("span",_l,p(i.tasks_archived_count||0),1)])])]),e("div",hl,[t[45]||(t[45]=e("h4",{class:"text-lg font-semibold text-gray-800"},"Contracts",-1)),e("div",wl,[o.value==="active"?(a(),Q(ce,{key:0,onClick:X(k=>gt(i),["stop"]),class:"flex items-center gap-1"},{default:E(()=>[u(c(Me),{class:"h-4 w-4"}),t[44]||(t[44]=L(" Add Contract ",-1))]),_:2,__:[44]},1032,["onClick"])):A("",!0)])]),!i.expendable||!i.expendable.length?(a(),r("div",kl,"No contracts found.")):(a(),r("ul",Dl,[(a(!0),r(se,null,ne(i.expendable||[],k=>{var Qe,We;return a(),r("li",{key:k.id,class:"flex flex-col sm:flex-row items-start sm:items-center justify-between text-sm gap-2 p-3 rounded-lg bg-gray-100 shadow-sm"},[e("div",Cl,[e("span",{class:J(["inline-block text-xs px-2 py-0.5 rounded-full font-medium",{"bg-gray-200 text-gray-700":k.status==="Pending Approval","bg-green-200 text-green-700":k.status==="Accepted","bg-red-200 text-red-700":k.status==="Rejected"}])},p(k.status||"Pending Approval"),3),k.user&&k.user.name?(a(),r("span",$l,p(k.user.name),1)):A("",!0),e("span",Ml,p(k.name),1)]),e("div",jl,[e("div",Sl,[e("span",Al,p(c(te)(c(W)(parseFloat(k.amount??0),k.currency||c(V),c(V)),c(V))),1),k.currency&&((Qe=k.currency)==null?void 0:Qe.toUpperCase())!==((We=c(V))==null?void 0:We.toUpperCase())?(a(),r("span",Bl," ("+p(c(te)(parseFloat(k.amount??0),k.currency))+") ",1)):A("",!0)]),e("div",Nl,[k.status==="Accepted"?(a(),r("button",{key:0,onClick:X(Ce=>dt(i,k),["stop"]),class:"p-1 rounded-full text-indigo-600 hover:bg-indigo-200 transition-colors",title:"Add tasks"},[u(c(Me),{class:"h-5 w-5"})],8,Pl)):A("",!0),k.status==="Pending Approval"&&o.value!=="approved"?(a(),r(se,{key:1},[c(G)||c(w)?(a(),r("button",{key:0,onClick:X(Ce=>kt(k),["stop"]),class:"p-1 rounded-full text-green-600 hover:bg-green-200 transition-colors",title:"Approve"},[u(c(Ze),{class:"h-5 w-5"})],8,Tl)):A("",!0),c(G)||c(w)?(a(),r("button",{key:1,onClick:X(Ce=>Dt(k),["stop"]),class:"p-1 rounded-full text-red-600 hover:bg-red-200 transition-colors",title:"Reject"},[u(c(Kt),{class:"h-5 w-5"})],8,Ul)):A("",!0)],64)):A("",!0),k.status==="Rejected"&&o.value!=="approved"?(a(),r("button",{key:2,onClick:X(Ce=>Ct(k),["stop"]),class:"p-1 rounded-full text-red-600 hover:bg-red-200 transition-colors",title:"Delete"},[u(c(Ht),{class:"h-5 w-5"})],8,Vl)):A("",!0)])])])}),128))])),e("div",Rl,[e("div",Ll,[i.status.toLowerCase()!=="completed"&&o.value==="active"?(a(),Q(ce,{key:0,onClick:X(k=>_t(i),["stop"]),disabled:we(i)&&ke(i),title:we(i)&&ke(i)?"Approve or reject all contracts before completing the milestone.":""},{default:E(()=>t[46]||(t[46]=[L(" Mark Complete ",-1)])),_:2,__:[46]},1032,["onClick","disabled","title"])):i.status.toLowerCase()==="completed"&&o.value==="completed"&&c(R)?(a(),Q(ce,{key:1,onClick:X(k=>ht(i),["stop"]),class:"bg-green-600 hover:bg-green-700"},{default:E(()=>t[47]||(t[47]=[L("Approve Milestone",-1)])),_:2,__:[47]},1032,["onClick"])):A("",!0),i.status.toLowerCase()==="completed"&&o.value==="completed"&&c(R)?(a(),Q(ce,{key:2,onClick:X(k=>wt(i),["stop"]),class:"bg-red-600 hover:bg-red-700"},{default:E(()=>t[48]||(t[48]=[L("Reject Milestone",-1)])),_:2,__:[48]},1032,["onClick"])):i.status.toLowerCase()==="approved"&&o.value==="approved"&&c(R)?(a(),Q(Be,{key:3,onClick:X(k=>$t(i),["stop"])},{default:E(()=>t[49]||(t[49]=[L("Reopen Milestone",-1)])),_:2,__:[49]},1032,["onClick"])):A("",!0)]),i.status.toLowerCase()!=="completed"&&o.value==="active"&&we(i)&&ke(i)?(a(),r("p",Fl," You have pending contracts. Approve or reject each contract before marking this milestone complete. ")):A("",!0)])],512),[[Nt,!i._collapsed]])]))),128))])):(a(),r("div",Uo,t[31]||(t[31]=[e("p",null,"No milestones found for this project in the selected tab.",-1)])))])):(a(),r("div",No,[u(c(Ft),{class:"h-12 w-12 mx-auto mb-2 text-gray-400"}),t[29]||(t[29]=e("p",{class:"text-lg"},"Please select a project to view its milestones.",-1))]))])])]),u(et,{show:D.value,title:"Add New Contract",milestone:g.value,users:re.value,"currency-options":f,"is-user-selection-required":!0,onClose:t[3]||(t[3]=i=>D.value=!1),onSubmitted:he,"project-total-budget":ae.value,"project-budget-currency":q.value,"milestone-stats":ve(g.value),"available-for-new-milestones":K.value.available_for_new_milestones,"budget-base-currency":K.value.currency},null,8,["show","milestone","users","project-total-budget","project-budget-currency","milestone-stats","available-for-new-milestones","budget-base-currency"]),u(et,{show:C.value,title:Ve(g.value)?"Update Milestone Budget":"Add Milestone Budget",milestone:g.value,users:re.value,"currency-options":f,"is-budget-form":!0,"is-user-selection-required":!1,onClose:t[4]||(t[4]=i=>C.value=!1),onSubmitted:he,"project-total-budget":ae.value,"project-budget-currency":q.value,"milestone-stats":ve(g.value),"available-for-new-milestones":K.value.available_for_new_milestones,"budget-base-currency":K.value.currency},null,8,["show","title","milestone","users","project-total-budget","project-budget-currency","milestone-stats","available-for-new-milestones","budget-base-currency"]),u(Zt,{show:B.value,title:((j=g.value)==null?void 0:j.action)==="approve"?"Approve Milestone":((Y=g.value)==null?void 0:Y.action)==="reject"?"Reject Milestone":((Z=g.value)==null?void 0:Z.action)==="reopen"?"Reopen Milestone":g.value?"Provide Milestone Review":((ee=d.value)==null?void 0:ee.action)==="accept"?"Approve Contract":((de=d.value)==null?void 0:de.action)==="reject"?"Reject Contract":"Delete Contract",message:((Le=g.value)==null?void 0:Le.action)==="approve"?"Please provide a reason for approving this milestone (required):":((Fe=g.value)==null?void 0:Fe.action)==="reject"?"Please provide a reason for rejecting this milestone (required):":((Ie=g.value)==null?void 0:Ie.action)==="reopen"?"Please provide a reason for reopening this milestone (required):":g.value?"Please provide a review explaining why this milestone is complete (required):":((Ee=d.value)==null?void 0:Ee.action)==="accept"?"Please provide a reason for approval (required):":((Oe=d.value)==null?void 0:Oe.action)==="reject"?"Please provide a reason for rejection (required):":"Provide a reason for deleting this rejected expendable (required):",type:((qe=g.value)==null?void 0:qe.action)==="reject"||((Ke=g.value)==null?void 0:Ke.action)==="reopen"?"warning":"info","api-endpoint":g.value?g.value.apiEndpoint:(He=d.value)==null?void 0:He.apiEndpoint,"http-method":g.value?g.value.httpMethod:(Ye=d.value)==null?void 0:Ye.httpMethod,onClose:bt,onSubmitted:he},null,8,["show","title","message","type","api-endpoint","http-method"]),u(Ut,{show:y.value,"project-id":Number(l.value),onClose:t[5]||(t[5]=i=>y.value=!1),onSaved:t[6]||(t[6]=()=>{y.value=!1,ue()}),"contract-id":T.value},null,8,["show","project-id","contract-id"]),u(lt,{show:_.value,onClose:t[8]||(t[8]=()=>{_.value=!1,g.value=null,$.value=[]})},{default:E(()=>[e("div",Il,[e("div",El,[t[51]||(t[51]=e("h3",{class:"text-lg font-semibold"},"Milestone Reasons",-1)),e("button",{class:"text-gray-500 hover:text-gray-700",onClick:t[7]||(t[7]=()=>{_.value=!1,g.value=null,$.value=[]})},t[50]||(t[50]=[e("svg",{class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),N.value?(a(),r("div",Ol,"Loading...")):(a(),r("div",ql,[$.value.length?(a(),r("ul",Hl,[(a(!0),r(se,null,ne($.value,i=>(a(),r("li",{key:i.id,class:"p-4 rounded-lg bg-gray-50 shadow-sm border border-gray-200"},[e("div",Yl,[e("span",zl,p(i.creator_name||"Unknown"),1),e("span",Gl,p(new Date(i.created_at).toLocaleString()),1)]),e("div",Xl,p(i.content),1)]))),128))])):(a(),r("div",Kl,"No reasons found."))]))])]),_:1},8,["show"]),u(Ns,{show:P.value,"contract-id":Number(T.value),"completion-date":(ze=g.value)!=null&&ze.completion_date?String(g.value.completion_date).split("T")[0]:null,onClose:t[9]||(t[9]=()=>{P.value=!1,T.value=null}),onTasksSubmitted:t[10]||(t[10]=()=>{P.value=!1,T.value=null})},null,8,["show","contract-id","completion-date"]),u(Ts,{show:z.value,"milestone-id":Number(((Ge=n.value)==null?void 0:Ge.id)||((Xe=g.value)==null?void 0:Xe.id)),"initial-completion-date":(Je=n.value)!=null&&Je.completion_date?String(n.value.completion_date).split("T")[0]:null,onClose:t[11]||(t[11]=()=>{z.value=!1,n.value=null}),onUpdated:ct},null,8,["show","milestone-id","initial-completion-date"]),u(us,{show:F.value,milestone:S.value,onClose:t[12]||(t[12]=()=>{F.value=!1,S.value=null}),onSubmitted:yt},null,8,["show","milestone"])]}),_:1}))}};export{Ma as default};
