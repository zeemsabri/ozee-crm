import C from"./TicketNotesSidebar-B5nD5E1T.js";import{_ as I,r as c,E as w,B,w as O,i as a,o as n,b as o,e as T,g,t as u,m as M,F as z,j as L}from"./app-Dyq3HU4Y.js";const V={class:"p-6 bg-white rounded-lg shadow-md min-h-[calc(100vh-6rem)] relative"},$={class:"flex justify-between items-center mb-6"},P={class:"text-2xl font-semibold text-gray-800"},q=["href"],G={class:"mb-8 p-6 border border-blue-200 bg-blue-50 rounded-lg shadow-sm"},H={class:"flex flex-col sm:flex-row items-center space-y-4 sm:space-y-0 sm:space-x-4"},Y=["disabled"],J={key:0,class:"flex items-center"},K={key:1},Q={key:0,class:"mt-2 text-sm text-gray-600"},R={key:1,class:"mt-2 text-sm text-red-600"},W={key:0,class:"text-center text-gray-600 py-8"},X={key:1,class:"text-center text-gray-500 py-8"},Z={key:2,class:"overflow-x-auto rounded-lg shadow"},ee={class:"min-w-full bg-white border border-gray-200"},te={class:"text-gray-700 text-sm font-light"},oe={class:"py-3 px-6 text-left flex items-center"},se=["src","alt"],ae={key:1},ne={class:"py-3 px-6 text-left"},le={class:"py-3 px-6 text-center items-center space-x-2"},re=["href"],ie=["onClick"],ce={__name:"DocumentsSection",props:{initialAuthToken:{type:String,required:!0},projectId:{type:[String,Number],required:!0},documents:{type:Array,default:()=>[]},projectData:{type:[Object,null],default:()=>({})}},emits:["add-activity"],setup(d,{emit:_}){const p=d,k=_,m=c(!0),h=c(!1),i=c([]),l=c(null),r=c([]),b=c(!1),y=c(null),{showModal:f}=w("modalService"),{addActivity:j}=w("activityService"),A=async()=>{m.value=!0,l.value=null;try{const e=await fetch(`/api/client-api/project/${p.projectId}/documents`,{headers:{Authorization:`Bearer ${p.initialAuthToken}`,"Content-Type":"application/json",Accept:"application/json"}}),t=await e.json();if(!e.ok){const s=t.errors?Object.values(t.errors).flat().join(`
`):t.message||"Failed to fetch documents.";throw new Error(s)}r.value=t,m.value=!1}catch(e){console.error("Error fetching documents:",e),l.value=e.message||"An unexpected error occurred while fetching documents.",f("Error",l.value,"alert")}finally{m.value=!1}},D=e=>{i.value=Array.from(e.target.files),l.value=null},S=e=>{y.value=e,b.value=!0},N=()=>{k("add-activity","A new note was added to a task.")},E=async()=>{if(i.value.length===0){f("No Files Selected","Please select one or more files to upload.","alert");return}h.value=!0,l.value=null;const e=new FormData;i.value.forEach(t=>{e.append("documents[]",t)});try{const t=await fetch("/api/client-api/documents",{method:"POST",headers:{Authorization:`Bearer ${p.initialAuthToken}`,Accept:"application/json"},body:e}),s=await t.json();if(!t.ok){const v=s.errors?Object.values(s.errors).flat().join(`
`):s.message||"Failed to upload documents.";throw new Error(v)}r.value=[...r.value,...s.documents],r.value.sort((v,U)=>new Date(U.created_at).getTime()-new Date(v.created_at).getTime()),i.value=[];const x=document.getElementById("document-upload-input");x&&(x.value=""),f("Upload Successful","Your document(s) have been uploaded successfully!","alert"),j(`Uploaded ${s.documents.length} new document(s).`)}catch(t){console.error("Error uploading documents:",t),l.value=t.message||"An unexpected error occurred during upload.",f("Upload Error",l.value,"alert")}finally{h.value=!1}},F=e=>!e||e.includes("pdf")?"📄":e.includes("image")?"🖼️":e.includes("word")?"📝":e.includes("spreadsheet")?"📊":e.includes("presentation")?"📽️":"📁";return B(()=>{A()}),O(()=>p.documents,e=>{e&&e.length>0&&r.value.length===0&&(r.value=[...e])},{immediate:!0}),(e,t)=>(n(),a("div",V,[o("div",$,[o("h2",P,u(d.projectData.name??"Project")+" Documents",1),d.projectData.google_drive_link?(n(),a("a",{key:0,href:d.projectData.google_drive_link,target:"_blank",rel:"noopener noreferrer",class:"bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-300 ease-in-out text-sm"}," Manage in Google Drive ",8,q)):g("",!0)]),o("div",G,[t[2]||(t[2]=o("h3",{class:"text-xl font-semibold text-blue-800 mb-4"},"Upload New Documents",-1)),o("div",H,[o("input",{type:"file",id:"document-upload-input",multiple:"",onChange:D,class:"flex-1 block w-full text-sm text-gray-900 border border-gray-300 rounded-lg cursor-pointer bg-white focus:outline-none file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"},null,32),o("button",{onClick:E,disabled:h.value||i.value.length===0,class:"bg-green-600 text-white py-2 px-6 rounded-lg hover:bg-green-700 transition-colors shadow-md disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center min-w-[120px]"},[h.value?(n(),a("span",J,t[1]||(t[1]=[o("svg",{class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[o("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),o("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),M(" Uploading... ",-1)]))):(n(),a("span",K,"Upload Files"))],8,Y)]),i.value.length>0?(n(),a("p",Q," Selected: "+u(i.value.length)+" file(s) ",1)):g("",!0),l.value?(n(),a("p",R,u(l.value),1)):g("",!0)]),t[4]||(t[4]=o("h3",{class:"text-xl font-semibold text-gray-800 mb-4"},"Uploaded Documents",-1)),m.value?(n(),a("div",W,"Loading documents...")):r.value.length===0?(n(),a("div",X," No documents have been uploaded for this project yet. ")):(n(),a("div",Z,[o("table",ee,[t[3]||(t[3]=o("thead",null,[o("tr",{class:"bg-gray-100 text-gray-600 uppercase text-sm leading-normal"},[o("th",{class:"py-3 px-6 text-left"},"File Name"),o("th",{class:"py-3 px-6 text-left"},"Uploaded On"),o("th",{class:"py-3 px-6 text-center"},"Actions")])],-1)),o("tbody",te,[(n(!0),a(z,null,L(r.value,s=>(n(),a("tr",{key:s.id,class:"border-b border-gray-200 hover:bg-gray-50"},[o("td",oe,[s.thumbnail?(n(),a("img",{key:0,src:s.thumbnail,alt:s.filename,loading:"lazy"},null,8,se)):(n(),a("span",ae,u(F(s.mime_type))+" "+u(s.filename),1))]),o("td",ne,u(new Date(s.created_at).toLocaleDateString()),1),o("td",le,[s.path?(n(),a("a",{key:0,href:s.path,target:"_blank",rel:"noopener noreferrer",class:"bg-blue-500 text-white py-1 px-3 rounded-lg hover:bg-blue-600 transition-colors text-xs font-semibold"}," Download ",8,re)):g("",!0),o("a",{onClick:x=>S(s),rel:"noopener noreferrer",class:"bg-blue-500 text-white py-1 px-3 rounded-lg hover:bg-blue-600 transition-colors text-xs font-semibold"}," Add Notes ",8,ie)])]))),128))])])])),T(C,{isOpen:b.value,"onUpdate:isOpen":t[0]||(t[0]=s=>b.value=s),"selected-item":y.value,initialAuthToken:d.initialAuthToken,"note-for":"document",projectId:d.projectId,onNoteAddedSuccess:N},null,8,["isOpen","selected-item","initialAuthToken","projectId"])]))}},pe=I(ce,[["__scopeId","data-v-8b4f80ed"]]);export{pe as default};
