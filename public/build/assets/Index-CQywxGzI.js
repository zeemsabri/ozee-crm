import{B as he,r as d,s as q,D as be,p as te,A as je,K as ke,h as r,o as l,e as a,u as w,q as Ce,a as u,b as s,f,k as v,L as C,t as c,F as E,i as L,c as V,g as h,d as se,v as z,m as oe}from"./app-C5dhlUiN.js";import{_ as $e}from"./AuthenticatedLayout-DKPQWXUx.js";import{_ as ae}from"./ProjectForm-D0DSegGC.js";import{P as b}from"./PrimaryButton-DAvucddZ.js";import{D as ne}from"./DangerButton-DmNJXReW.js";import{_ as N,a as G}from"./SecondaryButton-BmPmG-1_.js";import{_ as $,a as H}from"./TextInput-KuNtvHVp.js";import{_ as O}from"./InputError-DOCuQf8z.js";import{_ as Oe}from"./NotesModal-ELVDWSCa.js";import"./ApplicationLogo-CdSr8yep.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./Checkbox-txyl2wfd.js";const Pe={class:"py-12"},De={class:"max-w-12xl mx-auto sm:px-6 lg:px-12"},Me={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},Ae={class:"p-6 text-gray-900"},Te={class:"mb-6"},Ve={key:0,class:"text-gray-600"},Ne={key:1,class:"text-red-600"},Re={key:2,class:"text-gray-600"},Ie={key:3},Se={class:"min-w-full divide-y divide-gray-200"},Ee={class:"bg-white divide-y divide-gray-200"},Ue={class:"px-6 py-4 whitespace-nowrap"},We={class:"px-6 py-4"},Ye={key:0},Fe={key:1,class:"text-gray-400"},Be={class:"px-6 py-4 whitespace-nowrap capitalize"},qe={class:"px-6 py-4 whitespace-nowrap"},Le={class:"px-6 py-4"},ze={key:0},Ge={key:1,class:"text-gray-400"},He={class:"px-6 py-4"},Ke={key:0},Je={key:1,class:"text-gray-400"},Qe={class:"px-6 py-4 whitespace-nowrap capitalize"},Xe={class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium"},Ze={class:"flex items-center space-x-2"},et={class:"p-6"},tt={key:0,class:"mt-4 text-gray-800"},st={key:0},ot={key:1,class:"text-red-600 text-sm mb-4"},at={class:"mt-6 flex justify-end"},nt={class:"p-6"},lt={key:0,class:"text-red-600 text-sm mb-4"},rt={class:"mb-4"},it={class:"mb-4"},ut={class:"mb-4"},dt={key:0,class:"mb-4"},pt=["value"],ct={key:1,class:"mb-4"},vt={class:"mt-6 flex justify-end"},mt={class:"p-6"},_t={key:0,class:"text-red-600 text-sm mb-4"},yt={class:"mb-4"},ft=["value"],gt={class:"mt-6 flex justify-end"},Tt={__name:"Index",setup(xt){const P=he(),_=d([]),le=d([]),re=d([]),U=d([]),W=d(!0),p=d({}),n=d(""),j=d(!1),k=d(!1),D=d(!1),M=d(!1),Y=d(!1),A=d(!1),R=d({}),i=q({project_id:null,description:"",amount:"",user_id:null,hours_spent:"",type:"expense"}),F=q({project_id:null,content:""}),x=q({project_id:null,payment_type:"one_off"}),g=d(null),K=d(null),{canDo:m,canView:ie}=be();te(()=>P.value?P.value.role_data&&P.value.role_data.slug==="super-admin"||P.value.role==="super_admin"||P.value.role==="super-admin":!1),m("create_projects");const ue=te(()=>ie("projects").value),de=m("manage_projects"),J=[{value:"active",label:"Active"},{value:"completed",label:"Completed"},{value:"on_hold",label:"On Hold"},{value:"archived",label:"Archived"}],Q=[{value:"Website Designing",label:"Website Designing"},{value:"SEO",label:"SEO"},{value:"Social Media",label:"Social Media"},{value:"Content Writing",label:"Content Writing"},{value:"Graphic Design",label:"Graphic Design"}],X=[{value:"UpWork",label:"UpWork"},{value:"Direct",label:"Direct Client"},{value:"Wix Marketplace",label:"Wix Marketplace"},{value:"Referral",label:"Referral"}],I=d([]),S=d([]),pe=async()=>{try{const o=await oe.get("/api/roles?type=client");I.value=o.data.map(t=>({value:t.id,label:t.name}));const e=await oe.get("/api/roles?type=project");S.value=e.data.map(t=>({value:t.id,label:t.name}))}catch(o){console.error("Error fetching roles:",o),I.value=[{value:1,label:"Client Admin"},{value:2,label:"Client User"},{value:3,label:"Client Viewer"}],S.value=[{value:1,label:"Project Manager"},{value:2,label:"Project Member"},{value:3,label:"Project Viewer"}]}},B=[{value:"one_off",label:"One-Off"},{value:"monthly",label:"Monthly"}],Z=[{value:"website_design",label:"Website Design"},{value:"seo",label:"SEO"},{value:"social_media",label:"Social Media"},{value:"content_writing",label:"Content Writing"},{value:"graphic_design",label:"Graphic Design"}],T=async()=>{W.value=!0,n.value="";try{const o=await window.axios.get("/api/projects");if(_.value=o.data,de.value){const e=await window.axios.get("/api/clients");le.value=e.data.data;const t=await window.axios.get("/api/users");re.value=t.data}}catch(o){n.value="Failed to load data.",console.error("Error fetching initial data:",o),o.response&&(o.response.status===401||o.response.status===403)&&(n.value="You are not authorized to view this content or your session expired. Please log in.")}finally{W.value=!1}},ce=()=>{if(!m("create_projects").value){alert("You do not have permission to create projects.");return}R.value={},j.value=!0},ve=o=>{if(!m("manage_projects").value){alert("You do not have permission to edit this project.");return}R.value=o,k.value=!0},ee=o=>{const e=_.value.findIndex(t=>t.id===o.id);e!==-1?_.value[e]=o:_.value.push(o),j.value=!1,k.value=!1,alert(o.id?"Project updated successfully!":"Project created successfully!"),T()},me=o=>{if(!m("delete_projects").value){alert("You do not have permission to delete this project.");return}g.value=o,D.value=!0},_e=async()=>{var e;n.value="";const o=(e=g.value)==null?void 0:e.id;if(!o){n.value="Invalid project.";return}if(!m("delete_projects").value){n.value="You do not have permission to delete this project.";return}try{await window.axios.delete(`/api/projects/${o}`),_.value=_.value.filter(t=>t.id!==o),D.value=!1,g.value=null,alert("Project deleted successfully!")}catch(t){n.value="Failed to delete project.",t.response&&t.response.data.message&&(n.value=t.response.data.message),console.error("Error deleting project:",t)}},ye=async o=>{if(!m("manage_project_transactions").value){alert("You do not have permission to add transactions to this project.");return}const e=o.id;if(!e){console.error("No project ID found in project object:",o);return}i.project_id=e,i.description="",i.amount="",i.user_id=null,i.hours_spent="",i.type="expense",p.value={},n.value="";try{const t=await window.axios.get(`/api/projects/${e}`);U.value=t.data.users||[]}catch(t){console.error("Error fetching project users:",t),U.value=[]}M.value=!0},fe=async()=>{p.value={},n.value="";const o=i.project_id;if(!o){n.value="Invalid project.";return}if(!m("manage_project_transactions").value){n.value="You do not have permission to add transactions to this project.";return}try{await window.axios.post(`/api/projects/${o}/expenses`,{expenses:[i]}),M.value=!1,alert("Transaction added successfully!"),T()}catch(e){e.response&&e.response.status===422?p.value=e.response.data.errors:e.response&&e.response.data.message?n.value=e.response.data.message:(n.value="Failed to add transaction.",console.error("Error adding transaction:",e))}},ge=o=>{if(!m("add_project_notes").value){alert("You do not have permission to add notes to this project.");return}const e=o.id;if(!e){console.error("No project ID found in project object:",o);return}F.project_id=e,F.content="",p.value={},n.value="",Y.value=!0},xe=o=>{if(!m("manage_project_services_and_payments").value){alert("You do not have permission to convert payment type for this project.");return}const e=o.id;if(!e){console.error("No project ID found in project object:",o);return}K.value=o,x.project_id=e,x.payment_type=o.payment_type,p.value={},n.value="",A.value=!0},we=async()=>{n.value="";const o=x.project_id;if(!o){n.value="Invalid project.";return}if(!m("manage_project_services_and_payments").value){n.value="You do not have permission to convert payment type for this project.";return}try{await window.axios.post(`/api/projects/${o}/convert-payment-type`,{payment_type:x.payment_type});const e=_.value.findIndex(t=>t.id===o);e!==-1&&(_.value[e].payment_type=x.payment_type),A.value=!1,K.value=null,alert("Payment type converted successfully!"),T()}catch(e){n.value="Failed to convert payment type.",e.response&&e.response.data.message&&(n.value=e.response.data.message),console.error("Error converting payment type:",e)}};return je(()=>{if(!ue.value){window.location.href=route("dashboard");return}T(),pe();const o=document.querySelector("#app").__vue_app__;o&&ke(o)}),(o,e)=>(l(),r(E,null,[a(w(Ce),{title:"Projects"}),a($e,null,{header:u(()=>e[17]||(e[17]=[s("h2",{class:"font-semibold text-xl text-gray-800 leading-tight"},"Projects",-1)])),default:u(()=>[s("div",Pe,[s("div",De,[s("div",Me,[s("div",Ae,[e[25]||(e[25]=s("h3",{class:"text-2xl font-bold mb-4"},"Project List",-1)),f((l(),r("div",Te,[a(b,{onClick:ce},{default:u(()=>e[18]||(e[18]=[v(" Create New Project ")])),_:1,__:[18]})])),[[w(C),"create_projects"]]),W.value?(l(),r("div",Ve,"Loading projects...")):n.value?(l(),r("div",Ne,c(n.value),1)):_.value.length===0?(l(),r("div",Re,"No projects found.")):(l(),r("div",Ie,[s("table",Se,[e[24]||(e[24]=s("thead",{class:"bg-gray-50"},[s("tr",null,[s("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Name"),s("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Clients"),s("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Status"),s("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Type"),s("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Departments"),s("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Assigned Users"),s("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Payment Type"),s("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Actions")])],-1)),s("tbody",Ee,[(l(!0),r(E,null,L(_.value,t=>(l(),r("tr",{key:t.id},[s("td",Ue,c(t.name),1),s("td",We,[t.clients&&t.clients.length?(l(),r("span",Ye,c(t.clients.map(y=>`${y.name} (${y.pivot.role})`).join(", ")),1)):(l(),r("span",Fe,"None"))]),s("td",Be,c(t.status.replace("_"," ")),1),s("td",qe,c(t.project_type||"N/A"),1),s("td",Le,[t.departments&&t.departments.length?(l(),r("span",ze,c(t.departments.join(", ")),1)):(l(),r("span",Ge,"None"))]),s("td",He,[t.users&&t.users.length?(l(),r("span",Ke,c(t.users.map(y=>`${y.name} (${y.pivot.role})`).join(", ")),1)):(l(),r("span",Je,"None"))]),s("td",Qe,c(t.payment_type.replace("_"," ")),1),s("td",Xe,[s("div",Ze,[f((l(),V(b,{onClick:y=>ve(t)},{default:u(()=>e[19]||(e[19]=[v("Edit")])),_:2,__:[19]},1032,["onClick"])),[[w(C),"manage_projects"]]),f((l(),V(b,{onClick:y=>ye(t)},{default:u(()=>e[20]||(e[20]=[v("Add Transactions")])),_:2,__:[20]},1032,["onClick"])),[[w(C),"manage_project_transactions"]]),f((l(),V(b,{onClick:y=>ge(t)},{default:u(()=>e[21]||(e[21]=[v("Add Note")])),_:2,__:[21]},1032,["onClick"])),[[w(C),"add_project_notes"]]),f((l(),V(b,{onClick:y=>xe(t)},{default:u(()=>e[22]||(e[22]=[v("Convert Payment")])),_:2,__:[22]},1032,["onClick"])),[[w(C),"manage_project_services_and_payments"]]),f((l(),V(ne,{onClick:y=>me(t)},{default:u(()=>e[23]||(e[23]=[v("Delete")])),_:2,__:[23]},1032,["onClick"])),[[w(C),"delete_projects"]])])])]))),128))])])]))])])])]),a(N,{show:j.value,onClose:e[1]||(e[1]=t=>j.value=!1)},{default:u(()=>[a(ae,{show:j.value,project:R.value,statusOptions:J,serviceOptions:Z,departmentOptions:Q,sourceOptions:X,clientRoleOptions:I.value,userRoleOptions:S.value,paymentTypeOptions:B,onClose:e[0]||(e[0]=t=>j.value=!1),onSubmit:ee},null,8,["show","project","clientRoleOptions","userRoleOptions"])]),_:1},8,["show"]),a(N,{show:k.value,onClose:e[3]||(e[3]=t=>k.value=!1)},{default:u(()=>[a(ae,{show:k.value,project:R.value,statusOptions:J,serviceOptions:Z,departmentOptions:Q,sourceOptions:X,clientRoleOptions:I.value,userRoleOptions:S.value,paymentTypeOptions:B,onClose:e[2]||(e[2]=t=>k.value=!1),onSubmit:ee},null,8,["show","project","clientRoleOptions","userRoleOptions"])]),_:1},8,["show"]),a(N,{show:D.value,onClose:e[5]||(e[5]=t=>D.value=!1)},{default:u(()=>[s("div",et,[e[29]||(e[29]=s("h2",{class:"text-lg font-medium text-gray-900"}," Are you sure you want to delete this project? ",-1)),e[30]||(e[30]=s("p",{class:"mt-1 text-sm text-gray-600"}," This action cannot be undone. All associated conversations and emails will also be deleted. ",-1)),g.value?(l(),r("div",tt,[e[26]||(e[26]=s("strong",null,"Project:",-1)),v(" "+c(g.value.name)+" ",1),g.value.clients&&g.value.clients.length?(l(),r("span",st," (Clients: "+c(g.value.clients.map(t=>`${t.name} (${t.pivot.role})`).join(", "))+") ",1)):h("",!0)])):h("",!0),n.value?(l(),r("div",ot,c(n.value),1)):h("",!0),s("div",at,[a(G,{onClick:e[4]||(e[4]=t=>D.value=!1)},{default:u(()=>e[27]||(e[27]=[v("Cancel")])),_:1,__:[27]}),a(ne,{class:"ms-3",onClick:_e},{default:u(()=>e[28]||(e[28]=[v("Delete Project")])),_:1,__:[28]})])])]),_:1},8,["show"]),a(N,{show:M.value,onClose:e[12]||(e[12]=t=>M.value=!1)},{default:u(()=>[s("div",nt,[e[35]||(e[35]=s("h2",{class:"text-lg font-medium text-gray-900 mb-4"},"Add Transactions",-1)),n.value?(l(),r("div",lt,c(n.value),1)):h("",!0),s("form",{onSubmit:se(fe,["prevent"])},[s("div",rt,[a($,{for:"transaction_type",value:"Type"}),f(s("select",{id:"transaction_type",class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full","onUpdate:modelValue":e[6]||(e[6]=t=>i.type=t)},e[31]||(e[31]=[s("option",{value:"income"},"Income",-1),s("option",{value:"expense"},"Expense",-1)]),512),[[z,i.type]]),a(O,{message:p.value["expenses.0.type"]?p.value["expenses.0.type"][0]:"",class:"mt-2"},null,8,["message"])]),s("div",it,[a($,{for:"transaction_description",value:"Description"}),a(H,{id:"transaction_description",type:"text",class:"mt-1 block w-full",modelValue:i.description,"onUpdate:modelValue":e[7]||(e[7]=t=>i.description=t),required:""},null,8,["modelValue"]),a(O,{message:p.value["expenses.0.description"]?p.value["expenses.0.description"][0]:"",class:"mt-2"},null,8,["message"])]),s("div",ut,[a($,{for:"transaction_amount",value:"Amount"}),a(H,{id:"transaction_amount",type:"number",step:"0.01",class:"mt-1 block w-full",modelValue:i.amount,"onUpdate:modelValue":e[8]||(e[8]=t=>i.amount=t),required:""},null,8,["modelValue"]),a(O,{message:p.value["expenses.0.amount"]?p.value["expenses.0.amount"][0]:"",class:"mt-2"},null,8,["message"])]),i.type==="expense"?(l(),r("div",dt,[a($,{for:"transaction_user_id",value:"User (Optional)"}),f(s("select",{id:"transaction_user_id",class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full","onUpdate:modelValue":e[9]||(e[9]=t=>i.user_id=t)},[e[32]||(e[32]=s("option",{value:"",disabled:""},"Select User",-1)),(l(!0),r(E,null,L(U.value,t=>(l(),r("option",{key:t.id,value:t.id},c(t.name),9,pt))),128))],512),[[z,i.user_id]]),a(O,{message:p.value["expenses.0.user_id"]?p.value["expenses.0.user_id"][0]:"",class:"mt-2"},null,8,["message"])])):h("",!0),i.type==="expense"?(l(),r("div",ct,[a($,{for:"transaction_hours_spent",value:"Hours Spent (Optional)"}),a(H,{id:"transaction_hours_spent",type:"number",step:"0.01",class:"mt-1 block w-full",modelValue:i.hours_spent,"onUpdate:modelValue":e[10]||(e[10]=t=>i.hours_spent=t)},null,8,["modelValue"]),a(O,{message:p.value["expenses.0.hours_spent"]?p.value["expenses.0.hours_spent"][0]:"",class:"mt-2"},null,8,["message"])])):h("",!0),s("div",vt,[a(G,{onClick:e[11]||(e[11]=t=>M.value=!1)},{default:u(()=>e[33]||(e[33]=[v("Cancel")])),_:1,__:[33]}),a(b,{class:"ms-3",type:"submit"},{default:u(()=>e[34]||(e[34]=[v("Add Transaction")])),_:1,__:[34]})])],32)])]),_:1},8,["show"]),a(Oe,{show:Y.value,"project-id":F.project_id,onClose:e[13]||(e[13]=t=>Y.value=!1),onNoteAdded:T},null,8,["show","project-id"]),a(N,{show:A.value,onClose:e[16]||(e[16]=t=>A.value=!1)},{default:u(()=>[s("div",mt,[e[38]||(e[38]=s("h2",{class:"text-lg font-medium text-gray-900 mb-4"},"Convert Payment Type",-1)),n.value?(l(),r("div",_t,c(n.value),1)):h("",!0),s("form",{onSubmit:se(we,["prevent"])},[s("div",yt,[a($,{for:"convert_payment_type",value:"Payment Type"}),f(s("select",{id:"convert_payment_type",class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full","onUpdate:modelValue":e[14]||(e[14]=t=>x.payment_type=t),required:""},[(l(),r(E,null,L(B,t=>s("option",{key:t.value,value:t.value},c(t.label),9,ft)),64))],512),[[z,x.payment_type]]),a(O,{message:p.value.payment_type?p.value.payment_type[0]:"",class:"mt-2"},null,8,["message"])]),s("div",gt,[a(G,{onClick:e[15]||(e[15]=t=>A.value=!1)},{default:u(()=>e[36]||(e[36]=[v("Cancel")])),_:1,__:[36]}),a(b,{class:"ms-3",type:"submit"},{default:u(()=>e[37]||(e[37]=[v("Convert")])),_:1,__:[37]})])],32)])]),_:1},8,["show"])]),_:1})],64))}};export{Tt as default};
