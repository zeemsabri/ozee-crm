import{r as b,p as te,w as Z,A as ze,h as i,o as n,e as d,b as o,g as u,t as y,F as O,i as T,m as be,B as at,L as ot,M as lt,D as nt,N as Ne,s as rt,u as r,k as L,n as oe,f as J,j as Ve,v as le,c as Be,a as Q,d as it}from"./app-uCPmy9lh.js";import{P as ne}from"./PrimaryButton-XJOxuypH.js";import{a as Me}from"./SecondaryButton-BZ31n4gd.js";import{_ as k,a as A}from"./TextInput-BFco6XAs.js";import{_ as P}from"./InputError-B3ccaYAa.js";import{_ as dt}from"./Checkbox-CrklEcl2.js";const ut={class:"mt-2"},ct={class:"mb-2"},mt={key:0,class:"text-gray-500 text-sm mb-2"},vt=["disabled"],pt={value:""},ft=["value"],_t={class:"flex-grow"},yt=["value","onChange","disabled"],gt=["value"],bt=["onClick"],qe={__name:"MultiSelectWithRoles",props:{label:{type:String,required:!0},items:{type:Array,default:()=>[]},endpoint:{type:String,default:""},selectedItems:{type:Array,default:()=>[]},itemText:{type:String,default:"name"},itemSubtext:{type:String,default:"email"},itemValue:{type:String,default:"id"},roleOptions:{type:Array,default:()=>[]},roleType:{type:String,default:"application"},defaultRoleId:{type:Number,default:null},error:{type:String,default:""},placeholder:{type:String,default:"Select an item"},showRemoveButton:{type:Boolean,default:!0}},emits:["update:selectedItems"],setup(w,{emit:he}){const j=w,W=he,h=b([]),V=b([]),re=b([]),se=b([]),g=b(!1),ie=async()=>{if(!(j.roleOptions.length>0))try{const _=(await be.get(`/api/roles?type=${j.roleType}`)).data;re.value=_.map(v=>({value:v.id,label:v.name}))}catch(m){console.error("Error fetching roles:",m)}},B=te(()=>re.value.length>0?re.value:j.roleOptions),M=()=>j.defaultRoleId?j.defaultRoleId:B.value.length>0?B.value[0].value:1,I=()=>{if(console.log("initializeFromProps called with selectedItems:",j.selectedItems),!j.selectedItems||j.selectedItems.length===0){h.value=[],V.value=[],console.log("Cleared selectedIds and selectedItemsWithRoles because props.selectedItems is empty");return}const m=new Set;j.selectedItems.forEach(_=>{const v=typeof _=="object"?_.id:_;if(!m.has(v)){if(m.add(v),!h.value.includes(v))h.value.push(v),typeof _=="object"&&_.role_id?V.value.push({id:v,role_id:_.role_id}):V.value.push({id:v,role_id:M()});else if(typeof _=="object"&&_.role_id){const R=V.value.find(q=>q.id===v);R&&(R.role_id=_.role_id)}}}),console.log("After initialization, selectedIds:",h.value),console.log("After initialization, selectedItemsWithRoles:",V.value)};Z(()=>j.selectedItems,(m,_)=>{console.log("selectedItems changed:",m),JSON.stringify(m)!==JSON.stringify(_)?(console.log("selectedItems changed significantly, reinitializing"),I()):console.log("selectedItems change was not significant, skipping reinitialization")},{deep:!0,immediate:!0}),Z(V,m=>{W("update:selectedItems",m)},{deep:!0});const me=m=>{m&&!h.value.includes(m)&&(h.value.push(m),V.value.push({id:m,role_id:M()}))},G=m=>{h.value=h.value.filter(_=>_!==m),V.value=V.value.filter(_=>_.id!==m)},Y=(m,_)=>{const v=V.value.find(R=>R.id===m);v&&(v.role_id=parseInt(_))},S=m=>z.value.find(_=>_[j.itemValue]===m),ae=m=>{const _=V.value.find(v=>v.id===m);return _?_.role_id:M()},H=async()=>{if(j.endpoint){g.value=!0;try{const m=await be.get(j.endpoint);m.data&&Array.isArray(m.data)?se.value=m.data:m.data&&m.data.data&&Array.isArray(m.data.data)&&(se.value=m.data.data)}catch(m){console.error("Error fetching items from endpoint:",m)}finally{g.value=!1}}},z=te(()=>j.endpoint&&se.value.length>0?se.value:j.items);return ze(()=>{ie(),I(),j.endpoint&&H()}),(m,_)=>(n(),i("div",null,[d(k,{value:w.label},null,8,["value"]),o("div",ut,[o("div",ct,[g.value?(n(),i("div",mt,"Loading...")):u("",!0),w.showRemoveButton?(n(),i("select",{key:1,class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full",onChange:_[0]||(_[0]=v=>{const R=parseInt(v.target.value);me(R),v.target.value=""}),disabled:g.value},[o("option",pt,y(w.placeholder),1),(n(!0),i(O,null,T(z.value.filter(v=>!h.value.includes(v[w.itemValue])),v=>(n(),i("option",{key:v[w.itemValue],value:v[w.itemValue]},y(v[w.itemText])+" ("+y(v[w.itemSubtext])+") ",9,ft))),128))],40,vt)):u("",!0)]),(n(!0),i(O,null,T(h.value,v=>{var R,q;return n(),i("div",{key:v,class:"flex items-center mb-1 p-2 border rounded"},[o("div",_t,y((R=S(v))==null?void 0:R[w.itemText])+" ("+y((q=S(v))==null?void 0:q[w.itemSubtext])+") ",1),o("select",{class:"ms-2 border-gray-300 rounded-md",value:ae(v),onChange:E=>Y(v,E.target.value),disabled:!w.showRemoveButton},[(n(!0),i(O,null,T(B.value,E=>(n(),i("option",{key:E.value,value:E.value},y(E.label),9,gt))),128))],40,yt),w.showRemoveButton?(n(),i("button",{key:0,type:"button",class:"ml-2 text-red-600",onClick:()=>G(v)}," Remove ",8,bt)):u("",!0)])}),128))]),d(P,{message:w.error,class:"mt-2"},null,8,["message"])]))}},ht={class:"p-6 w-full max-w-6xl mx-auto bg-white rounded-lg shadow-xl"},xt={class:"flex justify-between items-center mb-4"},kt={class:"text-lg font-medium text-gray-900"},wt={key:0,class:"text-red-600 text-sm mb-4"},jt={key:1,class:"mb-4"},Vt={key:0,class:"text-xs text-gray-500 mt-2 p-2 bg-gray-100 rounded"},St={class:"font-bold"},$t={class:"mt-1"},Ct={key:0},Ut={key:1},Dt={key:2},It={key:0},Pt={class:"list-disc ml-4"},Rt={key:0},Ft={class:"mt-1"},At={class:"border-b border-gray-200 mb-6"},Ot={class:"flex -mb-px"},Tt={key:0},Et={class:"mb-4"},Nt={class:"mb-4"},Bt=["disabled"],Mt={class:"mb-4"},qt={class:"mb-4"},zt={class:"mb-4"},Lt=["disabled"],Jt=["value"],Wt={class:"mb-4"},Gt=["disabled"],Yt=["value"],Ht={key:0,class:"mt-6 flex justify-end"},Kt={key:1},Xt={key:0,class:"mb-4"},Qt={key:0,class:"mt-2 flex justify-end"},Zt={key:1,class:"mt-2 text-green-600 text-sm"},es={key:2,class:"mt-2 text-red-600 text-sm"},ts={class:"mb-4"},ss=["disabled"],as={key:1,class:"mb-4"},os={key:0,class:"mt-2 flex justify-end"},ls={key:1,class:"mt-2 text-green-600 text-sm"},ns={key:2,class:"mt-2 text-red-600 text-sm"},rs={key:2},is={class:"mb-4"},ds={class:"mb-4"},us=["disabled"],cs=["value"],ms={class:"mb-4"},vs={class:"mt-2"},ps={class:"flex items-center mb-2"},fs=["for"],_s={key:0,class:"pl-6"},ys={class:"grid grid-cols-2 gap-4 mb-2"},gs=["id","onUpdate:modelValue","disabled"],bs={class:"mb-2"},hs={class:"grid grid-cols-3 gap-2"},xs={class:"text-xs text-gray-500 mt-1"},ks={key:0,class:"mt-6 flex justify-end"},ws={key:3},js={class:"mb-4"},Vs={class:"flex justify-between items-center mb-4"},Ss={class:"text-right"},$s={class:"text-lg font-medium"},Cs={class:"text-lg font-medium"},Us={class:"text-xl font-bold mt-1"},Ds={key:0,class:"mt-4"},Is=["onUpdate:modelValue"],Ps={key:0,value:"income"},Rs={key:1,value:"expense"},Fs=["onUpdate:modelValue"],As=["value"],Os=["onClick"],Ts={class:"flex mt-2"},Es={key:0,class:"mt-6 flex justify-end"},Ns={key:4},Bs={class:"mb-4"},Ms={class:"mt-2"},qs={key:0,class:"mb-4"},zs={class:"mt-4"},Ls={key:0,class:"text-sm text-red-500 mt-2"},Js={key:1,class:"mt-4"},Ws={class:"flex-grow"},Gs=["href"],Ys=["onClick"],Hs={key:5},Ks={class:"mb-4"},Xs={class:"mt-2"},Qs={class:"flex items-start mb-2"},Zs=["onUpdate:modelValue","readonly"],ea={class:"mt-6 flex justify-end"},ra={__name:"ProjectForm",props:{show:{type:Boolean,required:!0},project:{type:Object,default:()=>({})},statusOptions:{type:Array,required:!0},departmentOptions:{type:Array,required:!0},sourceOptions:{type:Array,required:!0},clientRoleOptions:{type:Array,default:()=>[]},userRoleOptions:{type:Array,default:()=>[]},paymentTypeOptions:{type:Array,required:!0}},emits:["close","submit"],setup(w,{emit:he}){at();const j=b({}),W=w;Z(()=>W.project,t=>{j.value=t||{}},{immediate:!0});const h=te(()=>{var t;return((t=j.value)==null?void 0:t.id)||null}),{permissions:V,loading:re,error:se}=ot(h),g=lt(j);te(()=>!!g.value),te(()=>{if(!g.value)return!1;const t=g.value.name,a=g.value.slug;return t==="Manager"||t==="Project Manager"||a==="manager"||a==="project-manager"});const{canDo:ie,canView:B,canManage:M}=nt(h),I=ie("manage_projects",g),me=ie("upload_project_documents",g),G=M("project_expenses",g),Y=M("project_income",g),S=M("project_services_and_payments",g),ae=ie("add_project_notes",g),H=M("project_users",g),z=M("project_clients",g),m=M("project_basic_details",g),_=B("project_documents",g),v=B("project_services_and_payments",g),R=B("project_notes",g),q=B("project_users",g),E=B("project_clients",g),xe=B("view_project_transactions",g),$=b("basic"),ee=t=>{if(!(t==="documents"&&!e.id)&&($.value=t,e.id))switch(F.value=!0,t){case"basic":Ce(e.id).finally(()=>{F.value=!1});break;case"client":E.value||z.value||q.value||H.value?Ue(e.id).finally(()=>{F.value=!1}):F.value=!1;break;case"services":v.value||S.value?De(e.id).finally(()=>{F.value=!1}):F.value=!1;break;case"transactions":G.value||Y.value?Ie(e.id).finally(()=>{F.value=!1}):F.value=!1;break;case"documents":_.value?Pe(e.id).finally(()=>{F.value=!1}):F.value=!1;break;case"notes":R.value||ae.value?Re(e.id).finally(()=>{F.value=!1}):F.value=!1;break;default:F.value=!1;break}},de=b([]),ue=b([]),ke=b([]),ce=b([]),Le=async()=>{try{const a=(await be.get("/api/roles?type=client")).data;de.value=a.map(c=>({value:c.id,label:c.name}));const s=(await be.get("/api/roles?type=project")).data;ue.value=s.map(c=>({value:c.id,label:c.name}))}catch(t){console.error("Error fetching roles:",t)}},Se=async()=>{try{if(h.value){const t=await window.axios.get(`/api/projects/${h.value}/clients`);ke.value=t.data}else{const t=await window.axios.get("/api/clients");ke.value=t.data.data||t.data}}catch(t){console.error("Error fetching clients:",t),x.value="Failed to load clients."}},$e=async()=>{try{if(h.value){const t=await window.axios.get(`/api/projects/${h.value}/users`);ce.value=t.data}else{const t=await window.axios.get("/api/users");ce.value=t.data}}catch(t){console.error("Error fetching users:",t),x.value="Failed to load users."}},Je=te(()=>de.value.length>0?de.value:W.clientRoleOptions),We=te(()=>ue.value.length>0?ue.value:W.userRoleOptions),Ce=async t=>{try{const l=(await window.axios.get(`/api/projects/${t}/sections/basic`)).data;return e.name=l.name||"",e.description=l.description||"",e.website=l.website||"",e.social_media_link=l.social_media_link||"",e.preferred_keywords=l.preferred_keywords||"",e.google_chat_id=l.google_chat_id||"",e.status=l.status||"active",e.project_type=l.project_type||"",e.source=l.source||"",e.google_drive_link=l.google_drive_link||"",l}catch(a){return console.error("Error fetching basic project data:",a),x.value="Failed to fetch basic project data.",null}},Ue=async t=>{try{const l=(await window.axios.get(`/api/projects/${t}/sections/clients-users`)).data;return l.clients&&l.clients.length>0&&(e.client_ids=l.clients.map(s=>{var f;let c=((f=s.pivot)==null?void 0:f.role_id)||(de.value.length>0?de.value[0].value:1);return{id:s.id,role_id:c}})),l.users&&l.users.length>0&&(e.user_ids=l.users.map(s=>{var f;let c=((f=s.pivot)==null?void 0:f.role_id)||(ue.value.length>0?ue.value[0].value:2);return{id:s.id,role_id:c}})),l.contract_details!==void 0&&(e.contract_details=l.contract_details||""),l}catch(a){return console.error("Error fetching clients and users data:",a),x.value="Failed to fetch clients and users data.",null}},De=async t=>{try{const l=(await window.axios.get(`/api/projects/${t}/sections/services-payment`)).data;return e.services=l.services||[],e.service_details=l.service_details||[],e.total_amount=l.total_amount||"",e.payment_type=l.payment_type||"one_off",l}catch(a){return console.error("Error fetching services and payment data:",a),x.value="Failed to fetch services and payment data.",null}},Ie=async t=>{try{const l=(await window.axios.get(`/api/projects/${t}/sections/transactions`)).data;return e.transactions=l.map(s=>({description:s.description,amount:s.amount,user_id:s.user_id,hours_spent:s.hours_spent,type:s.type||"expense"})),l}catch(a){return console.error("Error fetching transactions data:",a),x.value="Failed to fetch transactions data.",null}},Pe=async t=>{try{const l=(await window.axios.get(`/api/projects/${t}/sections/documents`)).data;return e.documents=l.documents||[],l}catch(a){return console.error("Error fetching documents data:",a),x.value="Failed to fetch documents data.",null}},Re=async t=>{try{const l=(await window.axios.get(`/api/projects/${t}/sections/notes`)).data;return e.notes=l.map(s=>({content:s.content})),l}catch(a){return console.error("Error fetching notes data:",a),x.value="Failed to fetch notes data.",null}},Ge=async t=>{try{switch(await Ce(t),$.value){case"client":(E.value||z.value||q.value||H.value)&&await Ue(t);break;case"services":(v.value||S.value)&&await De(t);break;case"transactions":(G.value||Y.value)&&await Ie(t);break;case"documents":_.value&&await Pe(t);break;case"notes":(R.value||ae.value)&&await Re(t);break}}catch(a){console.error("Error fetching project data:",a),x.value="Failed to fetch project data."}};ze(()=>{Le(),Se(),$e(),h.value&&Ne(h.value).then(t=>{}).catch(t=>{})}),Z(h,(t,a)=>{t&&t!==a&&(Ne(t).then(l=>{}).catch(l=>{}),$e(),Se())});const we=he,p=b({}),x=b(""),F=b(!1),Ye=b(!1),ve=b(!1),pe=b(!1),K=b(""),fe=b(!1),_e=b(!1),X=b(""),e=rt({id:null,name:"",description:"",website:"",social_media_link:"",preferred_keywords:"",google_chat_id:"",logo:null,documents:[],client_ids:[],status:"active",project_type:"",services:[],service_details:[],source:"",total_amount:"",contract_details:"",google_drive_link:"",payment_type:"one_off",user_ids:[],transactions:[],notes:[]});Z(()=>W.show,t=>{t&&(e.client_ids||(e.client_ids=[]),e.user_ids||(e.user_ids=[]),e.id&&Ge(e.id))},{immediate:!0}),Z(()=>W.project,t=>{const a=e.id;e.id=t.id||null,a&&!e.id&&$.value==="documents"&&ee("basic"),e.name=t.name||"",e.description=t.description||"",e.website=t.website||"",e.social_media_link=t.social_media_link||"",e.preferred_keywords=t.preferred_keywords||"",e.google_chat_id=t.google_chat_id||"",e.logo=t.logo||null,e.documents=t.documents||[],e.client_ids=[],e.status=t.status||"active",e.project_type=t.project_type||"",e.services=t.services||[],e.service_details=t.service_details||[],e.source=t.source||"",e.total_amount=t.total_amount||"",e.contract_details=t.contract_details||"",e.google_drive_link=t.google_drive_link||"",e.payment_type=t.payment_type||"one_off",e.user_ids=[],e.transactions=t.transactions?t.transactions.map(l=>({description:l.description,amount:l.amount,user_id:l.user_id,hours_spent:l.hours_spent,type:l.type||"expense"})):[],e.notes=t.notes?t.notes.map(l=>({content:l.content})):[],p.value={},x.value=""},{immediate:!0});const He=async()=>{p.value={},x.value="";try{const t={name:e.name,description:e.description,website:e.website,social_media_link:e.social_media_link,preferred_keywords:e.preferred_keywords,google_chat_id:e.google_chat_id,status:e.status,project_type:e.project_type,source:e.source,google_drive_link:e.google_drive_link,user_ids:e.user_ids},a=e.logo;typeof a=="object"&&a!==null&&"name"in a&&delete t.logo;const l=await window.axios.post("/api/projects",t);e.id=l.data.id,typeof a=="object"&&a!==null&&"name"in a&&await Ae(a,e.id),we("submit",l.data)}catch(t){ye(t,"Failed to create project.")}},Ke=async()=>{p.value={},x.value="";try{const t={name:e.name,description:e.description,website:e.website,social_media_link:e.social_media_link,preferred_keywords:e.preferred_keywords,google_chat_id:e.google_chat_id,status:e.status,project_type:e.project_type,source:e.source,google_drive_link:e.google_drive_link},a=e.logo;typeof a=="object"&&a!==null&&"name"in a&&delete t.logo;const l=await window.axios.put(`/api/projects/${e.id}/sections/basic`,t);typeof a=="object"&&a!==null&&"name"in a&&await Ae(a,e.id),alert("Basic information updated successfully!")}catch(t){ye(t,"Failed to update basic information.")}},Xe=async()=>{p.value={},x.value="";try{const t={services:e.services,service_details:e.service_details,total_amount:e.total_amount,payment_type:e.payment_type},a=await window.axios.put(`/api/projects/${e.id}/sections/services-payment`,t);alert("Services and payment information updated successfully!")}catch(t){ye(t,"Failed to update services and payment information.")}},Qe=async()=>{p.value={},x.value="";try{const t={transactions:e.transactions};G.value||(t.transactions=t.transactions.filter(l=>l.type!=="expense")),Y.value||(t.transactions=t.transactions.filter(l=>l.type!=="income"));const a=await window.axios.put(`/api/projects/${e.id}/sections/transactions`,t);alert("Transactions updated successfully!")}catch(t){ye(t,"Failed to update transactions.")}},ye=(t,a)=>{t.response&&t.response.status===422?p.value=t.response.data.errors:t.response&&t.response.data.message?x.value=t.response.data.message:(x.value=a,console.error("Error:",t))},Ze=(t,a)=>{a?e.service_details.some(l=>l.service_id===t)||e.service_details.push({service_id:t,amount:"",frequency:"one_off",start_date:"",payment_breakdown:{first:30,second:30,third:40}}):e.service_details=e.service_details.filter(l=>l.service_id!==t)},C=t=>{let a=e.service_details.find(l=>l.service_id===t);return a||(a={service_id:t,amount:"",frequency:"one_off",start_date:"",payment_breakdown:{first:30,second:30,third:40}},e.service_details.push(a)),a},ge=b(!1),je=b({});Z(e,()=>{Object.keys(je.value).length>0&&(ge.value=!0)},{deep:!0}),Z(()=>W.show,t=>{t&&setTimeout(()=>{je.value=JSON.parse(JSON.stringify(e)),ge.value=!1},100)});const Fe=()=>{ge.value?confirm("You have unsaved changes. Are you sure you want to close this form?")&&we("close"):we("close")},Ae=async(t,a)=>{try{const l=new FormData;l.append("logo",t);const s=await window.axios.post(`/api/projects/${a}/logo`,l,{headers:{"Content-Type":"multipart/form-data"}});return s.data&&s.data.logo&&(e.logo=s.data.logo),s}catch(l){console.error("Error uploading logo:",l)}},et=async()=>{if(!e.id){K.value="Please save the project first before saving clients.";return}if(!e.client_ids||e.client_ids.length===0){K.value="Please select at least one client to save.";return}ve.value=!0,pe.value=!1,K.value="";try{const t=await window.axios.post(`/api/projects/${e.id}/attach-clients`,{client_ids:e.client_ids});pe.value=!0,setTimeout(()=>{pe.value=!1},3e3)}catch(t){t.response&&t.response.status===422?K.value="Validation error. Please check your input.":t.response&&t.response.data.message?K.value=t.response.data.message:(K.value="Failed to save clients.",console.error("Error saving clients:",t))}finally{ve.value=!1}},tt=async()=>{if(console.log("saveUsers called, projectForm.user_ids:",e.user_ids),!e.id){X.value="Please save the project first before saving users.";return}if(!e.user_ids||e.user_ids.length===0){console.log("No users selected, projectForm.user_ids is empty or null"),X.value="Please select at least one user to save.";return}fe.value=!0,_e.value=!1,X.value="";try{console.log("Sending user_ids to API:",JSON.stringify(e.user_ids));const t=await window.axios.post(`/api/projects/${e.id}/attach-users`,{user_ids:e.user_ids});_e.value=!0,setTimeout(()=>{_e.value=!1},3e3)}catch(t){t.response&&t.response.status===422?X.value="Validation error. Please check your input.":t.response&&t.response.data.message?X.value=t.response.data.message:(X.value="Failed to save users.",console.error("Error saving users:",t))}finally{fe.value=!1}},st=async()=>{if(!e.id){x.value="Please save the project first before uploading documents.";return}if(!e.documents||!e.documents.some(t=>typeof t=="object"&&t!==null&&"name"in t&&"size"in t&&"type"in t)){x.value="Please select documents to upload.";return}try{const t=new FormData;e.documents.filter(c=>typeof c=="object"&&c!==null&&"name"in c&&"size"in c&&"type"in c).forEach((c,f)=>{t.append(`documents[${f}]`,c)});const l=await window.axios.post(`/api/projects/${e.id}/documents`,t,{headers:{"Content-Type":"multipart/form-data"}});e.documents=l.data.documents||[],document.getElementById("documents").value="",alert("Documents uploaded successfully!");const s=JSON.parse(JSON.stringify(e));je.value=s,ge.value=!1}catch(t){t.response&&t.response.status===422?p.value=t.response.data.errors:t.response&&t.response.data.message?x.value=t.response.data.message:(x.value="Failed to upload documents.",console.error("Error uploading documents:",t))}};return(t,a)=>{var l;return n(),i("div",ht,[o("div",xt,[o("h2",kt,y(e.id?"Edit Project":"Create New Project"),1),o("button",{onClick:Fe,class:"text-gray-400 hover:text-gray-500"},a[22]||(a[22]=[o("svg",{class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),x.value?(n(),i("div",wt,y(x.value),1)):u("",!0),h.value?(n(),i("div",jt,[Ye.value?(n(),i("div",Vt,[o("div",St,"Project ID: "+y(h.value),1),o("div",null,y(r(g)?"Project Role: "+(((l=r(g).value)==null?void 0:l.name)||"None"):"No Project Role"),1),o("div",$t,[a[24]||(a[24]=o("div",{class:"font-semibold"},"Project Permissions:",-1)),r(re)?(n(),i("div",Ct,"Loading project permissions...")):r(se)?(n(),i("div",Ut,"Error loading project permissions")):r(V)?(n(),i("div",Dt,[L(" Count: "+y(r(V).permissions?r(V).permissions.length:0)+" ",1),r(V).permissions&&r(V).permissions.length>0?(n(),i("div",It,[a[23]||(a[23]=o("div",{class:"font-semibold"},"Permissions:",-1)),o("ul",Pt,[(n(!0),i(O,null,T(r(V).permissions.slice(0,5),s=>(n(),i("li",{key:s.slug},y(s.name)+" ("+y(s.source)+") ",1))),128)),r(V).permissions.length>5?(n(),i("li",Rt," ... and "+y(r(V).permissions.length-5)+" more ",1)):u("",!0)])])):u("",!0)])):u("",!0)]),o("div",Ft,"Can manage projects: "+y(r(I)?"Yes":"No"),1)])):u("",!0)])):u("",!0),o("div",At,[o("nav",Ot,[r(I)?(n(),i("button",{key:0,onClick:a[0]||(a[0]=s=>ee("basic")),class:oe(["py-2 px-4 text-center border-b-2 font-medium text-sm",$.value==="basic"?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"])}," Basic Information ",2)):u("",!0),r(E)||r(q)?(n(),i("button",{key:1,onClick:a[1]||(a[1]=s=>ee("client")),class:oe(["py-2 px-4 text-center border-b-2 font-medium text-sm",$.value==="client"?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"])}," Clients and Users ",2)):u("",!0),e.id&&(r(S)||r(v))?(n(),i("button",{key:2,onClick:a[2]||(a[2]=s=>ee("services")),class:oe(["py-2 px-4 text-center border-b-2 font-medium text-sm",$.value==="services"?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"])}," Services & Payment ",2)):u("",!0),e.id&&r(xe)?(n(),i("button",{key:3,onClick:a[3]||(a[3]=s=>ee("transactions")),class:oe(["py-2 px-4 text-center border-b-2 font-medium text-sm",$.value==="transactions"?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"])}," Transactions ",2)):u("",!0),e.id&&r(_)?(n(),i("button",{key:4,onClick:a[4]||(a[4]=s=>ee("documents")),class:oe(["py-2 px-4 text-center border-b-2 font-medium text-sm",$.value==="documents"?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"])}," Documents ",2)):u("",!0),e.id&&(r(ae)||r(R))?(n(),i("button",{key:5,onClick:a[5]||(a[5]=s=>ee("notes")),class:oe(["py-2 px-4 text-center border-b-2 font-medium text-sm",$.value==="notes"?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"])}," Notes ",2)):u("",!0)])]),o("form",{onSubmit:a[21]||(a[21]=it(()=>{},["prevent"]))},[$.value==="basic"?(n(),i("div",Tt,[o("div",Et,[d(k,{for:"name",value:"Project Name"}),d(A,{id:"name",type:"text",class:"mt-1 block w-full",modelValue:e.name,"onUpdate:modelValue":a[6]||(a[6]=s=>e.name=s),required:"",autofocus:"",disabled:!r(I)},null,8,["modelValue","disabled"]),d(P,{message:p.value.name?p.value.name[0]:"",class:"mt-2"},null,8,["message"])]),o("div",Nt,[d(k,{for:"description",value:"Description"}),J(o("textarea",{id:"description",class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full","onUpdate:modelValue":a[7]||(a[7]=s=>e.description=s),disabled:!r(I)},null,8,Bt),[[Ve,e.description]]),d(P,{message:p.value.description?p.value.description[0]:"",class:"mt-2"},null,8,["message"])]),o("div",Mt,[d(k,{for:"website",value:"Website"}),d(A,{id:"website",type:"url",class:"mt-1 block w-full",modelValue:e.website,"onUpdate:modelValue":a[8]||(a[8]=s=>e.website=s),disabled:!r(I)},null,8,["modelValue","disabled"]),d(P,{message:p.value.website?p.value.website[0]:"",class:"mt-2"},null,8,["message"])]),o("div",qt,[d(k,{for:"preferred_keywords",value:"Client Preferred Keywords"}),d(A,{id:"preferred_keywords",type:"text",class:"mt-1 block w-full",modelValue:e.preferred_keywords,"onUpdate:modelValue":a[9]||(a[9]=s=>e.preferred_keywords=s),disabled:!r(I)},null,8,["modelValue","disabled"]),d(P,{message:p.value.preferred_keywords?p.value.preferred_keywords[0]:"",class:"mt-2"},null,8,["message"])]),o("div",zt,[d(k,{for:"status",value:"Status"}),J(o("select",{id:"status",class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full","onUpdate:modelValue":a[10]||(a[10]=s=>e.status=s),required:"",disabled:!r(I)},[(n(!0),i(O,null,T(w.statusOptions,s=>(n(),i("option",{key:s.value,value:s.value},y(s.label),9,Jt))),128))],8,Lt),[[le,e.status]]),d(P,{message:p.value.status?p.value.status[0]:"",class:"mt-2"},null,8,["message"])]),o("div",Wt,[d(k,{for:"source",value:"Source"}),J(o("select",{id:"source",class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full","onUpdate:modelValue":a[11]||(a[11]=s=>e.source=s),disabled:!r(I)},[a[25]||(a[25]=o("option",{value:"",disabled:""},"Select a Source",-1)),(n(!0),i(O,null,T(w.sourceOptions,s=>(n(),i("option",{key:s.value,value:s.value},y(s.label),9,Yt))),128))],8,Gt),[[le,e.source]]),d(P,{message:p.value.source?p.value.source[0]:"",class:"mt-2"},null,8,["message"])]),r(I)?(n(),i("div",Ht,[e.id&&r(m)||!e.id?(n(),Be(ne,{key:0,onClick:a[12]||(a[12]=s=>e.id?Ke():He()),disabled:!r(I)},{default:Q(()=>[L(y(e.id?"Update Basic Information":"Create Project"),1)]),_:1},8,["disabled"])):u("",!0)])):u("",!0)])):u("",!0),$.value==="client"?(n(),i("div",Kt,[r(E)?(n(),i("div",Xt,[d(qe,{label:"Clients",items:ke.value,selectedItems:e.client_ids,"onUpdate:selectedItems":a[13]||(a[13]=s=>e.client_ids=s),roleOptions:Je.value,roleType:"client",error:p.value.client_ids?p.value.client_ids[0]:"",placeholder:"Select a client to add",disabled:!r(z),readonly:!r(z)&&r(E),showRemoveButton:r(z)},null,8,["items","selectedItems","roleOptions","error","disabled","readonly","showRemoveButton"]),r(z)?(n(),i("div",Qt,[d(ne,{onClick:et,disabled:ve.value},{default:Q(()=>[L(y(ve.value?"Saving...":"Save Clients"),1)]),_:1},8,["disabled"])])):u("",!0),pe.value?(n(),i("div",Zt," Clients saved successfully! ")):u("",!0),K.value?(n(),i("div",es,y(K.value),1)):u("",!0)])):u("",!0),o("div",ts,[d(k,{for:"contract_details",value:"Contract Details"}),J(o("textarea",{id:"contract_details",class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full","onUpdate:modelValue":a[14]||(a[14]=s=>e.contract_details=s),disabled:!r(I)},null,8,ss),[[Ve,e.contract_details]]),d(P,{message:p.value.contract_details?p.value.contract_details[0]:"",class:"mt-2"},null,8,["message"])]),r(q)?(n(),i("div",as,[d(qe,{label:"Assign Users",items:ce.value,selectedItems:e.user_ids,"onUpdate:selectedItems":a[15]||(a[15]=s=>e.user_ids=s),roleOptions:We.value,roleType:"project",defaultRoleId:2,error:p.value.user_ids?p.value.user_ids[0]:"",placeholder:"Select a user to add",disabled:!r(H),readonly:!r(H)&&r(q),showRemoveButton:r(H)},null,8,["items","selectedItems","roleOptions","error","disabled","readonly","showRemoveButton"]),r(H)?(n(),i("div",os,[d(ne,{onClick:tt,disabled:fe.value},{default:Q(()=>[L(y(fe.value?"Saving...":"Save Users"),1)]),_:1},8,["disabled"])])):u("",!0),_e.value?(n(),i("div",ls," Users saved successfully! ")):u("",!0),X.value?(n(),i("div",ns,y(X.value),1)):u("",!0)])):u("",!0)])):u("",!0),$.value==="services"?(n(),i("div",rs,[o("div",is,[d(k,{for:"total_amount",value:"Total Amount"}),d(A,{id:"total_amount",type:"number",step:"0.01",class:"mt-1 block w-full",modelValue:e.total_amount,"onUpdate:modelValue":a[16]||(a[16]=s=>e.total_amount=s),disabled:!r(S)},null,8,["modelValue","disabled"]),d(P,{message:p.value.total_amount?p.value.total_amount[0]:"",class:"mt-2"},null,8,["message"])]),o("div",ds,[d(k,{for:"payment_type",value:"Payment Type"}),J(o("select",{id:"payment_type",class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full","onUpdate:modelValue":a[17]||(a[17]=s=>e.payment_type=s),required:"",disabled:!r(S)},[(n(!0),i(O,null,T(w.paymentTypeOptions,s=>(n(),i("option",{key:s.value,value:s.value},y(s.label),9,cs))),128))],8,us),[[le,e.payment_type]]),d(P,{message:p.value.payment_type?p.value.payment_type[0]:"",class:"mt-2"},null,8,["message"])]),o("div",ms,[d(k,{for:"services",value:"Services"}),o("div",vs,[(n(!0),i(O,null,T(w.departmentOptions,s=>{var c,f,U,Oe,Te,Ee;return n(),i("div",{key:s.value,class:"border p-3 mb-3 rounded"},[o("div",ps,[d(dt,{id:`service_${s.value}`,value:s.value,checked:e.services,"onUpdate:checked":[a[18]||(a[18]=D=>e.services=D),D=>Ze(s.value,D)],disabled:!r(S)},null,8,["id","value","checked","onUpdate:checked","disabled"]),o("label",{for:`service_${s.value}`,class:"ms-2 text-sm font-medium text-gray-700"},y(s.label),9,fs)]),(e.services||[]).includes(s.value)?(n(),i("div",_s,[o("div",ys,[o("div",null,[d(k,{for:`service_amount_${s.value}`,value:"Amount",class:"text-xs"},null,8,["for"]),d(A,{id:`service_amount_${s.value}`,type:"number",step:"0.01",placeholder:"Amount",class:"w-full",modelValue:C(s.value).amount,"onUpdate:modelValue":D=>C(s.value).amount=D,disabled:!r(S)},null,8,["id","modelValue","onUpdate:modelValue","disabled"])]),o("div",null,[d(k,{for:`service_frequency_${s.value}`,value:"Frequency",class:"text-xs"},null,8,["for"]),J(o("select",{id:`service_frequency_${s.value}`,class:"border-gray-300 rounded-md w-full","onUpdate:modelValue":D=>C(s.value).frequency=D,disabled:!r(S)},a[26]||(a[26]=[o("option",{value:"monthly"},"Monthly",-1),o("option",{value:"one_off"},"One off",-1)]),8,gs),[[le,C(s.value).frequency]])])]),o("div",bs,[d(k,{for:`service_start_date_${s.value}`,value:"Start Date",class:"text-xs"},null,8,["for"]),d(A,{id:`service_start_date_${s.value}`,type:"date",class:"w-full",modelValue:C(s.value).start_date,"onUpdate:modelValue":D=>C(s.value).start_date=D,disabled:!r(S)},null,8,["id","modelValue","onUpdate:modelValue","disabled"])]),o("div",null,[d(k,{value:"Payment Breakdown (%)",class:"text-xs mb-1"}),o("div",hs,[o("div",null,[d(k,{for:`service_payment_first_${s.value}`,value:"First",class:"text-xs"},null,8,["for"]),d(A,{id:`service_payment_first_${s.value}`,type:"text",min:"0",max:"100",class:"w-full",value:((c=C(s.value).payment_breakdown)==null?void 0:c.first)||0,onInput:D=>{if(r(S)){const N=C(s.value);N.payment_breakdown||(N.payment_breakdown={}),N.payment_breakdown.first=D.target.value}},disabled:!r(S)},null,8,["id","value","onInput","disabled"])]),o("div",null,[d(k,{for:`service_payment_second_${s.value}`,value:"Second",class:"text-xs"},null,8,["for"]),d(A,{id:`service_payment_second_${s.value}`,type:"text",min:"0",max:"100",class:"w-full",value:((f=C(s.value).payment_breakdown)==null?void 0:f.second)||0,onInput:D=>{if(r(S)){const N=C(s.value);N.payment_breakdown||(N.payment_breakdown={}),N.payment_breakdown.second=D.target.value}},disabled:!r(S)},null,8,["id","value","onInput","disabled"])]),o("div",null,[d(k,{for:`service_payment_third_${s.value}`,value:"Third",class:"text-xs"},null,8,["for"]),d(A,{id:`service_payment_third_${s.value}`,type:"text",min:"0",max:"100",class:"w-full",value:((U=C(s.value).payment_breakdown)==null?void 0:U.third)||0,onInput:D=>{if(r(S)){const N=C(s.value);N.payment_breakdown||(N.payment_breakdown={}),N.payment_breakdown.third=D.target.value}},disabled:!r(S)},null,8,["id","value","onInput","disabled"])])]),o("div",xs," Total: "+y(parseInt(((Oe=C(s.value).payment_breakdown)==null?void 0:Oe.first)||0)+parseInt(((Te=C(s.value).payment_breakdown)==null?void 0:Te.second)||0)+parseInt(((Ee=C(s.value).payment_breakdown)==null?void 0:Ee.third)||0))+"% ",1)])])):u("",!0)])}),128))]),d(P,{message:p.value.services?p.value.services[0]:"",class:"mt-2"},null,8,["message"])]),r(S)?(n(),i("div",ks,[d(ne,{onClick:Xe,disabled:!e.id||!r(S)},{default:Q(()=>a[27]||(a[27]=[L(" Update Services & Payment ")])),_:1,__:[27]},8,["disabled"])])):u("",!0)])):u("",!0),$.value==="transactions"&&r(xe)?(n(),i("div",ws,[o("div",js,[o("div",Vs,[a[28]||(a[28]=o("h3",{class:"text-lg font-medium"},"Transactions",-1)),o("div",Ss,[o("div",$s," Total Income: $"+y(e.transactions.filter(s=>s.type==="income").reduce((s,c)=>s+(parseFloat(c.amount)||0),0).toFixed(2)),1),o("div",Cs," Total Expenses: $"+y(e.transactions.filter(s=>s.type==="expense").reduce((s,c)=>s+(parseFloat(c.amount)||0),0).toFixed(2)),1),o("div",Us," Net: $"+y((e.transactions.filter(s=>s.type==="income").reduce((s,c)=>s+(parseFloat(c.amount)||0),0)-e.transactions.filter(s=>s.type==="expense").reduce((s,c)=>s+(parseFloat(c.amount)||0),0)).toFixed(2)),1)])]),r(xe)?(n(),i("div",Ds,[(n(!0),i(O,null,T(e.transactions,(s,c)=>(n(),i("div",{key:c,class:"flex items-center mb-2 p-2 border rounded"},[J(o("select",{"onUpdate:modelValue":f=>s.type=f,class:"mr-2 border-gray-300 rounded-md"},[r(Y)?(n(),i("option",Ps,"Income")):u("",!0),r(G)?(n(),i("option",Rs,"Expense")):u("",!0)],8,Is),[[le,s.type]]),d(A,{modelValue:s.description,"onUpdate:modelValue":f=>s.description=f,placeholder:"Description",class:"mr-2 flex-grow"},null,8,["modelValue","onUpdate:modelValue"]),d(A,{modelValue:s.amount,"onUpdate:modelValue":f=>s.amount=f,modelModifiers:{number:!0},type:"number",step:"0.01",placeholder:"Amount",class:"mr-2 w-24"},null,8,["modelValue","onUpdate:modelValue"]),s.type==="expense"?J((n(),i("select",{key:0,"onUpdate:modelValue":f=>s.user_id=f,class:"mr-2 border-gray-300 rounded-md"},[a[29]||(a[29]=o("option",{value:"",disabled:""},"Select User (Optional)",-1)),(n(!0),i(O,null,T(Array.isArray(ce.value)?ce.value.filter(f=>e.user_ids.some(U=>U.id===f.id)):[],f=>(n(),i("option",{key:f.id,value:f.id},y(f.name),9,As))),128))],8,Fs)),[[le,s.user_id]]):u("",!0),s.type==="expense"?(n(),Be(A,{key:1,modelValue:s.hours_spent,"onUpdate:modelValue":f=>s.hours_spent=f,modelModifiers:{number:!0},type:"number",step:"0.01",placeholder:"Hours",class:"mr-2 w-20"},null,8,["modelValue","onUpdate:modelValue"])):u("",!0),o("button",{type:"button",class:"text-red-600",onClick:f=>e.transactions.splice(c,1)}," Remove ",8,Os)]))),128)),o("div",Ts,[d(Me,{onClick:a[19]||(a[19]=s=>e.transactions.push({description:"",amount:"",user_id:null,hours_spent:"",type:"expense"}))},{default:Q(()=>a[30]||(a[30]=[L(" Add Transaction ")])),_:1,__:[30]})])])):u("",!0),d(P,{message:p.value.transactions?p.value.transactions[0]:"",class:"mt-2"},null,8,["message"])]),r(G)||r(Y)?(n(),i("div",Es,[d(ne,{onClick:Qe,disabled:!e.id||!r(G)&&!r(Y)},{default:Q(()=>a[31]||(a[31]=[L(" Update Transactions ")])),_:1,__:[31]},8,["disabled"])])):u("",!0)])):u("",!0),$.value==="documents"?(n(),i("div",Ns,[o("div",Bs,[d(k,{value:"Project Documents"}),o("div",Ms,[r(me)?(n(),i("div",qs,[d(k,{for:"documents",value:"Upload Documents"}),o("input",{type:"file",id:"documents",onChange:a[20]||(a[20]=s=>{const c=Array.from(s.target.files);if(c.length>0){const f=Array.isArray(e.documents)?e.documents.filter(U=>typeof U=="object"&&"path"in U):[];e.documents=[...f,...c],console.log("Files selected:",c),console.log("Are files File objects?",c.some(U=>typeof U=="object"&&U!==null&&"name"in U&&"size"in U&&"type"in U)),console.log("Updated documents array:",e.documents)}}),class:"mt-1 block w-full",multiple:"",accept:".pdf,.doc,.docx,.jpg,.png"},null,32),a[33]||(a[33]=o("p",{class:"text-sm text-gray-500 mt-1"},"Supported formats: PDF, DOC, DOCX, JPG, PNG",-1)),d(P,{message:p.value.documents?p.value.documents[0]:"",class:"mt-2"},null,8,["message"]),o("div",zs,[d(ne,{type:"button",onClick:st,disabled:!e.id||!e.documents||!e.documents.some(s=>typeof s=="object"&&s!==null&&"name"in s&&"size"in s&&"type"in s)},{default:Q(()=>a[32]||(a[32]=[L(" Upload Documents ")])),_:1,__:[32]},8,["disabled"]),e.id?u("",!0):(n(),i("p",Ls," Please save the project first before uploading documents. "))])])):u("",!0),e.documents&&e.documents.length>0&&typeof e.documents[0]=="object"&&"path"in e.documents[0]?(n(),i("div",Js,[a[34]||(a[34]=o("h3",{class:"font-medium text-gray-700 mb-2"},"Existing Documents",-1)),(n(!0),i(O,null,T(e.documents,(s,c)=>(n(),i("div",{key:c,class:"flex items-center mb-2 p-2 border rounded"},[o("div",Ws,[o("a",{href:"/storage/"+s.path,target:"_blank",class:"text-blue-600 hover:underline"},y(s.filename),9,Gs)]),r(me).value?(n(),i("button",{key:0,type:"button",class:"ml-2 text-red-600",onClick:()=>{e.documents=e.documents.filter((f,U)=>U!==c)}}," Remove ",8,Ys)):u("",!0)]))),128))])):u("",!0),a[35]||(a[35]=o("div",{class:"mt-4"},[o("p",{class:"text-sm text-gray-500"}," Documents will be uploaded to the project's Google Drive folder. ")],-1))])])])):u("",!0),$.value==="notes"?(n(),i("div",Hs,[o("div",Ks,[d(k,{value:"Notes"}),o("div",Xs,[(n(!0),i(O,null,T(e.notes,(s,c)=>(n(),i("div",{key:c,class:"mb-4"},[o("div",Qs,[J(o("textarea",{"onUpdate:modelValue":f=>s.content=f,readonly:!r(ae),placeholder:"Note Content",class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full h-32"},null,8,Zs),[[Ve,s.content]])])]))),128))]),d(P,{message:p.value.notes?p.value.notes[0]:"",class:"mt-2"},null,8,["message"])])])):u("",!0),o("div",ea,[d(Me,{onClick:Fe},{default:Q(()=>a[36]||(a[36]=[L("Close")])),_:1,__:[36]})])],32)])}}};export{ra as _};
