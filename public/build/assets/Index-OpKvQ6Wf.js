import{a as r,o,b as a,c as m,i as f,g as x,S as B,t as b,d as n,u as v,j as F,I as L,r as R,q as T,f as O,aL as z,e as Z,h as q,w,ak as G,F as S,l as W,m as J,p as K}from"./app-BIPU-Uat.js";import{k as Q,l as U,R as X,_ as Y}from"./AuthenticatedLayout-BWGqt6KM.js";import ee from"./EmailFilters-DC9im-UC.js";import te from"./EmailList-3fj5-nyt.js";import{_ as ie,f as ae,m as oe}from"./EmailDetailsContent-DgT9wivM.js";import re from"./ComposeEmailContent-CSc9L5aC.js";import se from"./EmailActionContent-x5MEYHxN.js";import ne from"./ReceivedEmailActionContent-DxJduQEQ.js";import{a as le,b as de,r as ce}from"./XCircleIcon-CFtAPgS7.js";import{r as me,a as ue}from"./PaperAirplaneIcon-C49Z1Cd1.js";import{r as pe}from"./ListBulletIcon-DRLkygAm.js";import"./PrimaryButton-DRXirCJT.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./Modal-D8bbTMmL.js";import"./InputLabel-5rXZ8WWE.js";import"./InputError-BKgmVaJx.js";import"./SecondaryButton-DRBhupvZ.js";import"./TextInput-DJbAUKGQ.js";import"./SelectDropdown-DZfTXT1j.js";/* empty css                                                                       */import"./Checkbox-CKBKGX0j.js";import"./ApplicationLogo-DnGSfiF8.js";import"./DangerButton-DGmWpsAt.js";import"./moment-BLMuvzoS.js";import"./EmailAttachmentsList-B1KvKa-B.js";import"./TrashIcon-Bl4JpgAD.js";import"./TaskCreationForm-Q3wqguoI.js";import"./CustomMultiSelect-R5iQi33j.js";import"./EmailEditor.vue_vue_type_style_index_0_lang-7-Qv3xqI.js";import"./EmailEditor-DfyBQ93U.js";function fe(l,e){return o(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M10.5 6h9.75M10.5 6a1.5 1.5 0 1 1-3 0m3 0a1.5 1.5 0 1 0-3 0M3.75 6H7.5m3 12h9.75m-9.75 0a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m-3.75 0H7.5m9-6h3.75m-3.75 0a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m-9.75 0h9.75"})])}function ge(l,e){return o(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15.75 19.5 8.25 12l7.5-7.5"})])}function he(l,e){return o(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m8.25 4.5 7.5 7.5-7.5 7.5"})])}function ve(l,e){return o(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"})])}function be(l,e){return o(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M11.48 3.499a.562.562 0 0 1 1.04 0l2.125 5.111a.563.563 0 0 0 .475.345l5.518.442c.499.04.701.663.321.988l-4.204 3.602a.563.563 0 0 0-.182.557l1.285 5.385a.562.562 0 0 1-.84.61l-4.725-2.885a.562.562 0 0 0-.586 0L6.982 20.54a.562.562 0 0 1-.84-.61l1.285-5.386a.562.562 0 0 0-.182-.557l-4.204-3.602a.562.562 0 0 1 .321-.988l5.518-.442a.563.563 0 0 0 .475-.345L11.48 3.5Z"})])}const we={class:"flex items-center"},xe={class:"flex-1"},ye={key:0,class:"font-bold"},_e={class:"text-sm"},ke={__name:"Notification",props:{notification:Object},emits:["close"],setup(l,{emit:e}){const c=l,u=m(()=>{var d;switch((d=c.notification)==null?void 0:d.type){case"success":return"bg-green-100 text-green-700 border-green-200";case"error":return"bg-red-100 text-red-700 border-red-200";case"warning":return"bg-yellow-100 text-yellow-700 border-yellow-200";default:return"bg-gray-100 text-gray-700 border-gray-200"}}),g=m(()=>{var d;switch((d=c.notification)==null?void 0:d.type){case"success":return ce;case"error":return de;case"warning":return Q;default:return le}});return(h,d)=>l.notification&&l.notification.message?(o(),r("div",{key:0,class:F(["fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 mx-auto mt-4 max-w-sm rounded-md border p-4 shadow-lg transition-all duration-300 ease-out z-[9999]",u.value]),role:"alert","aria-live":"polite"},[a("div",we,[(o(),x(B(g.value),{class:"h-6 w-6 mr-3 flex-shrink-0"})),a("div",xe,[l.notification.title?(o(),r("h4",ye,b(l.notification.title),1)):f("",!0),a("p",_e,b(l.notification.message),1)]),a("button",{onClick:d[0]||(d[0]=E=>h.$emit("close")),class:"ml-auto -mr-1.5 p-1 rounded-md hover:bg-opacity-50","aria-label":"Close notification"},[n(v(U),{class:"h-5 w-5"})])])],2)):f("",!0)}},Ee={class:"flex justify-between items-center"},$e={class:"py-12"},Ce={class:"max-w-8xl mx-auto sm:px-6 lg:px-8 h-[calc(100vh-200px)]"},je={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg h-full flex"},Re={key:0,class:"w-64 p-4 border-r border-gray-200 overflow-y-auto transform"},Se={class:"flex-1 overflow-y-auto"},Be={class:"flex items-center justify-start p-6 space-x-4"},Fe=["onClick"],Ae={key:0,class:"ml-2 px-2 py-0.5 text-xs font-semibold rounded-full bg-white text-gray-800"},Ie={class:"hidden sm:inline"},Ne={class:"p-6"},De={key:0},Me={key:1},Pe={key:2},He={key:3},gt={__name:"Index",setup(l){const e=L({sidebar:{show:!1,title:"",mode:null,loading:!1,data:null},filters:{type:"new",status:"",startDate:"",endDate:"",search:"",projectId:null,senderId:""},emails:[],loadingEmails:!1,emailError:null,pagination:{},counts:{new:0,"waiting-approval":0,sent:0,received:0,all:0}}),c=R(!1),u=R(null),{canDo:g}=T();m(()=>g("view_emails").value),m(()=>g("approve_emails").value);const h=m(()=>g("compose_emails").value),d=m(()=>[{type:"new",label:"New Emails",icon:be},{type:"waiting-approval",label:"Waiting Approval",icon:ve},{type:"sent",label:"Sent",icon:me},{type:"received",label:"Received",icon:ue},{type:"all",label:"All Emails",icon:pe}]),E=m(()=>{var t;return e.sidebar.mode==="view-email"?((t=e.sidebar.data)==null?void 0:t.subject)||"Email Details":e.sidebar.mode==="compose"?"Compose New Email":e.sidebar.mode==="edit"?"Edit & Approve Email":e.sidebar.mode==="reject"?"Reject Email":e.sidebar.mode==="received-edit"?"Approve Received Email":"Inbox"}),y=async()=>{try{const t=await K.get("/api/inbox/counts");e.counts={...e.counts,"waiting-approval":t.data["waiting-approval"],received:t.data.received}}catch(t){console.error("Failed to fetch email counts:",t)}},A=()=>{e.sidebar.show=!0,e.sidebar.title="Compose New Email",e.sidebar.mode="compose",e.sidebar.data=null},I=async t=>{e.sidebar.loading=!0,e.sidebar.show=!0,e.sidebar.title="Email Details",e.sidebar.mode="view-email",e.sidebar.data=t;try{await oe(t.id)}catch(i){console.error("Failed to mark email as read:",i)}finally{e.sidebar.loading=!1,p(),y()}},p=async(t=1)=>{e.loadingEmails=!0,e.emailError=null;try{const i=await ae(e.filters,t);e.emails=i.data,e.pagination={currentPage:i.current_page,lastPage:i.last_page,total:i.total},e.counts[e.filters.type]=i.total}catch(i){console.error("Error fetching emails:",i),e.emailError="Failed to load emails. Please try again."}finally{e.loadingEmails=!1}},N=t=>{p(t)},D=t=>{Object.assign(e.filters,t)},M=t=>{e.filters.type=t,t==="all"&&(e.filters.status="",e.filters.startDate="",e.filters.endDate="",e.filters.search="",e.filters.projectId=null,e.filters.senderId=""),t!=="waiting-approval"&&t!=="received"&&(e.counts[t]=0)},P=t=>{u.value=t,setTimeout(()=>{u.value=null},5e3)};O(()=>{z().fetchGlobalPermissions(),y()});const H=t=>{e.sidebar.show=!0,e.sidebar.data=t,t.type==="received"&&(t.status==="pending_approval_received"||t.status==="received")?(e.sidebar.mode="received-edit",e.sidebar.title="Approve Received Email"):(e.sidebar.mode="edit",e.sidebar.title="Edit & Approve Email")},V=t=>{e.sidebar.show=!0,e.sidebar.title="Reject Email",e.sidebar.mode="reject",e.sidebar.data=t},_=()=>{e.sidebar.show=!1,p(),y()};let $=null;return Z(()=>e.filters,()=>{clearTimeout($),$=setTimeout(()=>{p(1)},500)},{deep:!0,immediate:!0}),(t,i)=>(o(),r(S,null,[n(v(q),{title:"Inbox"}),n(Y,null,{header:w(()=>[a("div",Ee,[i[6]||(i[6]=a("h2",{class:"font-semibold text-xl text-gray-800 leading-tight"}," Inbox ",-1)),h.value?(o(),r("button",{key:0,onClick:A,class:"inline-flex items-center px-4 py-2 bg-indigo-600 border border-transparent rounded-md font-semibold text-xs text-white uppercase tracking-widest hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-25 transition"},i[5]||(i[5]=[a("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})],-1),J(" Compose Email ",-1)]))):f("",!0)])]),default:w(()=>[a("div",$e,[a("div",Ce,[a("div",je,[n(G,{"enter-active-class":"transition-all duration-300 ease-out","leave-active-class":"transition-all duration-300 ease-in","enter-from-class":"-translate-x-full opacity-0","leave-to-class":"-translate-x-full opacity-0"},{default:w(()=>[c.value?(o(),r("div",Re,[i[7]||(i[7]=a("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"Advanced Filters",-1)),n(ee,{"initial-filters":e.filters,onChange:D},null,8,["initial-filters"])])):f("",!0)]),_:1}),a("div",Se,[a("div",Be,[(o(!0),r(S,null,W(d.value,s=>(o(),r("button",{key:s.type,onClick:k=>M(s.type),class:F({"px-4 py-2 rounded-md font-medium text-sm transition-colors flex items-center space-x-2":!0,"text-white bg-indigo-600 hover:bg-indigo-700":e.filters.type===s.type,"text-gray-700 bg-white border border-gray-300 hover:bg-gray-100":e.filters.type!==s.type})},[(o(),x(B(s.icon),{class:"h-5 w-5"})),a("span",null,b(s.label),1),e.counts[s.type]>0?(o(),r("span",Ae,b(e.counts[s.type]),1)):f("",!0)],10,Fe))),128)),a("button",{onClick:i[0]||(i[0]=s=>c.value=!c.value),class:"px-4 py-2 rounded-md font-medium text-sm text-gray-700 bg-white border border-gray-300 hover:bg-gray-100 transition-colors flex items-center space-x-2"},[n(v(fe),{class:"h-5 w-5"}),a("span",Ie,b(c.value?"Hide Filters":"Show Filters"),1),c.value?(o(),x(v(ge),{key:1,class:"h-4 w-4"})):(o(),x(v(he),{key:0,class:"h-4 w-4"}))]),a("button",{onClick:i[1]||(i[1]=s=>p(1)),class:"px-4 py-2 rounded-md font-medium text-sm text-gray-700 bg-white border border-gray-300 hover:bg-gray-100 transition-colors flex items-center space-x-2"},i[8]||(i[8]=[a("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1),a("span",{class:"hidden sm:inline"},"Refresh",-1)]))]),a("div",Ne,[n(te,{emails:e.emails,loading:e.loadingEmails,error:e.emailError,pagination:e.pagination,onViewEmail:I,onChangePage:N,onRefresh:p,onShowNotification:P},null,8,["emails","loading","error","pagination"])])]),n(X,{show:e.sidebar.show,title:E.value,onClose:i[3]||(i[3]=s=>e.sidebar.show=!1),loading:e.sidebar.loading},{content:w(()=>{var s,k,C,j;return[e.sidebar.mode==="view-email"?(o(),r("div",De,[n(ie,{email:e.sidebar.data,"can-approve-emails":(s=e.sidebar.data)==null?void 0:s.can_approve,onEdit:H,onReject:V},null,8,["email","can-approve-emails"])])):e.sidebar.mode==="compose"?(o(),r("div",Me,[n(re,{"project-id":(j=(C=(k=e.sidebar.data)==null?void 0:k.conversation)==null?void 0:C.project)==null?void 0:j.id,onSubmitted:_},null,8,["project-id"])])):e.sidebar.mode==="edit"||e.sidebar.mode==="reject"?(o(),r("div",Pe,[n(se,{email:e.sidebar.data,mode:e.sidebar.mode,onSubmitted:_},null,8,["email","mode"])])):e.sidebar.mode==="received-edit"?(o(),r("div",He,[n(ne,{email:e.sidebar.data,onSubmitted:_,onError:i[2]||(i[2]=()=>console.log("Error from received-edit"))},null,8,["email"])])):f("",!0)]}),_:1},8,["show","title","loading"])])])]),n(ke,{notification:u.value,onClose:i[4]||(i[4]=s=>u.value=null)},null,8,["notification"])]),_:1})],64))}};export{gt as default};
