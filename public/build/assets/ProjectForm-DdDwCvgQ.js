import{r as j,s as Ee,p as X,w as H,h as l,o as r,g as p,t as w,b as i,e as m,f as K,v as le,F as O,i as R,n as ee,k as z,G as Qe,a as Y,A as Be,m as be,B as Ze,L as et,M as tt,D as st,N as Me,u,j as Pe,c as Oe,d as at}from"./app-C1kCDZc3.js";import{P as se}from"./PrimaryButton-kJU6-6nb.js";import{_ as V,a as W}from"./TextInput-Dd1PNkJW.js";import{_ as I}from"./InputError-H7Azy3Wi.js";import{_ as ot}from"./Checkbox-DchCd7nL.js";import{a as Re}from"./SecondaryButton-BWEMHKfv.js";const nt={key:0,class:"text-red-600 text-sm mb-4"},rt={key:1,class:"text-gray-500 text-sm mb-4"},lt={key:2},it={class:"mb-4"},dt={class:"mb-4"},ct=["disabled"],ut=["value"],mt={class:"mb-4"},pt={class:"mt-2"},vt={class:"flex items-center mb-2"},yt=["for"],ft={key:0,class:"pl-6"},_t={class:"grid grid-cols-2 gap-4 mb-2"},gt=["id","onUpdate:modelValue","disabled"],bt={class:"mb-2"},ht={key:0},wt={class:"flex justify-between items-center mb-1"},kt=["onClick"],xt={class:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-2"},jt={class:"flex"},Pt=["onClick"],$t={key:0},St={class:"mt-4"},At={key:1,class:"mt-2 flex items-center"},Ct={key:0,class:"mt-6 flex justify-end"},Vt={__name:"ServicesAndPaymentForm",props:{projectId:{type:[Number,String],required:!0},paymentTypeOptions:{type:Array,required:!0},canManageProjectServicesAndPayments:{type:Boolean,required:!0},canViewProjectServicesAndPayments:{type:Boolean,required:!0}},emits:["updated"],setup(g,{emit:ie}){const P=g,J=ie,_=j({}),$=j(!1),T=j([...[{value:"Website Designing",label:"Website Designing"},{value:"SEO",label:"SEO"},{value:"Social Media",label:"Social Media"},{value:"Content Writing",label:"Content Writing"},{value:"Graphic Design",label:"Graphic Design"}]]),h=j(""),F=j(!1),b=Ee({services:[],service_details:[],total_amount:"",payment_type:"one_off"}),E=X(()=>{const d=b.services.filter(o=>{const n=A(o);return n&&n.frequency!=="monthly"});return d.length===0?!0:d.every(o=>B(o)===100)}),D=X(()=>!P.projectId||!P.canManageProjectServicesAndPayments||!E.value),oe=()=>{const d=h.value.trim();d&&!T.value.some(o=>o.label.toLowerCase()===d.toLowerCase())&&(T.value.push({value:d,label:d}),h.value="",F.value=!1)},de=async()=>{if(P.projectId){$.value=!0;try{const o=(await window.axios.get(`/api/projects/${P.projectId}/sections/services-payment`)).data;return b.services=o.services||[],b.service_details=o.service_details||[],b.total_amount=o.total_amount||"",b.payment_type=o.payment_type||"one_off",b.services.forEach(n=>{T.value.some(y=>y.value===n)||T.value.push({value:n,label:n})}),b.service_details.forEach(n=>{if(n.payment_breakdown&&!Array.isArray(n.payment_breakdown)){const y=n.payment_breakdown;n.payment_breakdown=[{label:"First",percentage:parseInt(y.first)||30},{label:"Second",percentage:parseInt(y.second)||30},{label:"Third",percentage:parseInt(y.third)||40}]}else(!n.payment_breakdown||n.payment_breakdown.length===0)&&(n.payment_breakdown=[{label:"Payment 1",percentage:100}])}),o}catch(d){return console.error("Error fetching services and payment data:",d),_.value.general="Failed to fetch services and payment data.",null}finally{$.value=!1}}},ne=async()=>{_.value={},$.value=!0;try{const d={services:b.services,service_details:b.service_details,total_amount:b.total_amount,payment_type:b.payment_type},o=await window.axios.put(`/api/projects/${P.projectId}/sections/services-payment`,d);alert("Services and payment information updated successfully!"),J("updated")}catch(d){d.response&&d.response.status===422?_.value=d.response.data.errors:d.response&&d.response.data.message?_.value.general=d.response.data.message:(_.value.general="Failed to update services and payment information.",console.error("Error:",d))}finally{$.value=!1}},L=(d,o)=>{o?b.service_details.some(n=>n.service_id===d)||b.service_details.push({service_id:d,amount:"",frequency:"one_off",start_date:"",payment_breakdown:[{label:"Payment 1",percentage:100}]}):b.service_details=b.service_details.filter(n=>n.service_id!==d)},A=d=>{let o=b.service_details.find(n=>n.service_id===d);if(!o)o={service_id:d,amount:"",frequency:"one_off",start_date:"",payment_breakdown:[{label:"Payment 1",percentage:100}]},b.service_details.push(o);else if(o.payment_breakdown&&!Array.isArray(o.payment_breakdown)){const n=o.payment_breakdown;o.payment_breakdown=[{label:"First",percentage:parseInt(n.first)||30},{label:"Second",percentage:parseInt(n.second)||30},{label:"Third",percentage:parseInt(n.third)||40}]}else(!o.payment_breakdown||o.payment_breakdown.length===0)&&(o.payment_breakdown=[{label:"Payment 1",percentage:100}]);return o},B=d=>{const o=A(d);return!o.payment_breakdown||!Array.isArray(o.payment_breakdown)?0:o.payment_breakdown.reduce((n,y)=>n+(parseInt(y.percentage)||0),0)},G=d=>{const o=A(d);if(o.payment_breakdown||(o.payment_breakdown=[]),!Array.isArray(o.payment_breakdown)){const S=o.payment_breakdown;o.payment_breakdown=[{label:"First",percentage:parseInt(S.first)||30},{label:"Second",percentage:parseInt(S.second)||30},{label:"Third",percentage:parseInt(S.third)||40}]}const n=o.payment_breakdown.length;let y=0;if(n>0){const S=o.payment_breakdown[n-1];y=Math.floor(S.percentage/2),S.percentage-=y}else y=100;o.payment_breakdown.push({label:`Payment ${n+1}`,percentage:y})},v=(d,o)=>{const n=A(d);if(!n.payment_breakdown||!Array.isArray(n.payment_breakdown)||n.payment_breakdown.length<=1)return;const y=parseInt(n.payment_breakdown[o].percentage)||0;if(n.payment_breakdown.splice(o,1),y>0&&n.payment_breakdown.length>0){const S=o>0&&o<=n.payment_breakdown.length?o-1:0;n.payment_breakdown[S].percentage=(parseInt(n.payment_breakdown[S].percentage)||0)+y}n.payment_breakdown.forEach((S,N)=>{S.label=`Payment ${N+1}`})};return H(()=>P.projectId,d=>{d&&de()},{immediate:!0}),(d,o)=>(r(),l("div",null,[_.value.general?(r(),l("div",nt,w(_.value.general),1)):p("",!0),$.value?(r(),l("div",rt,"Loading...")):(r(),l("div",lt,[i("div",it,[m(V,{for:"total_amount",value:"Total Amount"}),m(W,{id:"total_amount",type:"number",step:"0.01",class:"mt-1 block w-full",modelValue:b.total_amount,"onUpdate:modelValue":o[0]||(o[0]=n=>b.total_amount=n),disabled:!g.canManageProjectServicesAndPayments},null,8,["modelValue","disabled"]),m(I,{message:_.value.total_amount?_.value.total_amount[0]:"",class:"mt-2"},null,8,["message"])]),i("div",dt,[m(V,{for:"payment_type",value:"Payment Type"}),K(i("select",{id:"payment_type",class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full","onUpdate:modelValue":o[1]||(o[1]=n=>b.payment_type=n),required:"",disabled:!g.canManageProjectServicesAndPayments},[(r(!0),l(O,null,R(g.paymentTypeOptions,n=>(r(),l("option",{key:n.value,value:n.value},w(n.label),9,ut))),128))],8,ct),[[le,b.payment_type]]),m(I,{message:_.value.payment_type?_.value.payment_type[0]:"",class:"mt-2"},null,8,["message"])]),i("div",mt,[m(V,{for:"services",value:"Services"}),i("div",pt,[(r(!0),l(O,null,R(T.value,n=>(r(),l("div",{key:n.value,class:"border p-3 mb-3 rounded"},[i("div",vt,[m(ot,{id:`service_${n.value}`,value:n.value,checked:b.services,"onUpdate:checked":[o[2]||(o[2]=y=>b.services=y),y=>L(n.value,y)],disabled:!g.canManageProjectServicesAndPayments},null,8,["id","value","checked","onUpdate:checked","disabled"]),i("label",{for:`service_${n.value}`,class:"ms-2 text-sm font-medium text-gray-700"},w(n.label),9,yt)]),(b.services||[]).includes(n.value)?(r(),l("div",ft,[i("div",_t,[i("div",null,[m(V,{for:`service_amount_${n.value}`,value:"Amount",class:"text-xs"},null,8,["for"]),m(W,{id:`service_amount_${n.value}`,type:"number",step:"0.01",placeholder:"Amount",class:"w-full",modelValue:A(n.value).amount,"onUpdate:modelValue":y=>A(n.value).amount=y,disabled:!g.canManageProjectServicesAndPayments},null,8,["id","modelValue","onUpdate:modelValue","disabled"])]),i("div",null,[m(V,{for:`service_frequency_${n.value}`,value:"Frequency",class:"text-xs"},null,8,["for"]),K(i("select",{id:`service_frequency_${n.value}`,class:"border-gray-300 rounded-md w-full","onUpdate:modelValue":y=>A(n.value).frequency=y,disabled:!g.canManageProjectServicesAndPayments},o[6]||(o[6]=[i("option",{value:"monthly"},"Monthly",-1),i("option",{value:"one_off"},"One off",-1)]),8,gt),[[le,A(n.value).frequency]])])]),i("div",bt,[m(V,{for:`service_start_date_${n.value}`,value:"Start Date",class:"text-xs"},null,8,["for"]),m(W,{id:`service_start_date_${n.value}`,type:"date",class:"w-full",modelValue:A(n.value).start_date,"onUpdate:modelValue":y=>A(n.value).start_date=y,disabled:!g.canManageProjectServicesAndPayments},null,8,["id","modelValue","onUpdate:modelValue","disabled"])]),A(n.value).frequency!=="monthly"?(r(),l("div",ht,[i("div",wt,[m(V,{value:"Payment Breakdown (%)",class:"text-xs"}),g.canManageProjectServicesAndPayments?(r(),l("button",{key:0,type:"button",class:"text-xs text-blue-600 hover:text-blue-800",onClick:y=>G(n.value)}," + Add Payment ",8,kt)):p("",!0)]),i("div",xt,[(r(!0),l(O,null,R(A(n.value).payment_breakdown,(y,S)=>(r(),l("div",{key:S,class:"relative"},[m(V,{for:`service_payment_${S}_${n.value}`,value:y.label,class:"text-xs"},null,8,["for","value"]),i("div",jt,[m(W,{id:`service_payment_${S}_${n.value}`,type:"text",inputmode:"numeric",pattern:"[0-9]*",min:"0",max:"100",class:"w-full",modelValue:y.percentage,"onUpdate:modelValue":N=>y.percentage=N,modelModifiers:{number:!0},onInput:N=>{y.percentage=Math.max(0,Math.min(100,parseInt(N.target.value)||0))},disabled:!g.canManageProjectServicesAndPayments},null,8,["id","modelValue","onUpdate:modelValue","onInput","disabled"]),g.canManageProjectServicesAndPayments&&A(n.value).payment_breakdown.length>1?(r(),l("button",{key:0,type:"button",class:"ml-1 text-red-500 hover:text-red-700",onClick:N=>v(n.value,S)},o[7]||(o[7]=[i("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor"},[i("path",{"fill-rule":"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z","clip-rule":"evenodd"})],-1)]),8,Pt)):p("",!0)])]))),128))]),i("div",{class:ee(["text-xs mt-2",{"text-gray-500":B(n.value)===100,"text-red-500 font-bold":B(n.value)!==100}])},[z(" Total: "+w(B(n.value))+"% ",1),B(n.value)!==100?(r(),l("span",$t," (Total must be 100%) ")):p("",!0)],2)])):p("",!0)])):p("",!0)]))),128))]),i("div",St,[g.canManageProjectServicesAndPayments&&!F.value?(r(),l("button",{key:0,type:"button",class:"text-sm text-blue-600 hover:text-blue-800",onClick:o[3]||(o[3]=n=>F.value=!0)}," + Add New Service/Department ")):p("",!0),g.canManageProjectServicesAndPayments&&F.value?(r(),l("div",At,[m(W,{type:"text",class:"flex-grow mr-2",modelValue:h.value,"onUpdate:modelValue":o[4]||(o[4]=n=>h.value=n),placeholder:"New service/department name",onKeyup:Qe(oe,["enter"])},null,8,["modelValue"]),m(se,{onClick:oe},{default:Y(()=>o[8]||(o[8]=[z("Add")])),_:1,__:[8]}),i("button",{type:"button",class:"ml-2 text-sm text-gray-500 hover:text-gray-700",onClick:o[5]||(o[5]=n=>{F.value=!1,h.value=""})}," Cancel ")])):p("",!0)]),m(I,{message:_.value.services?_.value.services[0]:"",class:"mt-2"},null,8,["message"])]),g.canManageProjectServicesAndPayments?(r(),l("div",Ct,[m(se,{onClick:ne,disabled:D.value,class:ee({"opacity-25":D.value})},{default:Y(()=>o[9]||(o[9]=[z(" Update Services & Payment ")])),_:1,__:[9]},8,["disabled","class"])])):p("",!0)]))]))}},Dt={class:"mt-2"},Ut={class:"mb-2"},It={key:0,class:"text-gray-500 text-sm mb-2"},Ft=["disabled"],Mt={value:""},Ot=["value"],Rt={class:"flex-grow"},Tt=["value","onChange","disabled"],Et=["value"],Bt=["onClick"],Te={__name:"MultiSelectWithRoles",props:{label:{type:String,required:!0},items:{type:Array,default:()=>[]},endpoint:{type:String,default:""},selectedItems:{type:Array,default:()=>[]},itemText:{type:String,default:"name"},itemSubtext:{type:String,default:"email"},itemValue:{type:String,default:"id"},roleOptions:{type:Array,default:()=>[]},roleType:{type:String,default:"application"},defaultRoleId:{type:Number,default:null},error:{type:String,default:""},placeholder:{type:String,default:"Select an item"},showRemoveButton:{type:Boolean,default:!0}},emits:["update:selectedItems"],setup(g,{emit:ie}){const P=g,J=ie,_=j([]),$=j([]),ae=j([]),T=j([]),h=j(!1),F=async()=>{if(!(P.roleOptions.length>0))try{const d=(await be.get(`/api/roles?type=${P.roleType}`)).data;ae.value=d.map(o=>({value:o.id,label:o.name}))}catch(v){console.error("Error fetching roles:",v)}},b=X(()=>ae.value.length>0?ae.value:P.roleOptions),E=()=>P.defaultRoleId?P.defaultRoleId:b.value.length>0?b.value[0].value:1,D=()=>{if(console.log("initializeFromProps called with selectedItems:",P.selectedItems),!P.selectedItems||P.selectedItems.length===0){_.value=[],$.value=[],console.log("Cleared selectedIds and selectedItemsWithRoles because props.selectedItems is empty");return}const v=new Set;P.selectedItems.forEach(d=>{const o=typeof d=="object"?d.id:d;if(!v.has(o)){if(v.add(o),!_.value.includes(o))_.value.push(o),typeof d=="object"&&d.role_id?$.value.push({id:o,role_id:d.role_id}):$.value.push({id:o,role_id:E()});else if(typeof d=="object"&&d.role_id){const n=$.value.find(y=>y.id===o);n&&(n.role_id=d.role_id)}}}),console.log("After initialization, selectedIds:",_.value),console.log("After initialization, selectedItemsWithRoles:",$.value)};H(()=>P.selectedItems,(v,d)=>{console.log("selectedItems changed:",v),JSON.stringify(v)!==JSON.stringify(d)?(console.log("selectedItems changed significantly, reinitializing"),D()):console.log("selectedItems change was not significant, skipping reinitialization")},{deep:!0,immediate:!0}),H($,v=>{J("update:selectedItems",v)},{deep:!0});const oe=v=>{v&&!_.value.includes(v)&&(_.value.push(v),$.value.push({id:v,role_id:E()}))},de=v=>{_.value=_.value.filter(d=>d!==v),$.value=$.value.filter(d=>d.id!==v)},ne=(v,d)=>{const o=$.value.find(n=>n.id===v);o&&(o.role_id=parseInt(d))},L=v=>G.value.find(d=>d[P.itemValue]===v),A=v=>{const d=$.value.find(o=>o.id===v);return d?d.role_id:E()},B=async()=>{if(P.endpoint){h.value=!0;try{const v=await be.get(P.endpoint);v.data&&Array.isArray(v.data)?T.value=v.data:v.data&&v.data.data&&Array.isArray(v.data.data)&&(T.value=v.data.data)}catch(v){console.error("Error fetching items from endpoint:",v)}finally{h.value=!1}}},G=X(()=>P.endpoint&&T.value.length>0?T.value:P.items);return Be(()=>{F(),D(),P.endpoint&&B()}),(v,d)=>(r(),l("div",null,[m(V,{value:g.label},null,8,["value"]),i("div",Dt,[i("div",Ut,[h.value?(r(),l("div",It,"Loading...")):p("",!0),g.showRemoveButton?(r(),l("select",{key:1,class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full",onChange:d[0]||(d[0]=o=>{const n=parseInt(o.target.value);oe(n),o.target.value=""}),disabled:h.value},[i("option",Mt,w(g.placeholder),1),(r(!0),l(O,null,R(G.value.filter(o=>!_.value.includes(o[g.itemValue])),o=>(r(),l("option",{key:o[g.itemValue],value:o[g.itemValue]},w(o[g.itemText])+" ("+w(o[g.itemSubtext])+") ",9,Ot))),128))],40,Ft)):p("",!0)]),(r(!0),l(O,null,R(_.value,o=>{var n,y;return r(),l("div",{key:o,class:"flex items-center mb-1 p-2 border rounded"},[i("div",Rt,w((n=L(o))==null?void 0:n[g.itemText])+" ("+w((y=L(o))==null?void 0:y[g.itemSubtext])+") ",1),i("select",{class:"ms-2 border-gray-300 rounded-md",value:A(o),onChange:S=>ne(o,S.target.value),disabled:!g.showRemoveButton},[(r(!0),l(O,null,R(b.value,S=>(r(),l("option",{key:S.value,value:S.value},w(S.label),9,Et))),128))],40,Tt),g.showRemoveButton?(r(),l("button",{key:0,type:"button",class:"ml-2 text-red-600",onClick:()=>de(o)}," Remove ",8,Bt)):p("",!0)])}),128))]),m(I,{message:g.error,class:"mt-2"},null,8,["message"])]))}},Nt={class:"p-6 w-full max-w-6xl mx-auto bg-white rounded-lg shadow-xl"},qt={class:"flex justify-between items-center mb-4"},Lt={class:"text-lg font-medium text-gray-900"},zt={key:0,class:"text-red-600 text-sm mb-4"},Wt={key:1,class:"mb-4"},Jt={key:0,class:"text-xs text-gray-500 mt-2 p-2 bg-gray-100 rounded"},Gt={class:"font-bold"},Kt={class:"mt-1"},Yt={key:0},Ht={key:1},Xt={key:2},Qt={key:0},Zt={class:"list-disc ml-4"},es={key:0},ts={class:"mt-1"},ss={class:"border-b border-gray-200 mb-6"},as={class:"flex -mb-px"},os={key:0},ns={class:"mb-4"},rs={class:"mb-4"},ls=["disabled"],is={class:"mb-4"},ds={class:"mb-4"},cs={class:"mb-4"},us=["disabled"],ms=["value"],ps={class:"mb-4"},vs=["disabled"],ys=["value"],fs={key:0,class:"mt-6 flex justify-end"},_s={key:1},gs={key:0,class:"mb-4"},bs={key:0,class:"mt-2 flex justify-end"},hs={key:1,class:"mt-2 text-green-600 text-sm"},ws={key:2,class:"mt-2 text-red-600 text-sm"},ks={class:"mb-4"},xs=["disabled"],js={key:1,class:"mb-4"},Ps={key:0,class:"mt-2 flex justify-end"},$s={key:1,class:"mt-2 text-green-600 text-sm"},Ss={key:2,class:"mt-2 text-red-600 text-sm"},As={key:2},Cs={key:3},Vs={class:"mb-4"},Ds={class:"flex justify-between items-center mb-4"},Us={class:"text-right"},Is={class:"text-lg font-medium"},Fs={class:"text-lg font-medium"},Ms={class:"text-xl font-bold mt-1"},Os={key:0,class:"mt-4"},Rs=["onUpdate:modelValue"],Ts={key:0,value:"income"},Es={key:1,value:"expense"},Bs=["onUpdate:modelValue"],Ns=["value"],qs=["onClick"],Ls={class:"flex mt-2"},zs={key:0,class:"mt-6 flex justify-end"},Ws={key:4},Js={class:"mb-4"},Gs={class:"mt-2"},Ks={key:0,class:"mb-4"},Ys={class:"mt-4"},Hs={key:0,class:"text-sm text-red-500 mt-2"},Xs={key:1,class:"mt-4"},Qs={class:"flex-grow"},Zs=["href"],ea=["onClick"],ta={key:5},sa={class:"mb-4"},aa={class:"mt-2"},oa={class:"flex items-start mb-2"},na=["onUpdate:modelValue","readonly"],ra={class:"mt-6 flex justify-end"},pa={__name:"ProjectForm",props:{show:{type:Boolean,required:!0},project:{type:Object,default:()=>({})},statusOptions:{type:Array,required:!0},departmentOptions:{type:Array,required:!0},sourceOptions:{type:Array,required:!0},clientRoleOptions:{type:Array,default:()=>[]},userRoleOptions:{type:Array,default:()=>[]},paymentTypeOptions:{type:Array,required:!0}},emits:["close","submit"],setup(g,{emit:ie}){Ze();const P=j({}),J=g;H(()=>J.project,t=>{P.value=t||{}},{immediate:!0});const _=X(()=>{var t;return((t=P.value)==null?void 0:t.id)||null}),{permissions:$,loading:ae,error:T}=et(_),h=tt(P);X(()=>!!h.value),X(()=>{if(!h.value)return!1;const t=h.value.name,s=h.value.slug;return t==="Manager"||t==="Project Manager"||s==="manager"||s==="project-manager"});const{canDo:F,canView:b,canManage:E}=st(_),D=F("manage_projects",h),oe=F("create_projects",h),de=F("create_clients",h),ne=F("upload_project_documents",h),L=E("project_expenses",h),A=E("project_income",h),B=E("project_services_and_payments",h),G=F("add_project_notes",h),v=E("project_users",h),d=E("project_clients",h),o=E("project_basic_details",h),n=b("project_documents",h),y=b("project_services_and_payments",h),S=b("project_notes",h),N=b("project_users",h),ce=b("project_clients",h),he=b("view_project_transactions",h),U=j("basic"),te=t=>{if(!(t==="documents"&&!e.id)&&(U.value=t,e.id))switch(M.value=!0,t){case"basic":Ae(e.id).finally(()=>{M.value=!1});break;case"client":ce.value||d.value||N.value||v.value?Ce(e.id).finally(()=>{M.value=!1}):M.value=!1;break;case"services":y.value||B.value?we(e.id).finally(()=>{M.value=!1}):M.value=!1;break;case"transactions":L.value||A.value?Ve(e.id).finally(()=>{M.value=!1}):M.value=!1;break;case"documents":n.value?De(e.id).finally(()=>{M.value=!1}):M.value=!1;break;case"notes":S.value||G.value?Ue(e.id).finally(()=>{M.value=!1}):M.value=!1;break;default:M.value=!1;break}},ue=j([]),me=j([]),pe=j([]),re=j([]),Ne=async()=>{try{const s=(await be.get("/api/roles?type=client")).data;ue.value=s.map(f=>({value:f.id,label:f.name}));const a=(await be.get("/api/roles?type=project")).data;me.value=a.map(f=>({value:f.id,label:f.name}))}catch(t){console.error("Error fetching roles:",t)}},$e=async()=>{try{if(de.value){const t=await window.axios.get("/api/clients");pe.value=t.data.data||t.data}else if(_.value){const t=await window.axios.get(`/api/projects/${_.value}/clients`);pe.value=t.data}else{const t=await window.axios.get("/api/clients");pe.value=t.data.data||t.data}}catch(t){console.error("Error fetching clients:",t),C.value="Failed to load clients."}},Se=async()=>{try{if(oe.value){const t=await window.axios.get("/api/users");re.value=t.data}else if(_.value){const t=await window.axios.get(`/api/projects/${_.value}/users`);re.value=t.data}else{const t=await window.axios.get("/api/users");re.value=t.data}}catch(t){console.error("Error fetching users:",t),C.value="Failed to load users."}},qe=X(()=>ue.value.length>0?ue.value:J.clientRoleOptions),Le=X(()=>me.value.length>0?me.value:J.userRoleOptions),Ae=async t=>{try{const c=(await window.axios.get(`/api/projects/${t}/sections/basic`)).data;return e.name=c.name||"",e.description=c.description||"",e.website=c.website||"",e.social_media_link=c.social_media_link||"",e.preferred_keywords=c.preferred_keywords||"",e.google_chat_id=c.google_chat_id||"",e.status=c.status||"active",e.project_type=c.project_type||"",e.source=c.source||"",e.google_drive_link=c.google_drive_link||"",c}catch(s){return console.error("Error fetching basic project data:",s),C.value="Failed to fetch basic project data.",null}},Ce=async t=>{try{const c=(await window.axios.get(`/api/projects/${t}/sections/clients-users`)).data;return c.clients&&c.clients.length>0&&(e.client_ids=c.clients.map(a=>{var x;let f=((x=a.pivot)==null?void 0:x.role_id)||(ue.value.length>0?ue.value[0].value:1);return{id:a.id,role_id:f}})),c.users&&c.users.length>0&&(e.user_ids=c.users.map(a=>{var x;let f=((x=a.pivot)==null?void 0:x.role_id)||(me.value.length>0?me.value[0].value:2);return{id:a.id,role_id:f}})),c.contract_details!==void 0&&(e.contract_details=c.contract_details||""),c}catch(s){return console.error("Error fetching clients and users data:",s),C.value="Failed to fetch clients and users data.",null}},we=async t=>{try{const c=(await window.axios.get(`/api/projects/${t}/sections/services-payment`)).data;return e.services=c.services||[],e.service_details=c.service_details||[],e.total_amount=c.total_amount||"",e.payment_type=c.payment_type||"one_off",c}catch(s){return console.error("Error fetching services and payment data:",s),C.value="Failed to fetch services and payment data.",null}},Ve=async t=>{try{const c=(await window.axios.get(`/api/projects/${t}/sections/transactions`)).data;return e.transactions=c.map(a=>({description:a.description,amount:a.amount,user_id:a.user_id,hours_spent:a.hours_spent,type:a.type||"expense"})),c}catch(s){return console.error("Error fetching transactions data:",s),C.value="Failed to fetch transactions data.",null}},De=async t=>{try{const c=(await window.axios.get(`/api/projects/${t}/sections/documents`)).data;return e.documents=c.documents||[],c}catch(s){return console.error("Error fetching documents data:",s),C.value="Failed to fetch documents data.",null}},Ue=async t=>{try{const c=(await window.axios.get(`/api/projects/${t}/sections/notes`)).data;return e.notes=c.map(a=>({content:a.content})),c}catch(s){return console.error("Error fetching notes data:",s),C.value="Failed to fetch notes data.",null}},ze=async t=>{try{switch(await Ae(t),U.value){case"client":(ce.value||d.value||N.value||v.value)&&await Ce(t);break;case"services":(y.value||B.value)&&await we(t);break;case"transactions":(L.value||A.value)&&await Ve(t);break;case"documents":n.value&&await De(t);break;case"notes":(S.value||G.value)&&await Ue(t);break}}catch(s){console.error("Error fetching project data:",s),C.value="Failed to fetch project data."}};Be(()=>{Ne(),$e(),Se(),_.value&&Me(_.value).then(t=>{}).catch(t=>{})}),H(_,(t,s)=>{t&&t!==s&&(Me(t).then(c=>{}).catch(c=>{}),Se(),$e())});const ke=ie,k=j({}),C=j(""),M=j(!1),We=j(!1),ve=j(!1),ye=j(!1),Q=j(""),fe=j(!1),_e=j(!1),Z=j(""),e=Ee({id:null,name:"",description:"",website:"",social_media_link:"",preferred_keywords:"",google_chat_id:"",logo:null,documents:[],client_ids:[],status:"active",project_type:"",services:[],service_details:[],source:"",total_amount:"",contract_details:"",google_drive_link:"",payment_type:"one_off",user_ids:[],transactions:[],notes:[]});H(()=>J.show,t=>{t&&(e.client_ids||(e.client_ids=[]),e.user_ids||(e.user_ids=[]),e.id&&ze(e.id))},{immediate:!0}),H(()=>J.project,t=>{const s=e.id;e.id=t.id||null,s&&!e.id&&U.value==="documents"&&te("basic"),e.name=t.name||"",e.description=t.description||"",e.website=t.website||"",e.social_media_link=t.social_media_link||"",e.preferred_keywords=t.preferred_keywords||"",e.google_chat_id=t.google_chat_id||"",e.logo=t.logo||null,e.documents=t.documents||[],e.client_ids=[],e.status=t.status||"active",e.project_type=t.project_type||"",e.services=t.services||[],e.service_details=t.service_details||[],e.source=t.source||"",e.total_amount=t.total_amount||"",e.contract_details=t.contract_details||"",e.google_drive_link=t.google_drive_link||"",e.payment_type=t.payment_type||"one_off",e.user_ids=[],e.transactions=t.transactions?t.transactions.map(c=>({description:c.description,amount:c.amount,user_id:c.user_id,hours_spent:c.hours_spent,type:c.type||"expense"})):[],e.notes=t.notes?t.notes.map(c=>({content:c.content})):[],k.value={},C.value=""},{immediate:!0});const Je=async()=>{k.value={},C.value="";try{const t={name:e.name,description:e.description,website:e.website,social_media_link:e.social_media_link,preferred_keywords:e.preferred_keywords,google_chat_id:e.google_chat_id,status:e.status,project_type:e.project_type,source:e.source,google_drive_link:e.google_drive_link,user_ids:e.user_ids},s=e.logo;typeof s=="object"&&s!==null&&"name"in s&&delete t.logo;const c=await window.axios.post("/api/projects",t);e.id=c.data.id,typeof s=="object"&&s!==null&&"name"in s&&await Fe(s,e.id),ke("submit",c.data)}catch(t){xe(t,"Failed to create project.")}},Ge=async()=>{k.value={},C.value="";try{const t={name:e.name,description:e.description,website:e.website,social_media_link:e.social_media_link,preferred_keywords:e.preferred_keywords,google_chat_id:e.google_chat_id,status:e.status,project_type:e.project_type,source:e.source,google_drive_link:e.google_drive_link},s=e.logo;typeof s=="object"&&s!==null&&"name"in s&&delete t.logo;const c=await window.axios.put(`/api/projects/${e.id}/sections/basic`,t);typeof s=="object"&&s!==null&&"name"in s&&await Fe(s,e.id),alert("Basic information updated successfully!")}catch(t){xe(t,"Failed to update basic information.")}},Ke=async()=>{k.value={},C.value="";try{const t={transactions:e.transactions};L.value||(t.transactions=t.transactions.filter(c=>c.type!=="expense")),A.value||(t.transactions=t.transactions.filter(c=>c.type!=="income"));const s=await window.axios.put(`/api/projects/${e.id}/sections/transactions`,t);alert("Transactions updated successfully!")}catch(t){xe(t,"Failed to update transactions.")}},xe=(t,s)=>{t.response&&t.response.status===422?k.value=t.response.data.errors:t.response&&t.response.data.message?C.value=t.response.data.message:(C.value=s,console.error("Error:",t))},ge=j(!1),je=j({});H(e,()=>{Object.keys(je.value).length>0&&(ge.value=!0)},{deep:!0}),H(()=>J.show,t=>{t&&setTimeout(()=>{je.value=JSON.parse(JSON.stringify(e)),ge.value=!1},100)});const Ie=()=>{ge.value?confirm("You have unsaved changes. Are you sure you want to close this form?")&&ke("close"):ke("close")},Fe=async(t,s)=>{try{const c=new FormData;c.append("logo",t);const a=await window.axios.post(`/api/projects/${s}/logo`,c,{headers:{"Content-Type":"multipart/form-data"}});return a.data&&a.data.logo&&(e.logo=a.data.logo),a}catch(c){console.error("Error uploading logo:",c)}},Ye=async()=>{if(!e.id){Q.value="Please save the project first before saving clients.";return}if(!e.client_ids||e.client_ids.length===0){Q.value="Please select at least one client to save.";return}ve.value=!0,ye.value=!1,Q.value="";try{const t=await window.axios.post(`/api/projects/${e.id}/attach-clients`,{client_ids:e.client_ids});ye.value=!0,setTimeout(()=>{ye.value=!1},3e3)}catch(t){t.response&&t.response.status===422?Q.value="Validation error. Please check your input.":t.response&&t.response.data.message?Q.value=t.response.data.message:(Q.value="Failed to save clients.",console.error("Error saving clients:",t))}finally{ve.value=!1}},He=async()=>{if(console.log("saveUsers called, projectForm.user_ids:",e.user_ids),!e.id){Z.value="Please save the project first before saving users.";return}if(!e.user_ids||e.user_ids.length===0){console.log("No users selected, projectForm.user_ids is empty or null"),Z.value="Please select at least one user to save.";return}fe.value=!0,_e.value=!1,Z.value="";try{console.log("Sending user_ids to API:",JSON.stringify(e.user_ids));const t=await window.axios.post(`/api/projects/${e.id}/attach-users`,{user_ids:e.user_ids});_e.value=!0,setTimeout(()=>{_e.value=!1},3e3)}catch(t){t.response&&t.response.status===422?Z.value="Validation error. Please check your input.":t.response&&t.response.data.message?Z.value=t.response.data.message:(Z.value="Failed to save users.",console.error("Error saving users:",t))}finally{fe.value=!1}},Xe=async()=>{if(!e.id){C.value="Please save the project first before uploading documents.";return}if(!e.documents||!e.documents.some(t=>typeof t=="object"&&t!==null&&"name"in t&&"size"in t&&"type"in t)){C.value="Please select documents to upload.";return}try{const t=new FormData;e.documents.filter(f=>typeof f=="object"&&f!==null&&"name"in f&&"size"in f&&"type"in f).forEach((f,x)=>{t.append(`documents[${x}]`,f)});const c=await window.axios.post(`/api/projects/${e.id}/documents`,t,{headers:{"Content-Type":"multipart/form-data"}});e.documents=c.data.documents||[],document.getElementById("documents").value="",alert("Documents uploaded successfully!");const a=JSON.parse(JSON.stringify(e));je.value=a,ge.value=!1}catch(t){t.response&&t.response.status===422?k.value=t.response.data.errors:t.response&&t.response.data.message?C.value=t.response.data.message:(C.value="Failed to upload documents.",console.error("Error uploading documents:",t))}};return(t,s)=>{var c;return r(),l("div",Nt,[i("div",qt,[i("h2",Lt,w(e.id?"Edit Project":"Create New Project"),1),i("button",{onClick:Ie,class:"text-gray-400 hover:text-gray-500"},s[20]||(s[20]=[i("svg",{class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[i("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),C.value?(r(),l("div",zt,w(C.value),1)):p("",!0),_.value?(r(),l("div",Wt,[We.value?(r(),l("div",Jt,[i("div",Gt,"Project ID: "+w(_.value),1),i("div",null,w(u(h)?"Project Role: "+(((c=u(h).value)==null?void 0:c.name)||"None"):"No Project Role"),1),i("div",Kt,[s[22]||(s[22]=i("div",{class:"font-semibold"},"Project Permissions:",-1)),u(ae)?(r(),l("div",Yt,"Loading project permissions...")):u(T)?(r(),l("div",Ht,"Error loading project permissions")):u($)?(r(),l("div",Xt,[z(" Count: "+w(u($).permissions?u($).permissions.length:0)+" ",1),u($).permissions&&u($).permissions.length>0?(r(),l("div",Qt,[s[21]||(s[21]=i("div",{class:"font-semibold"},"Permissions:",-1)),i("ul",Zt,[(r(!0),l(O,null,R(u($).permissions.slice(0,5),a=>(r(),l("li",{key:a.slug},w(a.name)+" ("+w(a.source)+") ",1))),128)),u($).permissions.length>5?(r(),l("li",es," ... and "+w(u($).permissions.length-5)+" more ",1)):p("",!0)])])):p("",!0)])):p("",!0)]),i("div",ts,"Can manage projects: "+w(u(D)?"Yes":"No"),1)])):p("",!0)])):p("",!0),i("div",ss,[i("nav",as,[u(D)?(r(),l("button",{key:0,onClick:s[0]||(s[0]=a=>te("basic")),class:ee(["py-2 px-4 text-center border-b-2 font-medium text-sm",U.value==="basic"?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"])}," Basic Information ",2)):p("",!0),u(ce)||u(N)?(r(),l("button",{key:1,onClick:s[1]||(s[1]=a=>te("client")),class:ee(["py-2 px-4 text-center border-b-2 font-medium text-sm",U.value==="client"?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"])}," Clients and Users ",2)):p("",!0),e.id&&(u(B)||u(y))?(r(),l("button",{key:2,onClick:s[2]||(s[2]=a=>te("services")),class:ee(["py-2 px-4 text-center border-b-2 font-medium text-sm",U.value==="services"?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"])}," Services & Payment ",2)):p("",!0),e.id&&u(he)?(r(),l("button",{key:3,onClick:s[3]||(s[3]=a=>te("transactions")),class:ee(["py-2 px-4 text-center border-b-2 font-medium text-sm",U.value==="transactions"?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"])}," Transactions ",2)):p("",!0),e.id&&u(n)?(r(),l("button",{key:4,onClick:s[4]||(s[4]=a=>te("documents")),class:ee(["py-2 px-4 text-center border-b-2 font-medium text-sm",U.value==="documents"?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"])}," Documents ",2)):p("",!0),e.id&&(u(G)||u(S))?(r(),l("button",{key:5,onClick:s[5]||(s[5]=a=>te("notes")),class:ee(["py-2 px-4 text-center border-b-2 font-medium text-sm",U.value==="notes"?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"])}," Notes ",2)):p("",!0)])]),i("form",{onSubmit:s[19]||(s[19]=at(()=>{},["prevent"]))},[U.value==="basic"?(r(),l("div",os,[i("div",ns,[m(V,{for:"name",value:"Project Name"}),m(W,{id:"name",type:"text",class:"mt-1 block w-full",modelValue:e.name,"onUpdate:modelValue":s[6]||(s[6]=a=>e.name=a),required:"",autofocus:"",disabled:!u(D)},null,8,["modelValue","disabled"]),m(I,{message:k.value.name?k.value.name[0]:"",class:"mt-2"},null,8,["message"])]),i("div",rs,[m(V,{for:"description",value:"Description"}),K(i("textarea",{id:"description",class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full","onUpdate:modelValue":s[7]||(s[7]=a=>e.description=a),disabled:!u(D)},null,8,ls),[[Pe,e.description]]),m(I,{message:k.value.description?k.value.description[0]:"",class:"mt-2"},null,8,["message"])]),i("div",is,[m(V,{for:"website",value:"Website"}),m(W,{id:"website",type:"url",class:"mt-1 block w-full",modelValue:e.website,"onUpdate:modelValue":s[8]||(s[8]=a=>e.website=a),disabled:!u(D)},null,8,["modelValue","disabled"]),m(I,{message:k.value.website?k.value.website[0]:"",class:"mt-2"},null,8,["message"])]),i("div",ds,[m(V,{for:"preferred_keywords",value:"Client Preferred Keywords"}),m(W,{id:"preferred_keywords",type:"text",class:"mt-1 block w-full",modelValue:e.preferred_keywords,"onUpdate:modelValue":s[9]||(s[9]=a=>e.preferred_keywords=a),disabled:!u(D)},null,8,["modelValue","disabled"]),m(I,{message:k.value.preferred_keywords?k.value.preferred_keywords[0]:"",class:"mt-2"},null,8,["message"])]),i("div",cs,[m(V,{for:"status",value:"Status"}),K(i("select",{id:"status",class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full","onUpdate:modelValue":s[10]||(s[10]=a=>e.status=a),required:"",disabled:!u(D)},[(r(!0),l(O,null,R(g.statusOptions,a=>(r(),l("option",{key:a.value,value:a.value},w(a.label),9,ms))),128))],8,us),[[le,e.status]]),m(I,{message:k.value.status?k.value.status[0]:"",class:"mt-2"},null,8,["message"])]),i("div",ps,[m(V,{for:"source",value:"Source"}),K(i("select",{id:"source",class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full","onUpdate:modelValue":s[11]||(s[11]=a=>e.source=a),disabled:!u(D)},[s[23]||(s[23]=i("option",{value:"",disabled:""},"Select a Source",-1)),(r(!0),l(O,null,R(g.sourceOptions,a=>(r(),l("option",{key:a.value,value:a.value},w(a.label),9,ys))),128))],8,vs),[[le,e.source]]),m(I,{message:k.value.source?k.value.source[0]:"",class:"mt-2"},null,8,["message"])]),u(D)?(r(),l("div",fs,[e.id&&u(o)||!e.id?(r(),Oe(se,{key:0,onClick:s[12]||(s[12]=a=>e.id?Ge():Je()),disabled:!u(D)},{default:Y(()=>[z(w(e.id?"Update Basic Information":"Create Project"),1)]),_:1},8,["disabled"])):p("",!0)])):p("",!0)])):p("",!0),U.value==="client"?(r(),l("div",_s,[u(ce)?(r(),l("div",gs,[m(Te,{label:"Clients",items:pe.value,selectedItems:e.client_ids,"onUpdate:selectedItems":s[13]||(s[13]=a=>e.client_ids=a),roleOptions:qe.value,roleType:"client",error:k.value.client_ids?k.value.client_ids[0]:"",placeholder:"Select a client to add",disabled:!u(d),readonly:!u(d)&&u(ce),showRemoveButton:u(d)},null,8,["items","selectedItems","roleOptions","error","disabled","readonly","showRemoveButton"]),u(d)?(r(),l("div",bs,[m(se,{onClick:Ye,disabled:ve.value},{default:Y(()=>[z(w(ve.value?"Saving...":"Save Clients"),1)]),_:1},8,["disabled"])])):p("",!0),ye.value?(r(),l("div",hs," Clients saved successfully! ")):p("",!0),Q.value?(r(),l("div",ws,w(Q.value),1)):p("",!0)])):p("",!0),i("div",ks,[m(V,{for:"contract_details",value:"Contract Details"}),K(i("textarea",{id:"contract_details",class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full","onUpdate:modelValue":s[14]||(s[14]=a=>e.contract_details=a),disabled:!u(D)},null,8,xs),[[Pe,e.contract_details]]),m(I,{message:k.value.contract_details?k.value.contract_details[0]:"",class:"mt-2"},null,8,["message"])]),u(N)?(r(),l("div",js,[m(Te,{label:"Assign Users",items:re.value,selectedItems:e.user_ids,"onUpdate:selectedItems":s[15]||(s[15]=a=>e.user_ids=a),roleOptions:Le.value,roleType:"project",defaultRoleId:2,error:k.value.user_ids?k.value.user_ids[0]:"",placeholder:"Select a user to add",disabled:!u(v),readonly:!u(v)&&u(N),showRemoveButton:u(v)},null,8,["items","selectedItems","roleOptions","error","disabled","readonly","showRemoveButton"]),u(v)?(r(),l("div",Ps,[m(se,{onClick:He,disabled:fe.value},{default:Y(()=>[z(w(fe.value?"Saving...":"Save Users"),1)]),_:1},8,["disabled"])])):p("",!0),_e.value?(r(),l("div",$s," Users saved successfully! ")):p("",!0),Z.value?(r(),l("div",Ss,w(Z.value),1)):p("",!0)])):p("",!0)])):p("",!0),U.value==="services"?(r(),l("div",As,[m(Vt,{projectId:e.id,departmentOptions:g.departmentOptions,paymentTypeOptions:g.paymentTypeOptions,canManageProjectServicesAndPayments:u(B),canViewProjectServicesAndPayments:u(y),onUpdated:s[16]||(s[16]=a=>we(e.id))},null,8,["projectId","departmentOptions","paymentTypeOptions","canManageProjectServicesAndPayments","canViewProjectServicesAndPayments"])])):p("",!0),U.value==="transactions"&&u(he)?(r(),l("div",Cs,[i("div",Vs,[i("div",Ds,[s[24]||(s[24]=i("h3",{class:"text-lg font-medium"},"Transactions",-1)),i("div",Us,[i("div",Is," Total Income: $"+w(e.transactions.filter(a=>a.type==="income").reduce((a,f)=>a+(parseFloat(f.amount)||0),0).toFixed(2)),1),i("div",Fs," Total Expenses: $"+w(e.transactions.filter(a=>a.type==="expense").reduce((a,f)=>a+(parseFloat(f.amount)||0),0).toFixed(2)),1),i("div",Ms," Net: $"+w((e.transactions.filter(a=>a.type==="income").reduce((a,f)=>a+(parseFloat(f.amount)||0),0)-e.transactions.filter(a=>a.type==="expense").reduce((a,f)=>a+(parseFloat(f.amount)||0),0)).toFixed(2)),1)])]),u(he)?(r(),l("div",Os,[(r(!0),l(O,null,R(e.transactions,(a,f)=>(r(),l("div",{key:f,class:"flex items-center mb-2 p-2 border rounded"},[K(i("select",{"onUpdate:modelValue":x=>a.type=x,class:"mr-2 border-gray-300 rounded-md"},[u(A)?(r(),l("option",Ts,"Income")):p("",!0),u(L)?(r(),l("option",Es,"Expense")):p("",!0)],8,Rs),[[le,a.type]]),m(W,{modelValue:a.description,"onUpdate:modelValue":x=>a.description=x,placeholder:"Description",class:"mr-2 flex-grow"},null,8,["modelValue","onUpdate:modelValue"]),m(W,{modelValue:a.amount,"onUpdate:modelValue":x=>a.amount=x,modelModifiers:{number:!0},type:"number",step:"0.01",placeholder:"Amount",class:"mr-2 w-24"},null,8,["modelValue","onUpdate:modelValue"]),a.type==="expense"?K((r(),l("select",{key:0,"onUpdate:modelValue":x=>a.user_id=x,class:"mr-2 border-gray-300 rounded-md"},[s[25]||(s[25]=i("option",{value:"",disabled:""},"Select User (Optional)",-1)),(r(!0),l(O,null,R(Array.isArray(re.value)?re.value.filter(x=>e.user_ids.some(q=>q.id===x.id)):[],x=>(r(),l("option",{key:x.id,value:x.id},w(x.name),9,Ns))),128))],8,Bs)),[[le,a.user_id]]):p("",!0),a.type==="expense"?(r(),Oe(W,{key:1,modelValue:a.hours_spent,"onUpdate:modelValue":x=>a.hours_spent=x,modelModifiers:{number:!0},type:"number",step:"0.01",placeholder:"Hours",class:"mr-2 w-20"},null,8,["modelValue","onUpdate:modelValue"])):p("",!0),i("button",{type:"button",class:"text-red-600",onClick:x=>e.transactions.splice(f,1)}," Remove ",8,qs)]))),128)),i("div",Ls,[m(Re,{onClick:s[17]||(s[17]=a=>e.transactions.push({description:"",amount:"",user_id:null,hours_spent:"",type:"expense"}))},{default:Y(()=>s[26]||(s[26]=[z(" Add Transaction ")])),_:1,__:[26]})])])):p("",!0),m(I,{message:k.value.transactions?k.value.transactions[0]:"",class:"mt-2"},null,8,["message"])]),u(L)||u(A)?(r(),l("div",zs,[m(se,{onClick:Ke,disabled:!e.id||!u(L)&&!u(A)},{default:Y(()=>s[27]||(s[27]=[z(" Update Transactions ")])),_:1,__:[27]},8,["disabled"])])):p("",!0)])):p("",!0),U.value==="documents"?(r(),l("div",Ws,[i("div",Js,[m(V,{value:"Project Documents"}),i("div",Gs,[u(ne)?(r(),l("div",Ks,[m(V,{for:"documents",value:"Upload Documents"}),i("input",{type:"file",id:"documents",onChange:s[18]||(s[18]=a=>{const f=Array.from(a.target.files);if(f.length>0){const x=Array.isArray(e.documents)?e.documents.filter(q=>typeof q=="object"&&"path"in q):[];e.documents=[...x,...f],console.log("Files selected:",f),console.log("Are files File objects?",f.some(q=>typeof q=="object"&&q!==null&&"name"in q&&"size"in q&&"type"in q)),console.log("Updated documents array:",e.documents)}}),class:"mt-1 block w-full",multiple:"",accept:".pdf,.doc,.docx,.jpg,.png"},null,32),s[29]||(s[29]=i("p",{class:"text-sm text-gray-500 mt-1"},"Supported formats: PDF, DOC, DOCX, JPG, PNG",-1)),m(I,{message:k.value.documents?k.value.documents[0]:"",class:"mt-2"},null,8,["message"]),i("div",Ys,[m(se,{type:"button",onClick:Xe,disabled:!e.id||!e.documents||!e.documents.some(a=>typeof a=="object"&&a!==null&&"name"in a&&"size"in a&&"type"in a)},{default:Y(()=>s[28]||(s[28]=[z(" Upload Documents ")])),_:1,__:[28]},8,["disabled"]),e.id?p("",!0):(r(),l("p",Hs," Please save the project first before uploading documents. "))])])):p("",!0),e.documents&&e.documents.length>0&&typeof e.documents[0]=="object"&&"path"in e.documents[0]?(r(),l("div",Xs,[s[30]||(s[30]=i("h3",{class:"font-medium text-gray-700 mb-2"},"Existing Documents",-1)),(r(!0),l(O,null,R(e.documents,(a,f)=>(r(),l("div",{key:f,class:"flex items-center mb-2 p-2 border rounded"},[i("div",Qs,[i("a",{href:"/storage/"+a.path,target:"_blank",class:"text-blue-600 hover:underline"},w(a.filename),9,Zs)]),u(ne).value?(r(),l("button",{key:0,type:"button",class:"ml-2 text-red-600",onClick:()=>{e.documents=e.documents.filter((x,q)=>q!==f)}}," Remove ",8,ea)):p("",!0)]))),128))])):p("",!0),s[31]||(s[31]=i("div",{class:"mt-4"},[i("p",{class:"text-sm text-gray-500"}," Documents will be uploaded to the project's Google Drive folder. ")],-1))])])])):p("",!0),U.value==="notes"?(r(),l("div",ta,[i("div",sa,[m(V,{value:"Notes"}),i("div",aa,[(r(!0),l(O,null,R(e.notes,(a,f)=>(r(),l("div",{key:f,class:"mb-4"},[i("div",oa,[K(i("textarea",{"onUpdate:modelValue":x=>a.content=x,readonly:!u(G),placeholder:"Note Content",class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full h-32"},null,8,na),[[Pe,a.content]])])]))),128))]),m(I,{message:k.value.notes?k.value.notes[0]:"",class:"mt-2"},null,8,["message"])])])):p("",!0),i("div",ra,[m(Re,{onClick:Ie},{default:Y(()=>s[32]||(s[32]=[z("Close")])),_:1,__:[32]})])],32)])}}};export{pa as _};
