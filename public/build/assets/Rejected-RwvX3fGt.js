import{c as y,E as B,r as d,C as M,e as N,f as A,a as n,o as r,d as i,u as P,h as D,w as c,b as s,i as j,t as p,F as R,l as I,m as _,s as L,g as U}from"./app-CcSAzmBw.js";import{_ as Y}from"./AuthenticatedLayout-zRDpj2iX.js";import{_ as E}from"./PrimaryButton-CGyaqSV5.js";import{_ as T}from"./SecondaryButton-D1vuT-lC.js";import{_ as $}from"./InputLabel-ZXmhB59o.js";import{_ as q}from"./TextInput-5UhV8dY0.js";import{_ as C}from"./InputError-BIAtq_fL.js";import{_ as z}from"./Modal-Cd1Ld6K7.js";import"./vue-multiselect-D-MLvUDi.js";import{R as O}from"./RichTextEditor-KqW1eJ9x.js";import"./index-C-_TsGkP.js";import"./BaseFormModal-DvACVTk8.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./SelectDropdown-DcBtX4i8.js";/* empty css                                                                       */import"./debounce-C-hnF4Z3.js";import"./ApplicationLogo-B1Av4EbZ.js";import"./DangerButton-pd7veRVi.js";import"./moment-BLMuvzoS.js";import"./NoticeboardModal-CboiTIxa.js";const G={class:"py-12"},H={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},J={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},K={class:"p-6 text-gray-900"},Q={key:0,class:"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative mb-4",role:"alert"},W={class:"block sm:inline"},X={key:1,class:"text-gray-600"},Z={key:2,class:"text-red-600"},ee={key:3,class:"text-gray-600"},te={key:4},se={class:"min-w-full divide-y divide-gray-200"},ae={class:"bg-white divide-y divide-gray-200"},oe={class:"px-6 py-4 truncate max-w-xs"},ie={class:"px-6 py-4 truncate max-w-xs"},le={class:"px-6 py-4 whitespace-nowrap"},re={class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium"},de={class:"p-6"},ne={key:0},ue={class:"mb-2"},ce={class:"mb-4"},me={class:"mb-6"},pe={class:"mt-6 flex justify-end space-x-2"},Pe={__name:"Rejected",setup(ve){const k=y(()=>B().props.auth.user),b=d([]),x=d([]),g=d([]),w=d(!0),l=d(""),m=d(""),v=d(!1),f=d(null),o=M({project_id:"",client_id:"",client_ids:[],subject:"",body:""}),u=d({});y(()=>k.value.role==="contractor"?x.value.filter(e=>e.users&&e.users.some(t=>t.id===k.value.id)):x.value),y(()=>{const e=x.value.find(t=>t.id===o.project_id);return e&&Array.isArray(g.value)?g.value.find(t=>t.id===e.client_id):null}),y(()=>{if(!o.project_id)return[];const e=x.value.find(a=>a.id===o.project_id);if(!e||!e.clients)return[];const t=e.clients.map(a=>a.id);return g.value.filter(a=>t.includes(a.id))});const h=async()=>{w.value=!0,l.value="";try{const e=await window.axios.get("/api/emails/rejected-simplified");b.value=e.data}catch(e){l.value="Failed to load data.",console.error("Error fetching initial data:",e),e.response&&(e.response.status===401||e.response.status===403)&&(l.value="You are not authorized to view this content or your session expired. Please log in.")}finally{w.value=!1}},V=e=>{f.value=e,o.subject=e.subject,o.body=e.body,u.value={},v.value=!0},S=async()=>{u.value={},l.value="";try{const e={subject:o.subject,body:o.body};await window.axios.put(`/api/emails/${f.value.id}`,e),m.value="Email updated successfully! You can now resubmit it.",await h()}catch(e){e.response&&e.response.status===422?u.value=e.response.data.errors:e.response&&e.response.data.message?l.value=e.response.data.message:(l.value="Failed to update email.",console.error("Error updating email:",e))}},F=async()=>{u.value={},l.value="";try{await window.axios.post(`/api/emails/${f.value.id}/resubmit`),m.value="Email resubmitted for approval successfully!",v.value=!1,await h()}catch(e){e.response&&e.response.data.message?l.value=e.response.data.message:(l.value="Failed to resubmit email.",console.error("Error resubmitting email:",e))}};return N(()=>o.project_id,e=>{o.client_ids=[]}),A(()=>{h()}),(e,t)=>(r(),n(R,null,[i(P(D),{title:"Rejected Emails"}),i(Y,null,{header:c(()=>t[4]||(t[4]=[s("h2",{class:"font-semibold text-xl text-gray-800 leading-tight"},"Rejected Emails",-1)])),default:c(()=>[s("div",G,[s("div",H,[s("div",J,[s("div",K,[t[7]||(t[7]=s("h3",{class:"text-2xl font-bold mb-4"},"Your Rejected Emails",-1)),m.value?(r(),n("div",Q,[s("span",W,p(m.value),1)])):j("",!0),w.value?(r(),n("div",X,"Loading rejected emails...")):l.value?(r(),n("div",Z,p(l.value),1)):b.value.length===0?(r(),n("div",ee,"No rejected emails found.")):(r(),n("div",te,[s("table",se,[t[6]||(t[6]=s("thead",{class:"bg-gray-50"},[s("tr",null,[s("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Subject"),s("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Rejection Reason"),s("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Submitted On"),s("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Actions")])],-1)),s("tbody",ae,[(r(!0),n(R,null,I(b.value,a=>(r(),n("tr",{key:a.id},[s("td",oe,p(a.subject),1),s("td",ie,p(a.rejection_reason),1),s("td",le,p(new Date(a.created_at).toLocaleString()),1),s("td",re,[i(E,{onClick:fe=>V(a)},{default:c(()=>t[5]||(t[5]=[_("View/Edit",-1)])),_:2,__:[5]},1032,["onClick"])])]))),128))])])]))])])])]),i(z,{show:v.value,onClose:t[3]||(t[3]=a=>v.value=!1),"max-width":"3xl"},{default:c(()=>[s("div",de,[t[13]||(t[13]=s("h2",{class:"text-2xl font-bold text-gray-900 mb-4"},"Edit Rejected Email",-1)),f.value?(r(),n("div",ne,[s("p",ue,[t[8]||(t[8]=s("strong",null,"Rejection Reason:",-1)),_(" "+p(f.value.rejection_reason),1)]),t[12]||(t[12]=s("hr",{class:"my-4"},null,-1)),s("form",{onSubmit:L(S,["prevent"])},[s("div",ce,[i($,{for:"subject",value:"Subject"}),i(q,{id:"subject",type:"text",class:"mt-1 block w-full",modelValue:o.subject,"onUpdate:modelValue":t[0]||(t[0]=a=>o.subject=a),required:""},null,8,["modelValue"]),i(C,{message:u.value.subject?u.value.subject[0]:"",class:"mt-2"},null,8,["message"])]),s("div",me,[i($,{for:"body",value:"Email Body"}),i(O,{id:"body",modelValue:o.body,"onUpdate:modelValue":t[1]||(t[1]=a=>o.body=a),placeholder:"Edit your email here...",height:"300px"},null,8,["modelValue"]),i(C,{message:u.value.body?u.value.body[0]:"",class:"mt-2"},null,8,["message"])]),s("div",pe,[i(T,{onClick:t[2]||(t[2]=a=>v.value=!1)},{default:c(()=>t[9]||(t[9]=[_("Cancel",-1)])),_:1,__:[9]}),i(E,{type:"submit"},{default:c(()=>t[10]||(t[10]=[_("Save Changes",-1)])),_:1,__:[10]}),m.value?(r(),U(E,{key:0,onClick:F,disabled:!m.value},{default:c(()=>t[11]||(t[11]=[_("Resubmit for Approval",-1)])),_:1,__:[11]},8,["disabled"])):j("",!0)])],32)])):j("",!0)])]),_:1},8,["show"])]),_:1})],64))}};export{Pe as default};
