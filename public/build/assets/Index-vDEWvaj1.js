import{r as x,c as B,e as ue,g as G,o as n,w as q,b as e,a as i,i as S,d as c,D as E,t as g,E as Ge,G as Ce,m as I,j as Z,v as Y,F as ee,l as ne,x as Je,z as yt,u as d,n as wt,k as ce,q as _t,f as kt,h as Ct,H as $t,I as Dt,J as pe,K as jt}from"./app-3py7x8f1.js";import{B as ge,a as Mt,_ as St}from"./AuthenticatedLayout-D8vCwVin.js";import{S as ve}from"./SelectDropdown-86Cxrjx1.js";import{P as ie}from"./PrimaryButton-CRiK8rbu.js";import{_ as Qe}from"./SecondaryButton-CQZ-c5NM.js";import{c as J,a as me,d as At,f as X,b as Bt}from"./currency-Dz7UPZ5I.js";import{_ as te}from"./InputLabel-Cnai-htk.js";import{_ as le}from"./TextInput-c4VObcBL.js";import{_ as oe}from"./InputError-Dm9zJ05G.js";import{_ as Pt}from"./Modal-9WYwIiGU.js";import{r as _e,a as Tt}from"./PlusIcon-BqamQDMy.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./Checkbox-jTHl9ced.js";import"./ApplicationLogo-Dkp_J6mJ.js";import"./DangerButton-BHAUTJIS.js";import"./moment-BLMuvzoS.js";const Vt={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Rt={key:0},Lt={class:"md:col-span-2"},Ze={__name:"MilestoneExpendableModal",props:{show:Boolean,title:String,milestone:Object,users:Object,currencyOptions:Array,isBudgetForm:{type:Boolean,default:!1},isUserSelectionRequired:{type:Boolean,default:!1},projectTotalBudget:Number,projectBudgetCurrency:String,milestoneStats:Object},emits:["close","submitted"],setup(f,{emit:V}){const l=f,$=V,s=x({}),p=x(""),M=x("post"),w=x(""),k=x(""),h=x({}),_=B(()=>{var C;return((Array.isArray((C=l.users)==null?void 0:C.users)?l.users.users:l.users)||[]).map(L=>({value:L.id,label:L.name}))});ue(()=>l.show,a=>{a&&l.milestone&&(h.value={},l.isBudgetForm?(s.value=l.milestone.budget?{...l.milestone.budget,amount:Number(l.milestone.budget.amount)}:{name:"Milestone Budget",description:"",amount:"",currency:"PKR"},p.value=l.milestone.budget?`/api/projects/${l.milestone.project_id}/expendables/${l.milestone.budget.id}`:`/api/projects/${l.milestone.project_id}/expendables`,M.value=l.milestone.budget?"put":"post",w.value=l.milestone.budget?"Update Budget":"Create Budget",k.value=l.milestone.budget?"Milestone budget updated successfully":"Milestone budget created successfully"):(s.value={name:"",description:"",amount:"",currency:"PKR",user_id:null},p.value=`/api/projects/${l.milestone.project_id}/expendables`,M.value="post",w.value="Create Contract",k.value="Contract created and sent for approval"))},{immediate:!0,deep:!0});const D=()=>{var L,z;h.value={};let a=!1;s.value.name||(h.value.name=["Name is required."],a=!0),(!s.value.amount||Number(s.value.amount)<=0)&&(h.value.amount=h.value.amount||[],h.value.amount.push("Amount must be a positive number."),a=!0),l.isUserSelectionRequired&&!s.value.user_id&&(h.value.user_id=["User selection is required for contracts."],a=!0),J(Number(s.value.amount||0),s.value.currency,l.projectBudgetCurrency);const C=J(Number(s.value.amount||0),s.value.currency,((L=l.milestone.budget)==null?void 0:L.currency)||"PKR");if(l.isBudgetForm){l.projectTotalBudget<=0&&(E("No project budget left. Ask a project admin to add more budget."),a=!0);const N=l.milestone.budget?J(Number(l.milestone.budget.amount||0),l.milestone.budget.currency,l.projectBudgetCurrency):0;l.milestoneStats.approvedAmt+(C-N)>J(l.projectTotalBudget,l.projectBudgetCurrency,((z=l.milestone.budget)==null?void 0:z.currency)||"PKR")&&(h.value.amount=["Cannot add more budget than the project's total expendable budget."],a=!0)}else C>l.milestoneStats.remaining&&(h.value.amount=["Cannot add a contract more than the remaining milestone budget."],a=!0);return!a},P=a=>({...a,amount:Number(a.amount||0),user_id:l.isBudgetForm?null:a.user_id,expendable_type:"Milestone",expendable_id:l.milestone.id}),R=a=>{$("submitted",a)},F=()=>{$("close")};return(a,C)=>(n(),G(ge,{show:f.show,title:f.title,"api-endpoint":p.value,"http-method":M.value,"form-data":s.value,"submit-button-text":w.value,"success-message":k.value,"format-data-for-api":P,"before-submit":D,onSubmitted:R,onClose:F},{default:q(({errors:L})=>{var z,N,W,Q,b,m,O,u,j,T;return[e("div",Vt,[e("div",null,[c(te,{for:"name",value:"Name"}),c(le,{id:"name",modelValue:s.value.name,"onUpdate:modelValue":C[0]||(C[0]=U=>s.value.name=U),class:"mt-1 w-full",placeholder:"e.g., Asset Purchase"},null,8,["modelValue"]),c(oe,{message:((z=h.value.name)==null?void 0:z[0])||((N=L.name)==null?void 0:N[0]),class:"mt-1"},null,8,["message"])]),e("div",null,[c(te,{for:"amount",value:"Amount"}),c(le,{id:"amount",type:"number",step:"0.01",modelValue:s.value.amount,"onUpdate:modelValue":C[1]||(C[1]=U=>s.value.amount=U),class:"mt-1 w-full"},null,8,["modelValue"]),c(oe,{message:((W=h.value.amount)==null?void 0:W[0])||((Q=L.amount)==null?void 0:Q[0]),class:"mt-1"},null,8,["message"])]),e("div",null,[c(te,{for:"currency",value:"Currency"}),c(ve,{id:"currency",modelValue:s.value.currency,"onUpdate:modelValue":C[2]||(C[2]=U=>s.value.currency=U),options:f.currencyOptions,"value-key":"value","label-key":"label",class:"mt-1 w-full"},null,8,["modelValue","options"]),c(oe,{message:((b=h.value.currency)==null?void 0:b[0])||((m=L.currency)==null?void 0:m[0]),class:"mt-1"},null,8,["message"])]),f.isBudgetForm?S("",!0):(n(),i("div",Rt,[c(te,{for:"user",value:"User"}),c(ve,{id:"user",modelValue:s.value.user_id,"onUpdate:modelValue":C[3]||(C[3]=U=>s.value.user_id=U),options:_.value,"value-key":"value","label-key":"label",class:"mt-1 w-full",placeholder:"Select user"},null,8,["modelValue","options"]),c(oe,{message:((O=h.value.user_id)==null?void 0:O[0])||((u=L.user_id)==null?void 0:u[0]),class:"mt-1"},null,8,["message"])])),e("div",Lt,[c(te,{for:"description",value:"Description (optional)"}),c(le,{id:"description",modelValue:s.value.description,"onUpdate:modelValue":C[4]||(C[4]=U=>s.value.description=U),class:"mt-1 w-full",placeholder:"Details"},null,8,["modelValue"]),c(oe,{message:((j=h.value.description)==null?void 0:j[0])||((T=L.description)==null?void 0:T[0]),class:"mt-1"},null,8,["message"])])])]}),_:1},8,["show","title","api-endpoint","http-method","form-data","submit-button-text","success-message"]))}};function ke(f,V){return n(),i("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99"})])}function ze(f,V){return n(),i("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9 12.75 11.25 15 15 9.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"})])}function Nt(f,V){return n(),i("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m19.5 8.25-7.5 7.5-7.5-7.5"})])}function It(f,V){return n(),i("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z"})])}function Ft(f,V){return n(),i("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"})])}function Ut(f,V){return n(),i("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 9v6m3-3H9m12 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"})])}function Et(f,V){return n(),i("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"})])}function qt(f,V){return n(),i("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M21 12a2.25 2.25 0 0 0-2.25-2.25H15a3 3 0 1 1-6 0H5.25A2.25 2.25 0 0 0 3 12m18 0v6a2.25 2.25 0 0 1-2.25 2.25H5.25A2.25 2.25 0 0 1 3 18v-6m18 0V9M3 12V9m18 0a2.25 2.25 0 0 0-2.25-2.25H5.25A2.25 2.25 0 0 0 3 9m18 0V6a2.25 2.25 0 0 0-2.25-2.25H5.25A2.25 2.25 0 0 0 3 6v3"})])}function Ot(f,V){return n(),i("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m9.75 9.75 4.5 4.5m0-4.5-4.5 4.5M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"})])}const Ht={class:"text-sm text-gray-600 mb-4"},Kt={class:"mt-2"},Yt={__name:"ReasonModal",props:{show:{type:Boolean,default:!1},title:{type:String,default:"Reason Required"},message:{type:String,required:!0},type:{type:String,default:"info",validator:f=>["info","warning"].includes(f)},apiEndpoint:{type:String,required:!0},httpMethod:{type:String,required:!0}},emits:["submitted","close"],setup(f,{emit:V}){const l=f,$=V,s=x({reason:""}),p=x({}),M=()=>!s.value.reason||!s.value.reason.trim()?(E("Reason is required."),p.value.reason=["Reason is required."],!1):(p.value={},!0),w=()=>{$("submitted")},k=()=>{$("close")};return ue(()=>l.show,h=>{h&&(s.value={reason:""},p.value={})}),(h,_)=>(n(),G(ge,{show:f.show,title:f.title,"api-endpoint":f.apiEndpoint,"http-method":f.httpMethod,"form-data":s.value,"submit-button-text":"Submit","success-message":"Operation successful!","before-submit":M,onClose:k,onSubmitted:w},{default:q(({errors:D})=>{var P,R;return[e("p",Ht,g(f.message),1),e("div",Kt,[c(te,{for:"reason-input",value:"Reason"}),c(le,{id:"reason-input",modelValue:s.value.reason,"onUpdate:modelValue":_[0]||(_[0]=F=>s.value.reason=F),class:"mt-1 block w-full",onKeyup:Ge(w,["enter"])},null,8,["modelValue"]),c(oe,{message:((P=D.reason)==null?void 0:P[0])||((R=p.value.reason)==null?void 0:R[0]),class:"mt-1"},null,8,["message"])])]}),_:1},8,["show","title","api-endpoint","http-method","form-data"]))}},Zt={class:"space-y-4"},zt={key:1,id:"final-task-list",class:"space-y-3"},Gt={class:"flex items-center justify-between"},Jt={class:"flex-1"},Qt=["onClick"],Wt={key:0,class:"mt-0.5 text-xs text-gray-600 truncate"},Xt=["id","value","onBlur","onKeyup"],eo={class:"flex items-center space-x-2 ml-4"},to=["onClick"],oo=["onClick"],so={key:0,class:"mt-4"},no=["onUpdate:modelValue"],lo={class:"flex flex-col sm:flex-row sm:items-center space-y-2 sm:space-y-0 sm:space-x-4 text-xs text-gray-500 mt-2"},ao={class:"flex items-center space-x-2"},ro=["onClick"],io=["onClick"],uo=["value","onChange","min","max"],co={class:"flex items-center space-x-2"},po=["onClick"],mo=["onClick"],vo=["onClick"],go={class:"flex justify-end space-x-3"},fo={__name:"BulkTaskModal",props:{show:{type:Boolean,default:!1},contractId:{type:Number,required:!0},completionDate:{type:String,required:!1,default:null}},emits:["close","tasks-submitted"],setup(f,{emit:V}){const l=f,$=V,s=Ce([]),p=x(""),M=x({show:!1,text:"",type:"success"}),w=new Date,k=new Date(w);k.setDate(w.getDate()+1);const h=x("");ue(()=>l.show,b=>{b||(s.splice(0,s.length),p.value="",h.value="",M.value={show:!1,text:"",type:"success"})});const _=()=>{h.value&&h.value.trim()!==""&&(s.push({name:h.value,dueDate:"",priority:"Medium",contract_id:l.contractId,description:"",isEditingName:!1,showDescription:!1}),h.value="",M.value.show=!1)},D=b=>{s.splice(b,1)},P=(b,m)=>{s[b].priority=m},R=(b,m)=>{const O=new Date(w.getFullYear(),w.getMonth(),w.getDate()),u=l.completionDate?new Date(l.completionDate):null,j=new Date(m);if(M.value.show=!1,u&&j>u){M.value={show:!0,text:"The selected due date is after the milestone completion date.",type:"error"},s[b].dueDate="";return}if(j<O){M.value={show:!0,text:"The selected due date cannot be in the past.",type:"error"},s[b].dueDate="";return}s[b].dueDate=m},F=b=>{s[b].showDescription=!s[b].showDescription},a=b=>{s[b].isEditingName=!0,wt(()=>{document.getElementById(`task-name-input-${b}`).focus()})},C=(b,m)=>{m.trim()&&(s[b].name=m),s[b].isEditingName=!1},L=b=>({tasks:b}),z=B(()=>s.length===0||s.some(b=>!b.name.trim()||!b.dueDate||!b.priority)),N=b=>{console.log("Submitting tasks to API:",s),M.value={show:!0,text:"Tasks submitted successfully!",type:"success"},setTimeout(()=>{M.value.show=!1,$("tasks-submitted"),b()},1500)},W=B(()=>s),Q=b=>{const m=l.completionDate?new Date(l.completionDate):null,O=new Date(w.getFullYear(),w.getMonth(),w.getDate()),u=new Date(b);return u>=O&&(!m||u<=m)};return(b,m)=>(n(),G(ge,{show:f.show,title:"Create Tasks in Bulk","api-endpoint":"/api/tasks/bulk","http-method":"post","form-data":W.value,"format-data-for-api":L,"submit-button-text":"Create Tasks",onClose:m[1]||(m[1]=O=>b.$emit("close")),onSubmitted:N},{default:q(({errors:O})=>[e("div",Zt,[M.value.show?(n(),i("div",{key:0,class:Z(["mb-4 p-4 rounded-lg transition-all duration-300 ease-in-out",{"bg-green-100 text-green-700 border border-green-200":M.value.type==="success","bg-red-100 text-red-700 border border-red-200":M.value.type==="error"}])},g(M.value.text),3)):S("",!0),e("form",{onSubmit:Y(_,["prevent"]),class:"relative"},[c(le,{modelValue:h.value,"onUpdate:modelValue":m[0]||(m[0]=u=>h.value=u),id:"task-name-input",placeholder:"e.g., 'Finish project report'",class:"w-full p-4 pr-12 text-lg border border-gray-300 rounded-xl focus:ring-indigo-500 focus:border-indigo-500 shadow-sm transition-all duration-200 ease-in-out"},null,8,["modelValue"]),m[2]||(m[2]=e("button",{type:"submit",class:"absolute right-4 top-1/2 -translate-y-1/2 p-2 text-indigo-600 hover:text-indigo-800"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})])],-1))],32),m[8]||(m[8]=e("hr",{class:"my-6 border-gray-200"},null,-1)),s.length>0?(n(),i("div",zt,[m[7]||(m[7]=e("h2",{class:"text-lg font-semibold text-gray-800"},"Tasks to Create:",-1)),(n(!0),i(ee,null,ne(s,(u,j)=>(n(),i("div",{key:j,class:"flex flex-col p-4 bg-gray-50 rounded-xl border border-gray-200 group transition-all duration-200 ease-in-out"},[e("div",Gt,[e("div",Jt,[u.isEditingName?(n(),i("input",{key:1,id:`task-name-input-${j}`,type:"text",value:u.name,onBlur:T=>C(j,T.target.value),onKeyup:Ge(T=>C(j,T.target.value),["enter"]),class:"text-sm font-semibold text-gray-800 w-full rounded-md border-gray-300 focus:ring-indigo-500 focus:border-indigo-500 shadow-sm"},null,40,Xt)):(n(),i(ee,{key:0},[e("p",{onClick:T=>a(j),class:"text-sm font-semibold text-gray-800 truncate cursor-pointer hover:underline"},g(u.name),9,Qt),u.description&&u.description.trim().length?(n(),i("p",Wt,g(u.description),1)):S("",!0)],64))]),e("div",eo,[e("button",{type:"button",onClick:T=>F(j),class:Z(["p-1 rounded-full transition-all duration-200 ease-in-out",[u.showDescription||u.description&&u.description.trim().length?"text-indigo-600 hover:text-indigo-700":"text-gray-400 hover:text-indigo-500"]]),title:"Add description"},m[3]||(m[3]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",class:"h-5 w-5"},[e("path",{d:"M19.5 14.25h-15m15-5.25h-15M9 19.5H4.5A1.5 1.5 0 013 18V6a1.5 1.5 0 011.5-1.5H15L21 9v9a1.5 1.5 0 01-1.5 1.5H15"})],-1)]),10,to),e("button",{type:"button",onClick:T=>D(j),class:"remove-final-task p-1 rounded-full text-red-500 opacity-0 group-hover:opacity-100 transition-all duration-200 ease-in-out"},m[4]||(m[4]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z","clip-rule":"evenodd"})],-1)]),8,oo)])]),u.showDescription?(n(),i("div",so,[Je(e("textarea",{"onUpdate:modelValue":T=>u.description=T,rows:"2",placeholder:"Add an optional description...",class:"w-full rounded-md border-gray-300 focus:ring-indigo-500 focus:border-indigo-500 shadow-sm text-sm"},null,8,no),[[yt,u.description]])])):S("",!0),e("div",lo,[e("div",ao,[m[5]||(m[5]=e("span",{class:"font-medium"},"Due:",-1)),Q(d(w).toISOString().split("T")[0])?(n(),i("button",{key:0,type:"button",onClick:T=>R(j,d(w).toISOString().split("T")[0]),class:Z(["px-2 py-0.5 rounded-full text-indigo-600 bg-indigo-100 text-xs hover:bg-indigo-200",{"bg-indigo-300 font-semibold":u.dueDate===d(w).toISOString().split("T")[0]}])},"Today",10,ro)):S("",!0),Q(d(k).toISOString().split("T")[0])?(n(),i("button",{key:1,type:"button",onClick:T=>R(j,d(k).toISOString().split("T")[0]),class:Z(["px-2 py-0.5 rounded-full text-indigo-600 bg-indigo-100 text-xs hover:bg-indigo-200",{"bg-indigo-300 font-semibold":u.dueDate===d(k).toISOString().split("T")[0]}])},"Tomorrow",10,io)):S("",!0),e("input",{type:"date",value:u.dueDate,onChange:T=>R(j,T.target.value),min:d(w).toISOString().split("T")[0],max:f.completionDate,required:"",class:Z([u.dueDate?"border-gray-300":"border-red-300","p-1 rounded-lg border text-xs focus:ring-indigo-500 focus:border-indigo-500 shadow-sm transition-all duration-200 ease-in-out"])},null,42,uo)]),e("div",co,[m[6]||(m[6]=e("span",{class:"font-medium"},"Priority:",-1)),e("button",{type:"button",onClick:T=>P(j,"Low"),class:Z(["px-2 py-0.5 rounded-full text-gray-500 bg-gray-100 text-xs hover:bg-gray-200",{"bg-gray-200 font-semibold":u.priority==="Low"}])},"Low",10,po),e("button",{type:"button",onClick:T=>P(j,"Medium"),class:Z(["px-2 py-0.5 rounded-full text-blue-600 bg-blue-100 text-xs hover:bg-blue-200",{"bg-blue-200 font-semibold":u.priority==="Medium"}])},"Medium",10,mo),e("button",{type:"button",onClick:T=>P(j,"High"),class:Z(["px-2 py-0.5 rounded-full text-red-600 bg-red-100 text-xs hover:bg-red-200",{"bg-red-200 font-semibold":u.priority==="High"}])},"High",10,vo)])])]))),128))])):S("",!0)])]),footer:q(({close:O})=>[e("div",go,[c(Qe,{onClick:O,type:"button"},{default:q(()=>m[9]||(m[9]=[I(" Cancel ",-1)])),_:2,__:[9]},1032,["onClick"]),c(ie,{type:"submit",disabled:z.value,class:Z({"opacity-50 cursor-not-allowed":z.value})},{default:q(()=>m[10]||(m[10]=[I(" Create Tasks ",-1)])),_:1,__:[10]},8,["disabled","class"])])]),_:1},8,["show","form-data"]))}},bo={class:"space-y-3"},ho={__name:"MilestoneCompletionDateModal",props:{show:{type:Boolean,default:!1},milestoneId:{type:[Number,String],required:!0},initialCompletionDate:{type:String,default:null}},emits:["close","updated"],setup(f,{emit:V}){const l=f,$=V,s=Ce({completion_date:l.initialCompletionDate||null}),p=Ce({completion_date:null});ue(()=>l.show,_=>{_&&(s.completion_date=l.initialCompletionDate||null,p.completion_date=null)});const M=B(()=>`/api/milestones/${l.milestoneId}`),w=()=>(p.completion_date=null,s.completion_date?!0:(p.completion_date=["Completion date is required."],!1)),k=_=>{$("updated",_),$("close")},h=()=>$("close");return(_,D)=>(n(),G(ge,{show:f.show,title:"Set Milestone Completion Date","api-endpoint":M.value,"http-method":"put","form-data":s,"submit-button-text":"Save Date","success-message":"Milestone updated","before-submit":w,onClose:h,onSubmitted:k},{default:q(({errors:P})=>{var R,F;return[e("div",bo,[D[1]||(D[1]=e("p",{class:"text-sm text-gray-600"}," This milestone does not have a completion date. Please set it to continue creating tasks for its contracts. ",-1)),e("div",null,[c(te,{for:"milestone-completion-date",value:"Completion Date"}),c(le,{id:"milestone-completion-date",modelValue:s.completion_date,"onUpdate:modelValue":D[0]||(D[0]=a=>s.completion_date=a),type:"date",class:"mt-1 block w-full",required:""},null,8,["modelValue"]),c(oe,{message:((R=P.completion_date)==null?void 0:R[0])||((F=p.completion_date)==null?void 0:F[0]),class:"mt-1"},null,8,["message"])])])]}),_:1},8,["show","api-endpoint","form-data"]))}},xo={class:"mt-6 space-y-4"},yo={class:"flex items-center justify-between mb-2"},wo={class:"text-sm font-medium text-gray-700"},_o={class:"text-sm text-gray-600"},ko={class:"w-full h-3 bg-gray-200 rounded-full overflow-hidden"},Co={class:"flex items-center justify-between mb-2"},$o={class:"text-sm font-medium text-gray-700"},Do={key:0,class:"text-xs text-gray-500"},jo={class:"relative w-full h-3 bg-gray-200 rounded-full overflow-hidden"},Mo={key:0,class:"relative mt-2 h-4"},So=["title"],Ao={__name:"ProjectProgressTimeline",props:{milestones:{type:Array,default:()=>[]},showTicks:{type:Boolean,default:!0},title:{type:String,default:"Project Progress & Timeline"},progressLabel:{type:String,default:"Project Progress"},timelineLabel:{type:String,default:"Timeline"}},setup(f){const V=f,l=B(()=>(V.milestones||[]).filter(_=>!!(_!=null&&_.completion_date))),$=B(()=>[...l.value].sort((_,D)=>{const P=new Date(_.completion_date),R=new Date(D.completion_date);return P-R})),s=B(()=>(V.milestones||[]).length),p=B(()=>(V.milestones||[]).filter(_=>{const D=((_==null?void 0:_.status)||"").toLowerCase();return D==="completed"||D==="approved"}).length),M=B(()=>s.value?Math.round(p.value/s.value*100):0),w=B(()=>$.value.length?new Date($.value[0].completion_date):null),k=B(()=>$.value.length?new Date($.value[$.value.length-1].completion_date):null),h=B(()=>{if(!w.value||!k.value)return 0;const _=C=>new Date(C.getFullYear(),C.getMonth(),C.getDate(),12,0,0),D=_(w.value),P=_(k.value),R=_(new Date),F=P-D;if(F<=0)return 100;let a=(R-D)/F*100;return a<0&&(a=0),a>100&&(a=100),Math.round(a)});return(_,D)=>(n(),i("div",xo,[e("div",null,[e("div",yo,[e("span",wo,g(f.progressLabel),1),e("span",_o,g(p.value)+" / "+g(s.value)+" milestones ("+g(M.value)+"%)",1)]),e("div",ko,[e("div",{class:"h-3 bg-indigo-600",style:ce({width:M.value+"%"})},null,4)])]),e("div",null,[e("div",Co,[e("span",$o,g(f.timelineLabel),1),w.value&&k.value?(n(),i("span",Do,g(new Date(w.value).toLocaleDateString())+" — "+g(new Date(k.value).toLocaleDateString()),1)):S("",!0)]),e("div",jo,[e("div",{class:"h-3 bg-emerald-500",style:ce({width:h.value+"%"})},null,4),w.value&&k.value?(n(),i("div",{key:0,class:"absolute top-1/2 -translate-y-1/2",style:ce({left:`calc(${h.value}% - 6px)`})},D[0]||(D[0]=[e("div",{class:"w-3 h-3 rounded-full bg-emerald-700 border-2 border-white shadow"},null,-1)]),4)):S("",!0)]),f.showTicks&&$.value.length?(n(),i("div",Mo,[(n(!0),i(ee,null,ne($.value,(P,R)=>(n(),i("div",{key:P.id||R,class:"absolute top-1/2 -translate-y-1/2 w-2 h-2 rounded-full bg-gray-400",style:ce({left:`${Math.round((new Date(P.completion_date)-new Date($.value[0].completion_date))/(new Date($.value[$.value.length-1].completion_date)-new Date($.value[0].completion_date)||1)*100)}%`}),title:`${P.name||"Milestone"}: ${new Date(P.completion_date).toLocaleDateString()}`},null,12,So))),128))])):S("",!0)])]))}},Bo={class:"flex flex-col md:flex-row items-start md:items-center justify-between gap-4"},Po={class:"flex items-center gap-3 w-full md:w-auto"},To={class:"flex-grow md:flex-grow-0 w-full md:w-64"},Vo={class:"w-24 md:w-32 flex-shrink-0"},Ro={class:"py-8"},Lo={class:"max-w-7xl mx-auto sm:px-6 lg:px-8 space-y-6"},No={key:0},Io={class:"bg-white rounded-xl p-6 shadow-sm"},Fo={class:"grid grid-cols-1 md:grid-cols-3 gap-6"},Uo={class:"bg-green-50 rounded-lg p-5 shadow-sm flex flex-col justify-between"},Eo={class:"text-3xl font-bold text-green-900"},qo={class:"bg-yellow-50 rounded-lg p-5 shadow-sm flex flex-col justify-between"},Oo={class:"text-3xl font-bold text-yellow-900"},Ho={class:"bg-blue-50 rounded-lg p-5 shadow-sm flex flex-col justify-between"},Ko={class:"text-3xl font-bold text-blue-900"},Yo={class:"bg-white rounded-xl shadow-sm p-6"},Zo={class:"flex flex-col sm:flex-row items-start sm:items-center justify-between border-b pb-4 mb-4"},zo={class:"flex items-center gap-2"},Go={class:"flex space-x-2 mt-2 sm:mt-0"},Jo=["onClick"],Qo={key:0,class:"text-center text-gray-500 py-12"},Wo={key:1},Xo={key:0,class:"text-center text-gray-500 py-12"},es={key:1,class:"text-center text-gray-500 py-12"},ts={key:2,class:"space-y-4"},os=["onClick"],ss={class:"flex-grow"},ns={class:"font-bold text-lg text-gray-900 mb-1"},ls={key:0,class:"text-sm text-gray-600"},as={class:"mt-1 text-xs text-gray-500 flex items-center gap-2"},rs={key:0},is={class:"font-medium text-gray-700"},us={key:1},ds={class:"flex items-center gap-4 text-sm text-gray-700"},cs={class:"hidden sm:flex items-center gap-4"},ps={class:"inline-flex items-center gap-1 text-gray-600"},ms={class:"font-semibold text-gray-800"},vs={class:"inline-flex items-center gap-1 text-gray-600"},gs={class:"font-semibold text-green-700"},fs={class:"inline-flex items-center gap-1 text-gray-600"},bs={class:"font-semibold text-blue-700"},hs=["onClick"],xs={class:"flex items-center gap-2"},ys=["onClick"],ws=["onClick"],_s={class:"border-t border-gray-200 p-5 bg-white rounded-b-xl"},ks={class:"mb-5"},Cs={class:"flex flex-wrap gap-2 text-xs"},$s={class:"inline-flex items-center gap-1 px-2 py-1 rounded-full bg-gray-100 text-gray-700"},Ds={class:"font-semibold"},js={class:"inline-flex items-center gap-1 px-2 py-1 rounded-full bg-slate-100 text-slate-700"},Ms={class:"font-semibold"},Ss={class:"inline-flex items-center gap-1 px-2 py-1 rounded-full bg-blue-100 text-blue-700"},As={class:"font-semibold"},Bs={class:"inline-flex items-center gap-1 px-2 py-1 rounded-full bg-yellow-100 text-yellow-700"},Ps={class:"font-semibold"},Ts={class:"inline-flex items-center gap-1 px-2 py-1 rounded-full bg-orange-100 text-orange-700"},Vs={class:"font-semibold"},Rs={class:"inline-flex items-center gap-1 px-2 py-1 rounded-full bg-green-100 text-green-700"},Ls={class:"font-semibold"},Ns={class:"inline-flex items-center gap-1 px-2 py-1 rounded-full bg-red-100 text-red-700"},Is={class:"font-semibold"},Fs={class:"flex justify-between items-center mb-4"},Us={class:"flex items-center gap-2"},Es={key:0,class:"text-center text-gray-500 text-sm py-4"},qs={key:1,class:"space-y-2"},Os={class:"flex items-center gap-2"},Hs={key:0,class:"text-gray-600 text-xs sm:text-sm"},Ks={class:"font-medium"},Ys={class:"flex items-center gap-4 mt-2 sm:mt-0"},Zs={class:"text-right"},zs={class:"font-semibold"},Gs={key:0,class:"text-gray-500 block text-xs"},Js={class:"flex gap-1.5"},Qs=["onClick"],Ws=["onClick"],Xs=["onClick"],en=["onClick"],tn={class:"mt-6 pt-4 border-t border-gray-200 flex flex-col items-start gap-2"},on={class:"flex flex-wrap items-center gap-3"},sn={key:0,class:"text-sm text-red-600"},nn={class:"p-6 bg-white rounded-lg shadow-xl"},ln={class:"flex items-center justify-between mb-4"},an={key:0,class:"text-gray-500 text-center py-4"},rn={key:1},un={key:0,class:"text-gray-500 text-center py-4"},dn={key:1,class:"space-y-3 max-h-96 overflow-y-auto pr-2"},cn={class:"text-sm text-gray-600 flex justify-between items-center mb-1"},pn={class:"font-medium"},mn={class:"text-xs text-gray-400"},vn={class:"mt-1 text-gray-800 text-sm whitespace-pre-line"},Bn={__name:"Index",setup(f){const V=x([]),l=x(null),$=x(!1),s=x("active"),p=x([]),M=x(!1),w=x(!1),k=x(!1),h=x(!1),_=x(!1),D=x([]),P=x(!1),R=x(!1),F=x(null),a=x(null),C=x(!1),L=x(null),z=x(null),N=x(null),W=[{value:"PKR",label:"PKR"},{value:"AUD",label:"AUD"},{value:"INR",label:"INR"},{value:"USD",label:"USD"},{value:"EUR",label:"EUR"},{value:"GBP",label:"GBP"}],{canDo:Q}=_t();Q("manage_project_financial");const b=Q("approve_milestone_expendables"),m=Q("approve_expendables"),O=Q("approve_milestones"),u=At,j=x(null),T=x("PKR"),U=x([]),We=[{id:"active",label:"Active Milestones"},{id:"completed",label:"Completed"},{id:"approved",label:"Approved"}],Xe=B(()=>(p.value||[]).filter(o=>!!o.completion_date)),ae=B(()=>[...Xe.value].sort((o,t)=>{const v=new Date(o.completion_date),A=new Date(t.completion_date);return v-A})),$e=B(()=>(p.value||[]).length),et=B(()=>(p.value||[]).filter(o=>{const t=(o.status||"").toLowerCase();return t==="completed"||t==="approved"}).length);B(()=>$e.value?Math.round(et.value/$e.value*100):0);const De=B(()=>ae.value.length?new Date(ae.value[0].completion_date):null),je=B(()=>ae.value.length?new Date(ae.value[ae.value.length-1].completion_date):null);B(()=>{if(!De.value||!je.value)return 0;const o=se=>new Date(se.getFullYear(),se.getMonth(),se.getDate(),12,0,0),t=o(De.value),v=o(je.value),A=o(new Date),H=v-t;if(H<=0)return 100;let K=(A-t)/H*100;return K<0&&(K=0),K>100&&(K=100),Math.round(K)});const Me=B(()=>p.value?s.value==="active"?p.value.filter(o=>o.status.toLowerCase()==="in progress"||o.status.toLowerCase()==="not started"||o.status.toLowerCase()==="pending"):s.value==="completed"?p.value.filter(o=>o.status.toLowerCase()==="completed"):s.value==="approved"?p.value.filter(o=>o.status.toLowerCase()==="approved"):p.value:[]),tt=B(()=>!p.value||!me.value||Object.keys(me.value).length===0?0:p.value.reduce((o,t)=>t.status.toLowerCase()!=="approved"?o+(t.expendable||[]).filter(v=>v.status==="Accepted").reduce((v,A)=>v+J(parseFloat(A.amount??0),A.currency,u.value),0):o,0)),ot=B(()=>!p.value||!me.value||Object.keys(me.value).length===0?0:p.value.reduce((o,t)=>o+(t.expendable||[]).filter(v=>v.status==="Pending Approval").reduce((v,A)=>v+J(parseFloat(A.amount??0),A.currency,u.value),0),0)),st=B(()=>{if(j.value==null)return X(0,u.value);const o=J(parseFloat(j.value??0),T.value,u.value),t=p.value.reduce((v,A)=>v+(A.expendable||[]).filter(H=>H.status==="Accepted").reduce((H,K)=>H+J(parseFloat(K.amount??0),K.currency,u.value),0),0);return X(o-t,u.value)});B(()=>{var t;return((Array.isArray((t=U.value)==null?void 0:t.users)?U.value.users:U.value)||[]).map(v=>({value:v.id,label:v.name}))});const re=o=>{if(!o)return{};const t=o.budget?J(Number(o.budget.amount||0),o.budget.currency,u.value):0,v=(o.expendable||[]).filter(A=>A.status==="Accepted").reduce((A,H)=>A+J(Number(H.amount||0),H.currency,u.value),0);return{budgetAmt:t,approvedAmt:v,remaining:t-v}},Se=o=>o?o.budget!==null:null,nt=(o,t)=>{if(!(!o||!t)){if(!o.completion_date){L.value=o,z.value=t.id,C.value=!0;return}a.value=o,F.value=t.id,R.value=!0}},lt=o=>{try{if(o&&o.id){const v=(p.value||[]).findIndex(A=>A.id===o.id);v!==-1&&(p.value[v]={...p.value[v],...o})}}catch(v){console.error("Failed to merge updated milestone",v)}const t=(p.value||[]).find(v=>{var A;return v.id===((o==null?void 0:o.id)||((A=L.value)==null?void 0:A.id))});a.value=t||o||L.value,F.value=z.value,C.value=!1,R.value=!0,L.value=null,z.value=null},at=async()=>{try{const{data:o}=await window.axios.get("/api/projects-simplified");V.value=(o||[]).map(t=>({value:t.id,label:t.name}))}catch(o){console.error(o),E("Failed to load projects")}},de=async()=>{if(l.value){$.value=!0;try{const{data:o}=await window.axios.get(`/api/projects/${l.value}/milestones-with-expendables`);p.value=(o||[]).map(t=>({...t,_collapsed:!0}))}catch(o){console.error(o),E("Failed to load milestones")}finally{$.value=!1}}},rt=async o=>{if(!o||!o.id){E("Invalid milestone selected.");return}a.value=o,_.value=!0,h.value=!0;try{const{data:t}=await window.axios.get(`/api/milestones/${o.id}/reasons`);D.value=Array.isArray(t)?t:[]}catch(t){console.error(t),E("Failed to load reasons")}finally{_.value=!1}},it=async()=>{if(l.value)try{const{data:o}=await window.axios.get(`/api/projects/${l.value}/sections/users?type=users`);U.value=o||[]}catch(o){console.error(o),E("Failed to load users")}},Ae=async()=>{if(l.value)try{const{data:o}=await window.axios.get(`/api/projects/${l.value}/expendable-budget`);j.value=Number(o.total_expendable_amount||0),T.value=o.currency}catch(o){console.error(o)}},fe=async()=>{if(!l.value){p.value=[],j.value=0,T.value="PKR";return}await Promise.all([de(),it(),Ae()])},be=()=>{jt("Operation successful!"),k.value=!1,a.value=null,N.value=null,de()},ut=o=>{if(!o||!o.id){E("Invalid milestone selected.");return}a.value=o,M.value=!0},dt=o=>{if(!o||!o.id){E("Invalid milestone selected.");return}a.value=o,w.value=!0},ct=()=>{k.value=!1,a.value=null,N.value=null},pt=async o=>{if(!o||!o.id){E("Invalid milestone.");return}await pe("Mark this milestone as complete?")&&(a.value={...o,action:"complete",apiEndpoint:`/api/milestones/${o.id}/complete`,httpMethod:"post"},k.value=!0)},mt=async o=>{if(!o||!o.id){E("Invalid milestone.");return}await pe("Approve this completed milestone?")&&(a.value={...o,action:"approve",apiEndpoint:`/api/milestones/${o.id}/approve`,httpMethod:"post"},k.value=!0)},vt=async o=>{if(!o||!o.id){E("Invalid milestone.");return}await pe("Reject this completed milestone?")&&(a.value={...o,action:"reject",apiEndpoint:`/api/milestones/${o.id}/reject`,httpMethod:"post"},k.value=!0)},gt=async o=>{if(!o||!o.id){E("Invalid contract.");return}N.value={...o,action:"accept",apiEndpoint:`/api/projects/${l.value}/expendables/${o.id}/accept`,httpMethod:"post"},k.value=!0},ft=async o=>{if(!o||!o.id){E("Invalid contract.");return}N.value={...o,action:"reject",apiEndpoint:`/api/projects/${l.value}/expendables/${o.id}/reject`,httpMethod:"post"},k.value=!0},bt=async o=>{if(!o||!o.id){E("Invalid contract.");return}N.value={...o,action:"delete",apiEndpoint:`/api/projects/${l.value}/expendables/${o.id}`,httpMethod:"delete"},k.value=!0},ht=async o=>{if(!o||!o.id){E("Invalid milestone.");return}await pe("Reopen this milestone to move it back to active?")&&(a.value={...o,action:"reopen",apiEndpoint:`/api/milestones/${o.id}/reopen`,httpMethod:"post"},k.value=!0)},Be=o=>{o._collapsed=!o._collapsed},he=o=>!o||!Array.isArray(o.expendable)?!1:o.expendable.some(t=>((t==null?void 0:t.status)||"Pending Approval")==="Pending Approval"),xe=o=>!!(o&&Array.isArray(o.expendable)&&o.expendable.length>0),ye=o=>{try{if(!o)return null;const t=new Date(o),v=new Date,A=new Date(t.getFullYear(),t.getMonth(),t.getDate(),12,0,0),H=new Date(v.getFullYear(),v.getMonth(),v.getDate(),12,0,0),K=1440*60*1e3;return Math.round((A-H)/K)}catch{return null}},xt=o=>{const t=ye(o);return t===null?"":t<0?`Overdue by ${Math.abs(t)} day${Math.abs(t)===1?"":"s"}`:t===0?"Due today":`${t} day${t===1?"":"s"} remaining`};return kt(async()=>{const o=localStorage.getItem("displayCurrency");o&&(u.value=o),await Bt(),await at(),l.value&&await fe()}),ue(u,async o=>{o&&(localStorage.setItem("displayCurrency",o),l.value&&await Promise.all([Ae(),de()]))}),(o,t)=>(n(),G(St,null,{header:q(()=>[e("div",Bo,[t[12]||(t[12]=e("h2",{class:"font-semibold text-2xl text-gray-800"},"Project Financials",-1)),e("div",Po,[e("button",{onClick:fe,class:"p-2 rounded-full text-gray-500 hover:bg-gray-100 transition-colors",title:"Refresh"},[c(d(ke),{class:"h-5 w-5"})]),e("div",To,[c(ve,{id:"project-select",modelValue:l.value,"onUpdate:modelValue":[t[0]||(t[0]=v=>l.value=v),fe],options:V.value,placeholder:"Select a project"},null,8,["modelValue","options"])]),e("div",Vo,[c(ve,{id:"expendables-display-currency",modelValue:d(u),"onUpdate:modelValue":t[1]||(t[1]=v=>Dt(u)?u.value=v:null),options:W,placeholder:"Currency"},null,8,["modelValue"])])])])]),default:q(()=>{var v,A,H,K,se,Pe,Te,Ve,Re,Le,Ne,Ie,Fe,Ue,Ee,qe,Oe,He;return[c(d(Ct),{title:"Project Financials Dashboard"}),e("div",Ro,[e("div",Lo,[l.value?(n(),i("section",No,[e("div",Io,[t[19]||(t[19]=e("h3",{class:"text-xl font-semibold text-gray-900 mb-4"},"Financial Summary",-1)),e("div",Fo,[e("div",Uo,[e("div",null,[t[13]||(t[13]=e("div",{class:"text-sm font-medium text-green-700 mb-1"},"Approved Contracts",-1)),e("div",Eo,g(d(X)(tt.value,d(u))),1)]),t[14]||(t[14]=e("p",{class:"text-xs text-green-600 mt-2"},"Total value of all accepted contracts.",-1))]),e("div",qo,[e("div",null,[t[15]||(t[15]=e("div",{class:"text-sm font-medium text-yellow-700 mb-1"},"Pending Approval",-1)),e("div",Oo,g(d(X)(ot.value,d(u))),1)]),t[16]||(t[16]=e("p",{class:"text-xs text-yellow-600 mt-2"},"Contracts awaiting review and approval.",-1))]),e("div",Ho,[e("div",null,[t[17]||(t[17]=e("div",{class:"text-sm font-medium text-blue-700 mb-1"},"Remaining Project Budget",-1)),e("div",Ko,g(st.value),1)]),t[18]||(t[18]=e("p",{class:"text-xs text-blue-600 mt-2"},"Budget available for new expenditures.",-1))])]),c(Ao,{milestones:p.value},null,8,["milestones"])])])):S("",!0),e("section",Yo,[e("div",Zo,[e("div",zo,[t[20]||(t[20]=e("h3",{class:"text-xl font-semibold text-gray-900"},"Project Milestones",-1)),l.value?(n(),i("button",{key:0,onClick:t[2]||(t[2]=r=>P.value=!0),class:"p-1.5 rounded-full text-white bg-indigo-600 hover:bg-indigo-700 disabled:opacity-50",title:"Add Milestone"},[c(d(_e),{class:"h-4 w-4"})])):S("",!0)]),e("div",Go,[(n(),i(ee,null,ne(We,r=>e("button",{key:r.id,onClick:y=>s.value=r.id,class:Z(["py-2 px-4 rounded-full text-sm font-medium transition",s.value===r.id?"bg-indigo-600 text-white shadow":"bg-gray-100 text-gray-700 hover:bg-gray-200"])},g(r.label),11,Jo)),64))])]),l.value?(n(),i("div",Wo,[$.value?(n(),i("div",Xo,[c(d(ke),{class:"animate-spin h-8 w-8 mx-auto mb-2 text-indigo-500"}),t[22]||(t[22]=e("p",null,"Loading milestones...",-1))])):Me.value.length?(n(),i("div",ts,[(n(!0),i(ee,null,ne(Me.value,r=>(n(),i("div",{key:r.id,class:"border border-gray-200 rounded-xl bg-gray-50 shadow-sm transition-all duration-300 hover:shadow-lg"},[e("div",{class:"p-5 flex items-center justify-between cursor-pointer",onClick:y=>Be(r)},[e("div",ss,[e("div",ns,g(r.name),1),r.description?(n(),i("div",ls,g(r.description),1)):S("",!0),e("div",as,[r.completion_date?(n(),i("span",rs,[t[24]||(t[24]=I(" Due by: ",-1)),e("span",is,g(new Date(r.completion_date).toLocaleDateString()),1)])):(n(),i("span",us,"No completion date")),r.completion_date?(n(),i("span",{key:2,class:Z([ye(r.completion_date)<0?"text-red-600":ye(r.completion_date)===0?"text-orange-600":"text-green-600"])}," • "+g(xt(r.completion_date)),3)):S("",!0)])]),e("div",ds,[e("div",cs,[e("span",ps,[c(d(qt),{class:"h-4 w-4 text-gray-500"}),t[25]||(t[25]=I(" Budget: ",-1)),e("span",ms,g(d(X)(re(r).budgetAmt,d(u))),1)]),e("span",vs,[c(d(ze),{class:"h-4 w-4 text-green-600"}),t[26]||(t[26]=I(" Approved: ",-1)),e("span",gs,g(d(X)(re(r).approvedAmt,d(u))),1)]),e("span",fs,[c(d(ke),{class:"h-4 w-4 text-blue-600"}),t[27]||(t[27]=I(" Remaining: ",-1)),e("span",bs,g(d(X)(re(r).remaining,d(u))),1)])]),s.value==="active"?(n(),i("button",{key:0,onClick:Y(y=>dt(r),["stop"]),class:"p-2 rounded-full text-gray-500 hover:text-blue-500 hover:bg-gray-100 transition-colors"},[Se(r)?(n(),G(d(Tt),{key:0,class:"h-5 w-5"})):(n(),G(d(Ut),{key:1,class:"h-5 w-5"}))],8,hs)):S("",!0),e("div",xs,[e("button",{onClick:Y(y=>rt(r),["stop"]),class:"p-2 rounded-full text-blue-600 hover:bg-blue-100 transition-colors",title:"View reasons"},[c(d(It),{class:"h-5 w-5"})],8,ys),e("button",{onClick:Y(y=>Be(r),["stop"]),class:"p-2 transition-transform duration-300"},[c(d(Nt),{class:Z(["h-6 w-6 text-gray-500",r._collapsed?"":"rotate-180"])},null,8,["class"])],8,ws)])])],8,os),Je(e("div",_s,[e("div",ks,[t[35]||(t[35]=e("h5",{class:"text-sm font-semibold text-gray-800 mb-2"},"Task Stats",-1)),e("div",Cs,[e("span",$s,[t[28]||(t[28]=I(" Total ",-1)),e("span",Ds,g(r.tasks_total_count||0),1)]),e("span",js,[t[29]||(t[29]=I(" To Do ",-1)),e("span",Ms,g(r.tasks_todo_count||0),1)]),e("span",Ss,[t[30]||(t[30]=I(" In Progress ",-1)),e("span",As,g(r.tasks_in_progress_count||0),1)]),e("span",Bs,[t[31]||(t[31]=I(" Paused ",-1)),e("span",Ps,g(r.tasks_paused_count||0),1)]),e("span",Ts,[t[32]||(t[32]=I(" Blocked ",-1)),e("span",Vs,g(r.tasks_blocked_count||0),1)]),e("span",Rs,[t[33]||(t[33]=I(" Done ",-1)),e("span",Ls,g(r.tasks_done_count||0),1)]),e("span",Ns,[t[34]||(t[34]=I(" Archived ",-1)),e("span",Is,g(r.tasks_archived_count||0),1)])])]),e("div",Fs,[t[37]||(t[37]=e("h4",{class:"text-lg font-semibold text-gray-800"},"Contracts",-1)),e("div",Us,[s.value==="active"?(n(),G(ie,{key:0,onClick:Y(y=>ut(r),["stop"]),class:"flex items-center gap-1"},{default:q(()=>[c(d(_e),{class:"h-4 w-4"}),t[36]||(t[36]=I(" Add Contract ",-1))]),_:2,__:[36]},1032,["onClick"])):S("",!0)])]),!r.expendable||!r.expendable.length?(n(),i("div",Es,"No contracts found.")):(n(),i("ul",qs,[(n(!0),i(ee,null,ne(r.expendable||[],y=>{var Ke,Ye;return n(),i("li",{key:y.id,class:"flex flex-col sm:flex-row items-start sm:items-center justify-between text-sm gap-2 p-3 rounded-lg bg-gray-100 shadow-sm"},[e("div",Os,[e("span",{class:Z(["inline-block text-xs px-2 py-0.5 rounded-full font-medium",{"bg-gray-200 text-gray-700":y.status==="Pending Approval","bg-green-200 text-green-700":y.status==="Accepted","bg-red-200 text-red-700":y.status==="Rejected"}])},g(y.status||"Pending Approval"),3),y.user&&y.user.name?(n(),i("span",Hs,g(y.user.name),1)):S("",!0),e("span",Ks,g(y.name),1)]),e("div",Ys,[e("div",Zs,[e("span",zs,g(d(X)(d(J)(parseFloat(y.amount??0),y.currency||d(u),d(u)),d(u))),1),y.currency&&((Ke=y.currency)==null?void 0:Ke.toUpperCase())!==((Ye=d(u))==null?void 0:Ye.toUpperCase())?(n(),i("span",Gs," ("+g(d(X)(parseFloat(y.amount??0),y.currency))+") ",1)):S("",!0)]),e("div",Js,[y.status==="Accepted"?(n(),i("button",{key:0,onClick:Y(we=>nt(r,y),["stop"]),class:"p-1 rounded-full text-indigo-600 hover:bg-indigo-200 transition-colors",title:"Add tasks"},[c(d(_e),{class:"h-5 w-5"})],8,Qs)):S("",!0),y.status==="Pending Approval"&&s.value!=="approved"?(n(),i(ee,{key:1},[d(b)||d(m)?(n(),i("button",{key:0,onClick:Y(we=>gt(y),["stop"]),class:"p-1 rounded-full text-green-600 hover:bg-green-200 transition-colors",title:"Approve"},[c(d(ze),{class:"h-5 w-5"})],8,Ws)):S("",!0),d(b)||d(m)?(n(),i("button",{key:1,onClick:Y(we=>ft(y),["stop"]),class:"p-1 rounded-full text-red-600 hover:bg-red-200 transition-colors",title:"Reject"},[c(d(Ot),{class:"h-5 w-5"})],8,Xs)):S("",!0)],64)):S("",!0),y.status==="Rejected"&&s.value!=="approved"?(n(),i("button",{key:2,onClick:Y(we=>bt(y),["stop"]),class:"p-1 rounded-full text-red-600 hover:bg-red-200 transition-colors",title:"Delete"},[c(d(Et),{class:"h-5 w-5"})],8,en)):S("",!0)])])])}),128))])),e("div",tn,[e("div",on,[r.status.toLowerCase()!=="completed"&&s.value==="active"?(n(),G(ie,{key:0,onClick:Y(y=>pt(r),["stop"]),disabled:he(r)&&xe(r),title:he(r)&&xe(r)?"Approve or reject all contracts before completing the milestone.":""},{default:q(()=>t[38]||(t[38]=[I(" Mark Complete ",-1)])),_:2,__:[38]},1032,["onClick","disabled","title"])):r.status.toLowerCase()==="completed"&&s.value==="completed"&&d(O)?(n(),G(ie,{key:1,onClick:Y(y=>mt(r),["stop"]),class:"bg-green-600 hover:bg-green-700"},{default:q(()=>t[39]||(t[39]=[I("Approve Milestone",-1)])),_:2,__:[39]},1032,["onClick"])):S("",!0),r.status.toLowerCase()==="completed"&&s.value==="completed"&&d(O)?(n(),G(ie,{key:2,onClick:Y(y=>vt(r),["stop"]),class:"bg-red-600 hover:bg-red-700"},{default:q(()=>t[40]||(t[40]=[I("Reject Milestone",-1)])),_:2,__:[40]},1032,["onClick"])):r.status.toLowerCase()==="approved"&&s.value==="approved"&&d(O)?(n(),G(Qe,{key:3,onClick:Y(y=>ht(r),["stop"])},{default:q(()=>t[41]||(t[41]=[I("Reopen Milestone",-1)])),_:2,__:[41]},1032,["onClick"])):S("",!0)]),r.status.toLowerCase()!=="completed"&&s.value==="active"&&he(r)&&xe(r)?(n(),i("p",sn," You have pending contracts. Approve or reject each contract before marking this milestone complete. ")):S("",!0)])],512),[[$t,!r._collapsed]])]))),128))])):(n(),i("div",es,t[23]||(t[23]=[e("p",null,"No milestones found for this project in the selected tab.",-1)])))])):(n(),i("div",Qo,[c(d(Ft),{class:"h-12 w-12 mx-auto mb-2 text-gray-400"}),t[21]||(t[21]=e("p",{class:"text-lg"},"Please select a project to view its milestones.",-1))]))])])]),c(Ze,{show:M.value,title:"Add New Contract",milestone:a.value,users:U.value,"currency-options":W,"is-user-selection-required":!0,onClose:t[3]||(t[3]=r=>M.value=!1),onSubmitted:be,"project-total-budget":j.value,"project-budget-currency":T.value,"milestone-stats":re(a.value)},null,8,["show","milestone","users","project-total-budget","project-budget-currency","milestone-stats"]),c(Ze,{show:w.value,title:Se(a.value)?"Update Milestone Budget":"Add Milestone Budget",milestone:a.value,users:U.value,"currency-options":W,"is-budget-form":!0,"is-user-selection-required":!1,onClose:t[4]||(t[4]=r=>w.value=!1),onSubmitted:be,"project-total-budget":j.value,"project-budget-currency":T.value,"milestone-stats":re(a.value)},null,8,["show","title","milestone","users","project-total-budget","project-budget-currency","milestone-stats"]),c(Yt,{show:k.value,title:((v=a.value)==null?void 0:v.action)==="approve"?"Approve Milestone":((A=a.value)==null?void 0:A.action)==="reject"?"Reject Milestone":((H=a.value)==null?void 0:H.action)==="reopen"?"Reopen Milestone":a.value?"Provide Milestone Review":((K=N.value)==null?void 0:K.action)==="accept"?"Approve Contract":((se=N.value)==null?void 0:se.action)==="reject"?"Reject Contract":"Delete Contract",message:((Pe=a.value)==null?void 0:Pe.action)==="approve"?"Please provide a reason for approving this milestone (required):":((Te=a.value)==null?void 0:Te.action)==="reject"?"Please provide a reason for rejecting this milestone (required):":((Ve=a.value)==null?void 0:Ve.action)==="reopen"?"Please provide a reason for reopening this milestone (required):":a.value?"Please provide a review explaining why this milestone is complete (required):":((Re=N.value)==null?void 0:Re.action)==="accept"?"Please provide a reason for approval (required):":((Le=N.value)==null?void 0:Le.action)==="reject"?"Please provide a reason for rejection (required):":"Provide a reason for deleting this rejected expendable (required):",type:((Ne=a.value)==null?void 0:Ne.action)==="reject"||((Ie=a.value)==null?void 0:Ie.action)==="reopen"?"warning":"info","api-endpoint":a.value?a.value.apiEndpoint:(Fe=N.value)==null?void 0:Fe.apiEndpoint,"http-method":a.value?a.value.httpMethod:(Ue=N.value)==null?void 0:Ue.httpMethod,onClose:ct,onSubmitted:be},null,8,["show","title","message","type","api-endpoint","http-method"]),c(Mt,{show:P.value,"project-id":Number(l.value),onClose:t[5]||(t[5]=r=>P.value=!1),onSaved:t[6]||(t[6]=()=>{P.value=!1,de()})},null,8,["show","project-id"]),c(Pt,{show:h.value,onClose:t[8]||(t[8]=()=>{h.value=!1,a.value=null,D.value=[]})},{default:q(()=>[e("div",nn,[e("div",ln,[t[43]||(t[43]=e("h3",{class:"text-lg font-semibold"},"Milestone Reasons",-1)),e("button",{class:"text-gray-500 hover:text-gray-700",onClick:t[7]||(t[7]=()=>{h.value=!1,a.value=null,D.value=[]})},t[42]||(t[42]=[e("svg",{class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),_.value?(n(),i("div",an,"Loading...")):(n(),i("div",rn,[D.value.length?(n(),i("ul",dn,[(n(!0),i(ee,null,ne(D.value,r=>(n(),i("li",{key:r.id,class:"p-4 rounded-lg bg-gray-50 shadow-sm border border-gray-200"},[e("div",cn,[e("span",pn,g(r.creator_name||"Unknown"),1),e("span",mn,g(new Date(r.created_at).toLocaleString()),1)]),e("div",vn,g(r.content),1)]))),128))])):(n(),i("div",un,"No reasons found."))]))])]),_:1},8,["show"]),c(fo,{show:R.value,"contract-id":Number(F.value),"completion-date":(Ee=a.value)!=null&&Ee.completion_date?String(a.value.completion_date).split("T")[0]:null,onClose:t[9]||(t[9]=()=>{R.value=!1,F.value=null}),onTasksSubmitted:t[10]||(t[10]=()=>{R.value=!1,F.value=null})},null,8,["show","contract-id","completion-date"]),c(ho,{show:C.value,"milestone-id":Number(((qe=L.value)==null?void 0:qe.id)||((Oe=a.value)==null?void 0:Oe.id)),"initial-completion-date":(He=L.value)!=null&&He.completion_date?String(L.value.completion_date).split("T")[0]:null,onClose:t[11]||(t[11]=()=>{C.value=!1,L.value=null}),onUpdated:lt},null,8,["show","milestone-id","initial-completion-date"])]}),_:1}))}};export{Bn as default};
