import{r as $,z as Qe,s as L,w as ee,i,o as r,g as f,t as _,b as t,e as d,f as ce,v as Ee,F as se,j as ae,n as H,m as te,M as nt,a as ne,B as Fe,E as rt,L as it,d as Ze,k as Re,N as dt,G as ut,J as et,h as u,a2 as ct,c as Ke,q as mt,x as Oe,H as vt,ab as pt,a0 as yt,a1 as Ye}from"./app-DMqHzysD.js";import{P as ye}from"./PrimaryButton-BTqvdFjJ.js";import{_ as E,a as K}from"./InputError-He9lqnax.js";import{_ as Z}from"./TextInput-BmI6SV3L.js";import{_ as ft}from"./Checkbox-Cf5k1pDD.js";import{a as Te}from"./SecondaryButton-Dn7dLQjC.js";import{_ as gt}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{e as xe,s as Ne}from"./AuthenticatedLayout-DHEMnzAD.js";const bt={key:0,class:"text-red-600 text-sm mb-4"},_t={key:1,class:"text-gray-500 text-sm mb-4"},ht={key:2},xt={class:"mb-4"},wt={class:"mb-4"},kt=["disabled"],jt=["value"],$t={class:"mb-4"},Pt={class:"mt-2"},St={class:"flex items-center mb-2"},It=["for"],Ct={key:0,class:"pl-6"},Dt={class:"grid grid-cols-2 gap-4 mb-2"},Vt=["id","onUpdate:modelValue","disabled"],Ut={class:"mb-2"},At={key:0},Rt={class:"flex justify-between items-center mb-1"},Tt=["onClick"],Nt={class:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-2"},Et={class:"flex"},Ot=["onClick"],Ft={key:0},Mt={class:"mt-4"},Bt={key:1,class:"mt-2 flex items-center"},Lt={key:0,class:"mt-6 flex justify-end"},qt={__name:"ServicesAndPaymentForm",props:{projectId:{type:[Number,String],required:!0},paymentTypeOptions:{type:Array,required:!0},canManageProjectServicesAndPayments:{type:Boolean,required:!0},canViewProjectServicesAndPayments:{type:Boolean,required:!0}},emits:["updated"],setup(v,{emit:T}){const h=v,G=T,p=$({}),w=$(!1),R=$([...[{value:"Website Designing",label:"Website Designing"},{value:"SEO",label:"SEO"},{value:"Social Media",label:"Social Media"},{value:"Content Writing",label:"Content Writing"},{value:"Graphic Design",label:"Graphic Design"}]]),S=$(""),M=$(!1),k=Qe({services:[],service_details:[],total_amount:"",payment_type:"one_off"}),C=L(()=>{const m=k.services.filter(a=>{const l=N(a);return l&&l.frequency!=="monthly"});return m.length===0?!0:m.every(a=>I(a)===100)}),F=L(()=>!h.projectId||!h.canManageProjectServicesAndPayments||!C.value),W=()=>{const m=S.value.trim();m&&!R.value.some(a=>a.label.toLowerCase()===m.toLowerCase())&&(R.value.push({value:m,label:m}),S.value="",M.value=!1)},A=async()=>{if(h.projectId){w.value=!0;try{const a=(await window.axios.get(`/api/projects/${h.projectId}/sections/services-payment`)).data;return k.services=a.services||[],k.service_details=a.service_details||[],k.total_amount=a.total_amount||"",k.payment_type=a.payment_type||"one_off",k.services.forEach(l=>{R.value.some(j=>j.value===l)||R.value.push({value:l,label:l})}),k.service_details.forEach(l=>{if(l.payment_breakdown&&!Array.isArray(l.payment_breakdown)){const j=l.payment_breakdown;l.payment_breakdown=[{label:"First",percentage:parseInt(j.first)||30},{label:"Second",percentage:parseInt(j.second)||30},{label:"Third",percentage:parseInt(j.third)||40}]}else(!l.payment_breakdown||l.payment_breakdown.length===0)&&(l.payment_breakdown=[{label:"Payment 1",percentage:100}])}),a}catch(m){return console.error("Error fetching services and payment data:",m),p.value.general="Failed to fetch services and payment data.",null}finally{w.value=!1}}},O=async()=>{p.value={},w.value=!0;try{const m={services:k.services,service_details:k.service_details,total_amount:k.total_amount,payment_type:k.payment_type},a=await window.axios.put(`/api/projects/${h.projectId}/sections/services-payment`,m);alert("Services and payment information updated successfully!"),G("updated")}catch(m){m.response&&m.response.status===422?p.value=m.response.data.errors:m.response&&m.response.data.message?p.value.general=m.response.data.message:(p.value.general="Failed to update services and payment information.",console.error("Error:",m))}finally{w.value=!1}},q=(m,a)=>{a?k.service_details.some(l=>l.service_id===m)||k.service_details.push({service_id:m,amount:"",frequency:"one_off",start_date:"",payment_breakdown:[{label:"Payment 1",percentage:100}]}):k.service_details=k.service_details.filter(l=>l.service_id!==m)},N=m=>{let a=k.service_details.find(l=>l.service_id===m);if(!a)a={service_id:m,amount:"",frequency:"one_off",start_date:"",payment_breakdown:[{label:"Payment 1",percentage:100}]},k.service_details.push(a);else if(a.payment_breakdown&&!Array.isArray(a.payment_breakdown)){const l=a.payment_breakdown;a.payment_breakdown=[{label:"First",percentage:parseInt(l.first)||30},{label:"Second",percentage:parseInt(l.second)||30},{label:"Third",percentage:parseInt(l.third)||40}]}else(!a.payment_breakdown||a.payment_breakdown.length===0)&&(a.payment_breakdown=[{label:"Payment 1",percentage:100}]);return a},I=m=>{const a=N(m);return!a.payment_breakdown||!Array.isArray(a.payment_breakdown)?0:a.payment_breakdown.reduce((l,j)=>l+(parseInt(j.percentage)||0),0)},V=m=>{const a=N(m);if(a.payment_breakdown||(a.payment_breakdown=[]),!Array.isArray(a.payment_breakdown)){const D=a.payment_breakdown;a.payment_breakdown=[{label:"First",percentage:parseInt(D.first)||30},{label:"Second",percentage:parseInt(D.second)||30},{label:"Third",percentage:parseInt(D.third)||40}]}const l=a.payment_breakdown.length;let j=0;if(l>0){const D=a.payment_breakdown[l-1];j=Math.floor(D.percentage/2),D.percentage-=j}else j=100;a.payment_breakdown.push({label:`Payment ${l+1}`,percentage:j})},P=(m,a)=>{const l=N(m);if(!l.payment_breakdown||!Array.isArray(l.payment_breakdown)||l.payment_breakdown.length<=1)return;const j=parseInt(l.payment_breakdown[a].percentage)||0;if(l.payment_breakdown.splice(a,1),j>0&&l.payment_breakdown.length>0){const D=a>0&&a<=l.payment_breakdown.length?a-1:0;l.payment_breakdown[D].percentage=(parseInt(l.payment_breakdown[D].percentage)||0)+j}l.payment_breakdown.forEach((D,re)=>{D.label=`Payment ${re+1}`})};return ee(()=>h.projectId,m=>{m&&A()},{immediate:!0}),(m,a)=>(r(),i("div",null,[p.value.general?(r(),i("div",bt,_(p.value.general),1)):f("",!0),w.value?(r(),i("div",_t,"Loading...")):(r(),i("div",ht,[t("div",xt,[d(E,{for:"total_amount",value:"Total Amount"}),d(Z,{id:"total_amount",type:"number",step:"0.01",class:"mt-1 block w-full",modelValue:k.total_amount,"onUpdate:modelValue":a[0]||(a[0]=l=>k.total_amount=l),disabled:!v.canManageProjectServicesAndPayments},null,8,["modelValue","disabled"]),d(K,{message:p.value.total_amount?p.value.total_amount[0]:"",class:"mt-2"},null,8,["message"])]),t("div",wt,[d(E,{for:"payment_type",value:"Payment Type"}),ce(t("select",{id:"payment_type",class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full","onUpdate:modelValue":a[1]||(a[1]=l=>k.payment_type=l),required:"",disabled:!v.canManageProjectServicesAndPayments},[(r(!0),i(se,null,ae(v.paymentTypeOptions,l=>(r(),i("option",{key:l.value,value:l.value},_(l.label),9,jt))),128))],8,kt),[[Ee,k.payment_type]]),d(K,{message:p.value.payment_type?p.value.payment_type[0]:"",class:"mt-2"},null,8,["message"])]),t("div",$t,[d(E,{for:"services",value:"Services"}),t("div",Pt,[(r(!0),i(se,null,ae(R.value,l=>(r(),i("div",{key:l.value,class:"border p-3 mb-3 rounded"},[t("div",St,[d(ft,{id:`service_${l.value}`,value:l.value,checked:k.services,"onUpdate:checked":[a[2]||(a[2]=j=>k.services=j),j=>q(l.value,j)],disabled:!v.canManageProjectServicesAndPayments},null,8,["id","value","checked","onUpdate:checked","disabled"]),t("label",{for:`service_${l.value}`,class:"ms-2 text-sm font-medium text-gray-700"},_(l.label),9,It)]),(k.services||[]).includes(l.value)?(r(),i("div",Ct,[t("div",Dt,[t("div",null,[d(E,{for:`service_amount_${l.value}`,value:"Amount",class:"text-xs"},null,8,["for"]),d(Z,{id:`service_amount_${l.value}`,type:"number",step:"0.01",placeholder:"Amount",class:"w-full",modelValue:N(l.value).amount,"onUpdate:modelValue":j=>N(l.value).amount=j,disabled:!v.canManageProjectServicesAndPayments},null,8,["id","modelValue","onUpdate:modelValue","disabled"])]),t("div",null,[d(E,{for:`service_frequency_${l.value}`,value:"Frequency",class:"text-xs"},null,8,["for"]),ce(t("select",{id:`service_frequency_${l.value}`,class:"border-gray-300 rounded-md w-full","onUpdate:modelValue":j=>N(l.value).frequency=j,disabled:!v.canManageProjectServicesAndPayments},a[6]||(a[6]=[t("option",{value:"monthly"},"Monthly",-1),t("option",{value:"one_off"},"One off",-1)]),8,Vt),[[Ee,N(l.value).frequency]])])]),t("div",Ut,[d(E,{for:`service_start_date_${l.value}`,value:"Start Date",class:"text-xs"},null,8,["for"]),d(Z,{id:`service_start_date_${l.value}`,type:"date",class:"w-full",modelValue:N(l.value).start_date,"onUpdate:modelValue":j=>N(l.value).start_date=j,disabled:!v.canManageProjectServicesAndPayments},null,8,["id","modelValue","onUpdate:modelValue","disabled"])]),N(l.value).frequency!=="monthly"?(r(),i("div",At,[t("div",Rt,[d(E,{value:"Payment Breakdown (%)",class:"text-xs"}),v.canManageProjectServicesAndPayments?(r(),i("button",{key:0,type:"button",class:"text-xs text-blue-600 hover:text-blue-800",onClick:j=>V(l.value)}," + Add Payment ",8,Tt)):f("",!0)]),t("div",Nt,[(r(!0),i(se,null,ae(N(l.value).payment_breakdown,(j,D)=>(r(),i("div",{key:D,class:"relative"},[d(E,{for:`service_payment_${D}_${l.value}`,value:j.label,class:"text-xs"},null,8,["for","value"]),t("div",Et,[d(Z,{id:`service_payment_${D}_${l.value}`,type:"text",inputmode:"numeric",pattern:"[0-9]*",min:"0",max:"100",class:"w-full",modelValue:j.percentage,"onUpdate:modelValue":re=>j.percentage=re,modelModifiers:{number:!0},onInput:re=>{j.percentage=Math.max(0,Math.min(100,parseInt(re.target.value)||0))},disabled:!v.canManageProjectServicesAndPayments},null,8,["id","modelValue","onUpdate:modelValue","onInput","disabled"]),v.canManageProjectServicesAndPayments&&N(l.value).payment_breakdown.length>1?(r(),i("button",{key:0,type:"button",class:"ml-1 text-red-500 hover:text-red-700",onClick:re=>P(l.value,D)},a[7]||(a[7]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor"},[t("path",{"fill-rule":"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z","clip-rule":"evenodd"})],-1)]),8,Ot)):f("",!0)])]))),128))]),t("div",{class:H(["text-xs mt-2",{"text-gray-500":I(l.value)===100,"text-red-500 font-bold":I(l.value)!==100}])},[te(" Total: "+_(I(l.value))+"% ",1),I(l.value)!==100?(r(),i("span",Ft," (Total must be 100%) ")):f("",!0)],2)])):f("",!0)])):f("",!0)]))),128))]),t("div",Mt,[v.canManageProjectServicesAndPayments&&!M.value?(r(),i("button",{key:0,type:"button",class:"text-sm text-blue-600 hover:text-blue-800",onClick:a[3]||(a[3]=l=>M.value=!0)}," + Add New Service/Department ")):f("",!0),v.canManageProjectServicesAndPayments&&M.value?(r(),i("div",Bt,[d(Z,{type:"text",class:"flex-grow mr-2",modelValue:S.value,"onUpdate:modelValue":a[4]||(a[4]=l=>S.value=l),placeholder:"New service/department name",onKeyup:nt(W,["enter"])},null,8,["modelValue"]),d(ye,{onClick:W},{default:ne(()=>a[8]||(a[8]=[te("Add",-1)])),_:1,__:[8]}),t("button",{type:"button",class:"ml-2 text-sm text-gray-500 hover:text-gray-700",onClick:a[5]||(a[5]=l=>{M.value=!1,S.value=""})}," Cancel ")])):f("",!0)]),d(K,{message:p.value.services?p.value.services[0]:"",class:"mt-2"},null,8,["message"])]),v.canManageProjectServicesAndPayments?(r(),i("div",Lt,[d(ye,{onClick:O,disabled:F.value,class:H({"opacity-25":F.value})},{default:ne(()=>a[9]||(a[9]=[te(" Update Services & Payment ",-1)])),_:1,__:[9]},8,["disabled","class"])])):f("",!0)]))]))}},Kt=["disabled"],zt={class:"absolute z-50 mt-1 w-full rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5"},Gt={class:"p-2 border-b border-gray-200"},Wt=["onClick"],Yt={key:0,class:"block px-4 py-2 text-sm text-gray-500"},Jt={__name:"SelectDropdown",props:{modelValue:{type:[String,Number,Object,null],default:null},options:{type:Array,default:()=>[]},placeholder:{type:String,default:"Select an option"},valueKey:{type:String,default:"value"},labelKey:{type:String,default:"label"},disabled:{type:Boolean,default:!1},required:{type:Boolean,default:!1},maxHeight:{type:String,default:"250px"},width:{type:String,default:"full"}},emits:["update:modelValue","change"],setup(v,{emit:T}){const h=v,G=T,p=$(!1),w=$(""),X=$(null),R=$(null),S=L(()=>{if(!w.value)return h.options;const A=w.value.toLowerCase();return h.options.filter(O=>O[h.labelKey].toLowerCase().includes(A))}),M=A=>{X.value&&!X.value.contains(A.target)&&(p.value=!1,w.value="")},k=A=>{A.key==="Escape"&&p.value&&(p.value=!1,w.value="")};Fe(()=>{document.addEventListener("click",M),document.addEventListener("keydown",k)}),rt(()=>{document.removeEventListener("click",M),document.removeEventListener("keydown",k)});const C=L(()=>{if(h.modelValue===null||h.modelValue===void 0||h.modelValue==="")return h.placeholder;const A=h.options.find(O=>O[h.valueKey]===h.modelValue);return A?A[h.labelKey]:h.placeholder}),F=A=>{G("update:modelValue",A[h.valueKey]),G("change",A[h.valueKey]),p.value=!1,w.value=""},W=()=>{h.disabled||(p.value=!p.value,p.value&&ut(()=>{R.value&&R.value.focus()}))};return ee(()=>h.modelValue,A=>{(A==null||A==="")&&(w.value="")}),(A,O)=>(r(),i("div",{ref_key:"dropdownRef",ref:X,class:H(["relative",{"w-full":v.width==="full"}])},[t("button",{type:"button",onClick:W,disabled:v.disabled,class:H(["border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full text-left px-3 py-2 text-gray-700 bg-white relative flex items-center justify-between",{"opacity-50 cursor-not-allowed":v.disabled}])},[t("span",{class:H({"text-gray-500":!h.modelValue})},_(C.value),3),O[3]||(O[3]=t("svg",{class:"h-4 w-4 text-gray-500",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor"},[t("path",{"fill-rule":"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z","clip-rule":"evenodd"})],-1))],10,Kt),ce(t("div",zt,[t("div",Gt,[ce(t("input",{ref_key:"searchInputRef",ref:R,type:"text","onUpdate:modelValue":O[0]||(O[0]=q=>w.value=q),onInput:O[1]||(O[1]=q=>p.value=!0),class:"block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 text-sm",placeholder:"Search...",onClick:O[2]||(O[2]=Ze(()=>{},["stop"]))},null,544),[[Re,w.value]])]),t("div",{class:"py-1 overflow-y-auto",style:dt({maxHeight:v.maxHeight})},[(r(!0),i(se,null,ae(S.value,q=>(r(),i("div",{key:q[v.valueKey],onClick:N=>F(q),class:H(["block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 cursor-pointer",{"bg-gray-100":q[v.valueKey]===v.modelValue}])},_(q[v.labelKey]),11,Wt))),128)),S.value.length===0?(r(),i("div",Yt," No options available ")):f("",!0)],4)],512),[[it,p.value]])],2))}},Ae=gt(Jt,[["__scopeId","data-v-d21d43d1"]]),J=$({}),Ht=localStorage.getItem("displayCurrency"),tt=$(Ht||"USD");ee(tt,v=>{localStorage.setItem("displayCurrency",v)});const Je=async()=>{try{const v=await window.axios.get("/api/currency-rates");J.value=v.data,console.log("Fetched currency rates:",J.value)}catch(v){console.error("Failed to fetch currency rates:",v),J.value={PKR:.0034,AUD:.65,INR:.012,EUR:1.08,GBP:1.28,USD:1}}},le=(v,T="USD")=>{if(isNaN(v)||v==null)return"0.00";try{return new Intl.NumberFormat("en-US",{style:"currency",currency:T,minimumFractionDigits:2,maximumFractionDigits:2}).format(v)}catch(h){return console.warn(`Error formatting currency for ${v} ${T}:`,h),`${T} ${parseFloat(v).toFixed(2)}`}},je=(v,T,h)=>{if(isNaN(v)||v==null||!T||!h)return 0;if(T.toUpperCase()===h.toUpperCase())return Number(v);const G=J.value,p=G[T.toUpperCase()],w=G[h.toUpperCase()];if(!p||!w)return console.warn(`Missing conversion rates for: ${T} or ${h}. Cannot perform conversion.`),Number(v);const R=Number(v)*p/w;return Number(R.toFixed(2))},Xt={class:"p-6 bg-white rounded-lg shadow-xl"},Qt={key:0,class:"text-red-600 text-sm mb-4"},Zt={key:1,class:"mb-6 p-4 bg-gray-50 rounded-md"},es={class:"mb-6"},ts={class:"flex justify-end items-center mb-4"},ss={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},as={class:"p-3 bg-blue-100 rounded-md"},os={class:"text-lg font-bold text-blue-800"},ls={class:"p-3 bg-red-100 rounded-md"},ns={class:"text-lg font-bold text-red-800"},rs={class:"text-xs text-gray-500"},is={class:"p-3 bg-purple-100 rounded-md"},ds={class:"text-lg font-bold text-purple-800"},us={class:"p-3 bg-green-100 rounded-md"},cs={class:"text-lg font-bold text-green-800"},ms={class:"p-3 bg-yellow-100 rounded-md col-span-full md:col-span-1"},vs={class:"text-lg font-bold text-yellow-800"},ps={class:"text-xs text-gray-500"},ys={class:"p-3 bg-orange-100 rounded-md col-span-full md:col-span-1"},fs={class:"text-lg font-bold text-orange-900 mt-1"},gs={class:"text-xs text-gray-500"},bs={class:"p-3 bg-gray-100 rounded-md col-span-full md:col-span-1"},_s={class:"text-lg font-bold mt-1 text-green-400"},hs={class:"p-3 bg-gray-100 rounded-md col-span-full md:col-span-1"},xs={class:"text-lg font-bold text-red-400 mt-1"},ws={class:"grid grid-cols-1 gap-4 md:grid-cols-2"},ks={key:0},js={key:1},$s={class:"mt-4 flex justify-end"},Ps={key:2},Ss={key:0,class:"space-y-3"},Is={key:1,class:"p-4 bg-gray-50 rounded-md text-gray-600 text-center"},Cs={key:2,class:"space-y-4"},Ds={class:"flex justify-between items-start mb-2"},Vs={class:"flex-grow"},Us={class:"font-medium text-gray-900 text-lg"},As={class:"text-xs text-gray-500 mt-1"},Rs={class:"flex-shrink-0 text-right"},Ts={key:0,class:"text-sm text-gray-600"},Ns={class:"flex justify-between items-end text-xs text-gray-600 mt-2 border-t border-gray-200 pt-2"},Es={key:0,class:"block"},Os={key:1,class:"block"},Fs={key:2,class:"block mt-1 text-gray-500"},Ms={class:"flex space-x-2 mt-2"},Bs={key:0,class:"mt-4 p-4 bg-blue-50 rounded-md border border-blue-200"},Ls={class:"text-md font-medium text-gray-900 mb-4"},qs={class:"mb-4"},Ks={class:"mb-4"},zs={class:"flex items-center"},Gs=["disabled"],Ws={class:"text-sm text-gray-700"},Ys={key:0,class:"mb-4"},Js={class:"flex justify-end space-x-2"},He=.25,Hs={__name:"ProjectTransactions",props:{projectId:{type:[Number,String],required:!0},userProjectRole:{type:Object,default:()=>({})}},setup(v){const T=v,{canDo:h,canManage:G}=et(()=>T.projectId),p=G("project_expenses",T.userProjectRole),w=G("project_income",T.userProjectRole),X=h("view_project_transactions",T.userProjectRole),R=$([]),S=$([]),M=$({}),k=$(""),C=$(!1),F=$(null),W=$(""),A=$(!1),O=$({}),q=$(null),N=$(""),I=$({description:"",amount:"",currency:"PKR",user_id:null,hours_spent:"",type:"expense"}),V=tt,P=[{value:"PKR",label:"PKR"},{value:"AUD",label:"AUD"},{value:"INR",label:"INR"},{value:"USD",label:"USD"},{value:"EUR",label:"EUR"},{value:"GBP",label:"GBP"}],m=[{value:"expense",label:"Expense"},{value:"income",label:"Income"},{value:"bonus",label:"Bonus"}],a=L(()=>S.value.map(g=>({value:g.id,label:g.name||"Unknown User"}))),l=()=>{const g=new Date,n=g.getFullYear(),b=String(g.getMonth()+1).padStart(2,"0"),U=String(g.getDate()).padStart(2,"0");return`${n}-${b}-${U}`},j=async()=>{if(!(!T.projectId||!X.value))try{const g=await window.axios.get(`/api/projects/${T.projectId}/sections/clients-users`);S.value=g.data.users||[]}catch(g){k.value="Failed to fetch users.",console.error("Error fetching users:",g)}},D=async()=>{if(!(!T.projectId||!X.value)){C.value=!0;try{(!J.value||Object.keys(J.value).length===0)&&await Je();const g=await window.axios.get(`/api/projects/${T.projectId}/sections/transactions`);R.value=g.data}catch(g){k.value="Failed to fetch transactions.",console.error("Error fetching transactions:",g)}finally{C.value=!1}}},re=async()=>{var g;if(!p.value&&!w.value){xe("You do not have permission to manage transactions.");return}if(!I.value.amount||isNaN(I.value.amount)){M.value.amount=["Please enter a valid amount"];return}if(I.value.type==="expense"&&!p.value){xe("You do not have permission to add expenses.");return}if(I.value.type==="income"&&!w.value){xe("You do not have permission to add income.");return}if(I.value.type==="bonus"&&!p.value){xe("You do not have permission to add bonuses.");return}M.value={},k.value="",C.value=!0;try{const n={...I.value,amount:Number(I.value.amount)},b=await window.axios.post(`/api/projects/${T.projectId}/transactions`,n);await D(),Y(),Ne("Transaction saved successfully!")}catch(n){((g=n.response)==null?void 0:g.status)===422?M.value=n.response.data.errors:(k.value="Failed to save transaction.",console.error("Error saving transaction:",n))}finally{C.value=!1}},Y=()=>{I.value={description:"",amount:"",currency:"PKR",user_id:null,hours_spent:"",type:"expense"}},Me=async g=>{if(!p.value&&!w.value){xe("You do not have permission to delete transactions.");return}if(window.confirm("Are you sure you want to delete this transaction?"))try{const n=R.value[g].id;await window.axios.delete(`/api/projects/${T.projectId}/transactions/${n}`),await D(),Ne("Transaction deleted successfully!")}catch(n){k.value="Failed to delete transaction.",console.error("Error deleting transaction:",n)}},me=g=>{if(!p.value&&!w.value){xe("You do not have permission to manage transactions.");return}const n=R.value[g];F.value===n.id?(F.value=null,q.value=null,N.value=""):(q.value=g,F.value=n.id,W.value=n.amount,A.value=!1,O.value={},N.value=l(),(Number(n.amount)===0||Math.abs(Number(W.value)-Number(n.amount))<.01)&&(A.value=!0))};ee(W,g=>{if(q.value!==null){const n=R.value[q.value];A.value=Math.abs(Number(g)-Number(n.amount))<.01}});const pe=()=>{F.value=null,q.value=null,W.value="",A.value=!1,O.value={},N.value=""},fe=async()=>{var U;if(!p.value&&!w.value){xe("You do not have permission to manage transactions.");return}const g=q.value,n=R.value[g],b=Number(W.value);if(!A.value&&(!W.value||isNaN(b)||b<=0||b>Number(n.amount))){O.value.amount=["Please enter a valid amount between 0 and "+le(Number(n.amount),n.currency)];return}if(!N.value){O.value.date=["Please select a payment date."];return}O.value={},C.value=!0;try{const z=n.id,ge=A.value||Math.abs(b-Number(n.amount))<.01,ve={payment_amount:ge?Number(n.amount):b,pay_in_full:ge,transaction_currency:n.currency,transaction_type:n.type,original_description:n.description,payment_date:N.value};await window.axios.patch(`/api/projects/${T.projectId}/transactions/${z}/process-payment`,ve),await D(),Ne("Payment processed successfully!"),pe()}catch(z){((U=z.response)==null?void 0:U.status)===422?O.value=z.response.data.errors:(k.value="Failed to process payment.",console.error("Error processing payment:",z))}finally{C.value=!1}},Q=L(()=>!J.value||Object.keys(J.value).length===0?0:R.value.filter(g=>g.type==="income").reduce((g,n)=>g+je(parseFloat(n.amount||0),n.currency,V.value),0)),ue=L(()=>!J.value||Object.keys(J.value).length===0?0:R.value.filter(g=>g.type==="expense").reduce((g,n)=>g+je(parseFloat(n.amount||0),n.currency,V.value),0)),we=L(()=>!J.value||Object.keys(J.value).length===0?0:R.value.filter(g=>g.type==="bonus").reduce((g,n)=>g+je(parseFloat(n.amount||0),n.currency,V.value),0)),$e=L(()=>le(Q.value,V.value)),Pe=L(()=>le(ue.value,V.value)),Be=L(()=>le(we.value,V.value)),Le=L(()=>{if(!J.value||Object.keys(J.value).length===0)return le(0,V.value);const g=ue.value+we.value;return le(Q.value-g,V.value)}),Se=L(()=>Q.value===0?"0.00%":`${(ue.value/Q.value*100).toFixed(2)}%`),Ie=L(()=>Q.value===0?"0.00%":`${((ue.value+we.value)/Q.value*100).toFixed(2)}%`),ke=L(()=>{if(Q.value<=0)return le(0,V.value);const g=Q.value*He;return le(g,V.value)}),Ce=L(()=>{const g=R.value.filter(b=>(b.type==="expense"||b.type==="bonus")&&b.is_paid&&b.payment_date);if(g.length===0)return"N/A";const n=g.reduce((b,U)=>new Date(U.payment_date)>new Date(b.payment_date)?U:b);return new Date(n.payment_date).toLocaleDateString()}),De=L(()=>{const g=R.value.filter(b=>b.type==="income"&&b.payment_date);if(g.length===0)return"N/A";const n=g.reduce((b,U)=>new Date(U.payment_date)>new Date(b.payment_date)?U:b);return new Date(n.payment_date).toLocaleDateString()});return Fe(async()=>{const g=localStorage.getItem("displayCurrency");g&&(V.value=g),await Je(),D(),j()}),ee([()=>T.projectId,V,J],()=>{T.projectId&&J.value&&Object.keys(J.value).length>0&&(D(),j())},{deep:!0}),ee(V,g=>{g&&localStorage.setItem("displayCurrency",g)},{deep:!0}),(g,n)=>{var b,U,z,ge,ve,be;return r(),i("div",Xt,[n[25]||(n[25]=t("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"Project Transactions",-1)),k.value?(r(),i("div",Qt,_(k.value),1)):f("",!0),u(p)||u(w)?(r(),i("div",Zt,[t("div",es,[t("div",ts,[n[10]||(n[10]=t("span",{class:"text-sm font-medium text-gray-700 mr-2"},"Currency:",-1)),d(Ae,{id:"transactions-display-currency-switcher",modelValue:u(V),"onUpdate:modelValue":n[0]||(n[0]=y=>ct(V)?V.value=y:null),options:P,"value-key":"value","label-key":"label",class:"w-24"},null,8,["modelValue"])]),n[19]||(n[19]=t("h4",{class:"text-md font-medium text-gray-700 mb-2"},"Summary",-1)),t("div",ss,[t("div",as,[n[11]||(n[11]=t("p",{class:"text-sm text-gray-600"},"Total Income",-1)),t("p",os,_($e.value),1)]),t("div",ls,[n[12]||(n[12]=t("p",{class:"text-sm text-gray-600"},"Total Expenses",-1)),t("p",ns,_(Pe.value),1),t("p",rs,"("+_(Se.value)+" of Income)",1)]),t("div",is,[n[13]||(n[13]=t("p",{class:"text-sm text-gray-600"},"Total Bonuses",-1)),t("p",ds,_(Be.value),1)]),t("div",us,[n[14]||(n[14]=t("p",{class:"text-sm text-gray-600"},"Balance",-1)),t("p",cs,_(Le.value),1)]),t("div",ms,[n[15]||(n[15]=t("p",{class:"text-sm text-gray-600"},"Expense + Bonus",-1)),t("p",vs,_(u(le)(ue.value+we.value,u(V))),1),t("p",ps,"("+_(Ie.value)+" of Income)",1)]),t("div",ys,[n[16]||(n[16]=t("p",{class:"text-sm font-medium text-orange-800"},"Estimated Income Tax (AUD)",-1)),t("p",fs,_(ke.value),1),t("p",gs," (Based on "+_((He*100).toFixed(1))+"% of Total Income. This is an estimation.) ",1)]),t("div",bs,[n[17]||(n[17]=t("p",{class:"text-sm font-medium text-gray-800"},"Last Payment Received Date",-1)),t("p",_s,_(De.value),1)]),t("div",hs,[n[18]||(n[18]=t("p",{class:"text-sm font-medium text-gray-800"},"Last Payment Sent Date",-1)),t("p",xs,_(Ce.value),1)])])]),n[20]||(n[20]=t("h4",{class:"text-md font-medium text-gray-700 mb-4"},"Add Transaction",-1)),t("div",ws,[t("div",null,[d(E,{for:"description",value:"Description"}),d(Z,{id:"description",modelValue:I.value.description,"onUpdate:modelValue":n[1]||(n[1]=y=>I.value.description=y),class:"mt-1 block w-full",disabled:C.value},null,8,["modelValue","disabled"]),d(K,{message:(b=M.value.description)==null?void 0:b[0],class:"mt-2"},null,8,["message"])]),t("div",null,[d(E,{for:"amount",value:"Amount"}),d(Z,{id:"amount",type:"number",modelValue:I.value.amount,"onUpdate:modelValue":n[2]||(n[2]=y=>I.value.amount=y),class:"mt-1 block w-full",disabled:C.value},null,8,["modelValue","disabled"]),d(K,{message:(U=M.value.amount)==null?void 0:U[0],class:"mt-2"},null,8,["message"])]),t("div",null,[d(E,{for:"currency",value:"Currency"}),d(Ae,{id:"currency",modelValue:I.value.currency,"onUpdate:modelValue":n[3]||(n[3]=y=>I.value.currency=y),options:P,disabled:C.value},null,8,["modelValue","disabled"]),d(K,{message:(z=M.value.currency)==null?void 0:z[0],class:"mt-2"},null,8,["message"])]),t("div",null,[d(E,{for:"type",value:"Type"}),d(Ae,{id:"type",modelValue:I.value.type,"onUpdate:modelValue":n[4]||(n[4]=y=>I.value.type=y),options:m,disabled:C.value||!u(p)&&I.value.type==="expense"&&I.value.type!=="bonus"||!u(w)&&I.value.type==="income"},null,8,["modelValue","disabled"]),d(K,{message:(ge=M.value.type)==null?void 0:ge[0],class:"mt-2"},null,8,["message"])]),I.value.type==="expense"||I.value.type==="bonus"?(r(),i("div",ks,[d(E,{for:"user_id",value:"User"}),d(Ae,{id:"user_id",modelValue:I.value.user_id,"onUpdate:modelValue":n[5]||(n[5]=y=>I.value.user_id=y),options:a.value,disabled:C.value||!S.value.length,placeholder:"Select a user"},null,8,["modelValue","options","disabled"]),d(K,{message:(ve=M.value.user_id)==null?void 0:ve[0],class:"mt-2"},null,8,["message"])])):f("",!0),I.value.type==="expense"||I.value.type==="bonus"?(r(),i("div",js,[d(E,{for:"hours_spent",value:"Hours Spent (Optional)"}),d(Z,{id:"hours_spent",type:"number",modelValue:I.value.hours_spent,"onUpdate:modelValue":n[6]||(n[6]=y=>I.value.hours_spent=y),class:"mt-1 block w-full",disabled:C.value},null,8,["modelValue","disabled"]),d(K,{message:(be=M.value.hours_spent)==null?void 0:be[0],class:"mt-2"},null,8,["message"])])):f("",!0)]),t("div",$s,[d(ye,{onClick:re,disabled:C.value},{default:ne(()=>[te(_(C.value?"Saving...":"Save Transaction"),1)]),_:1},8,["disabled"])])])):f("",!0),u(X)?(r(),i("div",Ps,[n[24]||(n[24]=t("h4",{class:"text-md font-medium text-gray-700 mb-4"},"Transaction History",-1)),C.value?(r(),i("div",Ss,n[21]||(n[21]=[t("div",{class:"h-4 bg-gray-200 rounded animate-pulse w-full"},null,-1),t("div",{class:"h-4 bg-gray-200 rounded animate-pulse w-5/6"},null,-1),t("div",{class:"h-4 bg-gray-200 rounded animate-pulse w-3/4"},null,-1)]))):R.value.length===0?(r(),i("div",Is," No transactions found for this project. ")):(r(),i("div",Cs,[(r(!0),i(se,null,ae(R.value,(y,_e)=>{var he,ie,e;return r(),i("div",{key:y.id,class:H([{"bg-green-50 border-green-200":y.type==="income","bg-red-50 border-red-200":y.type==="expense","bg-purple-50 border-purple-200":y.type==="bonus","border-l-4":!0},"p-4 rounded-md shadow-sm transition-all duration-200 ease-in-out hover:shadow-md"])},[t("div",Ds,[t("div",Vs,[t("p",Us,_(y.description),1),t("p",As,_(y.type==="income"?"Income":y.type==="expense"?"Expense":"Bonus")+" on "+_(new Date(y.created_at).toLocaleDateString()),1)]),t("div",Rs,[t("p",{class:H(["text-lg font-bold",{"text-green-700":y.type==="income","text-red-700":y.type==="expense","text-purple-700":y.type==="bonus"}])},_(u(le)(y.amount,y.currency)),3),y.currency.toUpperCase()!==u(V).toUpperCase()?(r(),i("p",Ts," ("+_(u(le)(u(je)(y.amount,y.currency,u(V)),u(V)))+") ",1)):f("",!0),t("span",{class:H(["block text-xs mt-1",y.is_paid?"text-green-600":"text-red-600"])},_(y.is_paid?"Paid":"Unpaid"),3)])]),t("div",Ns,[t("div",null,[y.user_id?(r(),i("span",Es,"User: "+_(((he=S.value.find(de=>de.id===y.user_id))==null?void 0:he.name)||"Unknown"),1)):f("",!0),y.hours_spent?(r(),i("span",Os,"Hours: "+_(y.hours_spent),1)):f("",!0),(y.type==="expense"||y.type==="bonus")&&Q.value>0?(r(),i("span",Fs,_((u(je)(y.amount,y.currency,u(V))/Q.value*100).toFixed(2))+"% of Income ",1)):f("",!0)]),t("div",Ms,[!y.is_paid&&(u(p)||u(w))?(r(),Ke(Te,{key:0,onClick:de=>me(_e),class:H({"text-green-600":y.type!=="income","text-blue-600":y.type==="income"})},{default:ne(()=>[te(_(y.type==="income"?"Receive":"Pay"),1)]),_:2},1032,["onClick","class"])):f("",!0),u(p)||u(w)?(r(),Ke(Te,{key:1,onClick:de=>Me(_e),class:"text-red-600"},{default:ne(()=>n[22]||(n[22]=[te(" Delete ",-1)])),_:2,__:[22]},1032,["onClick"])):f("",!0)])]),F.value===y.id?(r(),i("div",Bs,[t("h4",Ls,_(y.type==="income"?"Record Receipt":"Make Payment"),1),t("div",qs,[d(E,{for:"payment_date",value:"Date"}),d(Z,{id:"payment_date",type:"date",modelValue:N.value,"onUpdate:modelValue":n[7]||(n[7]=de=>N.value=de),class:"mt-1 block w-full",disabled:C.value},null,8,["modelValue","disabled"]),d(K,{message:(ie=O.value.date)==null?void 0:ie[0],class:"mt-2"},null,8,["message"])]),t("div",Ks,[t("label",zs,[ce(t("input",{type:"checkbox","onUpdate:modelValue":n[8]||(n[8]=de=>A.value=de),class:"mr-2 rounded text-blue-600 focus:ring-blue-500",disabled:C.value},null,8,Gs),[[mt,A.value]]),t("span",Ws,_(y.type==="income"?"Receive in Full":"Pay in Full"),1)])]),A.value?f("",!0):(r(),i("div",Ys,[d(E,{for:"payment_amount",value:"Amount"}),d(Z,{id:"payment_amount",type:"number",modelValue:W.value,"onUpdate:modelValue":n[9]||(n[9]=de=>W.value=de),class:"mt-1 block w-full",disabled:C.value,placeholder:"Enter partial "+(y.type==="income"?"receipt":"payment")+" amount (Max: "+u(le)(y.amount,y.currency)+")"},null,8,["modelValue","disabled","placeholder"]),d(K,{message:(e=O.value.amount)==null?void 0:e[0],class:"mt-2"},null,8,["message"])])),t("div",Js,[d(Te,{onClick:pe,disabled:C.value},{default:ne(()=>n[23]||(n[23]=[te(" Cancel ",-1)])),_:1,__:[23]},8,["disabled"]),d(ye,{onClick:fe,disabled:C.value},{default:ne(()=>[te(_(C.value?"Processing...":y.type==="income"?"Record Receipt":"Submit Payment"),1)]),_:2},1032,["disabled"])])])):f("",!0)],2)}),128))]))])):f("",!0)])}}},Xs={class:"mt-2"},Qs={class:"mb-2"},Zs={key:0,class:"text-gray-500 text-sm mb-2"},ea=["disabled"],ta={value:""},sa=["value"],aa={class:"flex-grow"},oa=["value","onChange","disabled"],la=["value"],na=["onClick"],Xe={__name:"MultiSelectWithRoles",props:{label:{type:String,required:!0},items:{type:Array,default:()=>[]},endpoint:{type:String,default:""},selectedItems:{type:Array,default:()=>[]},itemText:{type:String,default:"name"},itemSubtext:{type:String,default:"email"},itemValue:{type:String,default:"id"},roleOptions:{type:Array,default:()=>[]},roleType:{type:String,default:"application"},defaultRoleId:{type:Number,default:null},error:{type:String,default:""},placeholder:{type:String,default:"Select an item"},showRemoveButton:{type:Boolean,default:!0}},emits:["update:selectedItems"],setup(v,{emit:T}){const h=v,G=T,p=$([]),w=$([]),X=$([]),R=$([]),S=$(!1),M=async()=>{if(!(h.roleOptions.length>0))try{const m=(await Oe.get(`/api/roles?type=${h.roleType}`)).data;X.value=m.map(a=>({value:a.id,label:a.name}))}catch(P){console.error("Error fetching roles:",P)}},k=L(()=>X.value.length>0?X.value:h.roleOptions),C=()=>h.defaultRoleId?h.defaultRoleId:k.value.length>0?k.value[0].value:1,F=()=>{if(console.log("initializeFromProps called with selectedItems:",h.selectedItems),!h.selectedItems||h.selectedItems.length===0){p.value=[],w.value=[],console.log("Cleared selectedIds and selectedItemsWithRoles because props.selectedItems is empty");return}const P=new Set;h.selectedItems.forEach(m=>{const a=typeof m=="object"?m.id:m;if(!P.has(a)){if(P.add(a),!p.value.includes(a))p.value.push(a),typeof m=="object"&&m.role_id?w.value.push({id:a,role_id:m.role_id}):w.value.push({id:a,role_id:C()});else if(typeof m=="object"&&m.role_id){const l=w.value.find(j=>j.id===a);l&&(l.role_id=m.role_id)}}}),console.log("After initialization, selectedIds:",p.value),console.log("After initialization, selectedItemsWithRoles:",w.value)};ee(()=>h.selectedItems,(P,m)=>{console.log("selectedItems changed:",P),JSON.stringify(P)!==JSON.stringify(m)?(console.log("selectedItems changed significantly, reinitializing"),F()):console.log("selectedItems change was not significant, skipping reinitialization")},{deep:!0,immediate:!0}),ee(w,P=>{G("update:selectedItems",P)},{deep:!0});const W=P=>{P&&!p.value.includes(P)&&(p.value.push(P),w.value.push({id:P,role_id:C()}))},A=P=>{p.value=p.value.filter(m=>m!==P),w.value=w.value.filter(m=>m.id!==P)},O=(P,m)=>{const a=w.value.find(l=>l.id===P);a&&(a.role_id=parseInt(m))},q=P=>V.value.find(m=>m[h.itemValue]===P),N=P=>{const m=w.value.find(a=>a.id===P);return m?m.role_id:C()},I=async()=>{if(h.endpoint){S.value=!0;try{const P=await Oe.get(h.endpoint);P.data&&Array.isArray(P.data)?R.value=P.data:P.data&&P.data.data&&Array.isArray(P.data.data)&&(R.value=P.data.data)}catch(P){console.error("Error fetching items from endpoint:",P)}finally{S.value=!1}}},V=L(()=>h.endpoint&&R.value.length>0?R.value:h.items);return Fe(()=>{M(),F(),h.endpoint&&I()}),(P,m)=>(r(),i("div",null,[d(E,{value:v.label},null,8,["value"]),t("div",Xs,[t("div",Qs,[S.value?(r(),i("div",Zs,"Loading...")):f("",!0),v.showRemoveButton?(r(),i("select",{key:1,class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full",onChange:m[0]||(m[0]=a=>{const l=parseInt(a.target.value);W(l),a.target.value=""}),disabled:S.value},[t("option",ta,_(v.placeholder),1),(r(!0),i(se,null,ae(V.value.filter(a=>!p.value.includes(a[v.itemValue])),a=>(r(),i("option",{key:a[v.itemValue],value:a[v.itemValue]},_(a[v.itemText])+" ("+_(a[v.itemSubtext])+") ",9,sa))),128))],40,ea)):f("",!0)]),(r(!0),i(se,null,ae(p.value,a=>{var l,j;return r(),i("div",{key:a,class:"flex items-center mb-1 p-2 border rounded"},[t("div",aa,_((l=q(a))==null?void 0:l[v.itemText])+" ("+_((j=q(a))==null?void 0:j[v.itemSubtext])+") ",1),t("select",{class:"ms-2 border-gray-300 rounded-md",value:N(a),onChange:D=>O(a,D.target.value),disabled:!v.showRemoveButton},[(r(!0),i(se,null,ae(k.value,D=>(r(),i("option",{key:D.value,value:D.value},_(D.label),9,la))),128))],40,oa),v.showRemoveButton?(r(),i("button",{key:0,type:"button",class:"ml-2 text-red-600",onClick:()=>A(a)}," Remove ",8,na)):f("",!0)])}),128))]),d(K,{message:v.error,class:"mt-2"},null,8,["message"])]))}},ra={class:"p-6 w-full max-w-6xl mx-auto bg-white rounded-lg shadow-xl"},ia={class:"flex justify-between items-center mb-4"},da={class:"text-lg font-medium text-gray-900"},ua={key:0,class:"text-red-600 text-sm mb-4"},ca={key:1,class:"mb-4"},ma={key:0,class:"text-xs text-gray-500 mt-2 p-2 bg-gray-100 rounded"},va={class:"font-bold"},pa={class:"mt-1"},ya={key:0},fa={key:1},ga={key:2},ba={key:0},_a={class:"list-disc ml-4"},ha={key:0},xa={class:"mt-1"},wa={class:"border-b border-gray-200 mb-6"},ka={class:"flex -mb-px"},ja={key:0},$a={class:"mb-4"},Pa={class:"mb-4"},Sa=["disabled"],Ia={class:"mb-4"},Ca={class:"mb-4"},Da={key:0,class:"mb-4"},Va={key:1,class:"mb-4"},Ua={class:"mb-4"},Aa=["disabled"],Ra=["value"],Ta={class:"mb-4"},Na=["disabled"],Ea=["value"],Oa={key:2,class:"mt-6 flex justify-end"},Fa={key:1},Ma={key:0,class:"mb-4"},Ba={key:0,class:"mt-2 flex justify-end"},La={key:1,class:"mt-2 text-green-600 text-sm"},qa={key:2,class:"mt-2 text-red-600 text-sm"},Ka={class:"mb-4"},za=["disabled"],Ga={key:1,class:"mb-4"},Wa={key:0,class:"mt-2 flex justify-end"},Ya={key:1,class:"mt-2 text-green-600 text-sm"},Ja={key:2,class:"mt-2 text-red-600 text-sm"},Ha={key:2},Xa={key:3},Qa={key:4},Za={class:"mb-4"},eo={class:"mt-2"},to={key:0,class:"mb-4"},so={class:"mt-4"},ao={key:0,class:"text-sm text-red-500 mt-2"},oo={key:1,class:"mt-4"},lo={class:"flex-grow"},no=["href"],ro=["onClick"],io={key:5},uo={class:"mb-4"},co={class:"mt-2"},mo={key:0},vo={class:"flex items-start mb-2"},po=["onUpdate:modelValue","readonly"],yo={key:1,class:"p-4 bg-gray-50 rounded-md text-gray-600 text-center"},fo={class:"mt-6 flex justify-end"},$o={__name:"ProjectForm",props:{show:{type:Boolean,required:!0},project:{type:Object,default:()=>({})},statusOptions:{type:Array,required:!0},departmentOptions:{type:Array,required:!0},sourceOptions:{type:Array,required:!0},clientRoleOptions:{type:Array,default:()=>[]},userRoleOptions:{type:Array,default:()=>[]},paymentTypeOptions:{type:Array,required:!0}},emits:["close","submit"],setup(v,{emit:T}){vt();const h=$({}),G=v;ee(()=>G.project,s=>{h.value=s||{}},{immediate:!0});const p=L(()=>{var s;return((s=h.value)==null?void 0:s.id)||null}),{permissions:w,loading:X,error:R}=pt(p),S=yt(h);L(()=>!!S.value),L(()=>{if(!S.value)return!1;const s=S.value.name,o=S.value.slug;return s==="Manager"||s==="Project Manager"||o==="manager"||o==="project-manager"});const{canDo:M,canView:k,canManage:C}=et(p),F=M("manage_projects",S),W=M("create_projects",S),A=M("create_clients",S),O=M("upload_project_documents",S);C("project_expenses",S),C("project_income",S);const q=C("project_services_and_payments",S),N=M("add_project_notes",S),I=C("project_users",S),V=C("project_clients",S),P=C("project_basic_details",S),m=k("project_documents",S),a=k("project_services_and_payments",S),l=k("project_notes",S),j=k("project_users",S),D=k("project_clients",S),re=k("project_transactions",S),Y=$("basic"),Me=L(()=>D.value&&j.value?"Clients and Users":D.value?"Clients":j.value?"Users":"Clients and Users"),me=s=>{if(!(s==="documents"&&!e.id)&&(Y.value=s,e.id))switch(z.value=!0,s){case"basic":Se(e.id).finally(()=>{z.value=!1});break;case"client":D.value||V.value||j.value||I.value?Ie(e.id).finally(()=>{z.value=!1}):z.value=!1;break;case"services":a.value||q.value?ke(e.id).finally(()=>{z.value=!1}):z.value=!1;break;case"transactions":z.value=!1;break;case"documents":m.value?Ce(e.id).finally(()=>{z.value=!1}):z.value=!1;break;case"notes":l.value||N.value?De(e.id).finally(()=>{z.value=!1}):z.value=!1;break;default:z.value=!1;break}},pe=$([]),fe=$([]),Q=$([]),ue=$([]),we=async()=>{try{const o=(await Oe.get("/api/roles?type=client")).data;pe.value=o.map(B=>({value:B.id,label:B.name}));const c=(await Oe.get("/api/roles?type=project")).data;fe.value=c.map(B=>({value:B.id,label:B.name}))}catch(s){console.error("Error fetching roles:",s)}},$e=async()=>{try{if(A.value){const s=await window.axios.get("/api/clients");Q.value=s.data.data||s.data}else if(p.value){const s=await window.axios.get(`/api/projects/${p.value}/clients`);Q.value=s.data}else{const s=await window.axios.get("/api/clients");Q.value=s.data.data||s.data}}catch(s){console.error("Error fetching clients:",s),U.value="Failed to load clients."}},Pe=async()=>{try{if(W.value){const s=await window.axios.get("/api/users");ue.value=s.data}else if(p.value){const s=await window.axios.get(`/api/projects/${p.value}/users`);ue.value=s.data}else{const s=await window.axios.get("/api/users");ue.value=s.data}}catch(s){console.error("Error fetching users:",s),U.value="Failed to load users."}},Be=L(()=>pe.value.length>0?pe.value:G.clientRoleOptions),Le=L(()=>fe.value.length>0?fe.value:G.userRoleOptions),Se=async s=>{try{const x=(await window.axios.get(`/api/projects/${s}/sections/basic`)).data;return e.name=x.name||"",e.description=x.description||"",e.website=x.website||"",e.social_media_link=x.social_media_link||"",e.preferred_keywords=x.preferred_keywords||"",e.google_chat_id=x.google_chat_id||"",e.status=x.status||"active",e.project_type=x.project_type||"",e.source=x.source||"",e.google_drive_link=x.google_drive_link||"",x}catch(o){return console.error("Error fetching basic project data:",o),U.value="Failed to fetch basic project data.",null}},Ie=async s=>{try{const x=(await window.axios.get(`/api/projects/${s}/sections/clients-users`)).data;return x.clients&&x.clients.length>0&&(e.client_ids=x.clients.map(c=>{var oe;let B=((oe=c.pivot)==null?void 0:oe.role_id)||(pe.value.length>0?pe.value[0].value:1);return{id:c.id,role_id:B}})),x.users&&x.users.length>0&&(e.user_ids=x.users.map(c=>{var oe;let B=((oe=c.pivot)==null?void 0:oe.role_id)||(fe.value.length>0?fe.value[0].value:2);return{id:c.id,role_id:B}})),x.contract_details!==void 0&&(e.contract_details=x.contract_details||""),x}catch(o){return console.error("Error fetching clients and users data:",o),U.value="Failed to fetch clients and users data.",null}},ke=async s=>{try{const x=(await window.axios.get(`/api/projects/${s}/sections/services-payment`)).data;return e.services=x.services||[],e.service_details=x.service_details||[],e.total_amount=x.total_amount||"",e.payment_type=x.payment_type||"one_off",x}catch(o){return console.error("Error fetching services and payment data:",o),U.value="Failed to fetch services and payment data.",null}},Ce=async s=>{try{const x=(await window.axios.get(`/api/projects/${s}/sections/documents`)).data;return e.documents=x.documents||[],x}catch(o){return console.error("Error fetching documents data:",o),U.value="Failed to fetch documents data.",null}},De=async s=>{try{const x=(await window.axios.get(`/api/projects/${s}/sections/notes`)).data;return e.notes=x.map(c=>({content:c.content})),x}catch(o){return console.error("Error fetching notes data:",o),U.value="Failed to fetch notes data.",null}},g=async s=>{try{switch(await Se(s),Y.value){case"client":(D.value||V.value||j.value||I.value)&&await Ie(s);break;case"services":(a.value||q.value)&&await ke(s);break;case"documents":m.value&&await Ce(s);break;case"notes":(l.value||N.value)&&await De(s);break}}catch(o){console.error("Error fetching project data:",o),U.value="Failed to fetch project data."}};Fe(()=>{we(),$e(),Pe(),p.value&&Ye(p.value).then(s=>{}).catch(s=>{})}),ee(p,(s,o)=>{s&&s!==o&&(Ye(s).then(x=>{}).catch(x=>{}),Pe(),$e())});const n=T,b=$({}),U=$(""),z=$(!1),ge=$(!1),ve=$(!1),be=$(!1),y=$(""),_e=$(!1),he=$(!1),ie=$(""),e=Qe({id:null,name:"",description:"",website:"",social_media_link:"",preferred_keywords:"",google_chat_id:"",logo:null,documents:[],client_ids:[],status:"active",project_type:"",services:[],service_details:[],source:"",total_amount:"",contract_details:"",google_drive_link:"",payment_type:"one_off",user_ids:[],notes:[]});ee(()=>G.show,s=>{s&&(e.client_ids||(e.client_ids=[]),e.user_ids||(e.user_ids=[]),e.id&&g(e.id))},{immediate:!0}),ee(()=>G.project,s=>{const o=e.id;e.id=s.id||null,o&&!e.id&&Y.value==="documents"&&me("basic"),e.name=s.name||"",e.description=s.description||"",e.website=s.website||"",e.social_media_link=s.social_media_link||"",e.preferred_keywords=s.preferred_keywords||"",e.google_chat_id=s.google_chat_id||"",e.logo=s.logo||null,e.documents=s.documents||[],e.client_ids=[],e.status=s.status||"active",e.project_type=s.project_type||"",e.services=s.services||[],e.service_details=s.service_details||[],e.source=s.source||"",e.total_amount=s.total_amount||"",e.contract_details=s.contract_details||"",e.google_drive_link=s.google_drive_link||"",e.payment_type=s.payment_type||"one_off",e.user_ids=[],e.notes=s.notes?s.notes.map(x=>({content:x.content})):[],b.value={},U.value=""},{immediate:!0});const de=async()=>{b.value={},U.value="";try{const s={name:e.name,description:e.description,website:e.website,social_media_link:e.social_media_link,preferred_keywords:e.preferred_keywords,google_chat_id:e.google_chat_id,status:e.status,project_type:e.project_type,source:e.source,google_drive_link:e.google_drive_link,user_ids:e.user_ids},o=e.logo;typeof o=="object"&&o!==null&&"name"in o&&delete s.logo;const x=await window.axios.post("/api/projects",s);e.id=x.data.id,typeof o=="object"&&o!==null&&"name"in o&&await We(o,e.id),n("submit",x.data)}catch(s){ze(s,"Failed to create project.")}},st=async()=>{b.value={},U.value="";try{const s={name:e.name,description:e.description,website:e.website,social_media_link:e.social_media_link,preferred_keywords:e.preferred_keywords,google_chat_id:e.google_chat_id,status:e.status,project_type:e.project_type,source:e.source,google_drive_link:e.google_drive_link},o=e.logo;typeof o=="object"&&o!==null&&"name"in o&&delete s.logo;const x=await window.axios.put(`/api/projects/${e.id}/sections/basic`,s);typeof o=="object"&&o!==null&&"name"in o&&await We(o,e.id),Ne("Basic information updated successfully!")}catch(s){ze(s,"Failed to update basic information.")}},ze=(s,o)=>{s.response&&s.response.status===422?b.value=s.response.data.errors:s.response&&s.response.data.message?U.value=s.response.data.message:(U.value=o,console.error("Error:",s))},Ve=$(!1),qe=$({});ee(e,()=>{Object.keys(qe.value).length>0&&(Ve.value=!0)},{deep:!0}),ee(()=>G.show,s=>{s&&setTimeout(()=>{qe.value=JSON.parse(JSON.stringify(e)),Ve.value=!1},100)});const Ge=()=>{Ve.value?confirm("You have unsaved changes. Are you sure you want to close this form?")&&n("close"):n("close")},We=async(s,o)=>{try{const x=new FormData;x.append("logo",s);const c=await window.axios.post(`/api/projects/${o}/logo`,x,{headers:{"Content-Type":"multipart/form-data"}});return c.data&&c.data.logo&&(e.logo=c.data.logo),c}catch(x){console.error("Error uploading logo:",x)}},at=async()=>{if(!e.id){y.value="Please save the project first before saving clients.";return}if(!e.client_ids||e.client_ids.length===0){y.value="Please select at least one client to save.";return}ve.value=!0,be.value=!1,y.value="";try{const s=await window.axios.post(`/api/projects/${e.id}/attach-clients`,{client_ids:e.client_ids});be.value=!0,setTimeout(()=>{be.value=!1},3e3)}catch(s){s.response&&s.response.status===422?y.value="Validation error. Please check your input.":s.response&&s.response.data.message?y.value=s.response.data.message:(y.value="Failed to save clients.",console.error("Error saving clients:",s))}finally{ve.value=!1}},ot=async()=>{if(!e.id){ie.value="Please save the project first before saving users.";return}if(!e.user_ids||e.user_ids.length===0){ie.value="Please select at least one user to save.";return}_e.value=!0,he.value=!1,ie.value="";try{const s=await window.axios.post(`/api/projects/${e.id}/attach-users`,{user_ids:e.user_ids});he.value=!0,setTimeout(()=>{he.value=!1},3e3)}catch(s){s.response&&s.response.status===422?ie.value="Validation error. Please check your input.":s.response&&s.response.data.message?ie.value=s.response.data.message:(ie.value="Failed to save users.",console.error("Error saving users:",s))}finally{_e.value=!1}},lt=async()=>{if(!e.id){U.value="Please save the project first before uploading documents.";return}if(!e.documents||!e.documents.some(s=>typeof s=="object"&&s!==null&&"name"in s&&"size"in s&&"type"in s)){U.value="Please select documents to upload.";return}try{const s=new FormData;e.documents.filter(B=>typeof B=="object"&&B!==null&&"name"in B&&"size"in B&&"type"in B).forEach((B,oe)=>{s.append(`documents[${oe}]`,B)});const x=await window.axios.post(`/api/projects/${e.id}/documents`,s,{headers:{"Content-Type":"multipart/form-data"}});e.documents=x.data.documents||[],document.getElementById("documents").value="",alert("Documents uploaded successfully!");const c=JSON.parse(JSON.stringify(e));qe.value=c,Ve.value=!1}catch(s){s.response&&s.response.status===422?b.value=s.response.data.errors:s.response&&s.response.data.message?U.value=s.response.data.message:(U.value="Failed to upload documents.",console.error("Error uploading documents:",s))}};return(s,o)=>{var x;return r(),i("div",ra,[t("div",ia,[t("h2",da,_(e.id?"Edit Project":"Create New Project"),1),t("button",{onClick:Ge,class:"text-gray-400 hover:text-gray-500"},o[21]||(o[21]=[t("svg",{class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),U.value?(r(),i("div",ua,_(U.value),1)):f("",!0),p.value?(r(),i("div",ca,[ge.value?(r(),i("div",ma,[t("div",va,"Project ID: "+_(p.value),1),t("div",null,_(u(S)?"Project Role: "+(((x=u(S).value)==null?void 0:x.name)||"None"):"No Project Role"),1),t("div",pa,[o[23]||(o[23]=t("div",{class:"font-semibold"},"Project Permissions:",-1)),u(X)?(r(),i("div",ya,"Loading project permissions...")):u(R)?(r(),i("div",fa,"Error loading project permissions")):u(w)?(r(),i("div",ga,[te(" Count: "+_(u(w).permissions?u(w).permissions.length:0)+" ",1),u(w).permissions&&u(w).permissions.length>0?(r(),i("div",ba,[o[22]||(o[22]=t("div",{class:"font-semibold"},"Permissions:",-1)),t("ul",_a,[(r(!0),i(se,null,ae(u(w).permissions.slice(0,5),c=>(r(),i("li",{key:c.slug},_(c.name)+" ("+_(c.source)+") ",1))),128)),u(w).permissions.length>5?(r(),i("li",ha," ... and "+_(u(w).permissions.length-5)+" more ",1)):f("",!0)])])):f("",!0)])):f("",!0)]),t("div",xa,"Can manage projects: "+_(u(F)?"Yes":"No"),1)])):f("",!0)])):f("",!0),t("div",wa,[t("nav",ka,[u(F)?(r(),i("button",{key:0,onClick:o[0]||(o[0]=c=>me("basic")),class:H(["py-2 px-4 text-center border-b-2 font-medium text-sm",Y.value==="basic"?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"])}," Basic Information ",2)):f("",!0),u(D)||u(j)?(r(),i("button",{key:1,onClick:o[1]||(o[1]=c=>me("client")),class:H(["py-2 px-4 text-center border-b-2 font-medium text-sm",Y.value==="client"?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"])},_(Me.value),3)):f("",!0),e.id&&(u(q)||u(a))?(r(),i("button",{key:2,onClick:o[2]||(o[2]=c=>me("services")),class:H(["py-2 px-4 text-center border-b-2 font-medium text-sm",Y.value==="services"?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"])}," Services & Payment ",2)):f("",!0),e.id&&u(re)?(r(),i("button",{key:3,onClick:o[3]||(o[3]=c=>me("transactions")),class:H(["py-2 px-4 text-center border-b-2 font-medium text-sm",Y.value==="transactions"?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"])}," Transactions ",2)):f("",!0),e.id&&u(m)?(r(),i("button",{key:4,onClick:o[4]||(o[4]=c=>me("documents")),class:H(["py-2 px-4 text-center border-b-2 font-medium text-sm",Y.value==="documents"?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"])}," Documents ",2)):f("",!0),e.id&&(u(N)||u(l))?(r(),i("button",{key:5,onClick:o[5]||(o[5]=c=>me("notes")),class:H(["py-2 px-4 text-center border-b-2 font-medium text-sm",Y.value==="notes"?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"])}," Notes ",2)):f("",!0)])]),t("form",{onSubmit:o[20]||(o[20]=Ze(()=>{},["prevent"]))},[Y.value==="basic"?(r(),i("div",ja,[t("div",$a,[d(E,{for:"name",value:"Project Name"}),d(Z,{id:"name",type:"text",class:"mt-1 block w-full",modelValue:e.name,"onUpdate:modelValue":o[6]||(o[6]=c=>e.name=c),required:"",autofocus:"",disabled:!u(F)},null,8,["modelValue","disabled"]),d(K,{message:b.value.name?b.value.name[0]:"",class:"mt-2"},null,8,["message"])]),t("div",Pa,[d(E,{for:"description",value:"Description"}),ce(t("textarea",{id:"description",class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full","onUpdate:modelValue":o[7]||(o[7]=c=>e.description=c),disabled:!u(F)},null,8,Sa),[[Re,e.description]]),d(K,{message:b.value.description?b.value.description[0]:"",class:"mt-2"},null,8,["message"])]),t("div",Ia,[d(E,{for:"website",value:"Website"}),d(Z,{id:"website",type:"url",class:"mt-1 block w-full",modelValue:e.website,"onUpdate:modelValue":o[8]||(o[8]=c=>e.website=c),disabled:!u(F)},null,8,["modelValue","disabled"]),d(K,{message:b.value.website?b.value.website[0]:"",class:"mt-2"},null,8,["message"])]),t("div",Ca,[d(E,{for:"preferred_keywords",value:"Client Preferred Keywords"}),d(Z,{id:"preferred_keywords",type:"text",class:"mt-1 block w-full",modelValue:e.preferred_keywords,"onUpdate:modelValue":o[9]||(o[9]=c=>e.preferred_keywords=c),disabled:!u(F)},null,8,["modelValue","disabled"]),d(K,{message:b.value.preferred_keywords?b.value.preferred_keywords[0]:"",class:"mt-2"},null,8,["message"])]),u(P)?(r(),i("div",Da,[d(E,{for:"google_chat_id",value:"Google Chat ID"}),d(Z,{id:"google_chat_id",type:"text",class:"mt-1 block w-full",modelValue:e.google_chat_id,"onUpdate:modelValue":o[10]||(o[10]=c=>e.google_chat_id=c),disabled:!u(F)},null,8,["modelValue","disabled"]),d(K,{message:b.value.google_chat_id?b.value.google_chat_id[0]:"",class:"mt-2"},null,8,["message"])])):f("",!0),u(P)?(r(),i("div",Va,[d(E,{for:"google_drive_link",value:"Google Drive Link"}),d(Z,{id:"google_drive_link",type:"text",class:"mt-1 block w-full",modelValue:e.google_drive_link,"onUpdate:modelValue":o[11]||(o[11]=c=>e.google_drive_link=c),disabled:!u(F)},null,8,["modelValue","disabled"]),d(K,{message:b.value.google_chat_id?b.value.google_chat_id[0]:"",class:"mt-2"},null,8,["message"])])):f("",!0),t("div",Ua,[d(E,{for:"status",value:"Status"}),ce(t("select",{id:"status",class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full","onUpdate:modelValue":o[12]||(o[12]=c=>e.status=c),required:"",disabled:!u(F)},[(r(!0),i(se,null,ae(v.statusOptions,c=>(r(),i("option",{key:c.value,value:c.value},_(c.label),9,Ra))),128))],8,Aa),[[Ee,e.status]]),d(K,{message:b.value.status?b.value.status[0]:"",class:"mt-2"},null,8,["message"])]),t("div",Ta,[d(E,{for:"source",value:"Source"}),ce(t("select",{id:"source",class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full","onUpdate:modelValue":o[13]||(o[13]=c=>e.source=c),disabled:!u(F)},[o[24]||(o[24]=t("option",{value:"",disabled:""},"Select a Source",-1)),(r(!0),i(se,null,ae(v.sourceOptions,c=>(r(),i("option",{key:c.value,value:c.value},_(c.label),9,Ea))),128))],8,Na),[[Ee,e.source]]),d(K,{message:b.value.source?b.value.source[0]:"",class:"mt-2"},null,8,["message"])]),u(F)?(r(),i("div",Oa,[e.id&&u(P)||!e.id?(r(),Ke(ye,{key:0,onClick:o[14]||(o[14]=c=>e.id?st():de()),disabled:!u(F)},{default:ne(()=>[te(_(e.id?"Update Basic Information":"Create Project"),1)]),_:1},8,["disabled"])):f("",!0)])):f("",!0)])):f("",!0),Y.value==="client"?(r(),i("div",Fa,[u(D)?(r(),i("div",Ma,[d(Xe,{label:"Clients",items:Q.value,selectedItems:e.client_ids,"onUpdate:selectedItems":o[15]||(o[15]=c=>e.client_ids=c),roleOptions:Be.value,roleType:"client",error:b.value.client_ids?b.value.client_ids[0]:"",placeholder:"Select a client to add",disabled:!u(V),readonly:!u(V)&&u(D),showRemoveButton:u(V)},null,8,["items","selectedItems","roleOptions","error","disabled","readonly","showRemoveButton"]),u(V)?(r(),i("div",Ba,[d(ye,{onClick:at,disabled:ve.value},{default:ne(()=>[te(_(ve.value?"Saving...":"Save Clients"),1)]),_:1},8,["disabled"])])):f("",!0),be.value?(r(),i("div",La," Clients saved successfully! ")):f("",!0),y.value?(r(),i("div",qa,_(y.value),1)):f("",!0)])):f("",!0),t("div",Ka,[d(E,{for:"contract_details",value:"Contract Details"}),ce(t("textarea",{id:"contract_details",class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full","onUpdate:modelValue":o[16]||(o[16]=c=>e.contract_details=c),disabled:!u(F)},null,8,za),[[Re,e.contract_details]]),d(K,{message:b.value.contract_details?b.value.contract_details[0]:"",class:"mt-2"},null,8,["message"])]),u(j)?(r(),i("div",Ga,[d(Xe,{label:"Assign Users",items:ue.value,selectedItems:e.user_ids,"onUpdate:selectedItems":o[17]||(o[17]=c=>e.user_ids=c),roleOptions:Le.value,roleType:"project",defaultRoleId:2,error:b.value.user_ids?b.value.user_ids[0]:"",placeholder:"Select a user to add",disabled:!u(I),readonly:!u(I)&&u(j),showRemoveButton:u(I)},null,8,["items","selectedItems","roleOptions","error","disabled","readonly","showRemoveButton"]),u(I)?(r(),i("div",Wa,[d(ye,{onClick:ot,disabled:_e.value},{default:ne(()=>[te(_(_e.value?"Saving...":"Save Users"),1)]),_:1},8,["disabled"])])):f("",!0),he.value?(r(),i("div",Ya," Users saved successfully! ")):f("",!0),ie.value?(r(),i("div",Ja,_(ie.value),1)):f("",!0)])):f("",!0)])):f("",!0),Y.value==="services"?(r(),i("div",Ha,[d(qt,{projectId:e.id,departmentOptions:v.departmentOptions,paymentTypeOptions:v.paymentTypeOptions,canManageProjectServicesAndPayments:u(q),canViewProjectServicesAndPayments:u(a),onUpdated:o[18]||(o[18]=c=>ke(e.id))},null,8,["projectId","departmentOptions","paymentTypeOptions","canManageProjectServicesAndPayments","canViewProjectServicesAndPayments"])])):f("",!0),Y.value==="transactions"&&u(re)?(r(),i("div",Xa,[d(Hs,{projectId:e.id,userProjectRole:u(S).value},null,8,["projectId","userProjectRole"])])):f("",!0),Y.value==="documents"?(r(),i("div",Qa,[t("div",Za,[d(E,{value:"Project Documents"}),t("div",eo,[u(O)?(r(),i("div",to,[d(E,{for:"documents",value:"Upload Documents"}),t("input",{type:"file",id:"documents",onChange:o[19]||(o[19]=c=>{const B=Array.from(c.target.files);if(B.length>0){const oe=Array.isArray(e.documents)?e.documents.filter(Ue=>typeof Ue=="object"&&"path"in Ue):[];e.documents=[...oe,...B]}}),class:"mt-1 block w-full",multiple:"",accept:".pdf,.doc,.docx,.jpg,.png"},null,32),o[26]||(o[26]=t("p",{class:"text-sm text-gray-500 mt-1"},"Supported formats: PDF, DOC, DOCX, JPG, PNG",-1)),d(K,{message:b.value.documents?b.value.documents[0]:"",class:"mt-2"},null,8,["message"]),t("div",so,[d(ye,{type:"button",onClick:lt,disabled:!e.id||!e.documents||!e.documents.some(c=>typeof c=="object"&&c!==null&&"name"in c&&"size"in c&&"type"in c)},{default:ne(()=>o[25]||(o[25]=[te(" Upload Documents ",-1)])),_:1,__:[25]},8,["disabled"]),e.id?f("",!0):(r(),i("p",ao," Please save the project first before uploading documents. "))])])):f("",!0),e.documents&&e.documents.length>0&&typeof e.documents[0]=="object"&&"path"in e.documents[0]?(r(),i("div",oo,[o[27]||(o[27]=t("h3",{class:"font-medium text-gray-700 mb-2"},"Existing Documents",-1)),(r(!0),i(se,null,ae(e.documents,(c,B)=>(r(),i("div",{key:B,class:"flex items-center mb-2 p-2 border rounded"},[t("div",lo,[t("a",{href:"/storage/"+c.path,target:"_blank",class:"text-blue-600 hover:underline"},_(c.filename),9,no)]),u(O).value?(r(),i("button",{key:0,type:"button",class:"ml-2 text-red-600",onClick:()=>{e.documents=e.documents.filter((oe,Ue)=>Ue!==B)}}," Remove ",8,ro)):f("",!0)]))),128))])):f("",!0),o[28]||(o[28]=t("div",{class:"mt-4"},[t("p",{class:"text-sm text-gray-500"}," Documents will be uploaded to the project's Google Drive folder. ")],-1))])])])):f("",!0),Y.value==="notes"?(r(),i("div",io,[t("div",uo,[d(E,{value:"Notes"}),t("div",co,[e.notes&&e.notes.length>0?(r(),i("div",mo,[(r(!0),i(se,null,ae(e.notes,(c,B)=>(r(),i("div",{key:B,class:"mb-4"},[t("div",vo,[ce(t("textarea",{"onUpdate:modelValue":oe=>c.content=oe,readonly:!u(N),placeholder:"Note Content",class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full h-32"},null,8,po),[[Re,c.content]])])]))),128))])):(r(),i("div",yo," No notes found for this project. "))]),d(K,{message:b.value.notes?b.value.notes[0]:"",class:"mt-2"},null,8,["message"])])])):f("",!0),t("div",fo,[d(Te,{onClick:Ge},{default:ne(()=>o[29]||(o[29]=[te("Close",-1)])),_:1,__:[29]})])],32)])}}};export{Ae as S,$o as _,je as a,Je as b,J as c,tt as d,le as f};
