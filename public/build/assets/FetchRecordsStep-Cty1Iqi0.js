import{u as j}from"./workflowStore-I6WPJ2Rv.js";import L from"./StepCard-CBdjvWs8.js";import M from"./DataTokenInserter-D0K6X0H-.js";import{S as v}from"./SelectDropdown-CtafRPQ5.js";import{P as R}from"./plus-HLNAaRrX.js";import{T as W}from"./trash-r1IWcce2.js";import{c as u,g as S,o as r,w as q,b as s,a as m,i as A,d as c,m as P,u as V,F as z,l as E}from"./app-D5B69b4J.js";/* empty css                                                                       */import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./createLucideIcon-DCxCwdB4.js";const G={class:"space-y-3"},H={key:0},J={class:"flex items-center justify-between mb-2"},K={class:"space-y-2"},Q={class:"grid grid-cols-3 gap-2 items-center"},X={class:"flex items-center justify-end"},Y=["onClick"],Z={class:"grid grid-cols-2 gap-2"},ee={class:"flex items-center gap-1"},le=["value","onChange"],te=["type","value","onInput"],me={__name:"FetchRecordsStep",props:{step:{type:Object,required:!0},allStepsBefore:{type:Array,default:()=>[]},loopContextSchema:{type:Object,default:null}},emits:["update:step","delete"],setup(f,{emit:F}){const b=f,g=F,T=j(),y=u(()=>T.automationSchema||[]),a=u({get:()=>b.step.step_config||{conditions:[]},set:e=>g("update:step",{...b.step,step_config:e})}),U=u(()=>y.value.map(e=>e.name)),D=u(()=>U.value.map(e=>({value:e,label:e}))),h=u(()=>a.value.model&&y.value.find(e=>e.name===a.value.model)||null);function _(e){if(!e||typeof e!="string")return"";let l=e.toLowerCase();if(l==="id")return"ID";l.endsWith("_id")&&(l=l.slice(0,-3)),l=l.replace(/[_-]+/g," ");let t=l.replace(/\b\w/g,o=>o.toUpperCase());return t=t.replace(/\bId\b/g,"ID").replace(/\bUrl\b/g,"URL"),t}const x=u(()=>h.value?(h.value.columns||[]).map(e=>typeof e=="string"?{name:e,label:_(e),type:"Text"}:{...e,label:e.label||_(e.name)}):[]),$=u(()=>x.value.map(e=>({value:e.name,label:`${e.label||e.name}${e.type?` (${e.type})`:""}`})));function i(e){return x.value.find(l=>l.name===e)||null}function I(e){const l=i(e);switch((l==null?void 0:l.type)||"Text"){case"True/False":return[{value:"==",label:"is"},{value:"!=",label:"is not"}];case"Number":return[{value:"==",label:"equals"},{value:">",label:">"},{value:"<",label:"<"},{value:">=",label:">="},{value:"<=",label:"<="}];case"Date":case"DateTime":return[{value:"==",label:"on"},{value:">",label:"after"},{value:"<",label:"before"}];default:return[{value:"==",label:"is"},{value:"!=",label:"is not"},{value:"contains",label:"contains"}]}}function B(){const e=[...a.value.conditions||[],{column:"",operator:"==",value:""}];a.value={...a.value,conditions:e}}function O(e){const l=(a.value.conditions||[]).filter((t,o)=>o!==e);a.value={...a.value,conditions:l}}function d(e,l,t){const o=[...a.value.conditions||[]];o[e]={...o[e],[l]:t},a.value={...a.value,conditions:o}}function N(e,l){var p;const o=((p=(a.value.conditions||[])[e])==null?void 0:p.value)||"";d(e,"value",`${o}${l}`)}return(e,l)=>(r(),S(L,{icon:"🔍",title:"Fetch Records",onDelete:()=>g("delete")},{default:q(()=>[s("div",G,[s("div",null,[l[1]||(l[1]=s("label",{class:"block text-xs font-medium text-gray-600 mb-1"},"Find all records from",-1)),c(v,{options:D.value,"model-value":a.value.model||null,placeholder:"Select model...","onUpdate:modelValue":l[0]||(l[0]=t=>a.value={...a.value,model:t,conditions:[]})},null,8,["options","model-value"])]),a.value.model?(r(),m("div",H,[s("div",J,[l[3]||(l[3]=s("label",{class:"text-xs font-medium text-gray-600"},"Where conditions match",-1)),s("button",{onClick:B,class:"flex items-center gap-1 px-2 py-1 text-xs rounded-md bg-gray-100 hover:bg-gray-200"},[c(V(R),{class:"h-3 w-3"}),l[2]||(l[2]=P(" Add",-1))])]),s("div",K,[(r(!0),m(z,null,E(a.value.conditions,(t,o)=>{var p,C,w,k;return r(),m("div",{key:o,class:"p-2 border rounded-md bg-gray-50/50 space-y-2"},[s("div",Q,[c(v,{options:$.value,"model-value":t.column||null,placeholder:"Field...","onUpdate:modelValue":n=>d(o,"column",n),class:"col-span-2"},null,8,["options","model-value","onUpdate:modelValue"]),s("div",X,[s("button",{onClick:n=>O(o),class:"p-1 text-gray-400 hover:text-red-500"},[c(V(W),{class:"w-4 h-4"})],8,Y)])]),s("div",Z,[c(v,{options:I(t.column),"model-value":t.operator||"==",placeholder:"Operator","onUpdate:modelValue":n=>d(o,"operator",n)},null,8,["options","model-value","onUpdate:modelValue"]),s("div",ee,[(p=i(t.column))!=null&&p.allowed_values?(r(),S(v,{key:0,options:(i(t.column).allowed_values||[]).map(n=>({value:n.value,label:n.label})),"model-value":t.value||null,placeholder:"Select value...","onUpdate:modelValue":n=>d(o,"value",n)},null,8,["options","model-value","onUpdate:modelValue"])):((C=i(t.column))==null?void 0:C.type)==="True/False"?(r(),m("select",{key:1,value:t.value??"true",onChange:n=>d(o,"value",n.target.value),class:"w-full border rounded px-2 py-2 text-sm"},l[4]||(l[4]=[s("option",{value:"true"},"True",-1),s("option",{value:"false"},"False",-1)]),40,le)):(r(),m("input",{key:2,type:((w=i(t.column))==null?void 0:w.type)==="Date"?"date":((k=i(t.column))==null?void 0:k.type)==="DateTime"?"datetime-local":"text",value:t.value,onInput:n=>d(o,"value",n.target.value),placeholder:"Value",class:"w-full border rounded px-2 py-2 text-sm"},null,40,te)),c(M,{"all-steps-before":f.allStepsBefore,"loop-context-schema":f.loopContextSchema,onInsert:n=>N(o,n)},null,8,["all-steps-before","loop-context-schema","onInsert"])])])])}),128))])])):A("",!0)])]),_:1},8,["onDelete"]))}};export{me as default};
