import{c as p,r as g,f as F,a as n,o as i,b as t,i as S,d as x,u,v as w,x as h,m as d,t as f,z as j,F as O,l as P,j as D,w as B,s as _,A as z,M as K}from"./app-DbT8OS6U.js";import{u as q}from"./workflowStore-DZJsW282.js";import{S as L}from"./SelectDropdown-CHW2wT9H.js";import{P as I}from"./plus-Cqbd8Y22.js";import{L as G}from"./loader-circle-CLMtcNOm.js";/* empty css                                                                       */import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./createLucideIcon-CcTmroC8.js";const H={class:"h-full flex flex-col"},J={class:"p-3 border-b border-gray-200 flex items-center justify-between"},Q={key:0,class:"p-3 border-b border-gray-200 bg-gray-50 space-y-3"},R={key:0,class:"flex items-center gap-2 mt-1"},X={key:1,class:"text-[11px] text-gray-500 mt-1"},Y={class:"font-mono"},Z={key:2,class:"mt-1"},ee={class:"flex items-center justify-between"},te={class:"flex items-center gap-2 text-xs text-gray-700"},se={class:"flex items-center gap-2"},oe={class:"flex-1 overflow-y-auto"},le={key:0,class:"p-4 text-sm text-gray-500 flex items-center gap-2"},ae={key:1},re=["onClick"],ne={class:"flex items-center justify-between gap-2"},ie={class:"text-sm flex items-center gap-2"},de={class:"text-xs text-gray-500"},ue={class:"flex items-center gap-2"},ce=["onClick"],ve=["onClick"],he={__name:"WorkflowList",setup(me){const l=q(),C=p(()=>l.workflows),M=o=>{l.fetchWorkflow(o.id)},c=g(!1),a=g({name:"",trigger_event:"",description:"",is_active:!0}),v=g(null),m=g("created"),T=g([{value:"created",label:"Created"},{value:"updated",label:"Updated"},{value:"deleted",label:"Deleted"}]),W=p(()=>{var o;return((o=l.automationSchema)==null?void 0:o.models)||[]});F(()=>{Object.keys(l.automationSchema).length||l.fetchAutomationSchema()});const k=p(()=>{const o=v.value?String(v.value).toLowerCase():"",e=m.value?String(m.value).toLowerCase():"";return o&&e?`${o}.${e}`:""}),y=p(()=>{var o;return(((o=W.value)==null?void 0:o.length)||0)===0}),A=p(()=>{const o=(a.value.name||"").trim().length>0,e=y.value?(a.value.trigger_event||"").trim():k.value;return o&&!!e}),$=()=>{a.value={name:"",trigger_event:"",description:"",is_active:!0},v.value=null,m.value=null},N=async()=>{var e,s;const o=y.value?(a.value.trigger_event||"").trim().toLowerCase():k.value;if(a.value.trigger_event=o,!A.value){l.showAlert("Missing information","Name and Trigger Event are required.");return}try{const r=await l.createWorkflow(a.value);r&&r.id&&(await l.fetchWorkflow(r.id),c.value=!1,$())}catch(r){console.error("Failed to create workflow:",r);const b=((s=(e=r==null?void 0:r.response)==null?void 0:e.data)==null?void 0:s.message)||"Could not create workflow.";l.showAlert("Create failed",b)}},U=async o=>{await l.toggleWorkflowActive(o)},E=async o=>{await K(`Delete workflow "${o.name}"?`,{confirmText:"Delete",cancelText:"Cancel"})&&await l.deleteWorkflow(o.id)};return(o,e)=>(i(),n("div",H,[t("div",J,[e[9]||(e[9]=t("h2",{class:"text-sm font-semibold text-gray-800"},"Workflows",-1)),t("button",{onClick:e[0]||(e[0]=s=>c.value=!c.value),class:"p-1.5 rounded-md text-gray-500 hover:bg-gray-100"},[x(u(I),{class:"w-4 h-4"})])]),c.value?(i(),n("div",Q,[t("div",null,[e[10]||(e[10]=t("label",{class:"text-xs font-medium text-gray-600"},"Name",-1)),w(t("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>a.value.name=s),type:"text",class:"mt-1 w-full border rounded px-2 py-1 text-sm",placeholder:"e.g. New Lead Outreach"},null,512),[[h,a.value.name]])]),t("div",null,[e[13]||(e[13]=t("label",{class:"text-xs font-medium text-gray-600"},"When...",-1)),y.value?S("",!0):(i(),n("div",R,[x(L,{modelValue:v.value,"onUpdate:modelValue":e[2]||(e[2]=s=>v.value=s),options:W.value,valueKey:"name",labelKey:"name",placeholder:"Select a Model...",class:"w-1/2"},null,8,["modelValue","options"]),x(L,{modelValue:m.value,"onUpdate:modelValue":e[3]||(e[3]=s=>m.value=s),options:T.value,placeholder:"Select an Event...",class:"w-1/2"},null,8,["modelValue","options"])])),y.value?(i(),n("div",Z,[w(t("input",{"onUpdate:modelValue":e[4]||(e[4]=s=>a.value.trigger_event=s),type:"text",class:"w-full border rounded px-2 py-1 text-sm",placeholder:"e.g., user.created"},null,512),[[h,a.value.trigger_event]]),e[12]||(e[12]=t("p",{class:"text-[11px] text-amber-700 mt-1"},[d("Models list is empty. Type the trigger event manually (e.g., "),t("span",{class:"font-mono"},"user.updated"),d("). Ensure it matches the global event name.")],-1))])):(i(),n("p",X,[e[11]||(e[11]=d("This builds the trigger event for you. Preview: ",-1)),t("span",Y,f(k.value||"â€”"),1)]))]),t("div",null,[e[14]||(e[14]=t("label",{class:"text-xs font-medium text-gray-600"},"Description",-1)),w(t("textarea",{"onUpdate:modelValue":e[5]||(e[5]=s=>a.value.description=s),rows:"2",class:"mt-1 w-full border rounded px-2 py-1 text-sm"},null,512),[[h,a.value.description]])]),t("div",ee,[t("label",te,[w(t("input",{type:"checkbox","onUpdate:modelValue":e[6]||(e[6]=s=>a.value.is_active=s),class:"border rounded"},null,512),[[j,a.value.is_active]]),e[15]||(e[15]=d(" Active ",-1))]),t("div",se,[t("button",{onClick:N,class:"px-3 py-1 text-xs rounded-md bg-blue-600 text-white hover:bg-blue-700"},"Create"),t("button",{onClick:e[7]||(e[7]=s=>c.value=!1),class:"px-3 py-1 text-xs rounded-md border text-gray-600 hover:bg-gray-100"},"Cancel")])])])):S("",!0),t("div",oe,[u(l).isLoading&&C.value.length===0?(i(),n("div",le,[x(u(G),{class:"w-4 h-4 animate-spin"}),e[16]||(e[16]=d(" Loading Workflows... ",-1))])):(i(),n("ul",ae,[(i(!0),n(O,null,P(C.value,s=>{var r,b;return i(),n("li",{key:s.id,onClick:V=>M(s),class:D(["px-3 py-2 cursor-pointer border-b border-gray-100",{"bg-blue-50 text-blue-800 font-semibold":((r=u(l).activeWorkflow)==null?void 0:r.id)===s.id,"hover:bg-gray-50":((b=u(l).activeWorkflow)==null?void 0:b.id)!==s.id}])},[t("div",ne,[t("div",null,[t("p",ie,[d(f(s.name)+" ",1),t("span",{class:D(["text-[10px] px-1.5 py-0.5 rounded",s.is_active?"bg-green-100 text-green-700":"bg-gray-100 text-gray-700"])},f(s.is_active?"Active":"Inactive"),3)]),t("p",de,f(s.trigger_event),1)]),t("div",ue,[x(u(z),{onClick:e[8]||(e[8]=_(()=>{},["stop"])),href:o.route("schedules.create",{type:"workflow",id:s.id}),class:"text-xs px-2 py-1 rounded-md border text-gray-600 hover:bg-gray-100"},{default:B(()=>e[17]||(e[17]=[d("Schedule",-1)])),_:2,__:[17]},1032,["href"]),t("button",{onClick:_(V=>U(s),["stop"]),class:"text-xs px-2 py-1 rounded-md border text-gray-600 hover:bg-gray-100"},f(s.is_active?"Deactivate":"Activate"),9,ce),t("button",{onClick:_(V=>E(s),["stop"]),class:"text-xs px-2 py-1 rounded-md border text-red-600 hover:bg-red-50"},"Delete",8,ve)])])],10,re)}),128))]))])]))}};export{he as default};
