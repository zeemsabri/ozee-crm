import{a as r,o as n,b as e,r as _,c as w,e as pe,g as J,w as H,i as j,d as m,t as v,y as Qe,J as Y,C as Me,m as F,j as z,s as G,F as se,l as ne,v as We,x as _t,u as p,n as ht,k as Ce,D as wt,f as kt,h as Ct,K as Dt,L as $t,A as Mt,M as ve,N as jt}from"./app-DLjAqOLz.js";import{a as St,_ as At}from"./AuthenticatedLayout-BVUr15BD.js";import{S as ge}from"./SelectDropdown-By67b8hZ.js";import{_ as ce}from"./PrimaryButton-Cjq6h6xi.js";import{_ as Ze}from"./SecondaryButton-UcxkpF2R.js";import{c as X,d as Bt,f as te,a as Nt}from"./currency-C-EgAEbV.js";import{B as fe}from"./BaseFormModal-CiIBTfgV.js";import{_ as oe}from"./InputLabel-CrNYsmle.js";import{_ as ie}from"./TextInput-Bu9IgCoB.js";import{_ as le}from"./InputError-BRGOJlIi.js";import{_ as Pt}from"./Modal-Ba2dzumd.js";import{r as De,a as Tt}from"./PlusIcon-UJqqquvH.js";import{r as Lt}from"./MagnifyingGlassIcon-BvxIQBja.js";import{a as $e,r as Rt}from"./PlusCircleIcon-Bk-hxSNL.js";import{r as Xe,a as Vt,b as Ft}from"./XCircleIcon-CLcF8074.js";import{r as Ut}from"./TrashIcon-CMApugIZ.js";import"./index-Cj9RV2uE.js";import"./debounce-C-hnF4Z3.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./ApplicationLogo-1InKgam7.js";import"./DangerButton-Cs8nuPnh.js";import"./moment-BLMuvzoS.js";import"./NoticeboardModal-XfR3NgKv.js";/* empty css                                                                       */function It(D,I){return n(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m19.5 8.25-7.5 7.5-7.5-7.5"})])}function Et(D,I){return n(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M21 12a2.25 2.25 0 0 0-2.25-2.25H15a3 3 0 1 1-6 0H5.25A2.25 2.25 0 0 0 3 12m18 0v6a2.25 2.25 0 0 1-2.25 2.25H5.25A2.25 2.25 0 0 1 3 18v-6m18 0V9M3 12V9m18 0a2.25 2.25 0 0 0-2.25-2.25H5.25A2.25 2.25 0 0 0 3 9m18 0V6a2.25 2.25 0 0 0-2.25-2.25H5.25A2.25 2.25 0 0 0 3 6v3"})])}const qt={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ot={key:0,class:"text-xs text-gray-500 mt-1"},Kt={key:0},Ht={class:"md:col-span-2"},Je={__name:"MilestoneExpendableModal",props:{show:Boolean,title:String,milestone:Object,users:Object,currencyOptions:Array,isBudgetForm:{type:Boolean,default:!1},isUserSelectionRequired:{type:Boolean,default:!1},projectTotalBudget:Number,projectBudgetCurrency:String,milestoneStats:Object,availableForNewMilestones:{type:Number,default:0},budgetBaseCurrency:{type:String,default:"AUD"}},emits:["close","submitted"],setup(D,{emit:I}){const l=D,T=I,o=_({}),y=_(""),S=_("post"),$=_(""),A=_(""),x=_({}),P=w(()=>{var c;return((Array.isArray((c=l.users)==null?void 0:c.users)?l.users.users:l.users)||[]).map(d=>({value:d.id,label:d.name}))});pe(()=>l.show,a=>{a&&l.milestone&&(x.value={},l.isBudgetForm?(o.value=l.milestone.budget?{...l.milestone.budget,amount:Number(l.milestone.budget.amount)}:{name:"Milestone Budget",description:"",amount:"",currency:"PKR"},y.value=l.milestone.budget?`/api/projects/${l.milestone.project_id}/expendables/${l.milestone.budget.id}`:`/api/projects/${l.milestone.project_id}/expendables`,S.value=l.milestone.budget?"put":"post",$.value=l.milestone.budget?"Update Budget":"Create Budget",A.value=l.milestone.budget?"Milestone budget updated successfully":"Milestone budget created successfully"):(o.value={name:"",description:"",amount:"",currency:"PKR",user_id:null},y.value=`/api/projects/${l.milestone.project_id}/expendables`,S.value="post",$.value="Create Contract",A.value="Contract created and sent for approval"))},{immediate:!0,deep:!0});const N=()=>{var d,R,k,g;x.value={};let a=!1;o.value.name||(x.value.name=["Name is required."],a=!0),(!o.value.amount||Number(o.value.amount)<=0)&&(x.value.amount=x.value.amount||[],x.value.amount.push("Amount must be a positive number."),a=!0),l.isUserSelectionRequired&&!o.value.user_id&&(x.value.user_id=["User selection is required for contracts."],a=!0);const c=X(Number(o.value.amount||0),o.value.currency,l.budgetBaseCurrency);if(l.isBudgetForm){const f=(d=l.milestone)!=null&&d.budget?X(Number(l.milestone.budget.amount||0),l.milestone.budget.currency,l.budgetBaseCurrency):0,q=Number(l.availableForNewMilestones||0)+((R=l.milestone)!=null&&R.budget?f:0);c>q+1e-8&&(x.value.amount=[`Amount exceeds allowed limit for milestone budget. Max allowed: ${X(q,l.budgetBaseCurrency,o.value.currency).toFixed(2)} ${o.value.currency}`],a=!0)}else X(Number(o.value.amount||0),o.value.currency,((k=l.milestone.budget)==null?void 0:k.currency)||"PKR")>Number(((g=l.milestoneStats)==null?void 0:g.remaining)||0)+1e-8&&(x.value.amount=["Cannot add a contract more than the remaining milestone budget."],a=!0);return!a},U=a=>({...a,amount:Number(a.amount||0),user_id:l.isBudgetForm?null:a.user_id,expendable_type:"Milestone",expendable_id:l.milestone.id}),L=a=>{T("submitted",a)},E=()=>{T("close")},b=w(()=>{var c,d;if(!l.isBudgetForm)return 0;const a=(c=l.milestone)!=null&&c.budget?X(Number(l.milestone.budget.amount||0),l.milestone.budget.currency,l.budgetBaseCurrency):0;return Number(l.availableForNewMilestones||0)+((d=l.milestone)!=null&&d.budget?a:0)}),K=w(()=>{var a;return X(Number(b.value||0),l.budgetBaseCurrency,((a=o.value)==null?void 0:a.currency)||"PKR")});return(a,c)=>(n(),J(fe,{show:D.show,title:D.title,"api-endpoint":y.value,"http-method":S.value,"form-data":o.value,"submit-button-text":$.value,"success-message":A.value,"format-data-for-api":U,"before-submit":N,onSubmitted:L,onClose:E},{default:H(({errors:d})=>{var R,k,g,f,q,u,B,M,V,ee;return[e("div",qt,[e("div",null,[m(oe,{for:"name",value:"Name"}),m(ie,{id:"name",modelValue:o.value.name,"onUpdate:modelValue":c[0]||(c[0]=Q=>o.value.name=Q),class:"mt-1 w-full",placeholder:"e.g., Asset Purchase"},null,8,["modelValue"]),m(le,{message:((R=x.value.name)==null?void 0:R[0])||((k=d.name)==null?void 0:k[0]),class:"mt-1"},null,8,["message"])]),e("div",null,[m(oe,{for:"amount",value:"Amount"}),m(ie,{id:"amount",type:"number",step:"0.01",modelValue:o.value.amount,"onUpdate:modelValue":c[1]||(c[1]=Q=>o.value.amount=Q),class:"mt-1 w-full",max:D.isBudgetForm?Number(K.value.toFixed?K.value.toFixed(2):K.value):null},null,8,["modelValue","max"]),m(le,{message:((g=x.value.amount)==null?void 0:g[0])||((f=d.amount)==null?void 0:f[0]),class:"mt-1"},null,8,["message"])]),e("div",null,[m(oe,{for:"currency",value:"Currency"}),m(ge,{id:"currency",modelValue:o.value.currency,"onUpdate:modelValue":c[2]||(c[2]=Q=>o.value.currency=Q),options:D.currencyOptions,"value-key":"value","label-key":"label",class:"mt-1 w-full"},null,8,["modelValue","options"]),m(le,{message:((q=x.value.currency)==null?void 0:q[0])||((u=d.currency)==null?void 0:u[0]),class:"mt-1"},null,8,["message"]),D.isBudgetForm?(n(),r("p",Ot,"Max allowed in selected currency: "+v(K.value.toFixed?K.value.toFixed(2):K.value)+" "+v(o.value.currency),1)):j("",!0)]),D.isBudgetForm?j("",!0):(n(),r("div",Kt,[m(oe,{for:"user",value:"User"}),m(ge,{id:"user",modelValue:o.value.user_id,"onUpdate:modelValue":c[3]||(c[3]=Q=>o.value.user_id=Q),options:P.value,"value-key":"value","label-key":"label",class:"mt-1 w-full",placeholder:"Select user"},null,8,["modelValue","options"]),m(le,{message:((B=x.value.user_id)==null?void 0:B[0])||((M=d.user_id)==null?void 0:M[0]),class:"mt-1"},null,8,["message"])])),e("div",Ht,[m(oe,{for:"description",value:"Description (optional)"}),m(ie,{id:"description",modelValue:o.value.description,"onUpdate:modelValue":c[4]||(c[4]=Q=>o.value.description=Q),class:"mt-1 w-full",placeholder:"Details"},null,8,["modelValue"]),m(le,{message:((V=x.value.description)==null?void 0:V[0])||((ee=d.description)==null?void 0:ee[0]),class:"mt-1"},null,8,["message"])])])]}),_:1},8,["show","title","api-endpoint","http-method","form-data","submit-button-text","success-message"]))}},Yt={class:"text-sm text-gray-600 mb-4"},zt={class:"mt-2"},Gt={__name:"ReasonModal",props:{show:{type:Boolean,default:!1},title:{type:String,default:"Reason Required"},message:{type:String,required:!0},type:{type:String,default:"info",validator:D=>["info","warning"].includes(D)},apiEndpoint:{type:String,required:!0},httpMethod:{type:String,required:!0}},emits:["submitted","close"],setup(D,{emit:I}){const l=D,T=I,o=_({reason:""}),y=_({}),S=()=>!o.value.reason||!o.value.reason.trim()?(Y("Reason is required."),y.value.reason=["Reason is required."],!1):(y.value={},!0),$=()=>{T("submitted")},A=()=>{T("close")};return pe(()=>l.show,x=>{x&&(o.value={reason:""},y.value={})}),(x,P)=>(n(),J(fe,{show:D.show,title:D.title,"api-endpoint":D.apiEndpoint,"http-method":D.httpMethod,"form-data":o.value,"submit-button-text":"Submit","success-message":"Operation successful!","before-submit":S,onClose:A,onSubmitted:$},{default:H(({errors:N})=>{var U,L;return[e("p",Yt,v(D.message),1),e("div",zt,[m(oe,{for:"reason-input",value:"Reason"}),m(ie,{id:"reason-input",modelValue:o.value.reason,"onUpdate:modelValue":P[0]||(P[0]=E=>o.value.reason=E),class:"mt-1 block w-full",onKeyup:Qe($,["enter"])},null,8,["modelValue"]),m(le,{message:((U=N.reason)==null?void 0:U[0])||((L=y.value.reason)==null?void 0:L[0]),class:"mt-1"},null,8,["message"])])]}),_:1},8,["show","title","api-endpoint","http-method","form-data"]))}},Xt={class:"space-y-4"},Jt={key:1,id:"final-task-list",class:"space-y-3"},Qt={class:"flex items-center justify-between"},Wt={class:"flex-1"},Zt=["onClick"],es={key:0,class:"mt-0.5 text-xs text-gray-600 truncate"},ts=["id","value","onBlur","onKeyup"],ss={class:"flex items-center space-x-2 ml-4"},os=["onClick"],ls=["onClick"],ns={key:0,class:"mt-4"},as=["onUpdate:modelValue"],is={class:"flex flex-col sm:flex-row sm:items-center space-y-2 sm:space-y-0 sm:space-x-4 text-xs text-gray-500 mt-2"},rs={class:"flex items-center space-x-2"},us=["onClick"],ds=["onClick"],cs=["value","onChange","min","max"],ps={class:"flex items-center space-x-2"},ms=["onClick"],vs=["onClick"],gs=["onClick"],fs={class:"flex justify-end space-x-3"},bs={__name:"BulkTaskModal",props:{show:{type:Boolean,default:!1},contractId:{type:Number,required:!0},completionDate:{type:String,required:!1,default:null}},emits:["close","tasks-submitted"],setup(D,{emit:I}){const l=D,T=I,o=Me([]),y=_(""),S=_({show:!1,text:"",type:"success"}),$=new Date,A=new Date($);A.setDate($.getDate()+1);const x=_("");pe(()=>l.show,g=>{g||(o.splice(0,o.length),y.value="",x.value="",S.value={show:!1,text:"",type:"success"})});const P=()=>{x.value&&x.value.trim()!==""&&(o.push({name:x.value,dueDate:"",priority:"Medium",contract_id:l.contractId,description:"",isEditingName:!1,showDescription:!1}),x.value="",S.value.show=!1)},N=g=>{o.splice(g,1)},U=(g,f)=>{o[g].priority=f},L=(g,f)=>{const q=new Date($.getFullYear(),$.getMonth(),$.getDate()),u=l.completionDate?new Date(l.completionDate):null,B=new Date(f);if(S.value.show=!1,u&&B>u){S.value={show:!0,text:"The selected due date is after the milestone completion date.",type:"error"},o[g].dueDate="";return}if(B<q){S.value={show:!0,text:"The selected due date cannot be in the past.",type:"error"},o[g].dueDate="";return}o[g].dueDate=f},E=g=>{o[g].showDescription=!o[g].showDescription},b=g=>{o[g].isEditingName=!0,ht(()=>{document.getElementById(`task-name-input-${g}`).focus()})},K=(g,f)=>{f.trim()&&(o[g].name=f),o[g].isEditingName=!1},a=g=>({tasks:g}),c=w(()=>o.length===0||o.some(g=>!g.name.trim()||!g.dueDate||!g.priority)),d=g=>{console.log("Submitting tasks to API:",o),S.value={show:!0,text:"Tasks submitted successfully!",type:"success"},setTimeout(()=>{S.value.show=!1,T("tasks-submitted"),g()},1500)},R=w(()=>o),k=g=>{const f=l.completionDate?new Date(l.completionDate):null,q=new Date($.getFullYear(),$.getMonth(),$.getDate()),u=new Date(g);return u>=q&&(!f||u<=f)};return(g,f)=>(n(),J(fe,{show:D.show,title:"Create Tasks in Bulk","api-endpoint":"/api/tasks/bulk","http-method":"post","form-data":R.value,"format-data-for-api":a,"submit-button-text":"Create Tasks",onClose:f[1]||(f[1]=q=>g.$emit("close")),onSubmitted:d},{default:H(({errors:q})=>[e("div",Xt,[S.value.show?(n(),r("div",{key:0,class:z(["mb-4 p-4 rounded-lg transition-all duration-300 ease-in-out",{"bg-green-100 text-green-700 border border-green-200":S.value.type==="success","bg-red-100 text-red-700 border border-red-200":S.value.type==="error"}])},v(S.value.text),3)):j("",!0),e("form",{onSubmit:G(P,["prevent"]),class:"relative"},[m(ie,{modelValue:x.value,"onUpdate:modelValue":f[0]||(f[0]=u=>x.value=u),id:"task-name-input",placeholder:"e.g., 'Finish project report'",class:"w-full p-4 pr-12 text-lg border border-gray-300 rounded-xl focus:ring-indigo-500 focus:border-indigo-500 shadow-sm transition-all duration-200 ease-in-out"},null,8,["modelValue"]),f[2]||(f[2]=e("button",{type:"submit",class:"absolute right-4 top-1/2 -translate-y-1/2 p-2 text-indigo-600 hover:text-indigo-800"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})])],-1))],32),f[8]||(f[8]=e("hr",{class:"my-6 border-gray-200"},null,-1)),o.length>0?(n(),r("div",Jt,[f[7]||(f[7]=e("h2",{class:"text-lg font-semibold text-gray-800"},"Tasks to Create:",-1)),(n(!0),r(se,null,ne(o,(u,B)=>(n(),r("div",{key:B,class:"flex flex-col p-4 bg-gray-50 rounded-xl border border-gray-200 group transition-all duration-200 ease-in-out"},[e("div",Qt,[e("div",Wt,[u.isEditingName?(n(),r("input",{key:1,id:`task-name-input-${B}`,type:"text",value:u.name,onBlur:M=>K(B,M.target.value),onKeyup:Qe(M=>K(B,M.target.value),["enter"]),class:"text-sm font-semibold text-gray-800 w-full rounded-md border-gray-300 focus:ring-indigo-500 focus:border-indigo-500 shadow-sm"},null,40,ts)):(n(),r(se,{key:0},[e("p",{onClick:M=>b(B),class:"text-sm font-semibold text-gray-800 truncate cursor-pointer hover:underline"},v(u.name),9,Zt),u.description&&u.description.trim().length?(n(),r("p",es,v(u.description),1)):j("",!0)],64))]),e("div",ss,[e("button",{type:"button",onClick:M=>E(B),class:z(["p-1 rounded-full transition-all duration-200 ease-in-out",[u.showDescription||u.description&&u.description.trim().length?"text-indigo-600 hover:text-indigo-700":"text-gray-400 hover:text-indigo-500"]]),title:"Add description"},f[3]||(f[3]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",class:"h-5 w-5"},[e("path",{d:"M19.5 14.25h-15m15-5.25h-15M9 19.5H4.5A1.5 1.5 0 013 18V6a1.5 1.5 0 011.5-1.5H15L21 9v9a1.5 1.5 0 01-1.5 1.5H15"})],-1)]),10,os),e("button",{type:"button",onClick:M=>N(B),class:"remove-final-task p-1 rounded-full text-red-500 opacity-0 group-hover:opacity-100 transition-all duration-200 ease-in-out"},f[4]||(f[4]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z","clip-rule":"evenodd"})],-1)]),8,ls)])]),u.showDescription?(n(),r("div",ns,[We(e("textarea",{"onUpdate:modelValue":M=>u.description=M,rows:"2",placeholder:"Add an optional description...",class:"w-full rounded-md border-gray-300 focus:ring-indigo-500 focus:border-indigo-500 shadow-sm text-sm"},null,8,as),[[_t,u.description]])])):j("",!0),e("div",is,[e("div",rs,[f[5]||(f[5]=e("span",{class:"font-medium"},"Due:",-1)),k(p($).toISOString().split("T")[0])?(n(),r("button",{key:0,type:"button",onClick:M=>L(B,p($).toISOString().split("T")[0]),class:z(["px-2 py-0.5 rounded-full text-indigo-600 bg-indigo-100 text-xs hover:bg-indigo-200",{"bg-indigo-300 font-semibold":u.dueDate===p($).toISOString().split("T")[0]}])},"Today",10,us)):j("",!0),k(p(A).toISOString().split("T")[0])?(n(),r("button",{key:1,type:"button",onClick:M=>L(B,p(A).toISOString().split("T")[0]),class:z(["px-2 py-0.5 rounded-full text-indigo-600 bg-indigo-100 text-xs hover:bg-indigo-200",{"bg-indigo-300 font-semibold":u.dueDate===p(A).toISOString().split("T")[0]}])},"Tomorrow",10,ds)):j("",!0),e("input",{type:"date",value:u.dueDate,onChange:M=>L(B,M.target.value),min:p($).toISOString().split("T")[0],max:D.completionDate,required:"",class:z([u.dueDate?"border-gray-300":"border-red-300","p-1 rounded-lg border text-xs focus:ring-indigo-500 focus:border-indigo-500 shadow-sm transition-all duration-200 ease-in-out"])},null,42,cs)]),e("div",ps,[f[6]||(f[6]=e("span",{class:"font-medium"},"Priority:",-1)),e("button",{type:"button",onClick:M=>U(B,"Low"),class:z(["px-2 py-0.5 rounded-full text-gray-500 bg-gray-100 text-xs hover:bg-gray-200",{"bg-gray-200 font-semibold":u.priority==="Low"}])},"Low",10,ms),e("button",{type:"button",onClick:M=>U(B,"Medium"),class:z(["px-2 py-0.5 rounded-full text-blue-600 bg-blue-100 text-xs hover:bg-blue-200",{"bg-blue-200 font-semibold":u.priority==="Medium"}])},"Medium",10,vs),e("button",{type:"button",onClick:M=>U(B,"High"),class:z(["px-2 py-0.5 rounded-full text-red-600 bg-red-100 text-xs hover:bg-red-200",{"bg-red-200 font-semibold":u.priority==="High"}])},"High",10,gs)])])]))),128))])):j("",!0)])]),footer:H(({close:q})=>[e("div",fs,[m(Ze,{onClick:q,type:"button"},{default:H(()=>f[9]||(f[9]=[F(" Cancel ",-1)])),_:2,__:[9]},1032,["onClick"]),m(ce,{type:"submit",disabled:c.value,class:z({"opacity-50 cursor-not-allowed":c.value})},{default:H(()=>f[10]||(f[10]=[F(" Create Tasks ",-1)])),_:1,__:[10]},8,["disabled","class"])])]),_:1},8,["show","form-data"]))}},xs={class:"space-y-3"},ys={__name:"MilestoneCompletionDateModal",props:{show:{type:Boolean,default:!1},milestoneId:{type:[Number,String],required:!0},initialCompletionDate:{type:String,default:null}},emits:["close","updated"],setup(D,{emit:I}){const l=D,T=I,o=Me({completion_date:l.initialCompletionDate||null}),y=Me({completion_date:null});pe(()=>l.show,P=>{P&&(o.completion_date=l.initialCompletionDate||null,y.completion_date=null)});const S=w(()=>`/api/milestones/${l.milestoneId}`),$=()=>(y.completion_date=null,o.completion_date?!0:(y.completion_date=["Completion date is required."],!1)),A=P=>{T("updated",P),T("close")},x=()=>T("close");return(P,N)=>(n(),J(fe,{show:D.show,title:"Set Milestone Completion Date","api-endpoint":S.value,"http-method":"put","form-data":o,"submit-button-text":"Save Date","success-message":"Milestone updated","before-submit":$,onClose:x,onSubmitted:A},{default:H(({errors:U})=>{var L,E;return[e("div",xs,[N[1]||(N[1]=e("p",{class:"text-sm text-gray-600"}," This milestone does not have a completion date. Please set it to continue creating tasks for its contracts. ",-1)),e("div",null,[m(oe,{for:"milestone-completion-date",value:"Completion Date"}),m(ie,{id:"milestone-completion-date",modelValue:o.completion_date,"onUpdate:modelValue":N[0]||(N[0]=b=>o.completion_date=b),type:"date",class:"mt-1 block w-full",required:""},null,8,["modelValue"]),m(le,{message:((L=U.completion_date)==null?void 0:L[0])||((E=y.completion_date)==null?void 0:E[0]),class:"mt-1"},null,8,["message"])])])]}),_:1},8,["show","api-endpoint","form-data"]))}},_s={class:"mt-8 p-6 md:p-8 bg-white rounded-2xl shadow-xl space-y-8 font-sans"},hs={class:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 border-b pb-4"},ws={class:"flex-1"},ks={class:"text-xl font-bold text-gray-900"},Cs={class:"text-sm text-gray-500 mt-1"},Ds={key:0},$s={class:"flex items-center gap-4 flex-shrink-0"},Ms={class:"relative w-28 h-28"},js={class:"w-full h-full transform -rotate-90"},Ss=["stroke-dashoffset"],As=["stroke-dashoffset"],Bs={class:"absolute inset-0 flex items-center justify-center"},Ns={class:"text-2xl font-bold text-gray-900"},Ps={class:"space-y-8 px-4"},Ts={class:"relative w-full h-2 rounded-full bg-gray-200"},Ls={class:"absolute -top-6 left-1/2 -translate-x-1/2 text-xs font-medium text-indigo-700 w-max"},Rs={class:"relative w-full h-4 mt-4 -top-8"},Vs={class:"w-2 h-2 rounded-full bg-gray-400 shadow-sm z-10 group relative"},Fs={key:0,class:"absolute -top-1 -right-1 w-3 h-3 text-xs bg-gray-500 text-white rounded-full flex items-center justify-center font-bold"},Us={class:"absolute top-full mt-2 w-max p-2 text-xs text-center text-white bg-gray-800 rounded-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none z-20"},Is={class:"font-bold border-b pb-1 mb-1"},Es={class:"absolute top-full mt-2 w-max min-w-[70px]"},qs={class:"text-gray-500 text-xs truncate"},Os={__name:"ProjectProgressTimeline",props:{milestones:{type:Array,default:()=>[]},showTicks:{type:Boolean,default:!0},title:{type:String,default:"Project Progress & Timeline"},progressLabel:{type:String,default:"Project Progress"},timelineLabel:{type:String,default:"Timeline"}},setup(D){const I=D,l=w(()=>(I.milestones||[]).filter(a=>!!(a!=null&&a.completion_date))),T=w(()=>[...l.value].sort((a,c)=>{const d=new Date(a.completion_date),R=new Date(c.completion_date);return d-R})),o=w(()=>(I.milestones||[]).length),y=w(()=>(I.milestones||[]).filter(a=>((a==null?void 0:a.status)||"").toLowerCase()==="completed")),S=w(()=>(I.milestones||[]).filter(a=>((a==null?void 0:a.status)||"").toLowerCase()==="approved")),$=w(()=>y.value.length+S.value.length);w(()=>o.value?Math.round(y.value.length/o.value*100):0);const A=w(()=>o.value?Math.round(S.value.length/o.value*100):0),x=w(()=>o.value?Math.round($.value/o.value*100):0),P=w(()=>T.value.length?new Date(T.value[0].completion_date):null),N=w(()=>T.value.length?new Date(T.value[T.value.length-1].completion_date):null),U=w(()=>{if(!P.value||!N.value)return 0;const a=f=>new Date(f.getFullYear(),f.getMonth(),f.getDate(),12,0,0),c=a(P.value),d=a(N.value),R=a(new Date),k=d-c;if(k<=0)return 100;let g=(R-c)/k*100;return g<0&&(g=0),g>100&&(g=100),Math.round(g)}),L=a=>{const c=new Date,R=new Date(a)-c,k=Math.ceil(R/(1e3*60*60*24));return k===0?"Due Today":k>0?`${k} day${k===1?"":"s"} left`:`${Math.abs(k)} day${Math.abs(k)===1?"":"s"} overdue`},E=a=>{if(!P.value||!N.value)return 0;const c=new Date(P.value),d=new Date(N.value),R=new Date(a),k=d-c;return k<=0?100:(R-c)/k*100},b=w(()=>{const a={};return T.value.forEach(c=>{const d=new Date(c.completion_date).toLocaleDateString();a[d]||(a[d]={date:c.completion_date,milestones:[]}),a[d].milestones.push(c)}),Object.values(a)}),K=a=>{const c=Math.max(2,Math.min(98,a)),d=a<5?"0%":a>95?"-100%":"-50%";return{left:`${c}%`,transform:`translateX(${d})`}};return(a,c)=>(n(),r("div",_s,[e("header",hs,[e("div",ws,[e("h2",ks,v(D.title),1),e("p",Cs,[F(v($.value)+" of "+v(o.value)+" milestones completed. ",1),P.value&&N.value?(n(),r("span",Ds," Project timeline: "+v(new Date(P.value).toLocaleDateString())+" — "+v(new Date(N.value).toLocaleDateString())+". ",1)):j("",!0)])]),e("div",$s,[e("div",Ms,[(n(),r("svg",js,[c[0]||(c[0]=e("circle",{class:"text-gray-200","stroke-width":"8",stroke:"currentColor",fill:"transparent",r:"44",cx:"56",cy:"56"},null,-1)),e("circle",{class:"text-indigo-500","stroke-width":"8","stroke-dasharray":276.46,"stroke-dashoffset":276.46-276.46*x.value/100,"stroke-linecap":"round",stroke:"currentColor",fill:"transparent",r:"44",cx:"56",cy:"56",style:{transition:"stroke-dashoffset 0.5s ease-in-out"}},null,8,Ss),c[1]||(c[1]=e("circle",{class:"text-gray-300","stroke-width":"8",stroke:"currentColor",fill:"transparent",r:"32",cx:"56",cy:"56"},null,-1)),e("circle",{class:"text-green-500","stroke-width":"8","stroke-dasharray":201.06,"stroke-dashoffset":201.06-201.06*A.value/100,"stroke-linecap":"round",stroke:"currentColor",fill:"transparent",r:"32",cx:"56",cy:"56",style:{transition:"stroke-dashoffset 0.5s ease-in-out"}},null,8,As)])),e("div",Bs,[e("span",Ns,v(x.value)+"%",1)])])])]),e("div",Ps,[e("div",Ts,[e("div",{class:"h-full bg-indigo-500 rounded-full",style:Ce({width:U.value+"%"})},null,4),P.value&&N.value?(n(),r("div",{key:0,class:"absolute top-1/2 -translate-y-1/2",style:Ce({left:`calc(${U.value}% - 8px)`})},[e("div",Ls," Today: "+v(new Date().toLocaleDateString()),1),c[2]||(c[2]=e("div",{class:"w-4 h-4 rounded-full bg-indigo-700 border-2 border-white shadow-md transform scale-125 transition-transform duration-200",title:"Today"},null,-1))],4)):j("",!0)]),e("div",Rs,[(n(!0),r(se,null,ne(b.value,(d,R)=>(n(),r("div",{key:R,class:"absolute top-0 flex flex-col items-center text-center",style:Ce(K(E(d.date)))},[e("div",Vs,[d.milestones.length>1?(n(),r("div",Fs,v(d.milestones.length),1)):j("",!0),e("div",Us,[e("p",Is,v(new Date(d.date).toLocaleDateString()),1),(n(!0),r(se,null,ne(d.milestones,k=>(n(),r("p",{key:k.id,class:"text-left text-gray-300"}," - "+v(k.name),1))),128))])]),e("div",Es,[e("p",qs,v(new Date(d.date).toLocaleDateString()),1),e("p",{class:z(["text-xs font-medium truncate",{"text-red-500":L(d.date).includes("overdue"),"text-gray-600":!L(d.date).includes("overdue")}])},v(L(d.date)),3)])],4))),128))])])]))}},Ks={class:"flex flex-col md:flex-row items-start md:items-center justify-between gap-4"},Hs={class:"flex items-center gap-3 w-full md:w-auto"},Ys={class:"flex-grow md:flex-grow-0 w-full md:w-64"},zs={class:"w-24 md:w-32 flex-shrink-0"},Gs={class:"py-8"},Xs={class:"max-w-7xl mx-auto sm:px-6 lg:px-8 space-y-6"},Js={key:0},Qs={class:"bg-white rounded-xl p-6 shadow-sm"},Ws={class:"grid grid-cols-1 md:grid-cols-3 gap-6"},Zs={class:"bg-indigo-50 rounded-lg p-5 shadow-sm flex flex-col justify-between"},eo={class:"text-3xl font-bold text-indigo-900"},to={class:"bg-purple-50 rounded-lg p-5 shadow-sm flex flex-col justify-between"},so={class:"text-3xl font-bold text-purple-900"},oo={class:"bg-green-50 rounded-lg p-5 shadow-sm flex flex-col justify-between"},lo={class:"text-3xl font-bold text-green-900"},no={class:"bg-yellow-50 rounded-lg p-5 shadow-sm flex flex-col justify-between"},ao={class:"text-3xl font-bold text-yellow-900"},io={class:"bg-blue-50 rounded-lg p-5 shadow-sm flex flex-col justify-between"},ro={class:"text-3xl font-bold text-blue-900"},uo={class:"bg-teal-50 rounded-lg p-5 shadow-sm flex flex-col justify-between"},co={class:"text-3xl font-bold text-teal-900"},po={class:"bg-white rounded-xl shadow-sm p-6"},mo={class:"flex flex-col sm:flex-row items-start sm:items-center justify-between border-b pb-4 mb-4"},vo={class:"flex items-center gap-2"},go={class:"flex space-x-2 mt-2 sm:mt-0"},fo=["onClick"],bo={key:0,class:"text-center text-gray-500 py-12"},xo={key:1},yo={key:0,class:"text-center text-gray-500 py-12"},_o={key:1,class:"text-center text-gray-500 py-12"},ho={key:2,class:"space-y-4"},wo=["onClick"],ko={class:"flex-grow"},Co={class:"font-bold text-lg text-gray-900 mb-1"},Do={key:0,class:"text-sm text-gray-600"},$o={class:"mt-1 text-xs text-gray-500 flex items-center gap-2"},Mo={key:0},jo={class:"font-medium text-gray-700"},So={key:1},Ao={class:"flex items-center gap-4 text-sm text-gray-700"},Bo={class:"hidden sm:flex items-center gap-4"},No={class:"inline-flex items-center gap-1 text-gray-600"},Po={class:"font-semibold text-gray-800"},To={class:"inline-flex items-center gap-1 text-gray-600"},Lo={class:"font-semibold text-green-700"},Ro={class:"inline-flex items-center gap-1 text-gray-600"},Vo={class:"font-semibold text-blue-700"},Fo=["onClick"],Uo={class:"flex items-center gap-2"},Io=["onClick"],Eo=["onClick"],qo={class:"border-t border-gray-200 p-5 bg-white rounded-b-xl"},Oo={class:"mb-5"},Ko={class:"flex flex-wrap gap-2 text-xs"},Ho={class:"inline-flex items-center gap-1 px-2 py-1 rounded-full bg-gray-100 text-gray-700"},Yo={class:"font-semibold"},zo={class:"inline-flex items-center gap-1 px-2 py-1 rounded-full bg-slate-100 text-slate-700"},Go={class:"font-semibold"},Xo={class:"inline-flex items-center gap-1 px-2 py-1 rounded-full bg-blue-100 text-blue-700"},Jo={class:"font-semibold"},Qo={class:"inline-flex items-center gap-1 px-2 py-1 rounded-full bg-yellow-100 text-yellow-700"},Wo={class:"font-semibold"},Zo={class:"inline-flex items-center gap-1 px-2 py-1 rounded-full bg-orange-100 text-orange-700"},el={class:"font-semibold"},tl={class:"inline-flex items-center gap-1 px-2 py-1 rounded-full bg-green-100 text-green-700"},sl={class:"font-semibold"},ol={class:"inline-flex items-center gap-1 px-2 py-1 rounded-full bg-red-100 text-red-700"},ll={class:"font-semibold"},nl={class:"flex justify-between items-center mb-4"},al={class:"flex items-center gap-2"},il={key:0,class:"text-center text-gray-500 text-sm py-4"},rl={key:1,class:"space-y-2"},ul={class:"flex items-center gap-2"},dl={key:0,class:"text-gray-600 text-xs sm:text-sm"},cl={class:"font-medium"},pl={class:"flex items-center gap-4 mt-2 sm:mt-0"},ml={class:"text-right"},vl={class:"font-semibold"},gl={key:0,class:"text-gray-500 block text-xs"},fl={class:"flex gap-1.5"},bl=["onClick"],xl=["onClick"],yl=["onClick"],_l=["onClick"],hl={class:"mt-6 pt-4 border-t border-gray-200 flex flex-col items-start gap-2"},wl={class:"flex flex-wrap items-center gap-3"},kl={key:0,class:"text-sm text-red-600"},Cl={class:"p-6 bg-white rounded-lg shadow-xl"},Dl={class:"flex items-center justify-between mb-4"},$l={key:0,class:"text-gray-500 text-center py-4"},Ml={key:1},jl={key:0,class:"text-gray-500 text-center py-4"},Sl={key:1,class:"space-y-3 max-h-96 overflow-y-auto pr-2"},Al={class:"text-sm text-gray-600 flex justify-between items-center mb-1"},Bl={class:"font-medium"},Nl={class:"text-xs text-gray-400"},Pl={class:"mt-1 text-gray-800 text-sm whitespace-pre-line"},ln={__name:"Index",setup(D){const I=_([]),l=_(null),T=_(!1),o=_("active"),y=_([]),S=_(!1),$=_(!1),A=_(!1),x=_(!1),P=_(!1),N=_([]),U=_(!1),L=_(!1),E=_(null),b=_(null),K=_(!1),a=_(null),c=_(null),d=_(null),R=[{value:"PKR",label:"PKR"},{value:"AUD",label:"AUD"},{value:"INR",label:"INR"},{value:"USD",label:"USD"},{value:"EUR",label:"EUR"},{value:"GBP",label:"GBP"}],{canDo:k}=wt();k("manage_project_financial");const g=k("approve_milestone_expendables"),f=k("approve_expendables"),q=k("approve_milestones");k("view_monthly_budgets");const u=Bt,B=_(null),M=_("PKR"),V=_({total_budget:0,total_assigned_milestone_amount:0,total_pending_contract_amount:0,total_approved_contract_amount:0,total_expendable_amount:0,available_for_new_milestones:0,currency:"AUD"}),ee=_([]),Q=[{id:"active",label:"Active Milestones"},{id:"completed",label:"Completed"},{id:"approved",label:"Approved"}],et=w(()=>(y.value||[]).filter(s=>!!s.completion_date)),re=w(()=>[...et.value].sort((s,t)=>{const C=new Date(s.completion_date),O=new Date(t.completion_date);return C-O})),je=w(()=>(y.value||[]).length),tt=w(()=>(y.value||[]).filter(s=>{const t=(s.status||"").toLowerCase();return t==="completed"||t==="approved"}).length);w(()=>je.value?Math.round(tt.value/je.value*100):0);const Se=w(()=>re.value.length?new Date(re.value[0].completion_date):null),Ae=w(()=>re.value.length?new Date(re.value[re.value.length-1].completion_date):null);w(()=>{if(!Se.value||!Ae.value)return 0;const s=ae=>new Date(ae.getFullYear(),ae.getMonth(),ae.getDate(),12,0,0),t=s(Se.value),C=s(Ae.value),O=s(new Date),W=C-t;if(W<=0)return 100;let Z=(O-t)/W*100;return Z<0&&(Z=0),Z>100&&(Z=100),Math.round(Z)});const Be=w(()=>y.value?o.value==="active"?y.value.filter(s=>s.status.toLowerCase()==="in progress"||s.status.toLowerCase()==="not started"||s.status.toLowerCase()==="pending"):o.value==="completed"?y.value.filter(s=>s.status.toLowerCase()==="completed"):o.value==="approved"?y.value.filter(s=>s.status.toLowerCase()==="approved"):y.value:[]),st=w(()=>{const s=Number(V.value.total_approved_contract_amount||0);return X(s,V.value.currency||M.value||"AUD",u.value)}),ot=w(()=>{const s=Number(V.value.total_pending_contract_amount||0);return X(s,V.value.currency||M.value||"AUD",u.value)});w(()=>{const s=Number(V.value.available_for_new_milestones??V.value.total_expendable_amount??0),t=X(s,V.value.currency||M.value||"AUD",u.value);return te(t,u.value)});const me=s=>{const t=Number(s||0),C=X(t,V.value.currency||M.value||"AUD",u.value);return te(C,u.value)};w(()=>{var t;return((Array.isArray((t=ee.value)==null?void 0:t.users)?ee.value.users:ee.value)||[]).map(C=>({value:C.id,label:C.name}))});const ue=s=>{if(!s)return{};const t=s.budget?X(Number(s.budget.amount||0),s.budget.currency,u.value):0,C=(s.expendable||[]).filter(O=>O.status==="Accepted").reduce((O,W)=>O+X(Number(W.amount||0),W.currency,u.value),0);return{budgetAmt:t,approvedAmt:C,remaining:t-C}},Ne=s=>s?s.budget!==null:null,lt=(s,t)=>{if(!(!s||!t)){if(!s.completion_date){a.value=s,c.value=t.id,K.value=!0;return}b.value=s,E.value=t.id,L.value=!0}},nt=s=>{try{if(s&&s.id){const C=(y.value||[]).findIndex(O=>O.id===s.id);C!==-1&&(y.value[C]={...y.value[C],...s})}}catch(C){console.error("Failed to merge updated milestone",C)}const t=(y.value||[]).find(C=>{var O;return C.id===((s==null?void 0:s.id)||((O=a.value)==null?void 0:O.id))});b.value=t||s||a.value,E.value=c.value,K.value=!1,L.value=!0,a.value=null,c.value=null},at=async()=>{try{const{data:s}=await window.axios.get("/api/projects-simplified");I.value=(s||[]).map(t=>({value:t.id,label:t.name}))}catch(s){console.error(s),Y("Failed to load projects")}},de=async()=>{if(l.value){T.value=!0;try{const{data:s}=await window.axios.get(`/api/projects/${l.value}/milestones-with-expendables`);y.value=(s||[]).map(t=>({...t,_collapsed:!0}))}catch(s){console.error(s),Y("Failed to load milestones")}finally{T.value=!1}}},it=async s=>{if(!s||!s.id){Y("Invalid milestone selected.");return}b.value=s,P.value=!0,x.value=!0;try{const{data:t}=await window.axios.get(`/api/milestones/${s.id}/reasons`);N.value=Array.isArray(t)?t:[]}catch(t){console.error(t),Y("Failed to load reasons")}finally{P.value=!1}},rt=async()=>{if(l.value)try{const{data:s}=await window.axios.get(`/api/projects/${l.value}/sections/users?type=users`);ee.value=s||[]}catch(s){console.error(s),Y("Failed to load users")}},be=async()=>{if(l.value)try{const{data:s}=await window.axios.get(`/api/projects/${l.value}/expendable-budget`);V.value={total_budget:Number(s.total_budget||0),total_assigned_milestone_amount:Number(s.total_assigned_milestone_amount||0),total_pending_contract_amount:Number(s.total_pending_contract_amount||0),total_approved_contract_amount:Number(s.total_approved_contract_amount||0),total_expendable_amount:Number(s.total_expendable_amount||0),available_for_new_milestones:Number(s.available_for_new_milestones||0),currency:s.currency||"AUD"},B.value=Number(s.total_expendable_amount||0),M.value=s.currency||"AUD"}catch(s){console.error(s)}},xe=async()=>{if(!l.value){y.value=[],B.value=0,M.value="PKR",V.value={total_budget:0,total_assigned_milestone_amount:0,total_pending_contract_amount:0,total_approved_contract_amount:0,total_expendable_amount:0,available_for_new_milestones:0,currency:"AUD"};return}await Promise.all([de(),rt(),be()])},ye=async()=>{jt("Operation successful!"),A.value=!1,b.value=null,d.value=null,l.value?await Promise.all([de(),be()]):await de()},ut=s=>{if(!s||!s.id){Y("Invalid milestone selected.");return}b.value=s,S.value=!0},dt=s=>{if(!s||!s.id){Y("Invalid milestone selected.");return}b.value=s,$.value=!0},ct=()=>{A.value=!1,b.value=null,d.value=null},pt=async s=>{if(!s||!s.id){Y("Invalid milestone.");return}await ve("Mark this milestone as complete?")&&(b.value={...s,action:"complete",apiEndpoint:`/api/milestones/${s.id}/complete`,httpMethod:"post"},A.value=!0)},mt=async s=>{if(!s||!s.id){Y("Invalid milestone.");return}await ve("Approve this completed milestone?")&&(b.value={...s,action:"approve",apiEndpoint:`/api/milestones/${s.id}/approve`,httpMethod:"post"},A.value=!0)},vt=async s=>{if(!s||!s.id){Y("Invalid milestone.");return}await ve("Reject this completed milestone?")&&(b.value={...s,action:"reject",apiEndpoint:`/api/milestones/${s.id}/reject`,httpMethod:"post"},A.value=!0)},gt=async s=>{if(!s||!s.id){Y("Invalid contract.");return}d.value={...s,action:"accept",apiEndpoint:`/api/projects/${l.value}/expendables/${s.id}/accept`,httpMethod:"post"},A.value=!0},ft=async s=>{if(!s||!s.id){Y("Invalid contract.");return}d.value={...s,action:"reject",apiEndpoint:`/api/projects/${l.value}/expendables/${s.id}/reject`,httpMethod:"post"},A.value=!0},bt=async s=>{if(!s||!s.id){Y("Invalid contract.");return}d.value={...s,action:"delete",apiEndpoint:`/api/projects/${l.value}/expendables/${s.id}`,httpMethod:"delete"},A.value=!0},xt=async s=>{if(!s||!s.id){Y("Invalid milestone.");return}await ve("Reopen this milestone to move it back to active?")&&(b.value={...s,action:"reopen",apiEndpoint:`/api/milestones/${s.id}/reopen`,httpMethod:"post"},A.value=!0)},Pe=s=>{s._collapsed=!s._collapsed},_e=s=>!s||!Array.isArray(s.expendable)?!1:s.expendable.some(t=>((t==null?void 0:t.status)||"Pending Approval")==="Pending Approval"),he=s=>!!(s&&Array.isArray(s.expendable)&&s.expendable.length>0),we=s=>{try{if(!s)return null;const t=new Date(s),C=new Date,O=new Date(t.getFullYear(),t.getMonth(),t.getDate(),12,0,0),W=new Date(C.getFullYear(),C.getMonth(),C.getDate(),12,0,0),Z=1440*60*1e3;return Math.round((O-W)/Z)}catch{return null}},yt=s=>{const t=we(s);return t===null?"":t<0?`Overdue by ${Math.abs(t)} day${Math.abs(t)===1?"":"s"}`:t===0?"Due today":`${t} day${t===1?"":"s"} remaining`};return kt(async()=>{const s=localStorage.getItem("displayCurrency");s&&(u.value=s),await Nt(),await at(),l.value&&await xe()}),pe(u,async s=>{s&&(localStorage.setItem("displayCurrency",s),l.value&&await Promise.all([be(),de()]))}),(s,t)=>(n(),J(At,null,{header:H(()=>[e("div",Ks,[t[13]||(t[13]=e("h2",{class:"font-semibold text-2xl text-gray-800"},"Project Financials",-1)),e("div",Hs,[e("button",{onClick:xe,class:"p-2 rounded-full text-gray-500 hover:bg-gray-100 transition-colors",title:"Refresh"},[m(p($e),{class:"h-5 w-5"})]),e("div",Ys,[m(ge,{id:"project-select",modelValue:l.value,"onUpdate:modelValue":[t[0]||(t[0]=C=>l.value=C),xe],options:I.value,placeholder:"Select a project"},null,8,["modelValue","options"])]),e("div",zs,[m(ge,{id:"expendables-display-currency",modelValue:p(u),"onUpdate:modelValue":t[1]||(t[1]=C=>$t(u)?u.value=C:null),options:R,placeholder:"Currency"},null,8,["modelValue"])]),m(p(Mt),{href:s.route("admin.pm-payout-calculator.index"),class:"inline-flex items-center px-3 py-1 border border-transparent text-xs leading-4 font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:border-indigo-700 focus:ring active:bg-indigo-700 transition ease-in-out duration-150"},{default:H(()=>t[12]||(t[12]=[F(" Payout Calculator ",-1)])),_:1,__:[12]},8,["href"])])])]),default:H(()=>{var C,O,W,Z,ae,Te,Le,Re,Ve,Fe,Ue,Ie,Ee,qe,Oe,Ke,He,Ye;return[m(p(Ct),{title:"Project Financials Dashboard"}),e("div",Gs,[e("div",Xs,[l.value?(n(),r("section",Js,[e("div",Qs,[t[26]||(t[26]=e("h3",{class:"text-xl font-semibold text-gray-900 mb-4"},"Financial Summary",-1)),e("div",Ws,[e("div",Zs,[e("div",null,[t[14]||(t[14]=e("div",{class:"text-sm font-medium text-indigo-700 mb-1"},"Total Project Budget",-1)),e("div",eo,v(me(V.value.total_budget)),1)]),t[15]||(t[15]=e("p",{class:"text-xs text-indigo-600 mt-2"},"Overall budget allocated to the project.",-1))]),e("div",to,[e("div",null,[t[16]||(t[16]=e("div",{class:"text-sm font-medium text-purple-700 mb-1"},"Assigned to Milestones",-1)),e("div",so,v(me(V.value.total_assigned_milestone_amount)),1)]),t[17]||(t[17]=e("p",{class:"text-xs text-purple-600 mt-2"},"Amount already assigned to milestones.",-1))]),e("div",oo,[e("div",null,[t[18]||(t[18]=e("div",{class:"text-sm font-medium text-green-700 mb-1"},"Approved Contracts",-1)),e("div",lo,v(p(te)(st.value,p(u))),1)]),t[19]||(t[19]=e("p",{class:"text-xs text-green-600 mt-2"},"Total value of all accepted contracts.",-1))]),e("div",no,[e("div",null,[t[20]||(t[20]=e("div",{class:"text-sm font-medium text-yellow-700 mb-1"},"Pending Approval",-1)),e("div",ao,v(p(te)(ot.value,p(u))),1)]),t[21]||(t[21]=e("p",{class:"text-xs text-yellow-600 mt-2"},"Contracts awaiting review and approval.",-1))]),e("div",io,[e("div",null,[t[22]||(t[22]=e("div",{class:"text-sm font-medium text-blue-700 mb-1"},"Expendable Remaining",-1)),e("div",ro,v(me(V.value.total_expendable_amount)),1)]),t[23]||(t[23]=e("p",{class:"text-xs text-blue-600 mt-2"},"Remaining after approved contracts.",-1))]),e("div",uo,[e("div",null,[t[24]||(t[24]=e("div",{class:"text-sm font-medium text-teal-700 mb-1"},"Available for New Milestones",-1)),e("div",co,v(me(V.value.available_for_new_milestones)),1)]),t[25]||(t[25]=e("p",{class:"text-xs text-teal-600 mt-2"},"Budget still available to allocate to new milestones.",-1))])]),m(Os,{milestones:y.value},null,8,["milestones"])])])):j("",!0),e("section",po,[e("div",mo,[e("div",vo,[t[27]||(t[27]=e("h3",{class:"text-xl font-semibold text-gray-900"},"Project Milestones",-1)),l.value?(n(),r("button",{key:0,onClick:t[2]||(t[2]=i=>U.value=!0),class:"p-1.5 rounded-full text-white bg-indigo-600 hover:bg-indigo-700 disabled:opacity-50",title:"Add Milestone"},[m(p(De),{class:"h-4 w-4"})])):j("",!0)]),e("div",go,[(n(),r(se,null,ne(Q,i=>e("button",{key:i.id,onClick:h=>o.value=i.id,class:z(["py-2 px-4 rounded-full text-sm font-medium transition",o.value===i.id?"bg-indigo-600 text-white shadow":"bg-gray-100 text-gray-700 hover:bg-gray-200"])},v(i.label),11,fo)),64))])]),l.value?(n(),r("div",xo,[T.value?(n(),r("div",yo,[m(p($e),{class:"animate-spin h-8 w-8 mx-auto mb-2 text-indigo-500"}),t[29]||(t[29]=e("p",null,"Loading milestones...",-1))])):Be.value.length?(n(),r("div",ho,[(n(!0),r(se,null,ne(Be.value,i=>(n(),r("div",{key:i.id,class:"border border-gray-200 rounded-xl bg-gray-50 shadow-sm transition-all duration-300 hover:shadow-lg"},[e("div",{class:"p-5 flex items-center justify-between cursor-pointer",onClick:h=>Pe(i)},[e("div",ko,[e("div",Co,v(i.name),1),i.description?(n(),r("div",Do,v(i.description),1)):j("",!0),e("div",$o,[i.completion_date?(n(),r("span",Mo,[t[31]||(t[31]=F(" Due by: ",-1)),e("span",jo,v(new Date(i.completion_date).toLocaleDateString()),1)])):(n(),r("span",So,"No completion date")),i.completion_date?(n(),r("span",{key:2,class:z([we(i.completion_date)<0?"text-red-600":we(i.completion_date)===0?"text-orange-600":"text-green-600"])}," • "+v(yt(i.completion_date)),3)):j("",!0)])]),e("div",Ao,[e("div",Bo,[e("span",No,[m(p(Et),{class:"h-4 w-4 text-gray-500"}),t[32]||(t[32]=F(" Budget: ",-1)),e("span",Po,v(p(te)(ue(i).budgetAmt,p(u))),1)]),e("span",To,[m(p(Xe),{class:"h-4 w-4 text-green-600"}),t[33]||(t[33]=F(" Approved: ",-1)),e("span",Lo,v(p(te)(ue(i).approvedAmt,p(u))),1)]),e("span",Ro,[m(p($e),{class:"h-4 w-4 text-blue-600"}),t[34]||(t[34]=F(" Remaining: ",-1)),e("span",Vo,v(p(te)(ue(i).remaining,p(u))),1)])]),o.value==="active"?(n(),r("button",{key:0,onClick:G(h=>dt(i),["stop"]),class:"p-2 rounded-full text-gray-500 hover:text-blue-500 hover:bg-gray-100 transition-colors"},[Ne(i)?(n(),J(p(Tt),{key:0,class:"h-5 w-5"})):(n(),J(p(Rt),{key:1,class:"h-5 w-5"}))],8,Fo)):j("",!0),e("div",Uo,[e("button",{onClick:G(h=>it(i),["stop"]),class:"p-2 rounded-full text-blue-600 hover:bg-blue-100 transition-colors",title:"View reasons"},[m(p(Vt),{class:"h-5 w-5"})],8,Io),e("button",{onClick:G(h=>Pe(i),["stop"]),class:"p-2 transition-transform duration-300"},[m(p(It),{class:z(["h-6 w-6 text-gray-500",i._collapsed?"":"rotate-180"])},null,8,["class"])],8,Eo)])])],8,wo),We(e("div",qo,[e("div",Oo,[t[42]||(t[42]=e("h5",{class:"text-sm font-semibold text-gray-800 mb-2"},"Task Stats",-1)),e("div",Ko,[e("span",Ho,[t[35]||(t[35]=F(" Total ",-1)),e("span",Yo,v(i.tasks_total_count||0),1)]),e("span",zo,[t[36]||(t[36]=F(" To Do ",-1)),e("span",Go,v(i.tasks_todo_count||0),1)]),e("span",Xo,[t[37]||(t[37]=F(" In Progress ",-1)),e("span",Jo,v(i.tasks_in_progress_count||0),1)]),e("span",Qo,[t[38]||(t[38]=F(" Paused ",-1)),e("span",Wo,v(i.tasks_paused_count||0),1)]),e("span",Zo,[t[39]||(t[39]=F(" Blocked ",-1)),e("span",el,v(i.tasks_blocked_count||0),1)]),e("span",tl,[t[40]||(t[40]=F(" Done ",-1)),e("span",sl,v(i.tasks_done_count||0),1)]),e("span",ol,[t[41]||(t[41]=F(" Archived ",-1)),e("span",ll,v(i.tasks_archived_count||0),1)])])]),e("div",nl,[t[44]||(t[44]=e("h4",{class:"text-lg font-semibold text-gray-800"},"Contracts",-1)),e("div",al,[o.value==="active"?(n(),J(ce,{key:0,onClick:G(h=>ut(i),["stop"]),class:"flex items-center gap-1"},{default:H(()=>[m(p(De),{class:"h-4 w-4"}),t[43]||(t[43]=F(" Add Contract ",-1))]),_:2,__:[43]},1032,["onClick"])):j("",!0)])]),!i.expendable||!i.expendable.length?(n(),r("div",il,"No contracts found.")):(n(),r("ul",rl,[(n(!0),r(se,null,ne(i.expendable||[],h=>{var ze,Ge;return n(),r("li",{key:h.id,class:"flex flex-col sm:flex-row items-start sm:items-center justify-between text-sm gap-2 p-3 rounded-lg bg-gray-100 shadow-sm"},[e("div",ul,[e("span",{class:z(["inline-block text-xs px-2 py-0.5 rounded-full font-medium",{"bg-gray-200 text-gray-700":h.status==="Pending Approval","bg-green-200 text-green-700":h.status==="Accepted","bg-red-200 text-red-700":h.status==="Rejected"}])},v(h.status||"Pending Approval"),3),h.user&&h.user.name?(n(),r("span",dl,v(h.user.name),1)):j("",!0),e("span",cl,v(h.name),1)]),e("div",pl,[e("div",ml,[e("span",vl,v(p(te)(p(X)(parseFloat(h.amount??0),h.currency||p(u),p(u)),p(u))),1),h.currency&&((ze=h.currency)==null?void 0:ze.toUpperCase())!==((Ge=p(u))==null?void 0:Ge.toUpperCase())?(n(),r("span",gl," ("+v(p(te)(parseFloat(h.amount??0),h.currency))+") ",1)):j("",!0)]),e("div",fl,[h.status==="Accepted"?(n(),r("button",{key:0,onClick:G(ke=>lt(i,h),["stop"]),class:"p-1 rounded-full text-indigo-600 hover:bg-indigo-200 transition-colors",title:"Add tasks"},[m(p(De),{class:"h-5 w-5"})],8,bl)):j("",!0),h.status==="Pending Approval"&&o.value!=="approved"?(n(),r(se,{key:1},[p(g)||p(f)?(n(),r("button",{key:0,onClick:G(ke=>gt(h),["stop"]),class:"p-1 rounded-full text-green-600 hover:bg-green-200 transition-colors",title:"Approve"},[m(p(Xe),{class:"h-5 w-5"})],8,xl)):j("",!0),p(g)||p(f)?(n(),r("button",{key:1,onClick:G(ke=>ft(h),["stop"]),class:"p-1 rounded-full text-red-600 hover:bg-red-200 transition-colors",title:"Reject"},[m(p(Ft),{class:"h-5 w-5"})],8,yl)):j("",!0)],64)):j("",!0),h.status==="Rejected"&&o.value!=="approved"?(n(),r("button",{key:2,onClick:G(ke=>bt(h),["stop"]),class:"p-1 rounded-full text-red-600 hover:bg-red-200 transition-colors",title:"Delete"},[m(p(Ut),{class:"h-5 w-5"})],8,_l)):j("",!0)])])])}),128))])),e("div",hl,[e("div",wl,[i.status.toLowerCase()!=="completed"&&o.value==="active"?(n(),J(ce,{key:0,onClick:G(h=>pt(i),["stop"]),disabled:_e(i)&&he(i),title:_e(i)&&he(i)?"Approve or reject all contracts before completing the milestone.":""},{default:H(()=>t[45]||(t[45]=[F(" Mark Complete ",-1)])),_:2,__:[45]},1032,["onClick","disabled","title"])):i.status.toLowerCase()==="completed"&&o.value==="completed"&&p(q)?(n(),J(ce,{key:1,onClick:G(h=>mt(i),["stop"]),class:"bg-green-600 hover:bg-green-700"},{default:H(()=>t[46]||(t[46]=[F("Approve Milestone",-1)])),_:2,__:[46]},1032,["onClick"])):j("",!0),i.status.toLowerCase()==="completed"&&o.value==="completed"&&p(q)?(n(),J(ce,{key:2,onClick:G(h=>vt(i),["stop"]),class:"bg-red-600 hover:bg-red-700"},{default:H(()=>t[47]||(t[47]=[F("Reject Milestone",-1)])),_:2,__:[47]},1032,["onClick"])):i.status.toLowerCase()==="approved"&&o.value==="approved"&&p(q)?(n(),J(Ze,{key:3,onClick:G(h=>xt(i),["stop"])},{default:H(()=>t[48]||(t[48]=[F("Reopen Milestone",-1)])),_:2,__:[48]},1032,["onClick"])):j("",!0)]),i.status.toLowerCase()!=="completed"&&o.value==="active"&&_e(i)&&he(i)?(n(),r("p",kl," You have pending contracts. Approve or reject each contract before marking this milestone complete. ")):j("",!0)])],512),[[Dt,!i._collapsed]])]))),128))])):(n(),r("div",_o,t[30]||(t[30]=[e("p",null,"No milestones found for this project in the selected tab.",-1)])))])):(n(),r("div",bo,[m(p(Lt),{class:"h-12 w-12 mx-auto mb-2 text-gray-400"}),t[28]||(t[28]=e("p",{class:"text-lg"},"Please select a project to view its milestones.",-1))]))])])]),m(Je,{show:S.value,title:"Add New Contract",milestone:b.value,users:ee.value,"currency-options":R,"is-user-selection-required":!0,onClose:t[3]||(t[3]=i=>S.value=!1),onSubmitted:ye,"project-total-budget":B.value,"project-budget-currency":M.value,"milestone-stats":ue(b.value),"available-for-new-milestones":V.value.available_for_new_milestones,"budget-base-currency":V.value.currency},null,8,["show","milestone","users","project-total-budget","project-budget-currency","milestone-stats","available-for-new-milestones","budget-base-currency"]),m(Je,{show:$.value,title:Ne(b.value)?"Update Milestone Budget":"Add Milestone Budget",milestone:b.value,users:ee.value,"currency-options":R,"is-budget-form":!0,"is-user-selection-required":!1,onClose:t[4]||(t[4]=i=>$.value=!1),onSubmitted:ye,"project-total-budget":B.value,"project-budget-currency":M.value,"milestone-stats":ue(b.value),"available-for-new-milestones":V.value.available_for_new_milestones,"budget-base-currency":V.value.currency},null,8,["show","title","milestone","users","project-total-budget","project-budget-currency","milestone-stats","available-for-new-milestones","budget-base-currency"]),m(Gt,{show:A.value,title:((C=b.value)==null?void 0:C.action)==="approve"?"Approve Milestone":((O=b.value)==null?void 0:O.action)==="reject"?"Reject Milestone":((W=b.value)==null?void 0:W.action)==="reopen"?"Reopen Milestone":b.value?"Provide Milestone Review":((Z=d.value)==null?void 0:Z.action)==="accept"?"Approve Contract":((ae=d.value)==null?void 0:ae.action)==="reject"?"Reject Contract":"Delete Contract",message:((Te=b.value)==null?void 0:Te.action)==="approve"?"Please provide a reason for approving this milestone (required):":((Le=b.value)==null?void 0:Le.action)==="reject"?"Please provide a reason for rejecting this milestone (required):":((Re=b.value)==null?void 0:Re.action)==="reopen"?"Please provide a reason for reopening this milestone (required):":b.value?"Please provide a review explaining why this milestone is complete (required):":((Ve=d.value)==null?void 0:Ve.action)==="accept"?"Please provide a reason for approval (required):":((Fe=d.value)==null?void 0:Fe.action)==="reject"?"Please provide a reason for rejection (required):":"Provide a reason for deleting this rejected expendable (required):",type:((Ue=b.value)==null?void 0:Ue.action)==="reject"||((Ie=b.value)==null?void 0:Ie.action)==="reopen"?"warning":"info","api-endpoint":b.value?b.value.apiEndpoint:(Ee=d.value)==null?void 0:Ee.apiEndpoint,"http-method":b.value?b.value.httpMethod:(qe=d.value)==null?void 0:qe.httpMethod,onClose:ct,onSubmitted:ye},null,8,["show","title","message","type","api-endpoint","http-method"]),m(St,{show:U.value,"project-id":Number(l.value),onClose:t[5]||(t[5]=i=>U.value=!1),onSaved:t[6]||(t[6]=()=>{U.value=!1,de()}),"contract-id":E.value},null,8,["show","project-id","contract-id"]),m(Pt,{show:x.value,onClose:t[8]||(t[8]=()=>{x.value=!1,b.value=null,N.value=[]})},{default:H(()=>[e("div",Cl,[e("div",Dl,[t[50]||(t[50]=e("h3",{class:"text-lg font-semibold"},"Milestone Reasons",-1)),e("button",{class:"text-gray-500 hover:text-gray-700",onClick:t[7]||(t[7]=()=>{x.value=!1,b.value=null,N.value=[]})},t[49]||(t[49]=[e("svg",{class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),P.value?(n(),r("div",$l,"Loading...")):(n(),r("div",Ml,[N.value.length?(n(),r("ul",Sl,[(n(!0),r(se,null,ne(N.value,i=>(n(),r("li",{key:i.id,class:"p-4 rounded-lg bg-gray-50 shadow-sm border border-gray-200"},[e("div",Al,[e("span",Bl,v(i.creator_name||"Unknown"),1),e("span",Nl,v(new Date(i.created_at).toLocaleString()),1)]),e("div",Pl,v(i.content),1)]))),128))])):(n(),r("div",jl,"No reasons found."))]))])]),_:1},8,["show"]),m(bs,{show:L.value,"contract-id":Number(E.value),"completion-date":(Oe=b.value)!=null&&Oe.completion_date?String(b.value.completion_date).split("T")[0]:null,onClose:t[9]||(t[9]=()=>{L.value=!1,E.value=null}),onTasksSubmitted:t[10]||(t[10]=()=>{L.value=!1,E.value=null})},null,8,["show","contract-id","completion-date"]),m(ys,{show:K.value,"milestone-id":Number(((Ke=a.value)==null?void 0:Ke.id)||((He=b.value)==null?void 0:He.id)),"initial-completion-date":(Ye=a.value)!=null&&Ye.completion_date?String(a.value.completion_date).split("T")[0]:null,onClose:t[11]||(t[11]=()=>{K.value=!1,a.value=null}),onUpdated:nt},null,8,["show","milestone-id","initial-completion-date"])]}),_:1}))}};export{ln as default};
