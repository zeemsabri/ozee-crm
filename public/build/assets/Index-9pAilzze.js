import{B as G,_ as Q}from"./AuthenticatedLayout-BM_zJI8M.js";import{r as u,c as X,l as U,J as q,f as d,o as i,d as s,g as N,U as I,q as M,E as Z,F as L,i as O,n as ee,t as V,k as te,a as A,w as E,b as n,e as g,s as se,x as oe,u as le,m as ae,h as ne,p as D,R as ie,S as re}from"./app-CwLjNXT3.js";import{P as z}from"./PrimaryButton-Bn1p3q-j.js";import{D as H}from"./DangerButton-CBIP4jF7.js";import{_ as K}from"./SecondaryButton-C1H9a7MO.js";import{_ as de}from"./Modal-uBVvV53I.js";import{_ as P}from"./InputLabel-BSEjZJ95.js";import{_ as J}from"./TextInput-C-mFm0N_.js";import{_ as j}from"./InputError-BZ-n7H_N.js";import{_ as ue}from"./Checkbox-C0IliKwo.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./SelectDropdown-DGCykHln.js";import"./ApplicationLogo-B9jAedvC.js";import"./moment-BLMuvzoS.js";const ce={class:"relative w-full"},me=["id","value","onKeydown","rows","required"],pe={class:"max-h-60 overflow-y-auto"},fe=["onMousedown"],ge={class:"font-medium text-gray-900"},ve={class:"text-xs text-gray-500"},xe={key:0,class:"px-4 py-2 text-gray-500 text-sm"},W={__name:"CustomRichTextEditor",props:{id:String,modelValue:String,definitions:{type:Array,default:()=>[]},rows:{type:Number,default:8},required:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(c,{emit:B}){const r=c,T=B,a=u(null),m=u(!1),v=u(""),h=u(-1),w=u({top:"auto",left:"auto"}),x=X(()=>{if(!v.value)return r.definitions;const o=v.value.toLowerCase();return r.definitions.filter(e=>e.name.toLowerCase().includes(o))});U(()=>r.modelValue,()=>{m.value&&q(()=>C())});const _=o=>{T("update:modelValue",o.target.value);const e=o.target.selectionStart,t=o.target.value.substring(0,e),f=t.lastIndexOf("{{");if(f!==-1&&e-f>1){const b=t.substring(f+2);if(!b.includes("}")){v.value=b.trim(),m.value=!0,h.value=0,q(()=>C());return}}k()},p=()=>{if(m.value&&h.value!==-1)$(x.value[h.value].name);else{const o=a.value,e=o.selectionStart,t=o.selectionEnd,f=o.value.substring(0,e)+`
`+o.value.substring(t);T("update:modelValue",f),q(()=>{const b=e+1;o.setSelectionRange(b,b)})}},l=o=>{m.value&&S(o)},y=()=>{m.value&&k()},k=()=>{m.value=!1,v.value="",h.value=-1},$=o=>{const e=a.value,t=e.selectionStart,b=e.value.substring(0,t).lastIndexOf("{{"),R=e.value.substring(0,b)+`{{ ${o} }}`+e.value.substring(t);T("update:modelValue",R),q(()=>{const F=b+`{{ ${o} }}`.length;e.setSelectionRange(F,F),e.focus()}),k()},S=o=>{if(!x.value.length)return;let e=h.value+o;e<0?e=x.value.length-1:e>=x.value.length&&(e=0),h.value=e},C=()=>{const o=a.value,e=o.selectionStart,f=o.value.substring(0,e).split(`
`),b=f.length-1,R=f[b].length,F=parseFloat(window.getComputedStyle(o).lineHeight),Y=parseFloat(window.getComputedStyle(o).fontSize)*.6;w.value.top=`${o.offsetTop+(b+1)*F}px`,w.value.left=`${o.offsetLeft+R*Y}px`};return(o,e)=>(i(),d("div",ce,[s("textarea",{id:c.id,ref_key:"textareaRef",ref:a,value:c.modelValue,onInput:_,onKeydown:[I(M(p,["prevent"]),["enter"]),e[0]||(e[0]=I(M(t=>l(-1),["prevent"]),["up"])),e[1]||(e[1]=I(M(t=>l(1),["prevent"]),["down"])),I(M(y,["prevent"]),["escape"])],onBlur:k,class:"block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",rows:c.rows,required:c.required},null,40,me),m.value?(i(),d("div",{key:0,class:"absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg",style:Z({top:w.value.top,left:w.value.left})},[s("ul",pe,[(i(!0),d(L,null,O(x.value,(t,f)=>(i(),d("li",{key:t.name,onMousedown:M(b=>$(t.name),["prevent"]),class:ee(["cursor-pointer px-4 py-2 hover:bg-indigo-50",{"bg-indigo-100":h.value===f}])},[s("span",ge,V(t.name),1),s("p",ve,V(t.description),1)],42,fe))),128)),x.value.length?N("",!0):(i(),d("li",xe," No placeholders found. "))])],4)):N("",!0)]))}},ye={class:"flex"},he={class:"flex-1 pr-6"},we={class:"mb-4"},be={class:"mb-4"},_e={class:"mb-4"},ke={class:"mb-4"},$e={class:"mb-4"},Ce={class:"mb-4"},Ee={class:"flex items-center"},Te={class:"w-64 border-l border-gray-200 pl-6 space-y-4"},Se={class:"flex items-center justify-between"},Ve={key:0,class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},Be={key:1,class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},De={key:0,class:"space-y-2"},je={class:"max-h-96 overflow-y-auto pr-2"},Me=["onClick"],Pe={class:"font-medium text-gray-900"},Ne={class:"text-xs text-gray-500"},Fe={__name:"CreateEditTemplateModal",props:{show:{type:Boolean,default:!1},isEditing:{type:Boolean,default:!1},template:{type:Object,default:null},placeholderDefinitions:{type:Array,required:!0,default:()=>[]}},emits:["close","submitted"],setup(c,{emit:B}){const r=c,T=B,a=te({name:"",slug:"",subject:"",body_html:"",description:"",is_default:!1});u(null),u(null);const m=u(null),v=u(!0),h=()=>{T("close")},w=()=>{a.reset(),T("submitted")};U(()=>r.show,p=>{p&&r.isEditing&&r.template?(a.name=r.template.name,a.slug=r.template.slug,a.subject=r.template.subject,a.body_html=r.template.body_html,a.description=r.template.description,a.is_default=r.template.is_default):p&&!r.isEditing&&a.reset()}),U(()=>r.isEditing,p=>{p||a.reset()});const x=p=>{if(!m.value){console.error("No active editor selected to insert placeholder.");return}const l=m.value.$el,y=l.selectionStart,k=l.selectionEnd,$=l.value,S=$.substring(0,y)+p+$.substring(k);m.value.id==="subject"?a.subject=S:m.value.id==="body_html"&&(a.body_html=S),nextTick(()=>{const C=y+p.length;l.setSelectionRange(C,C),l.focus()})},_=p=>{m.value=p};return(p,l)=>(i(),A(G,{show:c.show,title:c.isEditing?"Edit Email Template":"Create New Email Template","api-endpoint":c.isEditing?`/api/email-templates/${c.template.id}`:"/api/email-templates","http-method":c.isEditing?"put":"post","form-data":g(a).data(),"submit-button-text":c.isEditing?"Update Template":"Save Template","success-message":"Email template saved successfully!",onClose:h,onSubmitted:w},{default:E(({errors:y})=>{var k,$,S,C,o,e;return[s("div",ye,[s("div",he,[s("div",we,[n(P,{for:"name",value:"Template Name"}),n(J,{id:"name",modelValue:g(a).name,"onUpdate:modelValue":l[0]||(l[0]=t=>g(a).name=t),type:"text",class:"mt-1 block w-full",required:"",autofocus:""},null,8,["modelValue"]),n(j,{class:"mt-2",message:(k=y.name)==null?void 0:k[0]},null,8,["message"])]),s("div",be,[n(P,{for:"slug",value:"Template Slug"}),n(J,{id:"slug",modelValue:g(a).slug,"onUpdate:modelValue":l[1]||(l[1]=t=>g(a).slug=t),type:"text",class:"mt-1 block w-full",required:""},null,8,["modelValue"]),n(j,{class:"mt-2",message:($=y.slug)==null?void 0:$[0]},null,8,["message"])]),s("div",_e,[n(P,{for:"subject",value:"Subject Line"}),n(W,{id:"subject",modelValue:g(a).subject,"onUpdate:modelValue":l[2]||(l[2]=t=>g(a).subject=t),definitions:c.placeholderDefinitions,rows:2,required:"",onFocus:l[3]||(l[3]=t=>_(t))},null,8,["modelValue","definitions"]),n(j,{class:"mt-2",message:(S=y.subject)==null?void 0:S[0]},null,8,["message"])]),s("div",ke,[n(P,{for:"body_html",value:"Email Body (HTML)"}),n(W,{id:"body_html",modelValue:g(a).body_html,"onUpdate:modelValue":l[4]||(l[4]=t=>g(a).body_html=t),definitions:c.placeholderDefinitions,rows:10,required:"",onFocus:l[5]||(l[5]=t=>_(t))},null,8,["modelValue","definitions"]),n(j,{class:"mt-2",message:(C=y.body_html)==null?void 0:C[0]},null,8,["message"])]),s("div",$e,[n(P,{for:"description",value:"Description"}),se(s("textarea",{id:"description","onUpdate:modelValue":l[6]||(l[6]=t=>g(a).description=t),class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-lg shadow-sm mt-1 block w-full"},null,512),[[oe,g(a).description]]),n(j,{class:"mt-2",message:(o=y.description)==null?void 0:o[0]},null,8,["message"])]),s("div",Ce,[s("label",Ee,[n(ue,{name:"is_default",checked:g(a).is_default,"onUpdate:checked":l[7]||(l[7]=t=>g(a).is_default=t)},null,8,["checked"]),l[9]||(l[9]=s("span",{class:"ml-2 text-sm text-gray-600"},"Is a system default template?",-1))]),n(j,{class:"mt-2",message:(e=y.is_default)==null?void 0:e[0]},null,8,["message"])])]),s("div",Te,[s("div",Se,[l[12]||(l[12]=s("h4",{class:"text-sm font-semibold text-gray-900"},"Placeholders",-1)),s("button",{onClick:l[8]||(l[8]=t=>v.value=!v.value),type:"button",class:"text-gray-400 hover:text-gray-600 focus:outline-none"},[v.value?(i(),d("svg",Ve,l[10]||(l[10]=[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"},null,-1)]))):(i(),d("svg",Be,l[11]||(l[11]=[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"},null,-1)])))])]),v.value?(i(),d("div",De,[l[13]||(l[13]=s("p",{class:"text-xs text-gray-500"},"Click to insert into the active editor.",-1)),s("div",je,[(i(!0),d(L,null,O(c.placeholderDefinitions,t=>(i(),d("button",{key:t.id,onClick:M(f=>x(`{{ ${t.name} }}`),["prevent"]),type:"button",class:"w-full text-left p-2 border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-colors duration-150 text-sm mb-2"},[s("span",Pe,V(t.name),1),s("p",Ne,V(t.description),1)],8,Me))),128))])])):N("",!0)])])]}),_:1},8,["show","title","api-endpoint","http-method","form-data","submit-button-text"]))}},qe={class:"py-12"},Ie={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},Le={class:"bg-white overflow-hidden shadow-xl sm:rounded-lg p-6"},Re={class:"flex justify-between items-center mb-6"},Ue={key:0,class:"text-center text-gray-500 py-8"},Ae={key:1,class:"text-center text-red-500 py-8"},Oe={key:2,class:"overflow-x-auto rounded-lg border border-gray-200 shadow-sm mt-6"},ze={class:"min-w-full divide-y divide-gray-200"},He={class:"bg-white divide-y divide-gray-200"},Ke={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},Je={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},We={class:"px-6 py-4 text-sm text-gray-500"},Ye={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Ge={key:0,class:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800"},Qe={key:1,class:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800"},Xe={class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium"},Ze={class:"flex justify-end space-x-2"},et={key:3,class:"text-center text-gray-500 py-8"},tt={class:"p-6"},st={class:"mt-6 flex justify-end"},xt={__name:"Index",setup(c){const{canDo:B}=le(),r=u([]),T=u([]),a=u(!0),m=u(!0),v=u(""),h=u(!1),w=u(!1),x=u(!1),_=u(null),p=async()=>{a.value=!0,v.value="";try{const o=await window.axios.get("/api/email-templates");r.value=o.data}catch(o){v.value="Failed to load email templates.",console.error("Error fetching templates:",o)}finally{a.value=!1}},l=async()=>{m.value=!0;try{const o=await window.axios.get("/api/placeholder-definitions");T.value=o.data}catch(o){console.error("Error fetching placeholder definitions:",o)}finally{m.value=!1}},y=()=>{h.value=!1,_.value=null,w.value=!0},k=o=>{h.value=!0,_.value=o,w.value=!0},$=o=>{_.value=o,x.value=!0},S=()=>{w.value=!1,p()},C=async()=>{var o,e;try{await window.axios.delete(`/api/email-templates/${_.value.id}`),ie("Template deleted successfully!"),x.value=!1,await p()}catch(t){console.error("Error deleting template:",t);const f=((e=(o=t.response)==null?void 0:o.data)==null?void 0:e.message)||"Failed to delete template.";re(f)}};return ae(()=>{p(),l()}),(o,e)=>(i(),d(L,null,[n(g(ne),{title:"Email Templates"}),n(Q,null,{header:E(()=>e[3]||(e[3]=[s("h2",{class:"font-bold text-3xl text-gray-800 leading-tight"},"Email Templates",-1)])),default:E(()=>[s("div",qe,[s("div",Ie,[s("div",Le,[s("div",Re,[e[5]||(e[5]=s("h3",{class:"text-2xl font-semibold text-gray-900"},"Manage Email Templates",-1)),g(B)("manage_email_templates")?(i(),A(z,{key:0,onClick:y},{default:E(()=>e[4]||(e[4]=[D(" Create New Template ",-1)])),_:1,__:[4]})):N("",!0)]),a.value?(i(),d("div",Ue," Loading templates... ")):v.value?(i(),d("div",Ae,V(v.value),1)):r.value&&r.value.length?(i(),d("div",Oe,[s("table",ze,[e[8]||(e[8]=s("thead",{class:"bg-gray-50"},[s("tr",null,[s("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Name "),s("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Slug "),s("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Subject "),s("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Is Default "),s("th",{scope:"col",class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"}," Actions ")])],-1)),s("tbody",He,[(i(!0),d(L,null,O(r.value,t=>(i(),d("tr",{key:t.id},[s("td",Ke,V(t.name),1),s("td",Je,V(t.slug),1),s("td",We,V(t.subject),1),s("td",Ye,[t.is_default?(i(),d("span",Ge," Yes ")):(i(),d("span",Qe," No "))]),s("td",Xe,[s("div",Ze,[n(K,{onClick:f=>k(t)},{default:E(()=>e[6]||(e[6]=[D("Edit",-1)])),_:2,__:[6]},1032,["onClick"]),n(H,{onClick:f=>$(t)},{default:E(()=>e[7]||(e[7]=[D("Delete",-1)])),_:2,__:[7]},1032,["onClick"])])])]))),128))])])])):(i(),d("div",et,[e[10]||(e[10]=s("p",null,"No email templates found.",-1)),g(B)("manage_email_templates")?(i(),A(z,{key:0,onClick:y,class:"mt-4"},{default:E(()=>e[9]||(e[9]=[D(" Create First Template ",-1)])),_:1,__:[9]})):N("",!0)]))])])]),n(Fe,{show:w.value,"is-editing":h.value,template:_.value,"placeholder-definitions":T.value,onClose:e[0]||(e[0]=t=>w.value=!1),onSubmitted:S},null,8,["show","is-editing","template","placeholder-definitions"]),n(de,{show:x.value,onClose:e[2]||(e[2]=()=>x.value=!1)},{default:E(()=>{var t;return[s("div",tt,[e[13]||(e[13]=s("h3",{class:"text-xl font-semibold text-gray-900 mb-4"},"Delete Email Template",-1)),s("p",null,'Are you sure you want to delete the template "'+V((t=_.value)==null?void 0:t.name)+'"? This action cannot be undone.',1),s("div",st,[n(K,{onClick:e[1]||(e[1]=()=>x.value=!1)},{default:E(()=>e[11]||(e[11]=[D("Cancel",-1)])),_:1,__:[11]}),n(H,{class:"ml-3",onClick:C},{default:E(()=>e[12]||(e[12]=[D(" Delete ",-1)])),_:1,__:[12]})])])]}),_:1},8,["show"])]),_:1})],64))}};export{xt as default};
