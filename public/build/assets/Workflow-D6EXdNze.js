import $ from"./TriggerStep-B6fEFYsO.js";import H from"./ConditionStep-CbZyNZ6J.js";import U from"./ActionStep-GIvmUD3t.js";import L from"./AIStep-DoA74Ouj.js";import B from"./ForEachStep-DwK1Z1Uc.js";import P from"./FetchRecordsStep-ja0Qq_c9.js";import j from"./ScheduleTriggerStep-CrJoWwbf.js";import A from"./AddStepButton-3fWqRMN-.js";import{u as M}from"./workflowStore-DOdgr6Xd.js";import G from"./TransformStep-BtNxCJaa.js";import V from"./DefineVariableStep-tP0enOZe.js";import{l as W,C as q,c,o as i,F as _,a,e as g,i as K,q as Y,k as S,K as z}from"./app-BfaUIa5i.js";import"./StepCard-CRKF5M4T.js";import"./trash-CCSDpdeO.js";import"./createLucideIcon-D0ZpVBKJ.js";import"./SelectDropdown-M3AHc6lT.js";/* empty css                                                                       */import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./RelationshipPathPicker-eTtOy2pI.js";import"./plus-CRkvJOmu.js";import"./DataTokenInserter-D0wX6jAn.js";import"./RelatedDataPicker-BM43vXBH.js";import"./BaseFormModal-B0-uAlS4.js";import"./Modal-Dz0vzl9e.js";import"./PrimaryButton-DmkBadzw.js";import"./SecondaryButton-kMFm4gnl.js";import"./PromptForm-CQ_wth3a.js";import"./ResponseBuilder-8ssdpEp2.js";import"./FieldBuilder-DYC3tc9N.js";import"./chevron-down-B331Z9vW.js";import"./circle-x-Bqipi-jd.js";const J={class:"flex flex-col items-center w-full space-y-4"},Q={key:0,class:"text-center p-8 border-2 border-dashed rounded-lg w-full max-w-md"},X={class:"flex justify-center"},Z={class:"w-full flex flex-col items-center"},tt={key:1,class:"w-full flex mt-4 space-x-4"},et={class:"flex-1 bg-green-50/50 p-4 rounded-lg border border-green-200"},ot={class:"flex-1 bg-red-50/50 p-4 rounded-lg border border-red-200"},st={key:2,class:"w-full mt-4 p-4 rounded-lg border border-purple-300 bg-purple-50/50"},$t={__name:"Workflow",props:{steps:{type:Array,required:!0},fullContextSteps:{type:Array,default:()=>[]},loopContextSchema:{type:Object,default:null},allowTrigger:{type:Boolean,default:!0}},emits:["update:steps","add-trigger"],setup(n,{emit:R}){const N=M(),F=W(()=>N.automationSchema||[]),d=n,y=R,k={TRIGGER:$,SCHEDULE_TRIGGER:j,FETCH_RECORDS:P,CONDITION:H,ACTION:U,AI_PROMPT:L,FOR_EACH:B,TRANSFORM_CONTENT:G,DEFINE_VARIABLE:V},b=p=>k[p]||null;function D(p){var h,E,O,T,I;const t=(h=p.step_config)==null?void 0:h.sourceArray;if(!t)return null;const s=t.match(/{{step_(\w+)\.(.+)}}/);if(!s)return null;const o=s[1],r=s[2],e=d.fullContextSteps.find(l=>l.id==o),f=l=>{const m=String((l==null?void 0:l.type)||"").toLowerCase(),C=String((l==null?void 0:l.itemType)||"").toLowerCase();return m==="array of objects"||m==="array"&&C==="object"};if((e==null?void 0:e.step_type)==="AI_PROMPT"||(e==null?void 0:e.step_type)==="ACTION"&&((E=e==null?void 0:e.step_config)==null?void 0:E.action_type)==="FETCH_API_DATA"){const l=r.replace(/^parsed\./,""),m=(T=(O=e.step_config)==null?void 0:O.responseStructure)==null?void 0:T.find(C=>C.name===l);return f(m)?{name:"Loop Item",columns:m.schema||[]}:null}if((e==null?void 0:e.step_type)==="FETCH_RECORDS"&&r==="records"){const l=(I=e.step_config)==null?void 0:I.model;if(!l)return null;const m=F.value.find(u=>u.name===l);return m?{name:"Loop Item",columns:(m.columns||[]).map(u=>typeof u=="string"?{name:u}:u)}:null}return null}function x(p,t){const s=[...d.steps];s[p]=t,y("update:steps",s)}function w(p,t){const s={id:`temp_${Date.now()}`,step_type:t,name:`New ${t.replace("_"," ")} Step`,step_config:{}};if(t==="CONDITION"&&(s.if_true=[],s.if_false=[]),t==="FOR_EACH"&&(s.children=[]),t==="FETCH_RECORDS"){const e=d.steps.slice(0,p).slice().reverse().find(f=>f&&f.step_type==="FETCH_RECORDS"&&f.step_config&&f.step_config.model);e&&(s.step_config={model:e.step_config.model,conditions:[]})}const o=[...d.steps];o.splice(p,0,s),y("update:steps",o)}function v(p){const t=d.steps.filter((s,o)=>o!==p);y("update:steps",t)}return(p,t)=>{const s=q("Workflow",!0);return i(),c("div",J,[n.steps.length===0?(i(),c("div",Q,[n.allowTrigger?(i(),c(_,{key:0},[t[2]||(t[2]=a("h3",{class:"text-lg font-semibold text-gray-700"},"Start your Automation",-1)),t[3]||(t[3]=a("p",{class:"text-sm text-gray-500 mt-1 mb-4"},"Every workflow starts with a trigger. How should this one begin?",-1)),a("button",{onClick:t[0]||(t[0]=o=>p.$emit("add-trigger")),class:"px-4 py-2 text-sm font-semibold rounded-md bg-indigo-600 text-white hover:bg-indigo-700"}," Add Trigger ")],64)):(i(),c(_,{key:1},[t[4]||(t[4]=a("h3",{class:"text-lg font-semibold text-gray-700"},"Start this flow",-1)),t[5]||(t[5]=a("p",{class:"text-sm text-gray-500 mt-1 mb-4"},"Choose a step to add in this branch.",-1)),a("div",X,[g(A,{onSelect:t[1]||(t[1]=o=>w(0,o))})])],64))])):(i(!0),c(_,{key:1},K(n.steps,(o,r)=>(i(),c(_,{key:o.id},[a("div",Z,[b(o.step_type)?(i(),Y(z(b(o.step_type)),{key:0,step:o,"all-steps-before":[...n.fullContextSteps,...n.steps.slice(0,r)],"loop-context-schema":n.loopContextSchema,onDelete:!n.allowTrigger||r>0?()=>v(r):null,"onUpdate:step":e=>x(r,e)},null,40,["step","all-steps-before","loop-context-schema","onDelete","onUpdate:step"])):S("",!0),o.step_type==="CONDITION"?(i(),c("div",tt,[a("div",et,[t[6]||(t[6]=a("p",{class:"text-center font-bold text-green-700 mb-4"},"IF YES",-1)),g(s,{steps:o.if_true||[],"onUpdate:steps":e=>x(r,{...o,if_true:e}),"full-context-steps":[...n.fullContextSteps,...n.steps.slice(0,r+1)],"loop-context-schema":n.loopContextSchema,"allow-trigger":!1},null,8,["steps","onUpdate:steps","full-context-steps","loop-context-schema"])]),a("div",ot,[t[7]||(t[7]=a("p",{class:"text-center font-bold text-red-700 mb-4"},"IF NO",-1)),g(s,{steps:o.if_false||[],"onUpdate:steps":e=>x(r,{...o,if_false:e}),"full-context-steps":[...n.fullContextSteps,...n.steps.slice(0,r+1)],"loop-context-schema":n.loopContextSchema,"allow-trigger":!1},null,8,["steps","onUpdate:steps","full-context-steps","loop-context-schema"])])])):S("",!0),o.step_type==="FOR_EACH"?(i(),c("div",st,[t[8]||(t[8]=a("p",{class:"text-center font-bold text-purple-700 mb-4"},"DO THIS FOR EACH ITEM",-1)),g(s,{steps:o.children||[],"onUpdate:steps":e=>x(r,{...o,children:e}),"full-context-steps":[...n.fullContextSteps,...n.steps.slice(0,r+1)],"loop-context-schema":D(o),"allow-trigger":!1},null,8,["steps","onUpdate:steps","full-context-steps","loop-context-schema"])])):S("",!0)]),g(A,{onSelect:e=>w(r+1,e)},null,8,["onSelect"])],64))),128))])}}};export{$t as default};
