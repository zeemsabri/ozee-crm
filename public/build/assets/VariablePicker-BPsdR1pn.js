import{u as S}from"./workflowStore-B7plWg-6.js";import{C as V}from"./chevron-down-C-jot0eB.js";import{r as N,c as n,a as l,o as i,b as d,i as b,m as E,d as L,t as g,u as A,F as B,l as I}from"./app-CZiJFItQ.js";import"./createLucideIcon-77yR4NzK.js";const T={class:"relative inline-block text-left"},W={key:0,class:"absolute right-0 z-30 mt-1 w-72 max-h-64 overflow-auto bg-white border rounded-md shadow"},D={class:"text-sm divide-y"},M=["onClick"],F={key:0,class:"p-3 text-xs text-gray-500"},P={__name:"VariablePicker",props:{baseScope:{type:String,default:""},label:{type:String,default:"Insert variable"}},emits:["select"],setup(h,{emit:v}){const y=h,$=v,u=S(),c=N(!1),p=n(()=>{var o;const e=u.activeWorkflow;if(!e)return null;const s=Array.isArray(e.steps)?e.steps.find(r=>(r.step_type||"").toUpperCase()==="TRIGGER"):null;let t=((o=s==null?void 0:s.step_config)==null?void 0:o.trigger_event)||e.trigger_event||"";if(typeof t!="string")return null;const[a]=t.split(".");return a||null}),_=n(()=>{var e;return((e=u.automationSchema)==null?void 0:e.models)||[]}),x=n(()=>_.value.find(e=>String(e.name).toLowerCase()===String(p.value||"").toLowerCase()));function w(){const e=[],s=p.value?`trigger.${p.value}`:"trigger",t=x.value;return t&&((t.columns||[]).forEach(a=>{e.push({path:`${s}.${a}`,label:`${s}.${a}`})}),(t.relationships||[]).forEach(a=>{const o=`${s}.${a.name}`;(a.columns||[]).forEach(r=>{e.push({path:`${o}.${r}`,label:`${o}.${r}`})})})),e}function f(e,s=[]){if(!Array.isArray(e))return s;for(const t of e)t&&(s.push(t),t.step_type==="CONDITION"&&(f(t.yes_steps,s),f(t.no_steps,s)));return s}const k=n(()=>{const e=u.activeWorkflow;if(!e)return[];const s=f(e.steps||[]),t=[];return s.forEach(a=>{const o=a.id;if(!o)return;const r=`step_${o}`;t.push({path:`${r}.text`,label:`${r}.text`}),t.push({path:`${r}.count`,label:`${r}.count`}),t.push({path:`${r}.records`,label:`${r}.records`})}),t.push({path:"ai.last_output",label:"ai.last_output"}),t}),m=n(()=>{const e=(y.baseScope||"").toLowerCase(),s=[...w(),...k.value];return e?s.filter(t=>t.path.toLowerCase().startsWith(e)):s});function C(e){$("select",`{{ ${e} }}`),c.value=!1}return(e,s)=>(i(),l("div",T,[d("button",{type:"button",class:"inline-flex items-center gap-1 px-2 py-1 text-xs border rounded-md bg-white hover:bg-gray-50",onClick:s[0]||(s[0]=t=>c.value=!c.value)},[E(" { } "+g(h.label)+" ",1),L(A(V),{class:"w-3 h-3"})]),c.value?(i(),l("div",W,[s[1]||(s[1]=d("div",{class:"p-2 sticky top-0 bg-white border-b text-xs text-gray-500"},"Variables",-1)),d("ul",D,[(i(!0),l(B,null,I(m.value,t=>(i(),l("li",{key:t.path,class:"px-3 py-1 hover:bg-gray-50 cursor-pointer",onClick:a=>C(t.path)},g(t.label),9,M))),128))]),m.value.length===0?(i(),l("div",F,"No variables available.")):b("",!0)])):b("",!0)]))}};export{P as default};
