import{S as j,_ as Q}from"./AuthenticatedLayout-Bes_VhZ2.js";import{r as u,s as g,S as Y,B as R,ad as G,i,o as a,e as r,h as V,y as J,a as m,b as t,m as f,t as n,F as M,j as K,n as W,f as X,c as Z,l as U,g as A,O as ee}from"./app-Zv3ebzGJ.js";import{D as te}from"./DangerButton-BxWfA7B0.js";import{a as D,_ as se}from"./SecondaryButton-B57-gx7f.js";import{_ as k}from"./InputLabel-TUkV8NLc.js";import{_ as le}from"./InputError-CjL299TP.js";import"./ApplicationLogo-iCiZO1Mf.js";import"./PrimaryButton-DvmJCt9V.js";import"./Checkbox-B6Gp16gR.js";const oe={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between py-4"},ae={key:0},re={class:"py-6"},ie={class:"max-w-12xl mx-auto sm:px-6 lg:px-12"},ne={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg p-6"},de={key:0,class:"text-center py-4 text-gray-500 text-lg"},ue={key:1,class:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-md relative mb-4",role:"alert"},ce={class:"block sm:inline"},pe={key:2},me={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8"},ve={class:"bg-blue-50 p-6 rounded-lg shadow-sm border border-blue-200 flex items-center justify-between"},fe={class:"text-3xl font-bold text-blue-900 mt-1"},ge={class:"bg-green-50 p-6 rounded-lg shadow-sm border border-green-200 flex items-center justify-between"},xe={class:"text-3xl font-bold text-green-900 mt-1"},we={class:"bg-yellow-50 p-6 rounded-lg shadow-sm border border-yellow-200 flex items-center justify-between"},ye={class:"text-3xl font-bold text-yellow-900 mt-1"},be={class:"bg-purple-50 p-6 rounded-lg shadow-sm border border-purple-200 flex items-center justify-between"},he={class:"text-3xl font-bold text-purple-900 mt-1"},_e={class:"mb-8 p-4 bg-gray-50 rounded-lg shadow-inner border border-gray-200"},ke={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"},Ce={class:"mt-4 flex justify-end"},je={key:0,class:"p-6 bg-gray-50 rounded-lg text-gray-600 text-center border border-gray-200 shadow-sm"},Ve={key:1,class:"overflow-x-auto rounded-lg border border-gray-200 shadow-sm"},Ae={class:"min-w-full divide-y divide-gray-200"},Se={class:"bg-white divide-y divide-gray-200"},Pe={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},Be={class:"px-6 py-4 text-sm text-gray-600"},Me={key:0},Ue={key:1,class:"text-gray-400"},De={class:"px-6 py-4 whitespace-nowrap"},Ee={class:"px-6 py-4 text-sm text-gray-600"},Le={key:0},Ne={key:1,class:"text-gray-400"},ze={class:"px-6 py-4 whitespace-nowrap text-sm font-medium"},He={class:"flex items-center space-x-2"},$e={class:"p-6"},Fe={key:0,class:"mt-4 text-gray-800"},Oe={key:0},qe={key:1,class:"text-red-600 text-sm mb-4"},Te={class:"mt-6 flex justify-end"},et={__name:"Index",setup(Ie){const c=u([]),S=u(!0),d=u(""),x=u(""),w=u(""),y=u(""),b=u(""),h=u(""),E=u([{value:"",label:"All Statuses"},{value:"active",label:"Active"},{value:"completed",label:"Completed"},{value:"paid",label:"Paid"},{value:"on-hold",label:"On Hold"},{value:"archived",label:"Archived"}]),L=g(()=>{const s=new Map;return c.value.forEach(e=>{var o;(o=e.clients)==null||o.forEach(l=>{s.has(l.id)||s.set(l.id,{value:l.id,label:l.name})})}),[{value:"",label:"All Clients"},...Array.from(s.values())]}),N=g(()=>{const s=new Map;return c.value.forEach(e=>{var o;(o=e.users)==null||o.forEach(l=>{s.has(l.id)||s.set(l.id,{value:l.id,label:l.name})})}),[{value:"",label:"All Users"},...Array.from(s.values())]}),z=g(()=>{const s=new Set;return c.value.forEach(e=>{e.source&&!s.has(e.source)&&s.add(e.source)}),[{value:"",label:"All Sources"},...Array.from(s).map(e=>({value:e,label:e}))]}),C=u(!1),v=u(null),{canDo:P,canView:H}=Y(),$=P("create_projects"),F=g(()=>H("projects").value);P("manage_projects");const O=async()=>{S.value=!0,d.value="";try{const s=await window.axios.get("/api/projects");c.value=s.data}catch(s){d.value="Failed to load projects.",console.error("Error fetching initial data:",s),s.response&&(s.response.status===401||s.response.status===403)&&(d.value="You are not authorized to view this content or your session expired. Please log in.")}finally{S.value=!1}},B=g(()=>{let s=c.value;if(x.value){const e=x.value.toLowerCase();s=s.filter(o=>o.name.toLowerCase().includes(e)||o.description&&o.description.toLowerCase().includes(e)||o.status&&o.status.toLowerCase().includes(e.replace(/_|-/g," "))||o.clients&&o.clients.some(l=>l.name.toLowerCase().includes(e))||o.users&&o.users.some(l=>l.name.toLowerCase().includes(e))||o.source&&o.source.toLowerCase().includes(e))}return w.value&&(s=s.filter(e=>e.status===w.value)),y.value&&(s=s.filter(e=>e.clients&&e.clients.some(o=>o.id===y.value))),b.value&&(s=s.filter(e=>e.users&&e.users.some(o=>o.id===b.value))),h.value&&(s=s.filter(e=>e.source===h.value)),s}),_=g(()=>{const s={total:c.value.length,active:0,completed:0,onHold:0,paid:0,archived:0};return c.value.forEach(e=>{e.status==="active"&&s.active++,e.status==="completed"&&s.completed++,(e.status==="on-hold"||e.status==="on_hold")&&s.onHold++,e.status==="paid"&&s.paid++,e.status==="archived"&&s.archived++}),s}),q=s=>{switch(s){case"active":return"bg-green-100 text-green-800";case"completed":return"bg-blue-100 text-blue-800";case"paid":return"bg-purple-100 text-purple-800";case"on-hold":case"on_hold":return"bg-red-100 text-red-800";case"archived":return"bg-gray-100 text-gray-800";default:return"bg-gray-100 text-gray-800"}},T=async()=>{var e,o,l;d.value="";const s=(e=v.value)==null?void 0:e.id;if(!s){d.value="Invalid project.";return}if(!P("delete_projects").value){d.value="You do not have permission to delete this project.";return}try{await window.axios.delete(`/api/projects/${s}`),c.value=c.value.filter(p=>p.id!==s),C.value=!1,v.value=null,ee("Project deleted successfully!")}catch(p){d.value=((l=(o=p.response)==null?void 0:o.data)==null?void 0:l.message)||"Failed to delete project.",console.error("Error deleting project:",p)}},I=()=>{x.value="",w.value="",y.value="",b.value="",h.value=""};return R(()=>{if(!F.value){window.location.href=route("dashboard");return}O()}),(s,e)=>{const o=G("permission");return a(),i(M,null,[r(V(J),{title:"Projects"}),r(Q,null,{header:m(()=>[t("div",oe,[e[8]||(e[8]=t("h2",{class:"font-bold text-3xl text-gray-800 leading-tight mb-2 sm:mb-0"}," Project Management ",-1)),V($)?(a(),i("div",ae,[r(V(U),{href:s.route("projects.create"),class:"inline-flex items-center px-4 py-2 bg-indigo-600 border border-transparent rounded-md font-semibold text-xs text-white uppercase tracking-widest hover:bg-indigo-700 active:bg-indigo-900 focus:outline-none focus:border-indigo-900 focus:ring ring-indigo-300 disabled:opacity-25 transition ease-in-out duration-150 shadow-md"},{default:m(()=>e[7]||(e[7]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 4v16m8-8H4"})],-1),f(" Create New Project ",-1)])),_:1,__:[7]},8,["href"])])):A("",!0)])]),default:m(()=>[t("div",re,[t("div",ie,[t("div",ne,[S.value?(a(),i("div",de,e[9]||(e[9]=[t("svg",{class:"animate-spin h-8 w-8 text-indigo-500 mx-auto mb-3",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),f(" Loading projects and data... ",-1)]))):d.value?(a(),i("div",ue,[t("span",ce,n(d.value),1)])):(a(),i("div",pe,[t("div",me,[t("div",ve,[t("div",null,[e[10]||(e[10]=t("p",{class:"text-sm font-medium text-blue-700"},"Total Projects",-1)),t("p",fe,n(_.value.total),1)]),e[11]||(e[11]=t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-10 w-10 text-blue-400 opacity-70",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9 17V7m-4 10h8a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})],-1))]),t("div",ge,[t("div",null,[e[12]||(e[12]=t("p",{class:"text-sm font-medium text-green-700"},"Active Projects",-1)),t("p",xe,n(_.value.active),1)]),e[13]||(e[13]=t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-10 w-10 text-green-400 opacity-70",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M5 13l4 4L19 7"})],-1))]),t("div",we,[t("div",null,[e[14]||(e[14]=t("p",{class:"text-sm font-medium text-yellow-700"},"On-Hold Projects",-1)),t("p",ye,n(_.value.onHold),1)]),e[15]||(e[15]=t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-10 w-10 text-yellow-400 opacity-70",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1))]),t("div",be,[t("div",null,[e[16]||(e[16]=t("p",{class:"text-sm font-medium text-purple-700"},"Completed/Paid",-1)),t("p",he,n(_.value.completed+_.value.paid),1)]),e[17]||(e[17]=t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-10 w-10 text-purple-400 opacity-70",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1))])]),t("div",_e,[e[19]||(e[19]=t("h4",{class:"text-lg font-semibold text-gray-700 mb-4"},"Filter Projects",-1)),t("div",ke,[t("div",null,[r(k,{for:"search-query",value:"Search",class:"mb-1"}),r(le,{id:"search-query",type:"text",modelValue:x.value,"onUpdate:modelValue":e[0]||(e[0]=l=>x.value=l),placeholder:"Search by name, client, user...",class:"w-full"},null,8,["modelValue"])]),t("div",null,[r(k,{for:"filter-status",value:"Status",class:"mb-1"}),r(j,{id:"filter-status",modelValue:w.value,"onUpdate:modelValue":e[1]||(e[1]=l=>w.value=l),options:E.value,"value-key":"value","label-key":"label",placeholder:"All Statuses",class:"w-full"},null,8,["modelValue","options"])]),t("div",null,[r(k,{for:"filter-client",value:"Client",class:"mb-1"}),r(j,{id:"filter-client",modelValue:y.value,"onUpdate:modelValue":e[2]||(e[2]=l=>y.value=l),options:L.value,"value-key":"value","label-key":"label",placeholder:"All Clients",class:"w-full"},null,8,["modelValue","options"])]),t("div",null,[r(k,{for:"filter-user",value:"Assigned User",class:"mb-1"}),r(j,{id:"filter-user",modelValue:b.value,"onUpdate:modelValue":e[3]||(e[3]=l=>b.value=l),options:N.value,"value-key":"value","label-key":"label",placeholder:"All Users",class:"w-full"},null,8,["modelValue","options"])]),t("div",null,[r(k,{for:"filter-source",value:"Source",class:"mb-1"}),r(j,{id:"filter-source",modelValue:h.value,"onUpdate:modelValue":e[4]||(e[4]=l=>h.value=l),options:z.value,"value-key":"value","label-key":"label",placeholder:"All Sources",class:"w-full"},null,8,["modelValue","options"])])]),t("div",Ce,[r(D,{onClick:I,class:"px-4 py-2"},{default:m(()=>e[18]||(e[18]=[f("Clear Filters",-1)])),_:1,__:[18]})])]),B.value.length===0?(a(),i("div",je," No projects found matching your criteria. ")):(a(),i("div",Ve,[t("table",Ae,[e[21]||(e[21]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Project Name"),t("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Clients"),t("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Status"),t("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Assigned Users"),t("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Actions")])],-1)),t("tbody",Se,[(a(!0),i(M,null,K(B.value,l=>(a(),i("tr",{key:l.id},[t("td",Pe,n(l.name),1),t("td",Be,[l.clients&&l.clients.length?(a(),i("span",Me,n(l.clients.map(p=>p.name).join(", ")),1)):(a(),i("span",Ue,"None"))]),t("td",De,[t("span",{class:W(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full capitalize",q(l.status)])},n(l.status.replace("_"," ")),3)]),t("td",Ee,[l.users&&l.users.length?(a(),i("span",Le,n(l.users.map(p=>p.name).join(", ")),1)):(a(),i("span",Ne,"None"))]),t("td",ze,[t("div",He,[X((a(),Z(V(U),{href:s.route("projects.edit",l.id),class:"inline-flex items-center px-3 py-1 border border-transparent text-xs leading-4 font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:border-indigo-700 focus:ring active:bg-indigo-700 transition ease-in-out duration-150"},{default:m(()=>e[20]||(e[20]=[f("Edit",-1)])),_:2,__:[20]},1032,["href"])),[[o,"manage_projects"]])])])]))),128))])])]))]))])])]),r(se,{show:C.value,onClose:e[6]||(e[6]=l=>C.value=!1)},{default:m(()=>[t("div",$e,[e[25]||(e[25]=t("h2",{class:"text-lg font-medium text-gray-900"}," Are you sure you want to delete this project? ",-1)),e[26]||(e[26]=t("p",{class:"mt-1 text-sm text-gray-600"}," This action cannot be undone. All associated conversations and emails will also be deleted. ",-1)),v.value?(a(),i("div",Fe,[e[22]||(e[22]=t("strong",null,"Project:",-1)),f(" "+n(v.value.name)+" ",1),v.value.clients&&v.value.clients.length?(a(),i("span",Oe," (Clients: "+n(v.value.clients.map(l=>l.name).join(", "))+") ",1)):A("",!0)])):A("",!0),d.value?(a(),i("div",qe,n(d.value),1)):A("",!0),t("div",Te,[r(D,{onClick:e[5]||(e[5]=l=>C.value=!1)},{default:m(()=>e[23]||(e[23]=[f("Cancel",-1)])),_:1,__:[23]}),r(te,{class:"ms-3",onClick:T},{default:m(()=>e[24]||(e[24]=[f("Delete Project",-1)])),_:1,__:[24]})])])]),_:1},8,["show"])]),_:1})],64)}}};export{et as default};
