import{a as W,_ as Y}from"./AuthenticatedLayout-DTQRz_Bh.js";import{r as l,s as F,D as H,B as L,E as O,i as a,g as A,o,b as e,e as x,m,t as i,a as w,n as B,x as k,G as z,h as T,y as q,F as P,j as M,l as I}from"./app-C2zORGKA.js";import{_ as G}from"./NotesModal-Craheers.js";import{P as R}from"./PrimaryButton-Dgl94Es9.js";import"./ApplicationLogo-DalTS-0a.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./SecondaryButton-D-sb8oLe.js";import"./InputError-Br8DFn3G.js";import"./TextInput-D1Zqx-wu.js";const J={class:"flex"},K={class:"flex-shrink-0"},Q={key:0,class:"h-5 w-5 text-red-500",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},X={key:1,class:"h-5 w-5 text-indigo-500",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},Z={class:"ml-3 flex-1 md:flex md:justify-between"},ee={key:0,class:"text-sm text-indigo-700"},te={key:1,class:"text-sm text-green-700"},se={key:2,class:"text-sm text-red-700 font-medium"},ae={key:3,class:"text-sm text-green-700"},oe={class:"mt-3 text-sm md:mt-0 md:ml-6"},le={__name:"AvailabilityPrompt",setup(E){const c=l(!1),h=l(!0),p=l([]),v=l(!1),y=l(""),u=l(!1),n=l(!1),d=l(null),_=l(!1),b=F(()=>{var t;return((t=H().props.auth.user)==null?void 0:t.id)||null}),C=()=>{const t=localStorage.getItem("authToken");t&&!k.defaults.headers.common.Authorization&&(k.defaults.headers.common.Authorization=`Bearer ${t}`,console.log("Auth headers set in AvailabilityPrompt"))},g=async()=>{h.value=!0,y.value="";try{C();const t=await k.get("/api/availability-prompt");c.value=t.data.should_show_prompt,u.value=t.data.should_block_user,n.value=t.data.all_weekdays_covered,d.value=t.data.current_day,_.value=t.data.is_thursday_to_saturday,c.value&&S(t.data.next_week_start,t.data.next_week_end),localStorage.setItem("shouldBlockUser",u.value),localStorage.setItem("allWeekdaysCovered",n.value);const s=new CustomEvent("availability-status-updated",{detail:{shouldBlockUser:u.value,allWeekdaysCovered:n.value}});window.dispatchEvent(s)}catch(t){console.error("Error checking availability prompt:",t),c.value=!1,t.response&&t.response.status===401&&(t.value="Authentication error. Please refresh the page or log in again.")}finally{h.value=!1}},S=(t,s)=>{const $=[],U=new Date(t),V=new Date(s),f=new Date(U);for(;f<=V;)$.push({value:f.toISOString().split("T")[0],label:f.toLocaleDateString("en-US",{weekday:"long",month:"short",day:"numeric"})}),f.setDate(f.getDate()+1);p.value=$},j=()=>{v.value=!0},N=()=>{g()},D=()=>{document.visibilityState==="visible"&&z(()=>{g()})},r=t=>{(t.key==="shouldBlockUser"||t.key==="allWeekdaysCovered")&&z(()=>{g()})};return L(()=>{g(),document.addEventListener("visibilitychange",D),window.addEventListener("storage",r)}),O(()=>{document.removeEventListener("visibilitychange",D),window.removeEventListener("storage",r)}),(t,s)=>c.value&&!h.value?(o(),a("div",{key:0,class:B(["border-l-4 p-4 mb-6 rounded-md shadow-sm",u.value?"bg-red-50 border-red-500":"bg-indigo-50 border-indigo-500"])},[e("div",J,[e("div",K,[u.value?(o(),a("svg",Q,s[1]||(s[1]=[e("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"},null,-1)]))):(o(),a("svg",X,s[2]||(s[2]=[e("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z","clip-rule":"evenodd"},null,-1)])))]),e("div",Z,[d.value===4&&!n.value?(o(),a("p",ee," Please submit your availability for next week. This helps in planning meetings and work schedules. ")):d.value===4&&n.value?(o(),a("p",te," Thank you for submitting your availability for next week! You can still update it if needed. ")):(d.value===5||d.value===6)&&!n.value?(o(),a("p",se,[s[3]||(s[3]=e("span",{class:"font-bold"},"Action Required:",-1)),m(" You must submit your availability for all weekdays of next week. "+i(u.value?"Other features are currently blocked until you complete this task.":""),1)])):(d.value===5||d.value===6)&&n.value?(o(),a("p",ae," Thank you for submitting your availability for next week! You can still update it if needed. ")):A("",!0),e("p",oe,[x(R,{onClick:j,class:B(["whitespace-nowrap",{"bg-red-600 hover:bg-red-700":u.value}])},{default:w(()=>[m(i(n.value?"Update Availability":"Submit Availability"),1)]),_:1},8,["class"])])])]),x(W,{show:v.value,"next-week-dates":p.value,date:p.value.length>0?p.value[0].value:"",userId:b.value,onClose:s[0]||(s[0]=$=>v.value=!1),onAvailabilitySaved:N},null,8,["show","next-week-dates","date","userId"])],2)):A("",!0)}},ie={class:"py-12"},ne={class:"mx-auto max-w-7xl sm:px-6 lg:px-8 space-y-6"},de={class:"overflow-hidden bg-white shadow-sm sm:rounded-lg"},re={class:"p-6 text-gray-900"},ue={class:"flex justify-between items-center"},ce={class:"mt-1 text-sm text-gray-600"},pe={class:"font-bold"},ve={key:0,class:"mt-4"},xe={key:0,class:"text-sm text-gray-500"},me={key:1,class:"text-sm text-red-500"},he={key:2,class:"text-sm text-gray-500"},ye={key:3,class:"mt-3"},ge={class:"min-w-full divide-y divide-gray-200"},_e={class:"bg-white divide-y divide-gray-200"},fe={class:"px-3 py-2 whitespace-nowrap text-sm"},we={class:"px-3 py-2 whitespace-nowrap text-sm capitalize"},ke={class:"px-3 py-2 whitespace-nowrap text-sm"},be={class:"flex space-x-2"},Ce=["onClick"],De={class:"overflow-hidden bg-white shadow-sm sm:rounded-lg"},$e={class:"p-6 text-gray-900"},Ae={class:"flex justify-between items-center"},Se={class:"mt-1 text-sm text-gray-600"},je={class:"font-bold"},Ne={key:0,class:"mt-4"},Te={key:0,class:"text-sm text-gray-500"},Pe={key:1,class:"text-sm text-red-500"},Ee={key:2,class:"text-sm text-gray-500"},Be={key:3,class:"mt-3"},ze={class:"min-w-full divide-y divide-gray-200"},Me={class:"bg-white divide-y divide-gray-200"},Ie={class:"px-3 py-2 whitespace-nowrap text-sm"},Le={class:"px-3 py-2 whitespace-nowrap text-sm"},Ue={class:"px-3 py-2 whitespace-nowrap text-sm"},Ve={class:"px-3 py-2 whitespace-nowrap text-sm"},We={class:"px-3 py-2 whitespace-nowrap text-sm"},Ye={class:"flex space-x-2"},Xe={__name:"Dashboard",props:{projectCount:Number},setup(E){const c=l([]),h=l(!0),p=l(""),v=l(!1),y=l({total_due_tasks:0,projects:[]}),u=l(!1),n=l(""),d=l(!1),_=l(!1),b=l(null),C=async()=>{h.value=!0,p.value="";try{const r=await k.get("/api/projects-simplified");c.value=r.data}catch(r){p.value="Failed to load projects",console.error("Error fetching projects:",r)}finally{h.value=!1}},g=async()=>{u.value=!0,n.value="";try{const r=await k.get("/api/task-statistics");y.value=r.data}catch(r){n.value="Failed to load task statistics",console.error("Error fetching task statistics:",r)}finally{u.value=!1}},S=()=>{v.value=!v.value,v.value&&c.value.length===0&&C()},j=()=>{d.value=!d.value,d.value&&y.value.projects.length===0&&g()},N=r=>{b.value=r,_.value=!0},D=()=>{C()};return L(()=>{g()}),(r,t)=>(o(),a(P,null,[x(T(q),{title:"Dashboard"}),x(Y,null,{header:w(()=>t[1]||(t[1]=[e("h2",{class:"text-xl font-semibold leading-tight text-gray-800"}," Dashboard ",-1)])),default:w(()=>[e("div",ie,[e("div",ne,[x(le),e("div",de,[e("div",re,[e("div",ue,[t[2]||(t[2]=e("h3",{class:"text-lg font-medium text-gray-900"},"Projects",-1)),e("button",{onClick:S,class:"text-sm text-blue-600 hover:text-blue-800"},i(v.value?"Collapse":"Expand"),1)]),e("p",ce,[t[3]||(t[3]=m(" You have access to ",-1)),e("span",pe,i(E.projectCount),1),t[4]||(t[4]=m(" project(s). ",-1))]),v.value?(o(),a("div",ve,[h.value?(o(),a("div",xe,"Loading projects...")):p.value?(o(),a("div",me,i(p.value),1)):c.value.length===0?(o(),a("div",he,"No projects found.")):(o(),a("div",ye,[e("table",ge,[t[6]||(t[6]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{scope:"col",class:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Name"),e("th",{scope:"col",class:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Status"),e("th",{scope:"col",class:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Actions")])],-1)),e("tbody",_e,[(o(!0),a(P,null,M(c.value,s=>(o(),a("tr",{key:s.id},[e("td",fe,i(s.name),1),e("td",we,i(s.status.replace("_"," ")),1),e("td",ke,[e("div",be,[x(T(I),{href:`/projects/${s.id}`,class:"text-xs bg-blue-500 hover:bg-blue-700 text-white py-1 px-2 rounded"},{default:w(()=>t[5]||(t[5]=[m(" View ",-1)])),_:2,__:[5]},1032,["href"]),e("button",{onClick:$=>N(s.id),class:"text-xs bg-purple-500 hover:bg-purple-700 text-white py-1 px-2 rounded"}," Notes ",8,Ce)])])]))),128))])])]))])):A("",!0)])]),e("div",De,[e("div",$e,[e("div",Ae,[t[7]||(t[7]=e("h3",{class:"text-lg font-medium text-gray-900"},"Due Tasks",-1)),e("button",{onClick:j,class:"text-sm text-blue-600 hover:text-blue-800"},i(d.value?"Collapse":"Expand"),1)]),e("p",Se,[t[8]||(t[8]=m(" You have ",-1)),e("span",je,i(y.value.total_due_tasks),1),t[9]||(t[9]=m(" task(s) due. ",-1))]),d.value?(o(),a("div",Ne,[u.value?(o(),a("div",Te,"Loading tasks...")):n.value?(o(),a("div",Pe,i(n.value),1)):y.value.projects.length===0?(o(),a("div",Ee,"No due tasks found.")):(o(),a("div",Be,[e("table",ze,[t[11]||(t[11]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{scope:"col",class:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Project Name"),e("th",{scope:"col",class:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Due Tasks"),e("th",{scope:"col",class:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Due Today"),e("th",{scope:"col",class:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Assigned Me"),e("th",{scope:"col",class:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Actions")])],-1)),e("tbody",Me,[(o(!0),a(P,null,M(y.value.projects,s=>(o(),a("tr",{key:s.id},[e("td",Ie,i(s.name),1),e("td",Le,i(s.due_tasks),1),e("td",Ue,i(s.due_today),1),e("td",Ve,i(s.assigned_to_me),1),e("td",We,[e("div",Ye,[x(T(I),{href:`/projects/${s.id}`,class:"text-xs bg-blue-500 hover:bg-blue-700 text-white py-1 px-2 rounded"},{default:w(()=>t[10]||(t[10]=[m(" View ",-1)])),_:2,__:[10]},1032,["href"])])])]))),128))])])]))])):A("",!0)])]),t[12]||(t[12]=e("div",{class:"overflow-hidden bg-white shadow-sm sm:rounded-lg"},[e("div",{class:"p-6 text-gray-900"},[e("h3",{class:"text-lg font-medium text-gray-900"},"Notice Board"),e("p",{class:"mt-1 text-sm text-gray-600"}," No new announcements at this time. ")])],-1))])]),x(G,{show:_.value,"project-id":b.value,onClose:t[0]||(t[0]=s=>_.value=!1),onNoteAdded:D},null,8,["show","project-id"])]),_:1})],64))}};export{Xe as default};
