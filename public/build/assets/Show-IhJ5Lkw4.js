import{B as ct,z as A,C as vt,M as pt,r as d,N as mt,p as k,D as gt,A as ft,O as xt,h as l,o as a,e as m,u as ge,q as yt,a as g,b as t,t as n,g as u,k as p,F as j,i as D,c as _t,n as J,f as h,v as E,Q as bt,j as $,d as Me}from"./app-BFd-8kIE.js";import{_ as wt}from"./AuthenticatedLayout-7KjWacK4.js";import{P as S}from"./PrimaryButton-CCPqaBb5.js";import{a as O,_ as K}from"./SecondaryButton-CJhP3nK4.js";import{_ as ht}from"./ProjectForm-D5QEDG4d.js";import{_ as kt}from"./NotesModal-Ch8Io-bU.js";import{_ as jt}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./ApplicationLogo-C0WcFAYF.js";import"./TextInput-BDV5wMMi.js";import"./InputError-DhXOP2h9.js";import"./Checkbox-DiZVGyIl.js";const Dt={class:"py-8 max-w-full mx-auto px-4 sm:px-6 lg:px-8"},Ct={key:0,class:"text-center text-gray-600 text-lg animate-pulse"},Mt={key:1,class:"text-center text-red-600 text-lg font-medium"},Nt={key:2,class:"space-y-8"},Tt={class:"bg-white p-6 rounded-xl shadow-md hover:shadow-lg transition-shadow mb-6"},Pt={class:"flex justify-between items-center mb-4"},Et={key:0,class:"flex gap-3"},At={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},$t={class:"text-2xl font-bold text-gray-900 tracking-tight mb-2"},St={class:"text-gray-600 text-base"},Rt={class:"space-y-3 text-sm text-gray-700"},Ut={class:"flex space-x-4 mt-2"},Vt=["href"],Ft=["href"],Ot=["href"],It={class:"grid grid-cols-2 sm:grid-cols-4 gap-4 mb-6"},Lt={class:"bg-white p-4 rounded-xl shadow-md hover:shadow-lg transition-shadow"},Bt={class:"text-2xl font-bold text-indigo-600"},Wt={class:"bg-white p-4 rounded-xl shadow-md hover:shadow-lg transition-shadow"},Ht={class:"text-2xl font-bold text-indigo-600"},Gt={class:"bg-white p-4 rounded-xl shadow-md hover:shadow-lg transition-shadow"},zt={class:"text-2xl font-bold text-indigo-600"},qt={class:"bg-white p-4 rounded-xl shadow-md hover:shadow-lg transition-shadow"},Qt={class:"text-2xl font-bold text-indigo-600"},Yt={class:"grid grid-cols-2 sm:grid-cols-4 gap-4 mb-6"},Jt={key:0,class:"bg-white p-6 rounded-xl shadow-md hover:shadow-lg transition-shadow"},Kt={class:"space-y-3 text-sm text-gray-700"},Xt={key:0},Zt={class:"list-disc ml-5 mt-2 space-y-2"},es={key:0,class:"ml-4 mt-1"},ts={class:"list-circle ml-5 text-xs text-gray-600"},ss={key:1,class:"text-gray-400"},os={key:1,class:"bg-white p-6 rounded-xl shadow-md hover:shadow-lg transition-shadow"},as={key:0,class:"space-y-3 text-sm text-gray-700"},ls={class:"text-gray-900"},ns=["href"],rs={key:1,class:"text-gray-400 text-sm"},is={class:"bg-white p-6 rounded-xl shadow-md hover:shadow-lg transition-shadow"},ds={key:0,class:"space-y-3 text-sm text-gray-700"},us={class:"text-gray-900"},cs=["href"],vs={key:1,class:"text-gray-400 text-sm"},ps={class:"bg-white p-6 rounded-xl shadow-md hover:shadow-lg transition-shadow"},ms={class:"flex justify-between items-center mb-4"},gs={class:"flex gap-2"},fs={key:0},xs={key:1},ys={class:"mb-6 overflow-x-auto"},_s={key:0,class:"text-center text-gray-600 text-sm animate-pulse py-4"},bs={key:1,class:"text-center py-4"},ws={key:2,class:"relative py-8"},hs={class:"relative flex justify-between"},ks={key:0,class:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},js={key:1,class:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Ds={key:2,class:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Cs={key:3,class:"w-2 h-2 bg-white rounded-full"},Ms={class:"absolute -top-8 transform -translate-x-1/2 left-1/2 w-32"},Ns=["title"],Ts={class:"absolute top-8 transform -translate-x-1/2 left-1/2"},Ps={class:"text-xs text-gray-500 whitespace-nowrap"},Es={class:"mb-6 bg-gray-50 p-4 rounded-lg"},As={class:"flex flex-wrap items-center gap-4"},$s={class:"flex-1 min-w-[200px]"},Ss={class:"flex-1 min-w-[200px]"},Rs=["value"],Us={class:"flex-1 min-w-[200px]"},Vs=["value"],Fs={class:"flex-1 min-w-[200px]"},Os=["value"],Is={key:0,class:"mt-3 text-sm text-gray-600"},Ls={key:0,class:"text-red-600 font-medium"},Bs={key:0,class:"text-center text-gray-600 text-sm animate-pulse py-4"},Ws={key:1,class:"text-center py-4"},Hs={class:"text-red-600 text-sm font-medium"},Gs={key:2,class:"overflow-x-auto"},zs={class:"min-w-full divide-y divide-gray-200"},qs={class:"bg-white divide-y divide-gray-200"},Qs={class:"px-4 py-3 text-sm text-gray-900"},Ys={class:"px-4 py-3 text-sm text-gray-700"},Js={class:"px-4 py-3 text-sm text-gray-700"},Ks={class:"px-4 py-3 text-sm text-gray-700"},Xs={class:"px-4 py-3 text-sm text-gray-700"},Zs={class:"px-4 py-3 text-right"},eo={class:"flex justify-end space-x-2"},to=["onClick"],so=["onClick"],oo=["onClick"],ao=["onClick"],lo={key:3,class:"text-center py-4"},no={key:0,class:"bg-white p-6 rounded-xl shadow-md hover:shadow-lg transition-shadow"},ro={class:"flex justify-between items-center mb-4"},io={key:0,class:"flex gap-3"},uo={key:0,class:"text-center text-gray-600 text-sm animate-pulse py-4"},co={key:1,class:"text-center text-red-600 text-sm font-medium py-4"},vo={key:2,class:"overflow-x-auto"},po={class:"min-w-full divide-y divide-gray-200"},mo={class:"bg-white divide-y divide-gray-200"},go={class:"px-4 py-3 text-sm text-gray-900"},fo={class:"px-4 py-3 text-sm text-gray-700"},xo={class:"px-4 py-3 text-sm text-gray-700"},yo={class:"px-4 py-3 text-sm text-gray-700"},_o={class:"px-4 py-3 text-right"},bo={key:3,class:"text-gray-400 text-sm"},wo={class:"bg-white p-6 rounded-xl shadow-md hover:shadow-lg transition-shadow"},ho={class:"flex justify-between items-center mb-4"},ko={key:0},jo={key:0,class:"space-y-4"},Do={class:"flex justify-between"},Co={class:"flex-grow"},Mo={key:0,class:"text-xs text-red-400 block mt-1"},No={class:"flex items-center mt-1"},To={class:"text-xs text-gray-500"},Po={key:0,class:"ml-2 px-2 py-0.5 bg-indigo-100 text-indigo-800 text-xs rounded-full"},Eo={key:0},Ao={key:1,class:"text-gray-400 text-sm"},$o={class:"p-6"},So={class:"flex justify-between items-center mb-4"},Ro={key:0,class:"space-y-4"},Uo={class:"border-b pb-4"},Vo={class:"text-xl font-medium text-gray-900 mb-2"},Fo={class:"grid grid-cols-2 gap-4 text-sm"},Oo={class:"text-gray-600"},Io={class:"text-gray-900"},Lo={class:"text-gray-600 mt-1"},Bo={class:"text-gray-600"},Wo={class:"text-gray-900"},Ho={class:"prose max-w-none"},Go=["innerHTML"],zo={key:0,class:"mt-4 p-4 bg-red-50 rounded-md"},qo={class:"text-red-700"},Qo={key:1,class:"mt-4 text-sm text-gray-600"},Yo={key:0},Jo={class:"p-6"},Ko={class:"flex justify-between items-center mb-4"},Xo={key:0,class:"mb-4 p-3 bg-gray-100 rounded-md"},Zo={class:"text-sm text-gray-700"},ea={class:"text-xs text-gray-500 mt-1"},ta={key:1,class:"mb-4"},sa={key:0,class:"text-center py-4"},oa={key:1,class:"space-y-3 max-h-60 overflow-y-auto"},aa={class:"text-sm text-gray-700"},la={class:"text-xs text-gray-500 mt-1"},na={key:2,class:"text-center py-3"},ra={class:"mb-4"},ia={key:0,class:"mt-2 text-sm text-red-600"},da={class:"mt-6 flex justify-end"},ua={class:"p-6"},ca={class:"flex justify-between items-center mb-4"},va={class:"text-lg font-semibold text-gray-900"},pa={key:0,class:"mt-1 text-sm text-red-600"},ma={key:0,class:"mt-1 text-sm text-red-600"},ga={key:0,class:"mt-1 text-sm text-red-600"},fa={key:0,class:"mt-1 text-sm text-red-600"},xa=["value"],ya={key:0,class:"mt-1 text-sm text-red-600"},_a={key:0,class:"text-sm text-gray-500"},ba=["value"],wa={key:2,class:"mt-1 text-sm text-red-600"},ha={key:0,class:"text-sm text-gray-500"},ka=["value"],ja={key:2,class:"mt-1 text-sm text-red-600"},Da={class:"mt-6 flex justify-end space-x-3"},Ca={class:"p-6"},Ma={class:"flex justify-between items-center mb-4"},Na={key:0,class:"mt-1 text-sm text-red-600"},Ta={key:0,class:"mt-1 text-sm text-red-600"},Pa={key:0,class:"mt-1 text-sm text-red-600"},Ea={key:0,class:"mt-1 text-sm text-red-600"},Aa={class:"mt-6 flex justify-end space-x-3"},$a={class:"p-6"},Sa={class:"flex justify-between items-center mb-4"},Ra={key:0,class:"mb-4 p-3 bg-gray-100 rounded-md"},Ua={class:"text-sm font-medium text-gray-900"},Va={class:"text-xs text-gray-500 mt-1"},Fa={class:"mb-4"},Oa={key:0,class:"mt-2 text-sm text-red-600"},Ia={class:"mt-6 flex justify-end"},La={__name:"Show",setup(Ba){const v=ct(),fe=A().props.id,{permissions:Ne,loading:Te,error:Pe}=vt(),{permissions:Ee,loading:Ae,error:$e}=pt(fe),i=d({}),Se=d([]),Re=d([]),xe=d(!0),X=d(""),I=d(!1),ye=d(!1),Z=d(!1),T=d(null),L=d(""),R=d(""),ee=d([]),te=d(!1),Ue=()=>{ye.value=!0},Ve=async o=>{T.value=o,L.value="",R.value="",ee.value=[],te.value=!0,Z.value=!0;try{const e=await window.axios.get(`/api/projects/${i.value.id}/notes/${o.id}/replies`);e.data.success?ee.value=e.data.replies:console.error("Failed to fetch replies:",e.data.message)}catch(e){console.error("Error fetching replies:",e)}finally{te.value=!1}},Fe=async()=>{var o,e;if(!T.value||!L.value.trim()){R.value="Reply content is required";return}R.value="";try{const s=await window.axios.post(`/api/projects/${i.value.id}/notes/${T.value.id}/reply`,{content:L.value});if(s.data.success){L.value="";try{te.value=!0;const r=await window.axios.get(`/api/projects/${i.value.id}/notes/${T.value.id}/replies`);r.data.success&&(ee.value=r.data.replies)}catch(r){console.error("Error fetching updated replies:",r)}finally{te.value=!1}await de()}else R.value=s.data.message||"Failed to send reply"}catch(s){console.error("Error sending reply:",s),R.value=((e=(o=s.response)==null?void 0:o.data)==null?void 0:e.message)||"An error occurred while sending the reply"}},Oe=[{value:"active",label:"Active"},{value:"completed",label:"Completed"},{value:"on_hold",label:"On Hold"},{value:"archived",label:"Archived"}],Ie=[{value:"Website Designing",label:"Website Designing"},{value:"SEO",label:"SEO"},{value:"Social Media",label:"Social Media"},{value:"Content Writing",label:"Content Writing"},{value:"Graphic Design",label:"Graphic Design"}],Le=[{value:"UpWork",label:"UpWork"},{value:"Direct",label:"Direct Client"},{value:"Wix Marketplace",label:"Wix Marketplace"},{value:"Referral",label:"Referral"}],Be=[{value:"Primary",label:"Primary"},{value:"Accountant",label:"Accountant"},{value:"Other",label:"Other"}],We=[{value:"Manager",label:"Manager"},{value:"Developer",label:"Developer"},{value:"QA",label:"QA"},{value:"Other",label:"Other"}],He=[{value:"one_off",label:"One-Off"},{value:"monthly",label:"Monthly"}],y=mt(i),je=k(()=>!!y.value),De=k(()=>{if(!y.value)return!1;const o=y.value.name,e=y.value.slug;return o==="Manager"||o==="Project Manager"||e==="manager"||e==="project-manager"}),{canDo:re,canView:B}=gt(fe),U=k(()=>v.value?v.value.role_data&&v.value.role_data.slug==="super-admin"||v.value.role==="super_admin"||v.value.role==="super-admin":!1);k(()=>v.value?v.value.role_data&&v.value.role_data.slug==="manager"||v.value.role==="manager"||v.value.role==="manager-role"||v.value.role==="manager_role"||De.value:!1),k(()=>!v.value||je.value&&!De.value?!1:v.value.role_data&&v.value.role_data.slug==="employee"||v.value.role==="employee"||v.value.role==="employee-role"),k(()=>!v.value||je.value?!1:v.value.role_data&&v.value.role_data.slug==="contractor"||v.value.role==="contractor"||v.value.role==="contractor-role");const ie=k(()=>{console.log("userProjectRole in canManageProjects:",y.value);const o=y.value&&y.value.permissions&&y.value.permissions.some(x=>x.slug==="manage_projects");console.log("Has project-specific manage_projects permission:",o);const e=v.value&&v.value.global_permissions&&v.value.global_permissions.some(x=>x.slug==="manage_projects");console.log("Has global manage_projects permission:",e);const s=v.value&&v.value.role&&v.value.role.permissions&&v.value.role.permissions.some(x=>x.slug==="manage_projects");console.log("Has role manage_projects permission:",s);const r=re("manage_projects",y).value;console.log("canDo result for manage_projects:",r);const c=r||U.value;return console.log("Final canManageProjects result:",c),c}),Ce=k(()=>B("project_financial",y).value||U.value),Ge=k(()=>B("project_transactions",y).value||U.value),ze=k(()=>B("client_contacts",y).value||U.value),qe=k(()=>B("client_financial",y).value||U.value);k(()=>B("users",y).value||U.value);const Qe=k(()=>B("emails",y).value||!1),Ye=k(()=>re("compose_emails",y).value||!1),de=async()=>{xe.value=!0,X.value="";try{const o=A().props.id;console.log("Fetching project data for ID:",o);const e=await window.axios.get(`/api/projects/${o}/sections/basic`);console.log("Basic project data received:",e.data),i.value=e.data;try{const s=await window.axios.get(`/api/projects/${o}/sections/clients-users`);if(console.log("Clients and users data received:",s.data),s.data.clients&&(i.value.clients=s.data.clients),s.data.users){if(i.value.users=s.data.users,console.log("Project users:",i.value.users.length),i.value.users.length>0){const r=i.value.users[0];console.log("First user structure:",{id:r.id,name:r.name,hasPivot:!!r.pivot,pivotData:r.pivot?{hasRoleId:!!r.pivot.role_id,hasRoleData:!!r.pivot.role_data,roleDataStructure:r.pivot.role_data}:"No pivot data"});const c=i.value.users.find(x=>x.id===v.value.id);console.log("Current user in project:",c?{name:c.name,hasPivot:!!c.pivot,pivotData:c.pivot?{hasRoleId:!!c.pivot.role_id,hasRoleData:!!c.pivot.role_data,roleDataStructure:c.pivot.role_data}:"No pivot data"}:"Not found")}}else console.log("No users array in project data")}catch(s){console.error("Error fetching clients and users:",s)}if(Ce.value)try{const s=await window.axios.get(`/api/projects/${o}/sections/services-payment`);console.log("Financial data received:",s.data),i.value.services=s.data.services,i.value.service_details=s.data.service_details,i.value.total_amount=s.data.total_amount,i.value.payment_type=s.data.payment_type}catch(s){console.error("Error fetching financial information:",s)}if(Ge.value)try{const s=await window.axios.get(`/api/projects/${o}/sections/transactions`);console.log("Transactions data received:",s.data),i.value.transactions=s.data}catch(s){console.error("Error fetching transactions:",s)}try{const s=await window.axios.get(`/api/projects/${o}/sections/documents`);console.log("Documents data received:",s.data),i.value.documents=s.data}catch(s){console.error("Error fetching documents:",s)}if(qe.value)try{const s=await window.axios.get(`/api/projects/${o}/contract-details`);console.log("Contract details received:",s.data),i.value.contract_details=s.data}catch(s){console.error("Error fetching contract details:",s)}if(console.log("Project value after assignment:",i.value),console.log("userProjectRole after project set:",y.value),ie.value){console.log("User can manage projects, fetching additional data");const s=await window.axios.get("/api/clients");Se.value=s.data;const r=await window.axios.get("/api/users");Re.value=r.data.filter(c=>c.role==="contractor")}else console.log("User cannot manage projects, skipping additional data fetch")}catch(o){X.value="Failed to load project data.",console.error("Error fetching project data:",o),o.response&&(o.response.status===401||o.response.status===403)&&(X.value="You are not authorized to view this project or your session expired. Please log in.")}finally{xe.value=!1}},Je=()=>{I.value=!0},Ke=o=>{i.value=o,I.value=!1,alert("Project updated successfully!"),de()},P=d([]),se=d(!1),oe=d(""),V=d(!1),W=d(null),f=d({name:"",description:"",assigned_to_user_id:null,due_date:null,status:"To Do",task_type_id:null,milestone_id:null,tags:[]}),_=d({}),ae=d([]),C=d([]),ue=d(!1),le=d(!1),b=d({status:"",assigned_to_user_id:"",milestone_id:"",due_date_range:""}),Xe=[{value:"",label:"All Dates"},{value:"today",label:"Due Today"},{value:"this_week",label:"Due This Week"},{value:"next_week",label:"Due Next Week"},{value:"overdue",label:"Overdue"},{value:"no_date",label:"No Due Date"}],_e=k(()=>!C.value||!C.value.length?[]:[...C.value].sort((o,e)=>o.completion_date?e.completion_date?new Date(o.completion_date)-new Date(e.completion_date):-1:1)),be=k(()=>P.value.length?P.value.filter(o=>{var e;if(b.value.status&&o.status!==b.value.status)return!1;if(b.value.assigned_to_user_id){const s=parseInt(b.value.assigned_to_user_id);if(s===-1){if(o.assigned_to!=="Unassigned")return!1}else{const r=(e=i.value.users)==null?void 0:e.find(c=>c.id===s);if(r&&o.assigned_to!==r.name)return!1}}if(b.value.milestone_id){const s=parseInt(b.value.milestone_id);if(s===-1){if(o.milestone)return!1}else{const r=C.value.find(c=>c.id===s);if(r&&o.milestone!==r.name&&o.milestone_id!==s)return!1}}if(b.value.due_date_range){const s=new Date;s.setHours(0,0,0,0);const r=o.due_date?new Date(o.due_date):null;switch(b.value.due_date_range){case"today":if(!r||r.toDateString()!==s.toDateString())return!1;break;case"this_week":{if(!r)return!1;const c=new Date(s);if(c.setDate(s.getDate()+(6-s.getDay())),r<s||r>c)return!1;break}case"next_week":{if(!r)return!1;const c=new Date(s);c.setDate(s.getDate()+(7-s.getDay()));const x=new Date(c);if(x.setDate(c.getDate()+6),r<c||r>x)return!1;break}case"overdue":{if(!r||r>=s)return!1;break}case"no_date":{if(r)return!1;break}}}return!0}):[]),Ze=()=>{b.value={status:"",assigned_to_user_id:"",milestone_id:"",due_date_range:""}},H=d(!1),G=d(null),z=d(""),F=d(""),ce=d(!1),q=d(!1),N=d({name:"",description:"",completion_date:null,status:"Not Started",project_id:A().props.id}),M=d({}),ve=d(!1),Q=async()=>{se.value=!0,oe.value="";try{const o=A().props.id,e=await window.axios.get(`/api/projects/${o}/tasks`);P.value=e.data,console.log("Tasks fetched:",P.value)}catch(o){oe.value="Failed to load tasks data.",console.error("Error fetching project tasks:",o),o.response&&o.response.data&&o.response.data.message&&(oe.value=o.response.data.message)}finally{se.value=!1}},we=async()=>{ue.value=!0;try{const o=await window.axios.get("/api/task-types");ae.value=o.data}catch(o){console.error("Error fetching task types:",o)}finally{ue.value=!1}},he=async()=>{le.value=!0;try{const o=A().props.id,e=await window.axios.get(`/api/projects/${o}/milestones`);C.value=e.data}catch(o){console.error("Error fetching milestones:",o)}finally{le.value=!1}},et=()=>{N.value={name:"",description:"",completion_date:null,status:"Not Started",project_id:A().props.id},M.value={},q.value=!0},tt=async()=>{M.value={},ve.value=!0;try{const o=await window.axios.post("/api/milestones",N.value);C.value.push(o.data),f.value.milestone_id=o.data.id,q.value=!1,alert("Milestone created successfully!")}catch(o){console.error("Error creating milestone:",o),o.response&&o.response.data&&o.response.data.errors?M.value=o.response.data.errors:alert("Failed to create milestone. Please try again.")}finally{ve.value=!1}},st=async()=>{W.value=null,f.value={name:"",description:"",assigned_to_user_id:null,due_date:null,status:"To Do",task_type_id:null,milestone_id:null,tags:[]},_.value={},ae.value.length===0&&await we(),C.value.length===0&&await he(),V.value=!0},ot=async o=>{var c;W.value=o,ae.value.length===0&&await we(),C.value.length===0&&await he();let e=null;if(o.milestone){const x=C.value.find(ne=>ne.name===o.milestone);x&&(e=x.id)}let s=null;if(o.task_type){const x=ae.value.find(ne=>ne.name===o.task_type);x&&(s=x.id)}let r=null;if(o.assigned_to&&o.assigned_to!=="Unassigned"){const x=(c=i.value.users)==null?void 0:c.find(ne=>ne.name===o.assigned_to);x&&(r=x.id)}f.value={name:o.title,description:o.description||"",assigned_to_user_id:r||o.assigned_to_id||null,due_date:o.due_date||null,status:o.status,task_type_id:s||o.task_type_id||null,milestone_id:e,tags:o.tags||[]},_.value={},V.value=!0},at=async o=>{try{await window.axios.post(`/api/tasks/${o.id}/complete`),await Q()}catch(e){console.error("Error marking task as completed:",e),alert("Failed to mark task as completed. Please try again.")}},lt=async o=>{try{await window.axios.post(`/api/tasks/${o.id}/start`),await Q()}catch(e){console.error("Error starting task:",e),alert("Failed to start task. Please try again.")}},nt=o=>{G.value=o,z.value="",F.value="",H.value=!0},rt=async()=>{if(!z.value.trim()){F.value="Note content is required";return}F.value="",ce.value=!0;try{await window.axios.post(`/api/tasks/${G.value.id}/notes`,{note:z.value}),H.value=!1,z.value="",G.value=null,await Q(),alert("Note added successfully!")}catch(o){console.error("Error adding note to task:",o),o.response&&o.response.data&&o.response.data.message?F.value=o.response.data.message:F.value="Failed to add note. Please try again."}finally{ce.value=!1}},it=async()=>{_.value={};try{let o;W.value?o=await window.axios.put(`/api/tasks/${W.value.id}`,f.value):o=await window.axios.post("/api/tasks",{...f.value,milestone_id:f.value.milestone_id||null}),V.value=!1,await Q()}catch(o){console.error("Error submitting task form:",o),o.response&&o.response.data&&o.response.data.errors?_.value=o.response.data.errors:alert("Failed to save task. Please try again.")}},Y=d([]),ke=d(!1),pe=d(""),w=d(null),me=d(!1),dt=async()=>{ke.value=!0,pe.value="";try{const o=A().props.id,e=await window.axios.get(`/api/projects/${o}/emails-simplified`);Y.value=e.data}catch(o){pe.value="Failed to load email data.",console.error("Error fetching project emails:",o)}finally{ke.value=!1}},ut=o=>{w.value=o,me.value=!0};return ft(async()=>{console.log("Component mounted, fetching data...");try{const o=A().props.id,e=await xt(o);console.log("Project permissions fetched (includes global):",e)}catch(o){console.error(`Error fetching permissions for project ${fe}:`,o)}await de(),await dt(),await Q();try{await we(),await he(),console.log("Task types and milestones fetched successfully")}catch(o){console.error("Error fetching task types or milestones:",o)}console.log("All data loaded, permission status:"),console.log("- Global permissions:",Ne.value),console.log("- Global permissions loading:",Te.value),console.log("- Global permissions error:",Pe.value),console.log("- Project permissions:",Ee.value),console.log("- Project permissions loading:",Ae.value),console.log("- Project permissions error:",$e.value),console.log("- User project role:",y.value),console.log("- Can manage projects:",ie.value)}),(o,e)=>(a(),l(j,null,[m(ge(yt),{title:i.value.name||"Project Details"},null,8,["title"]),m(wt,null,{default:g(()=>[t("div",Dt,[xe.value?(a(),l("div",Ct," Loading project details... ")):X.value?(a(),l("div",Mt,n(X.value),1)):(a(),l("div",Nt,[t("div",Tt,[t("div",Pt,[e[36]||(e[36]=t("h4",{class:"text-lg font-semibold text-gray-900"},"General Information",-1)),ie.value||U.value?(a(),l("div",Et,[m(S,{class:"bg-indigo-600 hover:bg-indigo-700 transition-colors",onClick:Je},{default:g(()=>e[35]||(e[35]=[p(" Edit Project ")])),_:1,__:[35]})])):u("",!0)]),t("div",At,[t("div",null,[t("h3",$t,n(i.value.name),1),t("p",St,n(i.value.description||"No description provided"),1)]),t("div",Rt,[t("p",null,[e[37]||(e[37]=t("strong",{class:"text-gray-900"},"Status:",-1)),p(" "+n(i.value.status.replace("_"," ").toUpperCase()),1)]),t("p",null,[e[38]||(e[38]=t("strong",{class:"text-gray-900"},"Project Type:",-1)),p(" "+n(i.value.project_type||"N/A"),1)]),t("p",null,[e[39]||(e[39]=t("strong",{class:"text-gray-900"},"Source:",-1)),p(" "+n(i.value.source||"N/A"),1)]),t("div",Ut,[i.value.website?(a(),l("a",{key:0,href:i.value.website,target:"_blank",class:"p-2 bg-gray-100 rounded-full hover:bg-gray-200 transition-colors",title:"Visit Website"},e[40]||(e[40]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 text-indigo-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9"})],-1)]),8,Vt)):u("",!0),i.value.social_media_link?(a(),l("a",{key:1,href:i.value.social_media_link,target:"_blank",class:"p-2 bg-gray-100 rounded-full hover:bg-gray-200 transition-colors",title:"Social Media"},e[41]||(e[41]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 text-indigo-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"})],-1)]),8,Ft)):u("",!0),i.value.google_drive_link?(a(),l("a",{key:2,href:i.value.google_drive_link,target:"_blank",class:"p-2 bg-gray-100 rounded-full hover:bg-gray-200 transition-colors",title:"Google Drive"},e[42]||(e[42]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 text-indigo-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1)]),8,Ot)):u("",!0)])])])]),t("div",It,[t("div",Lt,[e[43]||(e[43]=t("h4",{class:"text-sm font-semibold text-gray-500 mb-1"},"Pending Tasks",-1)),t("p",Bt,n(P.value.filter(s=>s.status!=="Done").length),1)]),t("div",Wt,[e[44]||(e[44]=t("h4",{class:"text-sm font-semibold text-gray-500 mb-1"},"Unread Emails",-1)),t("p",Ht,n(Y.value.filter(s=>s.status==="Received").length),1)]),t("div",Gt,[e[45]||(e[45]=t("h4",{class:"text-sm font-semibold text-gray-500 mb-1"},"Last Email Received",-1)),t("p",zt,n(Y.value.filter(s=>s.status==="Received").length?Y.value.filter(s=>s.status==="Received")[0].date:"N/A"),1)]),t("div",qt,[e[46]||(e[46]=t("h4",{class:"text-sm font-semibold text-gray-500 mb-1"},"Next Task Deadline",-1)),t("p",Qt,n(P.value.filter(s=>s.status!=="Completed").length?P.value.filter(s=>s.status!=="Completed").sort((s,r)=>new Date(s.due_date)-new Date(r.due_date))[0].due_date:"N/A"),1)])]),t("div",Yt,[Ce.value?(a(),l("div",Jt,[e[51]||(e[51]=t("h4",{class:"text-lg font-semibold text-gray-900 mb-4"},"Financial Information",-1)),t("div",Kt,[t("p",null,[e[47]||(e[47]=t("strong",{class:"text-gray-900"},"Total Amount:",-1)),p(" $"+n(i.value.total_amount||"0.00"),1)]),t("p",null,[e[48]||(e[48]=t("strong",{class:"text-gray-900"},"Payment Type:",-1)),p(" "+n(i.value.payment_type.replace("_"," ").toUpperCase()),1)]),i.value.service_details&&i.value.service_details.length?(a(),l("div",Xt,[e[50]||(e[50]=t("strong",{class:"text-gray-900"},"Service Details:",-1)),t("ul",Zt,[(a(!0),l(j,null,D(i.value.service_details,s=>(a(),l("li",{key:s.service_id},[p(n(s.service_id)+": $"+n(s.amount)+" ("+n(s.frequency)+") - Starts "+n(s.start_date||"N/A")+" ",1),s.payment_breakdown?(a(),l("div",es,[e[49]||(e[49]=t("p",{class:"text-xs font-medium text-gray-600"},"Payment Breakdown:",-1)),t("ul",ts,[t("li",null,"First: "+n(s.payment_breakdown.first)+"%",1),t("li",null,"Second: "+n(s.payment_breakdown.second)+"%",1),t("li",null,"Third: "+n(s.payment_breakdown.third)+"%",1)])])):u("",!0)]))),128))])])):(a(),l("p",ss,"No service details available."))])])):u("",!0),ze.value?(a(),l("div",os,[e[53]||(e[53]=t("h4",{class:"text-lg font-semibold text-gray-900 mb-4"},"Clients",-1)),i.value.clients&&i.value.clients.length?(a(),l("div",as,[(a(!0),l(j,null,D(i.value.clients,s=>(a(),l("div",{key:s.id,class:"border-l-4 border-indigo-500 pl-3"},[t("p",null,[t("strong",ls,n(s.name),1)]),t("p",null,[e[52]||(e[52]=p("Email: ")),t("a",{href:`mailto:${s.email}`,class:"text-indigo-600 hover:underline"},n(s.email),9,ns)]),t("p",null,"Phone: "+n(s.phone||"N/A"),1),t("p",null,"Address: "+n(s.address||"N/A"),1)]))),128))])):(a(),l("p",rs,"No clients assigned."))])):u("",!0),t("div",is,[e[55]||(e[55]=t("h4",{class:"text-lg font-semibold text-gray-900 mb-4"},"Assigned Team",-1)),i.value.users&&i.value.users.length?(a(),l("div",ds,[(a(!0),l(j,null,D(i.value.users,s=>(a(),l("div",{key:s.id,class:"border-l-4 border-blue-500 pl-3"},[t("p",null,[t("strong",us,n(s.name),1),p(" ("+n(s.pivot.role)+")",1)]),t("p",null,[e[54]||(e[54]=p("Email: ")),t("a",{href:`mailto:${s.email}`,class:"text-indigo-600 hover:underline"},n(s.email),9,cs)])]))),128))])):(a(),l("p",vs,"No team members assigned."))])]),t("div",ps,[t("div",ms,[e[57]||(e[57]=t("h4",{class:"text-lg font-semibold text-gray-900"},"Project Tasks",-1)),t("div",gs,[m(O,{onClick:Q,disabled:se.value,class:"text-indigo-600 hover:text-indigo-800"},{default:g(()=>[se.value?(a(),l("span",xs,"Loading...")):(a(),l("span",fs,"Refresh"))]),_:1},8,["disabled"]),ie.value?(a(),_t(S,{key:0,class:"bg-indigo-600 hover:bg-indigo-700 transition-colors",onClick:st},{default:g(()=>e[56]||(e[56]=[p(" Add Task ")])),_:1,__:[56]})):u("",!0)])]),t("div",ys,[le.value?(a(),l("div",_s," Loading milestones... ")):_e.value.length?(a(),l("div",ws,[e[62]||(e[62]=t("div",{class:"absolute h-1 bg-gray-200 top-1/2 left-0 right-0 transform -translate-y-1/2"},null,-1)),t("div",hs,[(a(!0),l(j,null,D(_e.value,(s,r)=>(a(),l("div",{key:s.id,class:J(["flex flex-col items-center relative z-10",{"ml-4":r===0,"mr-4":r===_e.value.length-1}])},[t("div",{class:J(["w-6 h-6 rounded-full shadow-lg flex items-center justify-center",{"bg-gray-300":s.status==="Not Started","bg-blue-500":s.status==="In Progress","bg-green-500":s.status==="Completed","bg-red-500":s.status==="Overdue"}])},[s.status==="Completed"?(a(),l("svg",ks,e[59]||(e[59]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)]))):s.status==="In Progress"?(a(),l("svg",js,e[60]||(e[60]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 10V3L4 14h7v7l9-11h-7z"},null,-1)]))):s.status==="Overdue"?(a(),l("svg",Ds,e[61]||(e[61]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"},null,-1)]))):(a(),l("span",Cs))],2),t("div",Ms,[t("p",{class:"text-xs font-medium text-gray-700 text-center truncate",title:s.name},n(s.name),9,Ns)]),t("div",Ts,[t("p",Ps,n(s.completion_date?new Date(s.completion_date).toLocaleDateString():"No date"),1)])],2))),128))])])):(a(),l("div",bs,e[58]||(e[58]=[t("p",{class:"text-gray-400 text-sm"},"No milestones found for this project.",-1)])))]),t("div",Es,[t("div",As,[t("div",$s,[e[64]||(e[64]=t("label",{for:"status-filter",class:"block text-sm font-medium text-gray-700 mb-1"},"Status",-1)),h(t("select",{id:"status-filter","onUpdate:modelValue":e[0]||(e[0]=s=>b.value.status=s),class:"w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 text-sm"},e[63]||(e[63]=[t("option",{value:""},"All Statuses",-1),t("option",{value:"To Do"},"To Do",-1),t("option",{value:"In Progress"},"In Progress",-1),t("option",{value:"Done"},"Done",-1),t("option",{value:"Blocked"},"Blocked",-1),t("option",{value:"Archived"},"Archived",-1)]),512),[[E,b.value.status]])]),t("div",Ss,[e[67]||(e[67]=t("label",{for:"assigned-filter",class:"block text-sm font-medium text-gray-700 mb-1"},"Assigned To",-1)),h(t("select",{id:"assigned-filter","onUpdate:modelValue":e[1]||(e[1]=s=>b.value.assigned_to_user_id=s),class:"w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 text-sm"},[e[65]||(e[65]=t("option",{value:""},"All Users",-1)),e[66]||(e[66]=t("option",{value:"-1"},"Unassigned",-1)),(a(!0),l(j,null,D(i.value.users,s=>(a(),l("option",{key:s.id,value:s.id},n(s.name),9,Rs))),128))],512),[[E,b.value.assigned_to_user_id]])]),t("div",Us,[e[70]||(e[70]=t("label",{for:"milestone-filter",class:"block text-sm font-medium text-gray-700 mb-1"},"Milestone",-1)),h(t("select",{id:"milestone-filter","onUpdate:modelValue":e[2]||(e[2]=s=>b.value.milestone_id=s),class:"w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 text-sm"},[e[68]||(e[68]=t("option",{value:""},"All Milestones",-1)),e[69]||(e[69]=t("option",{value:"-1"},"No Milestone",-1)),(a(!0),l(j,null,D(C.value,s=>(a(),l("option",{key:s.id,value:s.id},n(s.name),9,Vs))),128))],512),[[E,b.value.milestone_id]])]),t("div",Fs,[e[71]||(e[71]=t("label",{for:"due-date-filter",class:"block text-sm font-medium text-gray-700 mb-1"},"Due Date",-1)),h(t("select",{id:"due-date-filter","onUpdate:modelValue":e[3]||(e[3]=s=>b.value.due_date_range=s),class:"w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 text-sm"},[(a(),l(j,null,D(Xe,s=>t("option",{key:s.value,value:s.value},n(s.label),9,Os)),64))],512),[[E,b.value.due_date_range]])]),t("div",{class:"flex items-end"},[t("button",{onClick:Ze,class:"px-3 py-2 text-sm text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-md transition-colors"}," Clear Filters ")])]),Object.values(b.value).some(s=>s!=="")?(a(),l("div",Is,[t("p",null,[p(" Showing "+n(be.value.length)+" of "+n(P.value.length)+" tasks ",1),be.value.length===0?(a(),l("span",Ls," (No tasks match the current filters) ")):u("",!0)])])):u("",!0)]),se.value?(a(),l("div",Bs," Loading tasks... ")):oe.value?(a(),l("div",Ws,[t("p",Hs,n(oe.value),1)])):P.value.length?(a(),l("div",Gs,[t("table",zs,[e[72]||(e[72]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Title"),t("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Status"),t("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Assigned To"),t("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Due Date"),t("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Milestone"),t("th",{class:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"Actions")])],-1)),t("tbody",qs,[(a(!0),l(j,null,D(be.value,s=>(a(),l("tr",{key:s.id,class:"hover:bg-gray-50 transition-colors"},[t("td",Qs,n(s.title),1),t("td",Ys,[t("span",{class:J({"px-2 py-1 rounded-full text-xs font-medium":!0,"bg-yellow-100 text-yellow-800":s.status==="To Do","bg-blue-100 text-blue-800":s.status==="In Progress","bg-green-100 text-green-800":s.status==="Done","bg-red-100 text-red-800":s.status==="Blocked","bg-gray-100 text-gray-800":s.status==="Archived"})},n(s.status),3)]),t("td",Js,n(s.assigned_to),1),t("td",Ks,n(s.due_date?s.due_date:"N/A"),1),t("td",Xs,n(s.milestone||"N/A"),1),t("td",Zs,[t("div",eo,[t("button",{onClick:r=>ot(s),class:"text-indigo-600 hover:text-indigo-800 text-sm font-medium"}," Edit ",8,to),t("button",{onClick:r=>nt(s),class:"text-blue-600 hover:text-blue-800 text-sm font-medium"}," Add Note ",8,so),s.status==="To Do"?(a(),l("button",{key:0,onClick:r=>lt(s),class:"text-blue-600 hover:text-blue-800 text-sm font-medium"}," Start ",8,oo)):u("",!0),s.status!=="Done"?(a(),l("button",{key:1,onClick:r=>at(s),class:"text-green-600 hover:text-green-800 text-sm font-medium"}," Complete ",8,ao)):u("",!0)])])]))),128))])])])):(a(),l("div",lo,e[73]||(e[73]=[t("p",{class:"text-gray-400 text-sm"},"No tasks found for this project.",-1),t("p",{class:"text-gray-500 text-sm mt-2"},' Click the "Add Task" button to create a new task. ',-1)])))]),Qe.value?(a(),l("div",no,[t("div",ro,[e[75]||(e[75]=t("h4",{class:"text-lg font-semibold text-gray-900"},"Email Communication",-1)),Ye.value?(a(),l("div",io,[m(S,{class:"bg-indigo-600 hover:bg-indigo-700 transition-colors",onClick:e[4]||(e[4]=s=>ge(bt).visit("/emails/compose"))},{default:g(()=>e[74]||(e[74]=[p(" Compose Email ")])),_:1,__:[74]})])):u("",!0)]),ke.value?(a(),l("div",uo," Loading email data... ")):pe.value?(a(),l("div",co,n(pe.value),1)):Y.value.length?(a(),l("div",vo,[t("table",po,[e[77]||(e[77]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Subject"),t("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"From"),t("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Date"),t("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Status"),t("th",{class:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"Actions")])],-1)),t("tbody",mo,[(a(!0),l(j,null,D(Y.value,s=>{var r;return a(),l("tr",{key:s.id,class:"hover:bg-gray-50 transition-colors"},[t("td",go,n(s.subject),1),t("td",fo,n(((r=s.sender)==null?void 0:r.name)||"N/A"),1),t("td",xo,n(new Date(s.created_at).toLocaleDateString()),1),t("td",yo,[t("span",{class:J({"px-2 py-1 rounded-full text-xs font-medium":!0,"bg-green-100 text-green-800":s.status==="sent","bg-yellow-100 text-yellow-800":s.status==="pending_approval","bg-red-100 text-red-800":s.status==="rejected","bg-gray-100 text-gray-800":s.status==="draft"})},n(s.status.replace("_"," ").toUpperCase()),3)]),t("td",_o,[m(O,{class:"text-indigo-600 hover:text-indigo-800",onClick:c=>ut(s)},{default:g(()=>e[76]||(e[76]=[p(" View ")])),_:2,__:[76]},1032,["onClick"])])])}),128))])])])):(a(),l("p",bo,"No email communication found."))])):u("",!0),t("div",wo,[t("div",ho,[e[79]||(e[79]=t("h4",{class:"text-lg font-semibold text-gray-900"},"Notes",-1)),ge(re)("add_project_notes").value?(a(),l("div",ko,[m(S,{class:"bg-indigo-600 hover:bg-indigo-700 transition-colors",onClick:Ue},{default:g(()=>e[78]||(e[78]=[p(" Add Note ")])),_:1,__:[78]})])):u("",!0)]),i.value.notes&&i.value.notes.length?(a(),l("div",jo,[(a(!0),l(j,null,D(i.value.notes,s=>{var r;return a(),l("div",{key:s.id,class:"p-4 bg-gray-50 rounded-md shadow-sm hover:bg-gray-100 transition-colors"},[t("div",Do,[t("div",Co,[t("p",{class:J(["text-sm",{"text-gray-700":s.content!=="[Encrypted content could not be decrypted]","text-red-500 italic":s.content==="[Encrypted content could not be decrypted]"}])},[p(n(s.content)+" ",1),s.content==="[Encrypted content could not be decrypted]"?(a(),l("span",Mo," (There was an issue decrypting this note. Please contact an administrator.) ")):u("",!0)],2),t("div",No,[t("p",To,"Added by "+n(((r=s.user)==null?void 0:r.name)||"Unknown")+" on "+n(new Date(s.created_at).toLocaleDateString()),1),s.reply_count>0?(a(),l("span",Po,n(s.reply_count)+" "+n(s.reply_count===1?"reply":"replies"),1)):u("",!0)])]),ge(re)("add_project_notes").value&&s.chat_message_id&&i.value.google_chat_id?(a(),l("div",Eo,[m(O,{class:"text-sm text-indigo-600 hover:text-indigo-800",onClick:c=>Ve(s)},{default:g(()=>e[80]||(e[80]=[p(" Reply ")])),_:2,__:[80]},1032,["onClick"])])):u("",!0)])])}),128))])):(a(),l("p",Ao,"No notes available."))])]))]),m(K,{show:I.value,onClose:e[6]||(e[6]=s=>I.value=!1)},{default:g(()=>[m(ht,{show:I.value,project:i.value,statusOptions:Oe,departmentOptions:Ie,sourceOptions:Le,clientRoleOptions:Be,userRoleOptions:We,paymentTypeOptions:He,onClose:e[5]||(e[5]=s=>I.value=!1),onSubmit:Ke},null,8,["show","project"])]),_:1},8,["show"]),m(K,{show:me.value,onClose:e[8]||(e[8]=s=>me.value=!1)},{default:g(()=>{var s;return[t("div",$o,[t("div",So,[e[82]||(e[82]=t("h3",{class:"text-lg font-semibold text-gray-900"},"Email Details",-1)),t("button",{onClick:e[7]||(e[7]=r=>me.value=!1),class:"text-gray-400 hover:text-gray-500"},e[81]||(e[81]=[t("svg",{class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),w.value?(a(),l("div",Ro,[t("div",Uo,[t("h4",Vo,n(w.value.subject),1),t("div",Fo,[t("div",null,[t("p",Oo,[e[83]||(e[83]=p("From: ")),t("span",Io,n(((s=w.value.sender)==null?void 0:s.name)||"N/A"),1)]),t("p",Lo,[e[84]||(e[84]=p("Status: ")),t("span",{class:J({"px-2 py-1 rounded-full text-xs font-medium":!0,"bg-green-100 text-green-800":w.value.status==="sent","bg-yellow-100 text-yellow-800":w.value.status==="pending_approval","bg-red-100 text-red-800":w.value.status==="rejected","bg-gray-100 text-gray-800":w.value.status==="draft"})},n(w.value.status.replace("_"," ").toUpperCase()),3)])]),t("div",null,[t("p",Bo,[e[85]||(e[85]=p("Date: ")),t("span",Wo,n(new Date(w.value.created_at).toLocaleString()),1)])])])]),t("div",Ho,[t("div",{innerHTML:w.value.body},null,8,Go)]),w.value.rejection_reason?(a(),l("div",zo,[e[86]||(e[86]=t("h5",{class:"font-medium text-red-800"},"Rejection Reason:",-1)),t("p",qo,n(w.value.rejection_reason),1)])):u("",!0),w.value.approver?(a(),l("div",Qo,[t("p",null,"Approved/Rejected by: "+n(w.value.approver.name),1),w.value.sent_at?(a(),l("p",Yo,"Sent at: "+n(new Date(w.value.sent_at).toLocaleString()),1)):u("",!0)])):u("",!0)])):u("",!0)])]}),_:1},8,["show"]),m(kt,{show:ye.value,"project-id":i.value.id,onClose:e[9]||(e[9]=s=>ye.value=!1),onNoteAdded:de},null,8,["show","project-id"]),m(K,{show:Z.value,onClose:e[13]||(e[13]=s=>Z.value=!1)},{default:g(()=>{var s;return[t("div",Jo,[t("div",Ko,[e[88]||(e[88]=t("h3",{class:"text-lg font-semibold text-gray-900"},"Reply to Note",-1)),t("button",{onClick:e[10]||(e[10]=r=>Z.value=!1),class:"text-gray-400 hover:text-gray-500"},e[87]||(e[87]=[t("svg",{class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),T.value?(a(),l("div",Xo,[t("p",Zo,n(T.value.content),1),t("p",ea,"Added by "+n(((s=T.value.user)==null?void 0:s.name)||"Unknown")+" on "+n(new Date(T.value.created_at).toLocaleDateString()),1)])):u("",!0),T.value?(a(),l("div",ta,[e[91]||(e[91]=t("h4",{class:"text-sm font-medium text-gray-700 mb-2"},"Replies",-1)),te.value?(a(),l("div",sa,e[89]||(e[89]=[t("p",{class:"text-gray-500 text-sm"},"Loading replies...",-1)]))):ee.value.length?(a(),l("div",oa,[(a(!0),l(j,null,D(ee.value,r=>{var c;return a(),l("div",{key:r.id,class:"p-2 bg-gray-50 rounded border-l-2 border-indigo-300"},[t("p",aa,n(r.content),1),t("p",la,"Replied by "+n(((c=r.user)==null?void 0:c.name)||"Unknown")+" on "+n(new Date(r.created_at).toLocaleDateString()),1)])}),128))])):(a(),l("div",na,e[90]||(e[90]=[t("p",{class:"text-gray-500 text-sm"},"No replies yet. Be the first to reply!",-1)])))])):u("",!0),t("div",ra,[e[92]||(e[92]=t("label",{for:"reply-content",class:"block text-sm font-medium text-gray-700 mb-1"},"Your Reply",-1)),h(t("textarea",{id:"reply-content","onUpdate:modelValue":e[11]||(e[11]=r=>L.value=r),class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full h-32",placeholder:"Enter your reply..."},null,512),[[$,L.value]]),R.value?(a(),l("p",ia,n(R.value),1)):u("",!0)]),t("div",da,[m(O,{onClick:e[12]||(e[12]=r=>Z.value=!1),class:"mr-2"},{default:g(()=>e[93]||(e[93]=[p("Cancel")])),_:1,__:[93]}),m(S,{onClick:Fe},{default:g(()=>e[94]||(e[94]=[p("Send Reply")])),_:1,__:[94]})])])]}),_:1},8,["show"]),m(K,{show:V.value,onClose:e[23]||(e[23]=s=>V.value=!1)},{default:g(()=>[t("div",ua,[t("div",ca,[t("h3",va,n(W.value?"Edit Task":"Add New Task"),1),t("button",{onClick:e[14]||(e[14]=s=>V.value=!1),class:"text-gray-400 hover:text-gray-500"},e[95]||(e[95]=[t("svg",{class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),t("form",{onSubmit:Me(it,["prevent"]),class:"space-y-4"},[t("div",null,[e[96]||(e[96]=t("label",{for:"task-name",class:"block text-sm font-medium text-gray-700"},"Task Name",-1)),h(t("input",{id:"task-name","onUpdate:modelValue":e[15]||(e[15]=s=>f.value.name=s),type:"text",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",placeholder:"Enter task name"},null,512),[[$,f.value.name]]),_.value.name?(a(),l("p",pa,n(_.value.name[0]),1)):u("",!0)]),t("div",null,[e[97]||(e[97]=t("label",{for:"task-description",class:"block text-sm font-medium text-gray-700"},"Description",-1)),h(t("textarea",{id:"task-description","onUpdate:modelValue":e[16]||(e[16]=s=>f.value.description=s),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",rows:"3",placeholder:"Enter task description"},null,512),[[$,f.value.description]]),_.value.description?(a(),l("p",ma,n(_.value.description[0]),1)):u("",!0)]),t("div",null,[e[99]||(e[99]=t("label",{for:"task-status",class:"block text-sm font-medium text-gray-700"},"Status",-1)),h(t("select",{id:"task-status","onUpdate:modelValue":e[17]||(e[17]=s=>f.value.status=s),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},e[98]||(e[98]=[t("option",{value:"To Do"},"To Do",-1),t("option",{value:"In Progress"},"In Progress",-1),t("option",{value:"Done"},"Done",-1),t("option",{value:"Blocked"},"Blocked",-1),t("option",{value:"Archived"},"Archived",-1)]),512),[[E,f.value.status]]),_.value.status?(a(),l("p",ga,n(_.value.status[0]),1)):u("",!0)]),t("div",null,[e[100]||(e[100]=t("label",{for:"task-due-date",class:"block text-sm font-medium text-gray-700"},"Due Date",-1)),h(t("input",{id:"task-due-date","onUpdate:modelValue":e[18]||(e[18]=s=>f.value.due_date=s),type:"date",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},null,512),[[$,f.value.due_date]]),_.value.due_date?(a(),l("p",fa,n(_.value.due_date[0]),1)):u("",!0)]),t("div",null,[e[102]||(e[102]=t("label",{for:"task-assigned-to",class:"block text-sm font-medium text-gray-700"},"Assigned To",-1)),h(t("select",{id:"task-assigned-to","onUpdate:modelValue":e[19]||(e[19]=s=>f.value.assigned_to_user_id=s),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},[e[101]||(e[101]=t("option",{value:null},"Unassigned",-1)),(a(!0),l(j,null,D(i.value.users,s=>(a(),l("option",{key:s.id,value:s.id},n(s.name),9,xa))),128))],512),[[E,f.value.assigned_to_user_id]]),_.value.assigned_to_user_id?(a(),l("p",ya,n(_.value.assigned_to_user_id[0]),1)):u("",!0)]),t("div",null,[e[104]||(e[104]=t("label",{for:"task-type",class:"block text-sm font-medium text-gray-700"},"Task Type",-1)),ue.value?(a(),l("div",_a,"Loading task types...")):h((a(),l("select",{key:1,id:"task-type","onUpdate:modelValue":e[20]||(e[20]=s=>f.value.task_type_id=s),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},[e[103]||(e[103]=t("option",{value:null},"Select a task type",-1)),(a(!0),l(j,null,D(ae.value,s=>(a(),l("option",{key:s.id,value:s.id},n(s.name),9,ba))),128))],512)),[[E,f.value.task_type_id]]),_.value.task_type_id?(a(),l("p",wa,n(_.value.task_type_id[0]),1)):u("",!0)]),t("div",null,[t("div",{class:"flex justify-between items-center"},[e[105]||(e[105]=t("label",{for:"task-milestone",class:"block text-sm font-medium text-gray-700"},"Milestone",-1)),t("button",{type:"button",onClick:et,class:"text-sm text-indigo-600 hover:text-indigo-800"}," + Create New Milestone ")]),le.value?(a(),l("div",ha,"Loading milestones...")):h((a(),l("select",{key:1,id:"task-milestone","onUpdate:modelValue":e[21]||(e[21]=s=>f.value.milestone_id=s),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},[e[106]||(e[106]=t("option",{value:null},"No milestone",-1)),(a(!0),l(j,null,D(C.value,s=>(a(),l("option",{key:s.id,value:s.id},n(s.name),9,ka))),128))],512)),[[E,f.value.milestone_id]]),_.value.milestone_id?(a(),l("p",ja,n(_.value.milestone_id[0]),1)):u("",!0)]),t("div",Da,[m(O,{onClick:e[22]||(e[22]=s=>V.value=!1)},{default:g(()=>e[107]||(e[107]=[p(" Cancel ")])),_:1,__:[107]}),m(S,{type:"submit",disabled:ue.value||le.value},{default:g(()=>[p(n(W.value?"Update Task":"Create Task"),1)]),_:1},8,["disabled"])])],32)])]),_:1},8,["show"]),m(K,{show:q.value,onClose:e[30]||(e[30]=s=>q.value=!1)},{default:g(()=>[t("div",Ca,[t("div",Ma,[e[109]||(e[109]=t("h3",{class:"text-lg font-semibold text-gray-900"},"Add New Milestone",-1)),t("button",{onClick:e[24]||(e[24]=s=>q.value=!1),class:"text-gray-400 hover:text-gray-500"},e[108]||(e[108]=[t("svg",{class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),t("form",{onSubmit:Me(tt,["prevent"]),class:"space-y-4"},[t("div",null,[e[110]||(e[110]=t("label",{for:"milestone-name",class:"block text-sm font-medium text-gray-700"},"Milestone Name",-1)),h(t("input",{id:"milestone-name","onUpdate:modelValue":e[25]||(e[25]=s=>N.value.name=s),type:"text",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",placeholder:"Enter milestone name"},null,512),[[$,N.value.name]]),M.value.name?(a(),l("p",Na,n(M.value.name[0]),1)):u("",!0)]),t("div",null,[e[111]||(e[111]=t("label",{for:"milestone-description",class:"block text-sm font-medium text-gray-700"},"Description",-1)),h(t("textarea",{id:"milestone-description","onUpdate:modelValue":e[26]||(e[26]=s=>N.value.description=s),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",rows:"3",placeholder:"Enter milestone description"},null,512),[[$,N.value.description]]),M.value.description?(a(),l("p",Ta,n(M.value.description[0]),1)):u("",!0)]),t("div",null,[e[112]||(e[112]=t("label",{for:"milestone-completion-date",class:"block text-sm font-medium text-gray-700"},"Completion Date",-1)),h(t("input",{id:"milestone-completion-date","onUpdate:modelValue":e[27]||(e[27]=s=>N.value.completion_date=s),type:"date",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},null,512),[[$,N.value.completion_date]]),M.value.completion_date?(a(),l("p",Pa,n(M.value.completion_date[0]),1)):u("",!0)]),t("div",null,[e[114]||(e[114]=t("label",{for:"milestone-status",class:"block text-sm font-medium text-gray-700"},"Status",-1)),h(t("select",{id:"milestone-status","onUpdate:modelValue":e[28]||(e[28]=s=>N.value.status=s),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},e[113]||(e[113]=[t("option",{value:"Not Started"},"Not Started",-1),t("option",{value:"In Progress"},"In Progress",-1),t("option",{value:"Completed"},"Completed",-1),t("option",{value:"Overdue"},"Overdue",-1)]),512),[[E,N.value.status]]),M.value.status?(a(),l("p",Ea,n(M.value.status[0]),1)):u("",!0)]),t("div",Aa,[m(O,{onClick:e[29]||(e[29]=s=>q.value=!1),type:"button"},{default:g(()=>e[115]||(e[115]=[p(" Cancel ")])),_:1,__:[115]}),m(S,{type:"submit",disabled:ve.value},{default:g(()=>[p(n(ve.value?"Creating...":"Create Milestone"),1)]),_:1},8,["disabled"])])],32)])]),_:1},8,["show"]),m(K,{show:H.value,onClose:e[34]||(e[34]=s=>H.value=!1)},{default:g(()=>[t("div",$a,[t("div",Sa,[e[117]||(e[117]=t("h3",{class:"text-lg font-semibold text-gray-900"},"Add Note to Task",-1)),t("button",{onClick:e[31]||(e[31]=s=>H.value=!1),class:"text-gray-400 hover:text-gray-500"},e[116]||(e[116]=[t("svg",{class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),G.value?(a(),l("div",Ra,[t("p",Ua,n(G.value.title),1),t("p",Va,"Status: "+n(G.value.status),1)])):u("",!0),t("div",Fa,[e[118]||(e[118]=t("label",{for:"task-note-content",class:"block text-sm font-medium text-gray-700 mb-1"},"Note Content",-1)),h(t("textarea",{id:"task-note-content","onUpdate:modelValue":e[32]||(e[32]=s=>z.value=s),class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full h-32",placeholder:"Enter your note..."},null,512),[[$,z.value]]),F.value?(a(),l("p",Oa,n(F.value),1)):u("",!0)]),t("div",Ia,[m(O,{onClick:e[33]||(e[33]=s=>H.value=!1),class:"mr-2"},{default:g(()=>e[119]||(e[119]=[p("Cancel")])),_:1,__:[119]}),m(S,{onClick:rt,disabled:ce.value},{default:g(()=>[p(n(ce.value?"Adding...":"Add Note"),1)]),_:1},8,["disabled"])])])]),_:1},8,["show"])]),_:1})],64))}},el=jt(La,[["__scopeId","data-v-9cf2bedc"]]);export{el as default};
