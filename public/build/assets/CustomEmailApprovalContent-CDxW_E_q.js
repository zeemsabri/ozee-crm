import{r as n,c as E,e as k,a as u,o as c,b as r,i as $,d as o,u as b,w as v,m as y,j as _,x as S,p}from"./app-DISKht3j.js";import{_ as j}from"./InputLabel-Z506aO7S.js";import{_ as B}from"./TextInput-pYzuy-6l.js";import{_ as A}from"./EmailEditor-DuRc-lD-.js";import{_ as x}from"./InputError-C6KY5JMQ.js";import{P as N}from"./PrimaryButton-angFb9vz.js";import{_ as M}from"./SecondaryButton-CVp2-APy.js";import{u as R}from"./useEmailSignature-wgWI-PWG.js";import{_ as T}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./EmailEditor.vue_vue_type_style_index_0_lang-BfTJQqtk.js";const q={key:0,class:"flex justify-center py-8"},H={key:1,class:"p-4 space-y-6"},L={class:"mb-4"},P={class:"mb-6"},U=["innerHTML"],z={class:"flex items-center justify-end space-x-2"},D={__name:"CustomEmailApprovalContent",props:{email:{type:Object,required:!0}},emits:["submitted","error"],setup(g,{emit:V}){const l=g,i=V,m=n(!1),t=n(!1),s=n({subject:"",body:""}),{userSignature:f}=R(E(()=>({}))),h=async()=>{var a;if((a=l.email)!=null&&a.id){m.value=!0;try{const{data:e}=await p.get(`/api/emails/${l.email.id}/edit-content`);s.value.subject=e.subject,s.value.body=e.body_html||e.body}catch(e){console.error("Failed to load email content",e),i("error",e)}finally{m.value=!1}}},w=async()=>{t.value=!0;try{await p.post(`/api/emails/${l.email.id}/edit-and-approve`,{subject:s.value.subject,body:s.value.body,composition_type:"custom"}),i("submitted")}catch(a){console.error("Approve custom email failed",a),i("error",a)}finally{t.value=!1}},C=async()=>{t.value=!0;try{await p.post(`/api/emails/${l.email.id}/reject`,{rejection_reason:"Rejected by approver."}),i("submitted")}catch(a){console.error("Reject custom email failed",a),i("error",a)}finally{t.value=!1}};return k(()=>l.email,a=>{a&&h()},{immediate:!0}),(a,e)=>m.value?(c(),u("div",q,e[3]||(e[3]=[r("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-500"},null,-1)]))):(c(),u("div",H,[r("form",{onSubmit:e[2]||(e[2]=S(()=>{},["prevent"]))},[r("div",L,[o(j,{for:"subject",value:"Subject"}),o(B,{id:"subject",type:"text",class:"mt-1 block w-full",modelValue:s.value.subject,"onUpdate:modelValue":e[0]||(e[0]=d=>s.value.subject=d),required:""},null,8,["modelValue"]),o(x,{message:"",class:"mt-2"})]),r("div",P,[o(j,{for:"body",value:"Email Body",class:"sr-only"}),o(A,{id:"body",modelValue:s.value.body,"onUpdate:modelValue":e[1]||(e[1]=d=>s.value.body=d),placeholder:"Edit the email here...",height:"300px"},null,8,["modelValue"]),o(x,{message:"",class:"mt-2"})]),b(f)?(c(),u("div",{key:0,class:"unselectable-signature",innerHTML:b(f)},null,8,U)):$("",!0),r("div",z,[o(N,{onClick:w,class:_({"opacity-25":t.value}),disabled:t.value},{default:v(()=>e[4]||(e[4]=[y(" Approve & Send ",-1)])),_:1,__:[4]},8,["class","disabled"]),o(M,{onClick:C,class:_({"opacity-25":t.value}),disabled:t.value},{default:v(()=>e[5]||(e[5]=[y(" Reject ",-1)])),_:1,__:[5]},8,["class","disabled"])])],32)]))}},Z=T(D,[["__scopeId","data-v-c3d683bb"]]);export{Z as default};
