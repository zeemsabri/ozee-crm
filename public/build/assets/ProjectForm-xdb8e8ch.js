import{p as de,r as P,G as O,I as be,e as oe,f as me,a as i,o,b as e,m as E,i as x,d as l,t as S,x as he,y as qe,g as ae,w as Y,j as Q,M as le,c as G,F as ue,l as ce,C as je,L as lt,z as Re,H as ot,N as nt,n as $e,q as Se,u as $,K as Ke,A as rt,aA as it,aM as dt,aN as ut,aO as ct,aq as mt}from"./app-xFH-vidZ.js";import{_ as N}from"./InputLabel-B0D1IcDX.js";import{_ as K}from"./TextInput-C0TquR8Q.js";import{_ as R}from"./InputError-BC2JeK_g.js";import{P as ne}from"./PrimaryButton-DoyOJoK6.js";import{S as ee}from"./SelectDropdown-B0cQ2vqK.js";import{T as vt,k as pt,l as gt,m as yt}from"./AuthenticatedLayout-j0gebZ0E.js";import{P as ft,_ as bt}from"./ProjectTypeInput-za4-8BHG.js";import{_ as fe}from"./SecondaryButton-BwwSbQ2J.js";import{D as wt}from"./DangerButton-CBvJNjBM.js";import{_ as xt}from"./Modal-DgcPS0D-.js";import{_ as ht}from"./Checkbox-92eAi9T-.js";import{_ as _t}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{a as se,c as ye,d as He,f as Z,b as Ve}from"./currency-D_cZX3mX.js";const kt=P([]),jt=P([]),Ee=P([]),Oe=P([]),Fe=async t=>{try{const w=(await de.get(`/api/roles?type=${t}`)).data.map(v=>({value:v.id,label:v.name}));return t==="client"?kt.value=w:t==="project"&&(jt.value=w),w}catch(b){return console.error(`Error fetching ${t} roles:`,b),O(`Failed to load ${t} roles. Please refresh the page.`),[]}},Pt=async(t,b)=>{try{let a;return b&&!t||t&&(a=await window.axios.get("/api/clients"),Ee.value=a.data.data||a.data),Ee.value}catch(a){return console.error("Error fetching clients:",a),O("Failed to load clients. Please try again."),[]}},$t=async(t,b)=>{try{let a;return b&&!t||t&&(a=await window.axios.get("/api/users"),Oe.value=a.data),Oe.value}catch(a){return console.error("Error fetching users:",a),O("Failed to load users. Please try again."),[]}},Pe=async(t,b,a)=>{let w="",v=null;try{switch(b){case"basic":w=`/api/projects/${t}/sections/basic`;break;case"client":(a.canViewProjectClients||a.canManageProjectClients||a.canViewProjectUsers||a.canManageProjectUsers)&&(w=`/api/projects/${t}/sections/clients-users`);break;case"services":(a.canViewProjectServicesAndPayments||a.canManageProjectServicesAndPayments)&&(w=`/api/projects/${t}/sections/services-payment`);break;case"documents":a.canViewProjectDocuments&&(w=`/api/projects/${t}/sections/documents`);break;case"notes":(a.canViewProjectNotes||a.canAddProjectNotes)&&(w=`/api/projects/${t}/sections/notes?type=private`);break;case"transactions":return null;default:return console.warn(`Attempted to fetch data for unknown tab: ${b}`),null}return w&&(v=(await window.axios.get(w)).data),v}catch(_){throw console.error(`Error fetching data for tab '${b}':`,_),O(`Failed to load data for ${b} section. Please try again.`),_}},Vt={class:"space-y-6 bg-white p-6 rounded-lg border border-gray-100 font-inter"},St={key:0,class:"text-center py-8 text-gray-500 text-lg"},Ct={key:1,class:"grid grid-cols-1 md:grid-cols-2 gap-6"},It={key:0},Dt={key:1},Ut={key:0,class:"mt-1 text-xs text-gray-500"},Mt={key:2},At=["disabled"],Nt={key:0,class:"mt-2"},Tt=["src"],Bt={class:"mt-6"},Rt=["disabled"],Et={class:"mt-6"},Ot={class:"mt-6"},Ft={class:"mt-6"},Lt={class:"mt-6 flex justify-end"},zt={key:0,class:"flex items-center"},qt={key:1},Kt={__name:"ProjectEditBasicInfo",props:{projectId:{type:[Number,String],required:!0},errors:{type:Object,default:()=>({})},statusOptions:{type:Array,required:!0,default:()=>[{value:"active",label:"Active"},{value:"completed",label:"Completed"},{value:"paid",label:"Paid"},{value:"on_hold",label:"On-hold"}]},sourceOptions:{type:Array,required:!0},canManageProjects:{type:Boolean,default:!1},canManageProjectBasicDetails:{type:Boolean,default:!1},isSaving:{type:Boolean,default:!1}},setup(t){const b=t,a=be({id:null,name:"",description:"",website:"",social_media_link:"",preferred_keywords:"",reporting_sites:"",google_chat_id:"",google_drive_link:"",logo:null,status:"active",project_type:"",source:"",tags:[],tags_data:[],timezone:null,project_tier_id:null,profit_margin_percentage:null}),w=P(!1),v=P(!0),_=P([]),U=async()=>{try{const r=await window.axios.get("/api/project-tiers");_.value=r.data}catch(r){console.error("Error fetching project tiers:",r),O("Failed to load project tiers.")}},M=r=>{const s=r.target.files[0];s?a.logo=s:a.logo=null},D=async()=>{w.value=!0;const r=new FormData,s=["id","tags","tags_data","logo"];if(a.project_tier_id!==null&&a.project_tier_id!==void 0){const n=String(a.project_tier_id);r.append("project_tier_id",n),console.log("Added project_tier_id:",n,"type:",typeof n)}else console.log("project_tier_id is null or undefined:",a.project_tier_id);a.profit_margin_percentage!==null&&a.profit_margin_percentage!==void 0&&(r.append("profit_margin_percentage",a.profit_margin_percentage),console.log("Added profit_margin_percentage:",a.profit_margin_percentage));for(const n in a)!s.includes(n)&&n!=="project_tier_id"&&n!=="profit_margin_percentage"&&a[n]!==null&&a[n]!==void 0&&r.append(n,a[n]);Array.isArray(a.tags)&&a.tags.forEach(n=>{const j=typeof n=="object"&&n!==null&&n.id?n.id:n;j!=null&&r.append("tags[]",j)}),a.logo instanceof File&&r.append("logo",a.logo),r.append("_method","PUT"),console.log("Form data contents:");for(let[n,j]of r.entries())console.log(`${n}: ${j}`);try{const n=await window.axios.post(`/api/projects/${b.projectId}/sections/basic`,r,{headers:{"Content-Type":"multipart/form-data"}});le("Project basic information updated successfully!"),n.data&&Object.assign(a,{name:n.data.name||a.name,description:n.data.description||a.description,website:n.data.website||a.website,social_media_link:n.data.social_media_link||a.social_media_link,preferred_keywords:n.data.preferred_keywords||a.preferred_keywords,reporting_sites:n.data.reporting_sites||a.reporting_sites,google_chat_id:n.data.google_chat_id||a.google_chat_id,google_drive_link:n.data.google_drive_link||a.google_drive_link,logo:n.data.logo||a.logo,status:n.data.status||a.status,project_type:n.data.project_type||a.project_type,source:n.data.source||a.source,tags:n.data.tags||a.tags,tags_data:n.data.tags_data||a.tags_data,timezone:n.data.timezone||a.timezone,project_tier_id:n.data.project_tier_id||a.project_tier_id,profit_margin_percentage:n.data.profit_margin_percentage||a.profit_margin_percentage})}catch(n){console.error("Error saving basic info:",n);let j="Failed to save basic information.";n.response&&n.response.data&&n.response.data.message&&(j=n.response.data.message),O(j)}finally{w.value=!1}},g=async()=>{if(!b.projectId){v.value=!1;return}v.value=!0;try{const r=await Pe(b.projectId,"basic",{});r&&Object.assign(a,{id:r.id||b.projectId,name:r.name||"",description:r.description||"",website:r.website||"",social_media_link:r.social_media_link||"",preferred_keywords:r.preferred_keywords||"",reporting_sites:r.reporting_sites||"",google_chat_id:r.google_chat_id||"",google_drive_link:r.google_drive_link||"",logo:r.logo||null,status:r.status||"active",project_type:r.project_type||"",source:r.source||"",tags:r.tags||[],tags_data:r.tags_data||[],timezone:r.timezone||null,project_tier_id:r.project_tier_id||null,profit_margin_percentage:r.profit_margin_percentage||null})}catch(r){console.error("Error fetching basic info:",r),O("Failed to load basic project information.")}finally{v.value=!1}};return oe(()=>b.projectId,async r=>{setTimeout(async()=>{r&&await g()},500)},{immediate:!0}),oe(()=>a.project_tier_id,r=>{console.log("project_tier_id changed:",r,"type:",typeof r)}),me(()=>{U()}),(r,s)=>(o(),i("div",Vt,[v.value?(o(),i("div",St,s[16]||(s[16]=[e("svg",{class:"animate-spin h-8 w-8 text-indigo-500 mx-auto mb-3",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),E(" Loading basic project information... ",-1)]))):(o(),i("div",Ct,[e("div",null,[l(N,{for:"name",value:"Project Name"}),l(K,{id:"name",type:"text",class:"mt-1 block w-full rounded-lg shadow-sm",modelValue:a.name,"onUpdate:modelValue":s[0]||(s[0]=n=>a.name=n),required:"",autofocus:"",disabled:!t.canManageProjects||w.value||t.isSaving},null,8,["modelValue","disabled"]),l(R,{message:t.errors.name?t.errors.name[0]:"",class:"mt-2"},null,8,["message"])]),e("div",null,[l(N,{for:"website",value:"Website"}),l(K,{id:"website",type:"url",class:"mt-1 block w-full rounded-lg shadow-sm",modelValue:a.website,"onUpdate:modelValue":s[1]||(s[1]=n=>a.website=n),disabled:!t.canManageProjects||w.value||t.isSaving},null,8,["modelValue","disabled"]),l(R,{message:t.errors.website?t.errors.website[0]:"",class:"mt-2"},null,8,["message"])]),e("div",null,[l(N,{for:"social_media_link",value:"Social Media Link"}),l(K,{id:"social_media_link",type:"url",class:"mt-1 block w-full rounded-lg shadow-sm",modelValue:a.social_media_link,"onUpdate:modelValue":s[2]||(s[2]=n=>a.social_media_link=n),disabled:!t.canManageProjects||w.value||t.isSaving},null,8,["modelValue","disabled"]),l(R,{message:t.errors.social_media_link?t.errors.social_media_link[0]:"",class:"mt-2"},null,8,["message"])]),t.canManageProjectBasicDetails?(o(),i("div",It,[l(N,{for:"google_chat_id",value:"Google Chat ID"}),l(K,{id:"google_chat_id",type:"text",class:"mt-1 block w-full rounded-lg shadow-sm",modelValue:a.google_chat_id,"onUpdate:modelValue":s[3]||(s[3]=n=>a.google_chat_id=n),disabled:!t.canManageProjects||w.value||t.isSaving},null,8,["modelValue","disabled"]),l(R,{message:t.errors.google_chat_id?t.errors.google_chat_id[0]:"",class:"mt-2"},null,8,["message"])])):x("",!0),t.canManageProjectBasicDetails?(o(),i("div",Dt,[l(N,{for:"google_drive_link",value:"Google Drive Link"}),l(K,{id:"google_drive_link",type:"text",class:"mt-1 block w-full rounded-lg shadow-sm",modelValue:a.google_drive_link,"onUpdate:modelValue":s[4]||(s[4]=n=>a.google_drive_link=n),disabled:!t.canManageProjects||w.value||t.isSaving},null,8,["modelValue","disabled"]),l(R,{message:t.errors.google_drive_link?t.errors.google_drive_link[0]:"",class:"mt-2"},null,8,["message"])])):x("",!0),e("div",null,[l(N,{for:"status",value:"Status"}),l(ee,{id:"status",modelValue:a.status,"onUpdate:modelValue":s[5]||(s[5]=n=>a.status=n),options:t.statusOptions,valueKey:"value",labelKey:"label",placeholder:"Select Project Status",disabled:!t.canManageProjects||w.value||t.isSaving,required:!0,class:"mt-1 block w-full"},null,8,["modelValue","options","disabled"]),l(R,{message:t.errors.status?t.errors.status[0]:"",class:"mt-2"},null,8,["message"])]),e("div",null,[l(ft,{id:"project_type",modelValue:a.project_type,"onUpdate:modelValue":s[6]||(s[6]=n=>a.project_type=n),disabled:!t.canManageProjects||w.value||t.isSaving,class:"mt-1 block w-full"},null,8,["modelValue","disabled"]),l(R,{message:t.errors.project_type?t.errors.project_type[0]:"",class:"mt-2"},null,8,["message"])]),e("div",null,[l(N,{for:"source",value:"Source"}),l(ee,{id:"source",modelValue:a.source,"onUpdate:modelValue":s[7]||(s[7]=n=>a.source=n),options:t.sourceOptions,valueKey:"value",labelKey:"label",placeholder:"Select a Source",disabled:!t.canManageProjects||w.value||t.isSaving,class:"mt-1 block w-full"},null,8,["modelValue","options","disabled"]),l(R,{message:t.errors.source?t.errors.source[0]:"",class:"mt-2"},null,8,["message"])]),e("div",null,[l(bt,{id:"timezone",modelValue:a.timezone,"onUpdate:modelValue":s[8]||(s[8]=n=>a.timezone=n),disabled:!t.canManageProjects||w.value||t.isSaving,class:"mt-1 block w-full"},null,8,["modelValue","disabled"]),l(R,{message:t.errors.timezone?t.errors.timezone[0]:"",class:"mt-2"},null,8,["message"])]),e("div",null,[l(N,{for:"project_tier_id",value:"Project Tier"}),l(ee,{id:"project_tier_id",modelValue:a.project_tier_id,"onUpdate:modelValue":s[9]||(s[9]=n=>a.project_tier_id=n),options:_.value,valueKey:"id",labelKey:"name",placeholder:"Select Project Tier",disabled:!t.canManageProjects||w.value||t.isSaving,class:"mt-1 block w-full",onChange:s[10]||(s[10]=n=>console.log("SelectDropdown change event:",n))},null,8,["modelValue","options","disabled"]),l(R,{message:t.errors.project_tier_id?t.errors.project_tier_id[0]:"",class:"mt-2"},null,8,["message"]),a.project_tier_id?(o(),i("div",Ut," Selected tier ID: "+S(a.project_tier_id)+" ("+S(typeof a.project_tier_id)+") ",1)):x("",!0)]),e("div",null,[l(N,{for:"profit_margin_percentage",value:"Profit Margin (%)"}),l(K,{id:"profit_margin_percentage",type:"number",step:"0.01",min:"0",max:"100",class:"mt-1 block w-full rounded-lg shadow-sm",modelValue:a.profit_margin_percentage,"onUpdate:modelValue":s[11]||(s[11]=n=>a.profit_margin_percentage=n),disabled:!t.canManageProjects||w.value||t.isSaving},null,8,["modelValue","disabled"]),l(R,{message:t.errors.profit_margin_percentage?t.errors.profit_margin_percentage[0]:"",class:"mt-2"},null,8,["message"])]),t.canManageProjectBasicDetails?(o(),i("div",Mt,[l(N,{for:"logo",value:"Project Logo"}),e("input",{type:"file",id:"logo",onChange:M,class:"mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100 cursor-pointer",accept:"image/*",disabled:!t.canManageProjectBasicDetails||w.value||t.isSaving},null,40,At),a.logo&&typeof a.logo=="string"?(o(),i("div",Nt,[s[17]||(s[17]=e("p",{class:"text-sm text-gray-600"},"Current Logo:",-1)),e("img",{src:a.logo,alt:"Project Logo",class:"h-20 w-20 object-contain rounded-lg shadow-md border border-gray-200"},null,8,Tt)])):x("",!0),l(R,{message:t.errors.logo?t.errors.logo[0]:"",class:"mt-2"},null,8,["message"])])):x("",!0)])),e("div",Bt,[l(N,{for:"description",value:"Description"}),he(e("textarea",{id:"description",class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-lg shadow-sm mt-1 block w-full","onUpdate:modelValue":s[12]||(s[12]=n=>a.description=n),disabled:!t.canManageProjects||w.value||t.isSaving,rows:"4"},null,8,Rt),[[qe,a.description]]),l(R,{message:t.errors.description?t.errors.description[0]:"",class:"mt-2"},null,8,["message"])]),e("div",Et,[l(N,{for:"preferred_keywords",value:"Client Preferred Keywords"}),l(K,{id:"preferred_keywords",type:"text",class:"mt-1 block w-full rounded-lg shadow-sm",modelValue:a.preferred_keywords,"onUpdate:modelValue":s[13]||(s[13]=n=>a.preferred_keywords=n),disabled:!t.canManageProjects||w.value||t.isSaving},null,8,["modelValue","disabled"]),l(R,{message:t.errors.preferred_keywords?t.errors.preferred_keywords[0]:"",class:"mt-2"},null,8,["message"])]),e("div",Ot,[l(N,{for:"reporting_sites",value:"Reporting Sites (comma separated)"}),l(K,{id:"reporting_sites",type:"text",class:"mt-1 block w-full rounded-lg shadow-sm",placeholder:"e.g. ahrefs.com, semrush.com, analytics.google.com",modelValue:a.reporting_sites,"onUpdate:modelValue":s[14]||(s[14]=n=>a.reporting_sites=n),disabled:!t.canManageProjects||w.value||t.isSaving},null,8,["modelValue","disabled"]),s[18]||(s[18]=e("p",{class:"mt-1 text-xs text-gray-500"},"Enter multiple site URLs separated by commas.",-1)),l(R,{message:t.errors.reporting_sites?t.errors.reporting_sites[0]:"",class:"mt-2"},null,8,["message"])]),e("div",Ft,[l(vt,{modelValue:a.tags,"onUpdate:modelValue":s[15]||(s[15]=n=>a.tags=n),initialTags:a.tags_data,label:"Associated Tags",placeholder:"Search or add tags",error:t.errors.tags?t.errors.tags[0]:"",disabled:!t.canManageProjects||w.value||t.isSaving},null,8,["modelValue","initialTags","error","disabled"])]),e("div",Lt,[t.canManageProjectBasicDetails?(o(),ae(ne,{key:0,onClick:D,disabled:!t.canManageProjects||w.value||t.isSaving,class:Q([{"opacity-50 cursor-not-allowed":w.value||t.isSaving},"px-6 py-2 rounded-lg text-base shadow-md hover:shadow-lg transition-all"])},{default:Y(()=>[w.value||t.isSaving?(o(),i("span",zt,s[19]||(s[19]=[e("svg",{class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),E(" Updating... ",-1)]))):(o(),i("span",qt," Update Basic Information "))]),_:1},8,["disabled","class"])):x("",!0)])]))}},Ht={class:"mb-4"},Gt={class:"mt-2"},Yt={key:0,class:"text-gray-500 text-sm mb-2"},Wt={class:"mb-4"},Jt={key:1,class:"space-y-3"},Xt={class:"flex-grow text-gray-800 font-medium"},Qt={class:"text-gray-600 text-sm"},Zt={class:"flex items-center space-x-2"},ea=["onClick"],ta={key:2,class:"p-4 bg-gray-50 rounded-lg text-gray-600 text-center border border-dashed border-gray-200"},Le={__name:"MultiSelectWithRoles",props:{label:{type:String,required:!0},items:{type:Array,default:()=>[]},endpoint:{type:String,default:""},selectedItems:{type:Array,default:()=>[]},itemText:{type:String,default:"name"},itemSubtext:{type:String,default:"email"},itemValue:{type:String,default:"id"},roleOptions:{type:Array,default:()=>[]},roleType:{type:String,default:"application"},defaultRoleId:{type:Number,default:null},error:{type:String,default:""},placeholder:{type:String,default:"Select an item"},showRemoveButton:{type:Boolean,default:!0},disabled:{type:Boolean,default:!1}},emits:["update:selectedItems"],setup(t,{emit:b}){const a=t,w=b,v=P([]),_=P([]),U=P([]),M=P([]),D=P(!1),g=async()=>{if(!(a.roleOptions.length>0))try{const y=(await de.get(`/api/roles?type=${a.roleType}`)).data;U.value=y.map(f=>({value:f.id,label:f.name}))}catch(c){console.error("Error fetching roles:",c)}},r=G(()=>U.value.length>0?U.value:a.roleOptions),s=()=>a.defaultRoleId?a.defaultRoleId:r.value.length>0?r.value[0].value:1,n=()=>{v.value=[],_.value=[],!(!a.selectedItems||a.selectedItems.length===0)&&a.selectedItems.forEach(c=>{const y=typeof c=="object"?c[a.itemValue]:c,f=typeof c=="object"&&c.role_id!==void 0?c.role_id:s();if(!v.value.includes(y))v.value.push(y),_.value.push({id:y,role_id:f});else{const F=_.value.find(B=>B.id===y);F&&F.role_id!==f&&(F.role_id=f)}})};oe(()=>a.selectedItems,(c,y)=>{JSON.stringify(c)!==JSON.stringify(y)&&n()},{deep:!0,immediate:!0}),oe(_,c=>{w("update:selectedItems",c)},{deep:!0});const j=c=>{a.disabled||c&&!v.value.includes(c)&&(v.value.push(c),_.value.push({id:c,role_id:s()}))},T=c=>{a.disabled||(v.value=v.value.filter(y=>y!==c),_.value=_.value.filter(y=>y.id!==c))},W=(c,y)=>{if(a.disabled)return;const f=_.value.find(F=>F.id===c);f&&(f.role_id=parseInt(y))},J=c=>h.value.find(y=>y[a.itemValue]===c),k=c=>{const y=_.value.find(f=>f.id===c);return y?y.role_id:s()},p=async()=>{if(a.endpoint){D.value=!0;try{const c=await de.get(a.endpoint);c.data&&Array.isArray(c.data)?M.value=c.data:c.data&&c.data.data&&Array.isArray(c.data.data)&&(M.value=c.data.data)}catch(c){console.error("Error fetching items from endpoint:",c)}finally{D.value=!1}}},h=G(()=>a.endpoint&&M.value.length>0?M.value:a.items),L=G(()=>h.value.filter(c=>!v.value.includes(c[a.itemValue])).map(c=>({value:c[a.itemValue],label:`${c[a.itemText]} (${c[a.itemSubtext]})`})));return me(()=>{g(),a.endpoint&&p()}),(c,y)=>(o(),i("div",Ht,[l(N,{value:t.label},null,8,["value"]),e("div",Gt,[D.value?(o(),i("div",Yt,"Loading available items...")):x("",!0),e("div",Wt,[l(ee,{modelValue:c.selectedItemToAdd,"onUpdate:modelValue":y[0]||(y[0]=f=>c.selectedItemToAdd=f),options:L.value,valueKey:"value",labelKey:"label",placeholder:t.placeholder,disabled:D.value||t.disabled,onChange:j,class:"w-full"},null,8,["modelValue","options","placeholder","disabled"])]),v.value.length>0?(o(),i("div",Jt,[(o(!0),i(ue,null,ce(v.value,f=>{var F,B;return o(),i("div",{key:f,class:"flex items-center p-3 border border-gray-200 rounded-lg bg-gray-50 shadow-sm"},[e("div",Xt,[E(S((F=J(f))==null?void 0:F[t.itemText])+" ",1),e("span",Qt,"("+S((B=J(f))==null?void 0:B[t.itemSubtext])+")",1)]),e("div",Zt,[l(ee,{modelValue:k(f),"onUpdate:modelValue":C=>W(f,C),options:r.value,valueKey:"value",labelKey:"label",placeholder:"Select Role",disabled:t.disabled,class:"w-32"},null,8,["modelValue","onUpdate:modelValue","options","disabled"]),t.showRemoveButton&&!t.disabled?(o(),i("button",{key:0,type:"button",class:"text-red-500 hover:text-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 rounded-full p-1 transition-colors duration-200",onClick:C=>T(f),"aria-label":"Remove item"},y[1]||(y[1]=[e("svg",{class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]),8,ea)):x("",!0)])])}),128))])):(o(),i("div",ta," No "+S(t.label.toLowerCase())+" selected. ",1))]),l(R,{message:t.error,class:"mt-2"},null,8,["message"])]))}},aa={class:"space-y-8"},sa={key:0,class:"bg-gray-50 p-6 rounded-lg shadow-inner border border-gray-200"},la={key:0,class:"mt-6 flex justify-end"},oa={key:0},na={key:1},ra={key:1,class:"mt-3 text-green-600 text-sm flex items-center"},ia={key:2,class:"mt-3 text-red-600 text-sm flex items-center"},da={key:1,class:"bg-gray-50 p-6 rounded-lg shadow-inner border border-gray-200"},ua={key:0,class:"mt-6 flex justify-end"},ca={key:0},ma={key:1},va={key:1,class:"mt-3 text-green-600 text-sm flex items-center"},pa={key:2,class:"mt-3 text-red-600 text-sm flex items-center"},ga={__name:"ProjectFormClientsUsers",props:{projectId:{type:[Number,String],required:!0},errors:{type:Object,default:()=>({})},clientRoleOptions:{type:Array,default:()=>[]},userRoleOptions:{type:Array,default:()=>[]},clients:{type:Array,default:()=>[]},users:{type:Array,default:()=>[]},canViewProjectClients:{type:Boolean,default:!1},canManageProjectClients:{type:Boolean,default:!1},canViewProjectUsers:{type:Boolean,default:!1},canManageProjectUsers:{type:Boolean,default:!1},isSaving:{type:Boolean,default:!1}},setup(t){const b=t,a=be({client_ids:[],user_ids:[],contract_details:""}),w=P(!1),v=P(!1),_=P(""),U=P(!1),M=P(!1),D=P(""),g=async()=>{if(b.projectId)try{const n=await Pe(b.projectId,"client",{canViewProjectClients:b.canViewProjectClients,canManageProjectClients:b.canManageProjectClients,canViewProjectUsers:b.canViewProjectUsers,canManageProjectUsers:b.canManageProjectUsers});n&&(a.client_ids=n.clients?n.clients.map(j=>{var T;return{id:j.id,role_id:((T=j.pivot)==null?void 0:T.role_id)||(b.clientRoleOptions.length>0?b.clientRoleOptions[0].value:null)}}):[],a.user_ids=n.users?n.users.map(j=>{var T;return{id:j.id,role_id:((T=j.pivot)==null?void 0:T.role_id)||(b.userRoleOptions.length>0?b.userRoleOptions[0].value:null)}}):[],a.contract_details=n.contract_details||"")}catch(n){console.error("Error fetching clients/users data:",n),O("Failed to load clients and users data.")}};oe(()=>b.projectId,async n=>{n&&await g()},{immediate:!0});const r=async()=>{var n,j;if(!b.projectId){O("Project ID is missing. Cannot save clients.");return}if(!a.client_ids||a.client_ids.length===0){O("Please select at least one client to save.");return}w.value=!0,v.value=!1,_.value="";try{await window.axios.post(`/api/projects/${b.projectId}/attach-clients`,{client_ids:a.client_ids}),le("Clients saved successfully!"),v.value=!0,await g()}catch(T){console.error("Error saving clients:",T),_.value=((j=(n=T.response)==null?void 0:n.data)==null?void 0:j.message)||"Failed to save clients.",O(_.value)}finally{w.value=!1,setTimeout(()=>v.value=!1,3e3)}},s=async()=>{var n,j;if(!b.projectId){O("Project ID is missing. Cannot save users.");return}if(!a.user_ids||a.user_ids.length===0){O("Please select at least one user to save.");return}U.value=!0,M.value=!1,D.value="";try{await window.axios.post(`/api/projects/${b.projectId}/attach-users`,{user_ids:a.user_ids}),le("Users saved successfully!"),M.value=!0,await g()}catch(T){console.error("Error saving users:",T),D.value=((j=(n=T.response)==null?void 0:n.data)==null?void 0:j.message)||"Failed to save users.",O(D.value)}finally{U.value=!1,setTimeout(()=>M.value=!1,3e3)}};return me(()=>{}),(n,j)=>(o(),i("div",aa,[t.canViewProjectClients?(o(),i("div",sa,[j[4]||(j[4]=e("h3",{class:"text-xl font-semibold text-gray-800 mb-5"},"Project Clients",-1)),l(Le,{label:"Select Clients",items:t.clients,selectedItems:a.client_ids,"onUpdate:selectedItems":j[0]||(j[0]=T=>a.client_ids=T),roleOptions:t.clientRoleOptions,roleType:"client",error:t.errors.client_ids?t.errors.client_ids[0]:"",placeholder:"Search and select clients to add",disabled:!t.canManageProjectClients||t.isSaving||w.value,readonly:!t.canManageProjectClients&&t.canViewProjectClients,showRemoveButton:t.canManageProjectClients,class:"mb-4"},null,8,["items","selectedItems","roleOptions","error","disabled","readonly","showRemoveButton"]),t.canManageProjectClients?(o(),i("div",la,[l(ne,{onClick:r,disabled:w.value||t.isSaving,class:"px-6 py-3 rounded-lg text-lg shadow-md hover:shadow-lg transition-all duration-200"},{default:Y(()=>[w.value?(o(),i("span",oa,"Saving Clients...")):(o(),i("span",na,"Save Clients"))]),_:1},8,["disabled"])])):x("",!0),v.value?(o(),i("div",ra,j[2]||(j[2]=[e("svg",{class:"h-5 w-5 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1),E(" Clients saved successfully! ",-1)]))):x("",!0),_.value?(o(),i("div",ia,[j[3]||(j[3]=e("svg",{class:"h-5 w-5 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),E(" "+S(_.value),1)])):x("",!0)])):x("",!0),t.canViewProjectUsers?(o(),i("div",da,[j[7]||(j[7]=e("h3",{class:"text-xl font-semibold text-gray-800 mb-5"},"Assign Project Users",-1)),l(Le,{label:"Assign Users",items:t.users,selectedItems:a.user_ids,"onUpdate:selectedItems":j[1]||(j[1]=T=>a.user_ids=T),roleOptions:t.userRoleOptions,roleType:"project",defaultRoleId:2,error:t.errors.user_ids?t.errors.user_ids[0]:"",placeholder:"Search and assign users to this project",disabled:!t.canManageProjectUsers||t.isSaving||U.value,readonly:!t.canManageProjectUsers&&t.canViewProjectUsers,showRemoveButton:t.canManageProjectUsers,class:"mb-4"},null,8,["items","selectedItems","roleOptions","error","disabled","readonly","showRemoveButton"]),t.canManageProjectUsers?(o(),i("div",ua,[l(ne,{onClick:s,disabled:U.value||t.isSaving,class:"px-6 py-3 rounded-lg text-lg shadow-md hover:shadow-lg transition-all duration-200"},{default:Y(()=>[U.value?(o(),i("span",ca,"Saving Users...")):(o(),i("span",ma,"Save Users"))]),_:1},8,["disabled"])])):x("",!0),M.value?(o(),i("div",va,j[5]||(j[5]=[e("svg",{class:"h-5 w-5 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1),E(" Users saved successfully! ",-1)]))):x("",!0),D.value?(o(),i("div",pa,[j[6]||(j[6]=e("svg",{class:"h-5 w-5 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),E(" "+S(D.value),1)])):x("",!0)])):x("",!0)]))}},ya={class:"space-y-6"},fa={key:0,class:"bg-gray-50 p-6 rounded-lg shadow-inner border border-gray-200"},ba={class:"mt-6"},wa={key:0},xa={key:1},ha={key:0,class:"text-sm text-red-500 mt-3"},_a={key:1,class:"mt-8 bg-white p-6 rounded-lg shadow-md border border-gray-200"},ka={class:"space-y-3"},ja={class:"flex items-center"},Pa={class:"mr-3 text-indigo-500"},$a={key:0,class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},Va={key:1,class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},Sa={key:2,class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},Ca={key:3,class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},Ia=["href"],Da={key:1,class:"text-gray-700 font-medium break-all mr-4"},Ua=["onClick","disabled"],Ma={key:2,class:"p-6 bg-gray-50 rounded-lg text-gray-600 text-center border border-gray-200 shadow-sm"},Aa={__name:"ProjectFormDocuments",props:{projectId:{type:[Number,String],required:!0},errors:{type:Object,default:()=>({})},canUploadProjectDocuments:{type:Boolean,default:!1},canViewProjectDocuments:{type:Boolean,default:!1},isSaving:{type:Boolean,default:!1}},setup(t){const b=t,a=be({documents:[]}),w=P(null),v=P(!1),_=async()=>{if(b.projectId)try{const g=await Pe(b.projectId,"documents",{canViewProjectDocuments:b.canViewProjectDocuments});g&&(a.documents=g||[])}catch(g){console.error("Error fetching documents data:",g),O("Failed to load documents data.")}};oe(()=>b.projectId,async g=>{g&&await _()},{immediate:!0});const U=g=>{const r=Array.from(g.target.files);if(r.length>0){const s=Array.isArray(a.documents)?a.documents.filter(n=>typeof n=="object"&&"path"in n):[];a.documents=[...s,...r]}},M=async()=>{if(!b.projectId){O("Project ID is missing. Cannot upload documents.");return}const g=a.documents.filter(r=>r&&typeof r=="object"&&"name"in r&&"size"in r&&"type"in r);if(!g||g.length===0){O("Please select documents to upload.");return}v.value=!0;try{const r=new FormData;g.forEach((n,j)=>{r.append(`documents[${j}]`,n)});const s=await window.axios.post(`/api/projects/${b.projectId}/documents`,r,{headers:{"Content-Type":"multipart/form-data"}});a.documents=s.data.documents||[],le("Documents uploaded successfully!"),await _()}catch(r){O("Failed to upload documents."),console.error("Error uploading documents:",r)}finally{v.value=!1,w.value&&(w.value.value="")}},D=g=>{a.documents=a.documents.filter((r,s)=>s!==g)};return me(()=>{}),(g,r)=>(o(),i("div",ya,[t.canUploadProjectDocuments?(o(),i("div",fa,[l(N,{for:"documents-upload",value:"Upload New Documents",class:"mb-2 text-lg"}),e("input",{type:"file",id:"documents-upload",ref_key:"documentFileInput",ref:w,onChange:U,class:"mt-2 block w-full text-sm text-gray-600 file:mr-4 file:py-2.5 file:px-5 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100 transition-colors duration-200 cursor-pointer",multiple:"",accept:".pdf,.doc,.docx,.jpg,.jpeg,.png,.gif"},null,544),r[0]||(r[0]=e("p",{class:"text-sm text-gray-500 mt-2"},"Supported formats: PDF, DOC, DOCX, JPG, JPEG, PNG, GIF. Max file size: 5MB.",-1)),l(R,{message:t.errors.documents?t.errors.documents[0]:"",class:"mt-2"},null,8,["message"]),e("div",ba,[l(ne,{type:"button",onClick:M,disabled:!t.projectId||!a.documents||!a.documents.some(s=>s&&typeof s=="object"&&"name"in s&&"size"in s&&"type"in s)||v.value||t.isSaving,class:"px-6 py-3 rounded-lg text-lg shadow-md hover:shadow-lg transition-all duration-200"},{default:Y(()=>[v.value?(o(),i("span",wa,"Uploading...")):(o(),i("span",xa,"Upload Selected Documents"))]),_:1},8,["disabled"]),t.projectId?x("",!0):(o(),i("p",ha," Please save the project first before uploading documents. "))])])):x("",!0),t.canViewProjectDocuments&&a.documents&&a.documents.length>0?(o(),i("div",_a,[r[7]||(r[7]=e("h3",{class:"text-xl font-semibold text-gray-800 mb-5"},"Existing Project Documents",-1)),e("ul",ka,[(o(!0),i(ue,null,ce(a.documents,(s,n)=>(o(),i("li",{key:n,class:"flex items-center justify-between p-4 bg-gray-50 rounded-md border border-gray-100 shadow-sm transition-shadow hover:shadow-md duration-200"},[e("div",ja,[e("span",Pa,[typeof s=="object"&&"type"in s&&s.type.includes("image")?(o(),i("svg",$a,r[1]||(r[1]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 002.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"},null,-1)]))):typeof s=="object"&&"type"in s&&s.type.includes("pdf")?(o(),i("svg",Va,r[2]||(r[2]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"},null,-1)]))):typeof s=="object"&&"type"in s&&(s.type.includes("word")||s.type.includes("document"))?(o(),i("svg",Sa,r[3]||(r[3]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"},null,-1)]))):(o(),i("svg",Ca,r[4]||(r[4]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"},null,-1)])))]),typeof s=="object"&&"path"in s?(o(),i("a",{key:0,href:`/storage/${s.path}`,target:"_blank",class:"text-blue-600 hover:text-blue-800 hover:underline font-medium break-all mr-4"},S(s.filename),9,Ia)):(o(),i("span",Da,[E(S(s.name)+" ",1),r[5]||(r[5]=e("span",{class:"text-gray-500 text-sm"},"(Pending Upload)",-1))]))]),t.canUploadProjectDocuments?(o(),i("button",{key:0,type:"button",onClick:j=>D(n),class:"p-2 rounded-full text-red-500 hover:bg-red-100 hover:text-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 transition-colors duration-200",title:"Remove document",disabled:v.value||t.isSaving},r[6]||(r[6]=[e("svg",{class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]),8,Ua)):x("",!0)]))),128))])])):t.canViewProjectDocuments?(o(),i("div",Ma," No documents found for this project. ")):x("",!0),r[8]||(r[8]=e("div",{class:"mt-6 p-4 bg-blue-50 rounded-lg text-blue-700 text-sm border border-blue-200"},[e("p",null,"Note: Uploaded documents will be stored in the project's designated Google Drive folder.")],-1))]))}},Na={class:"p-6 bg-white rounded-lg font-inter"},Ta={key:0,class:"p-6 bg-gray-50 rounded-lg text-gray-600 text-center border border-gray-200 shadow-sm"},Ba={key:1},Ra={class:"mb-6 flex justify-between items-center"},Ea={key:0,class:"flex items-center"},Oa={key:1},Fa={key:0,class:"text-sm text-red-500 mb-4 bg-red-50 p-3 rounded-md border border-red-200"},La={key:1,class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6"},za={class:"flex justify-between items-start mb-3"},qa=["onClick","disabled"],Ka=["onUpdate:modelValue","readonly"],Ha={class:"mt-auto pt-3 border-t border-gray-100 text-xs text-gray-500 flex justify-between items-center"},Ga={class:"font-medium text-gray-700"},Ya={key:2,class:"p-8 bg-gray-50 rounded-lg text-gray-600 text-center border border-gray-200 shadow-sm flex flex-col items-center justify-center h-64"},Wa={__name:"ProjectFormNotes",props:{projectId:{type:[Number,String],required:!0},errors:{type:Object,default:()=>({})},canAddProjectNotes:{type:Boolean,default:!1},canViewProjectNotes:{type:Boolean,default:!1},isSaving:{type:Boolean,default:!1}},setup(t){const b=t,a=be({notes:[]}),w=P(!1),v=async()=>{if(b.projectId)try{const g=await Pe(b.projectId,"notes",{canViewProjectNotes:b.canViewProjectNotes,canAddProjectNotes:b.canAddProjectNotes});g&&(a.notes=g.map(r=>{var s,n;return{id:r.id,content:r.content,created_at:r.created_at,creator_name:r.creator_name||((s=r.user)==null?void 0:s.name)||((n=r.creator)==null?void 0:n.name)||"Unknown"}})||[])}catch(g){console.error("Error fetching notes data:",g),O("Failed to load notes data.")}};oe(()=>b.projectId,async g=>{g&&await v()},{immediate:!0});const _=()=>{b.canAddProjectNotes&&a.notes.push({id:null,content:"",created_at:new Date().toISOString(),creator_name:"You"})},U=g=>{b.canAddProjectNotes&&a.notes.splice(g,1)},M=async()=>{if(!b.projectId){O("Project ID is missing. Cannot save notes.");return}w.value=!0;const g=a.notes.map(r=>({id:r.id||null,content:r.content}));try{const r=await window.axios.put(`/api/projects/${b.projectId}/sections/notes?type=private`,{notes:g});a.notes=r.data.notes.map(s=>{var n,j;return{id:s.id,content:s.content,created_at:s.created_at,creator_name:s.creator_name||((n=s.user)==null?void 0:n.name)||((j=s.creator)==null?void 0:j.name)||"Unknown"}})||[],le("Notes updated successfully!"),await v()}catch(r){console.error("Error updating notes:",r),O("Failed to update notes.")}finally{w.value=!1}},D=g=>g?new Date(g).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A";return me(()=>{}),(g,r)=>(o(),i("div",Na,[t.canViewProjectNotes?(o(),i("div",Ba,[e("div",Ra,[l(ne,{onClick:_,type:"button",class:"px-5 py-2.5 rounded-lg text-base shadow-sm hover:shadow-md transition-all duration-200",disabled:!t.canAddProjectNotes||w.value||t.isSaving},{default:Y(()=>r[0]||(r[0]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 4v16m8-8H4"})],-1),E(" Add New Note ",-1)])),_:1,__:[0]},8,["disabled"]),l(ne,{onClick:M,disabled:!t.projectId||!t.canAddProjectNotes||w.value||t.isSaving,class:Q([{"opacity-50 cursor-not-allowed":w.value||t.isSaving},"px-6 py-3 rounded-lg text-lg shadow-md hover:shadow-lg transition-all duration-200"])},{default:Y(()=>[w.value||t.isSaving?(o(),i("span",Ea,r[1]||(r[1]=[e("svg",{class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),E(" Saving... ",-1)]))):(o(),i("span",Oa,"Save All Notes"))]),_:1},8,["disabled","class"])]),t.projectId?x("",!0):(o(),i("p",Fa," Please save the project first before adding or editing notes. ")),a.notes&&a.notes.length>0?(o(),i("div",La,[(o(!0),i(ue,null,ce(a.notes,(s,n)=>(o(),i("div",{key:s.id||`new-note-${n}`,class:Q(["relative bg-white p-5 rounded-lg shadow-md border border-gray-200 flex flex-col h-64 transition-all duration-200 ease-in-out hover:shadow-lg",{"opacity-75 cursor-not-allowed":!t.canAddProjectNotes||w.value||t.isSaving}])},[e("div",za,[l(N,{value:`Note ${n+1}`,class:"text-sm font-semibold text-gray-700"},null,8,["value"]),t.canAddProjectNotes?(o(),i("button",{key:0,type:"button",onClick:j=>U(n),class:"p-1 rounded-full text-red-500 hover:bg-red-100 hover:text-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 transition-colors duration-200",title:"Remove note",disabled:w.value||t.isSaving},r[2]||(r[2]=[e("svg",{class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1)]),8,qa)):x("",!0)]),he(e("textarea",{"onUpdate:modelValue":j=>s.content=j,readonly:!t.canAddProjectNotes||w.value||t.isSaving,placeholder:"Type your note content here...",class:"flex-grow border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-lg shadow-sm block w-full resize-none transition-colors duration-200 p-3 text-sm overflow-auto",rows:"6"},null,8,Ka),[[qe,s.content]]),l(R,{message:t.errors[`notes.${n}.content`]?t.errors[`notes.${n}.content`][0]:"",class:"mt-2"},null,8,["message"]),e("div",Ha,[e("span",null,[r[3]||(r[3]=E("By: ",-1)),e("span",Ga,S(s.creator_name||"Unknown"),1)]),e("span",null,"Last updated: "+S(D(s.created_at)),1)])],2))),128))])):(o(),i("div",Ya,r[4]||(r[4]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-16 w-16 text-gray-400 mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"1"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1),e("p",{class:"text-lg font-medium"},"No notes found for this project.",-1),e("p",{class:"text-sm mt-2"},'Click "Add New Note" to start creating your project notes.',-1)])))])):(o(),i("div",Ta," You do not have permission to view project notes. "))]))}},Ja=["value","rows"],Xa={__name:"TextareaInput",props:{modelValue:[String,Number],rows:{type:[String,Number],default:3}},emits:["update:modelValue"],setup(t){const b=P(null);return me(()=>{b.value.hasAttribute("autofocus")&&b.value.focus()}),(a,w)=>(o(),i("textarea",{class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full",value:t.modelValue,rows:t.rows,onInput:w[0]||(w[0]=v=>a.$emit("update:modelValue",v.target.value)),ref_key:"input",ref:b},null,40,Ja))}},Qa={class:"p-6 bg-gray-50 rounded-xl shadow-lg"},Za={class:"flex justify-between items-center mb-6"},es={key:0,class:"flex justify-center py-8"},ts={key:1,class:"bg-white p-8 rounded-lg text-center border border-dashed border-gray-300"},as={key:2,class:"space-y-6"},ss={class:"flex justify-between items-start"},ls={class:"text-xl font-medium text-gray-900"},os={class:"mt-2 flex items-center flex-wrap space-x-4 text-sm text-gray-500"},ns={key:0,class:"text-gray-700"},rs={key:1,class:"text-gray-700"},is={key:0,class:"mt-4 text-base text-gray-600"},ds={key:0,class:"flex space-x-2"},us={class:"p-6 bg-white rounded-lg"},cs={class:"text-2xl font-bold text-gray-900 mb-6"},ms={class:"p-4 bg-indigo-50 rounded-lg border border-indigo-200"},vs={class:"flex justify-end space-x-3 mt-6"},ps={__name:"ProjectDeliverables",props:{projectId:{type:[Number,String],required:!0},errors:{type:Object,default:()=>({})},isSaving:{type:Boolean,default:!1},canManageProjectDeliverables:{type:Boolean,default:!1},canViewProjectDeliverables:{type:Boolean,default:!0}},emits:["checklist-item-toggled"],setup(t,{emit:b}){const a=t,w=P([]),v=P([]),_=P(!0),U=P([]),M=P(!1),D=P("create"),g=P({id:null,name:"",description:"",milestone_id:null,status:"pending",due_date:"",details:{deliverable_type_key:null,checklist:[]}}),r=P({}),s=P(null),n=[{value:"pending",label:"Pending"},{value:"in_progress",label:"In Progress"},{value:"completed",label:"Completed"},{value:"cancelled",label:"Cancelled"}],j=G(()=>{const c=v.value.find(y=>{var f;return y.key===((f=g.value.details)==null?void 0:f.deliverable_type_key)});return(c==null?void 0:c.checklistItemPlaceholder)||"e.g., Task 1, Task 2, Task 3"});oe(()=>a.projectId,T,{immediate:!0});async function T(){if(a.projectId){_.value=!0;try{const c=await de.get(`/api/projects/${a.projectId}/project-deliverables`);w.value=c.data;const y=await de.get(`/api/projects/${a.projectId}/milestones`);U.value=y.data;const f=await de.get("/api/project-deliverable-types");v.value=f.data}catch(c){console.error("Error fetching data:",c),O("Failed to load project data")}finally{_.value=!1}}}function W(){D.value="create",g.value={id:null,name:"",description:"",milestone_id:null,status:"pending",due_date:"",details:{deliverable_type_key:null,checklist:[{name:"",completed:!1}]}},r.value={},s.value=null,M.value=!0}function J(c){D.value="edit",g.value=JSON.parse(JSON.stringify(c)),g.value.details.checklist||(g.value.details.checklist=[]),(g.value.details.checklist.length===0||g.value.details.checklist[g.value.details.checklist.length-1].name!=="")&&g.value.details.checklist.push({name:"",completed:!1}),r.value={},s.value=g.value.details.deliverable_type_key??null,M.value=!0}async function k(c){var F;if(c===s.value)return;if((((F=g.value.details)==null?void 0:F.checklist)||[]).some(B=>((B==null?void 0:B.name)||"").trim()!=="")){if(!await lt("Changing the deliverable type may clear your existing checklist items. Do you want to proceed?",{confirmText:"Proceed",cancelText:"Cancel",type:"warning"})){g.value.details.deliverable_type_key=s.value;return}g.value.details.checklist=[{name:"",completed:!1}]}s.value=c}async function p(){r.value={};try{let c;const y=g.value.details.checklist.filter(F=>F.name.trim()!==""),f={...g.value,details:{...g.value.details,checklist:y}};D.value==="create"?(c=await de.post(`/api/projects/${a.projectId}/project-deliverables`,f),le("Project deliverable created successfully")):(c=await de.put(`/api/project-deliverables/${g.value.id}`,f),le("Project deliverable updated successfully")),await T(),M.value=!1}catch(c){console.error("Error saving deliverable:",c),c.response&&c.response.data&&c.response.data.errors?r.value=c.response.data.errors:O("Failed to save project deliverable")}}async function h(c){if(confirm("Are you sure you want to delete this deliverable?"))try{await de.delete(`/api/project-deliverables/${c}`),le("Project deliverable deleted successfully"),await T()}catch(y){console.error("Error deleting deliverable:",y),O("Failed to delete project deliverable")}}function L(c){return c?new Date(c).toLocaleDateString():"N/A"}return(c,y)=>(o(),i("div",Qa,[e("div",Za,[y[10]||(y[10]=e("h3",{class:"text-2xl font-bold text-gray-900"},"Project Deliverables",-1)),t.canManageProjectDeliverables?(o(),ae(ne,{key:0,onClick:W,disabled:t.isSaving||_.value},{default:Y(()=>y[9]||(y[9]=[E(" Add Deliverable ",-1)])),_:1,__:[9]},8,["disabled"])):x("",!0)]),_.value?(o(),i("div",es,y[11]||(y[11]=[e("div",{class:"animate-spin rounded-full h-10 w-10 border-b-2 border-indigo-600"},null,-1)]))):w.value.length===0?(o(),i("div",ts,[y[13]||(y[13]=e("p",{class:"text-gray-600 text-lg"},"No deliverables have been added to this project yet.",-1)),t.canManageProjectDeliverables?(o(),ae(ne,{key:0,onClick:W,class:"mt-6"},{default:Y(()=>y[12]||(y[12]=[E(" Add Your First Deliverable ",-1)])),_:1,__:[12]})):x("",!0)])):(o(),i("div",as,[(o(!0),i(ue,null,ce(w.value,f=>{var F;return o(),i("div",{key:f.id,class:"bg-white border border-gray-200 rounded-xl p-6 shadow-sm hover:shadow-lg transition-all duration-300"},[e("div",ss,[e("div",null,[e("h4",ls,S(f.name),1),e("div",os,[e("span",{class:Q({"font-medium py-1 px-3 rounded-full text-white":!0,"bg-yellow-500":f.status==="pending","bg-blue-500":f.status==="in_progress","bg-green-500":f.status==="completed","bg-red-500":f.status==="cancelled"})},S(f.status.replace("_"," ").toUpperCase()),3),f.milestone?(o(),i("span",ns,[y[14]||(y[14]=e("span",{class:"font-semibold"},"Milestone:",-1)),E(" "+S(f.milestone.name),1)])):x("",!0),f.due_date?(o(),i("span",rs,[y[15]||(y[15]=e("span",{class:"font-semibold"},"Due:",-1)),E(" "+S(L(f.due_date)),1)])):x("",!0)]),f.description?(o(),i("p",is,S(f.description),1)):x("",!0),(F=f.details)!=null&&F.checklist&&f.details.checklist.length>0?(o(),ae(pt,{key:1,items:f.details.checklist,"api-endpoint":`/api/project-deliverables/${f.id}`,title:"Deliverable Checklist:","payload-transformer":(B,C)=>({...f,details:{...f.details,checklist:B}}),onItemToggled:B=>c.$emit("checklist-item-toggled",{deliverable:f,index:B.index,completed:B.completed})},null,8,["items","api-endpoint","payload-transformer","onItemToggled"])):x("",!0)]),t.canManageProjectDeliverables?(o(),i("div",ds,[l(fe,{onClick:B=>J(f),size:"sm"},{default:Y(()=>y[16]||(y[16]=[E(" Edit ",-1)])),_:2,__:[16]},1032,["onClick"]),l(wt,{onClick:B=>h(f.id),size:"sm"},{default:Y(()=>y[17]||(y[17]=[E(" Delete ",-1)])),_:2,__:[17]},1032,["onClick"])])):x("",!0)])])}),128))])),l(xt,{show:M.value,onClose:y[8]||(y[8]=f=>M.value=!1),maxWidth:"2xl"},{default:Y(()=>{var f,F,B,C,m;return[e("div",us,[e("h3",cs,S(D.value==="create"?"Add New Deliverable":"Edit Deliverable"),1),e("form",{onSubmit:je(p,["prevent"]),class:"space-y-6"},[e("div",null,[l(N,{for:"name",value:"Name"}),l(K,{id:"name",modelValue:g.value.name,"onUpdate:modelValue":y[0]||(y[0]=d=>g.value.name=d),type:"text",class:"mt-1 block w-full",required:""},null,8,["modelValue"]),l(R,{message:(f=r.value.name)==null?void 0:f[0],class:"mt-2"},null,8,["message"])]),e("div",null,[l(N,{for:"description",value:"Description"}),l(Xa,{id:"description",modelValue:g.value.description,"onUpdate:modelValue":y[1]||(y[1]=d=>g.value.description=d),class:"mt-1 block w-full",rows:"3"},null,8,["modelValue"]),l(R,{message:(F=r.value.description)==null?void 0:F[0],class:"mt-2"},null,8,["message"])]),e("div",null,[l(N,{for:"milestone_id",value:"Milestone (Optional)"}),l(ee,{id:"milestone_id",modelValue:g.value.milestone_id,"onUpdate:modelValue":y[2]||(y[2]=d=>g.value.milestone_id=d),options:U.value,valueKey:"id",labelKey:"name",placeholder:"Select a milestone",class:"mt-1 block w-full"},null,8,["modelValue","options"]),l(R,{message:(B=r.value.milestone_id)==null?void 0:B[0],class:"mt-2"},null,8,["message"])]),e("div",null,[l(N,{for:"status",value:"Status"}),l(ee,{id:"status",modelValue:g.value.status,"onUpdate:modelValue":y[3]||(y[3]=d=>g.value.status=d),options:n,valueKey:"value",labelKey:"label",placeholder:"Select a Status",class:"mt-1 block w-full"},null,8,["modelValue"]),l(R,{message:(C=r.value.status)==null?void 0:C[0],class:"mt-2"},null,8,["message"])]),e("div",null,[l(N,{for:"due_date",value:"Due Date (Optional)"}),l(K,{id:"due_date",modelValue:g.value.due_date,"onUpdate:modelValue":y[4]||(y[4]=d=>g.value.due_date=d),type:"date",class:"mt-1 block w-full"},null,8,["modelValue"]),l(R,{message:(m=r.value.due_date)==null?void 0:m[0],class:"mt-2"},null,8,["message"])]),e("div",ms,[y[18]||(y[18]=e("h4",{class:"text-lg font-semibold text-indigo-800 mb-4"},"Deliverable Checklist",-1)),e("div",null,[l(N,{for:"deliverable_type_key",value:"Deliverable Type"}),l(ee,{id:"deliverable_type_key",modelValue:g.value.details.deliverable_type_key,"onUpdate:modelValue":[y[5]||(y[5]=d=>g.value.details.deliverable_type_key=d),k],options:v.value,valueKey:"key",labelKey:"name",placeholder:"Select a Deliverable Type",class:"mt-1 block w-full",required:""},null,8,["modelValue","options"])]),l(gt,{modelValue:g.value.details.checklist,"onUpdate:modelValue":y[6]||(y[6]=d=>g.value.details.checklist=d),placeholder:j.value,label:"Checklist Items",containerClass:"mt-4"},null,8,["modelValue","placeholder"])]),e("div",vs,[l(fe,{onClick:y[7]||(y[7]=d=>M.value=!1),disabled:t.isSaving},{default:Y(()=>y[19]||(y[19]=[E(" Cancel ",-1)])),_:1,__:[19]},8,["disabled"]),l(ne,{type:"submit",disabled:t.isSaving},{default:Y(()=>[E(S(D.value==="create"?"Create":"Update"),1)]),_:1},8,["disabled"])])],32)])]}),_:1},8,["show"])]))}},gs={class:"p-6 bg-white rounded-lg font-inter"},ys={key:0,class:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4",role:"alert"},fs={class:"block sm:inline ml-2"},bs={key:1,class:"flex items-center justify-center py-8"},ws={key:2},xs={key:0,class:"bg-gradient-to-r from-blue-500 to-indigo-600 text-white p-6 rounded-lg shadow-md mb-6"},hs={class:"flex items-center justify-between"},_s={class:"text-3xl font-bold mt-1"},ks={class:"text-sm opacity-90 mt-2"},js={class:"font-semibold"},Ps={class:"font-semibold"},$s={key:1,class:"bg-gray-100 text-gray-600 p-4 rounded-lg shadow-sm mb-6 text-center"},Vs={class:"bg-gray-50 p-6 rounded-lg shadow-sm mb-6 border border-gray-200"},Ss={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},Cs=["disabled"],Is=["value"],Ds={class:"bg-gray-50 p-6 rounded-lg shadow-sm mb-6 border border-gray-200"},Us={class:"mb-4"},Ms={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-1 gap-4"},As={class:"flex items-center justify-between"},Ns=["for"],Ts={class:"ms-2 text-base font-medium text-gray-800"},Bs=["onClick"],Rs={key:0,class:"mt-4 pt-4 border-t border-gray-200"},Es={class:"grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4"},Os={class:"grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4"},Fs=["id","onUpdate:modelValue","disabled"],Ls={key:0,class:"mt-4 p-4 bg-blue-50 rounded-lg border border-blue-200"},zs={class:"flex justify-between items-center mb-3"},qs={class:"space-y-4"},Ks={class:"flex justify-between items-center mb-2"},Hs=["onClick"],Gs={class:"grid grid-cols-1 sm:grid-cols-2 gap-4"},Ys=["onClick"],Ws={key:0},Js={class:"mt-6 pt-4 border-t border-gray-200"},Xs={key:1,class:"mt-4 flex items-center"},Qs={key:2,class:"mt-6 flex justify-end"},Zs={__name:"ServicesAndPaymentForm",props:{projectId:{type:[Number,String],required:!0},paymentTypeOptions:{type:Array,required:!0},canManageProjectServicesAndPayments:{type:Boolean,required:!0},canViewProjectServicesAndPayments:{type:Boolean,required:!0}},emits:["updated"],setup(t,{emit:b}){const a=t,w=b,v=P({}),_=P(!1),U=[{value:"PKR",label:"PKR"},{value:"AUD",label:"AUD"},{value:"INR",label:"INR"},{value:"USD",label:"USD"},{value:"EUR",label:"EUR"},{value:"GBP",label:"GBP"}],D=P([...[{value:"Website Designing",label:"Website Designing"},{value:"SEO",label:"SEO"},{value:"Social Media",label:"Social Media"},{value:"Content Writing",label:"Content Writing"},{value:"Graphic Design",label:"Graphic Design"}]]),g=P(""),r=P(!1),s=be({services:[],service_details:[],payment_type:"one_off",currency:"AUD"}),n=be({}),j=G(()=>{let C=0;return s.services.forEach(m=>{const d=c(m);d&&d.amount&&(C+=parseFloat(d.amount))}),C.toFixed(2)}),T=G(()=>{let C=null,m=null;const d=new Date;return d.setHours(0,0,0,0),s.service_details.forEach(A=>{A.frequency==="one_off"&&A.payment_breakdown&&A.payment_breakdown.forEach(z=>{var q;if(z.due_date){const te=new Date(z.due_date);te.setHours(0,0,0,0),te>=d&&(!C||te<C.date)&&(C={date:te,serviceId:A.service_id,paymentLabel:z.label},m=((q=D.value.find(X=>X.value===A.service_id))==null?void 0:q.label)||A.service_id)}})}),C?{date:C.date.toLocaleDateString(),serviceLabel:m,paymentLabel:C.paymentLabel}:null}),W=G(()=>{const C=s.services.filter(m=>{const d=c(m);return d&&d.frequency!=="monthly"});return C.length===0?!0:C.every(m=>y(m)===100)}),J=G(()=>!a.projectId||!a.canManageProjectServicesAndPayments||!W.value),k=()=>{const C=g.value.trim();C&&!D.value.some(m=>m.label.toLowerCase()===C.toLowerCase())&&(D.value.push({value:C,label:C}),g.value="",r.value=!1)},p=async()=>{if(a.projectId){_.value=!0;try{const m=(await window.axios.get(`/api/projects/${a.projectId}/sections/services-payment`)).data;return s.services=m.services||[],s.service_details=m.service_details||[],s.payment_type=m.payment_type||"one_off",s.currency=m.currency||"AUD",s.services.forEach(d=>{D.value.some(A=>A.value===d)||D.value.push({value:d,label:d}),n[d]=!1}),s.service_details.forEach(d=>{if(d.payment_breakdown&&!Array.isArray(d.payment_breakdown)){const A=d.payment_breakdown;d.payment_breakdown=[{label:"First",percentage:parseInt(A.first)||30,due_date:null},{label:"Second",percentage:parseInt(A.second)||30,due_date:null},{label:"Third",percentage:parseInt(A.third)||40,due_date:null}]}else!d.payment_breakdown||d.payment_breakdown.length===0?d.payment_breakdown=[{label:"Payment 1",percentage:100,due_date:null}]:d.payment_breakdown.forEach(A=>{A.due_date===void 0&&(A.due_date=null)})}),m}catch(C){return console.error("Error fetching services and payment data:",C),v.value.general="Failed to fetch services and payment data.",null}finally{_.value=!1}}},h=async()=>{v.value={},_.value=!0;try{const C={services:s.services,service_details:s.service_details,total_amount:parseFloat(j.value),payment_type:s.payment_type,currency:s.currency},m=await window.axios.put(`/api/projects/${a.projectId}/sections/services-payment`,C);le("Services and payment information updated successfully!"),w("updated")}catch(C){C.response&&C.response.status===422?v.value=C.response.data.errors:C.response&&C.response.data.message?v.value.general=C.response.data.message:(v.value.general="Failed to update services and payment information.",console.error("Error:",C))}finally{_.value=!1}},L=(C,m)=>{m?(s.service_details.some(d=>d.service_id===C)||s.service_details.push({service_id:C,amount:"",frequency:"one_off",start_date:"",payment_breakdown:[{label:"Payment 1",percentage:100,due_date:null}],currency:s.currency}),n[C]=!0):(s.service_details=s.service_details.filter(d=>d.service_id!==C),n[C]=!1)},c=C=>{let m=s.service_details.find(d=>d.service_id===C);if(!m)m={service_id:C,amount:"",frequency:"one_off",start_date:"",payment_breakdown:[{label:"Payment 1",percentage:100,due_date:null}],currency:s.currency},s.service_details.push(m);else if(m.payment_breakdown&&!Array.isArray(m.payment_breakdown)){const d=m.payment_breakdown;m.payment_breakdown=[{label:"First",percentage:parseInt(d.first)||30,due_date:null},{label:"Second",percentage:parseInt(d.second)||30,due_date:null},{label:"Third",percentage:parseInt(d.third)||40,due_date:null}]}else!m.payment_breakdown||m.payment_breakdown.length===0?m.payment_breakdown=[{label:"Payment 1",percentage:100,due_date:null}]:m.payment_breakdown.forEach(d=>{d.due_date===void 0&&(d.due_date=null)});return m},y=C=>{const m=c(C);return!m.payment_breakdown||!Array.isArray(m.payment_breakdown)?0:m.payment_breakdown.reduce((d,A)=>d+(parseInt(A.percentage)||0),0)},f=C=>{const m=c(C);if(m.payment_breakdown||(m.payment_breakdown=[]),!Array.isArray(m.payment_breakdown)){const z=m.payment_breakdown;m.payment_breakdown=[{label:"First",percentage:parseInt(z.first)||30,due_date:null},{label:"Second",percentage:parseInt(z.second)||30,due_date:null},{label:"Third",percentage:parseInt(z.third)||40,due_date:null}]}const d=m.payment_breakdown.length;let A=0;if(d>0){const z=m.payment_breakdown[d-1];A=Math.floor(z.percentage/2),z.percentage-=A}else A=100;m.payment_breakdown.push({label:`Payment ${d+1}`,percentage:A,due_date:null})},F=(C,m)=>{const d=c(C);if(!d.payment_breakdown||!Array.isArray(d.payment_breakdown)||d.payment_breakdown.length<=1)return;const A=parseInt(d.payment_breakdown[m].percentage)||0;if(d.payment_breakdown.splice(m,1),A>0&&d.payment_breakdown.length>0){const z=m>0&&m<=d.payment_breakdown.length?m-1:0;d.payment_breakdown[z].percentage=(parseInt(d.payment_breakdown[z].percentage)||0)+A}d.payment_breakdown.forEach((z,q)=>{z.label=`Payment ${q+1}`})},B=C=>{n[C]=!n[C]};return oe(()=>a.projectId,C=>{C&&p()},{immediate:!0}),(C,m)=>(o(),i("div",gs,[v.value.general?(o(),i("div",ys,[m[6]||(m[6]=e("strong",{class:"font-bold"},"Error!",-1)),e("span",fs,S(v.value.general),1)])):x("",!0),_.value?(o(),i("div",bs,m[7]||(m[7]=[e("svg",{class:"animate-spin -ml-1 mr-3 h-8 w-8 text-blue-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),e("span",{class:"text-gray-600"},"Loading services and payment data...",-1)]))):(o(),i("div",ws,[T.value?(o(),i("div",xs,[e("div",hs,[e("div",null,[m[10]||(m[10]=e("p",{class:"text-sm opacity-90"},"Next Payment Due",-1)),e("p",_s,S(T.value.date),1),e("p",ks,[m[8]||(m[8]=E(" For: ",-1)),e("span",js,S(T.value.serviceLabel),1),m[9]||(m[9]=E(" - ",-1)),e("span",Ps,S(T.value.paymentLabel),1)])]),m[11]||(m[11]=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-12 w-12 opacity-70",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1))])])):(o(),i("div",$s," No upcoming payment due dates found for one-off services. ")),e("div",Vs,[m[13]||(m[13]=e("h4",{class:"text-xl font-semibold text-gray-700 mb-4"},"Overall Project Payment Details",-1)),e("div",Ss,[e("div",null,[l(N,{for:"calculated_total_amount",value:"Calculated Total Amount"}),l(K,{id:"calculated_total_amount",type:"text",class:"mt-1 block w-full bg-gray-100 cursor-not-allowed",value:j.value,disabled:""},null,8,["value"]),m[12]||(m[12]=e("p",{class:"text-sm text-gray-500 mt-1"},"This amount is automatically calculated from selected services.",-1))]),e("div",null,[l(N,{for:"payment_type",value:"Payment Type"}),he(e("select",{id:"payment_type",class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full p-2.5","onUpdate:modelValue":m[0]||(m[0]=d=>s.payment_type=d),required:"",disabled:!t.canManageProjectServicesAndPayments},[(o(!0),i(ue,null,ce(t.paymentTypeOptions,d=>(o(),i("option",{key:d.value,value:d.value},S(d.label),9,Is))),128))],8,Cs),[[Re,s.payment_type]]),l(R,{message:v.value.payment_type?v.value.payment_type[0]:"",class:"mt-2"},null,8,["message"])]),e("div",null,[l(N,{for:"overall_currency",value:"Overall Project Currency"}),l(ee,{id:"overall_currency",modelValue:s.currency,"onUpdate:modelValue":m[1]||(m[1]=d=>s.currency=d),options:U,"value-key":"value","label-key":"label",class:"w-full mt-1",disabled:!t.canManageProjectServicesAndPayments},null,8,["modelValue","disabled"]),l(R,{message:v.value.currency?v.value.currency[0]:"",class:"mt-2"},null,8,["message"])])])]),e("div",Ds,[m[20]||(m[20]=e("h4",{class:"text-xl font-semibold text-gray-700 mb-4"},"Manage Services",-1)),e("div",Us,[l(N,{for:"services",value:"Select Services",class:"mb-2"}),e("div",Ms,[(o(!0),i(ue,null,ce(D.value,d=>(o(),i("div",{key:d.value,class:"bg-white p-4 rounded-lg shadow-sm border border-gray-200"},[e("div",As,[e("label",{for:`service_${d.value}`,class:"flex items-center cursor-pointer"},[l(ht,{id:`service_${d.value}`,value:d.value,checked:s.services,"onUpdate:checked":[m[2]||(m[2]=A=>s.services=A),A=>L(d.value,A)],disabled:!t.canManageProjectServicesAndPayments},null,8,["id","value","checked","onUpdate:checked","disabled"]),e("span",Ts,S(d.label),1)],8,Ns),(s.services||[]).includes(d.value)?(o(),i("button",{key:0,onClick:A=>B(d.value),type:"button",class:Q(["text-gray-500 hover:text-gray-700 transition-transform duration-200",{"rotate-180":n[d.value]}])},m[14]||(m[14]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"})],-1)]),10,Bs)):x("",!0)]),(s.services||[]).includes(d.value)&&n[d.value]?(o(),i("div",Rs,[e("div",Es,[e("div",null,[l(N,{for:`service_amount_${d.value}`,value:"Amount"},null,8,["for"]),l(K,{id:`service_amount_${d.value}`,type:"number",step:"0.01",placeholder:"Service Amount",class:"w-full mt-1",modelValue:c(d.value).amount,"onUpdate:modelValue":A=>c(d.value).amount=A,disabled:!t.canManageProjectServicesAndPayments},null,8,["id","modelValue","onUpdate:modelValue","disabled"])]),e("div",null,[l(N,{for:`service_currency_${d.value}`,value:"Currency"},null,8,["for"]),l(ee,{id:`service_currency_${d.value}`,modelValue:c(d.value).currency,"onUpdate:modelValue":A=>c(d.value).currency=A,options:U,"value-key":"value","label-key":"label",class:"w-full mt-1",disabled:!t.canManageProjectServicesAndPayments},null,8,["id","modelValue","onUpdate:modelValue","disabled"])])]),e("div",Os,[e("div",null,[l(N,{for:`service_frequency_${d.value}`,value:"Frequency"},null,8,["for"]),he(e("select",{id:`service_frequency_${d.value}`,class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full p-2.5","onUpdate:modelValue":A=>c(d.value).frequency=A,disabled:!t.canManageProjectServicesAndPayments},m[15]||(m[15]=[e("option",{value:"monthly"},"Monthly",-1),e("option",{value:"one_off"},"One off",-1)]),8,Fs),[[Re,c(d.value).frequency]])]),e("div",null,[l(N,{for:`service_start_date_${d.value}`,value:"Start Date"},null,8,["for"]),l(K,{id:`service_start_date_${d.value}`,type:"date",class:"w-full mt-1",modelValue:c(d.value).start_date,"onUpdate:modelValue":A=>c(d.value).start_date=A,disabled:!t.canManageProjectServicesAndPayments},null,8,["id","modelValue","onUpdate:modelValue","disabled"])])]),c(d.value).frequency!=="monthly"?(o(),i("div",Ls,[e("div",zs,[l(N,{value:"Payment Breakdown (%)",class:"text-base font-medium text-blue-800"}),t.canManageProjectServicesAndPayments?(o(),ae(ne,{key:0,type:"button",onClick:A=>f(d.value),class:"px-4 py-2 text-sm"},{default:Y(()=>m[16]||(m[16]=[E(" + Add Payment Step ",-1)])),_:2,__:[16]},1032,["onClick"])):x("",!0)]),e("div",qs,[(o(!0),i(ue,null,ce(c(d.value).payment_breakdown,(A,z)=>(o(),i("div",{key:z,class:"bg-white p-4 rounded-md shadow-sm border border-blue-100"},[e("div",Ks,[l(N,{for:`payment_label_${z}_${d.value}`,value:A.label,class:"font-semibold"},null,8,["for","value"]),t.canManageProjectServicesAndPayments&&c(d.value).payment_breakdown.length>1?(o(),i("button",{key:0,type:"button",class:"text-red-500 hover:text-red-700 p-1 rounded-full hover:bg-red-100 transition-colors",onClick:q=>F(d.value,z),title:"Remove payment step"},m[17]||(m[17]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 011-1h4a1 1 0 110 2H8a1 1 0 01-1-1zm-1 3a1 1 0 100 2h8a1 1 0 100-2H6z","clip-rule":"evenodd"})],-1)]),8,Hs)):x("",!0)]),e("div",Gs,[e("div",null,[l(N,{for:`payment_percentage_${z}_${d.value}`,value:"Percentage (%)",class:"text-sm"},null,8,["for"]),l(K,{id:`payment_percentage_${z}_${d.value}`,type:"number",min:"0",max:"100",class:"w-full mt-1",modelValue:A.percentage,"onUpdate:modelValue":q=>A.percentage=q,modelModifiers:{number:!0},onInput:q=>{A.percentage=Math.max(0,Math.min(100,parseInt(q.target.value)||0))},disabled:!t.canManageProjectServicesAndPayments},null,8,["id","modelValue","onUpdate:modelValue","onInput","disabled"])]),e("div",null,[l(N,{for:`payment_due_date_${z}_${d.value}`,value:"Due Date (Optional)",class:"text-sm"},null,8,["for"]),l(K,{id:`payment_due_date_${z}_${d.value}`,type:"date",class:"w-full mt-1",modelValue:A.due_date,"onUpdate:modelValue":q=>A.due_date=q,disabled:!t.canManageProjectServicesAndPayments},null,8,["id","modelValue","onUpdate:modelValue","disabled"]),t.canManageProjectServicesAndPayments&&A.due_date?(o(),i("button",{key:0,type:"button",class:"text-xs text-red-500 hover:text-red-700 mt-1",onClick:q=>A.due_date=null}," Clear Date ",8,Ys)):x("",!0)])])]))),128))]),e("div",{class:Q(["text-sm mt-4 p-2 rounded-md",{"bg-green-100 text-green-700":y(d.value)===100,"bg-red-100 text-red-700 font-bold":y(d.value)!==100}])},[E(" Total Percentage: "+S(y(d.value))+"% ",1),y(d.value)!==100?(o(),i("span",Ws," (Total must be 100%) ")):x("",!0)],2)])):x("",!0)])):x("",!0)]))),128))])]),e("div",Js,[t.canManageProjectServicesAndPayments&&!r.value?(o(),i("button",{key:0,type:"button",class:"inline-flex items-center px-4 py-2 bg-blue-600 border border-transparent rounded-md font-semibold text-xs text-white uppercase tracking-widest hover:bg-blue-700 active:bg-blue-900 focus:outline-none focus:border-blue-900 focus:ring ring-blue-300 disabled:opacity-25 transition ease-in-out duration-150 shadow-md",onClick:m[3]||(m[3]=d=>r.value=!0)},m[18]||(m[18]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 4v16m8-8H4"})],-1),E(" Add New Service/Department ",-1)]))):x("",!0),t.canManageProjectServicesAndPayments&&r.value?(o(),i("div",Xs,[l(K,{type:"text",class:"flex-grow mr-2 border-gray-300 rounded-md shadow-sm p-2.5",modelValue:g.value,"onUpdate:modelValue":m[4]||(m[4]=d=>g.value=d),placeholder:"Enter new service/department name",onKeyup:ot(k,["enter"])},null,8,["modelValue"]),l(ne,{onClick:k},{default:Y(()=>m[19]||(m[19]=[E("Add",-1)])),_:1,__:[19]}),e("button",{type:"button",class:"ml-2 text-sm text-gray-500 hover:text-gray-700 px-3 py-2 rounded-md transition-colors",onClick:m[5]||(m[5]=d=>{r.value=!1,g.value=""})}," Cancel ")])):x("",!0)]),l(R,{message:v.value.services?v.value.services[0]:"",class:"mt-2"},null,8,["message"])]),t.canManageProjectServicesAndPayments?(o(),i("div",Qs,[l(ne,{onClick:h,disabled:J.value,class:Q([{"opacity-50 cursor-not-allowed":J.value},"px-6 py-3 text-base"])},{default:Y(()=>m[21]||(m[21]=[E(" Update Services & Payment ",-1)])),_:1,__:[21]},8,["disabled","class"])])):x("",!0)]))]))}},el={class:"relative"},tl={class:"flex flex-wrap items-center gap-2 mb-2 p-2 border border-gray-300 rounded-lg bg-white min-h-[44px] focus-within:border-indigo-500 focus-within:ring-1 focus-within:ring-indigo-500 transition-all duration-150"},al={key:0,class:"inline-flex items-center px-3 py-1 text-sm font-medium bg-indigo-100 text-indigo-800 rounded-full shadow-sm"},sl={key:0,class:"absolute z-20 w-full bg-white border border-gray-300 rounded-lg shadow-lg max-h-60 overflow-y-auto mt-1 transform-gpu basic-prop-suggestions"},ll=["onMousedown"],ol={key:1,class:"px-4 py-2 text-sm text-gray-500"},nl={__name:"BasicPropertyInput",props:{modelValue:{type:[String,Number,null],default:null},label:{type:String,default:"Type"},placeholder:{type:String,default:"Select or type a value"},error:{type:String,default:""},disabled:{type:Boolean,default:!1},required:{type:Boolean,default:!1},searchUrl:{type:String,required:!0}},emits:["update:modelValue","change"],setup(t,{emit:b}){const a=t,w=b,v=P(""),_=P(null),U=P(!1),M=P([]),D=P(null),r=yt(async k=>{try{const p=`${a.searchUrl}?query=${encodeURIComponent(k||"")}`,{data:h}=await de.get(p);M.value=Array.isArray(h)?h.map(L=>({value:L.id,label:L.name})):[],U.value=!0}catch{M.value=[],U.value=!1}},250);oe(()=>a.modelValue,k=>{if(!k){_.value=null;return}if(typeof k=="string"&&k.startsWith("new_")){const p=k.split("_");p.shift(),p.length>0&&p.pop();const h=p.join(" ").replace(/-/g," ");_.value={value:k,label:h}}else{const p=M.value.find(h=>String(h.value)===String(k));p&&(_.value=p)}},{immediate:!0});const s=k=>{a.disabled||(_.value=k,w("update:modelValue",k.value),w("change",k.value),v.value="",U.value=!1,$e(()=>{var p;return(p=D.value)==null?void 0:p.focus()}))},n=()=>{if(a.disabled)return;const k=v.value.trim();if(!k)return;const h={value:`new_${k.replace(/\s+/g,"-").toLowerCase()}_${Date.now()}`,label:k};_.value=h,w("update:modelValue",h.value),w("change",h.value),v.value="",U.value=!1,$e(()=>{var L;return(L=D.value)==null?void 0:L.focus()})},j=k=>{var p;(p=k==null?void 0:k.stopPropagation)==null||p.call(k),!a.disabled&&(_.value=null,w("update:modelValue",null),w("change",null),v.value="",U.value=!1,$e(()=>{var h;return(h=D.value)==null?void 0:h.focus()}))},T=k=>{var p,h;k.key==="Enter"?(k.preventDefault(),n()):k.key==="Escape"?(U.value=!1,v.value="",(h=(p=D.value)==null?void 0:p.blur)==null||h.call(p)):k.key==="Backspace"&&v.value===""&&_.value&&j(k)},W=k=>{v.value=k.target.value,U.value=!0,r(v.value)},J=k=>{var h;const p=((h=D.value)==null?void 0:h.$el)||D.value;p&&!p.contains(k.target)&&!k.target.closest(".basic-prop-suggestions")&&(U.value=!1,v.value="")};return me(()=>{document.addEventListener("click",J),r("")}),nt(()=>{document.removeEventListener("click",J)}),(k,p)=>(o(),i("div",el,[l(N,{value:t.label,class:"mb-1"},null,8,["value"]),e("div",tl,[_.value?(o(),i("span",al,[E(S(_.value.label)+" ",1),t.disabled?x("",!0):(o(),i("button",{key:0,type:"button",onClick:j,class:"ml-2 -mr-1 text-indigo-500 hover:text-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 rounded-full p-0.5","aria-label":"Remove selected"},p[2]||(p[2]=[e("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])))])):x("",!0),l(K,{ref_key:"inputRef",ref:D,type:"text",placeholder:_.value?"":t.placeholder,modelValue:v.value,"onUpdate:modelValue":p[0]||(p[0]=h=>v.value=h),onFocus:p[1]||(p[1]=h=>U.value=!0),onKeydown:T,onInput:W,class:"flex-grow min-w-[150px] border-none focus:ring-0 shadow-none p-0 bg-transparent text-gray-900",disabled:t.disabled},null,8,["placeholder","modelValue","disabled"])]),U.value&&!t.disabled?(o(),i("div",sl,[(o(!0),i(ue,null,ce(M.value,h=>(o(),i("div",{key:h.value,onMousedown:je(L=>s(h),["stop","prevent"]),class:Q(["px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 cursor-pointer transition-colors duration-100",{"bg-indigo-50 text-indigo-700":_.value&&h.value===_.value.value}])},S(h.label),43,ll))),128)),v.value.trim()!==""&&!M.value.some(h=>h.label.toLowerCase()===v.value.toLowerCase())?(o(),i("div",{key:0,onMousedown:je(n,["stop","prevent"]),class:"px-4 py-2 text-sm text-indigo-700 bg-indigo-50 hover:bg-indigo-100 cursor-pointer border-t border-indigo-200 font-semibold transition-colors duration-100"},' Add new: "'+S(v.value.trim())+'" ',33)):x("",!0),M.value.length===0&&v.value.trim()===""&&!_.value?(o(),i("div",ol," Start typing to search or select an option. ")):x("",!0)])):x("",!0),l(R,{message:t.error,class:"mt-2"},null,8,["message"])]))}},rl=_t(nl,[["__scopeId","data-v-45b08a99"]]),il={class:"p-6 bg-white rounded-lg"},dl={key:0,class:"text-red-600 text-sm mb-4"},ul={key:1,class:"mb-6 p-4 bg-gray-50 rounded-md"},cl={class:"mb-6"},ml={class:"flex justify-end items-center mb-4"},vl={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},pl={class:"p-3 bg-blue-100 rounded-md"},gl={class:"text-lg font-bold text-blue-800"},yl={class:"flex items-center justify-between"},fl={key:0,class:"mt-1"},bl={class:"text-lg font-bold text-indigo-800"},wl={key:0,class:"text-xs text-gray-600"},xl={key:1,class:"mt-2 space-y-2"},hl={class:"p-3 bg-red-100 rounded-md"},_l={class:"text-lg font-bold text-red-800"},kl={class:"text-xs text-gray-500"},jl={class:"p-3 bg-purple-100 rounded-md"},Pl={class:"text-lg font-bold text-purple-800"},$l={class:"p-3 bg-green-100 rounded-md"},Vl={class:"text-lg font-bold text-green-800"},Sl={class:"p-3 bg-yellow-100 rounded-md col-span-full md:col-span-1"},Cl={class:"text-lg font-bold text-yellow-800"},Il={class:"text-xs text-gray-500"},Dl={class:"p-3 bg-orange-100 rounded-md col-span-full md:col-span-1"},Ul={class:"text-lg font-bold text-orange-900 mt-1"},Ml={class:"text-xs text-gray-500"},Al={class:"p-3 bg-gray-100 rounded-md col-span-full md:col-span-1"},Nl={class:"text-lg font-bold mt-1 text-green-400"},Tl={class:"p-3 bg-gray-100 rounded-md col-span-full md:col-span-1"},Bl={class:"text-lg font-bold text-red-400 mt-1"},Rl={class:"grid grid-cols-1 gap-4 md:grid-cols-2"},El={key:0},Ol={key:1},Fl={class:"mt-4 flex justify-end"},Ll={key:2},zl={key:0,class:"space-y-3"},ql={key:1,class:"p-4 bg-gray-50 rounded-md text-gray-600 text-center"},Kl={key:2,class:"space-y-4"},Hl={class:"flex justify-between items-start mb-2"},Gl={class:"flex-grow"},Yl={class:"font-medium text-gray-900 text-lg"},Wl={class:"text-xs text-gray-500 mt-1"},Jl={key:0},Xl={class:"flex-shrink-0 text-right"},Ql={key:0,class:"text-sm text-gray-600"},Zl={class:"flex justify-between items-end text-xs text-gray-600 mt-2 border-t border-gray-200 pt-2"},eo={key:0,class:"block"},to={key:1,class:"block"},ao={key:2,class:"block mt-1 text-gray-500"},so={class:"flex space-x-2 mt-2"},lo={key:0,class:"mt-4 p-4 bg-blue-50 rounded-md border border-blue-200"},oo={class:"text-md font-medium text-gray-900 mb-4"},no={class:"mb-4"},ro={class:"mb-4"},io={class:"flex items-center"},uo=["disabled"],co={class:"text-sm text-gray-700"},mo={key:0,class:"mb-4"},vo={class:"flex justify-end space-x-2"},ze=.25,po={__name:"ProjectTransactions",props:{projectId:{type:[Number,String],required:!0},userProjectRole:{type:Object,default:()=>({})}},setup(t){const b=t,{canDo:a,canManage:w}=Se(()=>b.projectId),v=w("project_expenses",b.userProjectRole),_=w("project_income",b.userProjectRole),U=a("view_project_transactions",b.userProjectRole),M=P([]),D=P([]),g=P({}),r=P(""),s=P(!1),n=P(null),j=P(""),T=P(!1),W=P({}),J=P(null),k=P(""),p=P({description:"",amount:"",currency:"PKR",user_id:null,hours_spent:"",type:"expense",transaction_type:null}),h=He,L=[{value:"PKR",label:"PKR"},{value:"AUD",label:"AUD"},{value:"INR",label:"INR"},{value:"USD",label:"USD"},{value:"EUR",label:"EUR"},{value:"GBP",label:"GBP"}],c=P(null),y=P("PKR"),f=P(!1),F=P({}),B=async()=>{try{const{data:V}=await window.axios.get(`/api/projects/${b.projectId}/expendable-budget`);c.value=V.total_budget,y.value=(V.currency||"PKR").toUpperCase()}catch(V){console.error("Error fetching expendable budget",V)}},C=async()=>{var V;if(F.value={},c.value===null||c.value===""||isNaN(Number(c.value))||Number(c.value)<0){F.value.amount=["Please enter a valid amount"];return}try{await window.axios.patch(`/api/projects/${b.projectId}/expendable-budget`,{total_expendable_amount:Number(c.value),currency:y.value}),le("Expendable budget updated"),f.value=!1}catch(u){((V=u.response)==null?void 0:V.status)===422?F.value=u.response.data.errors||{general:[u.response.data.message]}:(O("Failed to update expendable budget"),console.error(u))}},m=[{value:"expense",label:"Expense"},{value:"income",label:"Income"},{value:"bonus",label:"Bonus"}],d=G(()=>D.value.map(V=>({value:V.id,label:V.name||"Unknown User"}))),A=()=>{const V=new Date,u=V.getFullYear(),H=String(V.getMonth()+1).padStart(2,"0"),re=String(V.getDate()).padStart(2,"0");return`${u}-${H}-${re}`},z=async()=>{if(!(!b.projectId||!U.value))try{const V=await window.axios.get(`/api/projects/${b.projectId}/sections/clients-users`);D.value=V.data.users||[]}catch(V){r.value="Failed to fetch users.",console.error("Error fetching users:",V)}},q=async()=>{if(!(!b.projectId||!U.value)){s.value=!0;try{(!se.value||Object.keys(se.value).length===0)&&await Ve();const V=await window.axios.get(`/api/projects/${b.projectId}/sections/transactions`);M.value=V.data}catch(V){r.value="Failed to fetch transactions.",console.error("Error fetching transactions:",V)}finally{s.value=!1}}},te=async()=>{var V;if(!v.value&&!_.value){O("You do not have permission to manage transactions.");return}if(!p.value.amount||isNaN(p.value.amount)){g.value.amount=["Please enter a valid amount"];return}if(p.value.type==="expense"&&!v.value){O("You do not have permission to add expenses.");return}if(p.value.type==="income"&&!_.value){O("You do not have permission to add income.");return}if(p.value.type==="bonus"&&!v.value){O("You do not have permission to add bonuses.");return}g.value={},r.value="",s.value=!0;try{if(g.value={},!p.value.transaction_type){g.value.transaction_type_id=["Transaction Type is required"];return}if(p.value.type==="expense"&&!p.value.user_id){g.value.user_id=["User is required for expense transactions"];return}const u={...p.value,amount:Number(p.value.amount)};u.transaction_type!==null&&u.transaction_type!==void 0&&(u.transaction_type=u.transaction_type);const H=await window.axios.post(`/api/projects/${b.projectId}/transactions`,u);await q(),X(),le("Transaction saved successfully!")}catch(u){((V=u.response)==null?void 0:V.status)===422?g.value=u.response.data.errors:(r.value="Failed to save transaction.",console.error("Error saving transaction:",u))}finally{s.value=!1}},X=()=>{p.value={description:"",amount:"",currency:"PKR",user_id:null,hours_spent:"",type:"expense",transaction_type:null}},ve=async V=>{if(!v.value&&!_.value){O("You do not have permission to delete transactions.");return}if(window.confirm("Are you sure you want to delete this transaction?"))try{const u=M.value[V].id;await window.axios.delete(`/api/projects/${b.projectId}/transactions/${u}`),await q(),le("Transaction deleted successfully!")}catch(u){r.value="Failed to delete transaction.",console.error("Error deleting transaction:",u)}},Ge=V=>{if(!v.value&&!_.value){O("You do not have permission to manage transactions.");return}const u=M.value[V];n.value===u.id?(n.value=null,J.value=null,k.value=""):(J.value=V,n.value=u.id,j.value=u.amount,T.value=!1,W.value={},k.value=A(),(Number(u.amount)===0||Math.abs(Number(j.value)-Number(u.amount))<.01)&&(T.value=!0))};oe(j,V=>{if(J.value!==null){const u=M.value[J.value];T.value=Math.abs(Number(V)-Number(u.amount))<.01}});const Ce=()=>{n.value=null,J.value=null,j.value="",T.value=!1,W.value={},k.value=""},Ye=async()=>{var re;if(!v.value&&!_.value){O("You do not have permission to manage transactions.");return}const V=J.value,u=M.value[V],H=Number(j.value);if(!T.value&&(!j.value||isNaN(H)||H<=0||H>Number(u.amount))){W.value.amount=["Please enter a valid amount between 0 and "+Z(Number(u.amount),u.currency)];return}if(!k.value){W.value.date=["Please select a payment date."];return}W.value={},s.value=!0;try{const ge=u.id,xe=T.value||Math.abs(H-Number(u.amount))<.01,ke={payment_amount:xe?Number(u.amount):H,pay_in_full:xe,transaction_currency:u.currency,transaction_type:u.type,original_description:u.description,payment_date:k.value};await window.axios.patch(`/api/projects/${b.projectId}/transactions/${ge}/process-payment`,ke),await q(),le("Payment processed successfully!"),Ce()}catch(ge){((re=ge.response)==null?void 0:re.status)===422?W.value=ge.response.data.errors:(r.value="Failed to process payment.",console.error("Error processing payment:",ge))}finally{s.value=!1}},ie=G(()=>!se.value||Object.keys(se.value).length===0?0:M.value.filter(V=>V.type==="income").reduce((V,u)=>V+ye(parseFloat(u.amount||0),u.currency,h.value),0)),we=G(()=>!se.value||Object.keys(se.value).length===0?0:M.value.filter(V=>V.type==="expense").reduce((V,u)=>V+ye(parseFloat(u.amount||0),u.currency,h.value),0)),_e=G(()=>!se.value||Object.keys(se.value).length===0?0:M.value.filter(V=>V.type==="bonus").reduce((V,u)=>V+ye(parseFloat(u.amount||0),u.currency,h.value),0)),We=G(()=>Z(ie.value,h.value)),Je=G(()=>Z(we.value,h.value)),Xe=G(()=>Z(_e.value,h.value)),Qe=G(()=>{if(!se.value||Object.keys(se.value).length===0)return Z(0,h.value);const V=we.value+_e.value;return Z(ie.value-V,h.value)}),Ze=G(()=>ie.value===0?"0.00%":`${(we.value/ie.value*100).toFixed(2)}%`),et=G(()=>ie.value===0?"0.00%":`${((we.value+_e.value)/ie.value*100).toFixed(2)}%`),tt=G(()=>{if(ie.value<=0)return Z(0,h.value);const V=ie.value*ze;return Z(V,h.value)}),at=G(()=>{const V=M.value.filter(H=>(H.type==="expense"||H.type==="bonus")&&H.is_paid&&H.payment_date);if(V.length===0)return"N/A";const u=V.reduce((H,re)=>new Date(re.payment_date)>new Date(H.payment_date)?re:H);return new Date(u.payment_date).toLocaleDateString()}),st=G(()=>{const V=M.value.filter(H=>H.type==="income"&&H.payment_date);if(V.length===0)return"N/A";const u=V.reduce((H,re)=>new Date(re.payment_date)>new Date(H.payment_date)?re:H);return new Date(u.payment_date).toLocaleDateString()});return me(async()=>{const V=localStorage.getItem("displayCurrency");V&&(h.value=V),await Ve(),q(),z(),B()}),oe([()=>b.projectId,h,se],()=>{b.projectId&&se.value&&Object.keys(se.value).length>0&&(q(),z())},{deep:!0}),oe(h,V=>{V&&localStorage.setItem("displayCurrency",V)},{deep:!0}),(V,u)=>{var H,re,ge,xe,ke,Ie,De,Ue;return o(),i("div",il,[r.value?(o(),i("div",dl,S(r.value),1)):x("",!0),$(v)||$(_)?(o(),i("div",ul,[e("div",cl,[e("div",ml,[u[14]||(u[14]=e("span",{class:"text-sm font-medium text-gray-700 mr-2"},"Currency:",-1)),l(ee,{id:"transactions-display-currency-switcher",modelValue:$(h),"onUpdate:modelValue":u[0]||(u[0]=I=>Ke(h)?h.value=I:null),options:L,"value-key":"value","label-key":"label",class:"w-24"},null,8,["modelValue"])]),u[25]||(u[25]=e("h4",{class:"text-md font-medium text-gray-700 mb-2"},"Summary",-1)),e("div",vl,[e("div",pl,[u[15]||(u[15]=e("p",{class:"text-sm text-gray-600"},"Total Income",-1)),e("p",gl,S(We.value),1)]),e("div",{class:"p-3 bg-indigo-100 rounded-md cursor-pointer",onClick:u[3]||(u[3]=I=>f.value=!0)},[e("div",yl,[u[17]||(u[17]=e("p",{class:"text-sm text-gray-600"},"Expendable Budget",-1)),f.value?(o(),i("button",{key:0,onClick:je(C,["stop"]),class:"text-indigo-700 hover:text-indigo-900",title:"Save"},u[16]||(u[16]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-7.25 7.25a1 1 0 01-1.414 0l-3-3a1 1 0 111.414-1.414l2.293 2.293 6.543-6.543a1 1 0 011.414 0z","clip-rule":"evenodd"})],-1)]))):x("",!0)]),f.value?(o(),i("div",xl,[e("div",null,[l(N,{for:"expendable_amount",value:"Amount"}),l(K,{id:"expendable_amount",type:"number",modelValue:c.value,"onUpdate:modelValue":u[1]||(u[1]=I=>c.value=I),class:"mt-1 block w-full"},null,8,["modelValue"]),l(R,{message:(H=F.value.amount)==null?void 0:H[0],class:"mt-1"},null,8,["message"])]),e("div",null,[l(N,{for:"expendable_currency",value:"Currency"}),l(ee,{id:"expendable_currency",modelValue:y.value,"onUpdate:modelValue":u[2]||(u[2]=I=>y.value=I),options:L,"value-key":"value","label-key":"label",class:"mt-1 block w-full"},null,8,["modelValue"])])])):(o(),i("div",fl,[e("p",bl,S(c.value!==null?$(Z)(Number(c.value),y.value):"Not set"),1),c.value!==null&&y.value.toUpperCase()!==$(h).toUpperCase()?(o(),i("p",wl," ("+S($(Z)($(ye)(Number(c.value),y.value,$(h)),$(h)))+") ",1)):x("",!0)]))]),e("div",hl,[u[18]||(u[18]=e("p",{class:"text-sm text-gray-600"},"Total Expenses",-1)),e("p",_l,S(Je.value),1),e("p",kl,"("+S(Ze.value)+" of Income)",1)]),e("div",jl,[u[19]||(u[19]=e("p",{class:"text-sm text-gray-600"},"Total Bonuses",-1)),e("p",Pl,S(Xe.value),1)]),e("div",$l,[u[20]||(u[20]=e("p",{class:"text-sm text-gray-600"},"Balance",-1)),e("p",Vl,S(Qe.value),1)]),e("div",Sl,[u[21]||(u[21]=e("p",{class:"text-sm text-gray-600"},"Expense + Bonus",-1)),e("p",Cl,S($(Z)(we.value+_e.value,$(h))),1),e("p",Il,"("+S(et.value)+" of Income)",1)]),e("div",Dl,[u[22]||(u[22]=e("p",{class:"text-sm font-medium text-orange-800"},"Estimated Income Tax (AUD)",-1)),e("p",Ul,S(tt.value),1),e("p",Ml," (Based on "+S((ze*100).toFixed(1))+"% of Total Income. This is an estimation.) ",1)]),e("div",Al,[u[23]||(u[23]=e("p",{class:"text-sm font-medium text-gray-800"},"Last Payment Received Date",-1)),e("p",Nl,S(st.value),1)]),e("div",Tl,[u[24]||(u[24]=e("p",{class:"text-sm font-medium text-gray-800"},"Last Payment Sent Date",-1)),e("p",Bl,S(at.value),1)])])]),u[26]||(u[26]=e("h4",{class:"text-md font-medium text-gray-700 mb-4"},"Add Transaction",-1)),e("div",Rl,[e("div",null,[l(N,{for:"description",value:"Description"}),l(K,{id:"description",modelValue:p.value.description,"onUpdate:modelValue":u[4]||(u[4]=I=>p.value.description=I),class:"mt-1 block w-full",disabled:s.value},null,8,["modelValue","disabled"]),l(R,{message:(re=g.value.description)==null?void 0:re[0],class:"mt-2"},null,8,["message"])]),e("div",null,[l(N,{for:"amount",value:"Amount"}),l(K,{id:"amount",type:"number",modelValue:p.value.amount,"onUpdate:modelValue":u[5]||(u[5]=I=>p.value.amount=I),class:"mt-1 block w-full",disabled:s.value},null,8,["modelValue","disabled"]),l(R,{message:(ge=g.value.amount)==null?void 0:ge[0],class:"mt-2"},null,8,["message"])]),e("div",null,[l(N,{for:"currency",value:"Currency"}),l(ee,{id:"currency",modelValue:p.value.currency,"onUpdate:modelValue":u[6]||(u[6]=I=>p.value.currency=I),options:L,disabled:s.value},null,8,["modelValue","disabled"]),l(R,{message:(xe=g.value.currency)==null?void 0:xe[0],class:"mt-2"},null,8,["message"])]),e("div",null,[l(N,{for:"type",value:"Type"}),l(ee,{id:"type",modelValue:p.value.type,"onUpdate:modelValue":u[7]||(u[7]=I=>p.value.type=I),options:m,disabled:s.value||!$(v)&&p.value.type==="expense"&&p.value.type!=="bonus"||!$(_)&&p.value.type==="income"},null,8,["modelValue","disabled"]),l(R,{message:(ke=g.value.type)==null?void 0:ke[0],class:"mt-2"},null,8,["message"])]),e("div",null,[l(rl,{modelValue:p.value.transaction_type,"onUpdate:modelValue":u[8]||(u[8]=I=>p.value.transaction_type=I),label:"Transaction Type",placeholder:"Select or add a transaction type",disabled:s.value,required:!0,"search-url":"/api/transaction-types/search"},null,8,["modelValue","disabled"]),l(R,{message:(Ie=g.value.transaction_type_id)==null?void 0:Ie[0],class:"mt-2"},null,8,["message"])]),p.value.type==="expense"||p.value.type==="bonus"?(o(),i("div",El,[l(N,{for:"user_id",value:"User"}),l(ee,{id:"user_id",modelValue:p.value.user_id,"onUpdate:modelValue":u[9]||(u[9]=I=>p.value.user_id=I),options:d.value,disabled:s.value||!D.value.length,placeholder:"Select a user"},null,8,["modelValue","options","disabled"]),l(R,{message:(De=g.value.user_id)==null?void 0:De[0],class:"mt-2"},null,8,["message"])])):x("",!0),p.value.type==="expense"||p.value.type==="bonus"?(o(),i("div",Ol,[l(N,{for:"hours_spent",value:"Hours Spent (Optional)"}),l(K,{id:"hours_spent",type:"number",modelValue:p.value.hours_spent,"onUpdate:modelValue":u[10]||(u[10]=I=>p.value.hours_spent=I),class:"mt-1 block w-full",disabled:s.value},null,8,["modelValue","disabled"]),l(R,{message:(Ue=g.value.hours_spent)==null?void 0:Ue[0],class:"mt-2"},null,8,["message"])])):x("",!0)]),e("div",Fl,[l(ne,{onClick:te,disabled:s.value},{default:Y(()=>[E(S(s.value?"Saving...":"Save Transaction"),1)]),_:1},8,["disabled"])])])):x("",!0),$(U)?(o(),i("div",Ll,[u[30]||(u[30]=e("h4",{class:"text-md font-medium text-gray-700 mb-4"},"Transaction History",-1)),s.value?(o(),i("div",zl,u[27]||(u[27]=[e("div",{class:"h-4 bg-gray-200 rounded animate-pulse w-full"},null,-1),e("div",{class:"h-4 bg-gray-200 rounded animate-pulse w-5/6"},null,-1),e("div",{class:"h-4 bg-gray-200 rounded animate-pulse w-3/4"},null,-1)]))):M.value.length===0?(o(),i("div",ql," No transactions found for this project. ")):(o(),i("div",Kl,[(o(!0),i(ue,null,ce(M.value,(I,Me)=>{var Ae,Ne,Te,Be;return o(),i("div",{key:I.id,class:Q([{"bg-green-50 border-green-200":I.type==="income","bg-red-50 border-red-200":I.type==="expense","bg-purple-50 border-purple-200":I.type==="bonus","border-l-4":!0},"p-4 rounded-md shadow-sm transition-all duration-200 ease-in-out hover:shadow-md"])},[e("div",Hl,[e("div",Gl,[e("p",Yl,S(I.description),1),e("p",Wl,[E(S(I.type==="income"?"Income":I.type==="expense"?"Expense":"Bonus")+" on "+S(new Date(I.created_at).toLocaleDateString())+" ",1),I.transaction_type&&I.transaction_type.name?(o(),i("span",Jl,"• Type: "+S(I.transaction_type.name),1)):x("",!0)])]),e("div",Xl,[e("p",{class:Q(["text-lg font-bold",{"text-green-700":I.type==="income","text-red-700":I.type==="expense","text-purple-700":I.type==="bonus"}])},S($(Z)(I.amount,I.currency)),3),I.currency.toUpperCase()!==$(h).toUpperCase()?(o(),i("p",Ql," ("+S($(Z)($(ye)(I.amount,I.currency,$(h)),$(h)))+") ",1)):x("",!0),e("span",{class:Q(["block text-xs mt-1",I.is_paid?"text-green-600":"text-red-600"])},S(I.is_paid?"Paid":"Unpaid"),3)])]),e("div",Zl,[e("div",null,[I.user_id?(o(),i("span",eo,"User: "+S(((Ae=I.user)==null?void 0:Ae.name)||((Ne=D.value.find(pe=>pe.id===I.user_id))==null?void 0:Ne.name)||"Unknown"),1)):x("",!0),I.hours_spent?(o(),i("span",to,"Hours: "+S(I.hours_spent),1)):x("",!0),(I.type==="expense"||I.type==="bonus")&&ie.value>0?(o(),i("span",ao,S(($(ye)(I.amount,I.currency,$(h))/ie.value*100).toFixed(2))+"% of Income ",1)):x("",!0)]),e("div",so,[!I.is_paid&&($(v)||$(_))?(o(),ae(fe,{key:0,onClick:pe=>Ge(Me),class:Q({"text-green-600":I.type!=="income","text-blue-600":I.type==="income"})},{default:Y(()=>[E(S(I.type==="income"?"Receive":"Pay"),1)]),_:2},1032,["onClick","class"])):x("",!0),$(v)||$(_)?(o(),ae(fe,{key:1,onClick:pe=>ve(Me),class:"text-red-600"},{default:Y(()=>u[28]||(u[28]=[E(" Delete ",-1)])),_:2,__:[28]},1032,["onClick"])):x("",!0)])]),n.value===I.id?(o(),i("div",lo,[e("h4",oo,S(I.type==="income"?"Record Receipt":"Make Payment"),1),e("div",no,[l(N,{for:"payment_date",value:"Date"}),l(K,{id:"payment_date",type:"date",modelValue:k.value,"onUpdate:modelValue":u[11]||(u[11]=pe=>k.value=pe),class:"mt-1 block w-full",disabled:s.value},null,8,["modelValue","disabled"]),l(R,{message:(Te=W.value.date)==null?void 0:Te[0],class:"mt-2"},null,8,["message"])]),e("div",ro,[e("label",io,[he(e("input",{type:"checkbox","onUpdate:modelValue":u[12]||(u[12]=pe=>T.value=pe),class:"mr-2 rounded text-blue-600 focus:ring-blue-500",disabled:s.value},null,8,uo),[[rt,T.value]]),e("span",co,S(I.type==="income"?"Receive in Full":"Pay in Full"),1)])]),T.value?x("",!0):(o(),i("div",mo,[l(N,{for:"payment_amount",value:"Amount"}),l(K,{id:"payment_amount",type:"number",modelValue:j.value,"onUpdate:modelValue":u[13]||(u[13]=pe=>j.value=pe),class:"mt-1 block w-full",disabled:s.value,placeholder:"Enter partial "+(I.type==="income"?"receipt":"payment")+" amount (Max: "+$(Z)(I.amount,I.currency)+")"},null,8,["modelValue","disabled","placeholder"]),l(R,{message:(Be=W.value.amount)==null?void 0:Be[0],class:"mt-2"},null,8,["message"])])),e("div",vo,[l(fe,{onClick:Ce,disabled:s.value},{default:Y(()=>u[29]||(u[29]=[E(" Cancel ",-1)])),_:1,__:[29]},8,["disabled"]),l(ne,{onClick:Ye,disabled:s.value},{default:Y(()=>[E(S(s.value?"Processing...":I.type==="income"?"Record Receipt":"Submit Payment"),1)]),_:2},1032,["disabled"])])])):x("",!0)],2)}),128))]))])):x("",!0)])}}},go={class:"mb-6 p-4 bg-indigo-50 rounded-lg border border-indigo-100 flex items-center justify-between gap-4"},yo={class:"text-2xl font-semibold text-indigo-800"},fo={class:"w-48"},bo={key:0,class:"mb-6 p-4 border rounded-lg"},wo={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},xo={class:"flex items-end"},ho={class:"md:col-span-4"},_o={class:"space-y-3"},ko={key:0,class:"text-gray-500"},jo={key:1,class:"text-gray-500"},Po={class:"font-medium"},$o={key:0,class:"text-sm text-gray-600"},Vo={class:"text-sm text-gray-700 mt-1"},So={key:0,class:"text-gray-500"},Co={class:"flex items-center gap-3"},Io={__name:"ProjectExpendables",props:{projectId:{type:[Number,String],required:!0},userProjectRole:{type:Object,default:()=>({})}},setup(t){const b=t,{canView:a,canManage:w}=Se(()=>b.projectId),v=a("project_expendable",b.userProjectRole),_=w("project_expendable",b.userProjectRole),U=P([]),M=P(!1),D=P({name:"",description:"",amount:"",currency:"PKR",status:"active"}),g=P({}),r=P(!1),s=[{value:"PKR",label:"PKR"},{value:"USD",label:"USD"},{value:"EUR",label:"EUR"},{value:"GBP",label:"GBP"},{value:"AUD",label:"AUD"},{value:"INR",label:"INR"}],n=He,j=G(()=>!se.value||Object.keys(se.value).length===0?0:U.value.reduce((k,p)=>k+ye(Number(p.amount||0),p.currency,n.value),0));async function T(){if(v.value){M.value=!0;try{const{data:k}=await window.axios.get(`/api/projects/${b.projectId}/expendables`);U.value=k||[]}catch(k){console.error(k)}finally{M.value=!1}}}async function W(){var k,p,h;g.value={},r.value=!0;try{const L={...D.value,amount:Number(D.value.amount)},{data:c}=await window.axios.post(`/api/projects/${b.projectId}/expendables`,L);U.value.unshift(c),D.value={name:"",description:"",amount:"",currency:D.value.currency,status:"active"},le("Expendable created")}catch(L){((k=L.response)==null?void 0:k.status)===422?g.value=L.response.data.errors||{}:(h=(p=L.response)==null?void 0:p.data)!=null&&h.message?O(L.response.data.message):O("Failed to create expendable")}finally{r.value=!1}}async function J(k){if(confirm("Delete this expendable?"))try{await window.axios.delete(`/api/projects/${b.projectId}/expendables/${k.id}`),U.value=U.value.filter(p=>p.id!==k.id),le("Deleted")}catch(p){O("Failed to delete"),console.error(p)}}return me(async()=>{const k=localStorage.getItem("displayCurrency");k&&(n.value=k),await Ve(),await T()}),oe(n,k=>{k&&localStorage.setItem("displayCurrency",k)}),(k,p)=>{var h,L,c,y;return o(),i("div",null,[e("div",go,[e("div",null,[p[5]||(p[5]=e("div",{class:"text-sm text-gray-600"},"Total Expendables",-1)),e("div",yo,S($(Z)(j.value,$(n))),1)]),e("div",fo,[l(N,{for:"display_currency",value:"Display Currency"}),l(ee,{id:"display_currency",modelValue:$(n),"onUpdate:modelValue":p[0]||(p[0]=f=>Ke(n)?n.value=f:null),options:s,"value-key":"value","label-key":"label",class:"mt-1 w-full"},null,8,["modelValue"])])]),$(_)?(o(),i("div",bo,[e("div",wo,[e("div",null,[l(N,{for:"name",value:"Name"}),l(K,{id:"name",modelValue:D.value.name,"onUpdate:modelValue":p[1]||(p[1]=f=>D.value.name=f),class:"mt-1 w-full",placeholder:"e.g., Asset Purchase"},null,8,["modelValue"]),l(R,{message:(h=g.value.name)==null?void 0:h[0],class:"mt-1"},null,8,["message"])]),e("div",null,[l(N,{for:"amount",value:"Amount"}),l(K,{id:"amount",type:"number",step:"0.01",modelValue:D.value.amount,"onUpdate:modelValue":p[2]||(p[2]=f=>D.value.amount=f),class:"mt-1 w-full"},null,8,["modelValue"]),l(R,{message:(L=g.value.amount)==null?void 0:L[0],class:"mt-1"},null,8,["message"])]),e("div",null,[l(N,{for:"currency",value:"Currency"}),l(ee,{id:"currency",modelValue:D.value.currency,"onUpdate:modelValue":p[3]||(p[3]=f=>D.value.currency=f),options:s,"value-key":"value","label-key":"label",class:"mt-1 w-full"},null,8,["modelValue"]),l(R,{message:(c=g.value.currency)==null?void 0:c[0],class:"mt-1"},null,8,["message"])]),e("div",xo,[l(ne,{disabled:r.value,onClick:W},{default:Y(()=>p[6]||(p[6]=[E("Add",-1)])),_:1,__:[6]},8,["disabled"])]),e("div",ho,[l(N,{for:"description",value:"Description (optional)"}),l(K,{id:"description",modelValue:D.value.description,"onUpdate:modelValue":p[4]||(p[4]=f=>D.value.description=f),class:"mt-1 w-full",placeholder:"Details"},null,8,["modelValue"]),l(R,{message:(y=g.value.description)==null?void 0:y[0],class:"mt-1"},null,8,["message"])])])])):x("",!0),e("div",_o,[M.value?(o(),i("div",ko,"Loading...")):U.value.length?x("",!0):(o(),i("div",jo,"No expendables yet.")),(o(!0),i(ue,null,ce(U.value,f=>(o(),i("div",{key:f.id,class:"p-4 border rounded-lg flex items-center justify-between"},[e("div",null,[e("div",Po,S(f.name),1),f.description?(o(),i("div",$o,S(f.description),1)):x("",!0),e("div",Vo,[E(S($(Z)(Number(f.amount),f.currency))+" ",1),f.currency&&f.currency.toUpperCase()!==$(n).toUpperCase()?(o(),i("span",So," ("+S($(Z)($(ye)(Number(f.amount),f.currency,$(n)),$(n)))+") ",1)):x("",!0)])]),e("div",Co,[e("span",{class:Q(["text-xs px-2 py-1 rounded-full",f.status==="active"?"bg-green-100 text-green-700":"bg-gray-100 text-gray-700"])},S(f.status||"active"),3),$(_)?(o(),ae(fe,{key:0,onClick:F=>J(f),class:"!text-red-600"},{default:Y(()=>p[7]||(p[7]=[E("Delete",-1)])),_:2,__:[7]},1032,["onClick"])):x("",!0)])]))),128))])])}}},Do={class:"p-6 w-full mx-auto bg-white rounded-xl shadow-2xl transition-all duration-300"},Uo={class:"border-b border-gray-200 mb-6"},Mo={class:"flex -mb-px space-x-4 overflow-x-auto pb-2"},Ao={class:"py-4"},Wo={__name:"ProjectForm",props:{projectId:{type:[Number,String],default:null},statusOptions:{type:Array,required:!0},departmentOptions:{type:Array,required:!0},sourceOptions:{type:Array,required:!0},clientRoleOptions:{type:Array,default:()=>[]},userRoleOptions:{type:Array,default:()=>[]},paymentTypeOptions:{type:Array,required:!0},errors:{type:Object,default:()=>({})},isSaving:{type:Boolean,default:!1}},emits:["close"],setup(t,{emit:b}){it();const a=t,w=P(a.projectId);oe(()=>a.projectId,te=>{w.value=te,te&&dt(te)},{immediate:!0}),ut(w);const v=ct(w),{canDo:_,canView:U,canManage:M}=Se(w),D=_("manage_projects",v);_("create_clients",v);const g=_("upload_project_documents",v),r=M("project_services_and_payments",v),s=_("add_project_notes",v),n=M("project_users",v),j=M("project_clients",v),T=_("manage_project_basic_details",v),W=U("project_documents",v),J=U("project_services_and_payments",v),k=U("project_notes",v),p=U("project_users",v),h=U("project_clients",v),L=U("project_transactions",v),c=U("project_expendable",v),y=M("project_expendable",v),f=U("project_deliverables"),F=M("project_deliverables"),B=P("basic"),C=G(()=>h.value&&p.value?"Clients and Users":h.value?"Clients":p.value?"Users":"Clients and Users"),m=P([]),d=P([]),A=P([]),z=P([]),q=te=>{if(te!=="basic"&&!a.projectId){mt("Please create the project first before managing this section."),B.value="basic";return}B.value=te};return me(async()=>{try{m.value=await Fe("client"),d.value=await Fe("project"),A.value=await Pt(!0,null),z.value=await $t(!0,null)}catch(te){console.error("Error fetching global data for ProjectForm:",te)}}),(te,X)=>(o(),i("div",Do,[X[8]||(X[8]=e("div",{class:"flex justify-between items-center pb-4 mb-6 border-b border-gray-200"},[e("h2",{class:"text-2xl font-semibold text-gray-800"},"Edit Project")],-1)),e("div",Uo,[e("nav",Mo,[e("button",{onClick:X[0]||(X[0]=ve=>q("basic")),class:Q(["py-3 px-5 text-center border-b-2 font-medium text-base rounded-t-lg transition-colors duration-200 whitespace-nowrap",B.value==="basic"?"border-indigo-600 text-indigo-700 bg-indigo-50":"border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300 hover:bg-gray-50"])}," Basic Information ",2),t.projectId&&($(h)||$(p))?(o(),i("button",{key:0,onClick:X[1]||(X[1]=ve=>q("client")),class:Q(["py-3 px-5 text-center border-b-2 font-medium text-base rounded-t-lg transition-colors duration-200 whitespace-nowrap",B.value==="client"?"border-indigo-600 text-indigo-700 bg-indigo-50":"border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300 hover:bg-gray-50"])},S(C.value),3)):x("",!0),t.projectId&&($(r)||$(J))?(o(),i("button",{key:1,onClick:X[2]||(X[2]=ve=>q("services")),class:Q(["py-3 px-5 text-center border-b-2 font-medium text-base rounded-t-lg transition-colors duration-200 whitespace-nowrap",B.value==="services"?"border-indigo-600 text-indigo-700 bg-indigo-50":"border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300 hover:bg-gray-50"])}," Services & Payment ",2)):x("",!0),t.projectId&&$(L)?(o(),i("button",{key:2,onClick:X[3]||(X[3]=ve=>q("transactions")),class:Q(["py-3 px-5 text-center border-b-2 font-medium text-base rounded-t-lg transition-colors duration-200 whitespace-nowrap",B.value==="transactions"?"border-indigo-600 text-indigo-700 bg-indigo-50":"border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300 hover:bg-gray-50"])}," Transactions ",2)):x("",!0),t.projectId&&($(y)||$(c))?(o(),i("button",{key:3,onClick:X[4]||(X[4]=ve=>q("expendables")),class:Q(["py-3 px-5 text-center border-b-2 font-medium text-base rounded-t-lg transition-colors duration-200 whitespace-nowrap",B.value==="expendables"?"border-indigo-600 text-indigo-700 bg-indigo-50":"border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300 hover:bg-gray-50"])}," Expendables ",2)):x("",!0),t.projectId&&$(W)?(o(),i("button",{key:4,onClick:X[5]||(X[5]=ve=>q("documents")),class:Q(["py-3 px-5 text-center border-b-2 font-medium text-base rounded-t-lg transition-colors duration-200 whitespace-nowrap",B.value==="documents"?"border-indigo-600 text-indigo-700 bg-indigo-50":"border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300 hover:bg-gray-50"])}," Documents ",2)):x("",!0),t.projectId&&($(s)||$(k))?(o(),i("button",{key:5,onClick:X[6]||(X[6]=ve=>q("notes")),class:Q(["py-3 px-5 text-center border-b-2 font-medium text-base rounded-t-lg transition-colors duration-200 whitespace-nowrap",B.value==="notes"?"border-indigo-600 text-indigo-700 bg-indigo-50":"border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300 hover:bg-gray-50"])}," Notes ",2)):x("",!0),t.projectId&&($(F)||$(f))?(o(),i("button",{key:6,onClick:X[7]||(X[7]=ve=>q("deliverables")),class:Q(["py-3 px-5 text-center border-b-2 font-medium text-base rounded-t-lg transition-colors duration-200 whitespace-nowrap",B.value==="deliverables"?"border-indigo-600 text-indigo-700 bg-indigo-50":"border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300 hover:bg-gray-50"])}," Deliverables ",2)):x("",!0)])]),e("div",Ao,[B.value==="basic"?(o(),ae(Kt,{key:0,projectId:t.projectId,errors:a.errors,statusOptions:t.statusOptions,sourceOptions:t.sourceOptions,canManageProjects:$(D),canManageProjectBasicDetails:$(T),isSaving:a.isSaving},null,8,["projectId","errors","statusOptions","sourceOptions","canManageProjects","canManageProjectBasicDetails","isSaving"])):x("",!0),B.value==="client"?(o(),ae(ga,{key:1,projectId:t.projectId,errors:a.errors,clientRoleOptions:m.value,userRoleOptions:d.value,clients:A.value,users:z.value,canViewProjectClients:$(h),canManageProjectClients:$(j),canViewProjectUsers:$(p),canManageProjectUsers:$(n),isSaving:a.isSaving},null,8,["projectId","errors","clientRoleOptions","userRoleOptions","clients","users","canViewProjectClients","canManageProjectClients","canViewProjectUsers","canManageProjectUsers","isSaving"])):x("",!0),B.value==="services"?(o(),ae(Zs,{key:2,projectId:t.projectId,departmentOptions:t.departmentOptions,paymentTypeOptions:t.paymentTypeOptions,canManageProjectServicesAndPayments:$(r),canViewProjectServicesAndPayments:$(J),isSaving:a.isSaving},null,8,["projectId","departmentOptions","paymentTypeOptions","canManageProjectServicesAndPayments","canViewProjectServicesAndPayments","isSaving"])):x("",!0),B.value==="expendables"?(o(),ae(Io,{key:3,"project-id":t.projectId,"user-project-role":$(v)},null,8,["project-id","user-project-role"])):x("",!0),B.value==="transactions"&&$(L)?(o(),ae(po,{key:4,projectId:t.projectId,userProjectRole:$(v),isSaving:a.isSaving},null,8,["projectId","userProjectRole","isSaving"])):x("",!0),B.value==="documents"?(o(),ae(Aa,{key:5,projectId:t.projectId,errors:a.errors,canUploadProjectDocuments:$(g),canViewProjectDocuments:$(W),isSaving:a.isSaving},null,8,["projectId","errors","canUploadProjectDocuments","canViewProjectDocuments","isSaving"])):x("",!0),B.value==="notes"?(o(),ae(Wa,{key:6,projectId:t.projectId,errors:a.errors,canAddProjectNotes:$(s),canViewProjectNotes:$(k),"is-saving":a.isSaving},null,8,["projectId","errors","canAddProjectNotes","canViewProjectNotes","is-saving"])):x("",!0),B.value==="deliverables"?(o(),ae(ps,{key:7,projectId:t.projectId,errors:a.errors,canManageProjectDeliverables:$(F),canViewProjectDeliverables:$(f),isSaving:a.isSaving},null,8,["projectId","errors","canManageProjectDeliverables","canViewProjectDeliverables","isSaving"])):x("",!0)])]))}};export{Wo as _};
