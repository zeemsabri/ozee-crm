import{a as i,o as n,b as e,r as w,c as C,e as ue,g as J,w as K,i as A,d as p,I as H,t as g,J as Ge,K as Ce,m as F,j as Z,y as X,F as ee,l as oe,x as Xe,A as ht,u as c,n as wt,k as we,q as _t,f as kt,h as Ct,z as $t,L as Dt,G as jt,M as ce,N as Mt}from"./app-BiOytpE3.js";import{B as ve,a as St,_ as At}from"./AuthenticatedLayout-DNresLjS.js";import{S as me}from"./SelectDropdown-CyyaWJSZ.js";import{P as ie}from"./PrimaryButton-dYCZ56-l.js";import{_ as Je}from"./SecondaryButton-D5M_Erpa.js";import{c as Q,a as pe,d as Bt,f as W,b as Pt}from"./currency-C-TOr6-1.js";import{_ as te}from"./InputLabel-qmyj_yOj.js";import{_ as le}from"./TextInput-IXbIsRwW.js";import{_ as se}from"./InputError-BmEkisOc.js";import{_ as Tt}from"./Modal-D1Igk1ma.js";import{r as _e,a as Lt}from"./PlusIcon-WDdiRO0K.js";import{r as Vt}from"./MagnifyingGlassIcon-BqyqO1jI.js";import{a as ke,r as Nt}from"./PlusCircleIcon-W5lf2Ndq.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./Checkbox-DJCaPpRb.js";import"./ApplicationLogo-BAphCQ3T.js";import"./DangerButton-BCGhqPOm.js";import"./moment-BLMuvzoS.js";function ze(k,R){return n(),i("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9 12.75 11.25 15 15 9.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"})])}function Rt(k,R){return n(),i("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m19.5 8.25-7.5 7.5-7.5-7.5"})])}function It(k,R){return n(),i("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z"})])}function Ft(k,R){return n(),i("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"})])}function Ut(k,R){return n(),i("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M21 12a2.25 2.25 0 0 0-2.25-2.25H15a3 3 0 1 1-6 0H5.25A2.25 2.25 0 0 0 3 12m18 0v6a2.25 2.25 0 0 1-2.25 2.25H5.25A2.25 2.25 0 0 1 3 18v-6m18 0V9M3 12V9m18 0a2.25 2.25 0 0 0-2.25-2.25H5.25A2.25 2.25 0 0 0 3 9m18 0V6a2.25 2.25 0 0 0-2.25-2.25H5.25A2.25 2.25 0 0 0 3 6v3"})])}function Et(k,R){return n(),i("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m9.75 9.75 4.5 4.5m0-4.5-4.5 4.5M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"})])}const qt={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ot={key:0},Ht={class:"md:col-span-2"},Ze={__name:"MilestoneExpendableModal",props:{show:Boolean,title:String,milestone:Object,users:Object,currencyOptions:Array,isBudgetForm:{type:Boolean,default:!1},isUserSelectionRequired:{type:Boolean,default:!1},projectTotalBudget:Number,projectBudgetCurrency:String,milestoneStats:Object},emits:["close","submitted"],setup(k,{emit:R}){const l=k,N=R,o=w({}),b=w(""),M=w("post"),$=w(""),B=w(""),h=w({}),V=C(()=>{var S;return((Array.isArray((S=l.users)==null?void 0:S.users)?l.users.users:l.users)||[]).map(u=>({value:u.id,label:u.name}))});ue(()=>l.show,r=>{r&&l.milestone&&(h.value={},l.isBudgetForm?(o.value=l.milestone.budget?{...l.milestone.budget,amount:Number(l.milestone.budget.amount)}:{name:"Milestone Budget",description:"",amount:"",currency:"PKR"},b.value=l.milestone.budget?`/api/projects/${l.milestone.project_id}/expendables/${l.milestone.budget.id}`:`/api/projects/${l.milestone.project_id}/expendables`,M.value=l.milestone.budget?"put":"post",$.value=l.milestone.budget?"Update Budget":"Create Budget",B.value=l.milestone.budget?"Milestone budget updated successfully":"Milestone budget created successfully"):(o.value={name:"",description:"",amount:"",currency:"PKR",user_id:null},b.value=`/api/projects/${l.milestone.project_id}/expendables`,M.value="post",$.value="Create Contract",B.value="Contract created and sent for approval"))},{immediate:!0,deep:!0});const T=()=>{var u,y;h.value={};let r=!1;o.value.name||(h.value.name=["Name is required."],r=!0),(!o.value.amount||Number(o.value.amount)<=0)&&(h.value.amount=h.value.amount||[],h.value.amount.push("Amount must be a positive number."),r=!0),l.isUserSelectionRequired&&!o.value.user_id&&(h.value.user_id=["User selection is required for contracts."],r=!0),Q(Number(o.value.amount||0),o.value.currency,l.projectBudgetCurrency);const S=Q(Number(o.value.amount||0),o.value.currency,((u=l.milestone.budget)==null?void 0:u.currency)||"PKR");if(l.isBudgetForm){l.projectTotalBudget<=0&&(H("No project budget left. Ask a project admin to add more budget."),r=!0);const f=l.milestone.budget?Q(Number(l.milestone.budget.amount||0),l.milestone.budget.currency,l.projectBudgetCurrency):0;l.milestoneStats.approvedAmt+(S-f)>Q(l.projectTotalBudget,l.projectBudgetCurrency,((y=l.milestone.budget)==null?void 0:y.currency)||"PKR")&&(h.value.amount=["Cannot add more budget than the project's total expendable budget."],r=!0)}else S>l.milestoneStats.remaining&&(h.value.amount=["Cannot add a contract more than the remaining milestone budget."],r=!0);return!r},E=r=>({...r,amount:Number(r.amount||0),user_id:l.isBudgetForm?null:r.user_id,expendable_type:"Milestone",expendable_id:l.milestone.id}),I=r=>{N("submitted",r)},q=()=>{N("close")};return(r,S)=>(n(),J(ve,{show:k.show,title:k.title,"api-endpoint":b.value,"http-method":M.value,"form-data":o.value,"submit-button-text":$.value,"success-message":B.value,"format-data-for-api":E,"before-submit":T,onSubmitted:I,onClose:q},{default:K(({errors:u})=>{var y,f,U,D,m,v,Y,d,j,L;return[e("div",qt,[e("div",null,[p(te,{for:"name",value:"Name"}),p(le,{id:"name",modelValue:o.value.name,"onUpdate:modelValue":S[0]||(S[0]=O=>o.value.name=O),class:"mt-1 w-full",placeholder:"e.g., Asset Purchase"},null,8,["modelValue"]),p(se,{message:((y=h.value.name)==null?void 0:y[0])||((f=u.name)==null?void 0:f[0]),class:"mt-1"},null,8,["message"])]),e("div",null,[p(te,{for:"amount",value:"Amount"}),p(le,{id:"amount",type:"number",step:"0.01",modelValue:o.value.amount,"onUpdate:modelValue":S[1]||(S[1]=O=>o.value.amount=O),class:"mt-1 w-full"},null,8,["modelValue"]),p(se,{message:((U=h.value.amount)==null?void 0:U[0])||((D=u.amount)==null?void 0:D[0]),class:"mt-1"},null,8,["message"])]),e("div",null,[p(te,{for:"currency",value:"Currency"}),p(me,{id:"currency",modelValue:o.value.currency,"onUpdate:modelValue":S[2]||(S[2]=O=>o.value.currency=O),options:k.currencyOptions,"value-key":"value","label-key":"label",class:"mt-1 w-full"},null,8,["modelValue","options"]),p(se,{message:((m=h.value.currency)==null?void 0:m[0])||((v=u.currency)==null?void 0:v[0]),class:"mt-1"},null,8,["message"])]),k.isBudgetForm?A("",!0):(n(),i("div",Ot,[p(te,{for:"user",value:"User"}),p(me,{id:"user",modelValue:o.value.user_id,"onUpdate:modelValue":S[3]||(S[3]=O=>o.value.user_id=O),options:V.value,"value-key":"value","label-key":"label",class:"mt-1 w-full",placeholder:"Select user"},null,8,["modelValue","options"]),p(se,{message:((Y=h.value.user_id)==null?void 0:Y[0])||((d=u.user_id)==null?void 0:d[0]),class:"mt-1"},null,8,["message"])])),e("div",Ht,[p(te,{for:"description",value:"Description (optional)"}),p(le,{id:"description",modelValue:o.value.description,"onUpdate:modelValue":S[4]||(S[4]=O=>o.value.description=O),class:"mt-1 w-full",placeholder:"Details"},null,8,["modelValue"]),p(se,{message:((j=h.value.description)==null?void 0:j[0])||((L=u.description)==null?void 0:L[0]),class:"mt-1"},null,8,["message"])])])]}),_:1},8,["show","title","api-endpoint","http-method","form-data","submit-button-text","success-message"]))}},Kt={class:"text-sm text-gray-600 mb-4"},Yt={class:"mt-2"},zt={__name:"ReasonModal",props:{show:{type:Boolean,default:!1},title:{type:String,default:"Reason Required"},message:{type:String,required:!0},type:{type:String,default:"info",validator:k=>["info","warning"].includes(k)},apiEndpoint:{type:String,required:!0},httpMethod:{type:String,required:!0}},emits:["submitted","close"],setup(k,{emit:R}){const l=k,N=R,o=w({reason:""}),b=w({}),M=()=>!o.value.reason||!o.value.reason.trim()?(H("Reason is required."),b.value.reason=["Reason is required."],!1):(b.value={},!0),$=()=>{N("submitted")},B=()=>{N("close")};return ue(()=>l.show,h=>{h&&(o.value={reason:""},b.value={})}),(h,V)=>(n(),J(ve,{show:k.show,title:k.title,"api-endpoint":k.apiEndpoint,"http-method":k.httpMethod,"form-data":o.value,"submit-button-text":"Submit","success-message":"Operation successful!","before-submit":M,onClose:B,onSubmitted:$},{default:K(({errors:T})=>{var E,I;return[e("p",Kt,g(k.message),1),e("div",Yt,[p(te,{for:"reason-input",value:"Reason"}),p(le,{id:"reason-input",modelValue:o.value.reason,"onUpdate:modelValue":V[0]||(V[0]=q=>o.value.reason=q),class:"mt-1 block w-full",onKeyup:Ge($,["enter"])},null,8,["modelValue"]),p(se,{message:((E=T.reason)==null?void 0:E[0])||((I=b.value.reason)==null?void 0:I[0]),class:"mt-1"},null,8,["message"])])]}),_:1},8,["show","title","api-endpoint","http-method","form-data"]))}},Zt={class:"space-y-4"},Gt={key:1,id:"final-task-list",class:"space-y-3"},Xt={class:"flex items-center justify-between"},Jt={class:"flex-1"},Qt=["onClick"],Wt={key:0,class:"mt-0.5 text-xs text-gray-600 truncate"},es=["id","value","onBlur","onKeyup"],ts={class:"flex items-center space-x-2 ml-4"},ss=["onClick"],os=["onClick"],ns={key:0,class:"mt-4"},ls=["onUpdate:modelValue"],as={class:"flex flex-col sm:flex-row sm:items-center space-y-2 sm:space-y-0 sm:space-x-4 text-xs text-gray-500 mt-2"},rs={class:"flex items-center space-x-2"},is=["onClick"],us=["onClick"],ds=["value","onChange","min","max"],cs={class:"flex items-center space-x-2"},ps=["onClick"],ms=["onClick"],vs=["onClick"],gs={class:"flex justify-end space-x-3"},fs={__name:"BulkTaskModal",props:{show:{type:Boolean,default:!1},contractId:{type:Number,required:!0},completionDate:{type:String,required:!1,default:null}},emits:["close","tasks-submitted"],setup(k,{emit:R}){const l=k,N=R,o=Ce([]),b=w(""),M=w({show:!1,text:"",type:"success"}),$=new Date,B=new Date($);B.setDate($.getDate()+1);const h=w("");ue(()=>l.show,m=>{m||(o.splice(0,o.length),b.value="",h.value="",M.value={show:!1,text:"",type:"success"})});const V=()=>{h.value&&h.value.trim()!==""&&(o.push({name:h.value,dueDate:"",priority:"Medium",contract_id:l.contractId,description:"",isEditingName:!1,showDescription:!1}),h.value="",M.value.show=!1)},T=m=>{o.splice(m,1)},E=(m,v)=>{o[m].priority=v},I=(m,v)=>{const Y=new Date($.getFullYear(),$.getMonth(),$.getDate()),d=l.completionDate?new Date(l.completionDate):null,j=new Date(v);if(M.value.show=!1,d&&j>d){M.value={show:!0,text:"The selected due date is after the milestone completion date.",type:"error"},o[m].dueDate="";return}if(j<Y){M.value={show:!0,text:"The selected due date cannot be in the past.",type:"error"},o[m].dueDate="";return}o[m].dueDate=v},q=m=>{o[m].showDescription=!o[m].showDescription},r=m=>{o[m].isEditingName=!0,wt(()=>{document.getElementById(`task-name-input-${m}`).focus()})},S=(m,v)=>{v.trim()&&(o[m].name=v),o[m].isEditingName=!1},u=m=>({tasks:m}),y=C(()=>o.length===0||o.some(m=>!m.name.trim()||!m.dueDate||!m.priority)),f=m=>{console.log("Submitting tasks to API:",o),M.value={show:!0,text:"Tasks submitted successfully!",type:"success"},setTimeout(()=>{M.value.show=!1,N("tasks-submitted"),m()},1500)},U=C(()=>o),D=m=>{const v=l.completionDate?new Date(l.completionDate):null,Y=new Date($.getFullYear(),$.getMonth(),$.getDate()),d=new Date(m);return d>=Y&&(!v||d<=v)};return(m,v)=>(n(),J(ve,{show:k.show,title:"Create Tasks in Bulk","api-endpoint":"/api/tasks/bulk","http-method":"post","form-data":U.value,"format-data-for-api":u,"submit-button-text":"Create Tasks",onClose:v[1]||(v[1]=Y=>m.$emit("close")),onSubmitted:f},{default:K(({errors:Y})=>[e("div",Zt,[M.value.show?(n(),i("div",{key:0,class:Z(["mb-4 p-4 rounded-lg transition-all duration-300 ease-in-out",{"bg-green-100 text-green-700 border border-green-200":M.value.type==="success","bg-red-100 text-red-700 border border-red-200":M.value.type==="error"}])},g(M.value.text),3)):A("",!0),e("form",{onSubmit:X(V,["prevent"]),class:"relative"},[p(le,{modelValue:h.value,"onUpdate:modelValue":v[0]||(v[0]=d=>h.value=d),id:"task-name-input",placeholder:"e.g., 'Finish project report'",class:"w-full p-4 pr-12 text-lg border border-gray-300 rounded-xl focus:ring-indigo-500 focus:border-indigo-500 shadow-sm transition-all duration-200 ease-in-out"},null,8,["modelValue"]),v[2]||(v[2]=e("button",{type:"submit",class:"absolute right-4 top-1/2 -translate-y-1/2 p-2 text-indigo-600 hover:text-indigo-800"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})])],-1))],32),v[8]||(v[8]=e("hr",{class:"my-6 border-gray-200"},null,-1)),o.length>0?(n(),i("div",Gt,[v[7]||(v[7]=e("h2",{class:"text-lg font-semibold text-gray-800"},"Tasks to Create:",-1)),(n(!0),i(ee,null,oe(o,(d,j)=>(n(),i("div",{key:j,class:"flex flex-col p-4 bg-gray-50 rounded-xl border border-gray-200 group transition-all duration-200 ease-in-out"},[e("div",Xt,[e("div",Jt,[d.isEditingName?(n(),i("input",{key:1,id:`task-name-input-${j}`,type:"text",value:d.name,onBlur:L=>S(j,L.target.value),onKeyup:Ge(L=>S(j,L.target.value),["enter"]),class:"text-sm font-semibold text-gray-800 w-full rounded-md border-gray-300 focus:ring-indigo-500 focus:border-indigo-500 shadow-sm"},null,40,es)):(n(),i(ee,{key:0},[e("p",{onClick:L=>r(j),class:"text-sm font-semibold text-gray-800 truncate cursor-pointer hover:underline"},g(d.name),9,Qt),d.description&&d.description.trim().length?(n(),i("p",Wt,g(d.description),1)):A("",!0)],64))]),e("div",ts,[e("button",{type:"button",onClick:L=>q(j),class:Z(["p-1 rounded-full transition-all duration-200 ease-in-out",[d.showDescription||d.description&&d.description.trim().length?"text-indigo-600 hover:text-indigo-700":"text-gray-400 hover:text-indigo-500"]]),title:"Add description"},v[3]||(v[3]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",class:"h-5 w-5"},[e("path",{d:"M19.5 14.25h-15m15-5.25h-15M9 19.5H4.5A1.5 1.5 0 013 18V6a1.5 1.5 0 011.5-1.5H15L21 9v9a1.5 1.5 0 01-1.5 1.5H15"})],-1)]),10,ss),e("button",{type:"button",onClick:L=>T(j),class:"remove-final-task p-1 rounded-full text-red-500 opacity-0 group-hover:opacity-100 transition-all duration-200 ease-in-out"},v[4]||(v[4]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z","clip-rule":"evenodd"})],-1)]),8,os)])]),d.showDescription?(n(),i("div",ns,[Xe(e("textarea",{"onUpdate:modelValue":L=>d.description=L,rows:"2",placeholder:"Add an optional description...",class:"w-full rounded-md border-gray-300 focus:ring-indigo-500 focus:border-indigo-500 shadow-sm text-sm"},null,8,ls),[[ht,d.description]])])):A("",!0),e("div",as,[e("div",rs,[v[5]||(v[5]=e("span",{class:"font-medium"},"Due:",-1)),D(c($).toISOString().split("T")[0])?(n(),i("button",{key:0,type:"button",onClick:L=>I(j,c($).toISOString().split("T")[0]),class:Z(["px-2 py-0.5 rounded-full text-indigo-600 bg-indigo-100 text-xs hover:bg-indigo-200",{"bg-indigo-300 font-semibold":d.dueDate===c($).toISOString().split("T")[0]}])},"Today",10,is)):A("",!0),D(c(B).toISOString().split("T")[0])?(n(),i("button",{key:1,type:"button",onClick:L=>I(j,c(B).toISOString().split("T")[0]),class:Z(["px-2 py-0.5 rounded-full text-indigo-600 bg-indigo-100 text-xs hover:bg-indigo-200",{"bg-indigo-300 font-semibold":d.dueDate===c(B).toISOString().split("T")[0]}])},"Tomorrow",10,us)):A("",!0),e("input",{type:"date",value:d.dueDate,onChange:L=>I(j,L.target.value),min:c($).toISOString().split("T")[0],max:k.completionDate,required:"",class:Z([d.dueDate?"border-gray-300":"border-red-300","p-1 rounded-lg border text-xs focus:ring-indigo-500 focus:border-indigo-500 shadow-sm transition-all duration-200 ease-in-out"])},null,42,ds)]),e("div",cs,[v[6]||(v[6]=e("span",{class:"font-medium"},"Priority:",-1)),e("button",{type:"button",onClick:L=>E(j,"Low"),class:Z(["px-2 py-0.5 rounded-full text-gray-500 bg-gray-100 text-xs hover:bg-gray-200",{"bg-gray-200 font-semibold":d.priority==="Low"}])},"Low",10,ps),e("button",{type:"button",onClick:L=>E(j,"Medium"),class:Z(["px-2 py-0.5 rounded-full text-blue-600 bg-blue-100 text-xs hover:bg-blue-200",{"bg-blue-200 font-semibold":d.priority==="Medium"}])},"Medium",10,ms),e("button",{type:"button",onClick:L=>E(j,"High"),class:Z(["px-2 py-0.5 rounded-full text-red-600 bg-red-100 text-xs hover:bg-red-200",{"bg-red-200 font-semibold":d.priority==="High"}])},"High",10,vs)])])]))),128))])):A("",!0)])]),footer:K(({close:Y})=>[e("div",gs,[p(Je,{onClick:Y,type:"button"},{default:K(()=>v[9]||(v[9]=[F(" Cancel ",-1)])),_:2,__:[9]},1032,["onClick"]),p(ie,{type:"submit",disabled:y.value,class:Z({"opacity-50 cursor-not-allowed":y.value})},{default:K(()=>v[10]||(v[10]=[F(" Create Tasks ",-1)])),_:1,__:[10]},8,["disabled","class"])])]),_:1},8,["show","form-data"]))}},bs={class:"space-y-3"},xs={__name:"MilestoneCompletionDateModal",props:{show:{type:Boolean,default:!1},milestoneId:{type:[Number,String],required:!0},initialCompletionDate:{type:String,default:null}},emits:["close","updated"],setup(k,{emit:R}){const l=k,N=R,o=Ce({completion_date:l.initialCompletionDate||null}),b=Ce({completion_date:null});ue(()=>l.show,V=>{V&&(o.completion_date=l.initialCompletionDate||null,b.completion_date=null)});const M=C(()=>`/api/milestones/${l.milestoneId}`),$=()=>(b.completion_date=null,o.completion_date?!0:(b.completion_date=["Completion date is required."],!1)),B=V=>{N("updated",V),N("close")},h=()=>N("close");return(V,T)=>(n(),J(ve,{show:k.show,title:"Set Milestone Completion Date","api-endpoint":M.value,"http-method":"put","form-data":o,"submit-button-text":"Save Date","success-message":"Milestone updated","before-submit":$,onClose:h,onSubmitted:B},{default:K(({errors:E})=>{var I,q;return[e("div",bs,[T[1]||(T[1]=e("p",{class:"text-sm text-gray-600"}," This milestone does not have a completion date. Please set it to continue creating tasks for its contracts. ",-1)),e("div",null,[p(te,{for:"milestone-completion-date",value:"Completion Date"}),p(le,{id:"milestone-completion-date",modelValue:o.completion_date,"onUpdate:modelValue":T[0]||(T[0]=r=>o.completion_date=r),type:"date",class:"mt-1 block w-full",required:""},null,8,["modelValue"]),p(se,{message:((I=E.completion_date)==null?void 0:I[0])||((q=b.completion_date)==null?void 0:q[0]),class:"mt-1"},null,8,["message"])])])]}),_:1},8,["show","api-endpoint","form-data"]))}},ys={class:"mt-8 p-6 md:p-8 bg-white rounded-2xl shadow-xl space-y-8 font-sans"},hs={class:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 border-b pb-4"},ws={class:"flex-1"},_s={class:"text-xl font-bold text-gray-900"},ks={class:"text-sm text-gray-500 mt-1"},Cs={key:0},$s={class:"flex items-center gap-4 flex-shrink-0"},Ds={class:"relative w-28 h-28"},js={class:"w-full h-full transform -rotate-90"},Ms=["stroke-dashoffset"],Ss=["stroke-dashoffset"],As={class:"absolute inset-0 flex items-center justify-center"},Bs={class:"text-2xl font-bold text-gray-900"},Ps={class:"space-y-8 px-4"},Ts={class:"relative w-full h-2 rounded-full bg-gray-200"},Ls={class:"absolute -top-6 left-1/2 -translate-x-1/2 text-xs font-medium text-indigo-700 w-max"},Vs={class:"relative w-full h-4 mt-4 -top-8"},Ns={class:"w-2 h-2 rounded-full bg-gray-400 shadow-sm z-10 group relative"},Rs={key:0,class:"absolute -top-1 -right-1 w-3 h-3 text-xs bg-gray-500 text-white rounded-full flex items-center justify-center font-bold"},Is={class:"absolute top-full mt-2 w-max p-2 text-xs text-center text-white bg-gray-800 rounded-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none z-20"},Fs={class:"font-bold border-b pb-1 mb-1"},Us={class:"absolute top-full mt-2 w-max min-w-[70px]"},Es={class:"text-gray-500 text-xs truncate"},qs={__name:"ProjectProgressTimeline",props:{milestones:{type:Array,default:()=>[]},showTicks:{type:Boolean,default:!0},title:{type:String,default:"Project Progress & Timeline"},progressLabel:{type:String,default:"Project Progress"},timelineLabel:{type:String,default:"Timeline"}},setup(k){const R=k,l=C(()=>(R.milestones||[]).filter(u=>!!(u!=null&&u.completion_date))),N=C(()=>[...l.value].sort((u,y)=>{const f=new Date(u.completion_date),U=new Date(y.completion_date);return f-U})),o=C(()=>(R.milestones||[]).length),b=C(()=>(R.milestones||[]).filter(u=>((u==null?void 0:u.status)||"").toLowerCase()==="completed")),M=C(()=>(R.milestones||[]).filter(u=>((u==null?void 0:u.status)||"").toLowerCase()==="approved")),$=C(()=>b.value.length+M.value.length);C(()=>o.value?Math.round(b.value.length/o.value*100):0);const B=C(()=>o.value?Math.round(M.value.length/o.value*100):0),h=C(()=>o.value?Math.round($.value/o.value*100):0),V=C(()=>N.value.length?new Date(N.value[0].completion_date):null),T=C(()=>N.value.length?new Date(N.value[N.value.length-1].completion_date):null),E=C(()=>{if(!V.value||!T.value)return 0;const u=v=>new Date(v.getFullYear(),v.getMonth(),v.getDate(),12,0,0),y=u(V.value),f=u(T.value),U=u(new Date),D=f-y;if(D<=0)return 100;let m=(U-y)/D*100;return m<0&&(m=0),m>100&&(m=100),Math.round(m)}),I=u=>{const y=new Date,U=new Date(u)-y,D=Math.ceil(U/(1e3*60*60*24));return D===0?"Due Today":D>0?`${D} day${D===1?"":"s"} left`:`${Math.abs(D)} day${Math.abs(D)===1?"":"s"} overdue`},q=u=>{if(!V.value||!T.value)return 0;const y=new Date(V.value),f=new Date(T.value),U=new Date(u),D=f-y;return D<=0?100:(U-y)/D*100},r=C(()=>{const u={};return N.value.forEach(y=>{const f=new Date(y.completion_date).toLocaleDateString();u[f]||(u[f]={date:y.completion_date,milestones:[]}),u[f].milestones.push(y)}),Object.values(u)}),S=u=>{const y=Math.max(2,Math.min(98,u)),f=u<5?"0%":u>95?"-100%":"-50%";return{left:`${y}%`,transform:`translateX(${f})`}};return(u,y)=>(n(),i("div",ys,[e("header",hs,[e("div",ws,[e("h2",_s,g(k.title),1),e("p",ks,[F(g($.value)+" of "+g(o.value)+" milestones completed. ",1),V.value&&T.value?(n(),i("span",Cs," Project timeline: "+g(new Date(V.value).toLocaleDateString())+" — "+g(new Date(T.value).toLocaleDateString())+". ",1)):A("",!0)])]),e("div",$s,[e("div",Ds,[(n(),i("svg",js,[y[0]||(y[0]=e("circle",{class:"text-gray-200","stroke-width":"8",stroke:"currentColor",fill:"transparent",r:"44",cx:"56",cy:"56"},null,-1)),e("circle",{class:"text-indigo-500","stroke-width":"8","stroke-dasharray":276.46,"stroke-dashoffset":276.46-276.46*h.value/100,"stroke-linecap":"round",stroke:"currentColor",fill:"transparent",r:"44",cx:"56",cy:"56",style:{transition:"stroke-dashoffset 0.5s ease-in-out"}},null,8,Ms),y[1]||(y[1]=e("circle",{class:"text-gray-300","stroke-width":"8",stroke:"currentColor",fill:"transparent",r:"32",cx:"56",cy:"56"},null,-1)),e("circle",{class:"text-green-500","stroke-width":"8","stroke-dasharray":201.06,"stroke-dashoffset":201.06-201.06*B.value/100,"stroke-linecap":"round",stroke:"currentColor",fill:"transparent",r:"32",cx:"56",cy:"56",style:{transition:"stroke-dashoffset 0.5s ease-in-out"}},null,8,Ss)])),e("div",As,[e("span",Bs,g(h.value)+"%",1)])])])]),e("div",Ps,[e("div",Ts,[e("div",{class:"h-full bg-indigo-500 rounded-full",style:we({width:E.value+"%"})},null,4),V.value&&T.value?(n(),i("div",{key:0,class:"absolute top-1/2 -translate-y-1/2",style:we({left:`calc(${E.value}% - 8px)`})},[e("div",Ls," Today: "+g(new Date().toLocaleDateString()),1),y[2]||(y[2]=e("div",{class:"w-4 h-4 rounded-full bg-indigo-700 border-2 border-white shadow-md transform scale-125 transition-transform duration-200",title:"Today"},null,-1))],4)):A("",!0)]),e("div",Vs,[(n(!0),i(ee,null,oe(r.value,(f,U)=>(n(),i("div",{key:U,class:"absolute top-0 flex flex-col items-center text-center",style:we(S(q(f.date)))},[e("div",Ns,[f.milestones.length>1?(n(),i("div",Rs,g(f.milestones.length),1)):A("",!0),e("div",Is,[e("p",Fs,g(new Date(f.date).toLocaleDateString()),1),(n(!0),i(ee,null,oe(f.milestones,D=>(n(),i("p",{key:D.id,class:"text-left text-gray-300"}," - "+g(D.name),1))),128))])]),e("div",Us,[e("p",Es,g(new Date(f.date).toLocaleDateString()),1),e("p",{class:Z(["text-xs font-medium truncate",{"text-red-500":I(f.date).includes("overdue"),"text-gray-600":!I(f.date).includes("overdue")}])},g(I(f.date)),3)])],4))),128))])])]))}},Os={class:"flex flex-col md:flex-row items-start md:items-center justify-between gap-4"},Hs={class:"flex items-center gap-3 w-full md:w-auto"},Ks={class:"flex-grow md:flex-grow-0 w-full md:w-64"},Ys={class:"w-24 md:w-32 flex-shrink-0"},zs={class:"py-8"},Zs={class:"max-w-7xl mx-auto sm:px-6 lg:px-8 space-y-6"},Gs={key:0},Xs={class:"bg-white rounded-xl p-6 shadow-sm"},Js={class:"grid grid-cols-1 md:grid-cols-3 gap-6"},Qs={class:"bg-green-50 rounded-lg p-5 shadow-sm flex flex-col justify-between"},Ws={class:"text-3xl font-bold text-green-900"},eo={class:"bg-yellow-50 rounded-lg p-5 shadow-sm flex flex-col justify-between"},to={class:"text-3xl font-bold text-yellow-900"},so={class:"bg-blue-50 rounded-lg p-5 shadow-sm flex flex-col justify-between"},oo={class:"text-3xl font-bold text-blue-900"},no={class:"bg-white rounded-xl shadow-sm p-6"},lo={class:"flex flex-col sm:flex-row items-start sm:items-center justify-between border-b pb-4 mb-4"},ao={class:"flex items-center gap-2"},ro={class:"flex space-x-2 mt-2 sm:mt-0"},io=["onClick"],uo={key:0,class:"text-center text-gray-500 py-12"},co={key:1},po={key:0,class:"text-center text-gray-500 py-12"},mo={key:1,class:"text-center text-gray-500 py-12"},vo={key:2,class:"space-y-4"},go=["onClick"],fo={class:"flex-grow"},bo={class:"font-bold text-lg text-gray-900 mb-1"},xo={key:0,class:"text-sm text-gray-600"},yo={class:"mt-1 text-xs text-gray-500 flex items-center gap-2"},ho={key:0},wo={class:"font-medium text-gray-700"},_o={key:1},ko={class:"flex items-center gap-4 text-sm text-gray-700"},Co={class:"hidden sm:flex items-center gap-4"},$o={class:"inline-flex items-center gap-1 text-gray-600"},Do={class:"font-semibold text-gray-800"},jo={class:"inline-flex items-center gap-1 text-gray-600"},Mo={class:"font-semibold text-green-700"},So={class:"inline-flex items-center gap-1 text-gray-600"},Ao={class:"font-semibold text-blue-700"},Bo=["onClick"],Po={class:"flex items-center gap-2"},To=["onClick"],Lo=["onClick"],Vo={class:"border-t border-gray-200 p-5 bg-white rounded-b-xl"},No={class:"mb-5"},Ro={class:"flex flex-wrap gap-2 text-xs"},Io={class:"inline-flex items-center gap-1 px-2 py-1 rounded-full bg-gray-100 text-gray-700"},Fo={class:"font-semibold"},Uo={class:"inline-flex items-center gap-1 px-2 py-1 rounded-full bg-slate-100 text-slate-700"},Eo={class:"font-semibold"},qo={class:"inline-flex items-center gap-1 px-2 py-1 rounded-full bg-blue-100 text-blue-700"},Oo={class:"font-semibold"},Ho={class:"inline-flex items-center gap-1 px-2 py-1 rounded-full bg-yellow-100 text-yellow-700"},Ko={class:"font-semibold"},Yo={class:"inline-flex items-center gap-1 px-2 py-1 rounded-full bg-orange-100 text-orange-700"},zo={class:"font-semibold"},Zo={class:"inline-flex items-center gap-1 px-2 py-1 rounded-full bg-green-100 text-green-700"},Go={class:"font-semibold"},Xo={class:"inline-flex items-center gap-1 px-2 py-1 rounded-full bg-red-100 text-red-700"},Jo={class:"font-semibold"},Qo={class:"flex justify-between items-center mb-4"},Wo={class:"flex items-center gap-2"},en={key:0,class:"text-center text-gray-500 text-sm py-4"},tn={key:1,class:"space-y-2"},sn={class:"flex items-center gap-2"},on={key:0,class:"text-gray-600 text-xs sm:text-sm"},nn={class:"font-medium"},ln={class:"flex items-center gap-4 mt-2 sm:mt-0"},an={class:"text-right"},rn={class:"font-semibold"},un={key:0,class:"text-gray-500 block text-xs"},dn={class:"flex gap-1.5"},cn=["onClick"],pn=["onClick"],mn=["onClick"],vn=["onClick"],gn={class:"mt-6 pt-4 border-t border-gray-200 flex flex-col items-start gap-2"},fn={class:"flex flex-wrap items-center gap-3"},bn={key:0,class:"text-sm text-red-600"},xn={class:"p-6 bg-white rounded-lg shadow-xl"},yn={class:"flex items-center justify-between mb-4"},hn={key:0,class:"text-gray-500 text-center py-4"},wn={key:1},_n={key:0,class:"text-gray-500 text-center py-4"},kn={key:1,class:"space-y-3 max-h-96 overflow-y-auto pr-2"},Cn={class:"text-sm text-gray-600 flex justify-between items-center mb-1"},$n={class:"font-medium"},Dn={class:"text-xs text-gray-400"},jn={class:"mt-1 text-gray-800 text-sm whitespace-pre-line"},Yn={__name:"Index",setup(k){const R=w([]),l=w(null),N=w(!1),o=w("active"),b=w([]),M=w(!1),$=w(!1),B=w(!1),h=w(!1),V=w(!1),T=w([]),E=w(!1),I=w(!1),q=w(null),r=w(null),S=w(!1),u=w(null),y=w(null),f=w(null),U=[{value:"PKR",label:"PKR"},{value:"AUD",label:"AUD"},{value:"INR",label:"INR"},{value:"USD",label:"USD"},{value:"EUR",label:"EUR"},{value:"GBP",label:"GBP"}],{canDo:D}=_t();D("manage_project_financial");const m=D("approve_milestone_expendables"),v=D("approve_expendables"),Y=D("approve_milestones");D("view_monthly_budgets");const d=Bt,j=w(null),L=w("PKR"),O=w([]),Qe=[{id:"active",label:"Active Milestones"},{id:"completed",label:"Completed"},{id:"approved",label:"Approved"}],We=C(()=>(b.value||[]).filter(s=>!!s.completion_date)),ae=C(()=>[...We.value].sort((s,t)=>{const x=new Date(s.completion_date),P=new Date(t.completion_date);return x-P})),$e=C(()=>(b.value||[]).length),et=C(()=>(b.value||[]).filter(s=>{const t=(s.status||"").toLowerCase();return t==="completed"||t==="approved"}).length);C(()=>$e.value?Math.round(et.value/$e.value*100):0);const De=C(()=>ae.value.length?new Date(ae.value[0].completion_date):null),je=C(()=>ae.value.length?new Date(ae.value[ae.value.length-1].completion_date):null);C(()=>{if(!De.value||!je.value)return 0;const s=ne=>new Date(ne.getFullYear(),ne.getMonth(),ne.getDate(),12,0,0),t=s(De.value),x=s(je.value),P=s(new Date),z=x-t;if(z<=0)return 100;let G=(P-t)/z*100;return G<0&&(G=0),G>100&&(G=100),Math.round(G)});const Me=C(()=>b.value?o.value==="active"?b.value.filter(s=>s.status.toLowerCase()==="in progress"||s.status.toLowerCase()==="not started"||s.status.toLowerCase()==="pending"):o.value==="completed"?b.value.filter(s=>s.status.toLowerCase()==="completed"):o.value==="approved"?b.value.filter(s=>s.status.toLowerCase()==="approved"):b.value:[]),tt=C(()=>!b.value||!pe.value||Object.keys(pe.value).length===0?0:b.value.reduce((s,t)=>t.status.toLowerCase()!=="approved"?s+(t.expendable||[]).filter(x=>x.status==="Accepted").reduce((x,P)=>x+Q(parseFloat(P.amount??0),P.currency,d.value),0):s,0)),st=C(()=>!b.value||!pe.value||Object.keys(pe.value).length===0?0:b.value.reduce((s,t)=>s+(t.expendable||[]).filter(x=>x.status==="Pending Approval").reduce((x,P)=>x+Q(parseFloat(P.amount??0),P.currency,d.value),0),0)),ot=C(()=>{if(j.value==null)return W(0,d.value);const s=Q(parseFloat(j.value??0),L.value,d.value),t=b.value.reduce((x,P)=>x+(P.expendable||[]).filter(z=>z.status==="Accepted").reduce((z,G)=>z+Q(parseFloat(G.amount??0),G.currency,d.value),0),0);return W(s-t,d.value)});C(()=>{var t;return((Array.isArray((t=O.value)==null?void 0:t.users)?O.value.users:O.value)||[]).map(x=>({value:x.id,label:x.name}))});const re=s=>{if(!s)return{};const t=s.budget?Q(Number(s.budget.amount||0),s.budget.currency,d.value):0,x=(s.expendable||[]).filter(P=>P.status==="Accepted").reduce((P,z)=>P+Q(Number(z.amount||0),z.currency,d.value),0);return{budgetAmt:t,approvedAmt:x,remaining:t-x}},Se=s=>s?s.budget!==null:null,nt=(s,t)=>{if(!(!s||!t)){if(!s.completion_date){u.value=s,y.value=t.id,S.value=!0;return}r.value=s,q.value=t.id,I.value=!0}},lt=s=>{try{if(s&&s.id){const x=(b.value||[]).findIndex(P=>P.id===s.id);x!==-1&&(b.value[x]={...b.value[x],...s})}}catch(x){console.error("Failed to merge updated milestone",x)}const t=(b.value||[]).find(x=>{var P;return x.id===((s==null?void 0:s.id)||((P=u.value)==null?void 0:P.id))});r.value=t||s||u.value,q.value=y.value,S.value=!1,I.value=!0,u.value=null,y.value=null},at=async()=>{try{const{data:s}=await window.axios.get("/api/projects-simplified");R.value=(s||[]).map(t=>({value:t.id,label:t.name}))}catch(s){console.error(s),H("Failed to load projects")}},de=async()=>{if(l.value){N.value=!0;try{const{data:s}=await window.axios.get(`/api/projects/${l.value}/milestones-with-expendables`);b.value=(s||[]).map(t=>({...t,_collapsed:!0}))}catch(s){console.error(s),H("Failed to load milestones")}finally{N.value=!1}}},rt=async s=>{if(!s||!s.id){H("Invalid milestone selected.");return}r.value=s,V.value=!0,h.value=!0;try{const{data:t}=await window.axios.get(`/api/milestones/${s.id}/reasons`);T.value=Array.isArray(t)?t:[]}catch(t){console.error(t),H("Failed to load reasons")}finally{V.value=!1}},it=async()=>{if(l.value)try{const{data:s}=await window.axios.get(`/api/projects/${l.value}/sections/users?type=users`);O.value=s||[]}catch(s){console.error(s),H("Failed to load users")}},Ae=async()=>{if(l.value)try{const{data:s}=await window.axios.get(`/api/projects/${l.value}/expendable-budget`);j.value=Number(s.total_expendable_amount||0),L.value=s.currency}catch(s){console.error(s)}},ge=async()=>{if(!l.value){b.value=[],j.value=0,L.value="PKR";return}await Promise.all([de(),it(),Ae()])},fe=()=>{Mt("Operation successful!"),B.value=!1,r.value=null,f.value=null,de()},ut=s=>{if(!s||!s.id){H("Invalid milestone selected.");return}r.value=s,M.value=!0},dt=s=>{if(!s||!s.id){H("Invalid milestone selected.");return}r.value=s,$.value=!0},ct=()=>{B.value=!1,r.value=null,f.value=null},pt=async s=>{if(!s||!s.id){H("Invalid milestone.");return}await ce("Mark this milestone as complete?")&&(r.value={...s,action:"complete",apiEndpoint:`/api/milestones/${s.id}/complete`,httpMethod:"post"},B.value=!0)},mt=async s=>{if(!s||!s.id){H("Invalid milestone.");return}await ce("Approve this completed milestone?")&&(r.value={...s,action:"approve",apiEndpoint:`/api/milestones/${s.id}/approve`,httpMethod:"post"},B.value=!0)},vt=async s=>{if(!s||!s.id){H("Invalid milestone.");return}await ce("Reject this completed milestone?")&&(r.value={...s,action:"reject",apiEndpoint:`/api/milestones/${s.id}/reject`,httpMethod:"post"},B.value=!0)},gt=async s=>{if(!s||!s.id){H("Invalid contract.");return}f.value={...s,action:"accept",apiEndpoint:`/api/projects/${l.value}/expendables/${s.id}/accept`,httpMethod:"post"},B.value=!0},ft=async s=>{if(!s||!s.id){H("Invalid contract.");return}f.value={...s,action:"reject",apiEndpoint:`/api/projects/${l.value}/expendables/${s.id}/reject`,httpMethod:"post"},B.value=!0},bt=async s=>{if(!s||!s.id){H("Invalid contract.");return}f.value={...s,action:"delete",apiEndpoint:`/api/projects/${l.value}/expendables/${s.id}`,httpMethod:"delete"},B.value=!0},xt=async s=>{if(!s||!s.id){H("Invalid milestone.");return}await ce("Reopen this milestone to move it back to active?")&&(r.value={...s,action:"reopen",apiEndpoint:`/api/milestones/${s.id}/reopen`,httpMethod:"post"},B.value=!0)},Be=s=>{s._collapsed=!s._collapsed},be=s=>!s||!Array.isArray(s.expendable)?!1:s.expendable.some(t=>((t==null?void 0:t.status)||"Pending Approval")==="Pending Approval"),xe=s=>!!(s&&Array.isArray(s.expendable)&&s.expendable.length>0),ye=s=>{try{if(!s)return null;const t=new Date(s),x=new Date,P=new Date(t.getFullYear(),t.getMonth(),t.getDate(),12,0,0),z=new Date(x.getFullYear(),x.getMonth(),x.getDate(),12,0,0),G=1440*60*1e3;return Math.round((P-z)/G)}catch{return null}},yt=s=>{const t=ye(s);return t===null?"":t<0?`Overdue by ${Math.abs(t)} day${Math.abs(t)===1?"":"s"}`:t===0?"Due today":`${t} day${t===1?"":"s"} remaining`};return kt(async()=>{const s=localStorage.getItem("displayCurrency");s&&(d.value=s),await Pt(),await at(),l.value&&await ge()}),ue(d,async s=>{s&&(localStorage.setItem("displayCurrency",s),l.value&&await Promise.all([Ae(),de()]))}),(s,t)=>(n(),J(At,null,{header:K(()=>[e("div",Os,[t[13]||(t[13]=e("h2",{class:"font-semibold text-2xl text-gray-800"},"Project Financials",-1)),e("div",Hs,[e("button",{onClick:ge,class:"p-2 rounded-full text-gray-500 hover:bg-gray-100 transition-colors",title:"Refresh"},[p(c(ke),{class:"h-5 w-5"})]),e("div",Ks,[p(me,{id:"project-select",modelValue:l.value,"onUpdate:modelValue":[t[0]||(t[0]=x=>l.value=x),ge],options:R.value,placeholder:"Select a project"},null,8,["modelValue","options"])]),e("div",Ys,[p(me,{id:"expendables-display-currency",modelValue:c(d),"onUpdate:modelValue":t[1]||(t[1]=x=>Dt(d)?d.value=x:null),options:U,placeholder:"Currency"},null,8,["modelValue"])]),p(c(jt),{href:s.route("admin.pm-payout-calculator.index"),class:"inline-flex items-center px-3 py-1 border border-transparent text-xs leading-4 font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:border-indigo-700 focus:ring active:bg-indigo-700 transition ease-in-out duration-150"},{default:K(()=>t[12]||(t[12]=[F(" Payout Calculator ",-1)])),_:1,__:[12]},8,["href"])])])]),default:K(()=>{var x,P,z,G,ne,Pe,Te,Le,Ve,Ne,Re,Ie,Fe,Ue,Ee,qe,Oe,He;return[p(c(Ct),{title:"Project Financials Dashboard"}),e("div",zs,[e("div",Zs,[l.value?(n(),i("section",Gs,[e("div",Xs,[t[20]||(t[20]=e("h3",{class:"text-xl font-semibold text-gray-900 mb-4"},"Financial Summary",-1)),e("div",Js,[e("div",Qs,[e("div",null,[t[14]||(t[14]=e("div",{class:"text-sm font-medium text-green-700 mb-1"},"Approved Contracts",-1)),e("div",Ws,g(c(W)(tt.value,c(d))),1)]),t[15]||(t[15]=e("p",{class:"text-xs text-green-600 mt-2"},"Total value of all accepted contracts.",-1))]),e("div",eo,[e("div",null,[t[16]||(t[16]=e("div",{class:"text-sm font-medium text-yellow-700 mb-1"},"Pending Approval",-1)),e("div",to,g(c(W)(st.value,c(d))),1)]),t[17]||(t[17]=e("p",{class:"text-xs text-yellow-600 mt-2"},"Contracts awaiting review and approval.",-1))]),e("div",so,[e("div",null,[t[18]||(t[18]=e("div",{class:"text-sm font-medium text-blue-700 mb-1"},"Remaining Project Budget",-1)),e("div",oo,g(ot.value),1)]),t[19]||(t[19]=e("p",{class:"text-xs text-blue-600 mt-2"},"Budget available for new expenditures.",-1))])]),p(qs,{milestones:b.value},null,8,["milestones"])])])):A("",!0),e("section",no,[e("div",lo,[e("div",ao,[t[21]||(t[21]=e("h3",{class:"text-xl font-semibold text-gray-900"},"Project Milestones",-1)),l.value?(n(),i("button",{key:0,onClick:t[2]||(t[2]=a=>E.value=!0),class:"p-1.5 rounded-full text-white bg-indigo-600 hover:bg-indigo-700 disabled:opacity-50",title:"Add Milestone"},[p(c(_e),{class:"h-4 w-4"})])):A("",!0)]),e("div",ro,[(n(),i(ee,null,oe(Qe,a=>e("button",{key:a.id,onClick:_=>o.value=a.id,class:Z(["py-2 px-4 rounded-full text-sm font-medium transition",o.value===a.id?"bg-indigo-600 text-white shadow":"bg-gray-100 text-gray-700 hover:bg-gray-200"])},g(a.label),11,io)),64))])]),l.value?(n(),i("div",co,[N.value?(n(),i("div",po,[p(c(ke),{class:"animate-spin h-8 w-8 mx-auto mb-2 text-indigo-500"}),t[23]||(t[23]=e("p",null,"Loading milestones...",-1))])):Me.value.length?(n(),i("div",vo,[(n(!0),i(ee,null,oe(Me.value,a=>(n(),i("div",{key:a.id,class:"border border-gray-200 rounded-xl bg-gray-50 shadow-sm transition-all duration-300 hover:shadow-lg"},[e("div",{class:"p-5 flex items-center justify-between cursor-pointer",onClick:_=>Be(a)},[e("div",fo,[e("div",bo,g(a.name),1),a.description?(n(),i("div",xo,g(a.description),1)):A("",!0),e("div",yo,[a.completion_date?(n(),i("span",ho,[t[25]||(t[25]=F(" Due by: ",-1)),e("span",wo,g(new Date(a.completion_date).toLocaleDateString()),1)])):(n(),i("span",_o,"No completion date")),a.completion_date?(n(),i("span",{key:2,class:Z([ye(a.completion_date)<0?"text-red-600":ye(a.completion_date)===0?"text-orange-600":"text-green-600"])}," • "+g(yt(a.completion_date)),3)):A("",!0)])]),e("div",ko,[e("div",Co,[e("span",$o,[p(c(Ut),{class:"h-4 w-4 text-gray-500"}),t[26]||(t[26]=F(" Budget: ",-1)),e("span",Do,g(c(W)(re(a).budgetAmt,c(d))),1)]),e("span",jo,[p(c(ze),{class:"h-4 w-4 text-green-600"}),t[27]||(t[27]=F(" Approved: ",-1)),e("span",Mo,g(c(W)(re(a).approvedAmt,c(d))),1)]),e("span",So,[p(c(ke),{class:"h-4 w-4 text-blue-600"}),t[28]||(t[28]=F(" Remaining: ",-1)),e("span",Ao,g(c(W)(re(a).remaining,c(d))),1)])]),o.value==="active"?(n(),i("button",{key:0,onClick:X(_=>dt(a),["stop"]),class:"p-2 rounded-full text-gray-500 hover:text-blue-500 hover:bg-gray-100 transition-colors"},[Se(a)?(n(),J(c(Lt),{key:0,class:"h-5 w-5"})):(n(),J(c(Nt),{key:1,class:"h-5 w-5"}))],8,Bo)):A("",!0),e("div",Po,[e("button",{onClick:X(_=>rt(a),["stop"]),class:"p-2 rounded-full text-blue-600 hover:bg-blue-100 transition-colors",title:"View reasons"},[p(c(It),{class:"h-5 w-5"})],8,To),e("button",{onClick:X(_=>Be(a),["stop"]),class:"p-2 transition-transform duration-300"},[p(c(Rt),{class:Z(["h-6 w-6 text-gray-500",a._collapsed?"":"rotate-180"])},null,8,["class"])],8,Lo)])])],8,go),Xe(e("div",Vo,[e("div",No,[t[36]||(t[36]=e("h5",{class:"text-sm font-semibold text-gray-800 mb-2"},"Task Stats",-1)),e("div",Ro,[e("span",Io,[t[29]||(t[29]=F(" Total ",-1)),e("span",Fo,g(a.tasks_total_count||0),1)]),e("span",Uo,[t[30]||(t[30]=F(" To Do ",-1)),e("span",Eo,g(a.tasks_todo_count||0),1)]),e("span",qo,[t[31]||(t[31]=F(" In Progress ",-1)),e("span",Oo,g(a.tasks_in_progress_count||0),1)]),e("span",Ho,[t[32]||(t[32]=F(" Paused ",-1)),e("span",Ko,g(a.tasks_paused_count||0),1)]),e("span",Yo,[t[33]||(t[33]=F(" Blocked ",-1)),e("span",zo,g(a.tasks_blocked_count||0),1)]),e("span",Zo,[t[34]||(t[34]=F(" Done ",-1)),e("span",Go,g(a.tasks_done_count||0),1)]),e("span",Xo,[t[35]||(t[35]=F(" Archived ",-1)),e("span",Jo,g(a.tasks_archived_count||0),1)])])]),e("div",Qo,[t[38]||(t[38]=e("h4",{class:"text-lg font-semibold text-gray-800"},"Contracts",-1)),e("div",Wo,[o.value==="active"?(n(),J(ie,{key:0,onClick:X(_=>ut(a),["stop"]),class:"flex items-center gap-1"},{default:K(()=>[p(c(_e),{class:"h-4 w-4"}),t[37]||(t[37]=F(" Add Contract ",-1))]),_:2,__:[37]},1032,["onClick"])):A("",!0)])]),!a.expendable||!a.expendable.length?(n(),i("div",en,"No contracts found.")):(n(),i("ul",tn,[(n(!0),i(ee,null,oe(a.expendable||[],_=>{var Ke,Ye;return n(),i("li",{key:_.id,class:"flex flex-col sm:flex-row items-start sm:items-center justify-between text-sm gap-2 p-3 rounded-lg bg-gray-100 shadow-sm"},[e("div",sn,[e("span",{class:Z(["inline-block text-xs px-2 py-0.5 rounded-full font-medium",{"bg-gray-200 text-gray-700":_.status==="Pending Approval","bg-green-200 text-green-700":_.status==="Accepted","bg-red-200 text-red-700":_.status==="Rejected"}])},g(_.status||"Pending Approval"),3),_.user&&_.user.name?(n(),i("span",on,g(_.user.name),1)):A("",!0),e("span",nn,g(_.name),1)]),e("div",ln,[e("div",an,[e("span",rn,g(c(W)(c(Q)(parseFloat(_.amount??0),_.currency||c(d),c(d)),c(d))),1),_.currency&&((Ke=_.currency)==null?void 0:Ke.toUpperCase())!==((Ye=c(d))==null?void 0:Ye.toUpperCase())?(n(),i("span",un," ("+g(c(W)(parseFloat(_.amount??0),_.currency))+") ",1)):A("",!0)]),e("div",dn,[_.status==="Accepted"?(n(),i("button",{key:0,onClick:X(he=>nt(a,_),["stop"]),class:"p-1 rounded-full text-indigo-600 hover:bg-indigo-200 transition-colors",title:"Add tasks"},[p(c(_e),{class:"h-5 w-5"})],8,cn)):A("",!0),_.status==="Pending Approval"&&o.value!=="approved"?(n(),i(ee,{key:1},[c(m)||c(v)?(n(),i("button",{key:0,onClick:X(he=>gt(_),["stop"]),class:"p-1 rounded-full text-green-600 hover:bg-green-200 transition-colors",title:"Approve"},[p(c(ze),{class:"h-5 w-5"})],8,pn)):A("",!0),c(m)||c(v)?(n(),i("button",{key:1,onClick:X(he=>ft(_),["stop"]),class:"p-1 rounded-full text-red-600 hover:bg-red-200 transition-colors",title:"Reject"},[p(c(Et),{class:"h-5 w-5"})],8,mn)):A("",!0)],64)):A("",!0),_.status==="Rejected"&&o.value!=="approved"?(n(),i("button",{key:2,onClick:X(he=>bt(_),["stop"]),class:"p-1 rounded-full text-red-600 hover:bg-red-200 transition-colors",title:"Delete"},[p(c(Ft),{class:"h-5 w-5"})],8,vn)):A("",!0)])])])}),128))])),e("div",gn,[e("div",fn,[a.status.toLowerCase()!=="completed"&&o.value==="active"?(n(),J(ie,{key:0,onClick:X(_=>pt(a),["stop"]),disabled:be(a)&&xe(a),title:be(a)&&xe(a)?"Approve or reject all contracts before completing the milestone.":""},{default:K(()=>t[39]||(t[39]=[F(" Mark Complete ",-1)])),_:2,__:[39]},1032,["onClick","disabled","title"])):a.status.toLowerCase()==="completed"&&o.value==="completed"&&c(Y)?(n(),J(ie,{key:1,onClick:X(_=>mt(a),["stop"]),class:"bg-green-600 hover:bg-green-700"},{default:K(()=>t[40]||(t[40]=[F("Approve Milestone",-1)])),_:2,__:[40]},1032,["onClick"])):A("",!0),a.status.toLowerCase()==="completed"&&o.value==="completed"&&c(Y)?(n(),J(ie,{key:2,onClick:X(_=>vt(a),["stop"]),class:"bg-red-600 hover:bg-red-700"},{default:K(()=>t[41]||(t[41]=[F("Reject Milestone",-1)])),_:2,__:[41]},1032,["onClick"])):a.status.toLowerCase()==="approved"&&o.value==="approved"&&c(Y)?(n(),J(Je,{key:3,onClick:X(_=>xt(a),["stop"])},{default:K(()=>t[42]||(t[42]=[F("Reopen Milestone",-1)])),_:2,__:[42]},1032,["onClick"])):A("",!0)]),a.status.toLowerCase()!=="completed"&&o.value==="active"&&be(a)&&xe(a)?(n(),i("p",bn," You have pending contracts. Approve or reject each contract before marking this milestone complete. ")):A("",!0)])],512),[[$t,!a._collapsed]])]))),128))])):(n(),i("div",mo,t[24]||(t[24]=[e("p",null,"No milestones found for this project in the selected tab.",-1)])))])):(n(),i("div",uo,[p(c(Vt),{class:"h-12 w-12 mx-auto mb-2 text-gray-400"}),t[22]||(t[22]=e("p",{class:"text-lg"},"Please select a project to view its milestones.",-1))]))])])]),p(Ze,{show:M.value,title:"Add New Contract",milestone:r.value,users:O.value,"currency-options":U,"is-user-selection-required":!0,onClose:t[3]||(t[3]=a=>M.value=!1),onSubmitted:fe,"project-total-budget":j.value,"project-budget-currency":L.value,"milestone-stats":re(r.value)},null,8,["show","milestone","users","project-total-budget","project-budget-currency","milestone-stats"]),p(Ze,{show:$.value,title:Se(r.value)?"Update Milestone Budget":"Add Milestone Budget",milestone:r.value,users:O.value,"currency-options":U,"is-budget-form":!0,"is-user-selection-required":!1,onClose:t[4]||(t[4]=a=>$.value=!1),onSubmitted:fe,"project-total-budget":j.value,"project-budget-currency":L.value,"milestone-stats":re(r.value)},null,8,["show","title","milestone","users","project-total-budget","project-budget-currency","milestone-stats"]),p(zt,{show:B.value,title:((x=r.value)==null?void 0:x.action)==="approve"?"Approve Milestone":((P=r.value)==null?void 0:P.action)==="reject"?"Reject Milestone":((z=r.value)==null?void 0:z.action)==="reopen"?"Reopen Milestone":r.value?"Provide Milestone Review":((G=f.value)==null?void 0:G.action)==="accept"?"Approve Contract":((ne=f.value)==null?void 0:ne.action)==="reject"?"Reject Contract":"Delete Contract",message:((Pe=r.value)==null?void 0:Pe.action)==="approve"?"Please provide a reason for approving this milestone (required):":((Te=r.value)==null?void 0:Te.action)==="reject"?"Please provide a reason for rejecting this milestone (required):":((Le=r.value)==null?void 0:Le.action)==="reopen"?"Please provide a reason for reopening this milestone (required):":r.value?"Please provide a review explaining why this milestone is complete (required):":((Ve=f.value)==null?void 0:Ve.action)==="accept"?"Please provide a reason for approval (required):":((Ne=f.value)==null?void 0:Ne.action)==="reject"?"Please provide a reason for rejection (required):":"Provide a reason for deleting this rejected expendable (required):",type:((Re=r.value)==null?void 0:Re.action)==="reject"||((Ie=r.value)==null?void 0:Ie.action)==="reopen"?"warning":"info","api-endpoint":r.value?r.value.apiEndpoint:(Fe=f.value)==null?void 0:Fe.apiEndpoint,"http-method":r.value?r.value.httpMethod:(Ue=f.value)==null?void 0:Ue.httpMethod,onClose:ct,onSubmitted:fe},null,8,["show","title","message","type","api-endpoint","http-method"]),p(St,{show:E.value,"project-id":Number(l.value),onClose:t[5]||(t[5]=a=>E.value=!1),onSaved:t[6]||(t[6]=()=>{E.value=!1,de()}),"contract-id":q.value},null,8,["show","project-id","contract-id"]),p(Tt,{show:h.value,onClose:t[8]||(t[8]=()=>{h.value=!1,r.value=null,T.value=[]})},{default:K(()=>[e("div",xn,[e("div",yn,[t[44]||(t[44]=e("h3",{class:"text-lg font-semibold"},"Milestone Reasons",-1)),e("button",{class:"text-gray-500 hover:text-gray-700",onClick:t[7]||(t[7]=()=>{h.value=!1,r.value=null,T.value=[]})},t[43]||(t[43]=[e("svg",{class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),V.value?(n(),i("div",hn,"Loading...")):(n(),i("div",wn,[T.value.length?(n(),i("ul",kn,[(n(!0),i(ee,null,oe(T.value,a=>(n(),i("li",{key:a.id,class:"p-4 rounded-lg bg-gray-50 shadow-sm border border-gray-200"},[e("div",Cn,[e("span",$n,g(a.creator_name||"Unknown"),1),e("span",Dn,g(new Date(a.created_at).toLocaleString()),1)]),e("div",jn,g(a.content),1)]))),128))])):(n(),i("div",_n,"No reasons found."))]))])]),_:1},8,["show"]),p(fs,{show:I.value,"contract-id":Number(q.value),"completion-date":(Ee=r.value)!=null&&Ee.completion_date?String(r.value.completion_date).split("T")[0]:null,onClose:t[9]||(t[9]=()=>{I.value=!1,q.value=null}),onTasksSubmitted:t[10]||(t[10]=()=>{I.value=!1,q.value=null})},null,8,["show","contract-id","completion-date"]),p(xs,{show:S.value,"milestone-id":Number(((qe=u.value)==null?void 0:qe.id)||((Oe=r.value)==null?void 0:Oe.id)),"initial-completion-date":(He=u.value)!=null&&He.completion_date?String(u.value.completion_date).split("T")[0]:null,onClose:t[11]||(t[11]=()=>{S.value=!1,u.value=null}),onUpdated:lt},null,8,["show","milestone-id","initial-completion-date"])]}),_:1}))}};export{Yn as default};
