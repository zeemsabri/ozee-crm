import{j as ie,r as P,S as F,B as pe,l as te,m as me,f as d,o as r,d as t,p as O,g as h,b as o,t as $,s as ge,x as je,a as Z,w as H,n as W,R as oe,c as K,F as ce,i as ue,q as He,al as Ge,v as Ve,U as Ye,u as Ne,e as V,am as We,y as Je,a8 as Xe,an as Qe,ao as Ze,ap as et,$ as tt}from"./app-CwLjNXT3.js";import{_ as D}from"./InputLabel-BSEjZJ95.js";import{_ as G}from"./TextInput-C-mFm0N_.js";import{_ as T}from"./InputError-BZ-n7H_N.js";import{P as ae}from"./PrimaryButton-Bn1p3q-j.js";import{S as ee}from"./SelectDropdown-DGCykHln.js";import{T as at,j as st,k as lt}from"./AuthenticatedLayout-BM_zJI8M.js";import{P as ot,_ as nt}from"./ProjectTypeInput-BTflFR8j.js";import{_ as be}from"./SecondaryButton-C1H9a7MO.js";import{D as rt}from"./DangerButton-CBIP4jF7.js";import{_ as it}from"./Modal-uBVvV53I.js";import{_ as dt}from"./Checkbox-C0IliKwo.js";const ct=P([]),ut=P([]),Ce=P([]),De=P([]),Ie=async e=>{try{const b=(await ie.get(`/api/roles?type=${e}`)).data.map(p=>({value:p.id,label:p.name}));return e==="client"?ct.value=b:e==="project"&&(ut.value=b),b}catch(y){return console.error(`Error fetching ${e} roles:`,y),F(`Failed to load ${e} roles. Please refresh the page.`),[]}},mt=async(e,y)=>{try{let a;return y&&!e||e&&(a=await window.axios.get("/api/clients"),Ce.value=a.data.data||a.data),Ce.value}catch(a){return console.error("Error fetching clients:",a),F("Failed to load clients. Please try again."),[]}},vt=async(e,y)=>{try{let a;return y&&!e||e&&(a=await window.axios.get("/api/users"),De.value=a.data),De.value}catch(a){return console.error("Error fetching users:",a),F("Failed to load users. Please try again."),[]}},xe=async(e,y,a)=>{let b="",p=null;try{switch(y){case"basic":b=`/api/projects/${e}/sections/basic`;break;case"client":(a.canViewProjectClients||a.canManageProjectClients||a.canViewProjectUsers||a.canManageProjectUsers)&&(b=`/api/projects/${e}/sections/clients-users`);break;case"services":(a.canViewProjectServicesAndPayments||a.canManageProjectServicesAndPayments)&&(b=`/api/projects/${e}/sections/services-payment`);break;case"documents":a.canViewProjectDocuments&&(b=`/api/projects/${e}/sections/documents`);break;case"notes":(a.canViewProjectNotes||a.canAddProjectNotes)&&(b=`/api/projects/${e}/sections/notes?type=private`);break;case"transactions":return null;default:return console.warn(`Attempted to fetch data for unknown tab: ${y}`),null}return b&&(p=(await window.axios.get(b)).data),p}catch(k){throw console.error(`Error fetching data for tab '${y}':`,k),F(`Failed to load data for ${y} section. Please try again.`),k}},pt={class:"space-y-6 bg-white p-6 rounded-lg border border-gray-100 font-inter"},gt={key:0,class:"text-center py-8 text-gray-500 text-lg"},yt={key:1,class:"grid grid-cols-1 md:grid-cols-2 gap-6"},ft={key:0},bt={key:1},wt={key:2},ht={key:0,class:"mt-1 text-xs text-gray-500"},xt={key:3},jt=["disabled"],kt={key:0,class:"mt-2"},_t=["src"],Pt={class:"mt-6"},$t=["disabled"],St={class:"mt-6"},Vt={class:"mt-6"},Ct={class:"mt-6 flex justify-end"},Dt={key:0,class:"flex items-center"},It={key:1},Ut={__name:"ProjectEditBasicInfo",props:{projectId:{type:[Number,String],required:!0},errors:{type:Object,default:()=>({})},statusOptions:{type:Array,required:!0,default:()=>[{value:"active",label:"Active"},{value:"completed",label:"Completed"},{value:"paid",label:"Paid"},{value:"on_hold",label:"On-hold"}]},sourceOptions:{type:Array,required:!0},canManageProjects:{type:Boolean,default:!1},canManageProjectBasicDetails:{type:Boolean,default:!1},isSaving:{type:Boolean,default:!1}},setup(e){const y=e,a=pe({id:null,name:"",description:"",website:"",social_media_link:"",preferred_keywords:"",google_chat_id:"",google_drive_link:"",logo:null,status:"active",project_type:"",source:"",tags:[],tags_data:[],timezone:null,project_tier_id:null,profit_margin_percentage:null}),b=P(!1),p=P(!0),k=P([]),N=async()=>{try{const l=await window.axios.get("/api/project-tiers");k.value=l.data}catch(l){console.error("Error fetching project tiers:",l),F("Failed to load project tiers.")}},C=l=>{const s=l.target.files[0];s?a.logo=s:a.logo=null},M=async()=>{b.value=!0;const l=new FormData,s=["id","tags","tags_data","logo"];if(a.project_tier_id!==null&&a.project_tier_id!==void 0){const n=String(a.project_tier_id);l.append("project_tier_id",n),console.log("Added project_tier_id:",n,"type:",typeof n)}else console.log("project_tier_id is null or undefined:",a.project_tier_id);a.profit_margin_percentage!==null&&a.profit_margin_percentage!==void 0&&(l.append("profit_margin_percentage",a.profit_margin_percentage),console.log("Added profit_margin_percentage:",a.profit_margin_percentage));for(const n in a)!s.includes(n)&&n!=="project_tier_id"&&n!=="profit_margin_percentage"&&a[n]!==null&&a[n]!==void 0&&l.append(n,a[n]);Array.isArray(a.tags)&&a.tags.forEach(n=>{const w=typeof n=="object"&&n!==null&&n.id?n.id:n;w!=null&&l.append("tags[]",w)}),a.logo instanceof File&&l.append("logo",a.logo),l.append("_method","PUT"),console.log("Form data contents:");for(let[n,w]of l.entries())console.log(`${n}: ${w}`);try{const n=await window.axios.post(`/api/projects/${y.projectId}/sections/basic`,l,{headers:{"Content-Type":"multipart/form-data"}});oe("Project basic information updated successfully!"),n.data&&Object.assign(a,{name:n.data.name||a.name,description:n.data.description||a.description,website:n.data.website||a.website,social_media_link:n.data.social_media_link||a.social_media_link,preferred_keywords:n.data.preferred_keywords||a.preferred_keywords,google_chat_id:n.data.google_chat_id||a.google_chat_id,google_drive_link:n.data.google_drive_link||a.google_drive_link,logo:n.data.logo||a.logo,status:n.data.status||a.status,project_type:n.data.project_type||a.project_type,source:n.data.source||a.source,tags:n.data.tags||a.tags,tags_data:n.data.tags_data||a.tags_data,timezone:n.data.timezone||a.timezone,project_tier_id:n.data.project_tier_id||a.project_tier_id,profit_margin_percentage:n.data.profit_margin_percentage||a.profit_margin_percentage})}catch(n){console.error("Error saving basic info:",n);let w="Failed to save basic information.";n.response&&n.response.data&&n.response.data.message&&(w=n.response.data.message),F(w)}finally{b.value=!1}},v=async()=>{if(!y.projectId){p.value=!1;return}p.value=!0;try{const l=await xe(y.projectId,"basic",{});l&&Object.assign(a,{id:l.id||y.projectId,name:l.name||"",description:l.description||"",website:l.website||"",social_media_link:l.social_media_link||"",preferred_keywords:l.preferred_keywords||"",google_chat_id:l.google_chat_id||"",google_drive_link:l.google_drive_link||"",logo:l.logo||null,status:l.status||"active",project_type:l.project_type||"",source:l.source||"",tags:l.tags||[],tags_data:l.tags_data||[],timezone:l.timezone||null,project_tier_id:l.project_tier_id||null,profit_margin_percentage:l.profit_margin_percentage||null})}catch(l){console.error("Error fetching basic info:",l),F("Failed to load basic project information.")}finally{p.value=!1}};return te(()=>y.projectId,async l=>{setTimeout(async()=>{l&&await v()},500)},{immediate:!0}),te(()=>a.project_tier_id,l=>{console.log("project_tier_id changed:",l,"type:",typeof l)}),me(()=>{N()}),(l,s)=>(r(),d("div",pt,[p.value?(r(),d("div",gt,s[15]||(s[15]=[t("svg",{class:"animate-spin h-8 w-8 text-indigo-500 mx-auto mb-3",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),O(" Loading basic project information... ",-1)]))):(r(),d("div",yt,[t("div",null,[o(D,{for:"name",value:"Project Name"}),o(G,{id:"name",type:"text",class:"mt-1 block w-full rounded-lg shadow-sm",modelValue:a.name,"onUpdate:modelValue":s[0]||(s[0]=n=>a.name=n),required:"",autofocus:"",disabled:!e.canManageProjects||b.value||e.isSaving},null,8,["modelValue","disabled"]),o(T,{message:e.errors.name?e.errors.name[0]:"",class:"mt-2"},null,8,["message"])]),t("div",null,[o(D,{for:"website",value:"Website"}),o(G,{id:"website",type:"url",class:"mt-1 block w-full rounded-lg shadow-sm",modelValue:a.website,"onUpdate:modelValue":s[1]||(s[1]=n=>a.website=n),disabled:!e.canManageProjects||b.value||e.isSaving},null,8,["modelValue","disabled"]),o(T,{message:e.errors.website?e.errors.website[0]:"",class:"mt-2"},null,8,["message"])]),t("div",null,[o(D,{for:"social_media_link",value:"Social Media Link"}),o(G,{id:"social_media_link",type:"url",class:"mt-1 block w-full rounded-lg shadow-sm",modelValue:a.social_media_link,"onUpdate:modelValue":s[2]||(s[2]=n=>a.social_media_link=n),disabled:!e.canManageProjects||b.value||e.isSaving},null,8,["modelValue","disabled"]),o(T,{message:e.errors.social_media_link?e.errors.social_media_link[0]:"",class:"mt-2"},null,8,["message"])]),e.canManageProjectBasicDetails?(r(),d("div",ft,[o(D,{for:"google_chat_id",value:"Google Chat ID"}),o(G,{id:"google_chat_id",type:"text",class:"mt-1 block w-full rounded-lg shadow-sm",modelValue:a.google_chat_id,"onUpdate:modelValue":s[3]||(s[3]=n=>a.google_chat_id=n),disabled:!e.canManageProjects||b.value||e.isSaving},null,8,["modelValue","disabled"]),o(T,{message:e.errors.google_chat_id?e.errors.google_chat_id[0]:"",class:"mt-2"},null,8,["message"])])):h("",!0),e.canManageProjectBasicDetails?(r(),d("div",bt,[o(D,{for:"google_drive_link",value:"Google Drive Link"}),o(G,{id:"google_drive_link",type:"text",class:"mt-1 block w-full rounded-lg shadow-sm",modelValue:a.google_drive_link,"onUpdate:modelValue":s[4]||(s[4]=n=>a.google_drive_link=n),disabled:!e.canManageProjects||b.value||e.isSaving},null,8,["modelValue","disabled"]),o(T,{message:e.errors.google_drive_link?e.errors.google_drive_link[0]:"",class:"mt-2"},null,8,["message"])])):h("",!0),t("div",null,[o(D,{for:"status",value:"Status"}),o(ee,{id:"status",modelValue:a.status,"onUpdate:modelValue":s[5]||(s[5]=n=>a.status=n),options:e.statusOptions,valueKey:"value",labelKey:"label",placeholder:"Select Project Status",disabled:!e.canManageProjects||b.value||e.isSaving,required:!0,class:"mt-1 block w-full"},null,8,["modelValue","options","disabled"]),o(T,{message:e.errors.status?e.errors.status[0]:"",class:"mt-2"},null,8,["message"])]),t("div",null,[o(ot,{id:"project_type",modelValue:a.project_type,"onUpdate:modelValue":s[6]||(s[6]=n=>a.project_type=n),disabled:!e.canManageProjects||b.value||e.isSaving,class:"mt-1 block w-full"},null,8,["modelValue","disabled"]),o(T,{message:e.errors.project_type?e.errors.project_type[0]:"",class:"mt-2"},null,8,["message"])]),t("div",null,[o(D,{for:"source",value:"Source"}),o(ee,{id:"source",modelValue:a.source,"onUpdate:modelValue":s[7]||(s[7]=n=>a.source=n),options:e.sourceOptions,valueKey:"value",labelKey:"label",placeholder:"Select a Source",disabled:!e.canManageProjects||b.value||e.isSaving,class:"mt-1 block w-full"},null,8,["modelValue","options","disabled"]),o(T,{message:e.errors.source?e.errors.source[0]:"",class:"mt-2"},null,8,["message"])]),t("div",null,[o(nt,{id:"timezone",modelValue:a.timezone,"onUpdate:modelValue":s[8]||(s[8]=n=>a.timezone=n),disabled:!e.canManageProjects||b.value||e.isSaving,class:"mt-1 block w-full"},null,8,["modelValue","disabled"]),o(T,{message:e.errors.timezone?e.errors.timezone[0]:"",class:"mt-2"},null,8,["message"])]),l.canDo("")?(r(),d("div",wt,[o(D,{for:"project_tier_id",value:"Project Tier"}),o(ee,{id:"project_tier_id",modelValue:a.project_tier_id,"onUpdate:modelValue":s[9]||(s[9]=n=>a.project_tier_id=n),options:k.value,valueKey:"id",labelKey:"name",placeholder:"Select Project Tier",disabled:!e.canManageProjects||b.value||e.isSaving,class:"mt-1 block w-full",onChange:s[10]||(s[10]=n=>console.log("SelectDropdown change event:",n))},null,8,["modelValue","options","disabled"]),o(T,{message:e.errors.project_tier_id?e.errors.project_tier_id[0]:"",class:"mt-2"},null,8,["message"]),a.project_tier_id?(r(),d("div",ht," Selected tier ID: "+$(a.project_tier_id)+" ("+$(typeof a.project_tier_id)+") ",1)):h("",!0)])):h("",!0),t("div",null,[o(D,{for:"profit_margin_percentage",value:"Profit Margin (%)"}),o(G,{id:"profit_margin_percentage",type:"number",step:"0.01",min:"0",max:"100",class:"mt-1 block w-full rounded-lg shadow-sm",modelValue:a.profit_margin_percentage,"onUpdate:modelValue":s[11]||(s[11]=n=>a.profit_margin_percentage=n),disabled:!e.canManageProjects||b.value||e.isSaving},null,8,["modelValue","disabled"]),o(T,{message:e.errors.profit_margin_percentage?e.errors.profit_margin_percentage[0]:"",class:"mt-2"},null,8,["message"])]),e.canManageProjectBasicDetails?(r(),d("div",xt,[o(D,{for:"logo",value:"Project Logo"}),t("input",{type:"file",id:"logo",onChange:C,class:"mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100 cursor-pointer",accept:"image/*",disabled:!e.canManageProjectBasicDetails||b.value||e.isSaving},null,40,jt),a.logo&&typeof a.logo=="string"?(r(),d("div",kt,[s[16]||(s[16]=t("p",{class:"text-sm text-gray-600"},"Current Logo:",-1)),t("img",{src:a.logo,alt:"Project Logo",class:"h-20 w-20 object-contain rounded-lg shadow-md border border-gray-200"},null,8,_t)])):h("",!0),o(T,{message:e.errors.logo?e.errors.logo[0]:"",class:"mt-2"},null,8,["message"])])):h("",!0)])),t("div",Pt,[o(D,{for:"description",value:"Description"}),ge(t("textarea",{id:"description",class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-lg shadow-sm mt-1 block w-full","onUpdate:modelValue":s[12]||(s[12]=n=>a.description=n),disabled:!e.canManageProjects||b.value||e.isSaving,rows:"4"},null,8,$t),[[je,a.description]]),o(T,{message:e.errors.description?e.errors.description[0]:"",class:"mt-2"},null,8,["message"])]),t("div",St,[o(D,{for:"preferred_keywords",value:"Client Preferred Keywords"}),o(G,{id:"preferred_keywords",type:"text",class:"mt-1 block w-full rounded-lg shadow-sm",modelValue:a.preferred_keywords,"onUpdate:modelValue":s[13]||(s[13]=n=>a.preferred_keywords=n),disabled:!e.canManageProjects||b.value||e.isSaving},null,8,["modelValue","disabled"]),o(T,{message:e.errors.preferred_keywords?e.errors.preferred_keywords[0]:"",class:"mt-2"},null,8,["message"])]),t("div",Vt,[o(at,{modelValue:a.tags,"onUpdate:modelValue":s[14]||(s[14]=n=>a.tags=n),initialTags:a.tags_data,label:"Associated Tags",placeholder:"Search or add tags",error:e.errors.tags?e.errors.tags[0]:"",disabled:!e.canManageProjects||b.value||e.isSaving},null,8,["modelValue","initialTags","error","disabled"])]),t("div",Ct,[e.canManageProjectBasicDetails?(r(),Z(ae,{key:0,onClick:M,disabled:!e.canManageProjects||b.value||e.isSaving,class:W([{"opacity-50 cursor-not-allowed":b.value||e.isSaving},"px-6 py-2 rounded-lg text-base shadow-md hover:shadow-lg transition-all"])},{default:H(()=>[b.value||e.isSaving?(r(),d("span",Dt,s[17]||(s[17]=[t("svg",{class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),O(" Updating... ",-1)]))):(r(),d("span",It," Update Basic Information "))]),_:1},8,["disabled","class"])):h("",!0)])]))}},Mt={class:"mb-4"},At={class:"mt-2"},Nt={key:0,class:"text-gray-500 text-sm mb-2"},Tt={class:"mb-4"},Bt={key:1,class:"space-y-3"},Rt={class:"flex-grow text-gray-800 font-medium"},Ot={class:"text-gray-600 text-sm"},Ft={class:"flex items-center space-x-2"},Et=["onClick"],zt={key:2,class:"p-4 bg-gray-50 rounded-lg text-gray-600 text-center border border-dashed border-gray-200"},Ue={__name:"MultiSelectWithRoles",props:{label:{type:String,required:!0},items:{type:Array,default:()=>[]},endpoint:{type:String,default:""},selectedItems:{type:Array,default:()=>[]},itemText:{type:String,default:"name"},itemSubtext:{type:String,default:"email"},itemValue:{type:String,default:"id"},roleOptions:{type:Array,default:()=>[]},roleType:{type:String,default:"application"},defaultRoleId:{type:Number,default:null},error:{type:String,default:""},placeholder:{type:String,default:"Select an item"},showRemoveButton:{type:Boolean,default:!0},disabled:{type:Boolean,default:!1}},emits:["update:selectedItems"],setup(e,{emit:y}){const a=e,b=y,p=P([]),k=P([]),N=P([]),C=P([]),M=P(!1),v=async()=>{if(!(a.roleOptions.length>0))try{const g=(await ie.get(`/api/roles?type=${a.roleType}`)).data;N.value=g.map(f=>({value:f.id,label:f.name}))}catch(u){console.error("Error fetching roles:",u)}},l=K(()=>N.value.length>0?N.value:a.roleOptions),s=()=>a.defaultRoleId?a.defaultRoleId:l.value.length>0?l.value[0].value:1,n=()=>{p.value=[],k.value=[],!(!a.selectedItems||a.selectedItems.length===0)&&a.selectedItems.forEach(u=>{const g=typeof u=="object"?u[a.itemValue]:u,f=typeof u=="object"&&u.role_id!==void 0?u.role_id:s();if(!p.value.includes(g))p.value.push(g),k.value.push({id:g,role_id:f});else{const z=k.value.find(E=>E.id===g);z&&z.role_id!==f&&(z.role_id=f)}})};te(()=>a.selectedItems,(u,g)=>{JSON.stringify(u)!==JSON.stringify(g)&&n()},{deep:!0,immediate:!0}),te(k,u=>{b("update:selectedItems",u)},{deep:!0});const w=u=>{a.disabled||u&&!p.value.includes(u)&&(p.value.push(u),k.value.push({id:u,role_id:s()}))},I=u=>{a.disabled||(p.value=p.value.filter(g=>g!==u),k.value=k.value.filter(g=>g.id!==u))},Y=(u,g)=>{if(a.disabled)return;const f=k.value.find(z=>z.id===u);f&&(f.role_id=parseInt(g))},J=u=>B.value.find(g=>g[a.itemValue]===u),X=u=>{const g=k.value.find(f=>f.id===u);return g?g.role_id:s()},U=async()=>{if(a.endpoint){M.value=!0;try{const u=await ie.get(a.endpoint);u.data&&Array.isArray(u.data)?C.value=u.data:u.data&&u.data.data&&Array.isArray(u.data.data)&&(C.value=u.data.data)}catch(u){console.error("Error fetching items from endpoint:",u)}finally{M.value=!1}}},B=K(()=>a.endpoint&&C.value.length>0?C.value:a.items),ne=K(()=>B.value.filter(u=>!p.value.includes(u[a.itemValue])).map(u=>({value:u[a.itemValue],label:`${u[a.itemText]} (${u[a.itemSubtext]})`})));return me(()=>{v(),a.endpoint&&U()}),(u,g)=>(r(),d("div",Mt,[o(D,{value:e.label},null,8,["value"]),t("div",At,[M.value?(r(),d("div",Nt,"Loading available items...")):h("",!0),t("div",Tt,[o(ee,{modelValue:u.selectedItemToAdd,"onUpdate:modelValue":g[0]||(g[0]=f=>u.selectedItemToAdd=f),options:ne.value,valueKey:"value",labelKey:"label",placeholder:e.placeholder,disabled:M.value||e.disabled,onChange:w,class:"w-full"},null,8,["modelValue","options","placeholder","disabled"])]),p.value.length>0?(r(),d("div",Bt,[(r(!0),d(ce,null,ue(p.value,f=>{var z,E;return r(),d("div",{key:f,class:"flex items-center p-3 border border-gray-200 rounded-lg bg-gray-50 shadow-sm"},[t("div",Rt,[O($((z=J(f))==null?void 0:z[e.itemText])+" ",1),t("span",Ot,"("+$((E=J(f))==null?void 0:E[e.itemSubtext])+")",1)]),t("div",Ft,[o(ee,{modelValue:X(f),"onUpdate:modelValue":x=>Y(f,x),options:l.value,valueKey:"value",labelKey:"label",placeholder:"Select Role",disabled:e.disabled,class:"w-32"},null,8,["modelValue","onUpdate:modelValue","options","disabled"]),e.showRemoveButton&&!e.disabled?(r(),d("button",{key:0,type:"button",class:"text-red-500 hover:text-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 rounded-full p-1 transition-colors duration-200",onClick:x=>I(f),"aria-label":"Remove item"},g[1]||(g[1]=[t("svg",{class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]),8,Et)):h("",!0)])])}),128))])):(r(),d("div",zt," No "+$(e.label.toLowerCase())+" selected. ",1))]),o(T,{message:e.error,class:"mt-2"},null,8,["message"])]))}},Lt={class:"space-y-8"},qt={key:0,class:"bg-gray-50 p-6 rounded-lg shadow-inner border border-gray-200"},Kt={key:0,class:"mt-6 flex justify-end"},Ht={key:0},Gt={key:1},Yt={key:1,class:"mt-3 text-green-600 text-sm flex items-center"},Wt={key:2,class:"mt-3 text-red-600 text-sm flex items-center"},Jt={class:"bg-gray-50 p-6 rounded-lg shadow-inner border border-gray-200"},Xt=["disabled"],Qt={key:1,class:"bg-gray-50 p-6 rounded-lg shadow-inner border border-gray-200"},Zt={key:0,class:"mt-6 flex justify-end"},ea={key:0},ta={key:1},aa={key:1,class:"mt-3 text-green-600 text-sm flex items-center"},sa={key:2,class:"mt-3 text-red-600 text-sm flex items-center"},la={__name:"ProjectFormClientsUsers",props:{projectId:{type:[Number,String],required:!0},errors:{type:Object,default:()=>({})},clientRoleOptions:{type:Array,default:()=>[]},userRoleOptions:{type:Array,default:()=>[]},clients:{type:Array,default:()=>[]},users:{type:Array,default:()=>[]},canViewProjectClients:{type:Boolean,default:!1},canManageProjectClients:{type:Boolean,default:!1},canViewProjectUsers:{type:Boolean,default:!1},canManageProjectUsers:{type:Boolean,default:!1},isSaving:{type:Boolean,default:!1}},setup(e){const y=e,a=pe({client_ids:[],user_ids:[],contract_details:""}),b=P(!1),p=P(!1),k=P(""),N=P(!1),C=P(!1),M=P(""),v=async()=>{if(y.projectId)try{const n=await xe(y.projectId,"client",{canViewProjectClients:y.canViewProjectClients,canManageProjectClients:y.canManageProjectClients,canViewProjectUsers:y.canViewProjectUsers,canManageProjectUsers:y.canManageProjectUsers});n&&(a.client_ids=n.clients?n.clients.map(w=>{var I;return{id:w.id,role_id:((I=w.pivot)==null?void 0:I.role_id)||(y.clientRoleOptions.length>0?y.clientRoleOptions[0].value:null)}}):[],a.user_ids=n.users?n.users.map(w=>{var I;return{id:w.id,role_id:((I=w.pivot)==null?void 0:I.role_id)||(y.userRoleOptions.length>0?y.userRoleOptions[0].value:null)}}):[],a.contract_details=n.contract_details||"")}catch(n){console.error("Error fetching clients/users data:",n),F("Failed to load clients and users data.")}};te(()=>y.projectId,async n=>{n&&await v()},{immediate:!0});const l=async()=>{var n,w;if(!y.projectId){F("Project ID is missing. Cannot save clients.");return}if(!a.client_ids||a.client_ids.length===0){F("Please select at least one client to save.");return}b.value=!0,p.value=!1,k.value="";try{await window.axios.post(`/api/projects/${y.projectId}/attach-clients`,{client_ids:a.client_ids}),oe("Clients saved successfully!"),p.value=!0,await v()}catch(I){console.error("Error saving clients:",I),k.value=((w=(n=I.response)==null?void 0:n.data)==null?void 0:w.message)||"Failed to save clients.",F(k.value)}finally{b.value=!1,setTimeout(()=>p.value=!1,3e3)}},s=async()=>{var n,w;if(!y.projectId){F("Project ID is missing. Cannot save users.");return}if(!a.user_ids||a.user_ids.length===0){F("Please select at least one user to save.");return}N.value=!0,C.value=!1,M.value="";try{await window.axios.post(`/api/projects/${y.projectId}/attach-users`,{user_ids:a.user_ids}),oe("Users saved successfully!"),C.value=!0,await v()}catch(I){console.error("Error saving users:",I),M.value=((w=(n=I.response)==null?void 0:n.data)==null?void 0:w.message)||"Failed to save users.",F(M.value)}finally{N.value=!1,setTimeout(()=>C.value=!1,3e3)}};return me(()=>{}),(n,w)=>(r(),d("div",Lt,[e.canViewProjectClients?(r(),d("div",qt,[w[5]||(w[5]=t("h3",{class:"text-xl font-semibold text-gray-800 mb-5"},"Project Clients",-1)),o(Ue,{label:"Select Clients",items:e.clients,selectedItems:a.client_ids,"onUpdate:selectedItems":w[0]||(w[0]=I=>a.client_ids=I),roleOptions:e.clientRoleOptions,roleType:"client",error:e.errors.client_ids?e.errors.client_ids[0]:"",placeholder:"Search and select clients to add",disabled:!e.canManageProjectClients||e.isSaving||b.value,readonly:!e.canManageProjectClients&&e.canViewProjectClients,showRemoveButton:e.canManageProjectClients,class:"mb-4"},null,8,["items","selectedItems","roleOptions","error","disabled","readonly","showRemoveButton"]),e.canManageProjectClients?(r(),d("div",Kt,[o(ae,{onClick:l,disabled:b.value||e.isSaving,class:"px-6 py-3 rounded-lg text-lg shadow-md hover:shadow-lg transition-all duration-200"},{default:H(()=>[b.value?(r(),d("span",Ht,"Saving Clients...")):(r(),d("span",Gt,"Save Clients"))]),_:1},8,["disabled"])])):h("",!0),p.value?(r(),d("div",Yt,w[3]||(w[3]=[t("svg",{class:"h-5 w-5 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1),O(" Clients saved successfully! ",-1)]))):h("",!0),k.value?(r(),d("div",Wt,[w[4]||(w[4]=t("svg",{class:"h-5 w-5 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),O(" "+$(k.value),1)])):h("",!0)])):h("",!0),t("div",Jt,[w[6]||(w[6]=t("h3",{class:"text-xl font-semibold text-gray-800 mb-5"},"Contract Information",-1)),o(D,{for:"contract_details",value:"Contract Details",class:"mb-1"}),ge(t("textarea",{id:"contract_details",class:"block w-full px-4 py-2 border-gray-300 rounded-lg shadow-sm focus:border-indigo-500 focus:ring-indigo-500 transition-colors duration-200 resize-y min-h-[120px]","onUpdate:modelValue":w[1]||(w[1]=I=>a.contract_details=I),disabled:!e.canManageProjectClients||e.isSaving,placeholder:"Enter contract terms, agreements, or important notes about the client relationship."},null,8,Xt),[[je,a.contract_details]]),o(T,{message:e.errors.contract_details?e.errors.contract_details[0]:"",class:"mt-2"},null,8,["message"])]),e.canViewProjectUsers?(r(),d("div",Qt,[w[9]||(w[9]=t("h3",{class:"text-xl font-semibold text-gray-800 mb-5"},"Assign Project Users",-1)),o(Ue,{label:"Assign Users",items:e.users,selectedItems:a.user_ids,"onUpdate:selectedItems":w[2]||(w[2]=I=>a.user_ids=I),roleOptions:e.userRoleOptions,roleType:"project",defaultRoleId:2,error:e.errors.user_ids?e.errors.user_ids[0]:"",placeholder:"Search and assign users to this project",disabled:!e.canManageProjectUsers||e.isSaving||N.value,readonly:!e.canManageProjectUsers&&e.canViewProjectUsers,showRemoveButton:e.canManageProjectUsers,class:"mb-4"},null,8,["items","selectedItems","roleOptions","error","disabled","readonly","showRemoveButton"]),e.canManageProjectUsers?(r(),d("div",Zt,[o(ae,{onClick:s,disabled:N.value||e.isSaving,class:"px-6 py-3 rounded-lg text-lg shadow-md hover:shadow-lg transition-all duration-200"},{default:H(()=>[N.value?(r(),d("span",ea,"Saving Users...")):(r(),d("span",ta,"Save Users"))]),_:1},8,["disabled"])])):h("",!0),C.value?(r(),d("div",aa,w[7]||(w[7]=[t("svg",{class:"h-5 w-5 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1),O(" Users saved successfully! ",-1)]))):h("",!0),M.value?(r(),d("div",sa,[w[8]||(w[8]=t("svg",{class:"h-5 w-5 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),O(" "+$(M.value),1)])):h("",!0)])):h("",!0)]))}},oa={class:"space-y-6"},na={key:0,class:"bg-gray-50 p-6 rounded-lg shadow-inner border border-gray-200"},ra={class:"mt-6"},ia={key:0},da={key:1},ca={key:0,class:"text-sm text-red-500 mt-3"},ua={key:1,class:"mt-8 bg-white p-6 rounded-lg shadow-md border border-gray-200"},ma={class:"space-y-3"},va={class:"flex items-center"},pa={class:"mr-3 text-indigo-500"},ga={key:0,class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},ya={key:1,class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},fa={key:2,class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},ba={key:3,class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},wa=["href"],ha={key:1,class:"text-gray-700 font-medium break-all mr-4"},xa=["onClick","disabled"],ja={key:2,class:"p-6 bg-gray-50 rounded-lg text-gray-600 text-center border border-gray-200 shadow-sm"},ka={__name:"ProjectFormDocuments",props:{projectId:{type:[Number,String],required:!0},errors:{type:Object,default:()=>({})},canUploadProjectDocuments:{type:Boolean,default:!1},canViewProjectDocuments:{type:Boolean,default:!1},isSaving:{type:Boolean,default:!1}},setup(e){const y=e,a=pe({documents:[]}),b=P(null),p=P(!1),k=async()=>{if(y.projectId)try{const v=await xe(y.projectId,"documents",{canViewProjectDocuments:y.canViewProjectDocuments});v&&(a.documents=v||[])}catch(v){console.error("Error fetching documents data:",v),F("Failed to load documents data.")}};te(()=>y.projectId,async v=>{v&&await k()},{immediate:!0});const N=v=>{const l=Array.from(v.target.files);if(l.length>0){const s=Array.isArray(a.documents)?a.documents.filter(n=>typeof n=="object"&&"path"in n):[];a.documents=[...s,...l]}},C=async()=>{if(!y.projectId){F("Project ID is missing. Cannot upload documents.");return}const v=a.documents.filter(l=>l&&typeof l=="object"&&"name"in l&&"size"in l&&"type"in l);if(!v||v.length===0){F("Please select documents to upload.");return}p.value=!0;try{const l=new FormData;v.forEach((n,w)=>{l.append(`documents[${w}]`,n)});const s=await window.axios.post(`/api/projects/${y.projectId}/documents`,l,{headers:{"Content-Type":"multipart/form-data"}});a.documents=s.data.documents||[],oe("Documents uploaded successfully!"),await k()}catch(l){F("Failed to upload documents."),console.error("Error uploading documents:",l)}finally{p.value=!1,b.value&&(b.value.value="")}},M=v=>{a.documents=a.documents.filter((l,s)=>s!==v)};return me(()=>{}),(v,l)=>(r(),d("div",oa,[e.canUploadProjectDocuments?(r(),d("div",na,[o(D,{for:"documents-upload",value:"Upload New Documents",class:"mb-2 text-lg"}),t("input",{type:"file",id:"documents-upload",ref_key:"documentFileInput",ref:b,onChange:N,class:"mt-2 block w-full text-sm text-gray-600 file:mr-4 file:py-2.5 file:px-5 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100 transition-colors duration-200 cursor-pointer",multiple:"",accept:".pdf,.doc,.docx,.jpg,.jpeg,.png,.gif"},null,544),l[0]||(l[0]=t("p",{class:"text-sm text-gray-500 mt-2"},"Supported formats: PDF, DOC, DOCX, JPG, JPEG, PNG, GIF. Max file size: 5MB.",-1)),o(T,{message:e.errors.documents?e.errors.documents[0]:"",class:"mt-2"},null,8,["message"]),t("div",ra,[o(ae,{type:"button",onClick:C,disabled:!e.projectId||!a.documents||!a.documents.some(s=>s&&typeof s=="object"&&"name"in s&&"size"in s&&"type"in s)||p.value||e.isSaving,class:"px-6 py-3 rounded-lg text-lg shadow-md hover:shadow-lg transition-all duration-200"},{default:H(()=>[p.value?(r(),d("span",ia,"Uploading...")):(r(),d("span",da,"Upload Selected Documents"))]),_:1},8,["disabled"]),e.projectId?h("",!0):(r(),d("p",ca," Please save the project first before uploading documents. "))])])):h("",!0),e.canViewProjectDocuments&&a.documents&&a.documents.length>0?(r(),d("div",ua,[l[7]||(l[7]=t("h3",{class:"text-xl font-semibold text-gray-800 mb-5"},"Existing Project Documents",-1)),t("ul",ma,[(r(!0),d(ce,null,ue(a.documents,(s,n)=>(r(),d("li",{key:n,class:"flex items-center justify-between p-4 bg-gray-50 rounded-md border border-gray-100 shadow-sm transition-shadow hover:shadow-md duration-200"},[t("div",va,[t("span",pa,[typeof s=="object"&&"type"in s&&s.type.includes("image")?(r(),d("svg",ga,l[1]||(l[1]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 002.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"},null,-1)]))):typeof s=="object"&&"type"in s&&s.type.includes("pdf")?(r(),d("svg",ya,l[2]||(l[2]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"},null,-1)]))):typeof s=="object"&&"type"in s&&(s.type.includes("word")||s.type.includes("document"))?(r(),d("svg",fa,l[3]||(l[3]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"},null,-1)]))):(r(),d("svg",ba,l[4]||(l[4]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"},null,-1)])))]),typeof s=="object"&&"path"in s?(r(),d("a",{key:0,href:`/storage/${s.path}`,target:"_blank",class:"text-blue-600 hover:text-blue-800 hover:underline font-medium break-all mr-4"},$(s.filename),9,wa)):(r(),d("span",ha,[O($(s.name)+" ",1),l[5]||(l[5]=t("span",{class:"text-gray-500 text-sm"},"(Pending Upload)",-1))]))]),e.canUploadProjectDocuments?(r(),d("button",{key:0,type:"button",onClick:w=>M(n),class:"p-2 rounded-full text-red-500 hover:bg-red-100 hover:text-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 transition-colors duration-200",title:"Remove document",disabled:p.value||e.isSaving},l[6]||(l[6]=[t("svg",{class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]),8,xa)):h("",!0)]))),128))])])):e.canViewProjectDocuments?(r(),d("div",ja," No documents found for this project. ")):h("",!0),l[8]||(l[8]=t("div",{class:"mt-6 p-4 bg-blue-50 rounded-lg text-blue-700 text-sm border border-blue-200"},[t("p",null,"Note: Uploaded documents will be stored in the project's designated Google Drive folder.")],-1))]))}},_a={class:"p-6 bg-white rounded-lg font-inter"},Pa={key:0,class:"p-6 bg-gray-50 rounded-lg text-gray-600 text-center border border-gray-200 shadow-sm"},$a={key:1},Sa={class:"mb-6 flex justify-between items-center"},Va={key:0,class:"flex items-center"},Ca={key:1},Da={key:0,class:"text-sm text-red-500 mb-4 bg-red-50 p-3 rounded-md border border-red-200"},Ia={key:1,class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6"},Ua={class:"flex justify-between items-start mb-3"},Ma=["onClick","disabled"],Aa=["onUpdate:modelValue","readonly"],Na={class:"mt-auto pt-3 border-t border-gray-100 text-xs text-gray-500 flex justify-between items-center"},Ta={class:"font-medium text-gray-700"},Ba={key:2,class:"p-8 bg-gray-50 rounded-lg text-gray-600 text-center border border-gray-200 shadow-sm flex flex-col items-center justify-center h-64"},Ra={__name:"ProjectFormNotes",props:{projectId:{type:[Number,String],required:!0},errors:{type:Object,default:()=>({})},canAddProjectNotes:{type:Boolean,default:!1},canViewProjectNotes:{type:Boolean,default:!1},isSaving:{type:Boolean,default:!1}},setup(e){const y=e,a=pe({notes:[]}),b=P(!1),p=async()=>{if(y.projectId)try{const v=await xe(y.projectId,"notes",{canViewProjectNotes:y.canViewProjectNotes,canAddProjectNotes:y.canAddProjectNotes});v&&(a.notes=v.map(l=>{var s,n;return{id:l.id,content:l.content,created_at:l.created_at,creator_name:l.creator_name||((s=l.user)==null?void 0:s.name)||((n=l.creator)==null?void 0:n.name)||"Unknown"}})||[])}catch(v){console.error("Error fetching notes data:",v),F("Failed to load notes data.")}};te(()=>y.projectId,async v=>{v&&await p()},{immediate:!0});const k=()=>{y.canAddProjectNotes&&a.notes.push({id:null,content:"",created_at:new Date().toISOString(),creator_name:"You"})},N=v=>{y.canAddProjectNotes&&a.notes.splice(v,1)},C=async()=>{if(!y.projectId){F("Project ID is missing. Cannot save notes.");return}b.value=!0;const v=a.notes.map(l=>({id:l.id||null,content:l.content}));try{const l=await window.axios.put(`/api/projects/${y.projectId}/sections/notes?type=private`,{notes:v});a.notes=l.data.notes.map(s=>{var n,w;return{id:s.id,content:s.content,created_at:s.created_at,creator_name:s.creator_name||((n=s.user)==null?void 0:n.name)||((w=s.creator)==null?void 0:w.name)||"Unknown"}})||[],oe("Notes updated successfully!"),await p()}catch(l){console.error("Error updating notes:",l),F("Failed to update notes.")}finally{b.value=!1}},M=v=>v?new Date(v).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A";return me(()=>{}),(v,l)=>(r(),d("div",_a,[e.canViewProjectNotes?(r(),d("div",$a,[t("div",Sa,[o(ae,{onClick:k,type:"button",class:"px-5 py-2.5 rounded-lg text-base shadow-sm hover:shadow-md transition-all duration-200",disabled:!e.canAddProjectNotes||b.value||e.isSaving},{default:H(()=>l[0]||(l[0]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 4v16m8-8H4"})],-1),O(" Add New Note ",-1)])),_:1,__:[0]},8,["disabled"]),o(ae,{onClick:C,disabled:!e.projectId||!e.canAddProjectNotes||b.value||e.isSaving,class:W([{"opacity-50 cursor-not-allowed":b.value||e.isSaving},"px-6 py-3 rounded-lg text-lg shadow-md hover:shadow-lg transition-all duration-200"])},{default:H(()=>[b.value||e.isSaving?(r(),d("span",Va,l[1]||(l[1]=[t("svg",{class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),O(" Saving... ",-1)]))):(r(),d("span",Ca,"Save All Notes"))]),_:1},8,["disabled","class"])]),e.projectId?h("",!0):(r(),d("p",Da," Please save the project first before adding or editing notes. ")),a.notes&&a.notes.length>0?(r(),d("div",Ia,[(r(!0),d(ce,null,ue(a.notes,(s,n)=>(r(),d("div",{key:s.id||`new-note-${n}`,class:W(["relative bg-white p-5 rounded-lg shadow-md border border-gray-200 flex flex-col h-64 transition-all duration-200 ease-in-out hover:shadow-lg",{"opacity-75 cursor-not-allowed":!e.canAddProjectNotes||b.value||e.isSaving}])},[t("div",Ua,[o(D,{value:`Note ${n+1}`,class:"text-sm font-semibold text-gray-700"},null,8,["value"]),e.canAddProjectNotes?(r(),d("button",{key:0,type:"button",onClick:w=>N(n),class:"p-1 rounded-full text-red-500 hover:bg-red-100 hover:text-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 transition-colors duration-200",title:"Remove note",disabled:b.value||e.isSaving},l[2]||(l[2]=[t("svg",{class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1)]),8,Ma)):h("",!0)]),ge(t("textarea",{"onUpdate:modelValue":w=>s.content=w,readonly:!e.canAddProjectNotes||b.value||e.isSaving,placeholder:"Type your note content here...",class:"flex-grow border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-lg shadow-sm block w-full resize-none transition-colors duration-200 p-3 text-sm overflow-auto",rows:"6"},null,8,Aa),[[je,s.content]]),o(T,{message:e.errors[`notes.${n}.content`]?e.errors[`notes.${n}.content`][0]:"",class:"mt-2"},null,8,["message"]),t("div",Na,[t("span",null,[l[3]||(l[3]=O("By: ",-1)),t("span",Ta,$(s.creator_name||"Unknown"),1)]),t("span",null,"Last updated: "+$(M(s.created_at)),1)])],2))),128))])):(r(),d("div",Ba,l[4]||(l[4]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-16 w-16 text-gray-400 mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"1"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1),t("p",{class:"text-lg font-medium"},"No notes found for this project.",-1),t("p",{class:"text-sm mt-2"},'Click "Add New Note" to start creating your project notes.',-1)])))])):(r(),d("div",Pa," You do not have permission to view project notes. "))]))}},Oa=["value","rows"],Fa={__name:"TextareaInput",props:{modelValue:[String,Number],rows:{type:[String,Number],default:3}},emits:["update:modelValue"],setup(e){const y=P(null);return me(()=>{y.value.hasAttribute("autofocus")&&y.value.focus()}),(a,b)=>(r(),d("textarea",{class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full",value:e.modelValue,rows:e.rows,onInput:b[0]||(b[0]=p=>a.$emit("update:modelValue",p.target.value)),ref_key:"input",ref:y},null,40,Oa))}},Ea={class:"p-6 bg-gray-50 rounded-xl shadow-lg"},za={class:"flex justify-between items-center mb-6"},La={key:0,class:"flex justify-center py-8"},qa={key:1,class:"bg-white p-8 rounded-lg text-center border border-dashed border-gray-300"},Ka={key:2,class:"space-y-6"},Ha={class:"flex justify-between items-start"},Ga={class:"text-xl font-medium text-gray-900"},Ya={class:"mt-2 flex items-center flex-wrap space-x-4 text-sm text-gray-500"},Wa={key:0,class:"text-gray-700"},Ja={key:1,class:"text-gray-700"},Xa={key:0,class:"mt-4 text-base text-gray-600"},Qa={key:0,class:"flex space-x-2"},Za={class:"p-6 bg-white rounded-lg"},es={class:"text-2xl font-bold text-gray-900 mb-6"},ts={class:"p-4 bg-indigo-50 rounded-lg border border-indigo-200"},as={class:"flex justify-end space-x-3 mt-6"},ss={__name:"ProjectDeliverables",props:{projectId:{type:[Number,String],required:!0},errors:{type:Object,default:()=>({})},isSaving:{type:Boolean,default:!1},canManageProjectDeliverables:{type:Boolean,default:!1},canViewProjectDeliverables:{type:Boolean,default:!0}},emits:["checklist-item-toggled"],setup(e,{emit:y}){const a=e,b=P([]),p=P([]),k=P(!0),N=P([]),C=P(!1),M=P("create"),v=P({id:null,name:"",description:"",milestone_id:null,status:"pending",due_date:"",details:{deliverable_type_key:null,checklist:[]}}),l=P({}),s=P(null),n=[{value:"pending",label:"Pending"},{value:"in_progress",label:"In Progress"},{value:"completed",label:"Completed"},{value:"cancelled",label:"Cancelled"}],w=K(()=>{const u=p.value.find(g=>{var f;return g.key===((f=v.value.details)==null?void 0:f.deliverable_type_key)});return(u==null?void 0:u.checklistItemPlaceholder)||"e.g., Task 1, Task 2, Task 3"});te(()=>a.projectId,I,{immediate:!0});async function I(){if(a.projectId){k.value=!0;try{const u=await ie.get(`/api/projects/${a.projectId}/project-deliverables`);b.value=u.data;const g=await ie.get(`/api/projects/${a.projectId}/milestones`);N.value=g.data;const f=await ie.get("/api/project-deliverable-types");p.value=f.data}catch(u){console.error("Error fetching data:",u),F("Failed to load project data")}finally{k.value=!1}}}function Y(){M.value="create",v.value={id:null,name:"",description:"",milestone_id:null,status:"pending",due_date:"",details:{deliverable_type_key:null,checklist:[{name:"",completed:!1}]}},l.value={},s.value=null,C.value=!0}function J(u){M.value="edit",v.value=JSON.parse(JSON.stringify(u)),v.value.details.checklist||(v.value.details.checklist=[]),(v.value.details.checklist.length===0||v.value.details.checklist[v.value.details.checklist.length-1].name!=="")&&v.value.details.checklist.push({name:"",completed:!1}),l.value={},s.value=v.value.details.deliverable_type_key??null,C.value=!0}async function X(u){var z;if(u===s.value)return;if((((z=v.value.details)==null?void 0:z.checklist)||[]).some(E=>((E==null?void 0:E.name)||"").trim()!=="")){if(!await Ge("Changing the deliverable type may clear your existing checklist items. Do you want to proceed?",{confirmText:"Proceed",cancelText:"Cancel",type:"warning"})){v.value.details.deliverable_type_key=s.value;return}v.value.details.checklist=[{name:"",completed:!1}]}s.value=u}async function U(){l.value={};try{let u;const g=v.value.details.checklist.filter(z=>z.name.trim()!==""),f={...v.value,details:{...v.value.details,checklist:g}};M.value==="create"?(u=await ie.post(`/api/projects/${a.projectId}/project-deliverables`,f),oe("Project deliverable created successfully")):(u=await ie.put(`/api/project-deliverables/${v.value.id}`,f),oe("Project deliverable updated successfully")),await I(),C.value=!1}catch(u){console.error("Error saving deliverable:",u),u.response&&u.response.data&&u.response.data.errors?l.value=u.response.data.errors:F("Failed to save project deliverable")}}async function B(u){if(confirm("Are you sure you want to delete this deliverable?"))try{await ie.delete(`/api/project-deliverables/${u}`),oe("Project deliverable deleted successfully"),await I()}catch(g){console.error("Error deleting deliverable:",g),F("Failed to delete project deliverable")}}function ne(u){return u?new Date(u).toLocaleDateString():"N/A"}return(u,g)=>(r(),d("div",Ea,[t("div",za,[g[10]||(g[10]=t("h3",{class:"text-2xl font-bold text-gray-900"},"Project Deliverables",-1)),e.canManageProjectDeliverables?(r(),Z(ae,{key:0,onClick:Y,disabled:e.isSaving||k.value},{default:H(()=>g[9]||(g[9]=[O(" Add Deliverable ",-1)])),_:1,__:[9]},8,["disabled"])):h("",!0)]),k.value?(r(),d("div",La,g[11]||(g[11]=[t("div",{class:"animate-spin rounded-full h-10 w-10 border-b-2 border-indigo-600"},null,-1)]))):b.value.length===0?(r(),d("div",qa,[g[13]||(g[13]=t("p",{class:"text-gray-600 text-lg"},"No deliverables have been added to this project yet.",-1)),e.canManageProjectDeliverables?(r(),Z(ae,{key:0,onClick:Y,class:"mt-6"},{default:H(()=>g[12]||(g[12]=[O(" Add Your First Deliverable ",-1)])),_:1,__:[12]})):h("",!0)])):(r(),d("div",Ka,[(r(!0),d(ce,null,ue(b.value,f=>{var z;return r(),d("div",{key:f.id,class:"bg-white border border-gray-200 rounded-xl p-6 shadow-sm hover:shadow-lg transition-all duration-300"},[t("div",Ha,[t("div",null,[t("h4",Ga,$(f.name),1),t("div",Ya,[t("span",{class:W({"font-medium py-1 px-3 rounded-full text-white":!0,"bg-yellow-500":f.status==="pending","bg-blue-500":f.status==="in_progress","bg-green-500":f.status==="completed","bg-red-500":f.status==="cancelled"})},$(f.status.replace("_"," ").toUpperCase()),3),f.milestone?(r(),d("span",Wa,[g[14]||(g[14]=t("span",{class:"font-semibold"},"Milestone:",-1)),O(" "+$(f.milestone.name),1)])):h("",!0),f.due_date?(r(),d("span",Ja,[g[15]||(g[15]=t("span",{class:"font-semibold"},"Due:",-1)),O(" "+$(ne(f.due_date)),1)])):h("",!0)]),f.description?(r(),d("p",Xa,$(f.description),1)):h("",!0),(z=f.details)!=null&&z.checklist&&f.details.checklist.length>0?(r(),Z(st,{key:1,items:f.details.checklist,"api-endpoint":`/api/project-deliverables/${f.id}`,title:"Deliverable Checklist:","payload-transformer":(E,x)=>({...f,details:{...f.details,checklist:E}}),onItemToggled:E=>u.$emit("checklist-item-toggled",{deliverable:f,index:E.index,completed:E.completed})},null,8,["items","api-endpoint","payload-transformer","onItemToggled"])):h("",!0)]),e.canManageProjectDeliverables?(r(),d("div",Qa,[o(be,{onClick:E=>J(f),size:"sm"},{default:H(()=>g[16]||(g[16]=[O(" Edit ",-1)])),_:2,__:[16]},1032,["onClick"]),o(rt,{onClick:E=>B(f.id),size:"sm"},{default:H(()=>g[17]||(g[17]=[O(" Delete ",-1)])),_:2,__:[17]},1032,["onClick"])])):h("",!0)])])}),128))])),o(it,{show:C.value,onClose:g[8]||(g[8]=f=>C.value=!1),maxWidth:"2xl"},{default:H(()=>{var f,z,E,x,c;return[t("div",Za,[t("h3",es,$(M.value==="create"?"Add New Deliverable":"Edit Deliverable"),1),t("form",{onSubmit:He(U,["prevent"]),class:"space-y-6"},[t("div",null,[o(D,{for:"name",value:"Name"}),o(G,{id:"name",modelValue:v.value.name,"onUpdate:modelValue":g[0]||(g[0]=i=>v.value.name=i),type:"text",class:"mt-1 block w-full",required:""},null,8,["modelValue"]),o(T,{message:(f=l.value.name)==null?void 0:f[0],class:"mt-2"},null,8,["message"])]),t("div",null,[o(D,{for:"description",value:"Description"}),o(Fa,{id:"description",modelValue:v.value.description,"onUpdate:modelValue":g[1]||(g[1]=i=>v.value.description=i),class:"mt-1 block w-full",rows:"3"},null,8,["modelValue"]),o(T,{message:(z=l.value.description)==null?void 0:z[0],class:"mt-2"},null,8,["message"])]),t("div",null,[o(D,{for:"milestone_id",value:"Milestone (Optional)"}),o(ee,{id:"milestone_id",modelValue:v.value.milestone_id,"onUpdate:modelValue":g[2]||(g[2]=i=>v.value.milestone_id=i),options:N.value,valueKey:"id",labelKey:"name",placeholder:"Select a milestone",class:"mt-1 block w-full"},null,8,["modelValue","options"]),o(T,{message:(E=l.value.milestone_id)==null?void 0:E[0],class:"mt-2"},null,8,["message"])]),t("div",null,[o(D,{for:"status",value:"Status"}),o(ee,{id:"status",modelValue:v.value.status,"onUpdate:modelValue":g[3]||(g[3]=i=>v.value.status=i),options:n,valueKey:"value",labelKey:"label",placeholder:"Select a Status",class:"mt-1 block w-full"},null,8,["modelValue"]),o(T,{message:(x=l.value.status)==null?void 0:x[0],class:"mt-2"},null,8,["message"])]),t("div",null,[o(D,{for:"due_date",value:"Due Date (Optional)"}),o(G,{id:"due_date",modelValue:v.value.due_date,"onUpdate:modelValue":g[4]||(g[4]=i=>v.value.due_date=i),type:"date",class:"mt-1 block w-full"},null,8,["modelValue"]),o(T,{message:(c=l.value.due_date)==null?void 0:c[0],class:"mt-2"},null,8,["message"])]),t("div",ts,[g[18]||(g[18]=t("h4",{class:"text-lg font-semibold text-indigo-800 mb-4"},"Deliverable Checklist",-1)),t("div",null,[o(D,{for:"deliverable_type_key",value:"Deliverable Type"}),o(ee,{id:"deliverable_type_key",modelValue:v.value.details.deliverable_type_key,"onUpdate:modelValue":[g[5]||(g[5]=i=>v.value.details.deliverable_type_key=i),X],options:p.value,valueKey:"key",labelKey:"name",placeholder:"Select a Deliverable Type",class:"mt-1 block w-full",required:""},null,8,["modelValue","options"])]),o(lt,{modelValue:v.value.details.checklist,"onUpdate:modelValue":g[6]||(g[6]=i=>v.value.details.checklist=i),placeholder:w.value,label:"Checklist Items",containerClass:"mt-4"},null,8,["modelValue","placeholder"])]),t("div",as,[o(be,{onClick:g[7]||(g[7]=i=>C.value=!1),disabled:e.isSaving},{default:H(()=>g[19]||(g[19]=[O(" Cancel ",-1)])),_:1,__:[19]},8,["disabled"]),o(ae,{type:"submit",disabled:e.isSaving},{default:H(()=>[O($(M.value==="create"?"Create":"Update"),1)]),_:1},8,["disabled"])])],32)])]}),_:1},8,["show"])]))}},ls={class:"p-6 bg-white rounded-lg font-inter"},os={key:0,class:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4",role:"alert"},ns={class:"block sm:inline ml-2"},rs={key:1,class:"flex items-center justify-center py-8"},is={key:2},ds={key:0,class:"bg-gradient-to-r from-blue-500 to-indigo-600 text-white p-6 rounded-lg shadow-md mb-6"},cs={class:"flex items-center justify-between"},us={class:"text-3xl font-bold mt-1"},ms={class:"text-sm opacity-90 mt-2"},vs={class:"font-semibold"},ps={class:"font-semibold"},gs={key:1,class:"bg-gray-100 text-gray-600 p-4 rounded-lg shadow-sm mb-6 text-center"},ys={class:"bg-gray-50 p-6 rounded-lg shadow-sm mb-6 border border-gray-200"},fs={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},bs=["disabled"],ws=["value"],hs={class:"bg-gray-50 p-6 rounded-lg shadow-sm mb-6 border border-gray-200"},xs={class:"mb-4"},js={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-1 gap-4"},ks={class:"flex items-center justify-between"},_s=["for"],Ps={class:"ms-2 text-base font-medium text-gray-800"},$s=["onClick"],Ss={key:0,class:"mt-4 pt-4 border-t border-gray-200"},Vs={class:"grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4"},Cs={class:"grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4"},Ds=["id","onUpdate:modelValue","disabled"],Is={key:0,class:"mt-4 p-4 bg-blue-50 rounded-lg border border-blue-200"},Us={class:"flex justify-between items-center mb-3"},Ms={class:"space-y-4"},As={class:"flex justify-between items-center mb-2"},Ns=["onClick"],Ts={class:"grid grid-cols-1 sm:grid-cols-2 gap-4"},Bs=["onClick"],Rs={key:0},Os={class:"mt-6 pt-4 border-t border-gray-200"},Fs={key:1,class:"mt-4 flex items-center"},Es={key:2,class:"mt-6 flex justify-end"},zs={__name:"ServicesAndPaymentForm",props:{projectId:{type:[Number,String],required:!0},paymentTypeOptions:{type:Array,required:!0},canManageProjectServicesAndPayments:{type:Boolean,required:!0},canViewProjectServicesAndPayments:{type:Boolean,required:!0}},emits:["updated"],setup(e,{emit:y}){const a=e,b=y,p=P({}),k=P(!1),N=[{value:"PKR",label:"PKR"},{value:"AUD",label:"AUD"},{value:"INR",label:"INR"},{value:"USD",label:"USD"},{value:"EUR",label:"EUR"},{value:"GBP",label:"GBP"}],M=P([...[{value:"Website Designing",label:"Website Designing"},{value:"SEO",label:"SEO"},{value:"Social Media",label:"Social Media"},{value:"Content Writing",label:"Content Writing"},{value:"Graphic Design",label:"Graphic Design"}]]),v=P(""),l=P(!1),s=pe({services:[],service_details:[],payment_type:"one_off",currency:"AUD"}),n=pe({}),w=K(()=>{let x=0;return s.services.forEach(c=>{const i=u(c);i&&i.amount&&(x+=parseFloat(i.amount))}),x.toFixed(2)}),I=K(()=>{let x=null,c=null;const i=new Date;return i.setHours(0,0,0,0),s.service_details.forEach(j=>{j.frequency==="one_off"&&j.payment_breakdown&&j.payment_breakdown.forEach(A=>{var R;if(A.due_date){const q=new Date(A.due_date);q.setHours(0,0,0,0),q>=i&&(!x||q<x.date)&&(x={date:q,serviceId:j.service_id,paymentLabel:A.label},c=((R=M.value.find(ve=>ve.value===j.service_id))==null?void 0:R.label)||j.service_id)}})}),x?{date:x.date.toLocaleDateString(),serviceLabel:c,paymentLabel:x.paymentLabel}:null}),Y=K(()=>{const x=s.services.filter(c=>{const i=u(c);return i&&i.frequency!=="monthly"});return x.length===0?!0:x.every(c=>g(c)===100)}),J=K(()=>!a.projectId||!a.canManageProjectServicesAndPayments||!Y.value),X=()=>{const x=v.value.trim();x&&!M.value.some(c=>c.label.toLowerCase()===x.toLowerCase())&&(M.value.push({value:x,label:x}),v.value="",l.value=!1)},U=async()=>{if(a.projectId){k.value=!0;try{const c=(await window.axios.get(`/api/projects/${a.projectId}/sections/services-payment`)).data;return s.services=c.services||[],s.service_details=c.service_details||[],s.payment_type=c.payment_type||"one_off",s.currency=c.currency||"AUD",s.services.forEach(i=>{M.value.some(j=>j.value===i)||M.value.push({value:i,label:i}),n[i]=!1}),s.service_details.forEach(i=>{if(i.payment_breakdown&&!Array.isArray(i.payment_breakdown)){const j=i.payment_breakdown;i.payment_breakdown=[{label:"First",percentage:parseInt(j.first)||30,due_date:null},{label:"Second",percentage:parseInt(j.second)||30,due_date:null},{label:"Third",percentage:parseInt(j.third)||40,due_date:null}]}else!i.payment_breakdown||i.payment_breakdown.length===0?i.payment_breakdown=[{label:"Payment 1",percentage:100,due_date:null}]:i.payment_breakdown.forEach(j=>{j.due_date===void 0&&(j.due_date=null)})}),c}catch(x){return console.error("Error fetching services and payment data:",x),p.value.general="Failed to fetch services and payment data.",null}finally{k.value=!1}}},B=async()=>{p.value={},k.value=!0;try{const x={services:s.services,service_details:s.service_details,total_amount:parseFloat(w.value),payment_type:s.payment_type,currency:s.currency},c=await window.axios.put(`/api/projects/${a.projectId}/sections/services-payment`,x);oe("Services and payment information updated successfully!"),b("updated")}catch(x){x.response&&x.response.status===422?p.value=x.response.data.errors:x.response&&x.response.data.message?p.value.general=x.response.data.message:(p.value.general="Failed to update services and payment information.",console.error("Error:",x))}finally{k.value=!1}},ne=(x,c)=>{c?(s.service_details.some(i=>i.service_id===x)||s.service_details.push({service_id:x,amount:"",frequency:"one_off",start_date:"",payment_breakdown:[{label:"Payment 1",percentage:100,due_date:null}],currency:s.currency}),n[x]=!0):(s.service_details=s.service_details.filter(i=>i.service_id!==x),n[x]=!1)},u=x=>{let c=s.service_details.find(i=>i.service_id===x);if(!c)c={service_id:x,amount:"",frequency:"one_off",start_date:"",payment_breakdown:[{label:"Payment 1",percentage:100,due_date:null}],currency:s.currency},s.service_details.push(c);else if(c.payment_breakdown&&!Array.isArray(c.payment_breakdown)){const i=c.payment_breakdown;c.payment_breakdown=[{label:"First",percentage:parseInt(i.first)||30,due_date:null},{label:"Second",percentage:parseInt(i.second)||30,due_date:null},{label:"Third",percentage:parseInt(i.third)||40,due_date:null}]}else!c.payment_breakdown||c.payment_breakdown.length===0?c.payment_breakdown=[{label:"Payment 1",percentage:100,due_date:null}]:c.payment_breakdown.forEach(i=>{i.due_date===void 0&&(i.due_date=null)});return c},g=x=>{const c=u(x);return!c.payment_breakdown||!Array.isArray(c.payment_breakdown)?0:c.payment_breakdown.reduce((i,j)=>i+(parseInt(j.percentage)||0),0)},f=x=>{const c=u(x);if(c.payment_breakdown||(c.payment_breakdown=[]),!Array.isArray(c.payment_breakdown)){const A=c.payment_breakdown;c.payment_breakdown=[{label:"First",percentage:parseInt(A.first)||30,due_date:null},{label:"Second",percentage:parseInt(A.second)||30,due_date:null},{label:"Third",percentage:parseInt(A.third)||40,due_date:null}]}const i=c.payment_breakdown.length;let j=0;if(i>0){const A=c.payment_breakdown[i-1];j=Math.floor(A.percentage/2),A.percentage-=j}else j=100;c.payment_breakdown.push({label:`Payment ${i+1}`,percentage:j,due_date:null})},z=(x,c)=>{const i=u(x);if(!i.payment_breakdown||!Array.isArray(i.payment_breakdown)||i.payment_breakdown.length<=1)return;const j=parseInt(i.payment_breakdown[c].percentage)||0;if(i.payment_breakdown.splice(c,1),j>0&&i.payment_breakdown.length>0){const A=c>0&&c<=i.payment_breakdown.length?c-1:0;i.payment_breakdown[A].percentage=(parseInt(i.payment_breakdown[A].percentage)||0)+j}i.payment_breakdown.forEach((A,R)=>{A.label=`Payment ${R+1}`})},E=x=>{n[x]=!n[x]};return te(()=>a.projectId,x=>{x&&U()},{immediate:!0}),(x,c)=>(r(),d("div",ls,[p.value.general?(r(),d("div",os,[c[6]||(c[6]=t("strong",{class:"font-bold"},"Error!",-1)),t("span",ns,$(p.value.general),1)])):h("",!0),k.value?(r(),d("div",rs,c[7]||(c[7]=[t("svg",{class:"animate-spin -ml-1 mr-3 h-8 w-8 text-blue-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),t("span",{class:"text-gray-600"},"Loading services and payment data...",-1)]))):(r(),d("div",is,[I.value?(r(),d("div",ds,[t("div",cs,[t("div",null,[c[10]||(c[10]=t("p",{class:"text-sm opacity-90"},"Next Payment Due",-1)),t("p",us,$(I.value.date),1),t("p",ms,[c[8]||(c[8]=O(" For: ",-1)),t("span",vs,$(I.value.serviceLabel),1),c[9]||(c[9]=O(" - ",-1)),t("span",ps,$(I.value.paymentLabel),1)])]),c[11]||(c[11]=t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-12 w-12 opacity-70",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1))])])):(r(),d("div",gs," No upcoming payment due dates found for one-off services. ")),t("div",ys,[c[13]||(c[13]=t("h4",{class:"text-xl font-semibold text-gray-700 mb-4"},"Overall Project Payment Details",-1)),t("div",fs,[t("div",null,[o(D,{for:"calculated_total_amount",value:"Calculated Total Amount"}),o(G,{id:"calculated_total_amount",type:"text",class:"mt-1 block w-full bg-gray-100 cursor-not-allowed",value:w.value,disabled:""},null,8,["value"]),c[12]||(c[12]=t("p",{class:"text-sm text-gray-500 mt-1"},"This amount is automatically calculated from selected services.",-1))]),t("div",null,[o(D,{for:"payment_type",value:"Payment Type"}),ge(t("select",{id:"payment_type",class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full p-2.5","onUpdate:modelValue":c[0]||(c[0]=i=>s.payment_type=i),required:"",disabled:!e.canManageProjectServicesAndPayments},[(r(!0),d(ce,null,ue(e.paymentTypeOptions,i=>(r(),d("option",{key:i.value,value:i.value},$(i.label),9,ws))),128))],8,bs),[[Ve,s.payment_type]]),o(T,{message:p.value.payment_type?p.value.payment_type[0]:"",class:"mt-2"},null,8,["message"])]),t("div",null,[o(D,{for:"overall_currency",value:"Overall Project Currency"}),o(ee,{id:"overall_currency",modelValue:s.currency,"onUpdate:modelValue":c[1]||(c[1]=i=>s.currency=i),options:N,"value-key":"value","label-key":"label",class:"w-full mt-1",disabled:!e.canManageProjectServicesAndPayments},null,8,["modelValue","disabled"]),o(T,{message:p.value.currency?p.value.currency[0]:"",class:"mt-2"},null,8,["message"])])])]),t("div",hs,[c[20]||(c[20]=t("h4",{class:"text-xl font-semibold text-gray-700 mb-4"},"Manage Services",-1)),t("div",xs,[o(D,{for:"services",value:"Select Services",class:"mb-2"}),t("div",js,[(r(!0),d(ce,null,ue(M.value,i=>(r(),d("div",{key:i.value,class:"bg-white p-4 rounded-lg shadow-sm border border-gray-200"},[t("div",ks,[t("label",{for:`service_${i.value}`,class:"flex items-center cursor-pointer"},[o(dt,{id:`service_${i.value}`,value:i.value,checked:s.services,"onUpdate:checked":[c[2]||(c[2]=j=>s.services=j),j=>ne(i.value,j)],disabled:!e.canManageProjectServicesAndPayments},null,8,["id","value","checked","onUpdate:checked","disabled"]),t("span",Ps,$(i.label),1)],8,_s),(s.services||[]).includes(i.value)?(r(),d("button",{key:0,onClick:j=>E(i.value),type:"button",class:W(["text-gray-500 hover:text-gray-700 transition-transform duration-200",{"rotate-180":n[i.value]}])},c[14]||(c[14]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"})],-1)]),10,$s)):h("",!0)]),(s.services||[]).includes(i.value)&&n[i.value]?(r(),d("div",Ss,[t("div",Vs,[t("div",null,[o(D,{for:`service_amount_${i.value}`,value:"Amount"},null,8,["for"]),o(G,{id:`service_amount_${i.value}`,type:"number",step:"0.01",placeholder:"Service Amount",class:"w-full mt-1",modelValue:u(i.value).amount,"onUpdate:modelValue":j=>u(i.value).amount=j,disabled:!e.canManageProjectServicesAndPayments},null,8,["id","modelValue","onUpdate:modelValue","disabled"])]),t("div",null,[o(D,{for:`service_currency_${i.value}`,value:"Currency"},null,8,["for"]),o(ee,{id:`service_currency_${i.value}`,modelValue:u(i.value).currency,"onUpdate:modelValue":j=>u(i.value).currency=j,options:N,"value-key":"value","label-key":"label",class:"w-full mt-1",disabled:!e.canManageProjectServicesAndPayments},null,8,["id","modelValue","onUpdate:modelValue","disabled"])])]),t("div",Cs,[t("div",null,[o(D,{for:`service_frequency_${i.value}`,value:"Frequency"},null,8,["for"]),ge(t("select",{id:`service_frequency_${i.value}`,class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full p-2.5","onUpdate:modelValue":j=>u(i.value).frequency=j,disabled:!e.canManageProjectServicesAndPayments},c[15]||(c[15]=[t("option",{value:"monthly"},"Monthly",-1),t("option",{value:"one_off"},"One off",-1)]),8,Ds),[[Ve,u(i.value).frequency]])]),t("div",null,[o(D,{for:`service_start_date_${i.value}`,value:"Start Date"},null,8,["for"]),o(G,{id:`service_start_date_${i.value}`,type:"date",class:"w-full mt-1",modelValue:u(i.value).start_date,"onUpdate:modelValue":j=>u(i.value).start_date=j,disabled:!e.canManageProjectServicesAndPayments},null,8,["id","modelValue","onUpdate:modelValue","disabled"])])]),u(i.value).frequency!=="monthly"?(r(),d("div",Is,[t("div",Us,[o(D,{value:"Payment Breakdown (%)",class:"text-base font-medium text-blue-800"}),e.canManageProjectServicesAndPayments?(r(),Z(ae,{key:0,type:"button",onClick:j=>f(i.value),class:"px-4 py-2 text-sm"},{default:H(()=>c[16]||(c[16]=[O(" + Add Payment Step ",-1)])),_:2,__:[16]},1032,["onClick"])):h("",!0)]),t("div",Ms,[(r(!0),d(ce,null,ue(u(i.value).payment_breakdown,(j,A)=>(r(),d("div",{key:A,class:"bg-white p-4 rounded-md shadow-sm border border-blue-100"},[t("div",As,[o(D,{for:`payment_label_${A}_${i.value}`,value:j.label,class:"font-semibold"},null,8,["for","value"]),e.canManageProjectServicesAndPayments&&u(i.value).payment_breakdown.length>1?(r(),d("button",{key:0,type:"button",class:"text-red-500 hover:text-red-700 p-1 rounded-full hover:bg-red-100 transition-colors",onClick:R=>z(i.value,A),title:"Remove payment step"},c[17]||(c[17]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor"},[t("path",{"fill-rule":"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 011-1h4a1 1 0 110 2H8a1 1 0 01-1-1zm-1 3a1 1 0 100 2h8a1 1 0 100-2H6z","clip-rule":"evenodd"})],-1)]),8,Ns)):h("",!0)]),t("div",Ts,[t("div",null,[o(D,{for:`payment_percentage_${A}_${i.value}`,value:"Percentage (%)",class:"text-sm"},null,8,["for"]),o(G,{id:`payment_percentage_${A}_${i.value}`,type:"number",min:"0",max:"100",class:"w-full mt-1",modelValue:j.percentage,"onUpdate:modelValue":R=>j.percentage=R,modelModifiers:{number:!0},onInput:R=>{j.percentage=Math.max(0,Math.min(100,parseInt(R.target.value)||0))},disabled:!e.canManageProjectServicesAndPayments},null,8,["id","modelValue","onUpdate:modelValue","onInput","disabled"])]),t("div",null,[o(D,{for:`payment_due_date_${A}_${i.value}`,value:"Due Date (Optional)",class:"text-sm"},null,8,["for"]),o(G,{id:`payment_due_date_${A}_${i.value}`,type:"date",class:"w-full mt-1",modelValue:j.due_date,"onUpdate:modelValue":R=>j.due_date=R,disabled:!e.canManageProjectServicesAndPayments},null,8,["id","modelValue","onUpdate:modelValue","disabled"]),e.canManageProjectServicesAndPayments&&j.due_date?(r(),d("button",{key:0,type:"button",class:"text-xs text-red-500 hover:text-red-700 mt-1",onClick:R=>j.due_date=null}," Clear Date ",8,Bs)):h("",!0)])])]))),128))]),t("div",{class:W(["text-sm mt-4 p-2 rounded-md",{"bg-green-100 text-green-700":g(i.value)===100,"bg-red-100 text-red-700 font-bold":g(i.value)!==100}])},[O(" Total Percentage: "+$(g(i.value))+"% ",1),g(i.value)!==100?(r(),d("span",Rs," (Total must be 100%) ")):h("",!0)],2)])):h("",!0)])):h("",!0)]))),128))])]),t("div",Os,[e.canManageProjectServicesAndPayments&&!l.value?(r(),d("button",{key:0,type:"button",class:"inline-flex items-center px-4 py-2 bg-blue-600 border border-transparent rounded-md font-semibold text-xs text-white uppercase tracking-widest hover:bg-blue-700 active:bg-blue-900 focus:outline-none focus:border-blue-900 focus:ring ring-blue-300 disabled:opacity-25 transition ease-in-out duration-150 shadow-md",onClick:c[3]||(c[3]=i=>l.value=!0)},c[18]||(c[18]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 4v16m8-8H4"})],-1),O(" Add New Service/Department ",-1)]))):h("",!0),e.canManageProjectServicesAndPayments&&l.value?(r(),d("div",Fs,[o(G,{type:"text",class:"flex-grow mr-2 border-gray-300 rounded-md shadow-sm p-2.5",modelValue:v.value,"onUpdate:modelValue":c[4]||(c[4]=i=>v.value=i),placeholder:"Enter new service/department name",onKeyup:Ye(X,["enter"])},null,8,["modelValue"]),o(ae,{onClick:X},{default:H(()=>c[19]||(c[19]=[O("Add",-1)])),_:1,__:[19]}),t("button",{type:"button",class:"ml-2 text-sm text-gray-500 hover:text-gray-700 px-3 py-2 rounded-md transition-colors",onClick:c[5]||(c[5]=i=>{l.value=!1,v.value=""})}," Cancel ")])):h("",!0)]),o(T,{message:p.value.services?p.value.services[0]:"",class:"mt-2"},null,8,["message"])]),e.canManageProjectServicesAndPayments?(r(),d("div",Es,[o(ae,{onClick:B,disabled:J.value,class:W([{"opacity-50 cursor-not-allowed":J.value},"px-6 py-3 text-base"])},{default:H(()=>c[21]||(c[21]=[O(" Update Services & Payment ",-1)])),_:1,__:[21]},8,["disabled","class"])])):h("",!0)]))]))}},Q=P({}),Ls=localStorage.getItem("displayCurrency"),Te=P(Ls||"USD");te(Te,e=>{localStorage.setItem("displayCurrency",e)});const Me=async()=>{try{const e=await window.axios.get("/api/currency-rates");Q.value=e.data,console.log("Fetched currency rates:",Q.value)}catch(e){console.error("Failed to fetch currency rates:",e),Q.value={PKR:.0034,AUD:.65,INR:.012,EUR:1.08,GBP:1.28,USD:1}}},le=(e,y="USD")=>{if(isNaN(e)||e==null)return"0.00";try{return new Intl.NumberFormat("en-US",{style:"currency",currency:y,minimumFractionDigits:2,maximumFractionDigits:2}).format(e)}catch(a){return console.warn(`Error formatting currency for ${e} ${y}:`,a),`${y} ${parseFloat(e).toFixed(2)}`}},fe=(e,y,a)=>{if(isNaN(e)||e==null||!y||!a)return 0;if(y.toUpperCase()===a.toUpperCase())return Number(e);const b=Q.value,p=b[y.toUpperCase()],k=b[a.toUpperCase()];if(!p||!k)return console.warn(`Missing conversion rates for: ${y} or ${a}. Cannot perform conversion.`),Number(e);const C=Number(e)*p/k;return Number(C.toFixed(2))},qs={class:"p-6 bg-white rounded-lg"},Ks={key:0,class:"text-red-600 text-sm mb-4"},Hs={key:1,class:"mb-6 p-4 bg-gray-50 rounded-md"},Gs={class:"mb-6"},Ys={class:"flex justify-end items-center mb-4"},Ws={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},Js={class:"p-3 bg-blue-100 rounded-md"},Xs={class:"text-lg font-bold text-blue-800"},Qs={class:"p-3 bg-red-100 rounded-md"},Zs={class:"text-lg font-bold text-red-800"},el={class:"text-xs text-gray-500"},tl={class:"p-3 bg-purple-100 rounded-md"},al={class:"text-lg font-bold text-purple-800"},sl={class:"p-3 bg-green-100 rounded-md"},ll={class:"text-lg font-bold text-green-800"},ol={class:"p-3 bg-yellow-100 rounded-md col-span-full md:col-span-1"},nl={class:"text-lg font-bold text-yellow-800"},rl={class:"text-xs text-gray-500"},il={class:"p-3 bg-orange-100 rounded-md col-span-full md:col-span-1"},dl={class:"text-lg font-bold text-orange-900 mt-1"},cl={class:"text-xs text-gray-500"},ul={class:"p-3 bg-gray-100 rounded-md col-span-full md:col-span-1"},ml={class:"text-lg font-bold mt-1 text-green-400"},vl={class:"p-3 bg-gray-100 rounded-md col-span-full md:col-span-1"},pl={class:"text-lg font-bold text-red-400 mt-1"},gl={class:"grid grid-cols-1 gap-4 md:grid-cols-2"},yl={key:0},fl={key:1},bl={class:"mt-4 flex justify-end"},wl={key:2},hl={key:0,class:"space-y-3"},xl={key:1,class:"p-4 bg-gray-50 rounded-md text-gray-600 text-center"},jl={key:2,class:"space-y-4"},kl={class:"flex justify-between items-start mb-2"},_l={class:"flex-grow"},Pl={class:"font-medium text-gray-900 text-lg"},$l={class:"text-xs text-gray-500 mt-1"},Sl={class:"flex-shrink-0 text-right"},Vl={key:0,class:"text-sm text-gray-600"},Cl={class:"flex justify-between items-end text-xs text-gray-600 mt-2 border-t border-gray-200 pt-2"},Dl={key:0,class:"block"},Il={key:1,class:"block"},Ul={key:2,class:"block mt-1 text-gray-500"},Ml={class:"flex space-x-2 mt-2"},Al={key:0,class:"mt-4 p-4 bg-blue-50 rounded-md border border-blue-200"},Nl={class:"text-md font-medium text-gray-900 mb-4"},Tl={class:"mb-4"},Bl={class:"mb-4"},Rl={class:"flex items-center"},Ol=["disabled"],Fl={class:"text-sm text-gray-700"},El={key:0,class:"mb-4"},zl={class:"flex justify-end space-x-2"},Ae=.25,Ll={__name:"ProjectTransactions",props:{projectId:{type:[Number,String],required:!0},userProjectRole:{type:Object,default:()=>({})}},setup(e){const y=e,{canDo:a,canManage:b}=Ne(()=>y.projectId),p=b("project_expenses",y.userProjectRole),k=b("project_income",y.userProjectRole),N=a("view_project_transactions",y.userProjectRole),C=P([]),M=P([]),v=P({}),l=P(""),s=P(!1),n=P(null),w=P(""),I=P(!1),Y=P({}),J=P(null),X=P(""),U=P({description:"",amount:"",currency:"PKR",user_id:null,hours_spent:"",type:"expense"}),B=Te,ne=[{value:"PKR",label:"PKR"},{value:"AUD",label:"AUD"},{value:"INR",label:"INR"},{value:"USD",label:"USD"},{value:"EUR",label:"EUR"},{value:"GBP",label:"GBP"}],u=[{value:"expense",label:"Expense"},{value:"income",label:"Income"},{value:"bonus",label:"Bonus"}],g=K(()=>M.value.map(_=>({value:_.id,label:_.name||"Unknown User"}))),f=()=>{const _=new Date,m=_.getFullYear(),L=String(_.getMonth()+1).padStart(2,"0"),se=String(_.getDate()).padStart(2,"0");return`${m}-${L}-${se}`},z=async()=>{if(!(!y.projectId||!N.value))try{const _=await window.axios.get(`/api/projects/${y.projectId}/sections/clients-users`);M.value=_.data.users||[]}catch(_){l.value="Failed to fetch users.",console.error("Error fetching users:",_)}},E=async()=>{if(!(!y.projectId||!N.value)){s.value=!0;try{(!Q.value||Object.keys(Q.value).length===0)&&await Me();const _=await window.axios.get(`/api/projects/${y.projectId}/sections/transactions`);C.value=_.data}catch(_){l.value="Failed to fetch transactions.",console.error("Error fetching transactions:",_)}finally{s.value=!1}}},x=async()=>{var _;if(!p.value&&!k.value){F("You do not have permission to manage transactions.");return}if(!U.value.amount||isNaN(U.value.amount)){v.value.amount=["Please enter a valid amount"];return}if(U.value.type==="expense"&&!p.value){F("You do not have permission to add expenses.");return}if(U.value.type==="income"&&!k.value){F("You do not have permission to add income.");return}if(U.value.type==="bonus"&&!p.value){F("You do not have permission to add bonuses.");return}v.value={},l.value="",s.value=!0;try{const m={...U.value,amount:Number(U.value.amount)},L=await window.axios.post(`/api/projects/${y.projectId}/transactions`,m);await E(),c(),oe("Transaction saved successfully!")}catch(m){((_=m.response)==null?void 0:_.status)===422?v.value=m.response.data.errors:(l.value="Failed to save transaction.",console.error("Error saving transaction:",m))}finally{s.value=!1}},c=()=>{U.value={description:"",amount:"",currency:"PKR",user_id:null,hours_spent:"",type:"expense"}},i=async _=>{if(!p.value&&!k.value){F("You do not have permission to delete transactions.");return}if(window.confirm("Are you sure you want to delete this transaction?"))try{const m=C.value[_].id;await window.axios.delete(`/api/projects/${y.projectId}/transactions/${m}`),await E(),oe("Transaction deleted successfully!")}catch(m){l.value="Failed to delete transaction.",console.error("Error deleting transaction:",m)}},j=_=>{if(!p.value&&!k.value){F("You do not have permission to manage transactions.");return}const m=C.value[_];n.value===m.id?(n.value=null,J.value=null,X.value=""):(J.value=_,n.value=m.id,w.value=m.amount,I.value=!1,Y.value={},X.value=f(),(Number(m.amount)===0||Math.abs(Number(w.value)-Number(m.amount))<.01)&&(I.value=!0))};te(w,_=>{if(J.value!==null){const m=C.value[J.value];I.value=Math.abs(Number(_)-Number(m.amount))<.01}});const A=()=>{n.value=null,J.value=null,w.value="",I.value=!1,Y.value={},X.value=""},R=async()=>{var se;if(!p.value&&!k.value){F("You do not have permission to manage transactions.");return}const _=J.value,m=C.value[_],L=Number(w.value);if(!I.value&&(!w.value||isNaN(L)||L<=0||L>Number(m.amount))){Y.value.amount=["Please enter a valid amount between 0 and "+le(Number(m.amount),m.currency)];return}if(!X.value){Y.value.date=["Please select a payment date."];return}Y.value={},s.value=!0;try{const de=m.id,ye=I.value||Math.abs(L-Number(m.amount))<.01,he={payment_amount:ye?Number(m.amount):L,pay_in_full:ye,transaction_currency:m.currency,transaction_type:m.type,original_description:m.description,payment_date:X.value};await window.axios.patch(`/api/projects/${y.projectId}/transactions/${de}/process-payment`,he),await E(),oe("Payment processed successfully!"),A()}catch(de){((se=de.response)==null?void 0:se.status)===422?Y.value=de.response.data.errors:(l.value="Failed to process payment.",console.error("Error processing payment:",de))}finally{s.value=!1}},q=K(()=>!Q.value||Object.keys(Q.value).length===0?0:C.value.filter(_=>_.type==="income").reduce((_,m)=>_+fe(parseFloat(m.amount||0),m.currency,B.value),0)),ve=K(()=>!Q.value||Object.keys(Q.value).length===0?0:C.value.filter(_=>_.type==="expense").reduce((_,m)=>_+fe(parseFloat(m.amount||0),m.currency,B.value),0)),we=K(()=>!Q.value||Object.keys(Q.value).length===0?0:C.value.filter(_=>_.type==="bonus").reduce((_,m)=>_+fe(parseFloat(m.amount||0),m.currency,B.value),0)),Be=K(()=>le(q.value,B.value)),Re=K(()=>le(ve.value,B.value)),Oe=K(()=>le(we.value,B.value)),Fe=K(()=>{if(!Q.value||Object.keys(Q.value).length===0)return le(0,B.value);const _=ve.value+we.value;return le(q.value-_,B.value)}),Ee=K(()=>q.value===0?"0.00%":`${(ve.value/q.value*100).toFixed(2)}%`),ze=K(()=>q.value===0?"0.00%":`${((ve.value+we.value)/q.value*100).toFixed(2)}%`),Le=K(()=>{if(q.value<=0)return le(0,B.value);const _=q.value*Ae;return le(_,B.value)}),qe=K(()=>{const _=C.value.filter(L=>(L.type==="expense"||L.type==="bonus")&&L.is_paid&&L.payment_date);if(_.length===0)return"N/A";const m=_.reduce((L,se)=>new Date(se.payment_date)>new Date(L.payment_date)?se:L);return new Date(m.payment_date).toLocaleDateString()}),Ke=K(()=>{const _=C.value.filter(L=>L.type==="income"&&L.payment_date);if(_.length===0)return"N/A";const m=_.reduce((L,se)=>new Date(se.payment_date)>new Date(L.payment_date)?se:L);return new Date(m.payment_date).toLocaleDateString()});return me(async()=>{const _=localStorage.getItem("displayCurrency");_&&(B.value=_),await Me(),E(),z()}),te([()=>y.projectId,B,Q],()=>{y.projectId&&Q.value&&Object.keys(Q.value).length>0&&(E(),z())},{deep:!0}),te(B,_=>{_&&localStorage.setItem("displayCurrency",_)},{deep:!0}),(_,m)=>{var L,se,de,ye,he,ke;return r(),d("div",qs,[l.value?(r(),d("div",Ks,$(l.value),1)):h("",!0),V(p)||V(k)?(r(),d("div",Hs,[t("div",Gs,[t("div",Ys,[m[10]||(m[10]=t("span",{class:"text-sm font-medium text-gray-700 mr-2"},"Currency:",-1)),o(ee,{id:"transactions-display-currency-switcher",modelValue:V(B),"onUpdate:modelValue":m[0]||(m[0]=S=>We(B)?B.value=S:null),options:ne,"value-key":"value","label-key":"label",class:"w-24"},null,8,["modelValue"])]),m[19]||(m[19]=t("h4",{class:"text-md font-medium text-gray-700 mb-2"},"Summary",-1)),t("div",Ws,[t("div",Js,[m[11]||(m[11]=t("p",{class:"text-sm text-gray-600"},"Total Income",-1)),t("p",Xs,$(Be.value),1)]),t("div",Qs,[m[12]||(m[12]=t("p",{class:"text-sm text-gray-600"},"Total Expenses",-1)),t("p",Zs,$(Re.value),1),t("p",el,"("+$(Ee.value)+" of Income)",1)]),t("div",tl,[m[13]||(m[13]=t("p",{class:"text-sm text-gray-600"},"Total Bonuses",-1)),t("p",al,$(Oe.value),1)]),t("div",sl,[m[14]||(m[14]=t("p",{class:"text-sm text-gray-600"},"Balance",-1)),t("p",ll,$(Fe.value),1)]),t("div",ol,[m[15]||(m[15]=t("p",{class:"text-sm text-gray-600"},"Expense + Bonus",-1)),t("p",nl,$(V(le)(ve.value+we.value,V(B))),1),t("p",rl,"("+$(ze.value)+" of Income)",1)]),t("div",il,[m[16]||(m[16]=t("p",{class:"text-sm font-medium text-orange-800"},"Estimated Income Tax (AUD)",-1)),t("p",dl,$(Le.value),1),t("p",cl," (Based on "+$((Ae*100).toFixed(1))+"% of Total Income. This is an estimation.) ",1)]),t("div",ul,[m[17]||(m[17]=t("p",{class:"text-sm font-medium text-gray-800"},"Last Payment Received Date",-1)),t("p",ml,$(Ke.value),1)]),t("div",vl,[m[18]||(m[18]=t("p",{class:"text-sm font-medium text-gray-800"},"Last Payment Sent Date",-1)),t("p",pl,$(qe.value),1)])])]),m[20]||(m[20]=t("h4",{class:"text-md font-medium text-gray-700 mb-4"},"Add Transaction",-1)),t("div",gl,[t("div",null,[o(D,{for:"description",value:"Description"}),o(G,{id:"description",modelValue:U.value.description,"onUpdate:modelValue":m[1]||(m[1]=S=>U.value.description=S),class:"mt-1 block w-full",disabled:s.value},null,8,["modelValue","disabled"]),o(T,{message:(L=v.value.description)==null?void 0:L[0],class:"mt-2"},null,8,["message"])]),t("div",null,[o(D,{for:"amount",value:"Amount"}),o(G,{id:"amount",type:"number",modelValue:U.value.amount,"onUpdate:modelValue":m[2]||(m[2]=S=>U.value.amount=S),class:"mt-1 block w-full",disabled:s.value},null,8,["modelValue","disabled"]),o(T,{message:(se=v.value.amount)==null?void 0:se[0],class:"mt-2"},null,8,["message"])]),t("div",null,[o(D,{for:"currency",value:"Currency"}),o(ee,{id:"currency",modelValue:U.value.currency,"onUpdate:modelValue":m[3]||(m[3]=S=>U.value.currency=S),options:ne,disabled:s.value},null,8,["modelValue","disabled"]),o(T,{message:(de=v.value.currency)==null?void 0:de[0],class:"mt-2"},null,8,["message"])]),t("div",null,[o(D,{for:"type",value:"Type"}),o(ee,{id:"type",modelValue:U.value.type,"onUpdate:modelValue":m[4]||(m[4]=S=>U.value.type=S),options:u,disabled:s.value||!V(p)&&U.value.type==="expense"&&U.value.type!=="bonus"||!V(k)&&U.value.type==="income"},null,8,["modelValue","disabled"]),o(T,{message:(ye=v.value.type)==null?void 0:ye[0],class:"mt-2"},null,8,["message"])]),U.value.type==="expense"||U.value.type==="bonus"?(r(),d("div",yl,[o(D,{for:"user_id",value:"User"}),o(ee,{id:"user_id",modelValue:U.value.user_id,"onUpdate:modelValue":m[5]||(m[5]=S=>U.value.user_id=S),options:g.value,disabled:s.value||!M.value.length,placeholder:"Select a user"},null,8,["modelValue","options","disabled"]),o(T,{message:(he=v.value.user_id)==null?void 0:he[0],class:"mt-2"},null,8,["message"])])):h("",!0),U.value.type==="expense"||U.value.type==="bonus"?(r(),d("div",fl,[o(D,{for:"hours_spent",value:"Hours Spent (Optional)"}),o(G,{id:"hours_spent",type:"number",modelValue:U.value.hours_spent,"onUpdate:modelValue":m[6]||(m[6]=S=>U.value.hours_spent=S),class:"mt-1 block w-full",disabled:s.value},null,8,["modelValue","disabled"]),o(T,{message:(ke=v.value.hours_spent)==null?void 0:ke[0],class:"mt-2"},null,8,["message"])])):h("",!0)]),t("div",bl,[o(ae,{onClick:x,disabled:s.value},{default:H(()=>[O($(s.value?"Saving...":"Save Transaction"),1)]),_:1},8,["disabled"])])])):h("",!0),V(N)?(r(),d("div",wl,[m[24]||(m[24]=t("h4",{class:"text-md font-medium text-gray-700 mb-4"},"Transaction History",-1)),s.value?(r(),d("div",hl,m[21]||(m[21]=[t("div",{class:"h-4 bg-gray-200 rounded animate-pulse w-full"},null,-1),t("div",{class:"h-4 bg-gray-200 rounded animate-pulse w-5/6"},null,-1),t("div",{class:"h-4 bg-gray-200 rounded animate-pulse w-3/4"},null,-1)]))):C.value.length===0?(r(),d("div",xl," No transactions found for this project. ")):(r(),d("div",jl,[(r(!0),d(ce,null,ue(C.value,(S,_e)=>{var Pe,$e,Se;return r(),d("div",{key:S.id,class:W([{"bg-green-50 border-green-200":S.type==="income","bg-red-50 border-red-200":S.type==="expense","bg-purple-50 border-purple-200":S.type==="bonus","border-l-4":!0},"p-4 rounded-md shadow-sm transition-all duration-200 ease-in-out hover:shadow-md"])},[t("div",kl,[t("div",_l,[t("p",Pl,$(S.description),1),t("p",$l,$(S.type==="income"?"Income":S.type==="expense"?"Expense":"Bonus")+" on "+$(new Date(S.created_at).toLocaleDateString()),1)]),t("div",Sl,[t("p",{class:W(["text-lg font-bold",{"text-green-700":S.type==="income","text-red-700":S.type==="expense","text-purple-700":S.type==="bonus"}])},$(V(le)(S.amount,S.currency)),3),S.currency.toUpperCase()!==V(B).toUpperCase()?(r(),d("p",Vl," ("+$(V(le)(V(fe)(S.amount,S.currency,V(B)),V(B)))+") ",1)):h("",!0),t("span",{class:W(["block text-xs mt-1",S.is_paid?"text-green-600":"text-red-600"])},$(S.is_paid?"Paid":"Unpaid"),3)])]),t("div",Cl,[t("div",null,[S.user_id?(r(),d("span",Dl,"User: "+$(((Pe=M.value.find(re=>re.id===S.user_id))==null?void 0:Pe.name)||"Unknown"),1)):h("",!0),S.hours_spent?(r(),d("span",Il,"Hours: "+$(S.hours_spent),1)):h("",!0),(S.type==="expense"||S.type==="bonus")&&q.value>0?(r(),d("span",Ul,$((V(fe)(S.amount,S.currency,V(B))/q.value*100).toFixed(2))+"% of Income ",1)):h("",!0)]),t("div",Ml,[!S.is_paid&&(V(p)||V(k))?(r(),Z(be,{key:0,onClick:re=>j(_e),class:W({"text-green-600":S.type!=="income","text-blue-600":S.type==="income"})},{default:H(()=>[O($(S.type==="income"?"Receive":"Pay"),1)]),_:2},1032,["onClick","class"])):h("",!0),V(p)||V(k)?(r(),Z(be,{key:1,onClick:re=>i(_e),class:"text-red-600"},{default:H(()=>m[22]||(m[22]=[O(" Delete ",-1)])),_:2,__:[22]},1032,["onClick"])):h("",!0)])]),n.value===S.id?(r(),d("div",Al,[t("h4",Nl,$(S.type==="income"?"Record Receipt":"Make Payment"),1),t("div",Tl,[o(D,{for:"payment_date",value:"Date"}),o(G,{id:"payment_date",type:"date",modelValue:X.value,"onUpdate:modelValue":m[7]||(m[7]=re=>X.value=re),class:"mt-1 block w-full",disabled:s.value},null,8,["modelValue","disabled"]),o(T,{message:($e=Y.value.date)==null?void 0:$e[0],class:"mt-2"},null,8,["message"])]),t("div",Bl,[t("label",Rl,[ge(t("input",{type:"checkbox","onUpdate:modelValue":m[8]||(m[8]=re=>I.value=re),class:"mr-2 rounded text-blue-600 focus:ring-blue-500",disabled:s.value},null,8,Ol),[[Je,I.value]]),t("span",Fl,$(S.type==="income"?"Receive in Full":"Pay in Full"),1)])]),I.value?h("",!0):(r(),d("div",El,[o(D,{for:"payment_amount",value:"Amount"}),o(G,{id:"payment_amount",type:"number",modelValue:w.value,"onUpdate:modelValue":m[9]||(m[9]=re=>w.value=re),class:"mt-1 block w-full",disabled:s.value,placeholder:"Enter partial "+(S.type==="income"?"receipt":"payment")+" amount (Max: "+V(le)(S.amount,S.currency)+")"},null,8,["modelValue","disabled","placeholder"]),o(T,{message:(Se=Y.value.amount)==null?void 0:Se[0],class:"mt-2"},null,8,["message"])])),t("div",zl,[o(be,{onClick:A,disabled:s.value},{default:H(()=>m[23]||(m[23]=[O(" Cancel ",-1)])),_:1,__:[23]},8,["disabled"]),o(ae,{onClick:R,disabled:s.value},{default:H(()=>[O($(s.value?"Processing...":S.type==="income"?"Record Receipt":"Submit Payment"),1)]),_:2},1032,["disabled"])])])):h("",!0)],2)}),128))]))])):h("",!0)])}}},ql={class:"p-6 w-full mx-auto bg-white rounded-xl shadow-2xl transition-all duration-300"},Kl={class:"border-b border-gray-200 mb-6"},Hl={class:"flex -mb-px space-x-4 overflow-x-auto pb-2"},Gl={class:"py-4"},no={__name:"ProjectForm",props:{projectId:{type:[Number,String],default:null},statusOptions:{type:Array,required:!0},departmentOptions:{type:Array,required:!0},sourceOptions:{type:Array,required:!0},clientRoleOptions:{type:Array,default:()=>[]},userRoleOptions:{type:Array,default:()=>[]},paymentTypeOptions:{type:Array,required:!0},errors:{type:Object,default:()=>({})},isSaving:{type:Boolean,default:!1}},emits:["close"],setup(e,{emit:y}){Xe();const a=e,b=P(a.projectId);te(()=>a.projectId,A=>{b.value=A,A&&Qe(A)},{immediate:!0}),Ze(b);const p=et(b),{canDo:k,canView:N,canManage:C}=Ne(b),M=k("manage_projects",p);k("create_clients",p);const v=k("upload_project_documents",p),l=C("project_services_and_payments",p),s=k("add_project_notes",p),n=C("project_users",p),w=C("project_clients",p),I=k("manage_project_basic_details",p),Y=N("project_documents",p),J=N("project_services_and_payments",p),X=N("project_notes",p),U=N("project_users",p),B=N("project_clients",p),ne=N("project_transactions",p),u=N("project_deliverables"),g=C("project_deliverables"),f=P("basic"),z=K(()=>B.value&&U.value?"Clients and Users":B.value?"Clients":U.value?"Users":"Clients and Users"),E=P([]),x=P([]),c=P([]),i=P([]),j=A=>{if(A!=="basic"&&!a.projectId){tt("Please create the project first before managing this section."),f.value="basic";return}f.value=A};return me(async()=>{try{E.value=await Ie("client"),x.value=await Ie("project"),c.value=await mt(!0,null),i.value=await vt(!0,null)}catch(A){console.error("Error fetching global data for ProjectForm:",A)}}),(A,R)=>(r(),d("div",ql,[R[7]||(R[7]=t("div",{class:"flex justify-between items-center pb-4 mb-6 border-b border-gray-200"},[t("h2",{class:"text-2xl font-semibold text-gray-800"},"Edit Project")],-1)),t("div",Kl,[t("nav",Hl,[t("button",{onClick:R[0]||(R[0]=q=>j("basic")),class:W(["py-3 px-5 text-center border-b-2 font-medium text-base rounded-t-lg transition-colors duration-200 whitespace-nowrap",f.value==="basic"?"border-indigo-600 text-indigo-700 bg-indigo-50":"border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300 hover:bg-gray-50"])}," Basic Information ",2),e.projectId&&(V(B)||V(U))?(r(),d("button",{key:0,onClick:R[1]||(R[1]=q=>j("client")),class:W(["py-3 px-5 text-center border-b-2 font-medium text-base rounded-t-lg transition-colors duration-200 whitespace-nowrap",f.value==="client"?"border-indigo-600 text-indigo-700 bg-indigo-50":"border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300 hover:bg-gray-50"])},$(z.value),3)):h("",!0),e.projectId&&(V(l)||V(J))?(r(),d("button",{key:1,onClick:R[2]||(R[2]=q=>j("services")),class:W(["py-3 px-5 text-center border-b-2 font-medium text-base rounded-t-lg transition-colors duration-200 whitespace-nowrap",f.value==="services"?"border-indigo-600 text-indigo-700 bg-indigo-50":"border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300 hover:bg-gray-50"])}," Services & Payment ",2)):h("",!0),e.projectId&&V(ne)?(r(),d("button",{key:2,onClick:R[3]||(R[3]=q=>j("transactions")),class:W(["py-3 px-5 text-center border-b-2 font-medium text-base rounded-t-lg transition-colors duration-200 whitespace-nowrap",f.value==="transactions"?"border-indigo-600 text-indigo-700 bg-indigo-50":"border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300 hover:bg-gray-50"])}," Transactions ",2)):h("",!0),e.projectId&&V(Y)?(r(),d("button",{key:3,onClick:R[4]||(R[4]=q=>j("documents")),class:W(["py-3 px-5 text-center border-b-2 font-medium text-base rounded-t-lg transition-colors duration-200 whitespace-nowrap",f.value==="documents"?"border-indigo-600 text-indigo-700 bg-indigo-50":"border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300 hover:bg-gray-50"])}," Documents ",2)):h("",!0),e.projectId&&(V(s)||V(X))?(r(),d("button",{key:4,onClick:R[5]||(R[5]=q=>j("notes")),class:W(["py-3 px-5 text-center border-b-2 font-medium text-base rounded-t-lg transition-colors duration-200 whitespace-nowrap",f.value==="notes"?"border-indigo-600 text-indigo-700 bg-indigo-50":"border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300 hover:bg-gray-50"])}," Notes ",2)):h("",!0),e.projectId&&(V(g)||V(u))?(r(),d("button",{key:5,onClick:R[6]||(R[6]=q=>j("deliverables")),class:W(["py-3 px-5 text-center border-b-2 font-medium text-base rounded-t-lg transition-colors duration-200 whitespace-nowrap",f.value==="deliverables"?"border-indigo-600 text-indigo-700 bg-indigo-50":"border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300 hover:bg-gray-50"])}," Deliverables ",2)):h("",!0)])]),t("div",Gl,[f.value==="basic"?(r(),Z(Ut,{key:0,projectId:e.projectId,errors:a.errors,statusOptions:e.statusOptions,sourceOptions:e.sourceOptions,canManageProjects:V(M),canManageProjectBasicDetails:V(I),isSaving:a.isSaving},null,8,["projectId","errors","statusOptions","sourceOptions","canManageProjects","canManageProjectBasicDetails","isSaving"])):h("",!0),f.value==="client"?(r(),Z(la,{key:1,projectId:e.projectId,errors:a.errors,clientRoleOptions:E.value,userRoleOptions:x.value,clients:c.value,users:i.value,canViewProjectClients:V(B),canManageProjectClients:V(w),canViewProjectUsers:V(U),canManageProjectUsers:V(n),isSaving:a.isSaving},null,8,["projectId","errors","clientRoleOptions","userRoleOptions","clients","users","canViewProjectClients","canManageProjectClients","canViewProjectUsers","canManageProjectUsers","isSaving"])):h("",!0),f.value==="services"?(r(),Z(zs,{key:2,projectId:e.projectId,departmentOptions:e.departmentOptions,paymentTypeOptions:e.paymentTypeOptions,canManageProjectServicesAndPayments:V(l),canViewProjectServicesAndPayments:V(J),isSaving:a.isSaving},null,8,["projectId","departmentOptions","paymentTypeOptions","canManageProjectServicesAndPayments","canViewProjectServicesAndPayments","isSaving"])):h("",!0),f.value==="transactions"&&V(ne)?(r(),Z(Ll,{key:3,projectId:e.projectId,userProjectRole:V(p),isSaving:a.isSaving},null,8,["projectId","userProjectRole","isSaving"])):h("",!0),f.value==="documents"?(r(),Z(ka,{key:4,projectId:e.projectId,errors:a.errors,canUploadProjectDocuments:V(v),canViewProjectDocuments:V(Y),isSaving:a.isSaving},null,8,["projectId","errors","canUploadProjectDocuments","canViewProjectDocuments","isSaving"])):h("",!0),f.value==="notes"?(r(),Z(Ra,{key:5,projectId:e.projectId,errors:a.errors,canAddProjectNotes:V(s),canViewProjectNotes:V(X),"is-saving":a.isSaving},null,8,["projectId","errors","canAddProjectNotes","canViewProjectNotes","is-saving"])):h("",!0),f.value==="deliverables"?(r(),Z(ss,{key:6,projectId:e.projectId,errors:a.errors,canManageProjectDeliverables:V(g),canViewProjectDeliverables:V(u),isSaving:a.isSaving},null,8,["projectId","errors","canManageProjectDeliverables","canViewProjectDeliverables","isSaving"])):h("",!0)])]))}};export{no as _,fe as a,Me as b,Q as c,Te as d,le as f};
