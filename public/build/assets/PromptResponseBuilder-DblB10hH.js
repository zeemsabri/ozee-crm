import{r as C,c as S,e as k,a as d,o as m,b as r,m as x,v as B,x as D,F as O,l as V,d as b,u as f,i as E}from"./app-DKXfdGr7.js";import{P as A}from"./plus-CEvNCTA-.js";import{T as w}from"./trash-Cdq3cJaS.js";import"./createLucideIcon-R4fVh7l-.js";const P={class:"space-y-3"},R={class:"border rounded-md bg-white",open:!1},$={class:"p-3 border-t"},I={class:"mt-2"},M={class:"flex items-center space-x-2"},U=["value","onInput"],q=["value","onChange"],L=["onClick"],z={key:0,class:"ml-4 mt-2 pt-2 border-l-2 pl-4 space-y-2"},G=["value","onInput"],H=["value","onChange"],K=["onClick"],Q=["onClick"],ee={__name:"PromptResponseBuilder",props:{responseVariables:{type:Array,default:()=>[]},responseJsonTemplate:{type:Object,default:()=>({})}},emits:["update:responseVariables","update:responseJsonTemplate"],setup(g,{emit:F}){const l=g,u=F,c=C(null),v=S({get:()=>{try{const o=l.responseJsonTemplate||{};return Object.keys(o).length?JSON.stringify(o,null,2):""}catch{return""}},set:o=>{try{const e=JSON.parse(o);e&&typeof e=="object"&&(c.value="json",u("update:responseJsonTemplate",e),u("update:responseVariables",N(e)))}catch{}}});function N(o){const e=s=>Object.keys(s||{}).map(n=>t(n,s[n])),t=(s,n)=>{const a=Date.now()+Math.random();if(Array.isArray(n)){if(n.length>0){const p=n[0];if(p&&typeof p=="object"&&!Array.isArray(p))return{id:a,name:s,type:"Array of Objects",schema:e(p)};{const i=typeof p,_=i==="number"?"Number":i==="boolean"?"True/False":"Text";return{id:a,name:s,type:"Array of Objects",schema:[{id:a+1,name:"text",type:_}]}}}return{id:a,name:s,type:"Array of Objects",schema:[]}}else{if(n!==null&&typeof n=="object")return{id:a,name:s,type:"Object",schema:e(n)};if(typeof n=="number")return{id:a,name:s,type:"Number"};if(typeof n=="boolean")return{id:a,name:s,type:"True/False"}}return{id:a,name:s,type:"Text"}};return e(o)}function h(o=[]){const e={};return(o||[]).forEach(t=>{if(!t||!t.name)return;const s=t.type||"Text";s==="Object"?e[t.name]=h(t.schema||[]):s==="Array of Objects"?e[t.name]=[h(t.schema||[])]:s==="Number"?e[t.name]=0:s==="True/False"?e[t.name]=!1:e[t.name]=""}),e}function J(o,e){try{return JSON.stringify(o)===JSON.stringify(e)}catch{return!1}}k(()=>l.responseVariables,o=>{if(c.value==="structure"){const e=h(o||[]);J(e,l.responseJsonTemplate||{})||u("update:responseJsonTemplate",e)}c.value=null},{deep:!0});function j(o=null){const e={id:Date.now(),name:"",type:"Text"};c.value="structure",o?(o.schema=Array.isArray(o.schema)?[...o.schema,e]:[e],u("update:responseVariables",[...l.responseVariables])):u("update:responseVariables",[...l.responseVariables||[],e])}function T(o,e=null){if(c.value="structure",e)e.schema=(e.schema||[]).filter(t=>t.id!==o),u("update:responseVariables",[...l.responseVariables]);else{const t=(l.responseVariables||[]).filter(s=>s.id!==o);u("update:responseVariables",t)}}function y(o,e,t,s=null){c.value="structure";const a=(s?s.schema||[]:l.responseVariables||[]).map(p=>{if(p.id!==o)return p;const i={...p,[e]:t};return e==="type"&&((t==="Array of Objects"||t==="Object")&&!i.schema&&(i.schema=[]),t!=="Array of Objects"&&t!=="Object"&&delete i.schema),i});s?(s.schema=a,u("update:responseVariables",[...l.responseVariables])):u("update:responseVariables",a)}return(o,e)=>(m(),d("div",P,[r("details",R,[e[2]||(e[2]=r("summary",{class:"px-3 py-2 cursor-pointer text-sm font-medium text-gray-700 flex items-center justify-between"},[x(" Expected Response JSON (optional) "),r("span",{class:"text-xs text-gray-500"},"Toggle")],-1)),r("div",$,[B(r("textarea",{rows:"10",class:"w-full p-2 border border-gray-300 rounded-md font-mono text-sm",placeholder:"Paste a sample JSON response here to auto-generate structure","onUpdate:modelValue":e[0]||(e[0]=t=>v.value=t)},null,512),[[D,v.value]])])]),r("div",I,[e[7]||(e[7]=r("h4",{class:"text-sm font-medium text-gray-700"},"Response Structure",-1)),(m(!0),d(O,null,V(g.responseVariables||[],t=>(m(),d("div",{key:t.id,class:"p-2 border rounded-md bg-gray-50/50 mt-2"},[r("div",M,[r("input",{type:"text",placeholder:"Field Name",value:t.name,onInput:s=>y(t.id,"name",s.target.value),class:"p-1.5 border border-gray-300 rounded-md w-full text-sm"},null,40,U),r("select",{value:t.type,onChange:s=>y(t.id,"type",s.target.value),class:"p-1.5 border border-gray-300 rounded-md bg-white text-sm"},e[3]||(e[3]=[r("option",null,"Text",-1),r("option",null,"Number",-1),r("option",null,"True/False",-1),r("option",null,"Object",-1),r("option",null,"Array of Objects",-1)]),40,q),r("button",{type:"button",onClick:s=>T(t.id),class:"text-gray-400 hover:text-red-500 p-1"},[b(f(w),{class:"h-4 w-4"})],8,L)]),t.type==="Array of Objects"||t.type==="Object"?(m(),d("div",z,[(m(!0),d(O,null,V(t.schema||[],s=>(m(),d("div",{key:s.id,class:"flex items-center space-x-2"},[r("input",{type:"text",placeholder:"Sub-field Name",value:s.name,onInput:n=>y(s.id,"name",n.target.value,t),class:"p-1.5 border border-gray-300 rounded-md w-full text-sm"},null,40,G),r("select",{value:s.type,onChange:n=>y(s.id,"type",n.target.value,t),class:"p-1.5 border border-gray-300 rounded-md bg-white text-sm"},e[4]||(e[4]=[r("option",null,"Text",-1),r("option",null,"Number",-1),r("option",null,"True/False",-1),r("option",null,"Object",-1),r("option",null,"Array of Objects",-1)]),40,H),r("button",{type:"button",onClick:n=>T(s.id,t),class:"text-gray-400 hover:text-red-500 p-1"},[b(f(w),{class:"h-4 w-4"})],8,K)]))),128)),r("button",{type:"button",onClick:s=>j(t),class:"text-xs flex items-center gap-1 px-2 py-1 rounded-md bg-gray-100 hover:bg-gray-200"},[b(f(A),{class:"h-3 w-3"}),e[5]||(e[5]=x(" Add Sub-field",-1))],8,Q)])):E("",!0)]))),128)),r("button",{type:"button",onClick:e[1]||(e[1]=t=>j()),class:"mt-2 text-xs flex items-center gap-1 px-2 py-1 rounded-md bg-gray-100 hover:bg-gray-200"},[b(f(A),{class:"h-3 w-3"}),e[6]||(e[6]=x(" Add Field",-1))])])]))}};export{ee as default};
