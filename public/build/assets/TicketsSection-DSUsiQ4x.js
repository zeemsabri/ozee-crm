import{r as i,E as I,s as h,B as O,i as l,o as n,b as t,e as y,m as z,G as g,t as a,f as E,k as F,F as U,j as $,p as q}from"./app-CDZTuHuD.js";import H from"./TicketNotesSidebar-Gc75EUYx.js";import G from"./CreateTaskModal-Bs_mmU0l.js";import{_ as P}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Q={class:"p-6 bg-white rounded-xl shadow-lg font-inter min-h-[calc(100vh-6rem)]"},Y={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6"},J={class:"bg-blue-500 text-white p-4 rounded-lg shadow-md flex items-center justify-between"},K={class:"text-3xl font-bold"},R={class:"bg-green-500 text-white p-4 rounded-lg shadow-md flex items-center justify-between"},W={class:"text-3xl font-bold"},X={class:"bg-yellow-500 text-white p-4 rounded-lg shadow-md flex items-center justify-between"},Z={class:"text-3xl font-bold"},tt={class:"bg-red-500 text-white p-4 rounded-lg shadow-md flex items-center justify-between"},et={class:"text-3xl font-bold"},st={class:"relative mb-6"},ot={key:0,class:"text-center text-gray-600 py-12"},at={key:1,class:"text-center text-red-600 py-12"},rt={key:2,class:"text-center text-gray-500 py-12"},lt={key:3,class:"text-center text-gray-500 py-12"},nt={class:"text-lg mb-2"},it={key:4,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"},dt={class:"text-lg font-semibold text-gray-900 mb-2"},ct={class:"text-sm text-gray-700 mb-3 line-clamp-2"},ut={class:"flex items-center justify-between text-sm text-gray-600 mb-4"},ht={class:"flex items-center"},pt={class:"mt-auto"},vt=["onClick"],ft={__name:"TicketsSection",props:{initialAuthToken:{type:String,required:!0},projectId:{type:[String,Number],required:!0}},emits:["add-activity"],setup(c,{emit:C}){const w=c,m=C,p=i(!0),r=i([]),u=i(null),d=i(""),x=i(null),v=i(!1),f=i(!1),{showModal:j}=I("modalService"),T=h(()=>r.value.length),M=h(()=>r.value.filter(s=>s.status.toLowerCase()==="completed").length),N=h(()=>r.value.filter(s=>["to do","in progress"].includes(s.status.toLowerCase())).length),A=h(()=>{const s=new Date;return r.value.filter(e=>e.due_date&&new Date(e.due_date)<s&&e.status.toLowerCase()!=="completed").length}),b=h(()=>{if(!d.value)return r.value;const s=d.value.toLowerCase();return r.value.filter(e=>e.name.toLowerCase().includes(s)||e.description&&e.description.toLowerCase().includes(s)||e.status.toLowerCase().includes(s))}),k=async()=>{p.value=!0,u.value=null;try{const s=await fetch(`/api/client-api/project/${w.projectId}/tasks`,{headers:{Authorization:`Bearer ${w.initialAuthToken}`,"Content-Type":"application/json",Accept:"application/json"}}),e=await s.json();if(!s.ok){const o=e.errors?Object.values(e.errors).flat().join(`
`):e.message||"Failed to fetch tasks.";throw new Error(o)}r.value=e}catch(s){console.error("Error fetching tasks:",s),u.value=s.message||"An unexpected error occurred while fetching tasks.",j("Error",u.value,"alert")}finally{p.value=!1}},S=s=>{x.value=s,v.value=!0},B=()=>{k(),m("add-activity","A new note was added to a task.")},L=()=>{f.value=!0},_=s=>{r.value.unshift(s),m("add-activity",`New task "${s.name}" created.`)},V=s=>s?new Date(s).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):"N/A",D=s=>{switch(s.toLowerCase()){case"completed":return"bg-green-100 text-green-800";case"to do":return"bg-yellow-100 text-yellow-800";case"in progress":return"bg-blue-100 text-blue-800";case"blocked":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}};return O(()=>{k()}),(s,e)=>(n(),l("div",Q,[t("div",{class:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6"},[e[4]||(e[4]=t("h2",{class:"text-2xl font-bold text-gray-900 mb-4 sm:mb-0"},"Your Tasks",-1)),t("button",{onClick:L,class:"bg-indigo-600 text-white py-2 px-5 rounded-lg font-semibold hover:bg-indigo-700 transition-all duration-200 ease-in-out transform hover:scale-105 shadow-md flex items-center"},e[3]||(e[3]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"lucide lucide-plus mr-2"},[t("path",{d:"M12 5v14"}),t("path",{d:"M5 12h14"})],-1),z(" Add New Task ",-1)]))]),t("div",Y,[t("div",J,[t("div",null,[t("div",K,a(T.value),1),e[5]||(e[5]=t("div",{class:"text-sm"},"Total Tasks",-1))]),e[6]||(e[6]=g('<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-list-todo" data-v-85c5cffb><rect x="3" y="5" width="6" height="6" rx="1" data-v-85c5cffb></rect><path d="m3 17h.01" data-v-85c5cffb></path><path d="M13 5h8" data-v-85c5cffb></path><path d="M13 9h8" data-v-85c5cffb></path><path d="M13 13h8" data-v-85c5cffb></path><path d="M13 17h8" data-v-85c5cffb></path><path d="m3 13h.01" data-v-85c5cffb></path></svg>',1))]),t("div",R,[t("div",null,[t("div",W,a(M.value),1),e[7]||(e[7]=t("div",{class:"text-sm"},"Completed",-1))]),e[8]||(e[8]=t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"lucide lucide-check-circle-2"},[t("circle",{cx:"12",cy:"12",r:"10"}),t("path",{d:"m9 12 2 2 4-4"})],-1))]),t("div",X,[t("div",null,[t("div",Z,a(N.value),1),e[9]||(e[9]=t("div",{class:"text-sm"},"Pending",-1))]),e[10]||(e[10]=t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"lucide lucide-hourglass"},[t("path",{d:"M6 2v6a6 6 0 0 0 6 6 6 6 0 0 0 6-6V2"}),t("path",{d:"M6 22v-6a6 6 0 0 1 6-6 6 6 0 0 1 6 6v6"})],-1))]),t("div",tt,[t("div",null,[t("div",et,a(A.value),1),e[11]||(e[11]=t("div",{class:"text-sm"},"Overdue",-1))]),e[12]||(e[12]=t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"lucide lucide-alert-triangle"},[t("path",{d:"M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"}),t("path",{d:"M12 9v4"}),t("path",{d:"M12 17h.01"})],-1))])]),t("div",st,[E(t("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=o=>d.value=o),placeholder:"Search tasks by title, description, or status...",class:"w-full p-3 pl-10 border border-gray-300 rounded-xl shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 transition duration-200","aria-label":"Search Tasks"},null,512),[[F,d.value]]),e[13]||(e[13]=t("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"lucide lucide-search text-gray-400 w-5 h-5"},[t("circle",{cx:"11",cy:"11",r:"8"}),t("path",{d:"m21 21-4.3-4.3"})])],-1))]),p.value?(n(),l("div",ot,e[14]||(e[14]=[t("svg",{class:"animate-spin h-8 w-8 text-indigo-500 mx-auto mb-3",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),t("p",null,"Loading tasks...",-1)]))):u.value?(n(),l("div",at,[e[15]||(e[15]=t("p",{class:"font-semibold mb-2"},"Error loading tasks:",-1)),t("p",null,a(u.value),1)])):r.value.length===0?(n(),l("div",rt,e[16]||(e[16]=[t("p",{class:"text-lg mb-2"},"No tasks found for this project.",-1),t("p",null,'Click "Add New Task" to get started!',-1)]))):b.value.length===0&&d.value?(n(),l("div",lt,[t("p",nt,'No tasks match your search "'+a(d.value)+'".',1),e[17]||(e[17]=t("p",null,"Try a different keyword or clear your search.",-1))])):(n(),l("div",it,[(n(!0),l(U,null,$(b.value,o=>(n(),l("div",{key:o.id,class:"bg-gray-50 rounded-lg shadow-sm p-5 border border-gray-200 flex flex-col justify-between"},[t("div",null,[t("h3",dt,a(o.name),1),t("p",ct,a(o.description||"No description provided."),1)]),t("div",ut,[t("div",ht,[e[18]||(e[18]=g('<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-calendar mr-1 text-gray-500" data-v-85c5cffb><rect width="18" height="18" x="3" y="4" rx="2" ry="2" data-v-85c5cffb></rect><path d="M16 2v4" data-v-85c5cffb></path><path d="M8 2v4" data-v-85c5cffb></path><path d="M3 10h18" data-v-85c5cffb></path></svg>',1)),t("span",null,"Due: "+a(V(o.due_date)),1)]),t("span",{class:q(["px-3 py-1 rounded-full text-xs font-bold capitalize",D(o.status)])},a(o.status.replace(/_/g," ")),3)]),t("div",pt,[t("button",{onClick:gt=>S(o),class:"w-full bg-blue-600 text-white py-2 px-4 rounded-lg font-semibold hover:bg-blue-700 transition-all duration-200 ease-in-out transform hover:scale-105 shadow-md flex items-center justify-center",title:"View Notes"},e[19]||(e[19]=[g('<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-notebook-text mr-2" data-v-85c5cffb><path d="M2 6h4" data-v-85c5cffb></path><path d="M2 10h4" data-v-85c5cffb></path><path d="M2 14h4" data-v-85c5cffb></path><path d="M2 18h4" data-v-85c5cffb></path><path d="M7 2h14a2 2 0 0 1 2 2v16a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2z" data-v-85c5cffb></path><path d="M10 8h6" data-v-85c5cffb></path><path d="M10 12h6" data-v-85c5cffb></path><path d="M10 16h6" data-v-85c5cffb></path></svg> View Notes ',2)]),8,vt)])]))),128))])),y(H,{isOpen:v.value,"onUpdate:isOpen":e[1]||(e[1]=o=>v.value=o),"note-for":"tasks","selected-item":x.value,initialAuthToken:c.initialAuthToken,projectId:c.projectId,onNoteAddedSuccess:B},null,8,["isOpen","selected-item","initialAuthToken","projectId"]),y(G,{isOpen:f.value,"onUpdate:isOpen":e[2]||(e[2]=o=>f.value=o),initialAuthToken:c.initialAuthToken,projectId:c.projectId,onTaskCreatedSuccess:_},null,8,["isOpen","initialAuthToken","projectId"])]))}},kt=P(ft,[["__scopeId","data-v-85c5cffb"]]);export{kt as default};
