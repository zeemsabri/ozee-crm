import{u as T}from"./workflowStore-C7kZgYSJ.js";import{c,r as I,a,i,o as r,b as t,t as o,F as L,l as j,j as F,m as l}from"./app-DKXfdGr7.js";const M={key:0,class:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center"},V={class:"bg-white rounded-lg shadow-xl w-full max-w-5xl max-h-[85vh] flex flex-col"},$={class:"flex items-center justify-between px-4 py-3 border-b"},B={key:0,class:"text-xs text-gray-500"},W={class:"p-4 overflow-auto flex-1"},z={key:0,class:"text-sm text-gray-500"},R={key:1},A={key:0,class:"text-sm text-gray-500"},H={key:1,class:"min-w-full divide-y divide-gray-200 text-sm"},J={class:"divide-y divide-gray-200"},U={class:"px-3 py-2 align-top"},q={class:"px-3 py-2 align-top"},G={class:"font-medium text-gray-900 flex items-center gap-2"},K={key:0,class:"text-[10px] uppercase tracking-wide px-1.5 py-0.5 rounded bg-gray-100 text-gray-700"},Q={class:"text-xs text-gray-500 flex gap-2 flex-wrap"},X={key:0},Y={key:1},Z={class:"px-3 py-2 align-top"},tt={class:"text-xs text-gray-500 mt-0.5 flex gap-3"},et={key:0},st={key:1},ot={key:2},at={class:"px-3 py-2 max-w-[320px] align-top"},rt=["title"],dt={class:"px-3 py-2 align-top"},it=["onClick"],nt={key:0,class:"bg-gray-50/50"},lt={colspan:"5",class:"px-3 py-3"},pt={class:"grid grid-cols-1 md:grid-cols-3 gap-3 mb-3 text-xs text-gray-600"},ut={class:"text-gray-800"},xt={class:"text-gray-800 uppercase"},ct={class:"text-gray-800"},_t={class:"text-gray-800"},yt={class:"text-gray-800"},gt={key:0},mt={class:"text-gray-800"},vt={key:0},ft={class:"text-gray-800"},bt={key:1},ht={class:"text-gray-800"},wt={key:2},kt={class:"text-gray-800"},St={class:"grid grid-cols-1 md:grid-cols-4 gap-3"},Ct={class:"bg-white border rounded p-2 max-h-48 overflow-auto text-xs whitespace-pre-wrap"},Nt={key:0,class:"mt-2"},Lt={class:"bg-white border rounded p-2 max-h-40 overflow-auto text-xs whitespace-pre-wrap"},Dt={class:"bg-white border rounded p-2 max-h-48 overflow-auto text-xs whitespace-pre-wrap"},Ot={class:"bg-white border rounded p-2 max-h-48 overflow-auto text-xs whitespace-pre-wrap"},Pt={class:"bg-white border rounded p-2 max-h-48 overflow-auto text-xs whitespace-pre-wrap"},Et={key:0,class:"mt-3 text-xs"},Tt={class:"bg-white border border-red-200 rounded p-2 max-h-48 overflow-auto text-xs whitespace-pre-wrap text-red-800"},It={class:"px-4 py-3 border-t flex items-center justify-between text-sm"},jt={key:0},Ft={class:"space-x-2"},Mt=["disabled"],Vt=["disabled"],Rt={__name:"WorkflowLogsModal",setup($t){const x=T(),p=c(()=>x.logsModal),D=()=>x.hideLogs(),n=c(()=>p.value.meta||null),y=c(()=>n.value&&n.value.current_page>1),g=c(()=>n.value&&n.value.current_page<n.value.last_page),O=()=>{y.value&&x.goToLogsPage(n.value.current_page-1)},P=()=>{g.value&&x.goToLogsPage(n.value.current_page+1)},m=d=>{try{return d?new Date(d).toLocaleString():""}catch{return d||""}},_=I(new Set),E=d=>{const s=new Set(_.value);s.has(d)?s.delete(d):s.add(d),_.value=s},v=d=>_.value.has(d),u=d=>{try{return d==null||d===""?"":typeof d=="string"?d:JSON.stringify(d,null,2)}catch{return String(d)}};return(d,s)=>p.value.show?(r(),a("div",M,[t("div",V,[t("div",$,[t("div",null,[s[0]||(s[0]=t("h3",{class:"text-lg font-semibold text-gray-800"},"Execution Logs",-1)),p.value.workflow?(r(),a("p",B,"Workflow: "+o(p.value.workflow.name),1)):i("",!0)]),t("button",{onClick:D,class:"text-gray-500 hover:text-gray-700"},"âœ•")]),t("div",W,[p.value.isLoading?(r(),a("div",z,"Loading logs...")):(r(),a("div",R,[p.value.items.length?(r(),a("table",H,[s[19]||(s[19]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-3 py-2 text-left font-medium text-gray-700 w-24"},"Time"),t("th",{class:"px-3 py-2 text-left font-medium text-gray-700"},"Step"),t("th",{class:"px-3 py-2 text-left font-medium text-gray-700"},"Status"),t("th",{class:"px-3 py-2 text-left font-medium text-gray-700"},"Error"),t("th",{class:"px-3 py-2 text-left font-medium text-gray-700 w-20"},"Details")])],-1)),t("tbody",J,[(r(!0),a(L,null,j(p.value.items,e=>{var f,b,h,w,k,S,C,N;return r(),a(L,{key:e.id},[t("tr",null,[t("td",U,o(m(e.executed_at)),1),t("td",q,[t("div",G,[t("span",null,o(((f=e.step)==null?void 0:f.name)||`Step #${e.step_id}`),1),(b=e.step)!=null&&b.step_type?(r(),a("span",K,o(e.step.step_type),1)):i("",!0)]),t("div",Q,[t("span",null,"ID: "+o(e.id),1),e.step_id?(r(),a("span",X,"Step ID: "+o(e.step_id),1)):i("",!0),e.triggering_object_id?(r(),a("span",Y,"Object: "+o(e.triggering_object_id),1)):i("",!0)])]),t("td",Z,[t("span",{class:F(["px-2 py-0.5 rounded-full text-xs",e.status==="success"?"bg-green-100 text-green-800":e.status==="failed"?"bg-red-100 text-red-800":e.status==="scheduled"?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"])},o(e.status),3),t("div",tt,[e.duration_ms?(r(),a("span",et,o(e.duration_ms)+" ms",1)):i("",!0),e.token_usage?(r(),a("span",st,"tokens: "+o(e.token_usage),1)):i("",!0),e.cost?(r(),a("span",ot,"cost: $"+o(Number(e.cost).toFixed(4)),1)):i("",!0)])]),t("td",at,[t("div",{class:"truncate text-red-700",title:e.error_message||""},o(e.error_message),9,rt)]),t("td",dt,[t("button",{onClick:Bt=>E(e.id),class:"px-2 py-1 rounded border hover:bg-gray-50"},o(v(e.id)?"Hide":"View"),9,it)])]),v(e.id)?(r(),a("tr",nt,[t("td",lt,[t("div",pt,[t("div",null,[s[4]||(s[4]=t("div",{class:"font-semibold text-gray-700 mb-1"},"Step Info",-1)),t("div",null,[s[1]||(s[1]=l("Name: ",-1)),t("span",ut,o(((h=e.step)==null?void 0:h.name)||"-"),1)]),t("div",null,[s[2]||(s[2]=l("Type: ",-1)),t("span",xt,o(((w=e.step)==null?void 0:w.step_type)||"-"),1)]),t("div",null,[s[3]||(s[3]=l("Order: ",-1)),t("span",ct,o(((k=e.step)==null?void 0:k.step_order)??"-"),1)])]),t("div",null,[s[8]||(s[8]=t("div",{class:"font-semibold text-gray-700 mb-1"},"Execution",-1)),t("div",null,[s[5]||(s[5]=l("Status: ",-1)),t("span",_t,o(e.status),1)]),t("div",null,[s[6]||(s[6]=l("Executed At: ",-1)),t("span",yt,o(m(e.executed_at)),1)]),e.duration_ms?(r(),a("div",gt,[s[7]||(s[7]=l("Duration: ",-1)),t("span",mt,o(e.duration_ms)+" ms",1)])):i("",!0)]),t("div",null,[s[12]||(s[12]=t("div",{class:"font-semibold text-gray-700 mb-1"},"Metrics",-1)),e.token_usage?(r(),a("div",vt,[s[9]||(s[9]=l("Token Usage: ",-1)),t("span",ft,o(e.token_usage),1)])):i("",!0),e.cost?(r(),a("div",bt,[s[10]||(s[10]=l("Cost: ",-1)),t("span",ht,"$"+o(Number(e.cost).toFixed(6)),1)])):i("",!0),e.triggering_object_id?(r(),a("div",wt,[s[11]||(s[11]=l("Object ID: ",-1)),t("span",kt,o(e.triggering_object_id),1)])):i("",!0)])]),t("div",St,[t("div",null,[s[14]||(s[14]=t("div",{class:"text-xs font-semibold text-gray-700 mb-1"},"Step Config",-1)),t("pre",Ct,o(u((S=e.step)==null?void 0:S.step_config)||"-"),1),(C=e.step)!=null&&C.condition_rules?(r(),a("div",Nt,[s[13]||(s[13]=t("div",{class:"text-[11px] font-semibold text-gray-600 mb-0.5"},"Condition Rules",-1)),t("pre",Lt,o(u((N=e.step)==null?void 0:N.condition_rules)),1)])):i("",!0)]),t("div",null,[s[15]||(s[15]=t("div",{class:"text-xs font-semibold text-gray-700 mb-1"},"Input Context",-1)),t("pre",Dt,o(u(e.input_context)),1)]),t("div",null,[s[16]||(s[16]=t("div",{class:"text-xs font-semibold text-gray-700 mb-1"},"Raw Output",-1)),t("pre",Ot,o(u(e.raw_output)),1)]),t("div",null,[s[17]||(s[17]=t("div",{class:"text-xs font-semibold text-gray-700 mb-1"},"Parsed Output",-1)),t("pre",Pt,o(u(e.parsed_output)),1)])]),e.error_message?(r(),a("div",Et,[s[18]||(s[18]=t("div",{class:"font-semibold text-red-700 mb-1"},"Error Message",-1)),t("pre",Tt,o(e.error_message),1)])):i("",!0)])])):i("",!0)],64)}),128))])])):(r(),a("div",A,"No logs found."))]))]),t("div",It,[t("div",null,[n.value?(r(),a("span",jt,"Page "+o(n.value.current_page)+" of "+o(n.value.last_page),1)):i("",!0)]),t("div",Ft,[t("button",{onClick:O,disabled:!y.value,class:"px-3 py-1 rounded border disabled:opacity-50"},"Prev",8,Mt),t("button",{onClick:P,disabled:!g.value,class:"px-3 py-1 rounded border disabled:opacity-50"},"Next",8,Vt)])])])])):i("",!0)}};export{Rt as default};
