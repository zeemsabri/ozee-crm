import{_ as Y}from"./AuthenticatedLayout-K_03siSH.js";import{c as C,a as n,o as d,b as t,d as y,w as N,r as f,e as W,n as Z,f as G,g as H,u as Q,h as X,i as _,t as l,j as B,k as $,F as w,l as k,m as U,p as tt}from"./app-Dkfi9AsS.js";import{_ as et}from"./PrimaryButton-B1kazBK1.js";import{_ as E}from"./InputLabel-DzkFfZBn.js";import{S as O}from"./SelectDropdown-BsOhiUSf.js";import{C as P,r as ot}from"./chart-DUfl3Dpl.js";import"./Modal-DpYS89YI.js";import"./InputError-JRdV-61-.js";import"./SecondaryButton-BaxhzgV_.js";import"./index-DoH4RQvg.js";import"./BaseFormModal-RK1bZwo2.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./TextInput-DsZsVt0G.js";import"./debounce-C-hnF4Z3.js";import"./ApplicationLogo-BbEDJSL2.js";import"./createLucideIcon-D3_s4t3r.js";import"./plus-J6ZNHlGD.js";import"./DangerButton-G7cd6ssg.js";import"./moment-BLMuvzoS.js";import"./NoticeboardModal-KBWhzfTn.js";/* empty css                                                                       */const st={class:"flex flex-col md:flex-row items-end justify-between gap-4 p-4 mb-8 bg-gray-100 rounded-lg"},at={class:"flex-1 grid grid-cols-1 md:grid-cols-2 gap-4"},rt={class:"flex-shrink-0 w-full md:w-auto"},lt={key:0},dt={key:1},nt={__name:"FiltersForm",props:{year:{type:Number,required:!0},month:{type:Number,required:!0},yearOptions:{type:Array,required:!0},monthOptions:{type:Array,required:!0},loading:{type:Boolean,default:!1}},emits:["update:year","update:month","calculate"],setup(g,{emit:j}){const D=g,v=j,h=C({get:()=>D.year,set:p=>v("update:year",p)}),x=C({get:()=>D.month,set:p=>v("update:month",p)});return(p,s)=>(d(),n("div",st,[t("div",at,[t("div",null,[y(E,{value:"Year"}),y(O,{modelValue:h.value,"onUpdate:modelValue":s[0]||(s[0]=i=>h.value=i),options:g.yearOptions,class:"mt-1 w-full"},null,8,["modelValue","options"])]),t("div",null,[y(E,{value:"Month"}),y(O,{modelValue:x.value,"onUpdate:modelValue":s[1]||(s[1]=i=>x.value=i),options:g.monthOptions,class:"mt-1 w-full"},null,8,["modelValue","options"])])]),t("div",rt,[y(et,{onClick:s[2]||(s[2]=i=>p.$emit("calculate")),disabled:g.loading,class:"w-full mt-4 md:mt-0"},{default:N(()=>[g.loading?(d(),n("span",lt,"Calculating...")):(d(),n("span",dt,"Calculate"))]),_:1},8,["disabled"])])]))}},it={class:"py-6 bg-gray-100 text-gray-900 min-h-screen"},ut={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},ct={class:"bg-white overflow-hidden shadow-xl sm:rounded-lg"},mt={class:"p-6"},pt={key:0,class:"text-center p-8"},bt={key:1,class:"text-center p-8 text-red-500"},xt={key:2},_t={class:"flex border-b border-gray-200 mb-8"},yt={key:0},gt={class:"flex flex-col md:flex-row justify-between items-start md:items-center mb-12"},vt={class:"mb-4 md:mb-0"},ht={class:"text-lg text-gray-500 mt-2"},ft={class:"bg-gray-100 p-4 md:p-6 rounded-2xl shadow-md border border-gray-200"},wt={class:"text-4xl font-bold text-green-600 mt-2"},kt={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-12"},Ct={class:"bg-white p-6 rounded-2xl shadow-md border border-gray-200 hover:shadow-lg transition-all duration-200"},jt={class:"text-3xl font-bold text-purple-600 mt-1"},Bt={class:"w-full h-2 bg-gray-200 rounded-full mt-4 overflow-hidden"},Pt={class:"text-sm text-gray-500 mt-2"},Dt={class:"bg-white p-6 rounded-2xl shadow-md border border-gray-200 hover:shadow-lg transition-all duration-200"},Ft={class:"text-3xl font-bold text-amber-600 mt-1"},$t={class:"text-sm text-gray-500 mt-1"},At={class:"w-full h-2 bg-gray-200 rounded-full mt-4 overflow-hidden"},Rt={class:"bg-white p-6 rounded-2xl shadow-md border border-gray-200 hover:shadow-lg transition-all duration-200"},Kt={class:"text-3xl font-bold text-orange-600 mt-1"},Ut={class:"text-sm text-gray-500 mt-1"},Et={class:"w-full h-2 bg-gray-200 rounded-full mt-4 overflow-hidden"},Ot={key:1},Nt={class:"bg-white rounded-2xl shadow-md border border-gray-200 overflow-x-auto"},Vt={class:"min-w-full divide-y divide-gray-200"},Mt={class:"bg-white divide-y divide-gray-200"},St={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},Tt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},It={class:"px-6 py-4 whitespace-nowrap text-sm text-green-600 font-bold"},qt={class:"flex items-center"},zt={key:0,class:"mr-1"},Lt={key:1,class:"mr-1"},Jt={key:2},Yt={class:"space-y-6"},Wt={class:"flex flex-col md:flex-row justify-between items-start md:items-center mb-4"},Zt={class:"text-2xl font-semibold text-blue-600"},Gt={class:"text-md text-gray-500 mt-2 md:mt-0"},Ht={class:"text-md text-gray-600"},Qt={class:"font-bold text-purple-600"},Xt={class:"mt-6 space-y-4"},te={class:"flex justify-between items-center"},ee={class:"text-lg font-medium text-gray-800"},oe={class:"text-lg font-semibold text-green-600"},se={class:"text-sm text-gray-500 mt-1"},ae={key:0,class:"mt-2 text-sm text-gray-500 list-disc list-inside"},re={key:3},le={class:"space-y-6"},de={class:"flex flex-col md:flex-row justify-between items-start md:items-center mb-4"},ne={class:"text-2xl font-semibold text-blue-600"},ie={class:"text-md text-gray-600 mt-2 md:mt-0"},ue={class:"font-bold text-green-600"},ce={class:"mt-4 space-y-2"},me={class:"text-md text-gray-700"},pe={class:"text-md font-semibold text-green-600"},Ee={__name:"Index",setup(g){P.register(...ot);const j=new Date().getFullYear(),D=new Date().getMonth()+1,v=f(j),h=f(D),x=f(!1),p=f(""),s=f(null),i=f("dashboard"),V=[{value:1,label:"January"},{value:2,label:"February"},{value:3,label:"March"},{value:4,label:"April"},{value:5,label:"May"},{value:6,label:"June"},{value:7,label:"July"},{value:8,label:"August"},{value:9,label:"September"},{value:10,label:"October"},{value:11,label:"November"},{value:12,label:"December"}],M=C(()=>{const r=j-3,o=j+3,e=[];for(let a=o;a>=r;a--)e.push({value:a,label:String(a)});return e}),m=(r,o=2)=>{if(r==null)return"-";const e=Number(r),a={style:"currency",currency:"PKR",maximumFractionDigits:o,minimumFractionDigits:o};try{return new Intl.NumberFormat("en-PK",a).format(e)}catch{return`PKR ${e.toFixed(o)}`}},A=async()=>{var r,o;x.value=!0,p.value="",s.value=null;try{const{data:e}=await tt.get("/admin/bonus-calculator/calculate",{params:{year:v.value,month:h.value}});e&&e.error?p.value=e.error:s.value=e}catch(e){p.value=((o=(r=e==null?void 0:e.response)==null?void 0:r.data)==null?void 0:o.message)||"Failed to calculate bonuses."}finally{x.value=!1}},R=C(()=>{var r;return(r=s.value)!=null&&r.summary?s.value.summary.total_distributed_pkr/s.value.summary.total_budget_pkr*100:0}),S=C(()=>{var r;return(r=s.value)!=null&&r.users?[...s.value.users].sort((o,e)=>e.total_bonus_pkr-o.total_bonus_pkr):[]}),K=r=>{var e;if(!((e=s.value)!=null&&e.users))return"Unknown User";const o=s.value.users.find(a=>a.user_id===r);return o?o.name:"Unknown User"},T=C(()=>{var o;if(!((o=s.value)!=null&&o.awards_details))return[];const r={};return s.value.awards_details.forEach(e=>{e.award_id==="project_performance_bonus"&&e.recipients.forEach(a=>{a.awards&&a.awards.forEach(c=>{const u=c.project_details.project_name;r[u]||(r[u]={distributed_pkr:0,recipients:[]}),r[u].distributed_pkr+=c.amount_pkr,r[u].recipients.push({name:K(a.user_id),amount_pkr:c.amount_pkr})})})}),Object.entries(r).map(([e,a])=>({name:e,distributed_pkr:a.distributed_pkr,recipients:a.recipients})).sort((e,a)=>a.distributed_pkr-e.distributed_pkr)}),I=()=>{if(!s.value||i.value!=="dashboard")return;const r=document.getElementById("poolAllocationChart"),o=document.getElementById("poolDistributionChart");if(r){const e=P.getChart(r);e&&e.destroy()}if(o){const e=P.getChart(o);e&&e.destroy()}if(r){const e=r.getContext("2d"),a=Object.keys(s.value.summary.pools).map(u=>s.value.summary.pools[u].allocated_pkr),c=Object.keys(s.value.summary.pools).map(u=>u.replace(/_/g," ").replace(/\b\w/g,b=>b.toUpperCase()));new P(e,{type:"doughnut",data:{labels:c,datasets:[{data:a,backgroundColor:["#6366F1","#F97316","#A855F7"],hoverBackgroundColor:["#818cf8","#fdba74","#c084fc"]}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom",labels:{color:"#6B7280",font:{size:14}}},tooltip:{callbacks:{label:u=>{const b=u.label||"",F=u.parsed,q=u.dataset.data.reduce((L,J)=>L+J,0),z=(F/q*100).toFixed(2);return`${b}: ${m(F)} (${z}%)`}}}}}})}if(o){const e=o.getContext("2d"),a=Object.keys(s.value.summary.pools).map(b=>b.replace(/_/g," ").replace(/\b\w/g,F=>F.toUpperCase())),c=Object.values(s.value.summary.pools).map(b=>b.distributed_pkr),u=Object.values(s.value.summary.pools).map(b=>b.allocated_pkr);new P(e,{type:"bar",data:{labels:a,datasets:[{label:"Distributed",data:c,backgroundColor:"#A855F7",borderColor:"#8B5CF6",borderWidth:1,borderRadius:8},{label:"Allocated",data:u,backgroundColor:"#F97316",borderColor:"#F97316",borderWidth:1,borderRadius:8}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{x:{stacked:!1,grid:{color:"#E5E7EB"},ticks:{color:"#6B7280"}},y:{stacked:!1,beginAtZero:!0,grid:{color:"#E5E7EB"},ticks:{color:"#6B7280",callback:b=>m(b)}}},plugins:{legend:{labels:{color:"#6B7280",font:{size:14}}}}}})}};return W([s,i],async([r,o])=>{r&&o==="dashboard"&&(await Z(),I())}),G(()=>{A()}),(r,o)=>(d(),H(Y,null,{default:N(()=>[y(Q(X),{title:"Bonus Calculator"}),t("div",it,[t("div",ut,[t("div",ct,[t("div",mt,[y(nt,{year:v.value,"onUpdate:year":o[0]||(o[0]=e=>v.value=e),month:h.value,"onUpdate:month":o[1]||(o[1]=e=>h.value=e),"year-options":M.value,"month-options":V,loading:x.value,onCalculate:A},null,8,["year","month","year-options","loading"]),x.value?(d(),n("div",pt,o[6]||(o[6]=[t("span",{class:"text-lg text-gray-500"},"Loading dashboard data...",-1)]))):p.value?(d(),n("div",bt,[t("p",null,"Error: "+l(p.value),1)])):s.value?(d(),n("div",xt,[t("div",_t,[t("button",{onClick:o[2]||(o[2]=e=>i.value="dashboard"),class:B([{"border-blue-500 text-blue-600":i.value==="dashboard","border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300":i.value!=="dashboard"},"py-4 px-6 font-semibold text-sm border-b-2 transition-colors duration-200"])}," Summary Dashboard ",2),t("button",{onClick:o[3]||(o[3]=e=>i.value="users"),class:B([{"border-blue-500 text-blue-600":i.value==="users","border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300":i.value!=="users"},"py-4 px-6 font-semibold text-sm border-b-2 transition-colors duration-200"])}," All Users ",2),t("button",{onClick:o[4]||(o[4]=e=>i.value="awards"),class:B([{"border-blue-500 text-blue-600":i.value==="awards","border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300":i.value!=="awards"},"py-4 px-6 font-semibold text-sm border-b-2 transition-colors duration-200"])}," Awards Breakdown ",2),t("button",{onClick:o[5]||(o[5]=e=>i.value="projects"),class:B([{"border-blue-500 text-blue-600":i.value==="projects","border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300":i.value!=="projects"},"py-4 px-6 font-semibold text-sm border-b-2 transition-colors duration-200"])}," Projects ",2)]),i.value==="dashboard"?(d(),n("div",yt,[t("header",gt,[t("div",vt,[o[7]||(o[7]=t("h1",{class:"text-4xl md:text-5xl font-extrabold text-gray-800"},"Bonus Distribution Dashboard",-1)),t("p",ht,"Insights for "+l(s.value.period),1)]),t("div",ft,[o[8]||(o[8]=t("h2",{class:"text-xl font-semibold text-gray-700"},"Total Budget",-1)),t("p",wt,l(m(s.value.summary.total_budget_pkr))+" PKR",1)])]),t("section",kt,[t("div",Ct,[o[9]||(o[9]=t("h3",{class:"text-lg font-semibold text-gray-700"},"Total Distributed",-1)),t("p",jt,l(m(s.value.summary.total_distributed_pkr))+" PKR",1),t("div",Bt,[t("div",{class:"h-full bg-purple-500 rounded-full transition-all duration-500",style:$({width:`${R.value}%`})},null,4)]),t("p",Pt,l(R.value.toFixed(2))+"% of budget distributed",1)]),t("div",Dt,[o[10]||(o[10]=t("h3",{class:"text-lg font-semibold text-gray-700"},"Employee Pool",-1)),t("p",Ft,l(m(s.value.summary.pools.employee.distributed_pkr))+" PKR",1),t("p",$t,"Distributed from "+l(m(s.value.summary.pools.employee.allocated_pkr))+" PKR allocated",1),t("div",At,[t("div",{class:"h-full bg-yellow-500 rounded-full transition-all duration-500",style:$({width:`${(s.value.summary.pools.employee.distributed_pkr/s.value.summary.pools.employee.allocated_pkr*100).toFixed(2)}%`})},null,4)])]),t("div",Rt,[o[11]||(o[11]=t("h3",{class:"text-lg font-semibold text-gray-700"},"Contractor Pool",-1)),t("p",Kt,l(m(s.value.summary.pools.contractor.distributed_pkr))+" PKR",1),t("p",Ut,"Distributed from "+l(m(s.value.summary.pools.contractor.allocated_pkr))+" PKR allocated",1),t("div",Et,[t("div",{class:"h-full bg-orange-500 rounded-full transition-all duration-500",style:$({width:`${(s.value.summary.pools.contractor.distributed_pkr/s.value.summary.pools.contractor.allocated_pkr*100).toFixed(2)}%`})},null,4)])])]),o[12]||(o[12]=t("section",{class:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-12"},[t("div",{class:"bg-white p-6 rounded-2xl shadow-md border border-gray-200"},[t("h3",{class:"text-2xl font-bold mb-4 text-gray-800"},"Bonus Pool Allocation"),t("div",{class:"h-80"},[t("canvas",{id:"poolAllocationChart"})])]),t("div",{class:"bg-white p-6 rounded-2xl shadow-md border border-gray-200"},[t("h3",{class:"text-2xl font-bold mb-4 text-gray-800"},"Distribution vs. Allocation"),t("div",{class:"h-80"},[t("canvas",{id:"poolDistributionChart"})])])],-1))])):_("",!0),i.value==="users"?(d(),n("div",Ot,[o[14]||(o[14]=t("h1",{class:"text-4xl md:text-5xl font-extrabold text-gray-800 mb-8"},"All Users Performance",-1)),t("div",Nt,[t("table",Vt,[o[13]||(o[13]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Name"),t("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Type"),t("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Total Bonus"),t("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Point Change (MoM)")])],-1)),t("tbody",Mt,[(d(!0),n(w,null,k(S.value,e=>(d(),n("tr",{key:e.user_id},[t("td",St,l(e.name),1),t("td",Tt,l(e.user_type.charAt(0).toUpperCase()+e.user_type.slice(1)),1),t("td",It,l(m(e.total_bonus_pkr))+" PKR",1),t("td",{class:B(["px-6 py-4 whitespace-nowrap text-sm",{"text-green-600":e.point_increase_from_last_month>0,"text-red-600":e.point_increase_from_last_month<0,"text-gray-500":e.point_increase_from_last_month===0}])},[t("span",qt,[e.point_increase_from_last_month>0?(d(),n("span",zt,"▲")):e.point_increase_from_last_month<0?(d(),n("span",Lt,"▼")):_("",!0),t("span",null,l(e.point_increase_from_last_month>0?"+":"")+l(e.point_increase_from_last_month)+" points",1)])],2)]))),128))])])])])):_("",!0),i.value==="awards"?(d(),n("div",Jt,[o[16]||(o[16]=t("h1",{class:"text-4xl md:text-5xl font-extrabold text-gray-800 mb-8"},"Awards Breakdown",-1)),t("div",Yt,[(d(!0),n(w,null,k(s.value.awards_details,e=>(d(),n("div",{key:e.award_id,class:"p-6 bg-white rounded-2xl shadow-md border border-gray-200"},[t("div",Wt,[t("h4",Zt,l(e.award_name),1),t("span",Gt,l(e.user_type),1)]),t("p",Ht,[o[15]||(o[15]=U("Distributed: ",-1)),t("span",Qt,l(m(e.distributed_pkr))+" PKR",1)]),t("div",Xt,[(d(!0),n(w,null,k(e.recipients,a=>(d(),n("div",{key:a.user_id,class:"p-4 bg-gray-100 rounded-lg border border-gray-200"},[t("div",te,[t("p",ee,l(K(a.user_id)),1),t("p",oe,l(m(a.awards?a.awards.reduce((c,u)=>c+u.amount_pkr,0):a.amount_pkr))+" PKR ",1)]),t("p",se,l(a.award_title),1),a.awards&&a.awards.length?(d(),n("ul",ae,[(d(!0),n(w,null,k(a.awards,c=>(d(),n("li",{key:c.project_details.project_name},l(c.award_title)+" for '"+l(c.project_details.project_name)+"' - "+l(m(c.amount_pkr))+" PKR ",1))),128))])):_("",!0)]))),128))])]))),128))])])):_("",!0),i.value==="projects"?(d(),n("div",re,[o[18]||(o[18]=t("h1",{class:"text-4xl md:text-5xl font-extrabold text-gray-800 mb-8"},"Project Performance Breakdown",-1)),t("div",le,[(d(!0),n(w,null,k(T.value,e=>(d(),n("div",{key:e.name,class:"p-6 bg-white rounded-2xl shadow-md border border-gray-200"},[t("div",de,[t("h4",ne,l(e.name),1),t("p",ie,[o[17]||(o[17]=U("Total Bonus: ",-1)),t("span",ue,l(m(e.distributed_pkr))+" PKR",1)])]),t("div",ce,[(d(!0),n(w,null,k(e.recipients,a=>(d(),n("div",{key:a.name,class:"flex justify-between items-center p-3 bg-gray-100 rounded-md"},[t("p",me,l(a.name),1),t("p",pe,l(m(a.amount_pkr))+" PKR",1)]))),128))])]))),128))])])):_("",!0)])):_("",!0)])])])])]),_:1}))}};export{Ee as default};
