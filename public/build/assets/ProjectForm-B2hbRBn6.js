import{r as b,p as ee,w as Q,A as Le,h as i,o as r,e as d,b as o,g as u,t as _,F as O,i as T,m as be,B as ot,L as lt,M as rt,D as nt,N as Be,s as it,u as n,k as L,n as le,f as J,j as Se,v as re,c as Me,a as X,d as dt}from"./app-nF069t71.js";import{P as ne}from"./PrimaryButton-C2nFB7gO.js";import{a as qe}from"./SecondaryButton-D0waIAPf.js";import{_ as k,a as A}from"./TextInput-DG-3FSef.js";import{_ as I}from"./InputError-B1edzhK4.js";import{_ as ut}from"./Checkbox-BLvqBK1z.js";const ct={class:"mt-2"},mt={class:"mb-2"},vt={key:0,class:"text-gray-500 text-sm mb-2"},pt=["disabled"],ft={value:""},_t=["value"],yt={class:"flex-grow"},gt=["value","onChange","disabled"],bt=["value"],ht=["onClick"],ze={__name:"MultiSelectWithRoles",props:{label:{type:String,required:!0},items:{type:Array,default:()=>[]},endpoint:{type:String,default:""},selectedItems:{type:Array,default:()=>[]},itemText:{type:String,default:"name"},itemSubtext:{type:String,default:"email"},itemValue:{type:String,default:"id"},roleOptions:{type:Array,default:()=>[]},roleType:{type:String,default:"application"},defaultRoleId:{type:Number,default:null},error:{type:String,default:""},placeholder:{type:String,default:"Select an item"},showRemoveButton:{type:Boolean,default:!0}},emits:["update:selectedItems"],setup(w,{emit:he}){const j=w,W=he,h=b([]),V=b([]),ie=b([]),te=b([]),g=b(!1),se=async()=>{if(!(j.roleOptions.length>0))try{const y=(await be.get(`/api/roles?type=${j.roleType}`)).data;ie.value=y.map(v=>({value:v.id,label:v.name}))}catch(c){console.error("Error fetching roles:",c)}},B=ee(()=>ie.value.length>0?ie.value:j.roleOptions),M=()=>j.defaultRoleId?j.defaultRoleId:B.value.length>0?B.value[0].value:1,P=()=>{if(console.log("initializeFromProps called with selectedItems:",j.selectedItems),!j.selectedItems||j.selectedItems.length===0){h.value=[],V.value=[],console.log("Cleared selectedIds and selectedItemsWithRoles because props.selectedItems is empty");return}const c=new Set;j.selectedItems.forEach(y=>{const v=typeof y=="object"?y.id:y;if(!c.has(v)){if(c.add(v),!h.value.includes(v))h.value.push(v),typeof y=="object"&&y.role_id?V.value.push({id:v,role_id:y.role_id}):V.value.push({id:v,role_id:M()});else if(typeof y=="object"&&y.role_id){const R=V.value.find(Y=>Y.id===v);R&&(R.role_id=y.role_id)}}}),console.log("After initialization, selectedIds:",h.value),console.log("After initialization, selectedItemsWithRoles:",V.value)};Q(()=>j.selectedItems,(c,y)=>{console.log("selectedItems changed:",c),JSON.stringify(c)!==JSON.stringify(y)?(console.log("selectedItems changed significantly, reinitializing"),P()):console.log("selectedItems change was not significant, skipping reinitialization")},{deep:!0,immediate:!0}),Q(V,c=>{W("update:selectedItems",c)},{deep:!0});const xe=c=>{c&&!h.value.includes(c)&&(h.value.push(c),V.value.push({id:c,role_id:M()}))},me=c=>{h.value=h.value.filter(y=>y!==c),V.value=V.value.filter(y=>y.id!==c)},G=(c,y)=>{const v=V.value.find(R=>R.id===c);v&&(v.role_id=parseInt(y))},q=c=>z.value.find(y=>y[j.itemValue]===c),S=c=>{const y=V.value.find(v=>v.id===c);return y?y.role_id:M()},ae=async()=>{if(j.endpoint){g.value=!0;try{const c=await be.get(j.endpoint);c.data&&Array.isArray(c.data)?te.value=c.data:c.data&&c.data.data&&Array.isArray(c.data.data)&&(te.value=c.data.data)}catch(c){console.error("Error fetching items from endpoint:",c)}finally{g.value=!1}}},z=ee(()=>j.endpoint&&te.value.length>0?te.value:j.items);return Le(()=>{se(),P(),j.endpoint&&ae()}),(c,y)=>(r(),i("div",null,[d(k,{value:w.label},null,8,["value"]),o("div",ct,[o("div",mt,[g.value?(r(),i("div",vt,"Loading...")):u("",!0),w.showRemoveButton?(r(),i("select",{key:1,class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full",onChange:y[0]||(y[0]=v=>{const R=parseInt(v.target.value);xe(R),v.target.value=""}),disabled:g.value},[o("option",ft,_(w.placeholder),1),(r(!0),i(O,null,T(z.value.filter(v=>!h.value.includes(v[w.itemValue])),v=>(r(),i("option",{key:v[w.itemValue],value:v[w.itemValue]},_(v[w.itemText])+" ("+_(v[w.itemSubtext])+") ",9,_t))),128))],40,pt)):u("",!0)]),(r(!0),i(O,null,T(h.value,v=>{var R,Y;return r(),i("div",{key:v,class:"flex items-center mb-1 p-2 border rounded"},[o("div",yt,_((R=q(v))==null?void 0:R[w.itemText])+" ("+_((Y=q(v))==null?void 0:Y[w.itemSubtext])+") ",1),o("select",{class:"ms-2 border-gray-300 rounded-md",value:S(v),onChange:E=>G(v,E.target.value),disabled:!w.showRemoveButton},[(r(!0),i(O,null,T(B.value,E=>(r(),i("option",{key:E.value,value:E.value},_(E.label),9,bt))),128))],40,gt),w.showRemoveButton?(r(),i("button",{key:0,type:"button",class:"ml-2 text-red-600",onClick:()=>me(v)}," Remove ",8,ht)):u("",!0)])}),128))]),d(I,{message:w.error,class:"mt-2"},null,8,["message"])]))}},xt={class:"p-6 w-full max-w-6xl mx-auto bg-white rounded-lg shadow-xl"},kt={class:"flex justify-between items-center mb-4"},wt={class:"text-lg font-medium text-gray-900"},jt={key:0,class:"text-red-600 text-sm mb-4"},Vt={key:1,class:"mb-4"},St={key:0,class:"text-xs text-gray-500 mt-2 p-2 bg-gray-100 rounded"},$t={class:"font-bold"},Ct={class:"mt-1"},Ut={key:0},Dt={key:1},Pt={key:2},It={key:0},Rt={class:"list-disc ml-4"},Ft={key:0},At={class:"mt-1"},Ot={class:"border-b border-gray-200 mb-6"},Tt={class:"flex -mb-px"},Et={key:0},Nt={class:"mb-4"},Bt={class:"mb-4"},Mt=["disabled"],qt={class:"mb-4"},zt={class:"mb-4"},Lt={class:"mb-4"},Jt=["disabled"],Wt=["value"],Gt={class:"mb-4"},Yt=["disabled"],Ht=["value"],Kt={key:0,class:"mt-6 flex justify-end"},Xt={key:1},Qt={key:0,class:"mb-4"},Zt={key:0,class:"mt-2 flex justify-end"},es={key:1,class:"mt-2 text-green-600 text-sm"},ts={key:2,class:"mt-2 text-red-600 text-sm"},ss={class:"mb-4"},as=["disabled"],os={key:1,class:"mb-4"},ls={key:0,class:"mt-2 flex justify-end"},rs={key:1,class:"mt-2 text-green-600 text-sm"},ns={key:2,class:"mt-2 text-red-600 text-sm"},is={key:2},ds={class:"mb-4"},us={class:"mb-4"},cs=["disabled"],ms=["value"],vs={class:"mb-4"},ps={class:"mt-2"},fs={class:"flex items-center mb-2"},_s=["for"],ys={key:0,class:"pl-6"},gs={class:"grid grid-cols-2 gap-4 mb-2"},bs=["id","onUpdate:modelValue","disabled"],hs={class:"mb-2"},xs={class:"grid grid-cols-3 gap-2"},ks={class:"text-xs text-gray-500 mt-1"},ws={key:0,class:"mt-6 flex justify-end"},js={key:3},Vs={class:"mb-4"},Ss={class:"flex justify-between items-center mb-4"},$s={class:"text-right"},Cs={class:"text-lg font-medium"},Us={class:"text-lg font-medium"},Ds={class:"text-xl font-bold mt-1"},Ps={key:0,class:"mt-4"},Is=["onUpdate:modelValue"],Rs={key:0,value:"income"},Fs={key:1,value:"expense"},As=["onUpdate:modelValue"],Os=["value"],Ts=["onClick"],Es={class:"flex mt-2"},Ns={key:0,class:"mt-6 flex justify-end"},Bs={key:4},Ms={class:"mb-4"},qs={class:"mt-2"},zs={key:0,class:"mb-4"},Ls={class:"mt-4"},Js={key:0,class:"text-sm text-red-500 mt-2"},Ws={key:1,class:"mt-4"},Gs={class:"flex-grow"},Ys=["href"],Hs=["onClick"],Ks={key:5},Xs={class:"mb-4"},Qs={class:"mt-2"},Zs={class:"flex items-start mb-2"},ea=["onUpdate:modelValue","readonly"],ta={class:"mt-6 flex justify-end"},ia={__name:"ProjectForm",props:{show:{type:Boolean,required:!0},project:{type:Object,default:()=>({})},statusOptions:{type:Array,required:!0},departmentOptions:{type:Array,required:!0},sourceOptions:{type:Array,required:!0},clientRoleOptions:{type:Array,default:()=>[]},userRoleOptions:{type:Array,default:()=>[]},paymentTypeOptions:{type:Array,required:!0}},emits:["close","submit"],setup(w,{emit:he}){ot();const j=b({}),W=w;Q(()=>W.project,t=>{j.value=t||{}},{immediate:!0});const h=ee(()=>{var t;return((t=j.value)==null?void 0:t.id)||null}),{permissions:V,loading:ie,error:te}=lt(h),g=rt(j);ee(()=>!!g.value),ee(()=>{if(!g.value)return!1;const t=g.value.name,a=g.value.slug;return t==="Manager"||t==="Project Manager"||a==="manager"||a==="project-manager"});const{canDo:se,canView:B,canManage:M}=nt(h),P=se("manage_projects",g),xe=se("create_projects",g),me=se("upload_project_documents",g),G=M("project_expenses",g),q=M("project_income",g),S=M("project_services_and_payments",g),ae=se("add_project_notes",g),z=M("project_users",g),c=M("project_clients",g),y=M("project_basic_details",g),v=B("project_documents",g),R=B("project_services_and_payments",g),Y=B("project_notes",g),E=B("project_users",g),de=B("project_clients",g),ke=B("view_project_transactions",g),$=b("basic"),Z=t=>{if(!(t==="documents"&&!e.id)&&($.value=t,e.id))switch(F.value=!0,t){case"basic":Ue(e.id).finally(()=>{F.value=!1});break;case"client":de.value||c.value||E.value||z.value?De(e.id).finally(()=>{F.value=!1}):F.value=!1;break;case"services":R.value||S.value?Pe(e.id).finally(()=>{F.value=!1}):F.value=!1;break;case"transactions":G.value||q.value?Ie(e.id).finally(()=>{F.value=!1}):F.value=!1;break;case"documents":v.value?Re(e.id).finally(()=>{F.value=!1}):F.value=!1;break;case"notes":Y.value||ae.value?Fe(e.id).finally(()=>{F.value=!1}):F.value=!1;break;default:F.value=!1;break}},ue=b([]),ce=b([]),we=b([]),oe=b([]),Je=async()=>{try{const a=(await be.get("/api/roles?type=client")).data;ue.value=a.map(m=>({value:m.id,label:m.name}));const s=(await be.get("/api/roles?type=project")).data;ce.value=s.map(m=>({value:m.id,label:m.name}))}catch(t){console.error("Error fetching roles:",t)}},$e=async()=>{try{if(h.value){const t=await window.axios.get(`/api/projects/${h.value}/clients`);we.value=t.data}else{const t=await window.axios.get("/api/clients");we.value=t.data.data||t.data}}catch(t){console.error("Error fetching clients:",t),x.value="Failed to load clients."}},Ce=async()=>{try{if(xe.value){const t=await window.axios.get("/api/users");oe.value=t.data}else if(h.value){const t=await window.axios.get(`/api/projects/${h.value}/users`);oe.value=t.data}else{const t=await window.axios.get("/api/users");oe.value=t.data}}catch(t){console.error("Error fetching users:",t),x.value="Failed to load users."}},We=ee(()=>ue.value.length>0?ue.value:W.clientRoleOptions),Ge=ee(()=>ce.value.length>0?ce.value:W.userRoleOptions),Ue=async t=>{try{const l=(await window.axios.get(`/api/projects/${t}/sections/basic`)).data;return e.name=l.name||"",e.description=l.description||"",e.website=l.website||"",e.social_media_link=l.social_media_link||"",e.preferred_keywords=l.preferred_keywords||"",e.google_chat_id=l.google_chat_id||"",e.status=l.status||"active",e.project_type=l.project_type||"",e.source=l.source||"",e.google_drive_link=l.google_drive_link||"",l}catch(a){return console.error("Error fetching basic project data:",a),x.value="Failed to fetch basic project data.",null}},De=async t=>{try{const l=(await window.axios.get(`/api/projects/${t}/sections/clients-users`)).data;return l.clients&&l.clients.length>0&&(e.client_ids=l.clients.map(s=>{var f;let m=((f=s.pivot)==null?void 0:f.role_id)||(ue.value.length>0?ue.value[0].value:1);return{id:s.id,role_id:m}})),l.users&&l.users.length>0&&(e.user_ids=l.users.map(s=>{var f;let m=((f=s.pivot)==null?void 0:f.role_id)||(ce.value.length>0?ce.value[0].value:2);return{id:s.id,role_id:m}})),l.contract_details!==void 0&&(e.contract_details=l.contract_details||""),l}catch(a){return console.error("Error fetching clients and users data:",a),x.value="Failed to fetch clients and users data.",null}},Pe=async t=>{try{const l=(await window.axios.get(`/api/projects/${t}/sections/services-payment`)).data;return e.services=l.services||[],e.service_details=l.service_details||[],e.total_amount=l.total_amount||"",e.payment_type=l.payment_type||"one_off",l}catch(a){return console.error("Error fetching services and payment data:",a),x.value="Failed to fetch services and payment data.",null}},Ie=async t=>{try{const l=(await window.axios.get(`/api/projects/${t}/sections/transactions`)).data;return e.transactions=l.map(s=>({description:s.description,amount:s.amount,user_id:s.user_id,hours_spent:s.hours_spent,type:s.type||"expense"})),l}catch(a){return console.error("Error fetching transactions data:",a),x.value="Failed to fetch transactions data.",null}},Re=async t=>{try{const l=(await window.axios.get(`/api/projects/${t}/sections/documents`)).data;return e.documents=l.documents||[],l}catch(a){return console.error("Error fetching documents data:",a),x.value="Failed to fetch documents data.",null}},Fe=async t=>{try{const l=(await window.axios.get(`/api/projects/${t}/sections/notes`)).data;return e.notes=l.map(s=>({content:s.content})),l}catch(a){return console.error("Error fetching notes data:",a),x.value="Failed to fetch notes data.",null}},Ye=async t=>{try{switch(await Ue(t),$.value){case"client":(de.value||c.value||E.value||z.value)&&await De(t);break;case"services":(R.value||S.value)&&await Pe(t);break;case"transactions":(G.value||q.value)&&await Ie(t);break;case"documents":v.value&&await Re(t);break;case"notes":(Y.value||ae.value)&&await Fe(t);break}}catch(a){console.error("Error fetching project data:",a),x.value="Failed to fetch project data."}};Le(()=>{Je(),$e(),Ce(),h.value&&Be(h.value).then(t=>{}).catch(t=>{})}),Q(h,(t,a)=>{t&&t!==a&&(Be(t).then(l=>{}).catch(l=>{}),Ce(),$e())});const je=he,p=b({}),x=b(""),F=b(!1),He=b(!1),ve=b(!1),pe=b(!1),H=b(""),fe=b(!1),_e=b(!1),K=b(""),e=it({id:null,name:"",description:"",website:"",social_media_link:"",preferred_keywords:"",google_chat_id:"",logo:null,documents:[],client_ids:[],status:"active",project_type:"",services:[],service_details:[],source:"",total_amount:"",contract_details:"",google_drive_link:"",payment_type:"one_off",user_ids:[],transactions:[],notes:[]});Q(()=>W.show,t=>{t&&(e.client_ids||(e.client_ids=[]),e.user_ids||(e.user_ids=[]),e.id&&Ye(e.id))},{immediate:!0}),Q(()=>W.project,t=>{const a=e.id;e.id=t.id||null,a&&!e.id&&$.value==="documents"&&Z("basic"),e.name=t.name||"",e.description=t.description||"",e.website=t.website||"",e.social_media_link=t.social_media_link||"",e.preferred_keywords=t.preferred_keywords||"",e.google_chat_id=t.google_chat_id||"",e.logo=t.logo||null,e.documents=t.documents||[],e.client_ids=[],e.status=t.status||"active",e.project_type=t.project_type||"",e.services=t.services||[],e.service_details=t.service_details||[],e.source=t.source||"",e.total_amount=t.total_amount||"",e.contract_details=t.contract_details||"",e.google_drive_link=t.google_drive_link||"",e.payment_type=t.payment_type||"one_off",e.user_ids=[],e.transactions=t.transactions?t.transactions.map(l=>({description:l.description,amount:l.amount,user_id:l.user_id,hours_spent:l.hours_spent,type:l.type||"expense"})):[],e.notes=t.notes?t.notes.map(l=>({content:l.content})):[],p.value={},x.value=""},{immediate:!0});const Ke=async()=>{p.value={},x.value="";try{const t={name:e.name,description:e.description,website:e.website,social_media_link:e.social_media_link,preferred_keywords:e.preferred_keywords,google_chat_id:e.google_chat_id,status:e.status,project_type:e.project_type,source:e.source,google_drive_link:e.google_drive_link,user_ids:e.user_ids},a=e.logo;typeof a=="object"&&a!==null&&"name"in a&&delete t.logo;const l=await window.axios.post("/api/projects",t);e.id=l.data.id,typeof a=="object"&&a!==null&&"name"in a&&await Oe(a,e.id),je("submit",l.data)}catch(t){ye(t,"Failed to create project.")}},Xe=async()=>{p.value={},x.value="";try{const t={name:e.name,description:e.description,website:e.website,social_media_link:e.social_media_link,preferred_keywords:e.preferred_keywords,google_chat_id:e.google_chat_id,status:e.status,project_type:e.project_type,source:e.source,google_drive_link:e.google_drive_link},a=e.logo;typeof a=="object"&&a!==null&&"name"in a&&delete t.logo;const l=await window.axios.put(`/api/projects/${e.id}/sections/basic`,t);typeof a=="object"&&a!==null&&"name"in a&&await Oe(a,e.id),alert("Basic information updated successfully!")}catch(t){ye(t,"Failed to update basic information.")}},Qe=async()=>{p.value={},x.value="";try{const t={services:e.services,service_details:e.service_details,total_amount:e.total_amount,payment_type:e.payment_type},a=await window.axios.put(`/api/projects/${e.id}/sections/services-payment`,t);alert("Services and payment information updated successfully!")}catch(t){ye(t,"Failed to update services and payment information.")}},Ze=async()=>{p.value={},x.value="";try{const t={transactions:e.transactions};G.value||(t.transactions=t.transactions.filter(l=>l.type!=="expense")),q.value||(t.transactions=t.transactions.filter(l=>l.type!=="income"));const a=await window.axios.put(`/api/projects/${e.id}/sections/transactions`,t);alert("Transactions updated successfully!")}catch(t){ye(t,"Failed to update transactions.")}},ye=(t,a)=>{t.response&&t.response.status===422?p.value=t.response.data.errors:t.response&&t.response.data.message?x.value=t.response.data.message:(x.value=a,console.error("Error:",t))},et=(t,a)=>{a?e.service_details.some(l=>l.service_id===t)||e.service_details.push({service_id:t,amount:"",frequency:"one_off",start_date:"",payment_breakdown:{first:30,second:30,third:40}}):e.service_details=e.service_details.filter(l=>l.service_id!==t)},C=t=>{let a=e.service_details.find(l=>l.service_id===t);return a||(a={service_id:t,amount:"",frequency:"one_off",start_date:"",payment_breakdown:{first:30,second:30,third:40}},e.service_details.push(a)),a},ge=b(!1),Ve=b({});Q(e,()=>{Object.keys(Ve.value).length>0&&(ge.value=!0)},{deep:!0}),Q(()=>W.show,t=>{t&&setTimeout(()=>{Ve.value=JSON.parse(JSON.stringify(e)),ge.value=!1},100)});const Ae=()=>{ge.value?confirm("You have unsaved changes. Are you sure you want to close this form?")&&je("close"):je("close")},Oe=async(t,a)=>{try{const l=new FormData;l.append("logo",t);const s=await window.axios.post(`/api/projects/${a}/logo`,l,{headers:{"Content-Type":"multipart/form-data"}});return s.data&&s.data.logo&&(e.logo=s.data.logo),s}catch(l){console.error("Error uploading logo:",l)}},tt=async()=>{if(!e.id){H.value="Please save the project first before saving clients.";return}if(!e.client_ids||e.client_ids.length===0){H.value="Please select at least one client to save.";return}ve.value=!0,pe.value=!1,H.value="";try{const t=await window.axios.post(`/api/projects/${e.id}/attach-clients`,{client_ids:e.client_ids});pe.value=!0,setTimeout(()=>{pe.value=!1},3e3)}catch(t){t.response&&t.response.status===422?H.value="Validation error. Please check your input.":t.response&&t.response.data.message?H.value=t.response.data.message:(H.value="Failed to save clients.",console.error("Error saving clients:",t))}finally{ve.value=!1}},st=async()=>{if(console.log("saveUsers called, projectForm.user_ids:",e.user_ids),!e.id){K.value="Please save the project first before saving users.";return}if(!e.user_ids||e.user_ids.length===0){console.log("No users selected, projectForm.user_ids is empty or null"),K.value="Please select at least one user to save.";return}fe.value=!0,_e.value=!1,K.value="";try{console.log("Sending user_ids to API:",JSON.stringify(e.user_ids));const t=await window.axios.post(`/api/projects/${e.id}/attach-users`,{user_ids:e.user_ids});_e.value=!0,setTimeout(()=>{_e.value=!1},3e3)}catch(t){t.response&&t.response.status===422?K.value="Validation error. Please check your input.":t.response&&t.response.data.message?K.value=t.response.data.message:(K.value="Failed to save users.",console.error("Error saving users:",t))}finally{fe.value=!1}},at=async()=>{if(!e.id){x.value="Please save the project first before uploading documents.";return}if(!e.documents||!e.documents.some(t=>typeof t=="object"&&t!==null&&"name"in t&&"size"in t&&"type"in t)){x.value="Please select documents to upload.";return}try{const t=new FormData;e.documents.filter(m=>typeof m=="object"&&m!==null&&"name"in m&&"size"in m&&"type"in m).forEach((m,f)=>{t.append(`documents[${f}]`,m)});const l=await window.axios.post(`/api/projects/${e.id}/documents`,t,{headers:{"Content-Type":"multipart/form-data"}});e.documents=l.data.documents||[],document.getElementById("documents").value="",alert("Documents uploaded successfully!");const s=JSON.parse(JSON.stringify(e));Ve.value=s,ge.value=!1}catch(t){t.response&&t.response.status===422?p.value=t.response.data.errors:t.response&&t.response.data.message?x.value=t.response.data.message:(x.value="Failed to upload documents.",console.error("Error uploading documents:",t))}};return(t,a)=>{var l;return r(),i("div",xt,[o("div",kt,[o("h2",wt,_(e.id?"Edit Project":"Create New Project"),1),o("button",{onClick:Ae,class:"text-gray-400 hover:text-gray-500"},a[22]||(a[22]=[o("svg",{class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),x.value?(r(),i("div",jt,_(x.value),1)):u("",!0),h.value?(r(),i("div",Vt,[He.value?(r(),i("div",St,[o("div",$t,"Project ID: "+_(h.value),1),o("div",null,_(n(g)?"Project Role: "+(((l=n(g).value)==null?void 0:l.name)||"None"):"No Project Role"),1),o("div",Ct,[a[24]||(a[24]=o("div",{class:"font-semibold"},"Project Permissions:",-1)),n(ie)?(r(),i("div",Ut,"Loading project permissions...")):n(te)?(r(),i("div",Dt,"Error loading project permissions")):n(V)?(r(),i("div",Pt,[L(" Count: "+_(n(V).permissions?n(V).permissions.length:0)+" ",1),n(V).permissions&&n(V).permissions.length>0?(r(),i("div",It,[a[23]||(a[23]=o("div",{class:"font-semibold"},"Permissions:",-1)),o("ul",Rt,[(r(!0),i(O,null,T(n(V).permissions.slice(0,5),s=>(r(),i("li",{key:s.slug},_(s.name)+" ("+_(s.source)+") ",1))),128)),n(V).permissions.length>5?(r(),i("li",Ft," ... and "+_(n(V).permissions.length-5)+" more ",1)):u("",!0)])])):u("",!0)])):u("",!0)]),o("div",At,"Can manage projects: "+_(n(P)?"Yes":"No"),1)])):u("",!0)])):u("",!0),o("div",Ot,[o("nav",Tt,[n(P)?(r(),i("button",{key:0,onClick:a[0]||(a[0]=s=>Z("basic")),class:le(["py-2 px-4 text-center border-b-2 font-medium text-sm",$.value==="basic"?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"])}," Basic Information ",2)):u("",!0),n(de)||n(E)?(r(),i("button",{key:1,onClick:a[1]||(a[1]=s=>Z("client")),class:le(["py-2 px-4 text-center border-b-2 font-medium text-sm",$.value==="client"?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"])}," Clients and Users ",2)):u("",!0),e.id&&(n(S)||n(R))?(r(),i("button",{key:2,onClick:a[2]||(a[2]=s=>Z("services")),class:le(["py-2 px-4 text-center border-b-2 font-medium text-sm",$.value==="services"?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"])}," Services & Payment ",2)):u("",!0),e.id&&n(ke)?(r(),i("button",{key:3,onClick:a[3]||(a[3]=s=>Z("transactions")),class:le(["py-2 px-4 text-center border-b-2 font-medium text-sm",$.value==="transactions"?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"])}," Transactions ",2)):u("",!0),e.id&&n(v)?(r(),i("button",{key:4,onClick:a[4]||(a[4]=s=>Z("documents")),class:le(["py-2 px-4 text-center border-b-2 font-medium text-sm",$.value==="documents"?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"])}," Documents ",2)):u("",!0),e.id&&(n(ae)||n(Y))?(r(),i("button",{key:5,onClick:a[5]||(a[5]=s=>Z("notes")),class:le(["py-2 px-4 text-center border-b-2 font-medium text-sm",$.value==="notes"?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"])}," Notes ",2)):u("",!0)])]),o("form",{onSubmit:a[21]||(a[21]=dt(()=>{},["prevent"]))},[$.value==="basic"?(r(),i("div",Et,[o("div",Nt,[d(k,{for:"name",value:"Project Name"}),d(A,{id:"name",type:"text",class:"mt-1 block w-full",modelValue:e.name,"onUpdate:modelValue":a[6]||(a[6]=s=>e.name=s),required:"",autofocus:"",disabled:!n(P)},null,8,["modelValue","disabled"]),d(I,{message:p.value.name?p.value.name[0]:"",class:"mt-2"},null,8,["message"])]),o("div",Bt,[d(k,{for:"description",value:"Description"}),J(o("textarea",{id:"description",class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full","onUpdate:modelValue":a[7]||(a[7]=s=>e.description=s),disabled:!n(P)},null,8,Mt),[[Se,e.description]]),d(I,{message:p.value.description?p.value.description[0]:"",class:"mt-2"},null,8,["message"])]),o("div",qt,[d(k,{for:"website",value:"Website"}),d(A,{id:"website",type:"url",class:"mt-1 block w-full",modelValue:e.website,"onUpdate:modelValue":a[8]||(a[8]=s=>e.website=s),disabled:!n(P)},null,8,["modelValue","disabled"]),d(I,{message:p.value.website?p.value.website[0]:"",class:"mt-2"},null,8,["message"])]),o("div",zt,[d(k,{for:"preferred_keywords",value:"Client Preferred Keywords"}),d(A,{id:"preferred_keywords",type:"text",class:"mt-1 block w-full",modelValue:e.preferred_keywords,"onUpdate:modelValue":a[9]||(a[9]=s=>e.preferred_keywords=s),disabled:!n(P)},null,8,["modelValue","disabled"]),d(I,{message:p.value.preferred_keywords?p.value.preferred_keywords[0]:"",class:"mt-2"},null,8,["message"])]),o("div",Lt,[d(k,{for:"status",value:"Status"}),J(o("select",{id:"status",class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full","onUpdate:modelValue":a[10]||(a[10]=s=>e.status=s),required:"",disabled:!n(P)},[(r(!0),i(O,null,T(w.statusOptions,s=>(r(),i("option",{key:s.value,value:s.value},_(s.label),9,Wt))),128))],8,Jt),[[re,e.status]]),d(I,{message:p.value.status?p.value.status[0]:"",class:"mt-2"},null,8,["message"])]),o("div",Gt,[d(k,{for:"source",value:"Source"}),J(o("select",{id:"source",class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full","onUpdate:modelValue":a[11]||(a[11]=s=>e.source=s),disabled:!n(P)},[a[25]||(a[25]=o("option",{value:"",disabled:""},"Select a Source",-1)),(r(!0),i(O,null,T(w.sourceOptions,s=>(r(),i("option",{key:s.value,value:s.value},_(s.label),9,Ht))),128))],8,Yt),[[re,e.source]]),d(I,{message:p.value.source?p.value.source[0]:"",class:"mt-2"},null,8,["message"])]),n(P)?(r(),i("div",Kt,[e.id&&n(y)||!e.id?(r(),Me(ne,{key:0,onClick:a[12]||(a[12]=s=>e.id?Xe():Ke()),disabled:!n(P)},{default:X(()=>[L(_(e.id?"Update Basic Information":"Create Project"),1)]),_:1},8,["disabled"])):u("",!0)])):u("",!0)])):u("",!0),$.value==="client"?(r(),i("div",Xt,[n(de)?(r(),i("div",Qt,[d(ze,{label:"Clients",items:we.value,selectedItems:e.client_ids,"onUpdate:selectedItems":a[13]||(a[13]=s=>e.client_ids=s),roleOptions:We.value,roleType:"client",error:p.value.client_ids?p.value.client_ids[0]:"",placeholder:"Select a client to add",disabled:!n(c),readonly:!n(c)&&n(de),showRemoveButton:n(c)},null,8,["items","selectedItems","roleOptions","error","disabled","readonly","showRemoveButton"]),n(c)?(r(),i("div",Zt,[d(ne,{onClick:tt,disabled:ve.value},{default:X(()=>[L(_(ve.value?"Saving...":"Save Clients"),1)]),_:1},8,["disabled"])])):u("",!0),pe.value?(r(),i("div",es," Clients saved successfully! ")):u("",!0),H.value?(r(),i("div",ts,_(H.value),1)):u("",!0)])):u("",!0),o("div",ss,[d(k,{for:"contract_details",value:"Contract Details"}),J(o("textarea",{id:"contract_details",class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full","onUpdate:modelValue":a[14]||(a[14]=s=>e.contract_details=s),disabled:!n(P)},null,8,as),[[Se,e.contract_details]]),d(I,{message:p.value.contract_details?p.value.contract_details[0]:"",class:"mt-2"},null,8,["message"])]),n(E)?(r(),i("div",os,[d(ze,{label:"Assign Users",items:oe.value,selectedItems:e.user_ids,"onUpdate:selectedItems":a[15]||(a[15]=s=>e.user_ids=s),roleOptions:Ge.value,roleType:"project",defaultRoleId:2,error:p.value.user_ids?p.value.user_ids[0]:"",placeholder:"Select a user to add",disabled:!n(z),readonly:!n(z)&&n(E),showRemoveButton:n(z)},null,8,["items","selectedItems","roleOptions","error","disabled","readonly","showRemoveButton"]),n(z)?(r(),i("div",ls,[d(ne,{onClick:st,disabled:fe.value},{default:X(()=>[L(_(fe.value?"Saving...":"Save Users"),1)]),_:1},8,["disabled"])])):u("",!0),_e.value?(r(),i("div",rs," Users saved successfully! ")):u("",!0),K.value?(r(),i("div",ns,_(K.value),1)):u("",!0)])):u("",!0)])):u("",!0),$.value==="services"?(r(),i("div",is,[o("div",ds,[d(k,{for:"total_amount",value:"Total Amount"}),d(A,{id:"total_amount",type:"number",step:"0.01",class:"mt-1 block w-full",modelValue:e.total_amount,"onUpdate:modelValue":a[16]||(a[16]=s=>e.total_amount=s),disabled:!n(S)},null,8,["modelValue","disabled"]),d(I,{message:p.value.total_amount?p.value.total_amount[0]:"",class:"mt-2"},null,8,["message"])]),o("div",us,[d(k,{for:"payment_type",value:"Payment Type"}),J(o("select",{id:"payment_type",class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full","onUpdate:modelValue":a[17]||(a[17]=s=>e.payment_type=s),required:"",disabled:!n(S)},[(r(!0),i(O,null,T(w.paymentTypeOptions,s=>(r(),i("option",{key:s.value,value:s.value},_(s.label),9,ms))),128))],8,cs),[[re,e.payment_type]]),d(I,{message:p.value.payment_type?p.value.payment_type[0]:"",class:"mt-2"},null,8,["message"])]),o("div",vs,[d(k,{for:"services",value:"Services"}),o("div",ps,[(r(!0),i(O,null,T(w.departmentOptions,s=>{var m,f,U,Te,Ee,Ne;return r(),i("div",{key:s.value,class:"border p-3 mb-3 rounded"},[o("div",fs,[d(ut,{id:`service_${s.value}`,value:s.value,checked:e.services,"onUpdate:checked":[a[18]||(a[18]=D=>e.services=D),D=>et(s.value,D)],disabled:!n(S)},null,8,["id","value","checked","onUpdate:checked","disabled"]),o("label",{for:`service_${s.value}`,class:"ms-2 text-sm font-medium text-gray-700"},_(s.label),9,_s)]),(e.services||[]).includes(s.value)?(r(),i("div",ys,[o("div",gs,[o("div",null,[d(k,{for:`service_amount_${s.value}`,value:"Amount",class:"text-xs"},null,8,["for"]),d(A,{id:`service_amount_${s.value}`,type:"number",step:"0.01",placeholder:"Amount",class:"w-full",modelValue:C(s.value).amount,"onUpdate:modelValue":D=>C(s.value).amount=D,disabled:!n(S)},null,8,["id","modelValue","onUpdate:modelValue","disabled"])]),o("div",null,[d(k,{for:`service_frequency_${s.value}`,value:"Frequency",class:"text-xs"},null,8,["for"]),J(o("select",{id:`service_frequency_${s.value}`,class:"border-gray-300 rounded-md w-full","onUpdate:modelValue":D=>C(s.value).frequency=D,disabled:!n(S)},a[26]||(a[26]=[o("option",{value:"monthly"},"Monthly",-1),o("option",{value:"one_off"},"One off",-1)]),8,bs),[[re,C(s.value).frequency]])])]),o("div",hs,[d(k,{for:`service_start_date_${s.value}`,value:"Start Date",class:"text-xs"},null,8,["for"]),d(A,{id:`service_start_date_${s.value}`,type:"date",class:"w-full",modelValue:C(s.value).start_date,"onUpdate:modelValue":D=>C(s.value).start_date=D,disabled:!n(S)},null,8,["id","modelValue","onUpdate:modelValue","disabled"])]),o("div",null,[d(k,{value:"Payment Breakdown (%)",class:"text-xs mb-1"}),o("div",xs,[o("div",null,[d(k,{for:`service_payment_first_${s.value}`,value:"First",class:"text-xs"},null,8,["for"]),d(A,{id:`service_payment_first_${s.value}`,type:"text",min:"0",max:"100",class:"w-full",value:((m=C(s.value).payment_breakdown)==null?void 0:m.first)||0,onInput:D=>{if(n(S)){const N=C(s.value);N.payment_breakdown||(N.payment_breakdown={}),N.payment_breakdown.first=D.target.value}},disabled:!n(S)},null,8,["id","value","onInput","disabled"])]),o("div",null,[d(k,{for:`service_payment_second_${s.value}`,value:"Second",class:"text-xs"},null,8,["for"]),d(A,{id:`service_payment_second_${s.value}`,type:"text",min:"0",max:"100",class:"w-full",value:((f=C(s.value).payment_breakdown)==null?void 0:f.second)||0,onInput:D=>{if(n(S)){const N=C(s.value);N.payment_breakdown||(N.payment_breakdown={}),N.payment_breakdown.second=D.target.value}},disabled:!n(S)},null,8,["id","value","onInput","disabled"])]),o("div",null,[d(k,{for:`service_payment_third_${s.value}`,value:"Third",class:"text-xs"},null,8,["for"]),d(A,{id:`service_payment_third_${s.value}`,type:"text",min:"0",max:"100",class:"w-full",value:((U=C(s.value).payment_breakdown)==null?void 0:U.third)||0,onInput:D=>{if(n(S)){const N=C(s.value);N.payment_breakdown||(N.payment_breakdown={}),N.payment_breakdown.third=D.target.value}},disabled:!n(S)},null,8,["id","value","onInput","disabled"])])]),o("div",ks," Total: "+_(parseInt(((Te=C(s.value).payment_breakdown)==null?void 0:Te.first)||0)+parseInt(((Ee=C(s.value).payment_breakdown)==null?void 0:Ee.second)||0)+parseInt(((Ne=C(s.value).payment_breakdown)==null?void 0:Ne.third)||0))+"% ",1)])])):u("",!0)])}),128))]),d(I,{message:p.value.services?p.value.services[0]:"",class:"mt-2"},null,8,["message"])]),n(S)?(r(),i("div",ws,[d(ne,{onClick:Qe,disabled:!e.id||!n(S)},{default:X(()=>a[27]||(a[27]=[L(" Update Services & Payment ")])),_:1,__:[27]},8,["disabled"])])):u("",!0)])):u("",!0),$.value==="transactions"&&n(ke)?(r(),i("div",js,[o("div",Vs,[o("div",Ss,[a[28]||(a[28]=o("h3",{class:"text-lg font-medium"},"Transactions",-1)),o("div",$s,[o("div",Cs," Total Income: $"+_(e.transactions.filter(s=>s.type==="income").reduce((s,m)=>s+(parseFloat(m.amount)||0),0).toFixed(2)),1),o("div",Us," Total Expenses: $"+_(e.transactions.filter(s=>s.type==="expense").reduce((s,m)=>s+(parseFloat(m.amount)||0),0).toFixed(2)),1),o("div",Ds," Net: $"+_((e.transactions.filter(s=>s.type==="income").reduce((s,m)=>s+(parseFloat(m.amount)||0),0)-e.transactions.filter(s=>s.type==="expense").reduce((s,m)=>s+(parseFloat(m.amount)||0),0)).toFixed(2)),1)])]),n(ke)?(r(),i("div",Ps,[(r(!0),i(O,null,T(e.transactions,(s,m)=>(r(),i("div",{key:m,class:"flex items-center mb-2 p-2 border rounded"},[J(o("select",{"onUpdate:modelValue":f=>s.type=f,class:"mr-2 border-gray-300 rounded-md"},[n(q)?(r(),i("option",Rs,"Income")):u("",!0),n(G)?(r(),i("option",Fs,"Expense")):u("",!0)],8,Is),[[re,s.type]]),d(A,{modelValue:s.description,"onUpdate:modelValue":f=>s.description=f,placeholder:"Description",class:"mr-2 flex-grow"},null,8,["modelValue","onUpdate:modelValue"]),d(A,{modelValue:s.amount,"onUpdate:modelValue":f=>s.amount=f,modelModifiers:{number:!0},type:"number",step:"0.01",placeholder:"Amount",class:"mr-2 w-24"},null,8,["modelValue","onUpdate:modelValue"]),s.type==="expense"?J((r(),i("select",{key:0,"onUpdate:modelValue":f=>s.user_id=f,class:"mr-2 border-gray-300 rounded-md"},[a[29]||(a[29]=o("option",{value:"",disabled:""},"Select User (Optional)",-1)),(r(!0),i(O,null,T(Array.isArray(oe.value)?oe.value.filter(f=>e.user_ids.some(U=>U.id===f.id)):[],f=>(r(),i("option",{key:f.id,value:f.id},_(f.name),9,Os))),128))],8,As)),[[re,s.user_id]]):u("",!0),s.type==="expense"?(r(),Me(A,{key:1,modelValue:s.hours_spent,"onUpdate:modelValue":f=>s.hours_spent=f,modelModifiers:{number:!0},type:"number",step:"0.01",placeholder:"Hours",class:"mr-2 w-20"},null,8,["modelValue","onUpdate:modelValue"])):u("",!0),o("button",{type:"button",class:"text-red-600",onClick:f=>e.transactions.splice(m,1)}," Remove ",8,Ts)]))),128)),o("div",Es,[d(qe,{onClick:a[19]||(a[19]=s=>e.transactions.push({description:"",amount:"",user_id:null,hours_spent:"",type:"expense"}))},{default:X(()=>a[30]||(a[30]=[L(" Add Transaction ")])),_:1,__:[30]})])])):u("",!0),d(I,{message:p.value.transactions?p.value.transactions[0]:"",class:"mt-2"},null,8,["message"])]),n(G)||n(q)?(r(),i("div",Ns,[d(ne,{onClick:Ze,disabled:!e.id||!n(G)&&!n(q)},{default:X(()=>a[31]||(a[31]=[L(" Update Transactions ")])),_:1,__:[31]},8,["disabled"])])):u("",!0)])):u("",!0),$.value==="documents"?(r(),i("div",Bs,[o("div",Ms,[d(k,{value:"Project Documents"}),o("div",qs,[n(me)?(r(),i("div",zs,[d(k,{for:"documents",value:"Upload Documents"}),o("input",{type:"file",id:"documents",onChange:a[20]||(a[20]=s=>{const m=Array.from(s.target.files);if(m.length>0){const f=Array.isArray(e.documents)?e.documents.filter(U=>typeof U=="object"&&"path"in U):[];e.documents=[...f,...m],console.log("Files selected:",m),console.log("Are files File objects?",m.some(U=>typeof U=="object"&&U!==null&&"name"in U&&"size"in U&&"type"in U)),console.log("Updated documents array:",e.documents)}}),class:"mt-1 block w-full",multiple:"",accept:".pdf,.doc,.docx,.jpg,.png"},null,32),a[33]||(a[33]=o("p",{class:"text-sm text-gray-500 mt-1"},"Supported formats: PDF, DOC, DOCX, JPG, PNG",-1)),d(I,{message:p.value.documents?p.value.documents[0]:"",class:"mt-2"},null,8,["message"]),o("div",Ls,[d(ne,{type:"button",onClick:at,disabled:!e.id||!e.documents||!e.documents.some(s=>typeof s=="object"&&s!==null&&"name"in s&&"size"in s&&"type"in s)},{default:X(()=>a[32]||(a[32]=[L(" Upload Documents ")])),_:1,__:[32]},8,["disabled"]),e.id?u("",!0):(r(),i("p",Js," Please save the project first before uploading documents. "))])])):u("",!0),e.documents&&e.documents.length>0&&typeof e.documents[0]=="object"&&"path"in e.documents[0]?(r(),i("div",Ws,[a[34]||(a[34]=o("h3",{class:"font-medium text-gray-700 mb-2"},"Existing Documents",-1)),(r(!0),i(O,null,T(e.documents,(s,m)=>(r(),i("div",{key:m,class:"flex items-center mb-2 p-2 border rounded"},[o("div",Gs,[o("a",{href:"/storage/"+s.path,target:"_blank",class:"text-blue-600 hover:underline"},_(s.filename),9,Ys)]),n(me).value?(r(),i("button",{key:0,type:"button",class:"ml-2 text-red-600",onClick:()=>{e.documents=e.documents.filter((f,U)=>U!==m)}}," Remove ",8,Hs)):u("",!0)]))),128))])):u("",!0),a[35]||(a[35]=o("div",{class:"mt-4"},[o("p",{class:"text-sm text-gray-500"}," Documents will be uploaded to the project's Google Drive folder. ")],-1))])])])):u("",!0),$.value==="notes"?(r(),i("div",Ks,[o("div",Xs,[d(k,{value:"Notes"}),o("div",Qs,[(r(!0),i(O,null,T(e.notes,(s,m)=>(r(),i("div",{key:m,class:"mb-4"},[o("div",Zs,[J(o("textarea",{"onUpdate:modelValue":f=>s.content=f,readonly:!n(ae),placeholder:"Note Content",class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full h-32"},null,8,ea),[[Se,s.content]])])]))),128))]),d(I,{message:p.value.notes?p.value.notes[0]:"",class:"mt-2"},null,8,["message"])])])):u("",!0),o("div",ta,[d(qe,{onClick:Ae},{default:X(()=>a[36]||(a[36]=[L("Close")])),_:1,__:[36]})])],32)])}}};export{ia as _};
