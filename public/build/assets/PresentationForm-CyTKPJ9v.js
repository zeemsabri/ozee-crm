import{b0 as P,D as V,r as d,m as g,q as B,o as x,w as N,a,c as D,k as I,t as w,y as j,f as C,v as q,H as T,e as U,N as F,M as R}from"./app-BWTxZZDy.js";import{a as E}from"./presentationsApi-DecaqiJL.js";import H from"./Modal-D1OhvCnL.js";import{S as O}from"./SelectDropdown-OjIlWwqk.js";/* empty css                                                                       */import"./_plugin-vue_export-helper-DlAUqK2U.js";const Q={class:"bg-white p-6 rounded-lg shadow-lg w-full"},z={key:0,class:"text-sm text-red-600 mb-3",role:"alert"},G={class:"mb-4"},J={class:"mb-4"},K={class:"mb-4"},W={class:"flex justify-end gap-3"},X=["disabled"],oe={__name:"PresentationForm",props:{templateId:{type:Number,default:null},sourceSlideIds:{type:Array,default:()=>[]}},emits:["close","created"],setup(S,{emit:_}){const $=_,M=S,{templateId:b,sourceSlideIds:c}=P(M),r=V({title:"",type:"audit_report",presentable_type:"App\\Models\\Client",presentable_id:null}),p=d(!1),u=d(""),y=d([]),i=d(null),k=d(""),m=d("all");g(i,l=>{if(!l){r.presentable_id=null;return}const[e,t]=String(l).split(":");r.presentable_id=Number(t),r.presentable_type=e==="lead"?"App\\Models\\Lead":"App\\Models\\Client"}),g(m,()=>{f()});async function f(){const l=k.value.toLowerCase(),e=m.value==="all"?["client","lead"]:[m.value];let t=[];for(const s of e)try{const o=await window.axios.get(`/api/source-models/${s}`),h=(Array.isArray(o==null?void 0:o.data)?o.data:[]).map(n=>{const v=n.name||[n.first_name,n.last_name].filter(Boolean).join(" ")||n.company||n.email||`#${n.id}`,L=[v,n.company,n.email].filter(Boolean).join(" ").toLowerCase();return{value:`${s}:${n.id}`,label:`[${s==="client"?"Client":"Lead"}] ${v}`,_hay:L}});t=t.concat(h)}catch{}if(l&&(t=t.filter(s=>s._hay.includes(l))),t=t.slice(0,50),i.value&&!t.find(s=>s.value===i.value)){const[s,o]=String(i.value).split(":");t.unshift({value:i.value,label:`[${s==="client"?"Client":"Lead"}] #${o}`})}y.value=t}f();async function A(){var e,t;p.value=!0,u.value="";const l={...r};b.value&&(l.template_id=b.value),c.value&&c.value.length&&(l.source_slide_ids=c.value),l.presentable_type==="App\\\\Models\\\\Client"&&(l.presentable_type="App\\Models\\Client"),l.presentable_type==="App\\\\Models\\\\Lead"&&(l.presentable_type="App\\Models\\Lead");try{const s=await E.create(l);F("Presentation created"),$("created",s)}catch(s){const o=((t=(e=s==null?void 0:s.response)==null?void 0:e.data)==null?void 0:t.message)||"Failed to create presentation";u.value=o,R(o)}finally{p.value=!1}}return(l,e)=>(x(),B(H,{show:!0,onClose:e[4]||(e[4]=t=>l.$emit("close")),"aria-label":"Create presentation modal"},{default:N(()=>[a("div",Q,[e[10]||(e[10]=a("h2",{class:"text-xl font-bold mb-1"},"Create Presentation",-1)),u.value?(x(),D("p",z,w(u.value),1)):I("",!0),a("form",{onSubmit:j(A,["prevent"])},[a("div",G,[e[5]||(e[5]=a("label",{class:"block text-sm font-medium text-gray-600 mb-1"},"Title",-1)),C(a("input",{"onUpdate:modelValue":e[0]||(e[0]=t=>r.title=t),type:"text",class:"w-full border border-gray-200 rounded-lg p-2 focus:ring-2 focus:ring-indigo-500",required:"",autofocus:"","aria-label":"Presentation title"},null,512),[[q,r.title]])]),a("div",J,[e[7]||(e[7]=a("label",{class:"block text-sm font-medium text-gray-600 mb-1"},"Type",-1)),C(a("select",{"onUpdate:modelValue":e[1]||(e[1]=t=>r.type=t),class:"w-full border border-gray-200 rounded-lg p-2 focus:ring-2 focus:ring-indigo-500","aria-label":"Presentation type"},e[6]||(e[6]=[a("option",{value:"audit_report"},"Audit Report",-1),a("option",{value:"proposal"},"Proposal",-1)]),512),[[T,r.type]])]),a("div",K,[e[8]||(e[8]=a("label",{class:"block text-sm font-medium text-gray-600 mb-1"},"Link to Client or Lead",-1)),U(O,{modelValue:i.value,"onUpdate:modelValue":e[2]||(e[2]=t=>i.value=t),options:y.value,placeholder:"Search clients and leads...","aria-label":"Search and select client or lead"},null,8,["modelValue","options"]),e[9]||(e[9]=a("p",{class:"text-xs text-gray-500 mt-1"},"Start typing to search by client/lead name, company, or email.",-1))]),a("div",W,[a("button",{type:"button",onClick:e[3]||(e[3]=t=>l.$emit("close")),class:"px-4 py-2 bg-gray-200 rounded-lg hover:bg-gray-300 transition-colors","aria-label":"Cancel"},"Cancel"),a("button",{type:"submit",class:"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors disabled:opacity-75",disabled:p.value,"aria-label":"Save presentation"},w(p.value?"Saving...":"Save"),9,X)])],32)])]),_:1}))}};export{oe as default};
