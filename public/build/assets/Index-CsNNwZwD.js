import{B as Oe,r as u,s as K,D as $e,p as le,A as Pe,J as De,h as r,o as l,e as a,u as C,q as Me,a as d,b as s,f as g,k as c,K as N,t as v,F,i as Q,c as Y,g as w,d as re,v as X,m as ie}from"./app-DaTLmF6T.js";import{_ as Re,e as U,s as B}from"./AuthenticatedLayout-Be7_OTAN.js";import{_ as ue}from"./ProjectForm-rYyNz3nD.js";import{P as O}from"./PrimaryButton-Cfz9HMCn.js";import{D as de}from"./DangerButton-CpK8mq_V.js";import{_ as S,a as Z}from"./SecondaryButton-CmeBmfuE.js";import{_ as $,a as ee}from"./TextInput-B5TNuEGy.js";import{_ as P}from"./InputError-B77Jqksi.js";import{_ as Ae}from"./NotesModal-D2onUYJH.js";import"./ApplicationLogo-Bw7cz6qK.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./Checkbox-CSEksQkg.js";const Te={class:"py-12"},Ve={class:"max-w-12xl mx-auto sm:px-6 lg:px-12"},Ie={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},Ne={class:"p-6 text-gray-900"},Ue={class:"mb-6"},Se={key:0,class:"text-gray-600"},Ee={key:1,class:"text-red-600"},We={key:2,class:"text-gray-600"},Fe={key:3},Ye={class:"min-w-full divide-y divide-gray-200"},Be={class:"bg-white divide-y divide-gray-200"},qe={class:"px-6 py-4 whitespace-nowrap"},Ge={class:"px-6 py-4"},Le={key:0},ze={key:1,class:"text-gray-400"},He={class:"px-6 py-4 whitespace-nowrap capitalize"},Je={class:"px-6 py-4"},Ke={key:0},Qe={key:1,class:"text-gray-400"},Xe={class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium"},Ze={class:"flex items-center space-x-2"},et={class:"p-6"},tt={key:0,class:"mt-4 text-gray-800"},st={key:0},ot={key:1,class:"text-red-600 text-sm mb-4"},at={class:"mt-6 flex justify-end"},nt={class:"p-6"},lt={key:0,class:"text-red-600 text-sm mb-4"},rt={class:"mb-4"},it={class:"mb-4"},ut={class:"mb-4"},dt={key:0,class:"mb-4"},pt=["value"],ct={key:1,class:"mb-4"},vt={class:"mt-6 flex justify-end"},mt={class:"p-6"},ft={key:0,class:"text-red-600 text-sm mb-4"},_t={class:"mb-4"},yt=["value"],gt={class:"mt-6 flex justify-end"},At={__name:"Index",setup(xt){const D=Oe(),f=u([]),pe=u([]),ce=u([]),q=u([]),G=u(!0),p=u({}),n=u(""),b=u(!1),j=u(!1),M=u(!1),R=u(!1),L=u(!1),E=u(!1),W=u({}),i=K({project_id:null,description:"",amount:"",user_id:null,hours_spent:"",type:"expense"}),z=K({project_id:null,content:""}),A=K({project_id:null,payment_type:"one_off"}),y=u(null),ve=u(null),{canDo:_,canView:me}=$e();le(()=>D.value?D.value.role_data&&D.value.role_data.slug==="super-admin"||D.value.role==="super_admin"||D.value.role==="super-admin":!1),_("create_projects");const fe=le(()=>me("projects").value),_e=_("manage_projects"),te=[{value:"active",label:"Active"},{value:"completed",label:"Completed"},{value:"on_hold",label:"On Hold"},{value:"archived",label:"Archived"}],se=[{value:"Website Designing",label:"Website Designing"},{value:"SEO",label:"SEO"},{value:"Social Media",label:"Social Media"},{value:"Content Writing",label:"Content Writing"},{value:"Graphic Design",label:"Graphic Design"}],oe=[{value:"UpWork",label:"UpWork"},{value:"Direct",label:"Direct Client"},{value:"Wix Marketplace",label:"Wix Marketplace"},{value:"Referral",label:"Referral"}],h=u([]),T=u([]),ye=async()=>{try{const o=await ie.get("/api/roles?type=client");h.value=o.data.map(t=>({value:t.id,label:t.name}));const e=await ie.get("/api/roles?type=project");T.value=e.data.map(t=>({value:t.id,label:t.name}))}catch(o){console.error("Error fetching roles:",o),h.value=[{value:1,label:"Client Admin"},{value:2,label:"Client User"},{value:3,label:"Client Viewer"}],T.value=[{value:1,label:"Project Manager"},{value:2,label:"Project Member"},{value:3,label:"Project Viewer"}]}},H=[{value:"one_off",label:"One-Off"},{value:"monthly",label:"Monthly"}],ae=[{value:"website_design",label:"Website Design"},{value:"seo",label:"SEO"},{value:"social_media",label:"Social Media"},{value:"content_writing",label:"Content Writing"},{value:"graphic_design",label:"Graphic Design"}],V=async()=>{G.value=!0,n.value="";try{const o=await window.axios.get("/api/projects");if(f.value=o.data,_e.value){const e=await window.axios.get("/api/clients");pe.value=e.data.data;const t=await window.axios.get("/api/users");ce.value=t.data}}catch(o){n.value="Failed to load data.",console.error("Error fetching initial data:",o),o.response&&(o.response.status===401||o.response.status===403)&&(n.value="You are not authorized to view this content or your session expired. Please log in.")}finally{G.value=!1}},ge=()=>{if(!_("create_projects").value){U("You do not have permission to create projects.");return}W.value={},b.value=!0},xe=o=>{if(!_("manage_projects").value){U("You do not have permission to edit this project.");return}W.value=o,j.value=!0},ne=o=>{const e=f.value.findIndex(t=>t.id===o.id);e!==-1?f.value[e]=o:f.value.push(o),b.value=!1,j.value=!1,B(o.id?"Project updated successfully!":"Project created successfully!"),V()},we=o=>{if(!_("delete_projects").value){U("You do not have permission to delete this project.");return}y.value=o,M.value=!0},be=async()=>{var e;n.value="";const o=(e=y.value)==null?void 0:e.id;if(!o){n.value="Invalid project.";return}if(!_("delete_projects").value){n.value="You do not have permission to delete this project.";return}try{await window.axios.delete(`/api/projects/${o}`),f.value=f.value.filter(t=>t.id!==o),M.value=!1,y.value=null,B("Project deleted successfully!")}catch(t){n.value="Failed to delete project.",t.response&&t.response.data.message&&(n.value=t.response.data.message),console.error("Error deleting project:",t)}},je=async o=>{if(!_("manage_project_transactions").value){U("You do not have permission to add transactions to this project.");return}const e=o.id;if(!e){console.error("No project ID found in project object:",o);return}i.project_id=e,i.description="",i.amount="",i.user_id=null,i.hours_spent="",i.type="expense",p.value={},n.value="";try{const t=await window.axios.get(`/api/projects/${e}`);q.value=t.data.users||[]}catch(t){console.error("Error fetching project users:",t),q.value=[]}R.value=!0},he=async()=>{p.value={},n.value="";const o=i.project_id;if(!o){n.value="Invalid project.";return}if(!_("manage_project_transactions").value){n.value="You do not have permission to add transactions to this project.";return}try{await window.axios.post(`/api/projects/${o}/expenses`,{expenses:[i]}),R.value=!1,B("Transaction added successfully!"),V()}catch(e){e.response&&e.response.status===422?p.value=e.response.data.errors:e.response&&e.response.data.message?n.value=e.response.data.message:(n.value="Failed to add transaction.",console.error("Error adding transaction:",e))}},ke=o=>{if(!_("add_project_notes").value){U("You do not have permission to add notes to this project.");return}const e=o.id;if(!e){console.error("No project ID found in project object:",o);return}z.project_id=e,z.content="",p.value={},n.value="",L.value=!0},Ce=async()=>{n.value="";const o=A.project_id;if(!o){n.value="Invalid project.";return}if(!_("manage_project_services_and_payments").value){n.value="You do not have permission to convert payment type for this project.";return}try{await window.axios.post(`/api/projects/${o}/convert-payment-type`,{payment_type:A.payment_type});const e=f.value.findIndex(t=>t.id===o);e!==-1&&(f.value[e].payment_type=A.payment_type),E.value=!1,ve.value=null,B("Payment type converted successfully!"),V()}catch(e){n.value="Failed to convert payment type.",e.response&&e.response.data.message&&(n.value=e.response.data.message),console.error("Error converting payment type:",e)}};return Pe(()=>{if(!fe.value){window.location.href=route("dashboard");return}V(),ye();const o=document.querySelector("#app").__vue_app__;o&&De(o)}),(o,e)=>(l(),r(F,null,[a(C(Me),{title:"Projects"}),a(Re,null,{header:d(()=>e[17]||(e[17]=[s("h2",{class:"font-semibold text-xl text-gray-800 leading-tight"},"Projects",-1)])),default:d(()=>[s("div",Te,[s("div",Ve,[s("div",Ie,[s("div",Ne,[e[24]||(e[24]=s("h3",{class:"text-2xl font-bold mb-4"},"Project List",-1)),g((l(),r("div",Ue,[a(O,{onClick:ge},{default:d(()=>e[18]||(e[18]=[c(" Create New Project ")])),_:1,__:[18]})])),[[C(N),"create_projects"]]),G.value?(l(),r("div",Se,"Loading projects...")):n.value?(l(),r("div",Ee,v(n.value),1)):f.value.length===0?(l(),r("div",We,"No projects found.")):(l(),r("div",Fe,[s("table",Ye,[e[23]||(e[23]=s("thead",{class:"bg-gray-50"},[s("tr",null,[s("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Name"),s("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Clients"),s("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Status"),s("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Assigned Users"),s("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Actions")])],-1)),s("tbody",Be,[(l(!0),r(F,null,Q(f.value,t=>(l(),r("tr",{key:t.id},[s("td",qe,v(t.name),1),s("td",Ge,[t.clients&&t.clients.length?(l(),r("span",Le,v(t.clients.map(m=>{const k=m.pivot.role_id,x=h.value.find(J=>J.value===k),I=x?x.label:"Unknown Role";return`${m.name} (${I})`}).join(", ")),1)):(l(),r("span",ze,"None"))]),s("td",He,v(t.status.replace("_"," ")),1),s("td",Je,[t.users&&t.users.length?(l(),r("span",Ke,v(t.users.map(m=>{const k=m.pivot.role_id,x=T.value.find(J=>J.value===k),I=x?x.label:"Unknown Role";return`${m.name} (${I})`}).join(", ")),1)):(l(),r("span",Qe,"None"))]),s("td",Xe,[s("div",Ze,[g((l(),Y(O,{onClick:m=>xe(t)},{default:d(()=>e[19]||(e[19]=[c("Edit")])),_:2,__:[19]},1032,["onClick"])),[[C(N),"manage_projects"]]),g((l(),Y(O,{onClick:m=>je(t)},{default:d(()=>e[20]||(e[20]=[c("Add Transactions")])),_:2,__:[20]},1032,["onClick"])),[[C(N),"manage_project_transactions"]]),g((l(),Y(O,{onClick:m=>ke(t)},{default:d(()=>e[21]||(e[21]=[c("Add Note")])),_:2,__:[21]},1032,["onClick"])),[[C(N),"add_project_notes"]]),g((l(),Y(de,{onClick:m=>we(t)},{default:d(()=>e[22]||(e[22]=[c("Delete")])),_:2,__:[22]},1032,["onClick"])),[[C(N),"delete_projects"]])])])]))),128))])])]))])])])]),a(S,{show:b.value,onClose:e[1]||(e[1]=t=>b.value=!1)},{default:d(()=>[a(ue,{show:b.value,project:W.value,statusOptions:te,serviceOptions:ae,departmentOptions:se,sourceOptions:oe,clientRoleOptions:h.value,userRoleOptions:T.value,paymentTypeOptions:H,onClose:e[0]||(e[0]=t=>b.value=!1),onSubmit:ne},null,8,["show","project","clientRoleOptions","userRoleOptions"])]),_:1},8,["show"]),a(S,{show:j.value,onClose:e[3]||(e[3]=t=>j.value=!1)},{default:d(()=>[a(ue,{show:j.value,project:W.value,statusOptions:te,serviceOptions:ae,departmentOptions:se,sourceOptions:oe,clientRoleOptions:h.value,userRoleOptions:T.value,paymentTypeOptions:H,onClose:e[2]||(e[2]=t=>j.value=!1),onSubmit:ne},null,8,["show","project","clientRoleOptions","userRoleOptions"])]),_:1},8,["show"]),a(S,{show:M.value,onClose:e[5]||(e[5]=t=>M.value=!1)},{default:d(()=>[s("div",et,[e[28]||(e[28]=s("h2",{class:"text-lg font-medium text-gray-900"}," Are you sure you want to delete this project? ",-1)),e[29]||(e[29]=s("p",{class:"mt-1 text-sm text-gray-600"}," This action cannot be undone. All associated conversations and emails will also be deleted. ",-1)),y.value?(l(),r("div",tt,[e[25]||(e[25]=s("strong",null,"Project:",-1)),c(" "+v(y.value.name)+" ",1),y.value.clients&&y.value.clients.length?(l(),r("span",st," (Clients: "+v(y.value.clients.map(t=>{const m=t.pivot.role_id,k=h.value.find(I=>I.value===m),x=k?k.label:"Unknown Role";return`${t.name} (${x})`}).join(", "))+") ",1)):w("",!0)])):w("",!0),n.value?(l(),r("div",ot,v(n.value),1)):w("",!0),s("div",at,[a(Z,{onClick:e[4]||(e[4]=t=>M.value=!1)},{default:d(()=>e[26]||(e[26]=[c("Cancel")])),_:1,__:[26]}),a(de,{class:"ms-3",onClick:be},{default:d(()=>e[27]||(e[27]=[c("Delete Project")])),_:1,__:[27]})])])]),_:1},8,["show"]),a(S,{show:R.value,onClose:e[12]||(e[12]=t=>R.value=!1)},{default:d(()=>[s("div",nt,[e[34]||(e[34]=s("h2",{class:"text-lg font-medium text-gray-900 mb-4"},"Add Transactions",-1)),n.value?(l(),r("div",lt,v(n.value),1)):w("",!0),s("form",{onSubmit:re(he,["prevent"])},[s("div",rt,[a($,{for:"transaction_type",value:"Type"}),g(s("select",{id:"transaction_type",class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full","onUpdate:modelValue":e[6]||(e[6]=t=>i.type=t)},e[30]||(e[30]=[s("option",{value:"income"},"Income",-1),s("option",{value:"expense"},"Expense",-1)]),512),[[X,i.type]]),a(P,{message:p.value["expenses.0.type"]?p.value["expenses.0.type"][0]:"",class:"mt-2"},null,8,["message"])]),s("div",it,[a($,{for:"transaction_description",value:"Description"}),a(ee,{id:"transaction_description",type:"text",class:"mt-1 block w-full",modelValue:i.description,"onUpdate:modelValue":e[7]||(e[7]=t=>i.description=t),required:""},null,8,["modelValue"]),a(P,{message:p.value["expenses.0.description"]?p.value["expenses.0.description"][0]:"",class:"mt-2"},null,8,["message"])]),s("div",ut,[a($,{for:"transaction_amount",value:"Amount"}),a(ee,{id:"transaction_amount",type:"number",step:"0.01",class:"mt-1 block w-full",modelValue:i.amount,"onUpdate:modelValue":e[8]||(e[8]=t=>i.amount=t),required:""},null,8,["modelValue"]),a(P,{message:p.value["expenses.0.amount"]?p.value["expenses.0.amount"][0]:"",class:"mt-2"},null,8,["message"])]),i.type==="expense"?(l(),r("div",dt,[a($,{for:"transaction_user_id",value:"User (Optional)"}),g(s("select",{id:"transaction_user_id",class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full","onUpdate:modelValue":e[9]||(e[9]=t=>i.user_id=t)},[e[31]||(e[31]=s("option",{value:"",disabled:""},"Select User",-1)),(l(!0),r(F,null,Q(q.value,t=>(l(),r("option",{key:t.id,value:t.id},v(t.name),9,pt))),128))],512),[[X,i.user_id]]),a(P,{message:p.value["expenses.0.user_id"]?p.value["expenses.0.user_id"][0]:"",class:"mt-2"},null,8,["message"])])):w("",!0),i.type==="expense"?(l(),r("div",ct,[a($,{for:"transaction_hours_spent",value:"Hours Spent (Optional)"}),a(ee,{id:"transaction_hours_spent",type:"number",step:"0.01",class:"mt-1 block w-full",modelValue:i.hours_spent,"onUpdate:modelValue":e[10]||(e[10]=t=>i.hours_spent=t)},null,8,["modelValue"]),a(P,{message:p.value["expenses.0.hours_spent"]?p.value["expenses.0.hours_spent"][0]:"",class:"mt-2"},null,8,["message"])])):w("",!0),s("div",vt,[a(Z,{onClick:e[11]||(e[11]=t=>R.value=!1)},{default:d(()=>e[32]||(e[32]=[c("Cancel")])),_:1,__:[32]}),a(O,{class:"ms-3",type:"submit"},{default:d(()=>e[33]||(e[33]=[c("Add Transaction")])),_:1,__:[33]})])],32)])]),_:1},8,["show"]),a(Ae,{show:L.value,"project-id":z.project_id,onClose:e[13]||(e[13]=t=>L.value=!1),onNoteAdded:V},null,8,["show","project-id"]),a(S,{show:E.value,onClose:e[16]||(e[16]=t=>E.value=!1)},{default:d(()=>[s("div",mt,[e[37]||(e[37]=s("h2",{class:"text-lg font-medium text-gray-900 mb-4"},"Convert Payment Type",-1)),n.value?(l(),r("div",ft,v(n.value),1)):w("",!0),s("form",{onSubmit:re(Ce,["prevent"])},[s("div",_t,[a($,{for:"convert_payment_type",value:"Payment Type"}),g(s("select",{id:"convert_payment_type",class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full","onUpdate:modelValue":e[14]||(e[14]=t=>A.payment_type=t),required:""},[(l(),r(F,null,Q(H,t=>s("option",{key:t.value,value:t.value},v(t.label),9,yt)),64))],512),[[X,A.payment_type]]),a(P,{message:p.value.payment_type?p.value.payment_type[0]:"",class:"mt-2"},null,8,["message"])]),s("div",gt,[a(Z,{onClick:e[15]||(e[15]=t=>E.value=!1)},{default:d(()=>e[35]||(e[35]=[c("Cancel")])),_:1,__:[35]}),a(O,{class:"ms-3",type:"submit"},{default:d(()=>e[36]||(e[36]=[c("Convert")])),_:1,__:[36]})])],32)])]),_:1},8,["show"])]),_:1})],64))}};export{At as default};
