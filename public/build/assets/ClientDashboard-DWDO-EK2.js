import J from"./BaseModal-CMHnuv43.js";import Q from"./LoadingOverlay-DQXKx715.js";import W from"./Sidebar-CxmIFK9D.js";import X from"./HomeSection-DUo9lTcw.js";import Y from"./TicketsSection-DSUsiQ4x.js";import Z from"./ApprovalsSection-Dr2niuCO.js";import _ from"./DocumentsSection-yyj3zNH8.js";import ee from"./InvoicesSection-C1cs8YQT.js";import te from"./AnnouncementsSection-BjKcxqzP.js";import ae from"./DeliverableViewerModal-DPbB0_DT.js";import oe from"./ResourceSection-BscRqK5c.js";import ne from"./SEOReport-H_Rix76q.js";import{_ as ie}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as o,s as le,B as se,C as U,i as R,o as l,e as A,g as s,b,t as re,c as d,D as ue}from"./app-CDZTuHuD.js";import"./auto-yb1cLV1l.js";import"./TicketNotesSidebar-Gc75EUYx.js";import"./CreateTaskModal-Bs_mmU0l.js";const ce={class:"bg-gray-100 flex min-h-screen font-sans"},de={key:0,class:"fixed inset-0 bg-red-100 bg-opacity-90 flex items-center justify-center z-50 p-4"},ve={class:"bg-white p-8 rounded-lg shadow-xl text-red-700 max-w-lg w-full text-center"},pe={class:"mb-6 whitespace-pre-line"},me={__name:"ClientDashboard",props:{initialAuthToken:{type:String,default:""},projectId:{type:[String,Number],required:!0}},setup(n){const r=n,k=o(!0),z=o("client-user"),i=o("home"),w=o(!1),O=o(null),x=o(!1),v=o(!1),$=o(""),B=o(""),E=o([]),D=o(null),y=o([]),m=o([]),M=o([]),h=o([]),j=o([]),V=o([]),f=o([]),I=o([]),u=o(null),S=o({}),P=le(()=>({marginLeft:w.value?"16rem":"4rem"})),N=a=>{O.value=a,x.value=!0},g=async(a,t)=>{try{const e=await fetch(`/api/client-api/${a}`,{headers:{Authorization:`Bearer ${r.initialAuthToken}`,"Content-Type":"application/json",Accept:"application/json"}});if(!e.ok){const T=await e.json();throw new Error(T.message||`Failed to fetch data from ${a}.`)}const c=await e.json();t.value=c}catch(e){console.error(`Error fetching from ${a}:`,e),u.value=u.value?u.value+`
${e.message}`:e.message}},q=(a,t,e,c=null,T=null)=>{$.value=a,B.value=t,D.value=T;const C=[];e==="alert"?C.push({label:"OK",className:"bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700",onClick:()=>v.value=!1}):e==="confirm"&&C.push({label:"Cancel",className:"bg-gray-300 text-gray-800 py-2 px-4 rounded-lg hover:bg-gray-400",onClick:()=>v.value=!1},{label:"Confirm",className:"bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700",onClick:()=>{c&&c(),v.value=!1}}),E.value=C,v.value=!0},F=()=>{v.value=!1,D.value=null},p=async a=>{console.log("Simulating adding activity:",a);const t={id:Date.now(),description:a,date:new Date().toISOString()};y.value.unshift(t),y.value=y.value.slice(0,10)},H=async a=>{m.value.unshift(a),m.value.sort((t,e)=>new Date(e.date).getTime()-new Date(t.date).getTime())},L=async(a,t)=>{const e=f.value.findIndex(c=>c.id===a);e!==-1&&(f.value[e].status=t)},K=async a=>{console.log("Simulating adding document:",a),h.value.unshift(a),h.value.sort((t,e)=>new Date(e.uploadDate).getTime()-new Date(t.uploadDate).getTime())},G=async(a,t)=>{console.log(`Simulating updating invoice ${a} to ${t}`);const e=j.value.findIndex(c=>c.id===a);e!==-1&&(j.value[e].status=t)};return se(async()=>{if(k.value=!0,u.value=null,!r.initialAuthToken||!r.projectId){u.value="Authentication token or Project ID missing. Cannot load dashboard.",k.value=!1;return}await Promise.all([g(`project/${r.projectId}/tasks`,m),g(`project/${r.projectId}/documents`,h),g(`project/${r.projectId}/deliverables`,f),g(`project/${r.projectId}/shareable-resources`,I),g(`project/${r.projectId}`,S)]),k.value=!1}),U("modalService",{showModal:q}),U("activityService",{addActivity:p}),(a,t)=>(l(),R("div",ce,[A(Q,{isLoading:k.value},null,8,["isLoading"]),u.value?(l(),R("div",de,[b("div",ve,[t[4]||(t[4]=b("h3",{class:"text-2xl font-bold mb-4"},"Error Loading Dashboard",-1)),b("p",pe,re(u.value),1),b("button",{onClick:t[0]||(t[0]=e=>u.value=null),class:"bg-red-600 text-white py-2 px-4 rounded-lg hover:bg-red-700"},"Dismiss")])])):s("",!0),A(W,{userId:z.value,activeSection:i.value,isExpanded:w.value,onSectionChange:t[1]||(t[1]=e=>i.value=e),"onUpdate:isExpanded":t[2]||(t[2]=e=>w.value=e)},null,8,["userId","activeSection","isExpanded"]),b("div",{class:"flex-1 p-8 overflow-y-auto main-content",style:ue(P.value)},[i.value==="home"?(l(),d(X,{key:0,activities:y.value,tickets:m.value,approvals:M.value,documents:h.value,invoices:j.value,announcements:V.value,deliverables:f.value,shareableResources:I.value,onOpenDeliverableViewer:N,"project-data":S.value},null,8,["activities","tickets","approvals","documents","invoices","announcements","deliverables","shareableResources","project-data"])):s("",!0),i.value==="seo"?(l(),d(ne,{key:1,"project-id":n.projectId,"initial-auth-token":n.initialAuthToken},null,8,["project-id","initial-auth-token"])):s("",!0),i.value==="tickets"?(l(),d(Y,{key:2,"project-id":n.projectId,"initial-auth-token":n.initialAuthToken,tickets:m.value,onAddTicket:H,onAddActivity:p},null,8,["project-id","initial-auth-token","tickets"])):s("",!0),i.value==="approvals"?(l(),d(Z,{key:3,onOpenDeliverableViewer:N,deliverables:f.value,"initial-auth-token":n.initialAuthToken,"project-id":n.projectId,approvals:M.value,onUpdateApproval:L,onAddActivity:p},null,8,["deliverables","initial-auth-token","project-id","approvals"])):s("",!0),i.value==="documents"?(l(),d(_,{key:4,"project-data":S.value,"project-id":n.projectId,"initial-auth-token":n.initialAuthToken,documents:h.value,onAddDocument:K,onAddActivity:p},null,8,["project-data","project-id","initial-auth-token","documents"])):s("",!0),i.value==="resources"?(l(),d(oe,{key:5,"project-id":n.projectId,"initial-auth-token":n.initialAuthToken,"shareable-resources":I.value,onAddActivity:p},null,8,["project-id","initial-auth-token","shareable-resources"])):s("",!0),i.value==="invoices"?(l(),d(ee,{key:6,invoices:j.value,onUpdateInvoice:G,onAddActivity:p},null,8,["invoices"])):s("",!0),i.value==="announcements"?(l(),d(te,{key:7,announcements:V.value},null,8,["announcements"])):s("",!0)],4),A(J,{isOpen:v.value,title:$.value,message:B.value,buttons:E.value,children:D.value,onClose:F},null,8,["isOpen","title","message","buttons","children"]),A(ae,{isOpen:x.value,"onUpdate:isOpen":t[3]||(t[3]=e=>x.value=e),deliverable:O.value,initialAuthToken:n.initialAuthToken,projectId:n.projectId,onDeliverableActionSuccess:L},null,8,["isOpen","deliverable","initialAuthToken","projectId"])]))}},Be=ie(me,[["__scopeId","data-v-62748815"]]);export{Be as default};
