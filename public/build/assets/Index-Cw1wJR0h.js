import{c as b,r as y,f as F,a as p,o as x,b as t,i as I,d,w as u,m,v as n,x as i,F as U,l as $,t as f,G as T,u as A,J as N,N as V,M as G}from"./app-DbT8OS6U.js";import{_ as W}from"./Modal-xyQrtzGU.js";import{_ as P}from"./PrimaryButton-CNNIkbnD.js";import{_ as j}from"./SecondaryButton-Dwoi8T9i.js";import{u as q}from"./workflowStore-DZJsW282.js";const z={class:"p-4 space-y-4"},H={class:"flex items-center justify-between"},K={class:"flex items-center gap-2"},Q={key:0,class:"text-sm text-gray-500"},R={class:"flex items-center justify-between px-3 py-2 bg-gray-50 border-b"},X={class:"font-medium text-gray-800"},Y={class:"flex items-center gap-2"},Z={class:"divide-y"},h={class:"text-sm font-medium"},ee={class:"text-xs text-gray-500"},te={class:"text-xs text-gray-500 truncate max-w-[60ch]"},se={class:"flex items-center gap-2"},ae=["onClick"],oe={class:"p-4"},le={class:"flex items-center justify-between mb-2"},ne={class:"text-base font-semibold"},re={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},ie={class:"md:col-span-2"},de={class:"mt-4 flex justify-end gap-2"},ce={__name:"Index",setup(ue){const v=q();b(()=>v.isLoading);const S=b(()=>v.prompts||[]),w=y(""),D=b(()=>{const a=(w.value||"").toLowerCase();return a?S.value.filter(e=>(e.name||"").toLowerCase().includes(a)||(e.category||"").toLowerCase().includes(a)||(e.system_prompt_text||"").toLowerCase().includes(a)):S.value}),M=b(()=>{const a=new Map;for(const e of D.value){const s=e.name||"Untitled";a.has(s)||a.set(s,[]),a.get(s).push(e)}for(const e of a.values())e.sort((s,l)=>(l.version??0)-(s.version??0));return Array.from(a.entries()).map(([e,s])=>({name:e,versions:s}))});F(async()=>{await v.fetchPrompts()});const c=y(!1),_=y(!1),g=y(null),o=y({name:"",category:"",version:1,system_prompt_text:"",model_name:"",generation_config:{},template_variables:{},generation_config_json:"",template_variables_json:"",status:"active"}),C=(a="")=>{_.value=!1,g.value=null,o.value={name:a||"",category:"",version:1,system_prompt_text:"",model_name:"",generation_config:{},template_variables:{},status:"active"},c.value=!0},J=(a,e)=>{C(a),o.value.version=(e??0)+1},L=a=>{_.value=!0,g.value=a.id,o.value={name:a.name||"",category:a.category||"",version:a.version??1,system_prompt_text:a.system_prompt_text||"",model_name:a.model_name||"",generation_config:a.generation_config||{},template_variables:a.template_variables||{},status:a.status||"active"},c.value=!0},k=()=>{c.value=!1},E=async()=>{var a,e;try{_.value&&g.value?await v.updatePrompt(g.value,o.value)&&V("Prompt updated"):await v.createPrompt(o.value)&&V("Prompt created"),c.value=!1}catch(s){const l=((e=(a=s==null?void 0:s.response)==null?void 0:a.data)==null?void 0:e.message)||"Failed to save prompt";N(l)}},O=async a=>{var s,l;if(await G(`Delete prompt "${a.name}" v${a.version}?`,{confirmText:"Delete"}))try{await v.deletePrompt(a.id),V("Prompt deleted")}catch(r){const B=((l=(s=r==null?void 0:r.response)==null?void 0:s.data)==null?void 0:l.message)||"Failed to delete prompt";N(B)}};return(a,e)=>(x(),p("div",z,[t("div",H,[e[12]||(e[12]=t("h1",{class:"text-lg font-semibold"},"Prompts",-1)),d(P,{onClick:e[0]||(e[0]=s=>C())},{default:u(()=>e[11]||(e[11]=[m("New Prompt",-1)])),_:1,__:[11]})]),t("div",K,[n(t("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>w.value=s),type:"text",placeholder:"Search...",class:"border rounded px-2 py-1 text-sm w-full md:w-1/2"},null,512),[[i,w.value]])]),M.value.length===0?(x(),p("div",Q,"No prompts found.")):I("",!0),(x(!0),p(U,null,$(M.value,s=>(x(),p("div",{key:s.name,class:"border rounded mb-3"},[t("div",R,[t("div",X,f(s.name),1),t("div",Y,[d(j,{onClick:l=>{var r;return J(s.name,(r=s.versions[0])==null?void 0:r.version)}},{default:u(()=>e[13]||(e[13]=[m("New Version",-1)])),_:2,__:[13]},1032,["onClick"]),d(P,{onClick:l=>C(s.name)},{default:u(()=>e[14]||(e[14]=[m("Duplicate",-1)])),_:2,__:[14]},1032,["onClick"])])]),t("div",Z,[(x(!0),p(U,null,$(s.versions,l=>(x(),p("div",{key:l.id,class:"px-3 py-2 flex items-center justify-between"},[t("div",null,[t("div",h,[m("v"+f(l.version)+" ",1),t("span",ee,f(l.status||"active"),1)]),t("div",te,f(l.system_prompt_text),1)]),t("div",se,[d(j,{onClick:r=>L(l)},{default:u(()=>e[15]||(e[15]=[m("Edit",-1)])),_:2,__:[15]},1032,["onClick"]),t("button",{onClick:r=>O(l),class:"text-xs px-2 py-1 rounded-md border text-red-600 hover:bg-red-50"},"Delete",8,ae)])]))),128))])]))),128)),d(W,{show:c.value,onClose:k,maxWidth:"3xl"},{default:u(()=>[t("div",oe,[t("div",le,[t("h2",ne,f(_.value?"Edit Prompt":"New Prompt"),1),t("button",{onClick:k,class:"text-gray-500 hover:text-gray-700"},"âœ•")]),t("div",re,[t("div",null,[e[16]||(e[16]=t("label",{class:"text-xs text-gray-600"},"Name",-1)),n(t("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>o.value.name=s),type:"text",class:"mt-1 w-full border rounded px-2 py-1 text-sm"},null,512),[[i,o.value.name]])]),t("div",null,[e[17]||(e[17]=t("label",{class:"text-xs text-gray-600"},"Category",-1)),n(t("input",{"onUpdate:modelValue":e[3]||(e[3]=s=>o.value.category=s),type:"text",class:"mt-1 w-full border rounded px-2 py-1 text-sm"},null,512),[[i,o.value.category]])]),t("div",null,[e[18]||(e[18]=t("label",{class:"text-xs text-gray-600"},"Version",-1)),n(t("input",{"onUpdate:modelValue":e[4]||(e[4]=s=>o.value.version=s),type:"number",min:"1",class:"mt-1 w-full border rounded px-2 py-1 text-sm"},null,512),[[i,o.value.version,void 0,{number:!0}]])]),t("div",null,[e[19]||(e[19]=t("label",{class:"text-xs text-gray-600"},"Model Name",-1)),n(t("input",{"onUpdate:modelValue":e[5]||(e[5]=s=>o.value.model_name=s),type:"text",class:"mt-1 w-full border rounded px-2 py-1 text-sm",placeholder:"e.g., gemini-2.0-pro"},null,512),[[i,o.value.model_name]])]),t("div",ie,[e[20]||(e[20]=t("label",{class:"text-xs text-gray-600"},"System Prompt",-1)),n(t("textarea",{"onUpdate:modelValue":e[6]||(e[6]=s=>o.value.system_prompt_text=s),rows:"6",class:"mt-1 w-full border rounded px-2 py-1 text-sm"},null,512),[[i,o.value.system_prompt_text]])]),t("div",null,[e[22]||(e[22]=t("label",{class:"text-xs text-gray-600"},"Status",-1)),n(t("select",{"onUpdate:modelValue":e[7]||(e[7]=s=>o.value.status=s),class:"mt-1 w-full border rounded px-2 py-1 text-sm"},e[21]||(e[21]=[t("option",{value:"active"},"Active",-1),t("option",{value:"inactive"},"Inactive",-1),t("option",{value:"draft"},"Draft",-1)]),512),[[T,o.value.status]])]),t("div",null,[e[23]||(e[23]=t("label",{class:"text-xs text-gray-600"},"Generation Config (JSON)",-1)),n(t("textarea",{"onUpdate:modelValue":e[8]||(e[8]=s=>o.value.generation_config_json=s),rows:"4",class:"mt-1 w-full border rounded px-2 py-1 text-xs font-mono"},null,512),[[i,o.value.generation_config_json]])]),t("div",null,[e[24]||(e[24]=t("label",{class:"text-xs text-gray-600"},"Template Variables (JSON)",-1)),n(t("textarea",{"onUpdate:modelValue":e[9]||(e[9]=s=>o.value.template_variables_json=s),rows:"4",class:"mt-1 w-full border rounded px-2 py-1 text-xs font-mono"},null,512),[[i,o.value.template_variables_json]])])]),t("div",de,[d(j,{onClick:k},{default:u(()=>e[25]||(e[25]=[m("Cancel",-1)])),_:1,__:[25]}),d(P,{onClick:e[10]||(e[10]=()=>{try{o.value.generation_config=o.value.generation_config_json?JSON.parse(o.value.generation_config_json):{},o.value.template_variables=o.value.template_variables_json?JSON.parse(o.value.template_variables_json):{}}catch{A(N)("Invalid JSON in config fields");return}E()})},{default:u(()=>[m(f(_.value?"Save Changes":"Create"),1)]),_:1})])])]),_:1},8,["show"])]))}};export{ce as default};
