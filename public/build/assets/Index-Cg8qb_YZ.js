import{B as ke,r as u,s as H,D as Ce,p as ae,A as Oe,J as $e,h as r,o as n,e as a,u as C,q as Pe,a as d,b as s,f as g,k as c,K as N,t as v,F as W,i as J,c as F,g as w,d as le,v as K,m as ne}from"./app-5D5n9o1Q.js";import{_ as De}from"./AuthenticatedLayout-BgxwBjNf.js";import{_ as re}from"./ProjectForm-DcGd_cTs.js";import{P as O}from"./PrimaryButton-BLRlwwuZ.js";import{D as ie}from"./DangerButton-BZzWv1mz.js";import{_ as U,a as Q}from"./SecondaryButton-DptR73yl.js";import{_ as $,a as X}from"./TextInput-DiKue60S.js";import{_ as P}from"./InputError-CRa9oDAN.js";import{_ as Me}from"./NotesModal-I2G-6hal.js";import"./ApplicationLogo-BDyO1mDp.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./Checkbox-BKL4dpOn.js";const Re={class:"py-12"},Ae={class:"max-w-12xl mx-auto sm:px-6 lg:px-12"},Te={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},Ve={class:"p-6 text-gray-900"},Ie={class:"mb-6"},Ne={key:0,class:"text-gray-600"},Ue={key:1,class:"text-red-600"},Se={key:2,class:"text-gray-600"},Ee={key:3},We={class:"min-w-full divide-y divide-gray-200"},Fe={class:"bg-white divide-y divide-gray-200"},Ye={class:"px-6 py-4 whitespace-nowrap"},Be={class:"px-6 py-4"},qe={key:0},Ge={key:1,class:"text-gray-400"},Le={class:"px-6 py-4 whitespace-nowrap capitalize"},ze={class:"px-6 py-4"},He={key:0},Je={key:1,class:"text-gray-400"},Ke={class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium"},Qe={class:"flex items-center space-x-2"},Xe={class:"p-6"},Ze={key:0,class:"mt-4 text-gray-800"},et={key:0},tt={key:1,class:"text-red-600 text-sm mb-4"},st={class:"mt-6 flex justify-end"},ot={class:"p-6"},at={key:0,class:"text-red-600 text-sm mb-4"},lt={class:"mb-4"},nt={class:"mb-4"},rt={class:"mb-4"},it={key:0,class:"mb-4"},ut=["value"],dt={key:1,class:"mb-4"},pt={class:"mt-6 flex justify-end"},ct={class:"p-6"},vt={key:0,class:"text-red-600 text-sm mb-4"},mt={class:"mb-4"},ft=["value"],_t={class:"mt-6 flex justify-end"},Mt={__name:"Index",setup(yt){const D=ke(),f=u([]),ue=u([]),de=u([]),Y=u([]),B=u(!0),p=u({}),l=u(""),b=u(!1),j=u(!1),M=u(!1),R=u(!1),q=u(!1),S=u(!1),E=u({}),i=H({project_id:null,description:"",amount:"",user_id:null,hours_spent:"",type:"expense"}),G=H({project_id:null,content:""}),A=H({project_id:null,payment_type:"one_off"}),y=u(null),pe=u(null),{canDo:_,canView:ce}=Ce();ae(()=>D.value?D.value.role_data&&D.value.role_data.slug==="super-admin"||D.value.role==="super_admin"||D.value.role==="super-admin":!1),_("create_projects");const ve=ae(()=>ce("projects").value),me=_("manage_projects"),Z=[{value:"active",label:"Active"},{value:"completed",label:"Completed"},{value:"on_hold",label:"On Hold"},{value:"archived",label:"Archived"}],ee=[{value:"Website Designing",label:"Website Designing"},{value:"SEO",label:"SEO"},{value:"Social Media",label:"Social Media"},{value:"Content Writing",label:"Content Writing"},{value:"Graphic Design",label:"Graphic Design"}],te=[{value:"UpWork",label:"UpWork"},{value:"Direct",label:"Direct Client"},{value:"Wix Marketplace",label:"Wix Marketplace"},{value:"Referral",label:"Referral"}],h=u([]),T=u([]),fe=async()=>{try{const o=await ne.get("/api/roles?type=client");h.value=o.data.map(t=>({value:t.id,label:t.name}));const e=await ne.get("/api/roles?type=project");T.value=e.data.map(t=>({value:t.id,label:t.name}))}catch(o){console.error("Error fetching roles:",o),h.value=[{value:1,label:"Client Admin"},{value:2,label:"Client User"},{value:3,label:"Client Viewer"}],T.value=[{value:1,label:"Project Manager"},{value:2,label:"Project Member"},{value:3,label:"Project Viewer"}]}},L=[{value:"one_off",label:"One-Off"},{value:"monthly",label:"Monthly"}],se=[{value:"website_design",label:"Website Design"},{value:"seo",label:"SEO"},{value:"social_media",label:"Social Media"},{value:"content_writing",label:"Content Writing"},{value:"graphic_design",label:"Graphic Design"}],V=async()=>{B.value=!0,l.value="";try{const o=await window.axios.get("/api/projects");if(f.value=o.data,me.value){const e=await window.axios.get("/api/clients");ue.value=e.data.data;const t=await window.axios.get("/api/users");de.value=t.data}}catch(o){l.value="Failed to load data.",console.error("Error fetching initial data:",o),o.response&&(o.response.status===401||o.response.status===403)&&(l.value="You are not authorized to view this content or your session expired. Please log in.")}finally{B.value=!1}},_e=()=>{if(!_("create_projects").value){alert("You do not have permission to create projects.");return}E.value={},b.value=!0},ye=o=>{if(!_("manage_projects").value){alert("You do not have permission to edit this project.");return}E.value=o,j.value=!0},oe=o=>{const e=f.value.findIndex(t=>t.id===o.id);e!==-1?f.value[e]=o:f.value.push(o),b.value=!1,j.value=!1,alert(o.id?"Project updated successfully!":"Project created successfully!"),V()},ge=o=>{if(!_("delete_projects").value){alert("You do not have permission to delete this project.");return}y.value=o,M.value=!0},xe=async()=>{var e;l.value="";const o=(e=y.value)==null?void 0:e.id;if(!o){l.value="Invalid project.";return}if(!_("delete_projects").value){l.value="You do not have permission to delete this project.";return}try{await window.axios.delete(`/api/projects/${o}`),f.value=f.value.filter(t=>t.id!==o),M.value=!1,y.value=null,alert("Project deleted successfully!")}catch(t){l.value="Failed to delete project.",t.response&&t.response.data.message&&(l.value=t.response.data.message),console.error("Error deleting project:",t)}},we=async o=>{if(!_("manage_project_transactions").value){alert("You do not have permission to add transactions to this project.");return}const e=o.id;if(!e){console.error("No project ID found in project object:",o);return}i.project_id=e,i.description="",i.amount="",i.user_id=null,i.hours_spent="",i.type="expense",p.value={},l.value="";try{const t=await window.axios.get(`/api/projects/${e}`);Y.value=t.data.users||[]}catch(t){console.error("Error fetching project users:",t),Y.value=[]}R.value=!0},be=async()=>{p.value={},l.value="";const o=i.project_id;if(!o){l.value="Invalid project.";return}if(!_("manage_project_transactions").value){l.value="You do not have permission to add transactions to this project.";return}try{await window.axios.post(`/api/projects/${o}/expenses`,{expenses:[i]}),R.value=!1,alert("Transaction added successfully!"),V()}catch(e){e.response&&e.response.status===422?p.value=e.response.data.errors:e.response&&e.response.data.message?l.value=e.response.data.message:(l.value="Failed to add transaction.",console.error("Error adding transaction:",e))}},je=o=>{if(!_("add_project_notes").value){alert("You do not have permission to add notes to this project.");return}const e=o.id;if(!e){console.error("No project ID found in project object:",o);return}G.project_id=e,G.content="",p.value={},l.value="",q.value=!0},he=async()=>{l.value="";const o=A.project_id;if(!o){l.value="Invalid project.";return}if(!_("manage_project_services_and_payments").value){l.value="You do not have permission to convert payment type for this project.";return}try{await window.axios.post(`/api/projects/${o}/convert-payment-type`,{payment_type:A.payment_type});const e=f.value.findIndex(t=>t.id===o);e!==-1&&(f.value[e].payment_type=A.payment_type),S.value=!1,pe.value=null,alert("Payment type converted successfully!"),V()}catch(e){l.value="Failed to convert payment type.",e.response&&e.response.data.message&&(l.value=e.response.data.message),console.error("Error converting payment type:",e)}};return Oe(()=>{if(!ve.value){window.location.href=route("dashboard");return}V(),fe();const o=document.querySelector("#app").__vue_app__;o&&$e(o)}),(o,e)=>(n(),r(W,null,[a(C(Pe),{title:"Projects"}),a(De,null,{header:d(()=>e[17]||(e[17]=[s("h2",{class:"font-semibold text-xl text-gray-800 leading-tight"},"Projects",-1)])),default:d(()=>[s("div",Re,[s("div",Ae,[s("div",Te,[s("div",Ve,[e[24]||(e[24]=s("h3",{class:"text-2xl font-bold mb-4"},"Project List",-1)),g((n(),r("div",Ie,[a(O,{onClick:_e},{default:d(()=>e[18]||(e[18]=[c(" Create New Project ")])),_:1,__:[18]})])),[[C(N),"create_projects"]]),B.value?(n(),r("div",Ne,"Loading projects...")):l.value?(n(),r("div",Ue,v(l.value),1)):f.value.length===0?(n(),r("div",Se,"No projects found.")):(n(),r("div",Ee,[s("table",We,[e[23]||(e[23]=s("thead",{class:"bg-gray-50"},[s("tr",null,[s("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Name"),s("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Clients"),s("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Status"),s("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Assigned Users"),s("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Actions")])],-1)),s("tbody",Fe,[(n(!0),r(W,null,J(f.value,t=>(n(),r("tr",{key:t.id},[s("td",Ye,v(t.name),1),s("td",Be,[t.clients&&t.clients.length?(n(),r("span",qe,v(t.clients.map(m=>{const k=m.pivot.role_id,x=h.value.find(z=>z.value===k),I=x?x.label:"Unknown Role";return`${m.name} (${I})`}).join(", ")),1)):(n(),r("span",Ge,"None"))]),s("td",Le,v(t.status.replace("_"," ")),1),s("td",ze,[t.users&&t.users.length?(n(),r("span",He,v(t.users.map(m=>{const k=m.pivot.role_id,x=T.value.find(z=>z.value===k),I=x?x.label:"Unknown Role";return`${m.name} (${I})`}).join(", ")),1)):(n(),r("span",Je,"None"))]),s("td",Ke,[s("div",Qe,[g((n(),F(O,{onClick:m=>ye(t)},{default:d(()=>e[19]||(e[19]=[c("Edit")])),_:2,__:[19]},1032,["onClick"])),[[C(N),"manage_projects"]]),g((n(),F(O,{onClick:m=>we(t)},{default:d(()=>e[20]||(e[20]=[c("Add Transactions")])),_:2,__:[20]},1032,["onClick"])),[[C(N),"manage_project_transactions"]]),g((n(),F(O,{onClick:m=>je(t)},{default:d(()=>e[21]||(e[21]=[c("Add Note")])),_:2,__:[21]},1032,["onClick"])),[[C(N),"add_project_notes"]]),g((n(),F(ie,{onClick:m=>ge(t)},{default:d(()=>e[22]||(e[22]=[c("Delete")])),_:2,__:[22]},1032,["onClick"])),[[C(N),"delete_projects"]])])])]))),128))])])]))])])])]),a(U,{show:b.value,onClose:e[1]||(e[1]=t=>b.value=!1)},{default:d(()=>[a(re,{show:b.value,project:E.value,statusOptions:Z,serviceOptions:se,departmentOptions:ee,sourceOptions:te,clientRoleOptions:h.value,userRoleOptions:T.value,paymentTypeOptions:L,onClose:e[0]||(e[0]=t=>b.value=!1),onSubmit:oe},null,8,["show","project","clientRoleOptions","userRoleOptions"])]),_:1},8,["show"]),a(U,{show:j.value,onClose:e[3]||(e[3]=t=>j.value=!1)},{default:d(()=>[a(re,{show:j.value,project:E.value,statusOptions:Z,serviceOptions:se,departmentOptions:ee,sourceOptions:te,clientRoleOptions:h.value,userRoleOptions:T.value,paymentTypeOptions:L,onClose:e[2]||(e[2]=t=>j.value=!1),onSubmit:oe},null,8,["show","project","clientRoleOptions","userRoleOptions"])]),_:1},8,["show"]),a(U,{show:M.value,onClose:e[5]||(e[5]=t=>M.value=!1)},{default:d(()=>[s("div",Xe,[e[28]||(e[28]=s("h2",{class:"text-lg font-medium text-gray-900"}," Are you sure you want to delete this project? ",-1)),e[29]||(e[29]=s("p",{class:"mt-1 text-sm text-gray-600"}," This action cannot be undone. All associated conversations and emails will also be deleted. ",-1)),y.value?(n(),r("div",Ze,[e[25]||(e[25]=s("strong",null,"Project:",-1)),c(" "+v(y.value.name)+" ",1),y.value.clients&&y.value.clients.length?(n(),r("span",et," (Clients: "+v(y.value.clients.map(t=>{const m=t.pivot.role_id,k=h.value.find(I=>I.value===m),x=k?k.label:"Unknown Role";return`${t.name} (${x})`}).join(", "))+") ",1)):w("",!0)])):w("",!0),l.value?(n(),r("div",tt,v(l.value),1)):w("",!0),s("div",st,[a(Q,{onClick:e[4]||(e[4]=t=>M.value=!1)},{default:d(()=>e[26]||(e[26]=[c("Cancel")])),_:1,__:[26]}),a(ie,{class:"ms-3",onClick:xe},{default:d(()=>e[27]||(e[27]=[c("Delete Project")])),_:1,__:[27]})])])]),_:1},8,["show"]),a(U,{show:R.value,onClose:e[12]||(e[12]=t=>R.value=!1)},{default:d(()=>[s("div",ot,[e[34]||(e[34]=s("h2",{class:"text-lg font-medium text-gray-900 mb-4"},"Add Transactions",-1)),l.value?(n(),r("div",at,v(l.value),1)):w("",!0),s("form",{onSubmit:le(be,["prevent"])},[s("div",lt,[a($,{for:"transaction_type",value:"Type"}),g(s("select",{id:"transaction_type",class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full","onUpdate:modelValue":e[6]||(e[6]=t=>i.type=t)},e[30]||(e[30]=[s("option",{value:"income"},"Income",-1),s("option",{value:"expense"},"Expense",-1)]),512),[[K,i.type]]),a(P,{message:p.value["expenses.0.type"]?p.value["expenses.0.type"][0]:"",class:"mt-2"},null,8,["message"])]),s("div",nt,[a($,{for:"transaction_description",value:"Description"}),a(X,{id:"transaction_description",type:"text",class:"mt-1 block w-full",modelValue:i.description,"onUpdate:modelValue":e[7]||(e[7]=t=>i.description=t),required:""},null,8,["modelValue"]),a(P,{message:p.value["expenses.0.description"]?p.value["expenses.0.description"][0]:"",class:"mt-2"},null,8,["message"])]),s("div",rt,[a($,{for:"transaction_amount",value:"Amount"}),a(X,{id:"transaction_amount",type:"number",step:"0.01",class:"mt-1 block w-full",modelValue:i.amount,"onUpdate:modelValue":e[8]||(e[8]=t=>i.amount=t),required:""},null,8,["modelValue"]),a(P,{message:p.value["expenses.0.amount"]?p.value["expenses.0.amount"][0]:"",class:"mt-2"},null,8,["message"])]),i.type==="expense"?(n(),r("div",it,[a($,{for:"transaction_user_id",value:"User (Optional)"}),g(s("select",{id:"transaction_user_id",class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full","onUpdate:modelValue":e[9]||(e[9]=t=>i.user_id=t)},[e[31]||(e[31]=s("option",{value:"",disabled:""},"Select User",-1)),(n(!0),r(W,null,J(Y.value,t=>(n(),r("option",{key:t.id,value:t.id},v(t.name),9,ut))),128))],512),[[K,i.user_id]]),a(P,{message:p.value["expenses.0.user_id"]?p.value["expenses.0.user_id"][0]:"",class:"mt-2"},null,8,["message"])])):w("",!0),i.type==="expense"?(n(),r("div",dt,[a($,{for:"transaction_hours_spent",value:"Hours Spent (Optional)"}),a(X,{id:"transaction_hours_spent",type:"number",step:"0.01",class:"mt-1 block w-full",modelValue:i.hours_spent,"onUpdate:modelValue":e[10]||(e[10]=t=>i.hours_spent=t)},null,8,["modelValue"]),a(P,{message:p.value["expenses.0.hours_spent"]?p.value["expenses.0.hours_spent"][0]:"",class:"mt-2"},null,8,["message"])])):w("",!0),s("div",pt,[a(Q,{onClick:e[11]||(e[11]=t=>R.value=!1)},{default:d(()=>e[32]||(e[32]=[c("Cancel")])),_:1,__:[32]}),a(O,{class:"ms-3",type:"submit"},{default:d(()=>e[33]||(e[33]=[c("Add Transaction")])),_:1,__:[33]})])],32)])]),_:1},8,["show"]),a(Me,{show:q.value,"project-id":G.project_id,onClose:e[13]||(e[13]=t=>q.value=!1),onNoteAdded:V},null,8,["show","project-id"]),a(U,{show:S.value,onClose:e[16]||(e[16]=t=>S.value=!1)},{default:d(()=>[s("div",ct,[e[37]||(e[37]=s("h2",{class:"text-lg font-medium text-gray-900 mb-4"},"Convert Payment Type",-1)),l.value?(n(),r("div",vt,v(l.value),1)):w("",!0),s("form",{onSubmit:le(he,["prevent"])},[s("div",mt,[a($,{for:"convert_payment_type",value:"Payment Type"}),g(s("select",{id:"convert_payment_type",class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full","onUpdate:modelValue":e[14]||(e[14]=t=>A.payment_type=t),required:""},[(n(),r(W,null,J(L,t=>s("option",{key:t.value,value:t.value},v(t.label),9,ft)),64))],512),[[K,A.payment_type]]),a(P,{message:p.value.payment_type?p.value.payment_type[0]:"",class:"mt-2"},null,8,["message"])]),s("div",_t,[a(Q,{onClick:e[15]||(e[15]=t=>S.value=!1)},{default:d(()=>e[35]||(e[35]=[c("Cancel")])),_:1,__:[35]}),a(O,{class:"ms-3",type:"submit"},{default:d(()=>e[36]||(e[36]=[c("Convert")])),_:1,__:[36]})])],32)])]),_:1},8,["show"])]),_:1})],64))}};export{Mt as default};
