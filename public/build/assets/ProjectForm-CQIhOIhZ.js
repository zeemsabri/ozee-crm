import{p as de,r as _,L as F,C as we,e as ne,f as me,a0 as Ce,a as r,o as n,b as e,m as E,i as w,d as s,t as $,v as fe,x as Ge,g as le,w as Y,j as Q,M as te,b1 as ot,c as J,F as ue,l as ce,s as ke,O as nt,G as Oe,y as rt,Q as it,n as Se,D as Ie,u as V,N as He,z as dt,aC as ut,b2 as ct,a3 as mt,a4 as vt,a1 as pt}from"./app-BVX1Xzgm.js";import{_ as N}from"./InputLabel-BUJhUizc.js";import{_ as G}from"./TextInput-CzwDI2b_.js";import{_ as B}from"./InputError-CFdo2J7R.js";import{_ as ae}from"./PrimaryButton-CSPVqQc4.js";import{S as Z}from"./SelectDropdown-CAzD4PBf.js";import{n as gt,T as yt,o as ft}from"./AuthenticatedLayout-Nxxzrcgy.js";import{P as bt}from"./ProjectTypeInput-CvTmlG0B.js";import{_ as wt}from"./MultiSelectDropdown-B3VcmzFf.js";import{_ as be}from"./SecondaryButton-MUG3LyAH.js";import{D as xt}from"./DangerButton-Bg47W890.js";import{_ as ht}from"./Modal-g15qzrXp.js";import{_ as _t}from"./NoticeboardModal-sriidC3u.js";import{_ as jt}from"./Checkbox-DNUuKT1u.js";import{d as kt}from"./debounce-C-hnF4Z3.js";import{_ as Pt}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{b as oe,c as ye,d as Ye,f as ee,a as Ve}from"./currency-BwKnTDqz.js";const $t=_([]),St=_([]),Fe=_([]),Le=_([]),ze=async t=>{try{const x=(await de.get(`/api/roles?type=${t}`)).data.map(g=>({value:g.id,label:g.name}));return t==="client"?$t.value=x:t==="project"&&(St.value=x),x}catch(b){return console.error(`Error fetching ${t} roles:`,b),F(`Failed to load ${t} roles. Please refresh the page.`),[]}},Vt=async(t,b)=>{try{let a;return b&&!t||t&&(a=await window.axios.get("/api/clients"),Fe.value=a.data.data||a.data),Fe.value}catch(a){return console.error("Error fetching clients:",a),F("Failed to load clients. Please try again."),[]}},Ct=async(t,b)=>{try{let a;return b&&!t||t&&(a=await window.axios.get("/api/users"),Le.value=a.data),Le.value}catch(a){return console.error("Error fetching users:",a),F("Failed to load users. Please try again."),[]}},Pe=async(t,b,a)=>{let x="",g=null;try{switch(b){case"basic":x=`/api/projects/${t}/sections/basic`;break;case"client":(a.canViewProjectClients||a.canManageProjectClients||a.canViewProjectUsers||a.canManageProjectUsers)&&(x=`/api/projects/${t}/sections/clients-users`);break;case"services":(a.canViewProjectServicesAndPayments||a.canManageProjectServicesAndPayments)&&(x=`/api/projects/${t}/sections/services-payment`);break;case"documents":a.canViewProjectDocuments&&(x=`/api/projects/${t}/sections/documents`);break;case"notes":(a.canViewProjectNotes||a.canAddProjectNotes)&&(x=`/api/projects/${t}/sections/notes?type=private`);break;case"transactions":return null;default:return console.warn(`Attempted to fetch data for unknown tab: ${b}`),null}return x&&(g=(await window.axios.get(x)).data),g}catch(k){throw console.error(`Error fetching data for tab '${b}':`,k),F(`Failed to load data for ${b} section. Please try again.`),k}},It={class:"space-y-6 bg-white p-6 rounded-lg border border-gray-100 font-inter"},Ut={key:0,class:"text-center py-8 text-gray-500 text-lg"},Dt={key:1,class:"grid grid-cols-1 md:grid-cols-2 gap-6"},Mt={key:0},At={key:1},Nt={key:0,class:"mt-1 text-xs text-gray-500"},Tt=["disabled"],Bt={key:0,class:"mt-2"},Rt=["src"],Et={class:"mt-6"},Ot=["disabled"],Ft={class:"mt-6"},Lt={class:"mt-6"},zt={class:"mt-6"},qt={class:"mt-6 flex justify-end"},Kt={key:0,class:"flex items-center"},Gt={key:1},Ht={__name:"ProjectEditBasicInfo",props:{projectId:{type:[Number,String],required:!0},errors:{type:Object,default:()=>({})},statusOptions:{type:Array,required:!0,default:()=>[{value:"active",label:"Active"},{value:"completed",label:"Completed"},{value:"paid",label:"Paid"},{value:"on_hold",label:"On-hold"}]},sourceOptions:{type:Array,required:!0},canManageProjects:{type:Boolean,default:!1},canManageProjectBasicDetails:{type:Boolean,default:!1},isSaving:{type:Boolean,default:!1}},setup(t){const b=t,a=we({id:null,name:"",description:"",website:"",social_media_link:"",preferred_keywords:"",reporting_sites:"",google_chat_id:"",google_drive_link:"",logo:null,status:"active",project_type:"",source:"",tags:[],tags_data:[],timezone:null,project_tier_id:null,profit_margin_percentage:null}),x=_(!1),g=_(!0),k=_([]),M=async()=>{try{const i=await window.axios.get("/api/project-tiers");k.value=i.data}catch{F("Failed to load project tiers.")}},D=i=>{const l=i.target.files[0];l?a.logo=l:a.logo=null},U=async()=>{x.value=!0;const i=new FormData,l=["id","tags","tags_data","logo"];if(a.project_tier_id!==null&&a.project_tier_id!==void 0){const f=String(a.project_tier_id);i.append("project_tier_id",f)}else console.log("project_tier_id is null or undefined:",a.project_tier_id);a.profit_margin_percentage!==null&&a.profit_margin_percentage!==void 0&&i.append("profit_margin_percentage",a.profit_margin_percentage);for(const f in a)!l.includes(f)&&f!=="project_tier_id"&&f!=="profit_margin_percentage"&&a[f]!==null&&a[f]!==void 0&&i.append(f,a[f]);Array.isArray(a.tags)&&a.tags.forEach(f=>{const P=typeof f=="object"&&f!==null&&f.id?f.id:f;P!=null&&i.append("tags[]",P)}),a.logo instanceof File&&i.append("logo",a.logo),i.append("_method","PUT");try{const f=await window.axios.post(`/api/projects/${b.projectId}/sections/basic`,i,{headers:{"Content-Type":"multipart/form-data"}});te("Project basic information updated successfully!"),f.data&&Object.assign(a,{name:f.data.name||a.name,description:f.data.description||a.description,website:f.data.website||a.website,social_media_link:f.data.social_media_link||a.social_media_link,preferred_keywords:f.data.preferred_keywords||a.preferred_keywords,reporting_sites:f.data.reporting_sites||a.reporting_sites,google_chat_id:f.data.google_chat_id||a.google_chat_id,google_drive_link:f.data.google_drive_link||a.google_drive_link,logo:f.data.logo_url||f.data.logo||a.logo,status:f.data.status||a.status,project_type:f.data.project_type||a.project_type,source:f.data.source||a.source,tags:f.data.tags||a.tags,tags_data:f.data.tags_data||a.tags_data,timezone:f.data.timezone||a.timezone,project_tier_id:f.data.project_tier_id||a.project_tier_id,profit_margin_percentage:f.data.profit_margin_percentage||a.profit_margin_percentage})}catch(f){ot(f)}finally{x.value=!1}},y=async()=>{if(!b.projectId){g.value=!1;return}g.value=!0;try{const i=await Pe(b.projectId,"basic",{});i&&Object.assign(a,{id:i.id||b.projectId,name:i.name||"",description:i.description||"",website:i.website||"",social_media_link:i.social_media_link||"",preferred_keywords:i.preferred_keywords||"",reporting_sites:i.reporting_sites||"",google_chat_id:i.google_chat_id||"",google_drive_link:i.google_drive_link||"",logo:i.logo_url||i.logo||null,status:i.status||"active",project_type:i.project_type||"",source:i.source||"",tags:i.tags||[],tags_data:i.tags_data||[],timezone:i.timezone||null,project_tier_id:i.project_tier_id||null,profit_margin_percentage:i.profit_margin_percentage||null})}catch{F("Failed to load basic project information.")}finally{g.value=!1}};return ne(()=>b.projectId,async i=>{setTimeout(async()=>{i&&await y()},500)},{immediate:!0}),me(()=>{M()}),(i,l)=>{const f=Ce("permission");return n(),r("div",It,[g.value?(n(),r("div",Ut,l[15]||(l[15]=[e("svg",{class:"animate-spin h-8 w-8 text-indigo-500 mx-auto mb-3",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),E(" Loading basic project information... ",-1)]))):(n(),r("div",Dt,[e("div",null,[s(N,{for:"name",value:"Project Name"}),s(G,{id:"name",type:"text",class:"mt-1 block w-full rounded-lg shadow-sm",modelValue:a.name,"onUpdate:modelValue":l[0]||(l[0]=P=>a.name=P),required:"",autofocus:"",disabled:!t.canManageProjects||x.value||t.isSaving},null,8,["modelValue","disabled"]),s(B,{message:t.errors.name?t.errors.name[0]:"",class:"mt-2"},null,8,["message"])]),e("div",null,[s(N,{for:"website",value:"Website"}),s(G,{id:"website",type:"url",class:"mt-1 block w-full rounded-lg shadow-sm",modelValue:a.website,"onUpdate:modelValue":l[1]||(l[1]=P=>a.website=P),disabled:!t.canManageProjects||x.value||t.isSaving},null,8,["modelValue","disabled"]),s(B,{message:t.errors.website?t.errors.website[0]:"",class:"mt-2"},null,8,["message"])]),e("div",null,[s(N,{for:"social_media_link",value:"Social Media Link"}),s(G,{id:"social_media_link",type:"url",class:"mt-1 block w-full rounded-lg shadow-sm",modelValue:a.social_media_link,"onUpdate:modelValue":l[2]||(l[2]=P=>a.social_media_link=P),disabled:!t.canManageProjects||x.value||t.isSaving},null,8,["modelValue","disabled"]),s(B,{message:t.errors.social_media_link?t.errors.social_media_link[0]:"",class:"mt-2"},null,8,["message"])]),t.canManageProjectBasicDetails?(n(),r("div",Mt,[s(N,{for:"google_chat_id",value:"Google Chat ID"}),s(G,{id:"google_chat_id",type:"text",class:"mt-1 block w-full rounded-lg shadow-sm",modelValue:a.google_chat_id,"onUpdate:modelValue":l[3]||(l[3]=P=>a.google_chat_id=P),disabled:!t.canManageProjects||x.value||t.isSaving},null,8,["modelValue","disabled"]),s(B,{message:t.errors.google_chat_id?t.errors.google_chat_id[0]:"",class:"mt-2"},null,8,["message"])])):w("",!0),t.canManageProjectBasicDetails?(n(),r("div",At,[s(N,{for:"google_drive_link",value:"Google Drive Link"}),s(G,{id:"google_drive_link",type:"text",class:"mt-1 block w-full rounded-lg shadow-sm",modelValue:a.google_drive_link,"onUpdate:modelValue":l[4]||(l[4]=P=>a.google_drive_link=P),disabled:!t.canManageProjects||x.value||t.isSaving},null,8,["modelValue","disabled"]),s(B,{message:t.errors.google_drive_link?t.errors.google_drive_link[0]:"",class:"mt-2"},null,8,["message"])])):w("",!0),e("div",null,[s(N,{for:"status",value:"Status"}),s(Z,{id:"status",modelValue:a.status,"onUpdate:modelValue":l[5]||(l[5]=P=>a.status=P),options:t.statusOptions,valueKey:"value",labelKey:"label",placeholder:"Select Project Status",disabled:!t.canManageProjects||x.value||t.isSaving,required:!0,class:"mt-1 block w-full"},null,8,["modelValue","options","disabled"]),s(B,{message:t.errors.status?t.errors.status[0]:"",class:"mt-2"},null,8,["message"])]),e("div",null,[s(bt,{id:"project_type",modelValue:a.project_type,"onUpdate:modelValue":l[6]||(l[6]=P=>a.project_type=P),disabled:!t.canManageProjects||x.value||t.isSaving,class:"mt-1 block w-full"},null,8,["modelValue","disabled"]),s(B,{message:t.errors.project_type?t.errors.project_type[0]:"",class:"mt-2"},null,8,["message"])]),e("div",null,[s(N,{for:"source",value:"Source"}),s(Z,{id:"source",modelValue:a.source,"onUpdate:modelValue":l[7]||(l[7]=P=>a.source=P),options:t.sourceOptions,valueKey:"value",labelKey:"label",placeholder:"Select a Source",disabled:!t.canManageProjects||x.value||t.isSaving,class:"mt-1 block w-full"},null,8,["modelValue","options","disabled"]),s(B,{message:t.errors.source?t.errors.source[0]:"",class:"mt-2"},null,8,["message"])]),e("div",null,[s(gt,{id:"timezone",modelValue:a.timezone,"onUpdate:modelValue":l[8]||(l[8]=P=>a.timezone=P),disabled:!t.canManageProjects||x.value||t.isSaving,class:"mt-1 block w-full"},null,8,["modelValue","disabled"]),s(B,{message:t.errors.timezone?t.errors.timezone[0]:"",class:"mt-2"},null,8,["message"])]),e("div",null,[s(N,{for:"project_tier_id",value:"Project Tier"}),s(Z,{id:"project_tier_id",modelValue:a.project_tier_id,"onUpdate:modelValue":l[9]||(l[9]=P=>a.project_tier_id=P),options:k.value,valueKey:"id",labelKey:"name",placeholder:"Select Project Tier",disabled:!t.canManageProjects||x.value||t.isSaving,class:"mt-1 block w-full"},null,8,["modelValue","options","disabled"]),s(B,{message:t.errors.project_tier_id?t.errors.project_tier_id[0]:"",class:"mt-2"},null,8,["message"]),a.project_tier_id?(n(),r("div",Nt," Selected tier ID: "+$(a.project_tier_id)+" ("+$(typeof a.project_tier_id)+") ",1)):w("",!0)]),e("div",null,[s(N,{for:"profit_margin_percentage",value:"Profit Margin (%)"}),s(G,{id:"profit_margin_percentage",type:"number",step:"0.01",min:"0",max:"100",class:"mt-1 block w-full rounded-lg shadow-sm",modelValue:a.profit_margin_percentage,"onUpdate:modelValue":l[10]||(l[10]=P=>a.profit_margin_percentage=P),disabled:!t.canManageProjects||x.value||t.isSaving},null,8,["modelValue","disabled"]),s(B,{message:t.errors.profit_margin_percentage?t.errors.profit_margin_percentage[0]:"",class:"mt-2"},null,8,["message"])]),e("div",null,[s(N,{for:"logo",value:"Project Logo"}),e("input",{type:"file",id:"logo",onChange:D,class:"mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100 cursor-pointer",accept:"image/*",disabled:!t.canManageProjectBasicDetails||x.value||t.isSaving},null,40,Tt),a.logo&&typeof a.logo=="string"?(n(),r("div",Bt,[l[16]||(l[16]=e("p",{class:"text-sm text-gray-600"},"Current Logo:",-1)),e("img",{src:a.logo,alt:"Project Logo",class:"h-20 w-20 object-contain rounded-lg shadow-md border border-gray-200"},null,8,Rt)])):w("",!0),s(B,{message:t.errors.logo?t.errors.logo[0]:"",class:"mt-2"},null,8,["message"])])])),e("div",Et,[s(N,{for:"description",value:"Description"}),fe(e("textarea",{id:"description",class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-lg shadow-sm mt-1 block w-full","onUpdate:modelValue":l[11]||(l[11]=P=>a.description=P),disabled:!t.canManageProjects||x.value||t.isSaving,rows:"4"},null,8,Ot),[[Ge,a.description]]),s(B,{message:t.errors.description?t.errors.description[0]:"",class:"mt-2"},null,8,["message"])]),e("div",Ft,[s(N,{for:"preferred_keywords",value:"Client Preferred Keywords"}),s(G,{id:"preferred_keywords",type:"text",class:"mt-1 block w-full rounded-lg shadow-sm",modelValue:a.preferred_keywords,"onUpdate:modelValue":l[12]||(l[12]=P=>a.preferred_keywords=P),disabled:!t.canManageProjects||x.value||t.isSaving},null,8,["modelValue","disabled"]),s(B,{message:t.errors.preferred_keywords?t.errors.preferred_keywords[0]:"",class:"mt-2"},null,8,["message"])]),e("div",Lt,[s(N,{for:"reporting_sites",value:"Reporting Sites (comma separated)"}),s(G,{id:"reporting_sites",type:"text",class:"mt-1 block w-full rounded-lg shadow-sm",placeholder:"e.g. ahrefs.com, semrush.com, analytics.google.com",modelValue:a.reporting_sites,"onUpdate:modelValue":l[13]||(l[13]=P=>a.reporting_sites=P),disabled:!t.canManageProjects||x.value||t.isSaving},null,8,["modelValue","disabled"]),l[17]||(l[17]=e("p",{class:"mt-1 text-xs text-gray-500"},"Enter multiple site URLs separated by commas.",-1)),s(B,{message:t.errors.reporting_sites?t.errors.reporting_sites[0]:"",class:"mt-2"},null,8,["message"])]),e("div",zt,[s(yt,{modelValue:a.tags,"onUpdate:modelValue":l[14]||(l[14]=P=>a.tags=P),initialTags:a.tags_data,label:"Associated Tags",placeholder:"Search or add tags",error:t.errors.tags?t.errors.tags[0]:"",disabled:!t.canManageProjects||x.value||t.isSaving},null,8,["modelValue","initialTags","error","disabled"])]),e("div",qt,[fe((n(),le(ae,{onClick:U,disabled:!t.canManageProjects||x.value||t.isSaving,class:Q([{"opacity-50 cursor-not-allowed":x.value||t.isSaving},"px-6 py-2 rounded-lg text-base shadow-md hover:shadow-lg transition-all"])},{default:Y(()=>[x.value||t.isSaving?(n(),r("span",Kt,l[18]||(l[18]=[e("svg",{class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),E(" Updating... ",-1)]))):(n(),r("span",Gt," Update Basic Information "))]),_:1},8,["disabled","class"])),[[f,["edit_projects","manage_projects"]]])])])}}},Yt={class:"mb-4"},Wt={class:"mt-2"},Jt={key:0,class:"text-gray-500 text-sm mb-2"},Xt={class:"mb-4"},Qt={key:1,class:"space-y-3"},Zt={class:"flex-grow text-gray-800 font-medium"},ea={class:"text-gray-600 text-sm"},ta={class:"flex items-center space-x-2"},aa=["onClick"],sa={key:2,class:"p-4 bg-gray-50 rounded-lg text-gray-600 text-center border border-dashed border-gray-200"},qe={__name:"MultiSelectWithRoles",props:{label:{type:String,required:!0},items:{type:Array,default:()=>[]},endpoint:{type:String,default:""},selectedItems:{type:Array,default:()=>[]},itemText:{type:String,default:"name"},itemSubtext:{type:String,default:"email"},itemValue:{type:String,default:"id"},roleOptions:{type:Array,default:()=>[]},roleType:{type:String,default:"application"},defaultRoleId:{type:Number,default:null},error:{type:String,default:""},placeholder:{type:String,default:"Select an item"},showRemoveButton:{type:Boolean,default:!0},disabled:{type:Boolean,default:!1}},emits:["update:selectedItems"],setup(t,{emit:b}){const a=t,x=b,g=_([]),k=_([]),M=_([]),D=_([]),U=_(!1),y=async()=>{if(!(a.roleOptions.length>0))try{const c=(await de.get(`/api/roles?type=${a.roleType}`)).data;M.value=c.map(u=>({value:u.id,label:u.name}))}catch(o){console.error("Error fetching roles:",o)}},i=J(()=>M.value.length>0?M.value:a.roleOptions),l=()=>a.defaultRoleId?a.defaultRoleId:i.value.length>0?i.value[0].value:1,f=()=>{g.value=[],k.value=[],!(!a.selectedItems||a.selectedItems.length===0)&&a.selectedItems.forEach(o=>{const c=typeof o=="object"?o[a.itemValue]:o,u=typeof o=="object"&&o.role_id!==void 0?o.role_id:l();if(!g.value.includes(c))g.value.push(c),k.value.push({id:c,role_id:u});else{const O=k.value.find(R=>R.id===c);O&&O.role_id!==u&&(O.role_id=u)}})};ne(()=>a.selectedItems,(o,c)=>{JSON.stringify(o)!==JSON.stringify(c)&&f()},{deep:!0,immediate:!0}),ne(k,o=>{x("update:selectedItems",o)},{deep:!0});const P=o=>{a.disabled||o&&!g.value.includes(o)&&(g.value.push(o),k.value.push({id:o,role_id:l()}))},L=o=>{a.disabled||(g.value=g.value.filter(c=>c!==o),k.value=k.value.filter(c=>c.id!==o))},K=(o,c)=>{if(a.disabled)return;const u=k.value.find(O=>O.id===o);u&&(u.role_id=parseInt(c))},W=o=>h.value.find(c=>c[a.itemValue]===o),j=o=>{const c=k.value.find(u=>u.id===o);return c?c.role_id:l()},v=async()=>{if(a.endpoint){U.value=!0;try{const o=await de.get(a.endpoint);o.data&&Array.isArray(o.data)?D.value=o.data:o.data&&o.data.data&&Array.isArray(o.data.data)&&(D.value=o.data.data)}catch(o){console.error("Error fetching items from endpoint:",o)}finally{U.value=!1}}},h=J(()=>a.endpoint&&D.value.length>0?D.value:a.items),T=J(()=>h.value.filter(o=>!g.value.includes(o[a.itemValue])).map(o=>({value:o[a.itemValue],label:`${o[a.itemText]} (${o[a.itemSubtext]})`})));return me(()=>{y(),a.endpoint&&v()}),(o,c)=>(n(),r("div",Yt,[s(N,{value:t.label},null,8,["value"]),e("div",Wt,[U.value?(n(),r("div",Jt,"Loading available items...")):w("",!0),e("div",Xt,[s(Z,{modelValue:o.selectedItemToAdd,"onUpdate:modelValue":c[0]||(c[0]=u=>o.selectedItemToAdd=u),options:T.value,valueKey:"value",labelKey:"label",placeholder:t.placeholder,disabled:U.value||t.disabled,onChange:P,class:"w-full"},null,8,["modelValue","options","placeholder","disabled"])]),g.value.length>0?(n(),r("div",Qt,[(n(!0),r(ue,null,ce(g.value,u=>{var O,R;return n(),r("div",{key:u,class:"flex items-center p-3 border border-gray-200 rounded-lg bg-gray-50 shadow-sm"},[e("div",Zt,[E($((O=W(u))==null?void 0:O[t.itemText])+" ",1),e("span",ea,"("+$((R=W(u))==null?void 0:R[t.itemSubtext])+")",1)]),e("div",ta,[s(Z,{modelValue:j(u),"onUpdate:modelValue":C=>K(u,C),options:i.value,valueKey:"value",labelKey:"label",placeholder:"Select Role",disabled:t.disabled,class:"w-32"},null,8,["modelValue","onUpdate:modelValue","options","disabled"]),t.showRemoveButton&&!t.disabled?(n(),r("button",{key:0,type:"button",class:"text-red-500 hover:text-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 rounded-full p-1 transition-colors duration-200",onClick:C=>L(u),"aria-label":"Remove item"},c[1]||(c[1]=[e("svg",{class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]),8,aa)):w("",!0)])])}),128))])):(n(),r("div",sa," No "+$(t.label.toLowerCase())+" selected. ",1))]),s(B,{message:t.error,class:"mt-2"},null,8,["message"])]))}},la={class:"space-y-8"},oa={class:"bg-gray-50 p-6 rounded-lg shadow-inner border border-gray-200"},na={key:0,class:"mt-6 flex justify-end"},ra={key:0},ia={key:1},da={key:1,class:"mt-3 text-green-600 text-sm flex items-center"},ua={key:2,class:"mt-3 text-red-600 text-sm flex items-center"},ca={key:0,class:"bg-gray-50 p-6 rounded-lg shadow-inner border border-gray-200"},ma={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},va={key:0,class:"mt-6 flex justify-end"},pa={key:0},ga={key:1},ya={key:1,class:"mt-3 text-green-600 text-sm flex items-center"},fa={key:2,class:"mt-3 text-red-600 text-sm flex items-center"},ba={key:1,class:"bg-gray-50 p-6 rounded-lg shadow-inner border border-gray-200"},wa={key:0,class:"mt-6 flex justify-end"},xa={key:0},ha={key:1},_a={key:1,class:"mt-3 text-green-600 text-sm flex items-center"},ja={key:2,class:"mt-3 text-red-600 text-sm flex items-center"},ka={key:2,class:"bg-gray-50 p-6 rounded-lg shadow-inner border border-gray-200"},Pa={class:"mb-4"},$a={key:0,class:"mt-6 flex justify-end"},Sa={key:0},Va={key:1},Ca={key:1,class:"mt-3 text-green-600 text-sm flex items-center"},Ia={key:2,class:"mt-3 text-red-600 text-sm flex items-center"},Ua={__name:"ProjectFormClientsUsers",props:{projectId:{type:[Number,String],required:!0},errors:{type:Object,default:()=>({})},clientRoleOptions:{type:Array,default:()=>[]},userRoleOptions:{type:Array,default:()=>[]},clients:{type:Array,default:()=>[]},users:{type:Array,default:()=>[]},canViewProjectClients:{type:Boolean,default:!1},canManageProjectClients:{type:Boolean,default:!1},canViewProjectUsers:{type:Boolean,default:!1},canManageProjectUsers:{type:Boolean,default:!1},isSaving:{type:Boolean,default:!1}},setup(t){const b=t,a=we({client_ids:[],user_ids:[],contract_details:"",project_manager_id:null,project_admin_id:null,google_chat_member_ids:[]}),x=_(!1),g=_(!1),k=_(""),M=_(!1),D=_(!1),U=_(""),y=_(!1),i=_(!1),l=_(""),f=_(!1),P=_(!1),L=_(""),K=async()=>{var T,o;if(b.projectId)try{const c=await Pe(b.projectId,"client",{canViewProjectClients:b.canViewProjectClients,canManageProjectClients:b.canManageProjectClients,canViewProjectUsers:b.canViewProjectUsers,canManageProjectUsers:b.canManageProjectUsers});c&&(a.client_ids=c.clients?c.clients.map(u=>{var O;return{id:u.id,role_id:((O=u.pivot)==null?void 0:O.role_id)||(b.clientRoleOptions.length>0?b.clientRoleOptions[0].value:null)}}):[],a.user_ids=c.users?c.users.map(u=>{var O;return{id:u.id,role_id:((O=u.pivot)==null?void 0:O.role_id)||(b.userRoleOptions.length>0?b.userRoleOptions[0].value:null)}}):[],a.contract_details=c.contract_details||"");try{const u=await window.axios.get(`/api/projects/${b.projectId}/sections/basic`);a.project_manager_id=((T=u.data)==null?void 0:T.project_manager_id)??null,a.project_admin_id=((o=u.data)==null?void 0:o.project_admin_id)??null}catch{}try{const u=await window.axios.get(`/api/projects/${b.projectId}/google-chat-members`);a.google_chat_member_ids=u.data?u.data.map(O=>O.id):[]}catch{}}catch(c){console.error("Error fetching clients/users data:",c),F("Failed to load clients and users data.")}},W=async()=>{var T,o;if(!b.projectId){F("Project ID is missing. Cannot save project leads.");return}y.value=!0,i.value=!1,l.value="";try{await window.axios.patch(`/api/projects/${b.projectId}/assign-leads`,{project_manager_id:a.project_manager_id,project_admin_id:a.project_admin_id}),te("Project leads updated successfully!"),i.value=!0}catch(c){console.error("Error saving project leads:",c),l.value=((o=(T=c.response)==null?void 0:T.data)==null?void 0:o.message)||"Failed to save project leads.",F(l.value)}finally{y.value=!1,setTimeout(()=>i.value=!1,3e3)}},j=async()=>{var T,o;if(!b.projectId){F("Project ID is missing. Cannot save Google Chat members.");return}f.value=!0,P.value=!1,L.value="";try{await window.axios.post(`/api/projects/${b.projectId}/attach-google-chat-members`,{user_ids:a.google_chat_member_ids}),te("Google Chat members updated successfully!"),P.value=!0}catch(c){console.error("Error saving Google Chat members:",c),L.value=((o=(T=c.response)==null?void 0:T.data)==null?void 0:o.message)||"Failed to save Google Chat members.",F(L.value)}finally{f.value=!1,setTimeout(()=>P.value=!1,3e3)}};ne(()=>b.projectId,async T=>{T&&await K()},{immediate:!0});const v=async()=>{var T,o;if(!b.projectId){F("Project ID is missing. Cannot save clients.");return}if(!a.client_ids||a.client_ids.length===0){F("Please select at least one client to save.");return}x.value=!0,g.value=!1,k.value="";try{await window.axios.post(`/api/projects/${b.projectId}/attach-clients`,{client_ids:a.client_ids}),te("Clients saved successfully!"),g.value=!0,await K()}catch(c){console.error("Error saving clients:",c),k.value=((o=(T=c.response)==null?void 0:T.data)==null?void 0:o.message)||"Failed to save clients.",F(k.value)}finally{x.value=!1,setTimeout(()=>g.value=!1,3e3)}},h=async()=>{var T,o;if(!b.projectId){F("Project ID is missing. Cannot save users.");return}if(!a.user_ids||a.user_ids.length===0){F("Please select at least one user to save.");return}M.value=!0,D.value=!1,U.value="";try{await window.axios.post(`/api/projects/${b.projectId}/attach-users`,{user_ids:a.user_ids}),te("Users saved successfully!"),D.value=!0,await K()}catch(c){console.error("Error saving users:",c),U.value=((o=(T=c.response)==null?void 0:T.data)==null?void 0:o.message)||"Failed to save users.",F(U.value)}finally{M.value=!1,setTimeout(()=>D.value=!1,3e3)}};return me(()=>{}),(T,o)=>{const c=Ce("permission");return n(),r("div",la,[fe((n(),r("div",oa,[o[7]||(o[7]=e("h3",{class:"text-xl font-semibold text-gray-800 mb-5"},"Project Clients",-1)),s(qe,{label:"Select Clients",items:t.clients,selectedItems:a.client_ids,"onUpdate:selectedItems":o[0]||(o[0]=u=>a.client_ids=u),roleOptions:t.clientRoleOptions,roleType:"client",error:t.errors.client_ids?t.errors.client_ids[0]:"",placeholder:"Search and select clients to add",disabled:!t.canManageProjectClients||t.isSaving||x.value,readonly:!t.canManageProjectClients&&t.canViewProjectClients,showRemoveButton:t.canManageProjectClients,class:"mb-4"},null,8,["items","selectedItems","roleOptions","error","disabled","readonly","showRemoveButton"]),t.canManageProjectClients?(n(),r("div",na,[s(ae,{onClick:v,disabled:x.value||t.isSaving,class:"px-6 py-3 rounded-lg text-lg shadow-md hover:shadow-lg transition-all duration-200"},{default:Y(()=>[x.value?(n(),r("span",ra,"Saving Clients...")):(n(),r("span",ia,"Save Clients"))]),_:1},8,["disabled"])])):w("",!0),g.value?(n(),r("div",da,o[5]||(o[5]=[e("svg",{class:"h-5 w-5 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1),E(" Clients saved successfully! ",-1)]))):w("",!0),k.value?(n(),r("div",ua,[o[6]||(o[6]=e("svg",{class:"h-5 w-5 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),E(" "+$(k.value),1)])):w("",!0)])),[[c,["view_project_clients","manage_project_clients"],void 0,{or:!0}]]),t.canViewProjectUsers?(n(),r("div",ca,[o[10]||(o[10]=e("h3",{class:"text-xl font-semibold text-gray-800 mb-5"},"Project Leads",-1)),e("div",ma,[e("div",null,[s(N,{for:"project_manager_id",value:"Project Manager"}),s(Z,{id:"project_manager_id",modelValue:a.project_manager_id,"onUpdate:modelValue":o[1]||(o[1]=u=>a.project_manager_id=u),options:t.users,valueKey:"id",labelKey:"name",placeholder:"Select Project Manager",disabled:!t.canManageProjectUsers||t.isSaving||y.value,class:"mt-1 block w-full"},null,8,["modelValue","options","disabled"]),s(B,{message:t.errors.project_manager_id?t.errors.project_manager_id[0]:"",class:"mt-2"},null,8,["message"])]),e("div",null,[s(N,{for:"project_admin_id",value:"Project Admin"}),s(Z,{id:"project_admin_id",modelValue:a.project_admin_id,"onUpdate:modelValue":o[2]||(o[2]=u=>a.project_admin_id=u),options:t.users,valueKey:"id",labelKey:"name",placeholder:"Select Project Admin",disabled:!t.canManageProjectUsers||t.isSaving||y.value,class:"mt-1 block w-full"},null,8,["modelValue","options","disabled"]),s(B,{message:t.errors.project_admin_id?t.errors.project_admin_id[0]:"",class:"mt-2"},null,8,["message"])])]),t.canManageProjectUsers?(n(),r("div",va,[s(ae,{onClick:W,disabled:y.value||t.isSaving,class:"px-6 py-3 rounded-lg text-lg shadow-md hover:shadow-lg transition-all duration-200"},{default:Y(()=>[y.value?(n(),r("span",pa,"Saving Leads...")):(n(),r("span",ga,"Save Leads"))]),_:1},8,["disabled"])])):w("",!0),i.value?(n(),r("div",ya,o[8]||(o[8]=[e("svg",{class:"h-5 w-5 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1),E(" Project leads saved successfully! ",-1)]))):w("",!0),l.value?(n(),r("div",fa,[o[9]||(o[9]=e("svg",{class:"h-5 w-5 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),E(" "+$(l.value),1)])):w("",!0)])):w("",!0),t.canViewProjectUsers?(n(),r("div",ba,[o[13]||(o[13]=e("h3",{class:"text-xl font-semibold text-gray-800 mb-5"},"Assign Project Users",-1)),s(qe,{label:"Assign Users",items:t.users,selectedItems:a.user_ids,"onUpdate:selectedItems":o[3]||(o[3]=u=>a.user_ids=u),roleOptions:t.userRoleOptions,roleType:"project",defaultRoleId:2,error:t.errors.user_ids?t.errors.user_ids[0]:"",placeholder:"Search and assign users to this project",disabled:!t.canManageProjectUsers||t.isSaving||M.value,readonly:!t.canManageProjectUsers&&t.canViewProjectUsers,showRemoveButton:t.canManageProjectUsers,class:"mb-4"},null,8,["items","selectedItems","roleOptions","error","disabled","readonly","showRemoveButton"]),t.canManageProjectUsers?(n(),r("div",wa,[s(ae,{onClick:h,disabled:M.value||t.isSaving,class:"px-6 py-3 rounded-lg text-lg shadow-md hover:shadow-lg transition-all duration-200"},{default:Y(()=>[M.value?(n(),r("span",xa,"Saving Users...")):(n(),r("span",ha,"Save Users"))]),_:1},8,["disabled"])])):w("",!0),D.value?(n(),r("div",_a,o[11]||(o[11]=[e("svg",{class:"h-5 w-5 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1),E(" Users saved successfully! ",-1)]))):w("",!0),U.value?(n(),r("div",ja,[o[12]||(o[12]=e("svg",{class:"h-5 w-5 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),E(" "+$(U.value),1)])):w("",!0)])):w("",!0),t.canViewProjectUsers?(n(),r("div",ka,[o[16]||(o[16]=e("h3",{class:"text-xl font-semibold text-gray-800 mb-5"},"Google Chat Members",-1)),o[17]||(o[17]=e("p",{class:"text-sm text-gray-600 mb-4"}," Add users who need access to the project's Google Chat space but are not project leads or team members. This is useful for administrators or stakeholders who need to stay informed. ",-1)),e("div",Pa,[s(N,{for:"google_chat_members",value:"Select Users for Google Chat",class:"mb-2"}),s(wt,{modelValue:a.google_chat_member_ids,"onUpdate:modelValue":o[4]||(o[4]=u=>a.google_chat_member_ids=u),options:(t.users||[]).map(u=>({value:u.id,label:`${u.name} (${u.email})`})),"is-multi":!0,disabled:!t.canManageProjectUsers||t.isSaving||f.value,placeholder:"Search and select users for Google Chat","max-height":"200px"},null,8,["modelValue","options","disabled"]),s(B,{message:t.errors.google_chat_member_ids?t.errors.google_chat_member_ids[0]:"",class:"mt-2"},null,8,["message"])]),t.canManageProjectUsers?(n(),r("div",$a,[s(ae,{onClick:j,disabled:f.value||t.isSaving,class:"px-6 py-3 rounded-lg text-lg shadow-md hover:shadow-lg transition-all duration-200"},{default:Y(()=>[f.value?(n(),r("span",Sa,"Saving Chat Members...")):(n(),r("span",Va,"Save Chat Members"))]),_:1},8,["disabled"])])):w("",!0),P.value?(n(),r("div",Ca,o[14]||(o[14]=[e("svg",{class:"h-5 w-5 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1),E(" Google Chat members saved successfully! ",-1)]))):w("",!0),L.value?(n(),r("div",Ia,[o[15]||(o[15]=e("svg",{class:"h-5 w-5 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),E(" "+$(L.value),1)])):w("",!0)])):w("",!0)])}}},Da={class:"space-y-6"},Ma={key:0,class:"bg-gray-50 p-6 rounded-lg shadow-inner border border-gray-200"},Aa={class:"mt-6"},Na={key:0},Ta={key:1},Ba={key:0,class:"text-sm text-red-500 mt-3"},Ra={key:1,class:"mt-8 bg-white p-6 rounded-lg shadow-md border border-gray-200"},Ea={class:"space-y-3"},Oa={class:"flex items-center"},Fa={class:"mr-3 text-indigo-500"},La={key:0,class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},za={key:1,class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},qa={key:2,class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},Ka={key:3,class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},Ga=["href"],Ha={key:1,class:"text-gray-700 font-medium break-all mr-4"},Ya=["onClick","disabled"],Wa={key:2,class:"p-6 bg-gray-50 rounded-lg text-gray-600 text-center border border-gray-200 shadow-sm"},Ja={__name:"ProjectFormDocuments",props:{projectId:{type:[Number,String],required:!0},errors:{type:Object,default:()=>({})},canUploadProjectDocuments:{type:Boolean,default:!1},canViewProjectDocuments:{type:Boolean,default:!1},isSaving:{type:Boolean,default:!1}},setup(t){const b=t,a=we({documents:[]}),x=_(null),g=_(!1),k=async()=>{if(b.projectId)try{const y=await Pe(b.projectId,"documents",{canViewProjectDocuments:b.canViewProjectDocuments});y&&(a.documents=y||[])}catch(y){console.error("Error fetching documents data:",y),F("Failed to load documents data.")}};ne(()=>b.projectId,async y=>{y&&await k()},{immediate:!0});const M=y=>{const i=Array.from(y.target.files);if(i.length>0){const l=Array.isArray(a.documents)?a.documents.filter(f=>typeof f=="object"&&"path"in f):[];a.documents=[...l,...i]}},D=async()=>{if(!b.projectId){F("Project ID is missing. Cannot upload documents.");return}const y=a.documents.filter(i=>i&&typeof i=="object"&&"name"in i&&"size"in i&&"type"in i);if(!y||y.length===0){F("Please select documents to upload.");return}g.value=!0;try{const i=new FormData;y.forEach((f,P)=>{i.append(`documents[${P}]`,f)});const l=await window.axios.post(`/api/projects/${b.projectId}/documents`,i,{headers:{"Content-Type":"multipart/form-data"}});a.documents=l.data.documents||[],te("Documents uploaded successfully!"),await k()}catch(i){F("Failed to upload documents."),console.error("Error uploading documents:",i)}finally{g.value=!1,x.value&&(x.value.value="")}},U=y=>{a.documents=a.documents.filter((i,l)=>l!==y)};return me(()=>{}),(y,i)=>(n(),r("div",Da,[t.canUploadProjectDocuments?(n(),r("div",Ma,[s(N,{for:"documents-upload",value:"Upload New Documents",class:"mb-2 text-lg"}),e("input",{type:"file",id:"documents-upload",ref_key:"documentFileInput",ref:x,onChange:M,class:"mt-2 block w-full text-sm text-gray-600 file:mr-4 file:py-2.5 file:px-5 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100 transition-colors duration-200 cursor-pointer",multiple:"",accept:".pdf,.doc,.docx,.jpg,.jpeg,.png,.gif"},null,544),i[0]||(i[0]=e("p",{class:"text-sm text-gray-500 mt-2"},"Supported formats: PDF, DOC, DOCX, JPG, JPEG, PNG, GIF. Max file size: 5MB.",-1)),s(B,{message:t.errors.documents?t.errors.documents[0]:"",class:"mt-2"},null,8,["message"]),e("div",Aa,[s(ae,{type:"button",onClick:D,disabled:!t.projectId||!a.documents||!a.documents.some(l=>l&&typeof l=="object"&&"name"in l&&"size"in l&&"type"in l)||g.value||t.isSaving,class:"px-6 py-3 rounded-lg text-lg shadow-md hover:shadow-lg transition-all duration-200"},{default:Y(()=>[g.value?(n(),r("span",Na,"Uploading...")):(n(),r("span",Ta,"Upload Selected Documents"))]),_:1},8,["disabled"]),t.projectId?w("",!0):(n(),r("p",Ba," Please save the project first before uploading documents. "))])])):w("",!0),t.canViewProjectDocuments&&a.documents&&a.documents.length>0?(n(),r("div",Ra,[i[7]||(i[7]=e("h3",{class:"text-xl font-semibold text-gray-800 mb-5"},"Existing Project Documents",-1)),e("ul",Ea,[(n(!0),r(ue,null,ce(a.documents,(l,f)=>(n(),r("li",{key:f,class:"flex items-center justify-between p-4 bg-gray-50 rounded-md border border-gray-100 shadow-sm transition-shadow hover:shadow-md duration-200"},[e("div",Oa,[e("span",Fa,[typeof l=="object"&&"type"in l&&l.type.includes("image")?(n(),r("svg",La,i[1]||(i[1]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 002.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"},null,-1)]))):typeof l=="object"&&"type"in l&&l.type.includes("pdf")?(n(),r("svg",za,i[2]||(i[2]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"},null,-1)]))):typeof l=="object"&&"type"in l&&(l.type.includes("word")||l.type.includes("document"))?(n(),r("svg",qa,i[3]||(i[3]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"},null,-1)]))):(n(),r("svg",Ka,i[4]||(i[4]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"},null,-1)])))]),typeof l=="object"&&"path"in l?(n(),r("a",{key:0,href:`/storage/${l.path}`,target:"_blank",class:"text-blue-600 hover:text-blue-800 hover:underline font-medium break-all mr-4"},$(l.filename),9,Ga)):(n(),r("span",Ha,[E($(l.name)+" ",1),i[5]||(i[5]=e("span",{class:"text-gray-500 text-sm"},"(Pending Upload)",-1))]))]),t.canUploadProjectDocuments?(n(),r("button",{key:0,type:"button",onClick:P=>U(f),class:"p-2 rounded-full text-red-500 hover:bg-red-100 hover:text-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 transition-colors duration-200",title:"Remove document",disabled:g.value||t.isSaving},i[6]||(i[6]=[e("svg",{class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]),8,Ya)):w("",!0)]))),128))])])):t.canViewProjectDocuments?(n(),r("div",Wa," No documents found for this project. ")):w("",!0),i[8]||(i[8]=e("div",{class:"mt-6 p-4 bg-blue-50 rounded-lg text-blue-700 text-sm border border-blue-200"},[e("p",null,"Note: Uploaded documents will be stored in the project's designated Google Drive folder.")],-1))]))}},Xa={class:"p-6 bg-white rounded-lg font-inter"},Qa={key:0,class:"p-6 bg-gray-50 rounded-lg text-gray-600 text-center border border-gray-200 shadow-sm"},Za={key:1},es={class:"mb-6 flex justify-between items-center"},ts={key:0,class:"flex items-center"},as={key:1},ss={key:0,class:"text-sm text-red-500 mb-4 bg-red-50 p-3 rounded-md border border-red-200"},ls={key:1,class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6"},os={class:"flex justify-between items-start mb-3"},ns=["onClick","disabled"],rs=["onUpdate:modelValue","readonly"],is={class:"mt-auto pt-3 border-t border-gray-100 text-xs text-gray-500 flex justify-between items-center"},ds={class:"font-medium text-gray-700"},us={key:2,class:"p-8 bg-gray-50 rounded-lg text-gray-600 text-center border border-gray-200 shadow-sm flex flex-col items-center justify-center h-64"},cs={__name:"ProjectFormNotes",props:{projectId:{type:[Number,String],required:!0},errors:{type:Object,default:()=>({})},canAddProjectNotes:{type:Boolean,default:!1},canViewProjectNotes:{type:Boolean,default:!1},isSaving:{type:Boolean,default:!1}},setup(t){const b=t,a=we({notes:[]}),x=_(!1),g=async()=>{if(b.projectId)try{const y=await Pe(b.projectId,"notes",{canViewProjectNotes:b.canViewProjectNotes,canAddProjectNotes:b.canAddProjectNotes});y&&(a.notes=y.map(i=>{var l,f;return{id:i.id,content:i.content,created_at:i.created_at,creator_name:i.creator_name||((l=i.user)==null?void 0:l.name)||((f=i.creator)==null?void 0:f.name)||"Unknown"}})||[])}catch(y){console.error("Error fetching notes data:",y),F("Failed to load notes data.")}};ne(()=>b.projectId,async y=>{y&&await g()},{immediate:!0});const k=()=>{b.canAddProjectNotes&&a.notes.push({id:null,content:"",created_at:new Date().toISOString(),creator_name:"You"})},M=y=>{b.canAddProjectNotes&&a.notes.splice(y,1)},D=async()=>{if(!b.projectId){F("Project ID is missing. Cannot save notes.");return}x.value=!0;const y=a.notes.map(i=>({id:i.id||null,content:i.content}));try{const i=await window.axios.put(`/api/projects/${b.projectId}/sections/notes?type=private`,{notes:y});a.notes=i.data.notes.map(l=>{var f,P;return{id:l.id,content:l.content,created_at:l.created_at,creator_name:l.creator_name||((f=l.user)==null?void 0:f.name)||((P=l.creator)==null?void 0:P.name)||"Unknown"}})||[],te("Notes updated successfully!"),await g()}catch(i){console.error("Error updating notes:",i),F("Failed to update notes.")}finally{x.value=!1}},U=y=>y?new Date(y).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A";return me(()=>{}),(y,i)=>(n(),r("div",Xa,[t.canViewProjectNotes?(n(),r("div",Za,[e("div",es,[s(ae,{onClick:k,type:"button",class:"px-5 py-2.5 rounded-lg text-base shadow-sm hover:shadow-md transition-all duration-200",disabled:!t.canAddProjectNotes||x.value||t.isSaving},{default:Y(()=>i[0]||(i[0]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 4v16m8-8H4"})],-1),E(" Add New Note ",-1)])),_:1,__:[0]},8,["disabled"]),s(ae,{onClick:D,disabled:!t.projectId||!t.canAddProjectNotes||x.value||t.isSaving,class:Q([{"opacity-50 cursor-not-allowed":x.value||t.isSaving},"px-6 py-3 rounded-lg text-lg shadow-md hover:shadow-lg transition-all duration-200"])},{default:Y(()=>[x.value||t.isSaving?(n(),r("span",ts,i[1]||(i[1]=[e("svg",{class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),E(" Saving... ",-1)]))):(n(),r("span",as,"Save All Notes"))]),_:1},8,["disabled","class"])]),t.projectId?w("",!0):(n(),r("p",ss," Please save the project first before adding or editing notes. ")),a.notes&&a.notes.length>0?(n(),r("div",ls,[(n(!0),r(ue,null,ce(a.notes,(l,f)=>(n(),r("div",{key:l.id||`new-note-${f}`,class:Q(["relative bg-white p-5 rounded-lg shadow-md border border-gray-200 flex flex-col h-64 transition-all duration-200 ease-in-out hover:shadow-lg",{"opacity-75 cursor-not-allowed":!t.canAddProjectNotes||x.value||t.isSaving}])},[e("div",os,[s(N,{value:`Note ${f+1}`,class:"text-sm font-semibold text-gray-700"},null,8,["value"]),t.canAddProjectNotes?(n(),r("button",{key:0,type:"button",onClick:P=>M(f),class:"p-1 rounded-full text-red-500 hover:bg-red-100 hover:text-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 transition-colors duration-200",title:"Remove note",disabled:x.value||t.isSaving},i[2]||(i[2]=[e("svg",{class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1)]),8,ns)):w("",!0)]),fe(e("textarea",{"onUpdate:modelValue":P=>l.content=P,readonly:!t.canAddProjectNotes||x.value||t.isSaving,placeholder:"Type your note content here...",class:"flex-grow border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-lg shadow-sm block w-full resize-none transition-colors duration-200 p-3 text-sm overflow-auto",rows:"6"},null,8,rs),[[Ge,l.content]]),s(B,{message:t.errors[`notes.${f}.content`]?t.errors[`notes.${f}.content`][0]:"",class:"mt-2"},null,8,["message"]),e("div",is,[e("span",null,[i[3]||(i[3]=E("By: ",-1)),e("span",ds,$(l.creator_name||"Unknown"),1)]),e("span",null,"Last updated: "+$(U(l.created_at)),1)])],2))),128))])):(n(),r("div",us,i[4]||(i[4]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-16 w-16 text-gray-400 mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"1"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1),e("p",{class:"text-lg font-medium"},"No notes found for this project.",-1),e("p",{class:"text-sm mt-2"},'Click "Add New Note" to start creating your project notes.',-1)])))])):(n(),r("div",Qa," You do not have permission to view project notes. "))]))}},ms=["value","rows"],vs={__name:"TextareaInput",props:{modelValue:[String,Number],rows:{type:[String,Number],default:3}},emits:["update:modelValue"],setup(t){const b=_(null);return me(()=>{b.value.hasAttribute("autofocus")&&b.value.focus()}),(a,x)=>(n(),r("textarea",{class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full",value:t.modelValue,rows:t.rows,onInput:x[0]||(x[0]=g=>a.$emit("update:modelValue",g.target.value)),ref_key:"input",ref:b},null,40,ms))}},ps={class:"p-6 bg-gray-50 rounded-xl shadow-lg"},gs={class:"flex justify-between items-center mb-6"},ys={key:0,class:"flex justify-center py-8"},fs={key:1,class:"bg-white p-8 rounded-lg text-center border border-dashed border-gray-300"},bs={key:2,class:"space-y-6"},ws={class:"flex justify-between items-start"},xs={class:"text-xl font-medium text-gray-900"},hs={class:"mt-2 flex items-center flex-wrap space-x-4 text-sm text-gray-500"},_s={key:0,class:"text-gray-700"},js={key:1,class:"text-gray-700"},ks={key:0,class:"mt-4 text-base text-gray-600"},Ps={key:0,class:"flex space-x-2"},$s={class:"p-6 bg-white rounded-lg"},Ss={class:"text-2xl font-bold text-gray-900 mb-6"},Vs={class:"p-4 bg-indigo-50 rounded-lg border border-indigo-200"},Cs={class:"flex justify-end space-x-3 mt-6"},Is={__name:"ProjectDeliverables",props:{projectId:{type:[Number,String],required:!0},errors:{type:Object,default:()=>({})},isSaving:{type:Boolean,default:!1},canManageProjectDeliverables:{type:Boolean,default:!1},canViewProjectDeliverables:{type:Boolean,default:!0}},emits:["checklist-item-toggled"],setup(t,{emit:b}){const a=t,x=_([]),g=_([]),k=_(!0),M=_([]),D=_(!1),U=_("create"),y=_({id:null,name:"",description:"",milestone_id:null,status:"pending",due_date:"",details:{deliverable_type_key:null,checklist:[]}}),i=_({}),l=_(null),f=[{value:"pending",label:"Pending"},{value:"in_progress",label:"In Progress"},{value:"completed",label:"Completed"},{value:"cancelled",label:"Cancelled"}],P=J(()=>{const o=g.value.find(c=>{var u;return c.key===((u=y.value.details)==null?void 0:u.deliverable_type_key)});return(o==null?void 0:o.checklistItemPlaceholder)||"e.g., Task 1, Task 2, Task 3"});ne(()=>a.projectId,L,{immediate:!0});async function L(){if(a.projectId){k.value=!0;try{const o=await de.get(`/api/projects/${a.projectId}/project-deliverables`);x.value=o.data;const c=await de.get(`/api/projects/${a.projectId}/milestones`);M.value=c.data;const u=await de.get("/api/project-deliverable-types");g.value=u.data}catch(o){console.error("Error fetching data:",o),F("Failed to load project data")}finally{k.value=!1}}}function K(){U.value="create",y.value={id:null,name:"",description:"",milestone_id:null,status:"pending",due_date:"",details:{deliverable_type_key:null,checklist:[{name:"",completed:!1}]}},i.value={},l.value=null,D.value=!0}function W(o){U.value="edit",y.value=JSON.parse(JSON.stringify(o)),y.value.details.checklist||(y.value.details.checklist=[]),(y.value.details.checklist.length===0||y.value.details.checklist[y.value.details.checklist.length-1].name!=="")&&y.value.details.checklist.push({name:"",completed:!1}),i.value={},l.value=y.value.details.deliverable_type_key??null,D.value=!0}async function j(o){var O;if(o===l.value)return;if((((O=y.value.details)==null?void 0:O.checklist)||[]).some(R=>((R==null?void 0:R.name)||"").trim()!=="")){if(!await nt("Changing the deliverable type may clear your existing checklist items. Do you want to proceed?",{confirmText:"Proceed",cancelText:"Cancel",type:"warning"})){y.value.details.deliverable_type_key=l.value;return}y.value.details.checklist=[{name:"",completed:!1}]}l.value=o}async function v(){i.value={};try{let o;const c=y.value.details.checklist.filter(O=>O.name.trim()!==""),u={...y.value,details:{...y.value.details,checklist:c}};U.value==="create"?(o=await de.post(`/api/projects/${a.projectId}/project-deliverables`,u),te("Project deliverable created successfully")):(o=await de.put(`/api/project-deliverables/${y.value.id}`,u),te("Project deliverable updated successfully")),await L(),D.value=!1}catch(o){console.error("Error saving deliverable:",o),o.response&&o.response.data&&o.response.data.errors?i.value=o.response.data.errors:F("Failed to save project deliverable")}}async function h(o){if(confirm("Are you sure you want to delete this deliverable?"))try{await de.delete(`/api/project-deliverables/${o}`),te("Project deliverable deleted successfully"),await L()}catch(c){console.error("Error deleting deliverable:",c),F("Failed to delete project deliverable")}}function T(o){return o?new Date(o).toLocaleDateString():"N/A"}return(o,c)=>(n(),r("div",ps,[e("div",gs,[c[10]||(c[10]=e("h3",{class:"text-2xl font-bold text-gray-900"},"Project Deliverables",-1)),t.canManageProjectDeliverables?(n(),le(ae,{key:0,onClick:K,disabled:t.isSaving||k.value},{default:Y(()=>c[9]||(c[9]=[E(" Add Deliverable ",-1)])),_:1,__:[9]},8,["disabled"])):w("",!0)]),k.value?(n(),r("div",ys,c[11]||(c[11]=[e("div",{class:"animate-spin rounded-full h-10 w-10 border-b-2 border-indigo-600"},null,-1)]))):x.value.length===0?(n(),r("div",fs,[c[13]||(c[13]=e("p",{class:"text-gray-600 text-lg"},"No deliverables have been added to this project yet.",-1)),t.canManageProjectDeliverables?(n(),le(ae,{key:0,onClick:K,class:"mt-6"},{default:Y(()=>c[12]||(c[12]=[E(" Add Your First Deliverable ",-1)])),_:1,__:[12]})):w("",!0)])):(n(),r("div",bs,[(n(!0),r(ue,null,ce(x.value,u=>{var O;return n(),r("div",{key:u.id,class:"bg-white border border-gray-200 rounded-xl p-6 shadow-sm hover:shadow-lg transition-all duration-300"},[e("div",ws,[e("div",null,[e("h4",xs,$(u.name),1),e("div",hs,[e("span",{class:Q({"font-medium py-1 px-3 rounded-full text-white":!0,"bg-yellow-500":u.status==="pending","bg-blue-500":u.status==="in_progress","bg-green-500":u.status==="completed","bg-red-500":u.status==="cancelled"})},$(u.status.replace("_"," ").toUpperCase()),3),u.milestone?(n(),r("span",_s,[c[14]||(c[14]=e("span",{class:"font-semibold"},"Milestone:",-1)),E(" "+$(u.milestone.name),1)])):w("",!0),u.due_date?(n(),r("span",js,[c[15]||(c[15]=e("span",{class:"font-semibold"},"Due:",-1)),E(" "+$(T(u.due_date)),1)])):w("",!0)]),u.description?(n(),r("p",ks,$(u.description),1)):w("",!0),(O=u.details)!=null&&O.checklist&&u.details.checklist.length>0?(n(),le(_t,{key:1,items:u.details.checklist,"api-endpoint":`/api/project-deliverables/${u.id}`,title:"Deliverable Checklist:","payload-transformer":(R,C)=>({...u,details:{...u.details,checklist:R}}),onItemToggled:R=>o.$emit("checklist-item-toggled",{deliverable:u,index:R.index,completed:R.completed})},null,8,["items","api-endpoint","payload-transformer","onItemToggled"])):w("",!0)]),t.canManageProjectDeliverables?(n(),r("div",Ps,[s(be,{onClick:R=>W(u),size:"sm"},{default:Y(()=>c[16]||(c[16]=[E(" Edit ",-1)])),_:2,__:[16]},1032,["onClick"]),s(xt,{onClick:R=>h(u.id),size:"sm"},{default:Y(()=>c[17]||(c[17]=[E(" Delete ",-1)])),_:2,__:[17]},1032,["onClick"])])):w("",!0)])])}),128))])),s(ht,{show:D.value,onClose:c[8]||(c[8]=u=>D.value=!1),maxWidth:"2xl"},{default:Y(()=>{var u,O,R,C,p;return[e("div",$s,[e("h3",Ss,$(U.value==="create"?"Add New Deliverable":"Edit Deliverable"),1),e("form",{onSubmit:ke(v,["prevent"]),class:"space-y-6"},[e("div",null,[s(N,{for:"name",value:"Name"}),s(G,{id:"name",modelValue:y.value.name,"onUpdate:modelValue":c[0]||(c[0]=d=>y.value.name=d),type:"text",class:"mt-1 block w-full",required:""},null,8,["modelValue"]),s(B,{message:(u=i.value.name)==null?void 0:u[0],class:"mt-2"},null,8,["message"])]),e("div",null,[s(N,{for:"description",value:"Description"}),s(vs,{id:"description",modelValue:y.value.description,"onUpdate:modelValue":c[1]||(c[1]=d=>y.value.description=d),class:"mt-1 block w-full",rows:"3"},null,8,["modelValue"]),s(B,{message:(O=i.value.description)==null?void 0:O[0],class:"mt-2"},null,8,["message"])]),e("div",null,[s(N,{for:"milestone_id",value:"Milestone (Optional)"}),s(Z,{id:"milestone_id",modelValue:y.value.milestone_id,"onUpdate:modelValue":c[2]||(c[2]=d=>y.value.milestone_id=d),options:M.value,valueKey:"id",labelKey:"name",placeholder:"Select a milestone",class:"mt-1 block w-full"},null,8,["modelValue","options"]),s(B,{message:(R=i.value.milestone_id)==null?void 0:R[0],class:"mt-2"},null,8,["message"])]),e("div",null,[s(N,{for:"status",value:"Status"}),s(Z,{id:"status",modelValue:y.value.status,"onUpdate:modelValue":c[3]||(c[3]=d=>y.value.status=d),options:f,valueKey:"value",labelKey:"label",placeholder:"Select a Status",class:"mt-1 block w-full"},null,8,["modelValue"]),s(B,{message:(C=i.value.status)==null?void 0:C[0],class:"mt-2"},null,8,["message"])]),e("div",null,[s(N,{for:"due_date",value:"Due Date (Optional)"}),s(G,{id:"due_date",modelValue:y.value.due_date,"onUpdate:modelValue":c[4]||(c[4]=d=>y.value.due_date=d),type:"date",class:"mt-1 block w-full"},null,8,["modelValue"]),s(B,{message:(p=i.value.due_date)==null?void 0:p[0],class:"mt-2"},null,8,["message"])]),e("div",Vs,[c[18]||(c[18]=e("h4",{class:"text-lg font-semibold text-indigo-800 mb-4"},"Deliverable Checklist",-1)),e("div",null,[s(N,{for:"deliverable_type_key",value:"Deliverable Type"}),s(Z,{id:"deliverable_type_key",modelValue:y.value.details.deliverable_type_key,"onUpdate:modelValue":[c[5]||(c[5]=d=>y.value.details.deliverable_type_key=d),j],options:g.value,valueKey:"key",labelKey:"name",placeholder:"Select a Deliverable Type",class:"mt-1 block w-full",required:""},null,8,["modelValue","options"])]),s(ft,{modelValue:y.value.details.checklist,"onUpdate:modelValue":c[6]||(c[6]=d=>y.value.details.checklist=d),placeholder:P.value,label:"Checklist Items",containerClass:"mt-4"},null,8,["modelValue","placeholder"])]),e("div",Cs,[s(be,{onClick:c[7]||(c[7]=d=>D.value=!1),disabled:t.isSaving},{default:Y(()=>c[19]||(c[19]=[E(" Cancel ",-1)])),_:1,__:[19]},8,["disabled"]),s(ae,{type:"submit",disabled:t.isSaving},{default:Y(()=>[E($(U.value==="create"?"Create":"Update"),1)]),_:1},8,["disabled"])])],32)])]}),_:1},8,["show"])]))}},Us={class:"p-6 bg-white rounded-lg font-inter"},Ds={key:0,class:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4",role:"alert"},Ms={class:"block sm:inline ml-2"},As={key:1,class:"flex items-center justify-center py-8"},Ns={key:2},Ts={key:0,class:"bg-gradient-to-r from-blue-500 to-indigo-600 text-white p-6 rounded-lg shadow-md mb-6"},Bs={class:"flex items-center justify-between"},Rs={class:"text-3xl font-bold mt-1"},Es={class:"text-sm opacity-90 mt-2"},Os={class:"font-semibold"},Fs={class:"font-semibold"},Ls={key:1,class:"bg-gray-100 text-gray-600 p-4 rounded-lg shadow-sm mb-6 text-center"},zs={class:"bg-gray-50 p-6 rounded-lg shadow-sm mb-6 border border-gray-200"},qs={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},Ks=["disabled"],Gs=["value"],Hs={class:"bg-gray-50 p-6 rounded-lg shadow-sm mb-6 border border-gray-200"},Ys={class:"mb-4"},Ws={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-1 gap-4"},Js={class:"flex items-center justify-between"},Xs=["for"],Qs={class:"ms-2 text-base font-medium text-gray-800"},Zs=["onClick"],el={key:0,class:"mt-4 pt-4 border-t border-gray-200"},tl={class:"grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4"},al={class:"grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4"},sl=["id","onUpdate:modelValue","disabled"],ll={key:0,class:"mt-4 p-4 bg-blue-50 rounded-lg border border-blue-200"},ol={class:"flex justify-between items-center mb-3"},nl={class:"space-y-4"},rl={class:"flex justify-between items-center mb-2"},il=["onClick"],dl={class:"grid grid-cols-1 sm:grid-cols-2 gap-4"},ul=["onClick"],cl={key:0},ml={class:"mt-6 pt-4 border-t border-gray-200"},vl={key:1,class:"mt-4 flex items-center"},pl={key:2,class:"mt-6 flex justify-end"},gl={__name:"ServicesAndPaymentForm",props:{projectId:{type:[Number,String],required:!0},paymentTypeOptions:{type:Array,required:!0},canManageProjectServicesAndPayments:{type:Boolean,required:!0},canViewProjectServicesAndPayments:{type:Boolean,required:!0}},emits:["updated"],setup(t,{emit:b}){const a=t,x=b,g=_({}),k=_(!1),M=[{value:"PKR",label:"PKR"},{value:"AUD",label:"AUD"},{value:"INR",label:"INR"},{value:"USD",label:"USD"},{value:"EUR",label:"EUR"},{value:"GBP",label:"GBP"}],U=_([...[{value:"Website Designing",label:"Website Designing"},{value:"SEO",label:"SEO"},{value:"Social Media",label:"Social Media"},{value:"Content Writing",label:"Content Writing"},{value:"Graphic Design",label:"Graphic Design"}]]),y=_(""),i=_(!1),l=we({services:[],service_details:[],payment_type:"one_off",currency:"AUD"}),f=we({}),P=J(()=>{let C=0;return l.services.forEach(p=>{const d=o(p);d&&d.amount&&(C+=parseFloat(d.amount))}),C.toFixed(2)}),L=J(()=>{let C=null,p=null;const d=new Date;return d.setHours(0,0,0,0),l.service_details.forEach(A=>{A.frequency==="one_off"&&A.payment_breakdown&&A.payment_breakdown.forEach(z=>{var q;if(z.due_date){const se=new Date(z.due_date);se.setHours(0,0,0,0),se>=d&&(!C||se<C.date)&&(C={date:se,serviceId:A.service_id,paymentLabel:z.label},p=((q=U.value.find(X=>X.value===A.service_id))==null?void 0:q.label)||A.service_id)}})}),C?{date:C.date.toLocaleDateString(),serviceLabel:p,paymentLabel:C.paymentLabel}:null}),K=J(()=>{const C=l.services.filter(p=>{const d=o(p);return d&&d.frequency!=="monthly"});return C.length===0?!0:C.every(p=>c(p)===100)}),W=J(()=>!a.projectId||!a.canManageProjectServicesAndPayments||!K.value),j=()=>{const C=y.value.trim();C&&!U.value.some(p=>p.label.toLowerCase()===C.toLowerCase())&&(U.value.push({value:C,label:C}),y.value="",i.value=!1)},v=async()=>{if(a.projectId){k.value=!0;try{const p=(await window.axios.get(`/api/projects/${a.projectId}/sections/services-payment`)).data;return l.services=p.services||[],l.service_details=p.service_details||[],l.payment_type=p.payment_type||"one_off",l.currency=p.currency||"AUD",l.services.forEach(d=>{U.value.some(A=>A.value===d)||U.value.push({value:d,label:d}),f[d]=!1}),l.service_details.forEach(d=>{if(d.payment_breakdown&&!Array.isArray(d.payment_breakdown)){const A=d.payment_breakdown;d.payment_breakdown=[{label:"First",percentage:parseInt(A.first)||30,due_date:null},{label:"Second",percentage:parseInt(A.second)||30,due_date:null},{label:"Third",percentage:parseInt(A.third)||40,due_date:null}]}else!d.payment_breakdown||d.payment_breakdown.length===0?d.payment_breakdown=[{label:"Payment 1",percentage:100,due_date:null}]:d.payment_breakdown.forEach(A=>{A.due_date===void 0&&(A.due_date=null)})}),p}catch(C){return console.error("Error fetching services and payment data:",C),g.value.general="Failed to fetch services and payment data.",null}finally{k.value=!1}}},h=async()=>{g.value={},k.value=!0;try{const C={services:l.services,service_details:l.service_details,total_amount:parseFloat(P.value),payment_type:l.payment_type,currency:l.currency},p=await window.axios.put(`/api/projects/${a.projectId}/sections/services-payment`,C);te("Services and payment information updated successfully!"),x("updated")}catch(C){C.response&&C.response.status===422?g.value=C.response.data.errors:C.response&&C.response.data.message?g.value.general=C.response.data.message:(g.value.general="Failed to update services and payment information.",console.error("Error:",C))}finally{k.value=!1}},T=(C,p)=>{p?(l.service_details.some(d=>d.service_id===C)||l.service_details.push({service_id:C,amount:"",frequency:"one_off",start_date:"",payment_breakdown:[{label:"Payment 1",percentage:100,due_date:null}],currency:l.currency}),f[C]=!0):(l.service_details=l.service_details.filter(d=>d.service_id!==C),f[C]=!1)},o=C=>{let p=l.service_details.find(d=>d.service_id===C);if(!p)p={service_id:C,amount:"",frequency:"one_off",start_date:"",payment_breakdown:[{label:"Payment 1",percentage:100,due_date:null}],currency:l.currency},l.service_details.push(p);else if(p.payment_breakdown&&!Array.isArray(p.payment_breakdown)){const d=p.payment_breakdown;p.payment_breakdown=[{label:"First",percentage:parseInt(d.first)||30,due_date:null},{label:"Second",percentage:parseInt(d.second)||30,due_date:null},{label:"Third",percentage:parseInt(d.third)||40,due_date:null}]}else!p.payment_breakdown||p.payment_breakdown.length===0?p.payment_breakdown=[{label:"Payment 1",percentage:100,due_date:null}]:p.payment_breakdown.forEach(d=>{d.due_date===void 0&&(d.due_date=null)});return p},c=C=>{const p=o(C);return!p.payment_breakdown||!Array.isArray(p.payment_breakdown)?0:p.payment_breakdown.reduce((d,A)=>d+(parseInt(A.percentage)||0),0)},u=C=>{const p=o(C);if(p.payment_breakdown||(p.payment_breakdown=[]),!Array.isArray(p.payment_breakdown)){const z=p.payment_breakdown;p.payment_breakdown=[{label:"First",percentage:parseInt(z.first)||30,due_date:null},{label:"Second",percentage:parseInt(z.second)||30,due_date:null},{label:"Third",percentage:parseInt(z.third)||40,due_date:null}]}const d=p.payment_breakdown.length;let A=0;if(d>0){const z=p.payment_breakdown[d-1];A=Math.floor(z.percentage/2),z.percentage-=A}else A=100;p.payment_breakdown.push({label:`Payment ${d+1}`,percentage:A,due_date:null})},O=(C,p)=>{const d=o(C);if(!d.payment_breakdown||!Array.isArray(d.payment_breakdown)||d.payment_breakdown.length<=1)return;const A=parseInt(d.payment_breakdown[p].percentage)||0;if(d.payment_breakdown.splice(p,1),A>0&&d.payment_breakdown.length>0){const z=p>0&&p<=d.payment_breakdown.length?p-1:0;d.payment_breakdown[z].percentage=(parseInt(d.payment_breakdown[z].percentage)||0)+A}d.payment_breakdown.forEach((z,q)=>{z.label=`Payment ${q+1}`})},R=C=>{f[C]=!f[C]};return ne(()=>a.projectId,C=>{C&&v()},{immediate:!0}),(C,p)=>(n(),r("div",Us,[g.value.general?(n(),r("div",Ds,[p[6]||(p[6]=e("strong",{class:"font-bold"},"Error!",-1)),e("span",Ms,$(g.value.general),1)])):w("",!0),k.value?(n(),r("div",As,p[7]||(p[7]=[e("svg",{class:"animate-spin -ml-1 mr-3 h-8 w-8 text-blue-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),e("span",{class:"text-gray-600"},"Loading services and payment data...",-1)]))):(n(),r("div",Ns,[L.value?(n(),r("div",Ts,[e("div",Bs,[e("div",null,[p[10]||(p[10]=e("p",{class:"text-sm opacity-90"},"Next Payment Due",-1)),e("p",Rs,$(L.value.date),1),e("p",Es,[p[8]||(p[8]=E(" For: ",-1)),e("span",Os,$(L.value.serviceLabel),1),p[9]||(p[9]=E(" - ",-1)),e("span",Fs,$(L.value.paymentLabel),1)])]),p[11]||(p[11]=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-12 w-12 opacity-70",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1))])])):(n(),r("div",Ls," No upcoming payment due dates found for one-off services. ")),e("div",zs,[p[13]||(p[13]=e("h4",{class:"text-xl font-semibold text-gray-700 mb-4"},"Overall Project Payment Details",-1)),e("div",qs,[e("div",null,[s(N,{for:"calculated_total_amount",value:"Calculated Total Amount"}),s(G,{id:"calculated_total_amount",type:"text",class:"mt-1 block w-full bg-gray-100 cursor-not-allowed",value:P.value,disabled:""},null,8,["value"]),p[12]||(p[12]=e("p",{class:"text-sm text-gray-500 mt-1"},"This amount is automatically calculated from selected services.",-1))]),e("div",null,[s(N,{for:"payment_type",value:"Payment Type"}),fe(e("select",{id:"payment_type",class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full p-2.5","onUpdate:modelValue":p[0]||(p[0]=d=>l.payment_type=d),required:"",disabled:!t.canManageProjectServicesAndPayments},[(n(!0),r(ue,null,ce(t.paymentTypeOptions,d=>(n(),r("option",{key:d.value,value:d.value},$(d.label),9,Gs))),128))],8,Ks),[[Oe,l.payment_type]]),s(B,{message:g.value.payment_type?g.value.payment_type[0]:"",class:"mt-2"},null,8,["message"])]),e("div",null,[s(N,{for:"overall_currency",value:"Overall Project Currency"}),s(Z,{id:"overall_currency",modelValue:l.currency,"onUpdate:modelValue":p[1]||(p[1]=d=>l.currency=d),options:M,"value-key":"value","label-key":"label",class:"w-full mt-1",disabled:!t.canManageProjectServicesAndPayments},null,8,["modelValue","disabled"]),s(B,{message:g.value.currency?g.value.currency[0]:"",class:"mt-2"},null,8,["message"])])])]),e("div",Hs,[p[20]||(p[20]=e("h4",{class:"text-xl font-semibold text-gray-700 mb-4"},"Manage Services",-1)),e("div",Ys,[s(N,{for:"services",value:"Select Services",class:"mb-2"}),e("div",Ws,[(n(!0),r(ue,null,ce(U.value,d=>(n(),r("div",{key:d.value,class:"bg-white p-4 rounded-lg shadow-sm border border-gray-200"},[e("div",Js,[e("label",{for:`service_${d.value}`,class:"flex items-center cursor-pointer"},[s(jt,{id:`service_${d.value}`,value:d.value,checked:l.services,"onUpdate:checked":[p[2]||(p[2]=A=>l.services=A),A=>T(d.value,A)],disabled:!t.canManageProjectServicesAndPayments},null,8,["id","value","checked","onUpdate:checked","disabled"]),e("span",Qs,$(d.label),1)],8,Xs),(l.services||[]).includes(d.value)?(n(),r("button",{key:0,onClick:A=>R(d.value),type:"button",class:Q(["text-gray-500 hover:text-gray-700 transition-transform duration-200",{"rotate-180":f[d.value]}])},p[14]||(p[14]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"})],-1)]),10,Zs)):w("",!0)]),(l.services||[]).includes(d.value)&&f[d.value]?(n(),r("div",el,[e("div",tl,[e("div",null,[s(N,{for:`service_amount_${d.value}`,value:"Amount"},null,8,["for"]),s(G,{id:`service_amount_${d.value}`,type:"number",step:"0.01",placeholder:"Service Amount",class:"w-full mt-1",modelValue:o(d.value).amount,"onUpdate:modelValue":A=>o(d.value).amount=A,disabled:!t.canManageProjectServicesAndPayments},null,8,["id","modelValue","onUpdate:modelValue","disabled"])]),e("div",null,[s(N,{for:`service_currency_${d.value}`,value:"Currency"},null,8,["for"]),s(Z,{id:`service_currency_${d.value}`,modelValue:o(d.value).currency,"onUpdate:modelValue":A=>o(d.value).currency=A,options:M,"value-key":"value","label-key":"label",class:"w-full mt-1",disabled:!t.canManageProjectServicesAndPayments},null,8,["id","modelValue","onUpdate:modelValue","disabled"])])]),e("div",al,[e("div",null,[s(N,{for:`service_frequency_${d.value}`,value:"Frequency"},null,8,["for"]),fe(e("select",{id:`service_frequency_${d.value}`,class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full p-2.5","onUpdate:modelValue":A=>o(d.value).frequency=A,disabled:!t.canManageProjectServicesAndPayments},p[15]||(p[15]=[e("option",{value:"monthly"},"Monthly",-1),e("option",{value:"one_off"},"One off",-1)]),8,sl),[[Oe,o(d.value).frequency]])]),e("div",null,[s(N,{for:`service_start_date_${d.value}`,value:"Start Date"},null,8,["for"]),s(G,{id:`service_start_date_${d.value}`,type:"date",class:"w-full mt-1",modelValue:o(d.value).start_date,"onUpdate:modelValue":A=>o(d.value).start_date=A,disabled:!t.canManageProjectServicesAndPayments},null,8,["id","modelValue","onUpdate:modelValue","disabled"])])]),o(d.value).frequency!=="monthly"?(n(),r("div",ll,[e("div",ol,[s(N,{value:"Payment Breakdown (%)",class:"text-base font-medium text-blue-800"}),t.canManageProjectServicesAndPayments?(n(),le(ae,{key:0,type:"button",onClick:A=>u(d.value),class:"px-4 py-2 text-sm"},{default:Y(()=>p[16]||(p[16]=[E(" + Add Payment Step ",-1)])),_:2,__:[16]},1032,["onClick"])):w("",!0)]),e("div",nl,[(n(!0),r(ue,null,ce(o(d.value).payment_breakdown,(A,z)=>(n(),r("div",{key:z,class:"bg-white p-4 rounded-md shadow-sm border border-blue-100"},[e("div",rl,[s(N,{for:`payment_label_${z}_${d.value}`,value:A.label,class:"font-semibold"},null,8,["for","value"]),t.canManageProjectServicesAndPayments&&o(d.value).payment_breakdown.length>1?(n(),r("button",{key:0,type:"button",class:"text-red-500 hover:text-red-700 p-1 rounded-full hover:bg-red-100 transition-colors",onClick:q=>O(d.value,z),title:"Remove payment step"},p[17]||(p[17]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 011-1h4a1 1 0 110 2H8a1 1 0 01-1-1zm-1 3a1 1 0 100 2h8a1 1 0 100-2H6z","clip-rule":"evenodd"})],-1)]),8,il)):w("",!0)]),e("div",dl,[e("div",null,[s(N,{for:`payment_percentage_${z}_${d.value}`,value:"Percentage (%)",class:"text-sm"},null,8,["for"]),s(G,{id:`payment_percentage_${z}_${d.value}`,type:"number",min:"0",max:"100",class:"w-full mt-1",modelValue:A.percentage,"onUpdate:modelValue":q=>A.percentage=q,modelModifiers:{number:!0},onInput:q=>{A.percentage=Math.max(0,Math.min(100,parseInt(q.target.value)||0))},disabled:!t.canManageProjectServicesAndPayments},null,8,["id","modelValue","onUpdate:modelValue","onInput","disabled"])]),e("div",null,[s(N,{for:`payment_due_date_${z}_${d.value}`,value:"Due Date (Optional)",class:"text-sm"},null,8,["for"]),s(G,{id:`payment_due_date_${z}_${d.value}`,type:"date",class:"w-full mt-1",modelValue:A.due_date,"onUpdate:modelValue":q=>A.due_date=q,disabled:!t.canManageProjectServicesAndPayments},null,8,["id","modelValue","onUpdate:modelValue","disabled"]),t.canManageProjectServicesAndPayments&&A.due_date?(n(),r("button",{key:0,type:"button",class:"text-xs text-red-500 hover:text-red-700 mt-1",onClick:q=>A.due_date=null}," Clear Date ",8,ul)):w("",!0)])])]))),128))]),e("div",{class:Q(["text-sm mt-4 p-2 rounded-md",{"bg-green-100 text-green-700":c(d.value)===100,"bg-red-100 text-red-700 font-bold":c(d.value)!==100}])},[E(" Total Percentage: "+$(c(d.value))+"% ",1),c(d.value)!==100?(n(),r("span",cl," (Total must be 100%) ")):w("",!0)],2)])):w("",!0)])):w("",!0)]))),128))])]),e("div",ml,[t.canManageProjectServicesAndPayments&&!i.value?(n(),r("button",{key:0,type:"button",class:"inline-flex items-center px-4 py-2 bg-blue-600 border border-transparent rounded-md font-semibold text-xs text-white uppercase tracking-widest hover:bg-blue-700 active:bg-blue-900 focus:outline-none focus:border-blue-900 focus:ring ring-blue-300 disabled:opacity-25 transition ease-in-out duration-150 shadow-md",onClick:p[3]||(p[3]=d=>i.value=!0)},p[18]||(p[18]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 4v16m8-8H4"})],-1),E(" Add New Service/Department ",-1)]))):w("",!0),t.canManageProjectServicesAndPayments&&i.value?(n(),r("div",vl,[s(G,{type:"text",class:"flex-grow mr-2 border-gray-300 rounded-md shadow-sm p-2.5",modelValue:y.value,"onUpdate:modelValue":p[4]||(p[4]=d=>y.value=d),placeholder:"Enter new service/department name",onKeyup:rt(j,["enter"])},null,8,["modelValue"]),s(ae,{onClick:j},{default:Y(()=>p[19]||(p[19]=[E("Add",-1)])),_:1,__:[19]}),e("button",{type:"button",class:"ml-2 text-sm text-gray-500 hover:text-gray-700 px-3 py-2 rounded-md transition-colors",onClick:p[5]||(p[5]=d=>{i.value=!1,y.value=""})}," Cancel ")])):w("",!0)]),s(B,{message:g.value.services?g.value.services[0]:"",class:"mt-2"},null,8,["message"])]),t.canManageProjectServicesAndPayments?(n(),r("div",pl,[s(ae,{onClick:h,disabled:W.value,class:Q([{"opacity-50 cursor-not-allowed":W.value},"px-6 py-3 text-base"])},{default:Y(()=>p[21]||(p[21]=[E(" Update Services & Payment ",-1)])),_:1,__:[21]},8,["disabled","class"])])):w("",!0)]))]))}},yl={class:"relative"},fl={class:"flex flex-wrap items-center gap-2 mb-2 p-2 border border-gray-300 rounded-lg bg-white min-h-[44px] focus-within:border-indigo-500 focus-within:ring-1 focus-within:ring-indigo-500 transition-all duration-150"},bl={key:0,class:"inline-flex items-center px-3 py-1 text-sm font-medium bg-indigo-100 text-indigo-800 rounded-full shadow-sm"},wl={key:0,class:"absolute z-20 w-full bg-white border border-gray-300 rounded-lg shadow-lg max-h-60 overflow-y-auto mt-1 transform-gpu basic-prop-suggestions"},xl=["onMousedown"],hl={key:1,class:"px-4 py-2 text-sm text-gray-500"},_l={__name:"BasicPropertyInput",props:{modelValue:{type:[String,Number,null],default:null},label:{type:String,default:"Type"},placeholder:{type:String,default:"Select or type a value"},error:{type:String,default:""},disabled:{type:Boolean,default:!1},required:{type:Boolean,default:!1},searchUrl:{type:String,required:!0}},emits:["update:modelValue","change"],setup(t,{emit:b}){const a=t,x=b,g=_(""),k=_(null),M=_(!1),D=_([]),U=_(null),i=kt(async j=>{try{const v=`${a.searchUrl}?query=${encodeURIComponent(j||"")}`,{data:h}=await de.get(v);D.value=Array.isArray(h)?h.map(T=>({value:T.id,label:T.name})):[],M.value=!0}catch{D.value=[],M.value=!1}},250);ne(()=>a.modelValue,j=>{if(!j){k.value=null;return}if(typeof j=="string"&&j.startsWith("new_")){const v=j.split("_");v.shift(),v.length>0&&v.pop();const h=v.join(" ").replace(/-/g," ");k.value={value:j,label:h}}else{const v=D.value.find(h=>String(h.value)===String(j));v&&(k.value=v)}},{immediate:!0});const l=j=>{a.disabled||(k.value=j,x("update:modelValue",j.value),x("change",j.value),g.value="",M.value=!1,Se(()=>{var v;return(v=U.value)==null?void 0:v.focus()}))},f=()=>{if(a.disabled)return;const j=g.value.trim();if(!j)return;const h={value:`new_${j.replace(/\s+/g,"-").toLowerCase()}_${Date.now()}`,label:j};k.value=h,x("update:modelValue",h.value),x("change",h.value),g.value="",M.value=!1,Se(()=>{var T;return(T=U.value)==null?void 0:T.focus()})},P=j=>{var v;(v=j==null?void 0:j.stopPropagation)==null||v.call(j),!a.disabled&&(k.value=null,x("update:modelValue",null),x("change",null),g.value="",M.value=!1,Se(()=>{var h;return(h=U.value)==null?void 0:h.focus()}))},L=j=>{var v,h;j.key==="Enter"?(j.preventDefault(),f()):j.key==="Escape"?(M.value=!1,g.value="",(h=(v=U.value)==null?void 0:v.blur)==null||h.call(v)):j.key==="Backspace"&&g.value===""&&k.value&&P(j)},K=j=>{g.value=j.target.value,M.value=!0,i(g.value)},W=j=>{var h;const v=((h=U.value)==null?void 0:h.$el)||U.value;v&&!v.contains(j.target)&&!j.target.closest(".basic-prop-suggestions")&&(M.value=!1,g.value="")};return me(()=>{document.addEventListener("click",W),i("")}),it(()=>{document.removeEventListener("click",W)}),(j,v)=>(n(),r("div",yl,[s(N,{value:t.label,class:"mb-1"},null,8,["value"]),e("div",fl,[k.value?(n(),r("span",bl,[E($(k.value.label)+" ",1),t.disabled?w("",!0):(n(),r("button",{key:0,type:"button",onClick:P,class:"ml-2 -mr-1 text-indigo-500 hover:text-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 rounded-full p-0.5","aria-label":"Remove selected"},v[2]||(v[2]=[e("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])))])):w("",!0),s(G,{ref_key:"inputRef",ref:U,type:"text",placeholder:k.value?"":t.placeholder,modelValue:g.value,"onUpdate:modelValue":v[0]||(v[0]=h=>g.value=h),onFocus:v[1]||(v[1]=h=>M.value=!0),onKeydown:L,onInput:K,class:"flex-grow min-w-[150px] border-none focus:ring-0 shadow-none p-0 bg-transparent text-gray-900",disabled:t.disabled},null,8,["placeholder","modelValue","disabled"])]),M.value&&!t.disabled?(n(),r("div",wl,[(n(!0),r(ue,null,ce(D.value,h=>(n(),r("div",{key:h.value,onMousedown:ke(T=>l(h),["stop","prevent"]),class:Q(["px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 cursor-pointer transition-colors duration-100",{"bg-indigo-50 text-indigo-700":k.value&&h.value===k.value.value}])},$(h.label),43,xl))),128)),g.value.trim()!==""&&!D.value.some(h=>h.label.toLowerCase()===g.value.toLowerCase())?(n(),r("div",{key:0,onMousedown:ke(f,["stop","prevent"]),class:"px-4 py-2 text-sm text-indigo-700 bg-indigo-50 hover:bg-indigo-100 cursor-pointer border-t border-indigo-200 font-semibold transition-colors duration-100"},' Add new: "'+$(g.value.trim())+'" ',33)):w("",!0),D.value.length===0&&g.value.trim()===""&&!k.value?(n(),r("div",hl," Start typing to search or select an option. ")):w("",!0)])):w("",!0),s(B,{message:t.error,class:"mt-2"},null,8,["message"])]))}},jl=Pt(_l,[["__scopeId","data-v-45b08a99"]]),kl={class:"p-6 bg-white rounded-lg"},Pl={key:0,class:"text-red-600 text-sm mb-4"},$l={key:1,class:"mb-6 p-4 bg-gray-50 rounded-md"},Sl={class:"mb-6"},Vl={class:"flex justify-end items-center mb-4"},Cl={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},Il={class:"p-3 bg-blue-100 rounded-md"},Ul={class:"text-lg font-bold text-blue-800"},Dl={class:"flex items-center justify-between"},Ml={key:0,class:"mt-1"},Al={class:"text-lg font-bold text-indigo-800"},Nl={key:0,class:"text-xs text-gray-600"},Tl={key:1,class:"mt-2 space-y-2"},Bl={class:"p-3 bg-red-100 rounded-md"},Rl={class:"text-lg font-bold text-red-800"},El={class:"text-xs text-gray-500"},Ol={class:"p-3 bg-purple-100 rounded-md"},Fl={class:"text-lg font-bold text-purple-800"},Ll={class:"p-3 bg-green-100 rounded-md"},zl={class:"text-lg font-bold text-green-800"},ql={class:"p-3 bg-yellow-100 rounded-md col-span-full md:col-span-1"},Kl={class:"text-lg font-bold text-yellow-800"},Gl={class:"text-xs text-gray-500"},Hl={class:"p-3 bg-orange-100 rounded-md col-span-full md:col-span-1"},Yl={class:"text-lg font-bold text-orange-900 mt-1"},Wl={class:"text-xs text-gray-500"},Jl={class:"p-3 bg-gray-100 rounded-md col-span-full md:col-span-1"},Xl={class:"text-lg font-bold mt-1 text-green-400"},Ql={class:"p-3 bg-gray-100 rounded-md col-span-full md:col-span-1"},Zl={class:"text-lg font-bold text-red-400 mt-1"},eo={class:"grid grid-cols-1 gap-4 md:grid-cols-2"},to={key:0},ao={key:1},so={class:"mt-4 flex justify-end"},lo={key:2},oo={key:0,class:"space-y-3"},no={key:1,class:"p-4 bg-gray-50 rounded-md text-gray-600 text-center"},ro={key:2,class:"space-y-4"},io={class:"flex justify-between items-start mb-2"},uo={class:"flex-grow"},co={class:"font-medium text-gray-900 text-lg"},mo={class:"text-xs text-gray-500 mt-1"},vo={key:0},po={class:"flex-shrink-0 text-right"},go={key:0,class:"text-sm text-gray-600"},yo={class:"flex justify-between items-end text-xs text-gray-600 mt-2 border-t border-gray-200 pt-2"},fo={key:0,class:"block"},bo={key:1,class:"block"},wo={key:2,class:"block mt-1 text-gray-500"},xo={class:"flex space-x-2 mt-2"},ho={key:0,class:"mt-4 p-4 bg-blue-50 rounded-md border border-blue-200"},_o={class:"text-md font-medium text-gray-900 mb-4"},jo={class:"mb-4"},ko={class:"mb-4"},Po={class:"flex items-center"},$o=["disabled"],So={class:"text-sm text-gray-700"},Vo={key:0,class:"mb-4"},Co={class:"flex justify-end space-x-2"},Ke=.25,Io={__name:"ProjectTransactions",props:{projectId:{type:[Number,String],required:!0},userProjectRole:{type:Object,default:()=>({})}},setup(t){const b=t,{canDo:a,canManage:x}=Ie(()=>b.projectId),g=x("project_expenses",b.userProjectRole),k=x("project_income",b.userProjectRole),M=a("view_project_transactions",b.userProjectRole),D=_([]),U=_([]),y=_({}),i=_(""),l=_(!1),f=_(null),P=_(""),L=_(!1),K=_({}),W=_(null),j=_(""),v=_({description:"",amount:"",currency:"PKR",user_id:null,hours_spent:"",type:"expense",transaction_type:null}),h=Ye,T=[{value:"PKR",label:"PKR"},{value:"AUD",label:"AUD"},{value:"INR",label:"INR"},{value:"USD",label:"USD"},{value:"EUR",label:"EUR"},{value:"GBP",label:"GBP"}],o=_(null),c=_("PKR"),u=_(!1),O=_({}),R=async()=>{try{const{data:S}=await window.axios.get(`/api/projects/${b.projectId}/expendable-budget`);o.value=S.total_budget,c.value=(S.currency||"PKR").toUpperCase()}catch(S){console.error("Error fetching expendable budget",S)}},C=async()=>{var S;if(O.value={},o.value===null||o.value===""||isNaN(Number(o.value))||Number(o.value)<0){O.value.amount=["Please enter a valid amount"];return}try{await window.axios.patch(`/api/projects/${b.projectId}/expendable-budget`,{total_expendable_amount:Number(o.value),currency:c.value}),te("Expendable budget updated"),u.value=!1}catch(m){((S=m.response)==null?void 0:S.status)===422?O.value=m.response.data.errors||{general:[m.response.data.message]}:(F("Failed to update expendable budget"),console.error(m))}},p=[{value:"expense",label:"Expense"},{value:"income",label:"Income"},{value:"bonus",label:"Bonus"}],d=J(()=>U.value.map(S=>({value:S.id,label:S.name||"Unknown User"}))),A=()=>{const S=new Date,m=S.getFullYear(),H=String(S.getMonth()+1).padStart(2,"0"),re=String(S.getDate()).padStart(2,"0");return`${m}-${H}-${re}`},z=async()=>{if(!(!b.projectId||!M.value))try{const S=await window.axios.get(`/api/projects/${b.projectId}/sections/clients-users`);U.value=S.data.users||[]}catch(S){i.value="Failed to fetch users.",console.error("Error fetching users:",S)}},q=async()=>{if(!(!b.projectId||!M.value)){l.value=!0;try{(!oe.value||Object.keys(oe.value).length===0)&&await Ve();const S=await window.axios.get(`/api/projects/${b.projectId}/sections/transactions`);D.value=S.data}catch(S){i.value="Failed to fetch transactions.",console.error("Error fetching transactions:",S)}finally{l.value=!1}}},se=async()=>{var S;if(!g.value&&!k.value){F("You do not have permission to manage transactions.");return}if(!v.value.amount||isNaN(v.value.amount)){y.value.amount=["Please enter a valid amount"];return}if(v.value.type==="expense"&&!g.value){F("You do not have permission to add expenses.");return}if(v.value.type==="income"&&!k.value){F("You do not have permission to add income.");return}if(v.value.type==="bonus"&&!g.value){F("You do not have permission to add bonuses.");return}y.value={},i.value="",l.value=!0;try{if(y.value={},!v.value.transaction_type){y.value.transaction_type_id=["Transaction Type is required"];return}if(v.value.type==="expense"&&!v.value.user_id){y.value.user_id=["User is required for expense transactions"];return}const m={...v.value,amount:Number(v.value.amount)};m.transaction_type!==null&&m.transaction_type!==void 0&&(m.transaction_type=m.transaction_type);const H=await window.axios.post(`/api/projects/${b.projectId}/transactions`,m);await q(),X(),te("Transaction saved successfully!")}catch(m){((S=m.response)==null?void 0:S.status)===422?y.value=m.response.data.errors:(i.value="Failed to save transaction.",console.error("Error saving transaction:",m))}finally{l.value=!1}},X=()=>{v.value={description:"",amount:"",currency:"PKR",user_id:null,hours_spent:"",type:"expense",transaction_type:null}},$e=async S=>{if(!g.value&&!k.value){F("You do not have permission to delete transactions.");return}if(window.confirm("Are you sure you want to delete this transaction?"))try{const m=D.value[S].id;await window.axios.delete(`/api/projects/${b.projectId}/transactions/${m}`),await q(),te("Transaction deleted successfully!")}catch(m){i.value="Failed to delete transaction.",console.error("Error deleting transaction:",m)}},ve=S=>{if(!g.value&&!k.value){F("You do not have permission to manage transactions.");return}const m=D.value[S];f.value===m.id?(f.value=null,W.value=null,j.value=""):(W.value=S,f.value=m.id,P.value=m.amount,L.value=!1,K.value={},j.value=A(),(Number(m.amount)===0||Math.abs(Number(P.value)-Number(m.amount))<.01)&&(L.value=!0))};ne(P,S=>{if(W.value!==null){const m=D.value[W.value];L.value=Math.abs(Number(S)-Number(m.amount))<.01}});const Ue=()=>{f.value=null,W.value=null,P.value="",L.value=!1,K.value={},j.value=""},We=async()=>{var re;if(!g.value&&!k.value){F("You do not have permission to manage transactions.");return}const S=W.value,m=D.value[S],H=Number(P.value);if(!L.value&&(!P.value||isNaN(H)||H<=0||H>Number(m.amount))){K.value.amount=["Please enter a valid amount between 0 and "+ee(Number(m.amount),m.currency)];return}if(!j.value){K.value.date=["Please select a payment date."];return}K.value={},l.value=!0;try{const ge=m.id,he=L.value||Math.abs(H-Number(m.amount))<.01,je={payment_amount:he?Number(m.amount):H,pay_in_full:he,transaction_currency:m.currency,transaction_type:m.type,original_description:m.description,payment_date:j.value};await window.axios.patch(`/api/projects/${b.projectId}/transactions/${ge}/process-payment`,je),await q(),te("Payment processed successfully!"),Ue()}catch(ge){((re=ge.response)==null?void 0:re.status)===422?K.value=ge.response.data.errors:(i.value="Failed to process payment.",console.error("Error processing payment:",ge))}finally{l.value=!1}},ie=J(()=>!oe.value||Object.keys(oe.value).length===0?0:D.value.filter(S=>S.type==="income").reduce((S,m)=>S+ye(parseFloat(m.amount||0),m.currency,h.value),0)),xe=J(()=>!oe.value||Object.keys(oe.value).length===0?0:D.value.filter(S=>S.type==="expense").reduce((S,m)=>S+ye(parseFloat(m.amount||0),m.currency,h.value),0)),_e=J(()=>!oe.value||Object.keys(oe.value).length===0?0:D.value.filter(S=>S.type==="bonus").reduce((S,m)=>S+ye(parseFloat(m.amount||0),m.currency,h.value),0)),Je=J(()=>ee(ie.value,h.value)),Xe=J(()=>ee(xe.value,h.value)),Qe=J(()=>ee(_e.value,h.value)),Ze=J(()=>{if(!oe.value||Object.keys(oe.value).length===0)return ee(0,h.value);const S=xe.value+_e.value;return ee(ie.value-S,h.value)}),et=J(()=>ie.value===0?"0.00%":`${(xe.value/ie.value*100).toFixed(2)}%`),tt=J(()=>ie.value===0?"0.00%":`${((xe.value+_e.value)/ie.value*100).toFixed(2)}%`),at=J(()=>{if(ie.value<=0)return ee(0,h.value);const S=ie.value*Ke;return ee(S,h.value)}),st=J(()=>{const S=D.value.filter(H=>(H.type==="expense"||H.type==="bonus")&&H.is_paid&&H.payment_date);if(S.length===0)return"N/A";const m=S.reduce((H,re)=>new Date(re.payment_date)>new Date(H.payment_date)?re:H);return new Date(m.payment_date).toLocaleDateString()}),lt=J(()=>{const S=D.value.filter(H=>H.type==="income"&&H.payment_date);if(S.length===0)return"N/A";const m=S.reduce((H,re)=>new Date(re.payment_date)>new Date(H.payment_date)?re:H);return new Date(m.payment_date).toLocaleDateString()});return me(async()=>{const S=localStorage.getItem("displayCurrency");S&&(h.value=S),await Ve(),q(),z(),R()}),ne([()=>b.projectId,h,oe],()=>{b.projectId&&oe.value&&Object.keys(oe.value).length>0&&(q(),z())},{deep:!0}),ne(h,S=>{S&&localStorage.setItem("displayCurrency",S)},{deep:!0}),(S,m)=>{var H,re,ge,he,je,De,Me,Ae;return n(),r("div",kl,[i.value?(n(),r("div",Pl,$(i.value),1)):w("",!0),V(g)||V(k)?(n(),r("div",$l,[e("div",Sl,[e("div",Vl,[m[14]||(m[14]=e("span",{class:"text-sm font-medium text-gray-700 mr-2"},"Currency:",-1)),s(Z,{id:"transactions-display-currency-switcher",modelValue:V(h),"onUpdate:modelValue":m[0]||(m[0]=I=>He(h)?h.value=I:null),options:T,"value-key":"value","label-key":"label",class:"w-24"},null,8,["modelValue"])]),m[25]||(m[25]=e("h4",{class:"text-md font-medium text-gray-700 mb-2"},"Summary",-1)),e("div",Cl,[e("div",Il,[m[15]||(m[15]=e("p",{class:"text-sm text-gray-600"},"Total Income",-1)),e("p",Ul,$(Je.value),1)]),e("div",{class:"p-3 bg-indigo-100 rounded-md cursor-pointer",onClick:m[3]||(m[3]=I=>u.value=!0)},[e("div",Dl,[m[17]||(m[17]=e("p",{class:"text-sm text-gray-600"},"Expendable Budget",-1)),u.value?(n(),r("button",{key:0,onClick:ke(C,["stop"]),class:"text-indigo-700 hover:text-indigo-900",title:"Save"},m[16]||(m[16]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-7.25 7.25a1 1 0 01-1.414 0l-3-3a1 1 0 111.414-1.414l2.293 2.293 6.543-6.543a1 1 0 011.414 0z","clip-rule":"evenodd"})],-1)]))):w("",!0)]),u.value?(n(),r("div",Tl,[e("div",null,[s(N,{for:"expendable_amount",value:"Amount"}),s(G,{id:"expendable_amount",type:"number",modelValue:o.value,"onUpdate:modelValue":m[1]||(m[1]=I=>o.value=I),class:"mt-1 block w-full"},null,8,["modelValue"]),s(B,{message:(H=O.value.amount)==null?void 0:H[0],class:"mt-1"},null,8,["message"])]),e("div",null,[s(N,{for:"expendable_currency",value:"Currency"}),s(Z,{id:"expendable_currency",modelValue:c.value,"onUpdate:modelValue":m[2]||(m[2]=I=>c.value=I),options:T,"value-key":"value","label-key":"label",class:"mt-1 block w-full"},null,8,["modelValue"])])])):(n(),r("div",Ml,[e("p",Al,$(o.value!==null?V(ee)(Number(o.value),c.value):"Not set"),1),o.value!==null&&c.value.toUpperCase()!==V(h).toUpperCase()?(n(),r("p",Nl," ("+$(V(ee)(V(ye)(Number(o.value),c.value,V(h)),V(h)))+") ",1)):w("",!0)]))]),e("div",Bl,[m[18]||(m[18]=e("p",{class:"text-sm text-gray-600"},"Total Expenses",-1)),e("p",Rl,$(Xe.value),1),e("p",El,"("+$(et.value)+" of Income)",1)]),e("div",Ol,[m[19]||(m[19]=e("p",{class:"text-sm text-gray-600"},"Total Bonuses",-1)),e("p",Fl,$(Qe.value),1)]),e("div",Ll,[m[20]||(m[20]=e("p",{class:"text-sm text-gray-600"},"Balance",-1)),e("p",zl,$(Ze.value),1)]),e("div",ql,[m[21]||(m[21]=e("p",{class:"text-sm text-gray-600"},"Expense + Bonus",-1)),e("p",Kl,$(V(ee)(xe.value+_e.value,V(h))),1),e("p",Gl,"("+$(tt.value)+" of Income)",1)]),e("div",Hl,[m[22]||(m[22]=e("p",{class:"text-sm font-medium text-orange-800"},"Estimated Income Tax (AUD)",-1)),e("p",Yl,$(at.value),1),e("p",Wl," (Based on "+$((Ke*100).toFixed(1))+"% of Total Income. This is an estimation.) ",1)]),e("div",Jl,[m[23]||(m[23]=e("p",{class:"text-sm font-medium text-gray-800"},"Last Payment Received Date",-1)),e("p",Xl,$(lt.value),1)]),e("div",Ql,[m[24]||(m[24]=e("p",{class:"text-sm font-medium text-gray-800"},"Last Payment Sent Date",-1)),e("p",Zl,$(st.value),1)])])]),m[26]||(m[26]=e("h4",{class:"text-md font-medium text-gray-700 mb-4"},"Add Transaction",-1)),e("div",eo,[e("div",null,[s(N,{for:"description",value:"Description"}),s(G,{id:"description",modelValue:v.value.description,"onUpdate:modelValue":m[4]||(m[4]=I=>v.value.description=I),class:"mt-1 block w-full",disabled:l.value},null,8,["modelValue","disabled"]),s(B,{message:(re=y.value.description)==null?void 0:re[0],class:"mt-2"},null,8,["message"])]),e("div",null,[s(N,{for:"amount",value:"Amount"}),s(G,{id:"amount",type:"number",modelValue:v.value.amount,"onUpdate:modelValue":m[5]||(m[5]=I=>v.value.amount=I),class:"mt-1 block w-full",disabled:l.value},null,8,["modelValue","disabled"]),s(B,{message:(ge=y.value.amount)==null?void 0:ge[0],class:"mt-2"},null,8,["message"])]),e("div",null,[s(N,{for:"currency",value:"Currency"}),s(Z,{id:"currency",modelValue:v.value.currency,"onUpdate:modelValue":m[6]||(m[6]=I=>v.value.currency=I),options:T,disabled:l.value},null,8,["modelValue","disabled"]),s(B,{message:(he=y.value.currency)==null?void 0:he[0],class:"mt-2"},null,8,["message"])]),e("div",null,[s(N,{for:"type",value:"Type"}),s(Z,{id:"type",modelValue:v.value.type,"onUpdate:modelValue":m[7]||(m[7]=I=>v.value.type=I),options:p,disabled:l.value||!V(g)&&v.value.type==="expense"&&v.value.type!=="bonus"||!V(k)&&v.value.type==="income"},null,8,["modelValue","disabled"]),s(B,{message:(je=y.value.type)==null?void 0:je[0],class:"mt-2"},null,8,["message"])]),e("div",null,[s(jl,{modelValue:v.value.transaction_type,"onUpdate:modelValue":m[8]||(m[8]=I=>v.value.transaction_type=I),label:"Transaction Type",placeholder:"Select or add a transaction type",disabled:l.value,required:!0,"search-url":"/api/transaction-types/search"},null,8,["modelValue","disabled"]),s(B,{message:(De=y.value.transaction_type_id)==null?void 0:De[0],class:"mt-2"},null,8,["message"])]),v.value.type==="expense"||v.value.type==="bonus"?(n(),r("div",to,[s(N,{for:"user_id",value:"User"}),s(Z,{id:"user_id",modelValue:v.value.user_id,"onUpdate:modelValue":m[9]||(m[9]=I=>v.value.user_id=I),options:d.value,disabled:l.value||!U.value.length,placeholder:"Select a user"},null,8,["modelValue","options","disabled"]),s(B,{message:(Me=y.value.user_id)==null?void 0:Me[0],class:"mt-2"},null,8,["message"])])):w("",!0),v.value.type==="expense"||v.value.type==="bonus"?(n(),r("div",ao,[s(N,{for:"hours_spent",value:"Hours Spent (Optional)"}),s(G,{id:"hours_spent",type:"number",modelValue:v.value.hours_spent,"onUpdate:modelValue":m[10]||(m[10]=I=>v.value.hours_spent=I),class:"mt-1 block w-full",disabled:l.value},null,8,["modelValue","disabled"]),s(B,{message:(Ae=y.value.hours_spent)==null?void 0:Ae[0],class:"mt-2"},null,8,["message"])])):w("",!0)]),e("div",so,[s(ae,{onClick:se,disabled:l.value},{default:Y(()=>[E($(l.value?"Saving...":"Save Transaction"),1)]),_:1},8,["disabled"])])])):w("",!0),V(M)?(n(),r("div",lo,[m[30]||(m[30]=e("h4",{class:"text-md font-medium text-gray-700 mb-4"},"Transaction History",-1)),l.value?(n(),r("div",oo,m[27]||(m[27]=[e("div",{class:"h-4 bg-gray-200 rounded animate-pulse w-full"},null,-1),e("div",{class:"h-4 bg-gray-200 rounded animate-pulse w-5/6"},null,-1),e("div",{class:"h-4 bg-gray-200 rounded animate-pulse w-3/4"},null,-1)]))):D.value.length===0?(n(),r("div",no," No transactions found for this project. ")):(n(),r("div",ro,[(n(!0),r(ue,null,ce(D.value,(I,Ne)=>{var Te,Be,Re,Ee;return n(),r("div",{key:I.id,class:Q([{"bg-green-50 border-green-200":I.type==="income","bg-red-50 border-red-200":I.type==="expense","bg-purple-50 border-purple-200":I.type==="bonus","border-l-4":!0},"p-4 rounded-md shadow-sm transition-all duration-200 ease-in-out hover:shadow-md"])},[e("div",io,[e("div",uo,[e("p",co,$(I.description),1),e("p",mo,[E($(I.type==="income"?"Income":I.type==="expense"?"Expense":"Bonus")+" on "+$(new Date(I.created_at).toLocaleDateString())+" ",1),I.transaction_type&&I.transaction_type.name?(n(),r("span",vo," Type: "+$(I.transaction_type.name),1)):w("",!0)])]),e("div",po,[e("p",{class:Q(["text-lg font-bold",{"text-green-700":I.type==="income","text-red-700":I.type==="expense","text-purple-700":I.type==="bonus"}])},$(V(ee)(I.amount,I.currency)),3),I.currency.toUpperCase()!==V(h).toUpperCase()?(n(),r("p",go," ("+$(V(ee)(V(ye)(I.amount,I.currency,V(h)),V(h)))+") ",1)):w("",!0),e("span",{class:Q(["block text-xs mt-1",I.is_paid?"text-green-600":"text-red-600"])},$(I.is_paid?"Paid":"Unpaid"),3)])]),e("div",yo,[e("div",null,[I.user_id?(n(),r("span",fo,"User: "+$(((Te=I.user)==null?void 0:Te.name)||((Be=U.value.find(pe=>pe.id===I.user_id))==null?void 0:Be.name)||"Unknown"),1)):w("",!0),I.hours_spent?(n(),r("span",bo,"Hours: "+$(I.hours_spent),1)):w("",!0),(I.type==="expense"||I.type==="bonus")&&ie.value>0?(n(),r("span",wo,$((V(ye)(I.amount,I.currency,V(h))/ie.value*100).toFixed(2))+"% of Income ",1)):w("",!0)]),e("div",xo,[!I.is_paid&&(V(g)||V(k))?(n(),le(be,{key:0,onClick:pe=>ve(Ne),class:Q({"text-green-600":I.type!=="income","text-blue-600":I.type==="income"})},{default:Y(()=>[E($(I.type==="income"?"Receive":"Pay"),1)]),_:2},1032,["onClick","class"])):w("",!0),V(g)||V(k)?(n(),le(be,{key:1,onClick:pe=>$e(Ne),class:"text-red-600"},{default:Y(()=>m[28]||(m[28]=[E(" Delete ",-1)])),_:2,__:[28]},1032,["onClick"])):w("",!0)])]),f.value===I.id?(n(),r("div",ho,[e("h4",_o,$(I.type==="income"?"Record Receipt":"Make Payment"),1),e("div",jo,[s(N,{for:"payment_date",value:"Date"}),s(G,{id:"payment_date",type:"date",modelValue:j.value,"onUpdate:modelValue":m[11]||(m[11]=pe=>j.value=pe),class:"mt-1 block w-full",disabled:l.value},null,8,["modelValue","disabled"]),s(B,{message:(Re=K.value.date)==null?void 0:Re[0],class:"mt-2"},null,8,["message"])]),e("div",ko,[e("label",Po,[fe(e("input",{type:"checkbox","onUpdate:modelValue":m[12]||(m[12]=pe=>L.value=pe),class:"mr-2 rounded text-blue-600 focus:ring-blue-500",disabled:l.value},null,8,$o),[[dt,L.value]]),e("span",So,$(I.type==="income"?"Receive in Full":"Pay in Full"),1)])]),L.value?w("",!0):(n(),r("div",Vo,[s(N,{for:"payment_amount",value:"Amount"}),s(G,{id:"payment_amount",type:"number",modelValue:P.value,"onUpdate:modelValue":m[13]||(m[13]=pe=>P.value=pe),class:"mt-1 block w-full",disabled:l.value,placeholder:"Enter partial "+(I.type==="income"?"receipt":"payment")+" amount (Max: "+V(ee)(I.amount,I.currency)+")"},null,8,["modelValue","disabled","placeholder"]),s(B,{message:(Ee=K.value.amount)==null?void 0:Ee[0],class:"mt-2"},null,8,["message"])])),e("div",Co,[s(be,{onClick:Ue,disabled:l.value},{default:Y(()=>m[29]||(m[29]=[E(" Cancel ",-1)])),_:1,__:[29]},8,["disabled"]),s(ae,{onClick:We,disabled:l.value},{default:Y(()=>[E($(l.value?"Processing...":I.type==="income"?"Record Receipt":"Submit Payment"),1)]),_:2},1032,["disabled"])])])):w("",!0)],2)}),128))]))])):w("",!0)])}}},Uo={class:"mb-6 p-4 bg-indigo-50 rounded-lg border border-indigo-100 flex items-center justify-between gap-4"},Do={class:"text-2xl font-semibold text-indigo-800"},Mo={class:"w-48"},Ao={key:0,class:"mb-6 p-4 border rounded-lg"},No={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},To={class:"flex items-end"},Bo={class:"md:col-span-4"},Ro={class:"space-y-3"},Eo={key:0,class:"text-gray-500"},Oo={key:1,class:"text-gray-500"},Fo={class:"font-medium"},Lo={key:0,class:"text-sm text-gray-600"},zo={class:"text-sm text-gray-700 mt-1"},qo={key:0,class:"text-gray-500"},Ko={class:"flex items-center gap-3"},Go={__name:"ProjectExpendables",props:{projectId:{type:[Number,String],required:!0},userProjectRole:{type:Object,default:()=>({})}},setup(t){const b=t,{canView:a,canManage:x}=Ie(()=>b.projectId),g=a("project_expendable",b.userProjectRole),k=x("project_expendable",b.userProjectRole),M=_([]),D=_(!1),U=_({name:"",description:"",amount:"",currency:"PKR",status:"active"}),y=_({}),i=_(!1),l=[{value:"PKR",label:"PKR"},{value:"USD",label:"USD"},{value:"EUR",label:"EUR"},{value:"GBP",label:"GBP"},{value:"AUD",label:"AUD"},{value:"INR",label:"INR"}],f=Ye,P=J(()=>!oe.value||Object.keys(oe.value).length===0?0:M.value.reduce((j,v)=>j+ye(Number(v.amount||0),v.currency,f.value),0));async function L(){if(g.value){D.value=!0;try{const{data:j}=await window.axios.get(`/api/projects/${b.projectId}/expendables`);M.value=j||[]}catch(j){console.error(j)}finally{D.value=!1}}}async function K(){var j,v,h;y.value={},i.value=!0;try{const T={...U.value,amount:Number(U.value.amount)},{data:o}=await window.axios.post(`/api/projects/${b.projectId}/expendables`,T);M.value.unshift(o),U.value={name:"",description:"",amount:"",currency:U.value.currency,status:"active"},te("Expendable created")}catch(T){((j=T.response)==null?void 0:j.status)===422?y.value=T.response.data.errors||{}:(h=(v=T.response)==null?void 0:v.data)!=null&&h.message?F(T.response.data.message):F("Failed to create expendable")}finally{i.value=!1}}async function W(j){if(confirm("Delete this expendable?"))try{await window.axios.delete(`/api/projects/${b.projectId}/expendables/${j.id}`),M.value=M.value.filter(v=>v.id!==j.id),te("Deleted")}catch(v){F("Failed to delete"),console.error(v)}}return me(async()=>{const j=localStorage.getItem("displayCurrency");j&&(f.value=j),await Ve(),await L()}),ne(f,j=>{j&&localStorage.setItem("displayCurrency",j)}),(j,v)=>{var h,T,o,c;return n(),r("div",null,[e("div",Uo,[e("div",null,[v[5]||(v[5]=e("div",{class:"text-sm text-gray-600"},"Total Expendables",-1)),e("div",Do,$(V(ee)(P.value,V(f))),1)]),e("div",Mo,[s(N,{for:"display_currency",value:"Display Currency"}),s(Z,{id:"display_currency",modelValue:V(f),"onUpdate:modelValue":v[0]||(v[0]=u=>He(f)?f.value=u:null),options:l,"value-key":"value","label-key":"label",class:"mt-1 w-full"},null,8,["modelValue"])])]),V(k)?(n(),r("div",Ao,[e("div",No,[e("div",null,[s(N,{for:"name",value:"Name"}),s(G,{id:"name",modelValue:U.value.name,"onUpdate:modelValue":v[1]||(v[1]=u=>U.value.name=u),class:"mt-1 w-full",placeholder:"e.g., Asset Purchase"},null,8,["modelValue"]),s(B,{message:(h=y.value.name)==null?void 0:h[0],class:"mt-1"},null,8,["message"])]),e("div",null,[s(N,{for:"amount",value:"Amount"}),s(G,{id:"amount",type:"number",step:"0.01",modelValue:U.value.amount,"onUpdate:modelValue":v[2]||(v[2]=u=>U.value.amount=u),class:"mt-1 w-full"},null,8,["modelValue"]),s(B,{message:(T=y.value.amount)==null?void 0:T[0],class:"mt-1"},null,8,["message"])]),e("div",null,[s(N,{for:"currency",value:"Currency"}),s(Z,{id:"currency",modelValue:U.value.currency,"onUpdate:modelValue":v[3]||(v[3]=u=>U.value.currency=u),options:l,"value-key":"value","label-key":"label",class:"mt-1 w-full"},null,8,["modelValue"]),s(B,{message:(o=y.value.currency)==null?void 0:o[0],class:"mt-1"},null,8,["message"])]),e("div",To,[s(ae,{disabled:i.value,onClick:K},{default:Y(()=>v[6]||(v[6]=[E("Add",-1)])),_:1,__:[6]},8,["disabled"])]),e("div",Bo,[s(N,{for:"description",value:"Description (optional)"}),s(G,{id:"description",modelValue:U.value.description,"onUpdate:modelValue":v[4]||(v[4]=u=>U.value.description=u),class:"mt-1 w-full",placeholder:"Details"},null,8,["modelValue"]),s(B,{message:(c=y.value.description)==null?void 0:c[0],class:"mt-1"},null,8,["message"])])])])):w("",!0),e("div",Ro,[D.value?(n(),r("div",Eo,"Loading...")):M.value.length?w("",!0):(n(),r("div",Oo,"No expendables yet.")),(n(!0),r(ue,null,ce(M.value,u=>(n(),r("div",{key:u.id,class:"p-4 border rounded-lg flex items-center justify-between"},[e("div",null,[e("div",Fo,$(u.name),1),u.description?(n(),r("div",Lo,$(u.description),1)):w("",!0),e("div",zo,[E($(V(ee)(Number(u.amount),u.currency))+" ",1),u.currency&&u.currency.toUpperCase()!==V(f).toUpperCase()?(n(),r("span",qo," ("+$(V(ee)(V(ye)(Number(u.amount),u.currency,V(f)),V(f)))+") ",1)):w("",!0)])]),e("div",Ko,[e("span",{class:Q(["text-xs px-2 py-1 rounded-full",u.status==="active"?"bg-green-100 text-green-700":"bg-gray-100 text-gray-700"])},$(u.status||"active"),3),V(k)?(n(),le(be,{key:0,onClick:O=>W(u),class:"!text-red-600"},{default:Y(()=>v[7]||(v[7]=[E("Delete",-1)])),_:2,__:[7]},1032,["onClick"])):w("",!0)])]))),128))])])}}},Ho={class:"p-6 w-full mx-auto bg-white rounded-xl shadow-2xl transition-all duration-300"},Yo={class:"border-b border-gray-200 mb-6"},Wo={class:"flex -mb-px space-x-4 overflow-x-auto pb-2"},Jo={class:"py-4"},gn={__name:"ProjectForm",props:{projectId:{type:[Number,String],default:null},statusOptions:{type:Array,required:!0},departmentOptions:{type:Array,required:!0},sourceOptions:{type:Array,required:!0},clientRoleOptions:{type:Array,default:()=>[]},userRoleOptions:{type:Array,default:()=>[]},paymentTypeOptions:{type:Array,required:!0},errors:{type:Object,default:()=>({})},isSaving:{type:Boolean,default:!1}},emits:["close"],setup(t,{emit:b}){ut();const a=t,x=_(a.projectId);ne(()=>a.projectId,se=>{x.value=se,se&&ct(se)},{immediate:!0}),mt(x);const g=vt(x),{canDo:k,canView:M,canManage:D}=Ie(x),U=k("manage_projects",g);k("create_clients",g);const y=k("upload_project_documents",g),i=D("project_services_and_payments",g),l=k("add_project_notes",g),f=D("project_users",g),P=D("project_clients",g),L=J(()=>k("manage_project_basic_details",g).value===!0||D("manage_project_basic_details").value===!0),K=M("project_documents",g),W=M("project_services_and_payments",g),j=M("project_notes",g),v=M("project_users",g),h=M("project_clients",g),T=M("project_transactions",g),o=M("project_expendable",g),c=D("project_expendable",g),u=M("project_deliverables"),O=D("project_deliverables"),R=_("basic"),C=J(()=>h.value&&v.value?"Clients and Users":h.value?"Clients":v.value?"Users":"Clients and Users"),p=_([]),d=_([]),A=_([]),z=_([]),q=se=>{if(se!=="basic"&&!a.projectId){pt("Please create the project first before managing this section."),R.value="basic";return}R.value=se};return me(async()=>{try{p.value=await ze("client"),d.value=await ze("project"),A.value=await Vt(!0,null),z.value=await Ct(!0,null)}catch(se){console.error("Error fetching global data for ProjectForm:",se)}}),(se,X)=>{const $e=Ce("permission");return n(),r("div",Ho,[X[8]||(X[8]=e("div",{class:"flex justify-between items-center pb-4 mb-6 border-b border-gray-200"},[e("h2",{class:"text-2xl font-semibold text-gray-800"},"Edit Project")],-1)),e("div",Yo,[e("nav",Wo,[e("button",{onClick:X[0]||(X[0]=ve=>q("basic")),class:Q(["py-3 px-5 text-center border-b-2 font-medium text-base rounded-t-lg transition-colors duration-200 whitespace-nowrap",R.value==="basic"?"border-indigo-600 text-indigo-700 bg-indigo-50":"border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300 hover:bg-gray-50"])}," Basic Information ",2),t.projectId&&(V(h)||V(v))?(n(),r("button",{key:0,onClick:X[1]||(X[1]=ve=>q("client")),class:Q(["py-3 px-5 text-center border-b-2 font-medium text-base rounded-t-lg transition-colors duration-200 whitespace-nowrap",R.value==="client"?"border-indigo-600 text-indigo-700 bg-indigo-50":"border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300 hover:bg-gray-50"])},$(C.value),3)):w("",!0),t.projectId&&(V(i)||V(W))?(n(),r("button",{key:1,onClick:X[2]||(X[2]=ve=>q("services")),class:Q(["py-3 px-5 text-center border-b-2 font-medium text-base rounded-t-lg transition-colors duration-200 whitespace-nowrap",R.value==="services"?"border-indigo-600 text-indigo-700 bg-indigo-50":"border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300 hover:bg-gray-50"])}," Services & Payment ",2)):w("",!0),t.projectId&&V(T)?(n(),r("button",{key:2,onClick:X[3]||(X[3]=ve=>q("transactions")),class:Q(["py-3 px-5 text-center border-b-2 font-medium text-base rounded-t-lg transition-colors duration-200 whitespace-nowrap",R.value==="transactions"?"border-indigo-600 text-indigo-700 bg-indigo-50":"border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300 hover:bg-gray-50"])}," Transactions ",2)):w("",!0),t.projectId&&(V(c)||V(o))?(n(),r("button",{key:3,onClick:X[4]||(X[4]=ve=>q("expendables")),class:Q(["py-3 px-5 text-center border-b-2 font-medium text-base rounded-t-lg transition-colors duration-200 whitespace-nowrap",R.value==="expendables"?"border-indigo-600 text-indigo-700 bg-indigo-50":"border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300 hover:bg-gray-50"])}," Expendables ",2)):w("",!0),t.projectId&&V(K)?(n(),r("button",{key:4,onClick:X[5]||(X[5]=ve=>q("documents")),class:Q(["py-3 px-5 text-center border-b-2 font-medium text-base rounded-t-lg transition-colors duration-200 whitespace-nowrap",R.value==="documents"?"border-indigo-600 text-indigo-700 bg-indigo-50":"border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300 hover:bg-gray-50"])}," Documents ",2)):w("",!0),t.projectId&&(V(l)||V(j))?(n(),r("button",{key:5,onClick:X[6]||(X[6]=ve=>q("notes")),class:Q(["py-3 px-5 text-center border-b-2 font-medium text-base rounded-t-lg transition-colors duration-200 whitespace-nowrap",R.value==="notes"?"border-indigo-600 text-indigo-700 bg-indigo-50":"border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300 hover:bg-gray-50"])}," Notes ",2)):w("",!0),t.projectId&&(V(O)||V(u))?(n(),r("button",{key:6,onClick:X[7]||(X[7]=ve=>q("deliverables")),class:Q(["py-3 px-5 text-center border-b-2 font-medium text-base rounded-t-lg transition-colors duration-200 whitespace-nowrap",R.value==="deliverables"?"border-indigo-600 text-indigo-700 bg-indigo-50":"border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300 hover:bg-gray-50"])}," Deliverables ",2)):w("",!0)])]),e("div",Jo,[R.value==="basic"?(n(),le(Ht,{key:0,projectId:t.projectId,errors:a.errors,statusOptions:t.statusOptions,sourceOptions:t.sourceOptions,canManageProjects:V(U),canManageProjectBasicDetails:L.value,isSaving:a.isSaving},null,8,["projectId","errors","statusOptions","sourceOptions","canManageProjects","canManageProjectBasicDetails","isSaving"])):w("",!0),R.value==="client"?(n(),le(Ua,{key:1,projectId:t.projectId,errors:a.errors,clientRoleOptions:p.value,userRoleOptions:d.value,clients:A.value,users:z.value,canViewProjectClients:V(h),canManageProjectClients:V(P),canViewProjectUsers:V(v),canManageProjectUsers:V(f),isSaving:a.isSaving},null,8,["projectId","errors","clientRoleOptions","userRoleOptions","clients","users","canViewProjectClients","canManageProjectClients","canViewProjectUsers","canManageProjectUsers","isSaving"])):w("",!0),R.value==="services"?(n(),le(gl,{key:2,projectId:t.projectId,departmentOptions:t.departmentOptions,paymentTypeOptions:t.paymentTypeOptions,canManageProjectServicesAndPayments:V(i),canViewProjectServicesAndPayments:V(W),isSaving:a.isSaving},null,8,["projectId","departmentOptions","paymentTypeOptions","canManageProjectServicesAndPayments","canViewProjectServicesAndPayments","isSaving"])):w("",!0),R.value==="expendables"?(n(),le(Go,{key:3,"project-id":t.projectId,"user-project-role":V(g)},null,8,["project-id","user-project-role"])):w("",!0),R.value==="transactions"?fe((n(),le(Io,{key:4,projectId:t.projectId,userProjectRole:V(g),isSaving:a.isSaving},null,8,["projectId","userProjectRole","isSaving"])),[[$e,"view_project_transactions"]]):w("",!0),R.value==="documents"?(n(),le(Ja,{key:5,projectId:t.projectId,errors:a.errors,canUploadProjectDocuments:V(y),canViewProjectDocuments:V(K),isSaving:a.isSaving},null,8,["projectId","errors","canUploadProjectDocuments","canViewProjectDocuments","isSaving"])):w("",!0),R.value==="notes"?(n(),le(cs,{key:6,projectId:t.projectId,errors:a.errors,canAddProjectNotes:V(l),canViewProjectNotes:V(j),"is-saving":a.isSaving},null,8,["projectId","errors","canAddProjectNotes","canViewProjectNotes","is-saving"])):w("",!0),R.value==="deliverables"?(n(),le(Is,{key:7,projectId:t.projectId,errors:a.errors,canManageProjectDeliverables:V(O),canViewProjectDeliverables:V(u),isSaving:a.isSaving},null,8,["projectId","errors","canManageProjectDeliverables","canViewProjectDeliverables","isSaving"])):w("",!0)])])}}};export{gn as _};
