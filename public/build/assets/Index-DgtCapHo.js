import{r as g,e as G,f as q,g as Q,o as i,w as z,b as e,t as h,s as X,a as r,i as k,v as B,z as Y,d as b,x as P,F as C,l as M,m as H,j as L,p as S,c as W,G as Z,aN as ee,D as te,u as F,h as ae}from"./app-CZiJFItQ.js";import{b as se,_ as le}from"./AuthenticatedLayout-5eicP0ec.js";import{_ as oe}from"./Modal-akPUGSqW.js";import{_ as E}from"./InputLabel-DjoiOvom.js";import{_ as R}from"./InputError-BBwwpFKS.js";import{_ as ie}from"./PrimaryButton-2iaxY83O.js";import{_ as re}from"./SecondaryButton-DrE06oah.js";import"./index-oewZdsII.js";import"./BaseFormModal-C31yazTC.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./TextInput-Cne22vOS.js";import"./SelectDropdown-CCQ94vKn.js";/* empty css                                                                       */import"./debounce-C-hnF4Z3.js";import"./ApplicationLogo-Cljoy5r1.js";import"./MultiSelectDropdown-BJfQuDgP.js";import"./createLucideIcon-77yR4NzK.js";import"./plus-CRvmTldv.js";import"./DangerButton-BTftXjdU.js";import"./moment-BLMuvzoS.js";import"./NoticeboardModal-DfKygsts.js";const ne={class:"p-6"},de={class:"text-lg font-medium text-gray-900"},ue={class:"mt-6"},ce={key:0,class:"mb-4 p-4 bg-green-100 border border-green-400 text-green-700 rounded"},ve={key:1,class:"mb-4 p-4 bg-red-100 border border-red-400 text-red-700 rounded"},me={class:"mb-4"},ge={class:"flex items-center"},pe={key:2,class:"mb-4"},fe={key:3,class:"mb-4"},he={class:"flex-1"},be=["id","onUpdate:modelValue"],ye={class:"flex-1"},_e=["id","onUpdate:modelValue"],we={key:0,class:"flex items-end pb-1"},xe=["onClick"],ke={class:"mt-6 flex justify-end space-x-3"},Se={key:0,class:"flex items-center"},Ae={key:1},De={__name:"SingleDateAvailabilityModal",props:{show:Boolean,date:{type:String,required:!0},userId:{type:Number,default:null}},emits:["close","availability-saved"],setup(I,{emit:_}){const A=()=>{const o=localStorage.getItem("authToken");o&&!S.defaults.headers.common.Authorization&&(S.defaults.headers.common.Authorization=`Bearer ${o}`,console.log("Auth headers set in SingleDateAvailabilityModal"))},p=I,x=_,n=g(!0),c=g(""),d=g([{start_time:"",end_time:""}]),u=g({}),y=g(!1),w=g(""),T=g(""),N=o=>new Date(o).toLocaleDateString("en-US",{weekday:"long",month:"short",day:"numeric"}),D=async()=>{try{A();const o=await S.get("/api/availabilities",{params:{start_date:p.date,end_date:p.date,...p.userId?{user_id:p.userId}:{}}});if(o.data&&o.data.availabilities&&o.data.availabilities.length>0){const a=o.data.availabilities[0];n.value=a.is_available,a.is_available?d.value=a.time_slots&&a.time_slots.length>0?[...a.time_slots]:[{start_time:"",end_time:""}]:c.value=a.reason||""}else j()}catch(o){console.error("Error fetching existing availability:",o),j()}},j=()=>{n.value=!0,c.value="",d.value=[{start_time:"",end_time:""}]};G(()=>p.show,o=>{o&&(u.value={},w.value="",T.value=N(p.date),D())});const V=()=>{d.value.push({start_time:"",end_time:""})},U=o=>{d.value.length>1&&d.value.splice(o,1)},O=async()=>{y.value=!0,u.value={},w.value="";try{if(n.value){if(d.value.some(a=>!a.start_time||!a.end_time)){u.value.timeSlots="Please fill in all time slots or mark yourself as not available.",y.value=!1;return}for(const a of d.value){const m=a.start_time.split(":").map(Number),f=a.end_time.split(":").map(Number);if(m.length!==2||f.length!==2||isNaN(m[0])||isNaN(m[1])||isNaN(f[0])||isNaN(f[1])){u.value.timeSlots="Invalid time format. Please use HH:MM format.",y.value=!1;return}const $=m[0]*60+m[1],t=f[0]*60+f[1];if($>=t){u.value.timeSlots="End time must be after start time.",y.value=!1;return}}}else if(!c.value.trim()){u.value.reason="Please provide a reason for unavailability.",y.value=!1;return}A();const o=await S.post("/api/availabilities",{date:p.date,is_available:n.value,reason:n.value?null:c.value,time_slots:n.value?d.value:null,...p.userId?{user_id:p.userId}:{}});w.value="Availability saved successfully!",x("availability-saved",o.data.availability),setTimeout(()=>{x("close")},1500)}catch(o){if(console.error("Error saving availability:",o),o.response&&o.response.data&&o.response.data.errors)u.value=o.response.data.errors;else if(o.response&&o.response.status===409)try{const a=o.response.data.availability.id,m=await S.put(`/api/availabilities/${a}`,{is_available:n.value,reason:n.value?null:c.value,time_slots:n.value?d.value:null,...p.userId?{user_id:p.userId}:{}});w.value="Availability updated successfully!",x("availability-saved",m.data.availability),setTimeout(()=>{x("close")},1500)}catch(a){console.error("Error updating availability:",a),u.value.general="An error occurred while updating your availability."}else u.value.general="An error occurred while saving your availability."}finally{y.value=!1}};return q(()=>{A()}),(o,a)=>(i(),Q(oe,{show:I.show,onClose:a[3]||(a[3]=m=>o.$emit("close")),"max-width":"md"},{default:z(()=>[e("div",ne,[e("h2",de," Availability for "+h(T.value),1),a[9]||(a[9]=e("p",{class:"mt-1 text-sm text-gray-600"}," Please provide your availability for this date. This helps in planning meetings and work schedules. ",-1)),e("div",ue,[e("form",{onSubmit:X(O,["prevent"])},[w.value?(i(),r("div",ce,h(w.value),1)):k("",!0),u.value.general?(i(),r("div",ve,h(u.value.general),1)):k("",!0),e("div",me,[e("div",ge,[B(e("input",{type:"checkbox",id:"isAvailableToggle","onUpdate:modelValue":a[0]||(a[0]=m=>n.value=m),class:"rounded border-gray-300 text-indigo-600 shadow-sm focus:ring-indigo-500"},null,512),[[Y,n.value]]),a[4]||(a[4]=e("label",{for:"isAvailableToggle",class:"ml-2 block text-sm text-gray-700"}," I am available on this day ",-1))])]),n.value?k("",!0):(i(),r("div",pe,[b(E,{for:"reason",value:"Reason for Not Available"}),B(e("textarea",{id:"reason","onUpdate:modelValue":a[1]||(a[1]=m=>c.value=m),rows:"3",class:"mt-1 block w-full border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm",placeholder:"e.g., Out of office, Holiday, Meeting all day"},null,512),[[P,c.value]]),b(R,{message:u.value.reason,class:"mt-2"},null,8,["message"])])),n.value?(i(),r("div",fe,[b(E,{value:"Available Time Slots"}),b(R,{message:u.value.timeSlots,class:"mt-2"},null,8,["message"]),(i(!0),r(C,null,M(d.value,(m,f)=>(i(),r("div",{key:f,class:"flex items-center space-x-2 mt-2"},[e("div",he,[b(E,{for:`start_time_${f}`,value:"Start Time",class:"text-xs"},null,8,["for"]),B(e("input",{id:`start_time_${f}`,type:"time","onUpdate:modelValue":$=>m.start_time=$,class:"mt-1 block w-full border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm"},null,8,be),[[P,m.start_time]])]),e("div",ye,[b(E,{for:`end_time_${f}`,value:"End Time",class:"text-xs"},null,8,["for"]),B(e("input",{id:`end_time_${f}`,type:"time","onUpdate:modelValue":$=>m.end_time=$,class:"mt-1 block w-full border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm"},null,8,_e),[[P,m.end_time]])]),d.value.length>1?(i(),r("div",we,[e("button",{type:"button",onClick:$=>U(f),class:"p-2 text-red-600 hover:text-red-800"},a[5]||(a[5]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm6 0a1 1 0 012 0v6a1 1 0 11-2 0V8z","clip-rule":"evenodd"})],-1)]),8,xe)])):k("",!0)]))),128)),e("button",{type:"button",onClick:V,class:"mt-3 w-full flex items-center justify-center px-4 py-2 border border-dashed border-indigo-300 rounded-lg text-indigo-600 hover:bg-indigo-50 transition duration-150 ease-in-out"},a[6]||(a[6]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z","clip-rule":"evenodd"})],-1),H(" Add Another Time Slot ",-1)]))])):k("",!0),e("div",ke,[b(re,{onClick:a[2]||(a[2]=m=>o.$emit("close"))},{default:z(()=>a[7]||(a[7]=[H(" Cancel ",-1)])),_:1,__:[7]}),b(ie,{disabled:y.value,class:L({"opacity-50":y.value})},{default:z(()=>[y.value?(i(),r("span",Se,a[8]||(a[8]=[e("svg",{class:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),H(" Saving... ",-1)]))):(i(),r("span",Ae,"Save Availability"))]),_:1},8,["disabled","class"])])],32)])])]),_:1},8,["show"]))}},$e={class:"bg-white rounded-lg shadow-md p-6","data-test":"availability-calendar"},Ce={class:"flex flex-col sm:flex-row justify-between items-center mb-6"},Ie={class:"flex items-center space-x-4"},Te={key:0,class:"w-48"},Me=["value"],Ne={class:"flex items-center space-x-2"},Ve={class:"text-sm font-medium"},Ue={key:0,class:"flex justify-center items-center py-12"},Be={key:1,class:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-md"},ze={key:2,class:"overflow-x-auto"},je={class:"min-w-full divide-y divide-gray-200"},Ee={class:"flex flex-col items-center"},He={class:"text-lg font-bold"},Oe={class:"text-xs mt-1"},Pe={class:"bg-white divide-y divide-gray-200"},Le={class:"min-h-[150px]"},We={key:0,class:"mb-3 flex justify-center"},Fe=["onClick"],Re={key:1},Ge={class:"flex items-center justify-between"},qe={key:0},Je={key:1,class:"text-xs text-gray-600 mt-1"},Ke={key:2,class:"flex items-center justify-center h-full text-gray-400 text-xs italic"},Qe={__name:"AvailabilityCalendar",props:{userId:{type:Number,default:null},isAdmin:{type:Boolean,default:!1}},setup(I){const _=I,A=g([]),p=g([]),x=g(!1),n=g(""),c=g(""),d=g(""),u=g(_.userId);g("weekly");const y=g(!1),w=g(!1),T=g(""),N=()=>{const t=localStorage.getItem("authToken");t&&!S.defaults.headers.common.Authorization&&(S.defaults.headers.common.Authorization=`Bearer ${t}`,console.log("Auth headers set in AvailabilityCalendar"))},D=async()=>{x.value=!0,n.value="";try{N();let t="/api/availabilities";const s={};c.value&&(s.start_date=c.value),d.value&&(s.end_date=d.value),u.value&&_.isAdmin&&(s.user_id=u.value);const l=await S.get(t,{params:s});A.value=l.data.availabilities,l.data.start_date&&(c.value=l.data.start_date),l.data.end_date&&(d.value=l.data.end_date),_.isAdmin&&p.value.length===0&&j()}catch(t){console.error("Error fetching availabilities:",t),t.response&&t.response.status===401?n.value="Authentication error. Please refresh the page or log in again.":n.value="Failed to load availabilities. Please try again."}finally{x.value=!1}},j=async()=>{try{N();const t=await S.get("/api/users");p.value=t.data}catch(t){console.error("Error fetching users:",t),t.response&&t.response.status===401&&(n.value="Authentication error. Please refresh the page or log in again.")}},V=W(()=>{if(!c.value)return[];const t=[],s=new Date(c.value);for(let l=0;l<7;l++){const v=new Date(s);v.setDate(s.getDate()+l),t.push({date:v.toISOString().split("T")[0],label:v.toLocaleDateString("en-US",{weekday:"short"}),fullLabel:v.toLocaleDateString("en-US",{weekday:"long",month:"short",day:"numeric"})})}return t}),U=W(()=>{const t={};return V.value.forEach(s=>{t[s.date]=A.value.filter(l=>l.date.split("T")[0]===s.date)}),t}),O=()=>{const t=new Date(c.value);t.setDate(t.getDate()-7),c.value=t.toISOString().split("T")[0];const s=new Date(d.value);s.setDate(s.getDate()-7),d.value=s.toISOString().split("T")[0],D()},o=()=>{const t=new Date(c.value);t.setDate(t.getDate()+7),c.value=t.toISOString().split("T")[0];const s=new Date(d.value);s.setDate(s.getDate()+7),d.value=s.toISOString().split("T")[0],D()},a=t=>{u.value=t.target.value?parseInt(t.target.value):null,D()},m=t=>{T.value=t,w.value=!0},f=()=>{D()},$=t=>`${t.start_time} - ${t.end_time}`;return q(()=>{if(N(),!c.value){const t=new Date,s=t.getDay(),l=new Date(t);l.setDate(t.getDate()-s),c.value=l.toISOString().split("T")[0];const v=new Date(t);v.setDate(t.getDate()+(6-s)),d.value=v.toISOString().split("T")[0]}setTimeout(()=>{D()},100)}),G(()=>_.userId,t=>{t!==u.value&&(u.value=t,D())}),(t,s)=>(i(),r("div",$e,[e("div",Ce,[s[6]||(s[6]=e("h2",{class:"text-2xl font-bold text-gray-800 mb-4 sm:mb-0"},"Weekly Availability",-1)),e("div",Ie,[_.isAdmin?(i(),r("div",Te,[B(e("select",{"onUpdate:modelValue":s[0]||(s[0]=l=>u.value=l),onChange:a,class:"w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"},[s[3]||(s[3]=e("option",{value:null},"All Users",-1)),(i(!0),r(C,null,M(p.value,l=>(i(),r("option",{key:l.id,value:l.id},h(l.name),9,Me))),128))],544),[[Z,u.value]])])):k("",!0),e("div",Ne,[e("button",{onClick:O,class:"p-2 rounded-full bg-gray-100 hover:bg-gray-200 transition-colors"},s[4]||(s[4]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])),e("span",Ve,h(new Date(c.value).toLocaleDateString("en-US",{month:"short",day:"numeric"}))+" - "+h(new Date(d.value).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})),1),e("button",{onClick:o,class:"p-2 rounded-full bg-gray-100 hover:bg-gray-200 transition-colors"},s[5]||(s[5]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)]))])])]),x.value?(i(),r("div",Ue,s[7]||(s[7]=[e("svg",{class:"animate-spin h-8 w-8 text-indigo-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)]))):n.value?(i(),r("div",Be,h(n.value),1)):(i(),r("div",ze,[e("table",je,[e("thead",null,[e("tr",null,[(i(!0),r(C,null,M(V.value,l=>(i(),r("th",{key:l.date,class:"px-6 py-3 bg-gray-50 text-center text-xs font-medium text-gray-500 uppercase tracking-wider"},[e("div",Ee,[e("span",He,h(l.label),1),e("span",Oe,h(l.date),1)])]))),128))])]),e("tbody",Pe,[e("tr",null,[(i(!0),r(C,null,M(V.value,l=>(i(),r("td",{key:l.date,class:"px-2 py-4 whitespace-nowrap text-sm text-gray-500 border-r border-gray-100 align-top"},[e("div",Le,[!_.isAdmin||u.value?(i(),r("div",We,[e("button",{onClick:v=>m(l.date),class:"inline-flex items-center px-3 py-1 border border-transparent text-xs leading-4 font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-500 focus:outline-none focus:border-indigo-700 focus:shadow-outline-indigo active:bg-indigo-700 transition ease-in-out duration-150"},s[8]||(s[8]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})],-1),H(" Add ",-1)]),8,Fe)])):k("",!0),U.value[l.date]&&U.value[l.date].length>0?(i(),r("div",Re,[(i(!0),r(C,null,M(U.value[l.date],v=>(i(),r("div",{key:v.id,class:L(["mb-2 p-2 rounded-md",v.is_available?"bg-green-50 border border-green-100":"bg-red-50 border border-red-100"])},[e("div",Ge,[e("span",{class:L(["font-medium",v.is_available?"text-green-700":"text-red-700"])},h(v.user?v.user.name+" - ":"")+h(v.is_available?"Available":"Not Available"),3)]),v.is_available&&v.time_slots?(i(),r("div",qe,[(i(!0),r(C,null,M(v.time_slots,(J,K)=>(i(),r("div",{key:K,class:"text-xs text-gray-600 mt-1"},h($(J)),1))),128))])):k("",!0),!v.is_available&&v.reason?(i(),r("div",Je," Reason: "+h(v.reason),1)):k("",!0)],2))),128))])):(i(),r("div",Ke," No availability set "))])]))),128))])])])])),b(se,{show:y.value,date:T.value,userId:u.value,onClose:s[1]||(s[1]=l=>y.value=!1),onAvailabilitySaved:f},null,8,["show","date","userId"]),b(De,{show:w.value,date:T.value,userId:u.value,onClose:s[2]||(s[2]=l=>w.value=!1),onAvailabilitySaved:f},null,8,["show","date","userId"])]))}},Xe={class:"py-12"},Ye={class:"mx-auto max-w-7xl sm:px-6 lg:px-8"},Ze={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},et={class:"p-6 text-gray-900"},xt={__name:"Index",props:{auth:Object},setup(I){const _=I;ee();const{canDo:A}=te(),p=A("view_users_availability");return(x,n)=>(i(),r(C,null,[b(F(ae),{title:"Weekly Availability"}),b(le,null,{header:z(()=>n[0]||(n[0]=[e("h2",{class:"text-xl font-semibold leading-tight text-gray-800"}," Weekly Availability ",-1)])),default:z(()=>{var c,d;return[e("div",Xe,[e("div",Ye,[e("div",Ze,[e("div",et,[n[1]||(n[1]=e("p",{class:"mb-6 text-gray-600"}," View and manage your weekly availability. This helps in planning meetings and work schedules. ",-1)),b(Qe,{"user-id":(d=(c=_.auth)==null?void 0:c.user)==null?void 0:d.id,"is-admin":F(p)},null,8,["user-id","is-admin"])])])])])]}),_:1})],64))}};export{xt as default};
