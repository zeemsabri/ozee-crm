import{a as o,o as s,b as t,r as d,f as T,e as I,d as p,u as h,h as P,w as S,i as b,v as k,x as j,F as w,l as C,t as l,g as M,J as A,m as V,K as F}from"./app-uz7jLOH9.js";import{_ as L}from"./AuthenticatedLayout-BiRk_tnk.js";import{_ as q}from"./MultiSelectDropdown-Cr3Ix5tu.js";import"./auto-BIBwKD9g.js";import{C as G}from"./chart-DUfl3Dpl.js";import{r as H}from"./ClockIcon-C30D5fLN.js";import{r as J}from"./ChevronDownIcon-D6BltepL.js";import{r as K}from"./NoticeboardModal-Bd3ZJsT7.js";import"./PrimaryButton-fJeQTYNh.js";import"./Modal-9Ob81uBd.js";import"./InputLabel-CffkobvL.js";import"./InputError-pNzzakDy.js";import"./SecondaryButton-BQBAJtGL.js";import"./index-DHd-PSRu.js";import"./BaseFormModal-BRpxlLDW.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./TextInput-9F6Q-VFu.js";import"./SelectDropdown-tY2220Dt.js";/* empty css                                                                       */import"./debounce-C-hnF4Z3.js";import"./ApplicationLogo-DDazZIBi.js";import"./createLucideIcon-lO9WsaxY.js";import"./plus-DLaMPQe8.js";import"./DangerButton-C-AZkSAP.js";import"./moment-BLMuvzoS.js";function O(v,i){return s(),o("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m4.5 15.75 7.5-7.5 7.5 7.5"})])}const R={class:"h-64 w-full"},Z=["id"],U={__name:"ChartComponent",props:{data:{type:Object,required:!0},title:{type:String,default:"Productivity Chart"},chartId:{type:String,default:"productivity-chart"},type:{type:String,default:"bar"}},setup(v){const i=v,c=d(null);let m=null;const n=()=>{m&&m.destroy(),c.value&&(m=new G(c.value,{type:i.type,data:i.data,options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom"},title:{display:!!i.title,text:i.title}},scales:i.type==="pie"||i.type==="doughnut"?{}:{y:{beginAtZero:!0,title:{display:!0,text:"Hours"}}}}}))};return T(()=>{n()}),I(()=>i.data,()=>{n()},{deep:!0}),(f,g)=>(s(),o("div",R,[t("canvas",{ref_key:"chartRef",ref:c,id:v.chartId},null,8,Z)]))}},z={class:"py-12"},Q={class:"max-w-7xl mx-auto sm:px-6 lg:px-8 space-y-6"},W={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg p-6"},X={class:"grid grid-cols-1 md:grid-cols-4 gap-4 items-end"},Y={class:"col-span-1 md:col-span-2"},tt={class:"mt-4 flex justify-end"},et=["disabled"],st={key:0},ot={key:1},at={key:0,class:"grid grid-cols-1 md:grid-cols-3 gap-6"},rt={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg p-6 col-span-2"},it={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg p-6"},dt={key:1,class:"text-center py-10 text-gray-500"},nt={key:2,class:"text-center py-10"},lt={key:3,class:"space-y-4"},ct=["onClick"],ut={class:"flex items-center space-x-4"},pt=["src"],mt={class:"text-lg font-medium text-gray-900"},gt={class:"text-sm text-gray-500"},yt={class:"flex items-center space-x-4"},_t={class:"text-right"},xt={class:"text-2xl font-bold text-indigo-600"},ht={class:"border-t border-gray-200 bg-gray-50 p-6 space-y-4"},vt={key:0,class:"text-sm text-gray-500 italic"},ft={class:"flex justify-between items-start mb-2"},bt={class:"font-medium text-indigo-600 hover:text-indigo-800"},wt={class:"text-xs text-gray-500 bg-gray-100 px-2 py-0.5 rounded"},kt={class:"font-mono text-sm font-semibold text-gray-700 bg-gray-100 px-2 py-1 rounded"},Ct={class:"mt-3 overflow-x-auto"},Dt={class:"min-w-full text-xs text-left text-gray-500"},$t={class:"px-3 py-2 font-mono"},St={class:"px-3 py-2 font-mono"},jt={key:0,class:"ml-1 text-green-600 font-bold"},Vt={class:"px-3 py-2 font-medium text-gray-900"},Ut={class:"px-3 py-2"},Tt={key:0,class:"inline-flex items-center text-orange-600",title:"System capped duration due to missing pause"},Et={key:1,class:"text-green-600"},Nt={key:2,class:"text-gray-400"},re={__name:"Index",setup(v){const i=d([]),c=d({}),m=d([]);d({user_ids:[],date_start:"",date_end:""});const n=d(!1),f=d([]),g=d(""),_=d(""),D=r=>{const e=Math.floor(r/3600),a=Math.floor(r%3600/60),u=r%60;return`${e}h ${a}m ${u}s`},x=d({}),E=r=>{x.value[r]=!x.value[r]},$=async()=>{n.value=!0;try{const r=await window.axios.get("/api/productivity/report",{params:{user_ids:f.value.join(","),date_start:g.value,date_end:_.value}});i.value=r.data.reportData.details,c.value=r.data.reportData.charts,m.value=r.data.users,!g.value&&r.data.filters.date_start&&(g.value=r.data.filters.date_start),!_.value&&r.data.filters.date_end&&(_.value=r.data.filters.date_end),i.value.length===1&&(x.value[i.value[0].user_id]=!0)}catch(r){console.error("Error fetching productivity report:",r)}finally{n.value=!1}};T(()=>{$()});const N=()=>{$()};return(r,e)=>(s(),o(w,null,[p(h(P),{title:"Productivity Report"}),p(L,null,{header:S(()=>e[3]||(e[3]=[t("h2",{class:"font-semibold text-xl text-gray-800 leading-tight"},"Productivity Report",-1)])),default:S(()=>[t("div",z,[t("div",Q,[t("div",W,[t("div",X,[t("div",Y,[e[4]||(e[4]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Users",-1)),p(q,{modelValue:f.value,"onUpdate:modelValue":e[0]||(e[0]=a=>f.value=a),options:m.value,"is-multi":!0,placeholder:"Select Users...",class:"w-full"},null,8,["modelValue","options"])]),t("div",null,[e[5]||(e[5]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Start Date",-1)),k(t("input",{type:"date","onUpdate:modelValue":e[1]||(e[1]=a=>g.value=a),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"},null,512),[[j,g.value]])]),t("div",null,[e[6]||(e[6]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"End Date",-1)),k(t("input",{type:"date","onUpdate:modelValue":e[2]||(e[2]=a=>_.value=a),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"},null,512),[[j,_.value]])])]),t("div",tt,[t("button",{onClick:N,disabled:n.value,class:"inline-flex items-center px-4 py-2 bg-indigo-600 border border-transparent rounded-md font-semibold text-xs text-white uppercase tracking-widest hover:bg-indigo-700 focus:bg-indigo-700 active:bg-indigo-900 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition ease-in-out duration-150"},[n.value?(s(),o("span",st,"Loading...")):(s(),o("span",ot,"Generate Report"))],8,et)])]),i.value.length>0&&c.value.daily_trend?(s(),o("div",at,[t("div",rt,[e[7]||(e[7]=t("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"Productivity Trend (Daily)",-1)),p(U,{data:c.value.daily_trend,type:"line",chartId:"dailyTrendChart"},null,8,["data"])]),t("div",it,[e[8]||(e[8]=t("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"Time by Project",-1)),p(U,{data:c.value.project_dist,type:"pie",chartId:"projectDistChart"},null,8,["data"])])])):b("",!0),i.value.length===0&&!n.value?(s(),o("div",dt,[p(h(H),{class:"h-12 w-12 mx-auto text-gray-300 mb-2"}),e[9]||(e[9]=t("p",null,"No data found.",-1))])):b("",!0),n.value?(s(),o("div",nt,e[10]||(e[10]=[t("p",{class:"text-gray-500"},"Loading Report...",-1)]))):(s(),o("div",lt,[(s(!0),o(w,null,C(i.value,a=>(s(),o("div",{key:a.user_id,class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},[t("div",{onClick:u=>E(a.user_id),class:"p-6 flex items-center justify-between cursor-pointer hover:bg-gray-50 transition-colors"},[t("div",ut,[t("img",{src:a.avatar,alt:"",class:"h-10 w-10 rounded-full bg-gray-200"},null,8,pt),t("div",null,[t("h3",mt,l(a.user_name),1),t("p",gt,l(a.tasks.length)+" tasks worked on",1)])]),t("div",yt,[t("div",_t,[t("div",xt,l(a.total_hours)+" hrs",1),e[11]||(e[11]=t("div",{class:"text-xs text-gray-500"},"Total Time",-1))]),(s(),M(A(x.value[a.user_id]?h(O):h(J)),{class:"h-5 w-5 text-gray-400"}))])],8,ct),k(t("div",ht,[a.tasks.length===0?(s(),o("div",vt,"No tasks recorded in this period.")):b("",!0),(s(!0),o(w,null,C(a.tasks,u=>(s(),o("div",{key:u.task_id,class:"bg-white border rounded-lg p-4 shadow-sm"},[t("div",ft,[t("div",null,[t("h4",bt,l(u.task_name),1),t("span",wt,l(u.project_name),1)]),t("span",kt,l(D(u.total_seconds)),1)]),t("div",Ct,[t("table",Dt,[e[13]||(e[13]=t("thead",{class:"text-xs text-gray-700 uppercase bg-gray-50"},[t("tr",null,[t("th",{class:"px-3 py-2"},"Start"),t("th",{class:"px-3 py-2"},"End"),t("th",{class:"px-3 py-2"},"Duration"),t("th",{class:"px-3 py-2"},"Status")])],-1)),t("tbody",null,[(s(!0),o(w,null,C(u.sessions,(y,B)=>(s(),o("tr",{key:B,class:"border-b last:border-0 hover:bg-gray-50"},[t("td",$t,l(y.start),1),t("td",St,[V(l(y.end)+" ",1),y.type==="ongoing"?(s(),o("span",jt,"(Active)")):b("",!0)]),t("td",Vt,l(D(y.duration_seconds)),1),t("td",Ut,[y.type==="auto_capped"?(s(),o("span",Tt,[p(h(K),{class:"h-4 w-4 mr-1"}),e[12]||(e[12]=V(" Capped ",-1))])):y.type==="ongoing"?(s(),o("span",Et,"Running")):(s(),o("span",Nt,"Recorded"))])]))),128))])])])]))),128))],512),[[F,x.value[a.user_id]]])]))),128))]))])])]),_:1})],64))}};export{re as default};
