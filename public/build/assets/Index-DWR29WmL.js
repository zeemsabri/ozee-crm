import{r as m,b as N,q as v,o as l,w as A,a as i,c as u,k as C,F as g,e as E,f as S,i as O,u as R,t as k,H as j}from"./app-nAqQJsbR.js";import{_ as B}from"./AuthenticatedLayout-xY_DmKWf.js";import{u as D,f as L}from"./workflowStore-DJRVtfVl.js";import P from"./AutomationHub-B9IMS809.js";import U from"./AutomationBuilder-PIaEwWxy.js";import"./PrimaryButton-yJM6lm_0.js";import"./Modal-DhbO6a4Q.js";import"./InputLabel-D-9b_EvI.js";import"./InputError-Dtq2oRc3.js";import"./SecondaryButton-CWcCkJJP.js";import"./index-CEM64rK8.js";import"./BaseFormModal-D6fLUGFx.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./TextInput-CQd22ZsB.js";import"./SelectDropdown-C_0VCa5k.js";/* empty css                                                                       */import"./debounce-C-hnF4Z3.js";import"./RightSidebar-CP9mncM7.js";import"./ApplicationLogo-tQZvHTWH.js";import"./MultiSelectDropdown-BvFQZe28.js";import"./createLucideIcon-5puRqNY3.js";import"./plus-Djkg5stV.js";import"./DangerButton-BoUJgTYa.js";import"./moment-BLMuvzoS.js";import"./taskState-DGvI4lqK.js";import"./NoticeboardModal-BqMQX20H.js";import"./x-P1eR8_mO.js";import"./ConfirmModal-D71UgVWg.js";import"./WorkflowLogsModal-DIyPbt1e.js";import"./circle-x-DEe0k6_k.js";import"./trash-CxuT3PTC.js";import"./VueFlowCanvas-DT5a-PNt.js";import"./WorkflowNode-Bcu8M450.js";import"./TriggerStep-B_wWf5DO.js";import"./StepCard-D3kJ9o_B.js";import"./ConditionStep-DuZDC4OK.js";import"./RelationshipPathPicker-BKrWn30C.js";import"./ActionStep-DCZKV_OS.js";import"./DataTokenInserter-Ih7p2Wa9.js";import"./AIStep-CRh6hcai.js";import"./RelatedDataPicker-DLQphbYw.js";import"./PromptForm-QfgynpE3.js";import"./ResponseBuilder-Do9q1djb.js";import"./FieldBuilder-14tMKHGE.js";import"./chevron-down-DV6WOc73.js";import"./ForEachStep-xsusXeOg.js";import"./FetchRecordsStep-CiCrbWFR.js";import"./ScheduleTriggerStep-CqCqZTYl.js";import"./TransformStep-C3qELYCO.js";import"./DefineVariableStep-Bon1p2Ua.js";import"./AddStepButton-B42h9j-Z.js";import"./WorkflowMinimap-BHTozGUx.js";import"./TriggerSelectionModal-Cv1UAn2v.js";const $={class:"p-4 sm:p-6 lg:p-8 font-sans"},J={class:"mb-4 p-3 border rounded bg-white/70 flex flex-col sm:flex-row gap-2 sm:items-center"},V={class:"flex-1 flex items-center gap-2"},F=["value"],H={class:"flex items-center gap-2"},Te={__name:"Index",setup(T){const a=D(),p=m("hub"),c=m(null),s=m(null),d=m(null);N(()=>{a.fetchWorkflows()});function f(o=null){c.value=o,p.value="builder"}function h(){c.value=null,p.value="hub",a.fetchWorkflows()}function _(o,e){const r=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),t=URL.createObjectURL(r),n=document.createElement("a");n.href=t,n.download=o,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(t)}async function y(){try{const o=s.value;if(!o){alert("Please select a workflow to export.");return}const e=await L(o);if(!e){alert("Could not fetch the selected workflow.");return}const r={_meta:{type:"automation_workflow",version:1,exported_at:new Date().toISOString(),source:window.location.origin},name:e.name,description:e.description||null,trigger_event:e.trigger_event,is_active:!!e.is_active,steps:Array.isArray(e.steps)?e.steps:[]},t=(e.name||"workflow").replace(/[^a-z0-9-_]+/gi,"_");_(`${t}_export.json`,r)}catch(o){console.error("Export failed",o),alert("Export failed. See console for details.")}}function x(){d.value&&d.value.click()}async function b(o){const e=o.target.files&&o.target.files[0];if(e)try{const r=await e.text(),t=JSON.parse(r);if(!t||typeof t!="object"){alert("Invalid file format."),o.target.value="";return}if(!t.steps||!Array.isArray(t.steps)){alert("Invalid import: missing steps array."),o.target.value="";return}if(window.confirm(`Import: Do you want to CREATE a NEW workflow from this file?

Press OK to create new. Press Cancel to update an existing workflow.`)){const w={name:t.name||`Imported Workflow ${new Date().toLocaleString()}`,description:t.description||null,trigger_event:t.trigger_event||"manual.run",is_active:!!t.is_active,steps:Array.isArray(t.steps)?t.steps:[]};await a.createWorkflow(w),alert("Workflow imported as new."),await a.fetchWorkflows()}else{if(!s.value){alert("Please select an existing workflow (from the dropdown) to update."),o.target.value="";return}if(!window.confirm(`WARNING: This will replace the selected workflow's data and all its steps with the imported file. This action cannot be undone.

Press OK to overwrite.`)){o.target.value="";return}const I=s.value,W={name:t.name||void 0,description:t.description??null,trigger_event:t.trigger_event||void 0,is_active:typeof t.is_active=="boolean"?t.is_active:void 0,steps:Array.isArray(t.steps)?t.steps:[]};await a.updateWorkflow(I,W),alert("Workflow updated from import."),await a.fetchWorkflows()}}catch(r){console.error("Import failed",r),alert("Import failed. Ensure the file is a valid export JSON.")}finally{o.target.value=""}}return(o,e)=>(l(),v(B,null,{default:A(()=>[i("div",$,[p.value==="hub"?(l(),u(g,{key:0},[i("div",J,[i("div",V,[e[3]||(e[3]=i("label",{class:"text-sm text-gray-700 whitespace-nowrap"},"Workflow",-1)),S(i("select",{"onUpdate:modelValue":e[0]||(e[0]=r=>s.value=r),class:"border rounded px-2 py-1 text-sm w-full sm:w-80"},[e[2]||(e[2]=i("option",{value:null},"-- Select a workflow --",-1)),(l(!0),u(g,null,O(R(a).workflows,r=>(l(),u("option",{key:r.id,value:r.id},k(r.name)+" (ID: "+k(r.id)+")",9,F))),128))],512),[[j,s.value]])]),i("div",H,[i("button",{onClick:y,class:"px-3 py-1.5 text-sm bg-blue-600 hover:bg-blue-700 text-white rounded"},"Export"),i("button",{onClick:x,class:"px-3 py-1.5 text-sm bg-emerald-600 hover:bg-emerald-700 text-white rounded"},"Import"),i("input",{ref_key:"fileInputRef",ref:d,type:"file",accept:"application/json,.json",class:"hidden",onChange:b},null,544)])]),E(P,{onNew:e[1]||(e[1]=r=>f()),onEdit:f})],64)):p.value==="builder"?(l(),v(U,{key:1,"automation-id":c.value,onBack:h},null,8,["automation-id"])):C("",!0)])]),_:1}))}};export{Te as default};
