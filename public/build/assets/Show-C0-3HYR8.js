import{h as ce,S as he,B as Ce,b as zt,c as qt,R as Gt,d as Kt,e as Jt,_ as Zt}from"./AuthenticatedLayout-DnUwVpjg.js";import{r as k,B as fe,i as d,o,b as e,F as J,j as Q,g as E,t as h,m as H,am as je,e as p,an as Xe,a as N,A as ne,c as X,ao as ut,L as ct,p as ee,D as xe,T as ze,ap as se,H as Xt,P as Oe,aq as Qt,d as we,z as ke,w as de,s as R,f as me,k as be,v as We,h as K,G as es,_ as Ee,al as ts,l as Qe,ar as mt,Y as et,ab as ss,a5 as Ue,u as ls,M as as,aj as is,ah as ns,y as os,ag as rs}from"./app-BZHi1PF3.js";import{c as ge,a as Ie,d as He,f as Ve,b as ds,_ as us}from"./ProjectForm-D8WXPh5L.js";import{a as ye,_ as Se}from"./SecondaryButton-CgswrBZv.js";import{P as ue}from"./PrimaryButton-CHTvk5Xg.js";import{a as yt,_ as ft}from"./StandupModal-hYJ10rUq.js";import{_ as Y}from"./InputLabel-B1klTUhR.js";import{_ as oe,a as le}from"./InputError-BsWnhO0M.js";import{_ as bt}from"./EmailEditor-Cix4hN5U.js";import"./ApplicationLogo-D116xlgZ.js";import"./Checkbox-BlMLajzi.js";import"./ProjectTypeInput-C0Ak9p49.js";const cs={class:"bg-white p-6 rounded-xl shadow-md hover:shadow-lg transition-shadow mb-6"},ms={key:0,class:"text-sm text-gray-500"},vs={key:1,class:"text-sm text-gray-500"},ps={key:2,class:"space-y-3"},hs={class:"flex justify-between items-start"},gs={class:"font-medium text-gray-900"},ys={class:"text-sm text-gray-600"},fs={key:0,class:"text-sm text-gray-600 mt-1"},bs={class:"flex space-x-2"},_s=["href"],ws=["href"],xs=["onClick"],ks={__name:"ProjectMeetingsList",props:{projectId:{type:Number,required:!0}},setup(l,{expose:t}){const s=l,n=k([]),i=k(!1),a=k(""),u=()=>{try{a.value=Intl.DateTimeFormat().resolvedOptions().timeZone}catch(g){console.error("Error detecting user timezone:",g),a.value="UTC"}},r=(g,w=null,C=!1)=>{if(!g)return"";try{if(C||g.endsWith("Z")){if(w&&w===a.value){const $={dateStyle:"medium",timeStyle:"short"};return new Date(g).toLocaleString(void 0,$)}const D={dateStyle:"medium",timeStyle:"short",timeZone:w||a.value};return new Date(g).toLocaleString(void 0,D)}else{if(w&&w===a.value){const $={dateStyle:"medium",timeStyle:"short"};return new Date(g).toLocaleString(void 0,$)}const D={dateStyle:"medium",timeStyle:"short",timeZone:w||a.value};return new Date(g).toLocaleString(void 0,D)}}catch(D){return console.error("Error formatting meeting time:",D),new Date(g).toLocaleString()}},m=(g,w=null,C=!1)=>{if(!g)return"";try{if(C||g.endsWith("Z")){if(w&&w===a.value){const $={timeStyle:"short"};return new Date(g).toLocaleTimeString(void 0,$)}const D={timeStyle:"short",timeZone:w||a.value};return new Date(g).toLocaleTimeString(void 0,D)}else{if(w&&w===a.value){const $={timeStyle:"short"};return new Date(g).toLocaleTimeString(void 0,$)}const D={timeStyle:"short",timeZone:w||a.value};return new Date(g).toLocaleTimeString(void 0,D)}}catch(D){return console.error("Error formatting meeting time (time only):",D),new Date(g).toLocaleTimeString()}},c=async()=>{i.value=!0;try{const g=await window.axios.get(`/api/projects/${s.projectId}/meetings`);n.value=g.data}catch(g){console.error("Error fetching project meetings:",g)}finally{i.value=!1}},v=async g=>{if(confirm("Are you sure you want to delete this meeting?"))try{await window.axios.delete(`/api/projects/${s.projectId}/meetings/${g}`),await c()}catch(w){console.error("Error deleting meeting:",w),alert("Failed to delete meeting. Please try again.")}};return t({fetchMeetings:c}),fe(()=>{u(),c()}),(g,w)=>(o(),d("div",cs,[w[4]||(w[4]=e("h4",{class:"text-md font-semibold text-gray-900 mb-2"},"Upcoming Meetings",-1)),i.value?(o(),d("div",ms," Loading meetings... ")):n.value.length===0?(o(),d("div",vs," No upcoming meetings scheduled. ")):(o(),d("div",ps,[(o(!0),d(J,null,Q(n.value,C=>(o(),d("div",{key:C.id,class:"p-3 bg-gray-50 rounded-lg border border-gray-200 hover:bg-gray-100 transition-colors"},[e("div",hs,[e("div",null,[e("h5",gs,h(C.summary),1),e("p",ys,h(r(C.start_time,C.timezone,C.is_utc))+" - "+h(m(C.end_time,C.timezone,C.is_utc)),1),C.location?(o(),d("p",fs,[w[0]||(w[0]=e("span",{class:"font-medium"},"Location:",-1)),H(" "+h(C.location),1)])):E("",!0)]),e("div",bs,[e("a",{href:C.google_event_link,target:"_blank",class:"text-blue-600 hover:text-blue-800",title:"View in Google Calendar"},w[1]||(w[1]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)]),8,_s),C.google_meet_link?(o(),d("a",{key:0,href:C.google_meet_link,target:"_blank",class:"text-green-600 hover:text-green-800",title:"Join Google Meet"},w[2]||(w[2]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})],-1)]),8,ws)):E("",!0),e("button",{onClick:D=>v(C.google_event_id),class:"text-red-600 hover:text-red-800",title:"Delete Meeting"},w[3]||(w[3]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)]),8,xs)])])]))),128))]))]))}};var Ds=Object.defineProperty,Cs=(l,t,s)=>t in l?Ds(l,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):l[t]=s,$e=(l,t,s)=>Cs(l,typeof t!="symbol"?t+"":t,s);const Es=(l,t,s)=>{const n=l[t];return n?typeof n=="function"?n():Promise.resolve(n):new Promise((i,a)=>{(typeof queueMicrotask=="function"?queueMicrotask:setTimeout)(a.bind(null,new Error("Unknown variable dynamic import: "+t+(t.split("/").length!==s?". Note that variables only represent file names one level deep.":""))))})};let Re,vt,pt,_e,Fe={},Ae={};class $s{constructor(t,s=!1){$e(this,"texts",{}),$e(this,"dateToMinutes",n=>n.getHours()*60+n.getMinutes()),_e=this,this._texts=t,!s&&Date&&!Date.prototype.addDays&&this._initDatePrototypes()}_initDatePrototypes(){Date.prototype.addDays=function(t){return _e.addDays(this,t)},Date.prototype.subtractDays=function(t){return _e.subtractDays(this,t)},Date.prototype.addHours=function(t){return _e.addHours(this,t)},Date.prototype.subtractHours=function(t){return _e.subtractHours(this,t)},Date.prototype.addMinutes=function(t){return _e.addMinutes(this,t)},Date.prototype.subtractMinutes=function(t){return _e.subtractMinutes(this,t)},Date.prototype.getWeek=function(){return _e.getWeek(this)},Date.prototype.isToday=function(){return _e.isToday(this)},Date.prototype.isLeapYear=function(){return _e.isLeapYear(this)},Date.prototype.format=function(t="YYYY-MM-DD"){return _e.formatDate(this,t)},Date.prototype.formatTime=function(t="HH:mm"){return _e.formatTime(this,t)}}removePrototypes(){delete Date.prototype.addDays,delete Date.prototype.subtractDays,delete Date.prototype.addHours,delete Date.prototype.subtractHours,delete Date.prototype.addMinutes,delete Date.prototype.subtractMinutes,delete Date.prototype.getWeek,delete Date.prototype.isToday,delete Date.prototype.isLeapYear,delete Date.prototype.format,delete Date.prototype.formatTime}updateTexts(t){this._texts=t}_todayFormatted(){return vt!==new Date().getDate()&&(Re=new Date,vt=Re.getDate(),pt=`${Re.getFullYear()}-${Re.getMonth()}-${Re.getDate()}`),pt}addDays(t,s){const n=new Date(t.valueOf());return n.setDate(n.getDate()+s),n}subtractDays(t,s){const n=new Date(t.valueOf());return n.setDate(n.getDate()-s),n}addHours(t,s){const n=new Date(t.valueOf());return n.setHours(n.getHours()+s),n}subtractHours(t,s){const n=new Date(t.valueOf());return n.setHours(n.getHours()-s),n}addMinutes(t,s){const n=new Date(t.valueOf());return n.setMinutes(n.getMinutes()+s),n}subtractMinutes(t,s){const n=new Date(t.valueOf());return n.setMinutes(n.getMinutes()-s),n}getWeek(t){const s=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate())),n=s.getUTCDay()||7;s.setUTCDate(s.getUTCDate()+4-n);const i=new Date(Date.UTC(s.getUTCFullYear(),0,1));return Math.ceil(((s-i)/864e5+1)/7)}isToday(t){return`${t.getFullYear()}-${t.getMonth()}-${t.getDate()}`===this._todayFormatted()}isLeapYear(t){const s=t.getFullYear();return!(s%400)||s%100&&!(s%4)}getPreviousFirstDayOfWeek(t=null,s){const n=t&&new Date(t.valueOf())||new Date,i=s?7:6;return n.setDate(n.getDate()-(n.getDay()+i)%7),n}stringToDate(t){return t instanceof Date?t:(t.length===10&&(t+=" 00:00"),new Date(t.replace(/-/g,"/")))}countDays(t,s){typeof t=="string"&&(t=t.replace(/-/g,"/")),typeof s=="string"&&(s=s.replace(/-/g,"/")),t=new Date(t).setHours(0,0,0,0),s=new Date(s).setHours(0,0,1,0);const n=(new Date(s).getTimezoneOffset()-new Date(t).getTimezoneOffset())*60*1e3;return Math.ceil((s-t-n)/(24*3600*1e3))}datesInSameTimeStep(t,s,n){return Math.abs(t.getTime()-s.getTime())<=n*60*1e3}formatDate(t,s="YYYY-MM-DD",n=null){if(n||(n=this._texts),s||(s="YYYY-MM-DD"),s==="YYYY-MM-DD")return this.formatDateLite(t);Fe={},Ae={};const i={YYYY:()=>this._hydrateDateObject(t,n).YYYY,YY:()=>this._hydrateDateObject(t,n).YY(),M:()=>this._hydrateDateObject(t,n).M,MM:()=>this._hydrateDateObject(t,n).MM(),MMM:()=>this._hydrateDateObject(t,n).MMM(),MMMM:()=>this._hydrateDateObject(t,n).MMMM(),MMMMG:()=>this._hydrateDateObject(t,n).MMMMG(),D:()=>this._hydrateDateObject(t,n).D,DD:()=>this._hydrateDateObject(t,n).DD(),S:()=>this._hydrateDateObject(t,n).S(),d:()=>this._hydrateDateObject(t,n).d,dd:()=>this._hydrateDateObject(t,n).dd(),ddd:()=>this._hydrateDateObject(t,n).ddd(),dddd:()=>this._hydrateDateObject(t,n).dddd(),HH:()=>this._hydrateTimeObject(t,n).HH,H:()=>this._hydrateTimeObject(t,n).H,hh:()=>this._hydrateTimeObject(t,n).hh,h:()=>this._hydrateTimeObject(t,n).h,am:()=>this._hydrateTimeObject(t,n).am,AM:()=>this._hydrateTimeObject(t,n).AM,mm:()=>this._hydrateTimeObject(t,n).mm,m:()=>this._hydrateTimeObject(t,n).m};return s.replace(/(\{[a-zA-Z]+\}|[a-zA-Z]+)/g,(a,u)=>{const r=i[u.replace(/\{|\}/g,"")];return r!==void 0?r():u})}formatDateLite(t){const s=t.getMonth()+1,n=t.getDate();return`${t.getFullYear()}-${s<10?"0":""}${s}-${n<10?"0":""}${n}`}formatTime(t,s="HH:mm",n=null,i=!1){let a=!1;if(i){const[m,c,v]=[t.getHours(),t.getMinutes(),t.getSeconds()];m+c+v===141&&(a=!0)}if(t instanceof Date&&s==="HH:mm")return a?"24:00":this.formatTimeLite(t);Ae={},n||(n=this._texts);const u=this._hydrateTimeObject(t,n),r=s.replace(/(\{[a-zA-Z]+\}|[a-zA-Z]+)/g,(m,c)=>{const v=u[c.replace(/\{|\}/g,"")];return v!==void 0?v:c});return a?r.replace("23:59","24:00"):r}formatTimeLite(t){const s=t.getHours(),n=t.getMinutes();return`${(s<10?"0":"")+s}:${(n<10?"0":"")+n}`}_nth(t){if(t>3&&t<21)return"th";switch(t%10){case 1:return"st";case 2:return"nd";case 3:return"rd";default:return"th"}}_hydrateDateObject(t,s){if(Fe.D)return Fe;const n=t.getFullYear(),i=t.getMonth()+1,a=t.getDate(),r=(t.getDay()-1+7)%7;return Fe={YYYY:n,YY:()=>n.toString().substring(2),M:i,MM:()=>(i<10?"0":"")+i,MMM:()=>s.months[i-1].substring(0,3),MMMM:()=>s.months[i-1],MMMMG:()=>(s.monthsGenitive||s.months)[i-1],D:a,DD:()=>(a<10?"0":"")+a,S:()=>this._nth(a),d:r+1,dd:()=>s.weekDays[r][0],ddd:()=>s.weekDays[r].substr(0,3),dddd:()=>s.weekDays[r]},Fe}_hydrateTimeObject(t,s){if(Ae.am)return Ae;let n,i;t instanceof Date?(n=t.getHours(),i=t.getMinutes()):(n=Math.floor(t/60),i=Math.floor(t%60));const a=n%12?n%12:12,u=(s||{am:"am",pm:"pm"})[n===24||n<12?"am":"pm"];return Ae={H:n,h:a,HH:(n<10?"0":"")+n,hh:(a<10?"0":"")+a,am:u,AM:u.toUpperCase(),m:i,mm:(i<10?"0":"")+i},Ae}}const Ss=1440;class Ms{constructor(t){$e(this,"_vuecal",null),$e(this,"selectCell",(s=!1,n,i)=>{this._vuecal.$emit("cell-click",i?{date:n,split:i}:n),this._vuecal.clickToNavigate||s?this._vuecal.switchToNarrowerView():this._vuecal.dblclickToNavigate&&"ontouchstart"in window&&(this._vuecal.domEvents.dblTapACell.taps++,setTimeout(()=>this._vuecal.domEvents.dblTapACell.taps=0,this._vuecal.domEvents.dblTapACell.timeout),this._vuecal.domEvents.dblTapACell.taps>=2&&(this._vuecal.domEvents.dblTapACell.taps=0,this._vuecal.switchToNarrowerView(),this._vuecal.$emit("cell-dblclick",i?{date:n,split:i}:n)))}),$e(this,"keyPressEnterCell",(s,n)=>{this._vuecal.$emit("cell-keypress-enter",n?{date:s,split:n}:s),this._vuecal.switchToNarrowerView()}),$e(this,"getPosition",s=>{const{left:n,top:i}=this._vuecal.cellsEl.getBoundingClientRect(),{clientX:a,clientY:u}="ontouchstart"in window&&s.touches?s.touches[0]:s;return{x:a-n,y:u-i}}),$e(this,"minutesAtCursor",s=>{let n=0,i={x:0,y:0};const{timeStep:a,timeCellHeight:u,timeFrom:r}=this._vuecal.$props;return typeof s=="number"?n=s:typeof s=="object"&&(i=this.getPosition(s),n=Math.round(i.y*a/parseInt(u)+r)),{minutes:Math.max(Math.min(n,Ss),0),cursorCoords:i}}),this._vuecal=t}}const Ts=2,Je=1440;let ve,pe,Ze;class js{constructor(t,s){$e(this,"_vuecal",null),$e(this,"eventDefaults",{_eid:null,start:"",startTimeMinutes:0,end:"",endTimeMinutes:0,title:"",content:"",background:!1,allDay:!1,segments:null,repeat:null,daysCount:1,deletable:!0,deleting:!1,titleEditable:!0,resizable:!0,resizing:!1,draggable:!0,dragging:!1,draggingStatic:!1,focused:!1,class:""}),this._vuecal=t,ve=s}createAnEvent(t,s,n){if(typeof t=="string"&&(t=ve.stringToDate(t)),!(t instanceof Date))return!1;const i=ve.dateToMinutes(t);s=s*1||Ts*60;const a=i+s,u=ve.addMinutes(new Date(t),s);n.end&&(typeof n.end=="string"&&(n.end=ve.stringToDate(n.end)),n.endTimeMinutes=ve.dateToMinutes(n.end));const r={...this.eventDefaults,_eid:`${this._vuecal._.uid}_${this._vuecal.eventIdIncrement++}`,start:t,startTimeMinutes:i,end:u,endTimeMinutes:a,segments:null,...n};if(!(typeof this._vuecal.onEventCreate=="function"&&!this._vuecal.onEventCreate(r,()=>this.deleteAnEvent(r))))return r.startDateF!==r.endDateF&&(r.daysCount=ve.countDays(r.start,r.end)),this._vuecal.mutableEvents.push(r),this._vuecal.addEventsToView([r]),this._vuecal.emitWithEvent("event-create",r),this._vuecal.$emit("event-change",{event:this._vuecal.cleanupEvent(r),originalEvent:null}),r}addEventSegment(t){t.segments||(t.segments={},t.segments[ve.formatDateLite(t.start)]={start:t.start,startTimeMinutes:t.startTimeMinutes,endTimeMinutes:Je,isFirstDay:!0,isLastDay:!1});const s=t.segments[ve.formatDateLite(t.end)];s&&(s.isLastDay=!1,s.endTimeMinutes=Je);const n=ve.addDays(t.end,1),i=ve.formatDateLite(n);return n.setHours(0,0,0,0),t.segments[i]={start:n,startTimeMinutes:0,endTimeMinutes:t.endTimeMinutes,isFirstDay:!1,isLastDay:!0},t.end=ve.addMinutes(n,t.endTimeMinutes),t.daysCount=Object.keys(t.segments).length,i}removeEventSegment(t){let s=Object.keys(t.segments).length;if(s<=1)return ve.formatDateLite(t.end);delete t.segments[ve.formatDateLite(t.end)],s--;const n=ve.subtractDays(t.end,1),i=ve.formatDateLite(n),a=t.segments[i];return s?a&&(a.isLastDay=!0,a.endTimeMinutes=t.endTimeMinutes):t.segments=null,t.daysCount=s||1,t.end=n,i}createEventSegments(t,s,n){const i=s.getTime(),a=n.getTime();let u=t.start.getTime(),r=t.end.getTime(),m=!1,c,v,g;for(!t.end.getHours()&&!t.end.getMinutes()&&(r-=1e3),t.segments={},t.repeat?(c=i,v=Math.min(a,t.repeat.until?ve.stringToDate(t.repeat.until).getTime():a)):(c=Math.max(i,u),v=Math.min(a,r));c<=v;){let w=!1;const C=ve.addDays(new Date(c),1).setHours(0,0,0,0);let D,$,y,f;if(t.repeat){const M=new Date(c),V=ve.formatDateLite(M);(m||t.occurrences&&t.occurrences[V])&&(m||(u=t.occurrences[V].start,g=new Date(u).setHours(0,0,0,0),r=t.occurrences[V].end),m=!0,w=!0),D=c===g,$=V===ve.formatDateLite(new Date(r)),y=new Date(D?u:c),f=ve.formatDateLite(y),$&&(m=!1)}else w=!0,D=c===u,$=v===r&&C>v,y=D?t.start:new Date(c),f=ve.formatDateLite(D?t.start:y);w&&(t.segments[f]={start:y,startTimeMinutes:D?t.startTimeMinutes:0,endTimeMinutes:$?t.endTimeMinutes:Je,isFirstDay:D,isLastDay:$}),c=C}return t}deleteAnEvent(t){this._vuecal.emitWithEvent("event-delete",t),this._vuecal.mutableEvents=this._vuecal.mutableEvents.filter(s=>s._eid!==t._eid),this._vuecal.view.events=this._vuecal.view.events.filter(s=>s._eid!==t._eid)}checkCellOverlappingEvents(t,s){Ze=t.slice(0),pe={},t.forEach(i=>{Ze.shift(),pe[i._eid]||(pe[i._eid]={overlaps:[],start:i.start,position:0}),pe[i._eid].position=0,Ze.forEach(a=>{pe[a._eid]||(pe[a._eid]={overlaps:[],start:a.start,position:0});const u=this.eventInRange(a,i.start,i.end),r=s.overlapsPerTimeStep?ve.datesInSameTimeStep(i.start,a.start,s.timeStep):1;if(!i.background&&!i.allDay&&!a.background&&!a.allDay&&u&&r)pe[i._eid].overlaps.push(a._eid),pe[i._eid].overlaps=[...new Set(pe[i._eid].overlaps)],pe[a._eid].overlaps.push(i._eid),pe[a._eid].overlaps=[...new Set(pe[a._eid].overlaps)],pe[a._eid].position++;else{let m,c;(m=(pe[i._eid]||{overlaps:[]}).overlaps.indexOf(a._eid))>-1&&pe[i._eid].overlaps.splice(m,1),(c=(pe[a._eid]||{overlaps:[]}).overlaps.indexOf(i._eid))>-1&&pe[a._eid].overlaps.splice(c,1),pe[a._eid].position--}})});let n=0;for(const i in pe){const a=pe[i],u=a.overlaps.map(r=>({id:r,start:pe[r].start}));u.push({id:i,start:a.start}),u.sort((r,m)=>r.start<m.start?-1:r.start>m.start?1:r.id>m.id?-1:1),a.position=u.findIndex(r=>r.id===i),n=Math.max(this.getOverlapsStreak(a,pe),n)}return[pe,n]}getOverlapsStreak(t,s={}){let n=t.overlaps.length+1,i=[];return t.overlaps.forEach(a=>{i.includes(a)||t.overlaps.filter(r=>r!==a).forEach(r=>{s[r].overlaps.includes(a)||i.push(r)})}),i=[...new Set(i)],n-=i.length,n}eventInRange(t,s,n){if(t.allDay||!this._vuecal.time){const u=new Date(t.start).setHours(0,0,0,0);return new Date(t.end).setHours(23,59,0,0)>=new Date(s).setHours(0,0,0,0)&&u<=new Date(n).setHours(0,0,0,0)}const i=t.start.getTime(),a=t.end.getTime();return i<n.getTime()&&a>s.getTime()}}const Vs={class:"vuecal__flex vuecal__weekdays-headings"},As=["onClick"],Is={class:"vuecal__flex weekday-label",grow:""},Os={class:"full"},Ls={class:"small"},Us={class:"xsmall"},Ns={key:0},Ps={key:0,class:"vuecal__flex vuecal__split-days-headers",grow:""};function Rs(l,t,s,n,i,a){return o(),d("div",Vs,[(o(!0),d(J,null,Q(a.headings,(u,r)=>(o(),d(J,{key:r},[u.hide?E("",!0):(o(),d("div",{key:0,class:ee(["vuecal__flex vuecal__heading",{today:u.today,clickable:a.cellHeadingsClickable}]),style:xe(a.weekdayCellStyles),onClick:m=>a.view.id==="week"&&a.selectCell(u.date,m),onDblclick:t[0]||(t[0]=m=>a.view.id==="week"&&a.vuecal.dblclickToNavigate&&s.switchToNarrowerView())},[p(ze,{name:`slide-fade--${s.transitionDirection}`,appear:a.vuecal.transitions},{default:N(()=>[(o(),d("div",{class:"vuecal__flex",column:"",key:a.vuecal.transitions?`${r}-${u.dayOfMonth}`:!1},[e("div",Is,[ne(l.$slots,"weekday-heading",{heading:a.cleanupHeading(u),view:a.view},()=>[e("span",Os,h(u.full),1),e("span",Ls,h(u.small),1),e("span",Us,h(u.xsmall),1),u.dayOfMonth?(o(),d("span",Ns," "+h(u.dayOfMonth),1)):E("",!0)])]),a.vuecal.hasSplits&&a.vuecal.stickySplitLabels?(o(),d("div",Ps,[(o(!0),d(J,null,Q(a.vuecal.daySplits,(m,c)=>(o(),d("div",{class:ee(["day-split-header",m.class||!1]),key:c},[ne(l.$slots,"split-label",{split:m,view:a.view},()=>[H(h(m.label),1)])],2))),128))])):E("",!0)]))]),_:2},1032,["name","appear"])],46,As))],64))),128))])}const Ne=(l,t)=>{const s=l.__vccOpts||l;for(const[n,i]of t)s[n]=i;return s},Fs={inject:["vuecal","utils","view"],props:{transitionDirection:{type:String,default:"right"},weekDays:{type:Array,default:()=>[]},switchToNarrowerView:{type:Function,default:()=>{}}},methods:{selectCell(l,t){l.getTime()!==this.view.selectedDate.getTime()&&(this.view.selectedDate=l),this.utils.cell.selectCell(!1,l,t)},cleanupHeading:l=>({label:l.full,date:l.date,...l.today?{today:l.today}:{}})},computed:{headings(){if(!["month","week"].includes(this.view.id))return[];let l=!1;return this.weekDays.map((s,n)=>{const i=this.utils.date.addDays(this.view.startDate,this.vuecal.startWeekOnSunday&&this.vuecal.hideWeekends?n-1:n);return{hide:s.hide,full:s.label,small:s.short||s.label.substr(0,3),xsmall:s.short||s.label.substr(0,1),...this.view.id==="week"?{dayOfMonth:i.getDate(),date:i,today:!l&&this.utils.date.isToday(i)&&!l++}:{}}})},cellWidth(){return 100/(7-this.weekDays.reduce((l,t)=>l+t.hide,0))},weekdayCellStyles(){return{...this.vuecal.hideWeekdays.length?{width:`${this.cellWidth}%`}:{}}},cellHeadingsClickable(){return this.view.id==="week"&&(this.vuecal.clickToNavigate||this.vuecal.dblclickToNavigate)}}},_t=Ne(Fs,[["render",Rs]]),Bs={class:"vuecal__header"},Hs={key:0,class:"vuecal__flex vuecal__menu",role:"tablist","aria-label":"Calendar views navigation"},Ws=["onDragenter","onDragleave","onClick","aria-label"],Ys={key:1,class:"vuecal__title-bar"},zs=["aria-label"],qs={class:"vuecal__flex vuecal__title",grow:""},Gs=["aria-label"],Ks={key:0,class:"vuecal__flex vuecal__split-days-headers"};function Js(l,t,s,n,i,a){const u=je("weekdays-headings");return o(),d("div",Bs,[s.options.hideViewSelector?E("",!0):(o(),d("div",Hs,[(o(!0),d(J,null,Q(s.viewProps.views,(r,m)=>(o(),d(J,{key:m},[r.enabled?(o(),d("button",{key:0,class:ee(["vuecal__view-btn",{"vuecal__view-btn--active":a.view.id===m,"vuecal__view-btn--highlighted":l.highlightedControl===m}]),type:"button",onDragenter:c=>s.editEvents.drag&&a.dnd&&a.dnd.viewSelectorDragEnter(c,m,l.$data),onDragleave:c=>s.editEvents.drag&&a.dnd&&a.dnd.viewSelectorDragLeave(c,m,l.$data),onClick:c=>a.switchView(m,null,!0),"aria-label":`${r.label} view`},h(r.label),43,Ws)):E("",!0)],64))),128))])),s.options.hideTitleBar?E("",!0):(o(),d("div",Ys,[e("button",{class:ee(["vuecal__arrow vuecal__arrow--prev",{"vuecal__arrow--highlighted":l.highlightedControl==="previous"}]),type:"button",onClick:t[0]||(t[0]=(...r)=>a.previous&&a.previous(...r)),onDragenter:t[1]||(t[1]=r=>s.editEvents.drag&&a.dnd&&a.dnd.viewSelectorDragEnter(r,"previous",l.$data)),onDragleave:t[2]||(t[2]=r=>s.editEvents.drag&&a.dnd&&a.dnd.viewSelectorDragLeave(r,"previous",l.$data)),"aria-label":`Previous ${a.view.id}`},[ne(l.$slots,"arrow-prev")],42,zs),e("div",qs,[p(ze,{name:s.options.transitions?`slide-fade--${a.transitionDirection}`:""},{default:N(()=>[(o(),X(Xt(a.broaderView?"button":"span"),{type:!!a.broaderView&&"button",key:`${a.view.id}${a.view.startDate.toString()}`,onClick:t[3]||(t[3]=r=>!!a.broaderView&&a.switchToBroaderView()),"aria-label":!!a.broaderView&&`Go to ${a.broaderView} view`},{default:N(()=>[ne(l.$slots,"title")]),_:3},8,["type","aria-label"]))]),_:3},8,["name"])]),s.options.todayButton?(o(),d("button",{key:0,class:ee(["vuecal__today-btn",{"vuecal__today-btn--highlighted":l.highlightedControl==="today"}]),type:"button",onClick:t[4]||(t[4]=(...r)=>a.goToToday&&a.goToToday(...r)),onDragenter:t[5]||(t[5]=r=>s.editEvents.drag&&a.dnd&&a.dnd.viewSelectorDragEnter(r,"today",l.$data)),onDragleave:t[6]||(t[6]=r=>s.editEvents.drag&&a.dnd&&a.dnd.viewSelectorDragLeave(r,"today",l.$data)),"aria-label":"Today"},[ne(l.$slots,"today-button")],34)):E("",!0),e("button",{class:ee(["vuecal__arrow vuecal__arrow--next",{"vuecal__arrow--highlighted":l.highlightedControl==="next"}]),type:"button",onClick:t[7]||(t[7]=(...r)=>a.next&&a.next(...r)),onDragenter:t[8]||(t[8]=r=>s.editEvents.drag&&a.dnd&&a.dnd.viewSelectorDragEnter(r,"next",l.$data)),onDragleave:t[9]||(t[9]=r=>s.editEvents.drag&&a.dnd&&a.dnd.viewSelectorDragLeave(r,"next",l.$data)),"aria-label":`Next ${a.view.id}`},[ne(l.$slots,"arrow-next")],42,Gs)])),s.viewProps.weekDaysInHeader?(o(),X(u,{key:2,"week-days":s.weekDays,"transition-direction":a.transitionDirection,"switch-to-narrower-view":s.switchToNarrowerView},Xe({_:2},[l.$slots["weekday-heading"]?{name:"weekday-heading",fn:N(({heading:r,view:m})=>[ne(l.$slots,"weekday-heading",{heading:r,view:m})]),key:"0"}:void 0,l.$slots["split-label"]?{name:"split-label",fn:N(({split:r})=>[ne(l.$slots,"split-label",{split:r,view:a.view})]),key:"1"}:void 0]),1032,["week-days","transition-direction","switch-to-narrower-view"])):E("",!0),p(ze,{name:`slide-fade--${a.transitionDirection}`},{default:N(()=>[a.showDaySplits?(o(),d("div",Ks,[(o(!0),d(J,null,Q(s.daySplits,(r,m)=>(o(),d("div",{class:ee(["day-split-header",r.class||!1]),key:m},[ne(l.$slots,"split-label",{split:r,view:a.view.id},()=>[H(h(r.label),1)])],2))),128))])):E("",!0)]),_:3},8,["name"])])}const Zs={inject:["vuecal","previous","next","switchView","updateSelectedDate","modules","view"],components:{WeekdaysHeadings:_t},props:{options:{type:Object,default:()=>({})},editEvents:{type:Object,required:!0},hasSplits:{type:[Boolean,Number],default:!1},daySplits:{type:Array,default:()=>[]},viewProps:{type:Object,default:()=>({})},weekDays:{type:Array,default:()=>[]},switchToNarrowerView:{type:Function,default:()=>{}}},data:()=>({highlightedControl:null}),methods:{goToToday(){this.updateSelectedDate(new Date(new Date().setHours(0,0,0,0)))},switchToBroaderView(){this.transitionDirection="left",this.broaderView&&this.switchView(this.broaderView)}},computed:{transitionDirection:{get(){return this.vuecal.transitionDirection},set(l){this.vuecal.transitionDirection=l}},broaderView(){const{enabledViews:l}=this.vuecal;return l[l.indexOf(this.view.id)-1]},showDaySplits(){return this.view.id==="day"&&this.hasSplits&&this.options.stickySplitLabels&&!this.options.minSplitWidth},dnd(){return this.modules.dnd}}},Xs=Ne(Zs,[["render",Js]]),Qs=["draggable"];function el(l,t,s,n,i,a){return o(),d("div",{class:ee(["vuecal__event",a.eventClasses]),style:xe(a.eventStyles),tabindex:"0",onFocus:t[4]||(t[4]=(...u)=>a.focusEvent&&a.focusEvent(...u)),onKeypress:t[5]||(t[5]=Oe(we((...u)=>a.onEnterKeypress&&a.onEnterKeypress(...u),["stop"]),["enter"])),onMouseenter:t[6]||(t[6]=(...u)=>a.onMouseEnter&&a.onMouseEnter(...u)),onMouseleave:t[7]||(t[7]=(...u)=>a.onMouseLeave&&a.onMouseLeave(...u)),onTouchstart:t[8]||(t[8]=we((...u)=>a.onTouchStart&&a.onTouchStart(...u),["stop"])),onMousedown:t[9]||(t[9]=u=>a.onMouseDown(u)),onMouseup:t[10]||(t[10]=(...u)=>a.onMouseUp&&a.onMouseUp(...u)),onTouchend:t[11]||(t[11]=(...u)=>a.onMouseUp&&a.onMouseUp(...u)),onTouchmove:t[12]||(t[12]=(...u)=>a.onTouchMove&&a.onTouchMove(...u)),onDblclick:t[13]||(t[13]=(...u)=>a.onDblClick&&a.onDblClick(...u)),draggable:a.draggable,onDragstart:t[14]||(t[14]=u=>a.draggable&&a.onDragStart(u)),onDragend:t[15]||(t[15]=u=>a.draggable&&a.onDragEnd())},[a.vuecal.editEvents.delete&&s.event.deletable?(o(),d("div",{key:0,class:"vuecal__event-delete",onClick:t[0]||(t[0]=we((...u)=>a.deleteEvent&&a.deleteEvent(...u),["stop"])),onTouchstart:t[1]||(t[1]=we((...u)=>a.touchDeleteEvent&&a.touchDeleteEvent(...u),["stop"]))},h(a.vuecal.texts.deleteEvent),33)):E("",!0),ne(l.$slots,"event",{event:s.event,view:a.view.id}),a.resizable?(o(),d("div",{key:1,class:"vuecal__event-resize-handle",contenteditable:"false",onMousedown:t[2]||(t[2]=we((...u)=>a.onResizeHandleMouseDown&&a.onResizeHandleMouseDown(...u),["stop","prevent"])),onTouchstart:t[3]||(t[3]=we((...u)=>a.onResizeHandleMouseDown&&a.onResizeHandleMouseDown(...u),["stop","prevent"]))},null,32)):E("",!0)],46,Qs)}const tl={inject:["vuecal","utils","modules","view","domEvents","editEvents"],props:{cellFormattedDate:{type:String,default:""},event:{type:Object,default:()=>({})},cellEvents:{type:Array,default:()=>[]},overlaps:{type:Array,default:()=>[]},eventPosition:{type:Number,default:0},overlapsStreak:{type:Number,default:0},allDay:{type:Boolean,default:!1}},data:()=>({touch:{dragThreshold:30,startX:0,startY:0,dragged:!1}}),methods:{onMouseDown(l,t=!1){if("ontouchstart"in window&&!t)return!1;const{clickHoldAnEvent:s,focusAnEvent:n,resizeAnEvent:i,dragAnEvent:a}=this.domEvents;if(n._eid===this.event._eid&&s._eid===this.event._eid)return!0;this.focusEvent(),s._eid=null,this.vuecal.editEvents.delete&&this.event.deletable&&(s.timeoutId=setTimeout(()=>{!i._eid&&!a._eid&&(s._eid=this.event._eid,this.event.deleting=!0)},s.timeout))},onMouseUp(l){this.domEvents.focusAnEvent._eid===this.event._eid&&!this.touch.dragged&&(this.domEvents.focusAnEvent.mousedUp=!0),this.touch.dragged=!1},onMouseEnter(l){l.preventDefault(),this.vuecal.emitWithEvent("event-mouse-enter",this.event)},onMouseLeave(l){l.preventDefault(),this.vuecal.emitWithEvent("event-mouse-leave",this.event)},onTouchMove(l){if(typeof this.vuecal.onEventClick!="function")return;const{clientX:t,clientY:s}=l.touches[0],{startX:n,startY:i,dragThreshold:a}=this.touch;(Math.abs(t-n)>a||Math.abs(s-i)>a)&&(this.touch.dragged=!0)},onTouchStart(l){this.touch.startX=l.touches[0].clientX,this.touch.startY=l.touches[0].clientY,this.onMouseDown(l,!0)},onEnterKeypress(l){if(typeof this.vuecal.onEventClick=="function")return this.vuecal.onEventClick(this.event,l)},onDblClick(l){if(typeof this.vuecal.onEventDblclick=="function")return this.vuecal.onEventDblclick(this.event,l)},onDragStart(l){this.dnd&&this.dnd.eventDragStart(l,this.event)},onDragEnd(){this.dnd&&this.dnd.eventDragEnd(this.event)},onResizeHandleMouseDown(){this.focusEvent(),this.domEvents.dragAnEvent._eid=null,this.domEvents.resizeAnEvent=Object.assign(this.domEvents.resizeAnEvent,{_eid:this.event._eid,start:(this.segment||this.event).start,split:this.event.split||null,segment:!!this.segment&&this.utils.date.formatDateLite(this.segment.start),originalEnd:new Date((this.segment||this.event).end),originalEndTimeMinutes:this.event.endTimeMinutes}),this.event.resizing=!0},deleteEvent(l=!1){if("ontouchstart"in window&&!l)return!1;this.utils.event.deleteAnEvent(this.event)},touchDeleteEvent(l){this.deleteEvent(!0)},cancelDeleteEvent(){this.event.deleting=!1},focusEvent(){const{focusAnEvent:l}=this.domEvents,t=l._eid;if(t!==this.event._eid){if(t){const s=this.view.events.find(n=>n._eid===t);s&&(s.focused=!1)}this.vuecal.cancelDelete(),this.vuecal.emitWithEvent("event-focus",this.event),l._eid=this.event._eid,this.event.focused=!0}}},computed:{eventDimensions(){const{startTimeMinutes:l,endTimeMinutes:t}=this.segment||this.event;let s=l-this.vuecal.timeFrom;const n=Math.max(Math.round(s*this.vuecal.timeCellHeight/this.vuecal.timeStep),0);s=Math.min(t,this.vuecal.timeTo)-this.vuecal.timeFrom;const i=Math.round(s*this.vuecal.timeCellHeight/this.vuecal.timeStep),a=Math.max(i-n,5);return{top:n,height:a}},eventStyles(){if(this.event.allDay||!this.vuecal.time||!this.event.endTimeMinutes||this.view.id==="month"||this.allDay)return{};let l=100/Math.min(this.overlaps.length+1,this.overlapsStreak),t=100/(this.overlaps.length+1)*this.eventPosition;this.vuecal.minEventWidth&&l<this.vuecal.minEventWidth&&(l=this.vuecal.minEventWidth,t=(100-this.vuecal.minEventWidth)/this.overlaps.length*this.eventPosition);const{top:s,height:n}=this.eventDimensions;return{top:`${s}px`,height:`${n}px`,width:`${l}%`,left:this.event.left&&`${this.event.left}px`||`${t}%`}},eventClasses(){const{isFirstDay:l,isLastDay:t}=this.segment||{};return{[this.event.class]:!!this.event.class,"vuecal__event--focus":this.event.focused,"vuecal__event--resizing":this.event.resizing,"vuecal__event--background":this.event.background,"vuecal__event--deletable":this.event.deleting,"vuecal__event--all-day":this.event.allDay,"vuecal__event--dragging":!this.event.draggingStatic&&this.event.dragging,"vuecal__event--static":this.event.dragging&&this.event.draggingStatic,"vuecal__event--multiple-days":!!this.segment,"event-start":this.segment&&l&&!t,"event-middle":this.segment&&!l&&!t,"event-end":this.segment&&t&&!l}},segment(){return this.event.segments&&this.event.segments[this.cellFormattedDate]||null},draggable(){const{draggable:l,background:t,daysCount:s}=this.event;return this.vuecal.editEvents.drag&&l&&!t&&s===1},resizable(){const{editEvents:l,time:t}=this.vuecal;return l.resize&&this.event.resizable&&t&&!this.allDay&&(!this.segment||this.segment&&this.segment.isLastDay)&&this.view.id!=="month"},dnd(){return this.modules.dnd}}},sl=Ne(tl,[["render",el]]),ll=["data-split","aria-label","onTouchstart","onMousedown","onDragover","onDrop"],al={key:0,class:"cell-time-labels"},il=["innerHTML"],nl={key:2,class:"vuecal__cell-events"},ol=["title"];function rl(l,t,s,n,i,a){const u=je("event");return o(),X(Qt,{class:ee(["vuecal__cell",a.cellClasses]),name:`slide-fade--${a.transitionDirection}`,tag:"div",appear:s.options.transitions,style:xe(a.cellStyles)},{default:N(()=>[(o(!0),d(J,null,Q(a.splitsCount?a.splits:1,(r,m)=>(o(),d("div",{class:ee(["vuecal__flex vuecal__cell-content",a.splitsCount&&a.splitClasses(r)]),key:s.options.transitions?`${a.view.id}-${s.data.content}-${m}`:m,"data-split":a.splitsCount?r.id:!1,column:"",tabindex:"0","aria-label":s.data.content,onFocus:t[0]||(t[0]=c=>a.onCellFocus(c)),onKeypress:t[1]||(t[1]=Oe(c=>a.onCellkeyPressEnter(c),["enter"])),onTouchstart:c=>!a.isDisabled&&a.onCellTouchStart(c,a.splitsCount?r.id:null),onMousedown:c=>!a.isDisabled&&a.onCellMouseDown(c,a.splitsCount?r.id:null),onClick:t[2]||(t[2]=c=>!a.isDisabled&&a.onCellClick(c)),onDblclick:t[3]||(t[3]=c=>!a.isDisabled&&a.onCellDblClick(c)),onContextmenu:t[4]||(t[4]=c=>!a.isDisabled&&s.options.cellContextmenu&&a.onCellContextMenu(c)),onDragenter:t[5]||(t[5]=c=>!a.isDisabled&&s.editEvents.drag&&a.dnd&&a.dnd.cellDragEnter(c,l.$data,s.data.startDate)),onDragover:c=>!a.isDisabled&&s.editEvents.drag&&a.dnd&&a.dnd.cellDragOver(c,l.$data,s.data.startDate,a.splitsCount?r.id:null),onDragleave:t[6]||(t[6]=c=>!a.isDisabled&&s.editEvents.drag&&a.dnd&&a.dnd.cellDragLeave(c,l.$data,s.data.startDate)),onDrop:c=>!a.isDisabled&&s.editEvents.drag&&a.dnd&&a.dnd.cellDragDrop(c,l.$data,s.data.startDate,a.splitsCount?r.id:null)},[s.options.showTimeInCells&&s.options.time&&a.isWeekOrDayView&&!s.allDay?(o(),d("div",al,[(o(!0),d(J,null,Q(a.vuecal.timeCells,(c,v)=>(o(),d("span",{class:"cell-time-label",key:v},h(c.label),1))),128))])):E("",!0),a.isWeekOrDayView&&!s.allDay&&a.specialHours.length?(o(!0),d(J,{key:1},Q(a.specialHours,(c,v)=>(o(),d("div",{class:ee(["vuecal__special-hours",`vuecal__special-hours--day${c.day} ${c.class}`]),style:xe(`height: ${c.height}px;top: ${c.top}px`)},[c.label?(o(),d("div",{key:0,class:"special-hours-label",innerHTML:c.label},null,8,il)):E("",!0)],6))),256)):E("",!0),ne(l.$slots,"cell-content",{events:a.events,selectCell:c=>a.selectCell(c,!0),split:a.splitsCount?r:!1}),a.eventsCount&&(a.isWeekOrDayView||a.view.id==="month"&&s.options.eventsOnMonthView)?(o(),d("div",nl,[(o(!0),d(J,null,Q(a.splitsCount?r.events:a.events,(c,v)=>(o(),X(u,{key:v,"cell-formatted-date":s.data.formattedDate,event:c,"all-day":s.allDay,"cell-events":a.splitsCount?r.events:a.events,overlaps:((a.splitsCount?r.overlaps[c._eid]:l.cellOverlaps[c._eid])||[]).overlaps,"event-position":((a.splitsCount?r.overlaps[c._eid]:l.cellOverlaps[c._eid])||[]).position,"overlaps-streak":a.splitsCount?r.overlapsStreak:l.cellOverlapsStreak},{event:N(({event:g,view:w})=>[ne(l.$slots,"event",{view:w,event:g})]),_:2},1032,["cell-formatted-date","event","all-day","cell-events","overlaps","event-position","overlaps-streak"]))),128))])):E("",!0)],42,ll))),128)),a.timelineVisible?(o(),d("div",{class:"vuecal__now-line",style:xe(`top: ${a.todaysTimePosition}px`),key:s.options.transitions?`${a.view.id}-now-line`:"now-line",title:a.utils.date.formatTime(a.vuecal.now)},null,12,ol)):E("",!0)]),_:3},8,["class","name","appear","style"])}const dl={inject:["vuecal","utils","modules","view","domEvents"],components:{Event:sl},props:{options:{type:Object,default:()=>({})},editEvents:{type:Object,required:!0},data:{type:Object,required:!0},cellSplits:{type:Array,default:()=>[]},minTimestamp:{type:[Number,null],default:null},maxTimestamp:{type:[Number,null],default:null},cellWidth:{type:[Number,Boolean],default:!1},allDay:{type:Boolean,default:!1}},data:()=>({cellOverlaps:{},cellOverlapsStreak:1,timeAtCursor:null,highlighted:!1,highlightedSplit:null}),methods:{getSplitAtCursor({target:l}){let s=l.classList.contains("vuecal__cell-split")?l:this.vuecal.findAncestor(l,"vuecal__cell-split");return s&&(s=s.attributes["data-split"].value,parseInt(s).toString()===s.toString()&&(s=parseInt(s))),s||null},splitClasses(l){return{"vuecal__cell-split":!0,"vuecal__cell-split--highlighted":this.highlightedSplit===l.id,[l.class]:!!l.class}},checkCellOverlappingEvents(){this.options.time&&this.eventsCount&&!this.splitsCount&&(this.eventsCount===1?(this.cellOverlaps=[],this.cellOverlapsStreak=1):[this.cellOverlaps,this.cellOverlapsStreak]=this.utils.event.checkCellOverlappingEvents(this.events,this.options))},isDOMElementAnEvent(l){return this.vuecal.isDOMElementAnEvent(l)},selectCell(l,t=!1){const s=this.splitsCount?this.getSplitAtCursor(l):null;this.utils.cell.selectCell(t,this.timeAtCursor,s),this.timeAtCursor=null},onCellkeyPressEnter(l){this.isSelected||this.onCellFocus(l);const t=this.splitsCount?this.getSplitAtCursor(l):null;this.utils.cell.keyPressEnterCell(this.timeAtCursor,t),this.timeAtCursor=null},onCellFocus(l){if(!this.isSelected&&!this.isDisabled){this.isSelected=this.data.startDate;const t=this.splitsCount?this.getSplitAtCursor(l):null,s=this.timeAtCursor||this.data.startDate;this.vuecal.$emit("cell-focus",t?{date:s,split:t}:s)}},onCellMouseDown(l,t=null,s=!1){if("ontouchstart"in window&&!s)return!1;this.isSelected||this.onCellFocus(l);const{clickHoldACell:n,focusAnEvent:i}=this.domEvents;this.domEvents.cancelClickEventCreation=!1,n.eventCreated=!1,this.timeAtCursor=new Date(this.data.startDate);const{minutes:a,cursorCoords:{y:u}}=this.vuecal.minutesAtCursor(l);this.timeAtCursor.setMinutes(a);const r=this.isDOMElementAnEvent(l.target);!r&&i._eid&&((this.view.events.find(m=>m._eid===i._eid)||{}).focused=!1),this.editEvents.create&&!r&&this.setUpEventCreation(l,u)},setUpEventCreation(l,t){if(this.options.dragToCreateEvent&&["week","day"].includes(this.view.id)){const{dragCreateAnEvent:s}=this.domEvents;if(s.startCursorY=t,s.split=this.splitsCount?this.getSplitAtCursor(l):null,s.start=this.timeAtCursor,this.options.snapToTime){let n=this.timeAtCursor.getHours()*60+this.timeAtCursor.getMinutes();const i=n+this.options.snapToTime/2;n=i-i%this.options.snapToTime,s.start.setHours(0,n,0,0)}}else this.options.cellClickHold&&["month","week","day"].includes(this.view.id)&&this.setUpCellHoldTimer(l)},setUpCellHoldTimer(l){const{clickHoldACell:t}=this.domEvents;t.cellId=`${this.vuecal._.uid}_${this.data.formattedDate}`,t.split=this.splitsCount?this.getSplitAtCursor(l):null,t.timeoutId=setTimeout(()=>{if(t.cellId&&!this.domEvents.cancelClickEventCreation){const{_eid:s}=this.utils.event.createAnEvent(this.timeAtCursor,null,t.split?{split:t.split}:{});t.eventCreated=s}},t.timeout)},onCellTouchStart(l,t=null){this.onCellMouseDown(l,t,!0)},onCellClick(l){this.isDOMElementAnEvent(l.target)||this.selectCell(l)},onCellDblClick(l){const t=new Date(this.data.startDate);t.setMinutes(this.vuecal.minutesAtCursor(l).minutes);const s=this.splitsCount?this.getSplitAtCursor(l):null;this.vuecal.$emit("cell-dblclick",s?{date:t,split:s}:t),this.options.dblclickToNavigate&&this.vuecal.switchToNarrowerView()},onCellContextMenu(l){l.stopPropagation(),l.preventDefault();const t=new Date(this.data.startDate),{cursorCoords:s,minutes:n}=this.vuecal.minutesAtCursor(l);t.setMinutes(n);const i=this.splitsCount?this.getSplitAtCursor(l):null;this.vuecal.$emit("cell-contextmenu",{date:t,...s,...i||{},e:l})}},computed:{dnd(){return this.modules.dnd},nowInMinutes(){return this.utils.date.dateToMinutes(this.vuecal.now)},isBeforeMinDate(){return this.minTimestamp!==null&&this.minTimestamp>this.data.endDate.getTime()},isAfterMaxDate(){return this.maxTimestamp&&this.maxTimestamp<this.data.startDate.getTime()},isDisabled(){const{disableDays:l}=this.options,{isYearsOrYearView:t}=this.vuecal;return l.length&&l.includes(this.data.formattedDate)&&!t?!0:this.isBeforeMinDate||this.isAfterMaxDate},isSelected:{get(){let l=!1;const{selectedDate:t}=this.view;return this.view.id==="years"?l=t.getFullYear()===this.data.startDate.getFullYear():this.view.id==="year"?l=t.getFullYear()===this.data.startDate.getFullYear()&&t.getMonth()===this.data.startDate.getMonth():l=t.getTime()===this.data.startDate.getTime(),l},set(l){this.view.selectedDate=l,this.vuecal.$emit("update:selected-date",this.view.selectedDate)}},isWeekOrDayView(){return["week","day"].includes(this.view.id)},transitionDirection(){return this.vuecal.transitionDirection},specialHours(){return this.data.specialHours.map(l=>{let{from:t,to:s}=l;return t=Math.max(t,this.options.timeFrom),s=Math.min(s,this.options.timeTo),{...l,height:(s-t)*this.timeScale,top:(t-this.options.timeFrom)*this.timeScale}})},events(){const{startDate:l,endDate:t}=this.data;let s=[];if(!(["years","year"].includes(this.view.id)&&!this.options.eventsCountOnYearView)){if(s=this.view.events.slice(0),this.view.id==="month"&&s.push(...this.view.outOfScopeEvents),s=s.filter(n=>this.utils.event.eventInRange(n,l,t)),this.options.showAllDayEvents&&this.view.id!=="month"&&(s=s.filter(n=>!!n.allDay===this.allDay)),this.options.time&&this.isWeekOrDayView&&!this.allDay){const{timeFrom:n,timeTo:i}=this.options;s=s.filter(a=>{const u=a.daysCount>1&&a.segments[this.data.formattedDate]||{},r=a.daysCount===1&&a.startTimeMinutes<i&&a.endTimeMinutes>n,m=a.daysCount>1&&u.startTimeMinutes<i&&u.endTimeMinutes>n;return a.allDay||r||m||!1})}this.options.time&&this.isWeekOrDayView&&!(this.options.showAllDayEvents&&this.allDay)&&s.sort((n,i)=>n.start<i.start?-1:1),this.cellSplits.length||this.$nextTick(this.checkCellOverlappingEvents)}return s},eventsCount(){return this.events.length},splits(){return this.cellSplits.map((l,t)=>{const s=this.events.filter(a=>a.split===l.id),[n,i]=this.utils.event.checkCellOverlappingEvents(s.filter(a=>!a.background&&!a.allDay),this.options);return{...l,overlaps:n,overlapsStreak:i,events:s}})},splitsCount(){return this.splits.length},cellClasses(){return{[this.data.class]:!!this.data.class,"vuecal__cell--current":this.data.current,"vuecal__cell--today":this.data.today,"vuecal__cell--out-of-scope":this.data.outOfScope,"vuecal__cell--before-min":this.isDisabled&&this.isBeforeMinDate,"vuecal__cell--after-max":this.isDisabled&&this.isAfterMaxDate,"vuecal__cell--disabled":this.isDisabled,"vuecal__cell--selected":this.isSelected,"vuecal__cell--highlighted":this.highlighted,"vuecal__cell--has-splits":this.splitsCount,"vuecal__cell--has-events":this.eventsCount}},cellStyles(){return{...this.cellWidth?{width:`${this.cellWidth}%`}:{}}},timelineVisible(){const{time:l,timeTo:t}=this.options;return this.data.today&&this.isWeekOrDayView&&l&&!this.allDay&&this.nowInMinutes<=t},todaysTimePosition(){if(!this.data.today||!this.options.time)return;const l=this.nowInMinutes-this.options.timeFrom;return Math.round(l*this.timeScale)},timeScale(){return this.options.timeCellHeight/this.options.timeStep}}},wt=Ne(dl,[["render",rl]]),ul={key:0,class:"vuecal__all-day-text",style:{width:"3em"}};function cl(l,t,s,n,i,a){const u=je("vuecal-cell");return o(),d("div",{class:"vuecal__flex vuecal__all-day",style:xe(s.cellOrSplitMinWidth&&{height:s.height})},[s.cellOrSplitMinWidth?E("",!0):(o(),d("div",ul,[e("span",null,h(s.label),1)])),e("div",{class:ee(["vuecal__flex vuecal__cells",`${a.view.id}-view`]),grow:"",style:xe(s.cellOrSplitMinWidth?`min-width: ${s.cellOrSplitMinWidth}px`:"")},[(o(!0),d(J,null,Q(s.cells,(r,m)=>(o(),X(u,{key:m,options:s.options,"edit-events":a.editEvents,data:r,"all-day":!0,"cell-width":s.options.hideWeekdays.length&&(a.vuecal.isWeekView||a.vuecal.isMonthView)&&a.vuecal.cellWidth,"min-timestamp":s.options.minTimestamp,"max-timestamp":s.options.maxTimestamp,"cell-splits":s.daySplits},{event:N(({event:c,view:v})=>[ne(l.$slots,"event",{view:v,event:c})]),_:2},1032,["options","edit-events","data","cell-width","min-timestamp","max-timestamp","cell-splits"]))),128))],6)],4)}const ml={inject:["vuecal","view","editEvents"],components:{"vuecal-cell":wt},props:{options:{type:Object,required:!0},cells:{type:Array,required:!0},label:{type:String,required:!0},daySplits:{type:Array,default:()=>[]},shortEvents:{type:Boolean,default:!0},height:{type:String,default:""},cellOrSplitMinWidth:{type:Number,default:null}},computed:{hasCellOrSplitWidth(){return!!(this.options.minCellWidth||this.daySplits.length&&this.options.minSplitWidth)}}},vl=Ne(ml,[["render",cl]]),pl=["lang"],hl={class:"default"},gl={key:0,class:"vuecal__flex vuecal__body",grow:""},yl=["onBlur","innerHTML"],fl=["innerHTML"],bl=["innerHTML"],_l={class:"vuecal__flex",row:"",grow:""},wl={key:0,class:"vuecal__time-column"},xl={class:"vuecal__time-cell-label"},kl={key:1,class:"vuecal__flex vuecal__week-numbers",column:""},Dl=["wrap","column"],Cl=["onBlur","innerHTML"],El=["innerHTML"],$l=["innerHTML"],Sl=["wrap"],Ml=["innerHTML"],Tl=["innerHTML"],jl={key:2,class:"vuecal__cell-events-count"},Vl={key:3,class:"vuecal__no-event"},Al=["onBlur","innerHTML"],Il=["innerHTML"],Ol={key:2,class:"vuecal__event-time"},Ll={key:0},Ul={key:1,class:"days-to-end"},Nl=["innerHTML"],Pl={key:0,class:"vuecal__scrollbar-check"};function Rl(l,t,s,n,i,a){const u=je("vuecal-header"),r=je("all-day-bar"),m=je("weekdays-headings"),c=je("vuecal-cell");return o(),d("div",{class:ee(["vuecal__flex vuecal",a.cssClasses]),column:"",ref:"vuecal",lang:s.locale},[p(u,{options:l.$props,"edit-events":a.editEvents,"view-props":{views:a.views,weekDaysInHeader:a.weekDaysInHeader},"week-days":a.weekDays,"has-splits":a.hasSplits,"day-splits":a.daySplits,"switch-to-narrower-view":a.switchToNarrowerView},Xe({"arrow-prev":N(()=>[ne(l.$slots,"arrow-prev",{},()=>[t[0]||(t[0]=H(" ")),t[1]||(t[1]=e("i",{class:"angle"},null,-1)),t[2]||(t[2]=H(" "))])]),"arrow-next":N(()=>[ne(l.$slots,"arrow-next",{},()=>[t[3]||(t[3]=H(" ")),t[4]||(t[4]=e("i",{class:"angle"},null,-1)),t[5]||(t[5]=H(" "))])]),"today-button":N(()=>[ne(l.$slots,"today-button",{},()=>[e("span",hl,h(i.texts.today),1)])]),title:N(()=>[ne(l.$slots,"title",{title:a.viewTitle,view:i.view},()=>[H(h(a.viewTitle),1)])]),_:2},[l.$slots["weekday-heading"]?{name:"weekday-heading",fn:N(({heading:v,view:g})=>[ne(l.$slots,"weekday-heading",{heading:v,view:g})]),key:"0"}:void 0,l.$slots["split-label"]?{name:"split-label",fn:N(({split:v})=>[ne(l.$slots,"split-label",{split:v,view:i.view.id})]),key:"1"}:void 0]),1032,["options","edit-events","view-props","week-days","has-splits","day-splits","switch-to-narrower-view"]),s.hideBody?E("",!0):(o(),d("div",gl,[p(ze,{name:`slide-fade--${i.transitionDirection}`,appear:s.transitions},{default:N(()=>[(o(),d("div",{class:"vuecal__flex",style:{"min-width":"100%"},key:s.transitions?i.view.id:!1,column:""},[s.showAllDayEvents&&a.hasTimeColumn&&(!a.cellOrSplitMinWidth||a.isDayView&&!s.minSplitWidth)?(o(),X(r,ut(ct({key:0},a.allDayBar)),{event:N(({event:v,view:g})=>[ne(l.$slots,"event",{view:g,event:v},()=>[a.editEvents.title&&v.titleEditable?(o(),d("div",{key:0,class:"vuecal__event-title vuecal__event-title--edit",contenteditable:"",onBlur:w=>a.onEventTitleBlur(w,v),innerHTML:v.title},null,40,yl)):v.title?(o(),d("div",{key:1,class:"vuecal__event-title",innerHTML:v.title},null,8,fl)):E("",!0),v.content&&!a.hasShortEvents&&!a.isShortMonthView?(o(),d("div",{key:2,class:"vuecal__event-content",innerHTML:v.content},null,8,bl)):E("",!0)])]),_:3},16)):E("",!0),e("div",{class:ee(["vuecal__bg",{vuecal__flex:!a.hasTimeColumn}]),column:""},[e("div",_l,[a.hasTimeColumn?(o(),d("div",wl,[s.showAllDayEvents&&a.cellOrSplitMinWidth&&!(a.isDayView&&!s.minSplitWidth)?(o(),d("div",{key:0,class:"vuecal__all-day-text",style:xe({height:a.allDayBar.height})},[e("span",null,h(i.texts.allDay),1)],4)):E("",!0),(o(!0),d(J,null,Q(a.timeCells,(v,g)=>(o(),d("div",{class:"vuecal__time-cell",key:g,style:xe(`height: ${s.timeCellHeight}px`)},[ne(l.$slots,"time-cell",{hours:v.hours,minutes:v.minutes},()=>[t[6]||(t[6]=e("span",{class:"vuecal__time-cell-line"},null,-1)),e("span",xl,h(v.label),1)])],4))),128))])):E("",!0),s.showWeekNumbers&&a.isMonthView?(o(),d("div",kl,[(o(),d(J,null,Q(6,v=>e("div",{class:"vuecal__flex vuecal__week-number-cell",key:v,grow:""},[ne(l.$slots,"week-number-cell",{week:a.getWeekNumber(v-1)},()=>[H(h(a.getWeekNumber(v-1)),1)])])),64))])):E("",!0),e("div",{class:ee(["vuecal__flex vuecal__cells",`${i.view.id}-view`]),grow:"",wrap:!a.cellOrSplitMinWidth||!a.isWeekView,column:!!a.cellOrSplitMinWidth},[a.cellOrSplitMinWidth&&a.isWeekView?(o(),X(m,{key:0,"transition-direction":i.transitionDirection,"week-days":a.weekDays,"switch-to-narrower-view":a.switchToNarrowerView,style:xe(a.cellOrSplitMinWidth?`min-width: ${a.cellOrSplitMinWidth}px`:"")},Xe({_:2},[l.$slots["weekday-heading"]?{name:"weekday-heading",fn:N(({heading:v,view:g})=>[ne(l.$slots,"weekday-heading",{heading:v,view:g})]),key:"0"}:void 0,l.$slots["split-label"]?{name:"split-label",fn:N(({split:v})=>[ne(l.$slots,"split-label",{split:v,view:i.view.id})]),key:"1"}:void 0]),1032,["transition-direction","week-days","switch-to-narrower-view","style"])):a.hasSplits&&s.stickySplitLabels&&s.minSplitWidth?(o(),d("div",{key:1,class:"vuecal__flex vuecal__split-days-headers",style:xe(a.cellOrSplitMinWidth?`min-width: ${a.cellOrSplitMinWidth}px`:"")},[(o(!0),d(J,null,Q(a.daySplits,(v,g)=>(o(),d("div",{class:ee(["day-split-header",v.class||!1]),key:g},[ne(l.$slots,"split-label",{split:v,view:i.view.id},()=>[H(h(v.label),1)])],2))),128))],4)):E("",!0),s.showAllDayEvents&&a.hasTimeColumn&&(a.isWeekView&&a.cellOrSplitMinWidth||a.isDayView&&a.hasSplits&&s.minSplitWidth)?(o(),X(r,ut(ct({key:2},a.allDayBar)),{event:N(({event:v,view:g})=>[ne(l.$slots,"event",{view:g,event:v},()=>[a.editEvents.title&&v.titleEditable?(o(),d("div",{key:0,class:"vuecal__event-title vuecal__event-title--edit",contenteditable:"",onBlur:w=>a.onEventTitleBlur(w,v),innerHTML:v.title},null,40,Cl)):v.title?(o(),d("div",{key:1,class:"vuecal__event-title",innerHTML:v.title},null,8,El)):E("",!0),v.content&&!a.hasShortEvents&&!a.isShortMonthView?(o(),d("div",{key:2,class:"vuecal__event-content",innerHTML:v.content},null,8,$l)):E("",!0)])]),_:3},16)):E("",!0),e("div",{class:"vuecal__flex",ref:v=>i.cellsEl=v,grow:"",wrap:!a.cellOrSplitMinWidth||!a.isWeekView,style:xe(a.cellOrSplitMinWidth?`min-width: ${a.cellOrSplitMinWidth}px`:"")},[(o(!0),d(J,null,Q(a.viewCells,(v,g)=>(o(),X(c,{key:g,options:l.$props,"edit-events":a.editEvents,data:v,"cell-width":s.hideWeekdays.length&&(a.isWeekView||a.isMonthView)&&a.cellWidth,"min-timestamp":a.minTimestamp,"max-timestamp":a.maxTimestamp,"cell-splits":a.hasSplits&&a.daySplits||[]},{"cell-content":N(({events:w,split:C,selectCell:D})=>[ne(l.$slots,"cell-content",{cell:v,view:i.view,goNarrower:D,events:w},()=>[C&&!s.stickySplitLabels?(o(),d("div",{key:0,class:"split-label",innerHTML:C.label},null,8,Ml)):E("",!0),v.content?(o(),d("div",{key:1,class:"vuecal__cell-date",innerHTML:v.content},null,8,Tl)):E("",!0),(a.isMonthView&&!s.eventsOnMonthView||a.isYearsOrYearView&&s.eventsCountOnYearView)&&w.length?(o(),d("div",jl,[ne(l.$slots,"events-count",{view:i.view,events:w},()=>[H(h(w.length),1)])])):E("",!0),!a.cellOrSplitHasEvents(w,C)&&a.isWeekOrDayView?(o(),d("div",Vl,[ne(l.$slots,"no-event",{},()=>[H(h(i.texts.noEvent),1)])])):E("",!0)])]),event:N(({event:w,view:C})=>[ne(l.$slots,"event",{view:C,event:w},()=>[a.editEvents.title&&w.titleEditable?(o(),d("div",{key:0,class:"vuecal__event-title vuecal__event-title--edit",contenteditable:"",onBlur:D=>a.onEventTitleBlur(D,w),innerHTML:w.title},null,40,Al)):w.title?(o(),d("div",{key:1,class:"vuecal__event-title",innerHTML:w.title},null,8,Il)):E("",!0),s.time&&!w.allDay&&!(a.isMonthView&&(w.allDay||s.showAllDayEvents==="short"))&&!a.isShortMonthView?(o(),d("div",Ol,[H(h(i.utils.date.formatTime(w.start,a.TimeFormat)),1),w.endTimeMinutes?(o(),d("span",Ll," - "+h(i.utils.date.formatTime(w.end,a.TimeFormat,null,!0)),1)):E("",!0),w.daysCount>1&&(w.segments[v.formattedDate]||{}).isFirstDay?(o(),d("small",Ul," +"+h(w.daysCount-1)+h((i.texts.day[0]||"").toLowerCase()),1)):E("",!0)])):E("",!0),w.content&&!(a.isMonthView&&w.allDay&&s.showAllDayEvents==="short")&&!a.isShortMonthView?(o(),d("div",{key:3,class:"vuecal__event-content",innerHTML:w.content},null,8,Nl)):E("",!0)])]),"no-event":N(()=>[ne(l.$slots,"no-event",{},()=>[H(h(i.texts.noEvent),1)])]),_:2},1032,["options","edit-events","data","cell-width","min-timestamp","max-timestamp","cell-splits"]))),128))],12,Sl)],10,Dl)])],2)]))]),_:3},8,["name","appear"]),i.ready?E("",!0):(o(),d("div",Pl,t[7]||(t[7]=[e("div",null,null,-1)])))]))],10,pl)}const Be=1440,Ye={weekDays:Array(7).fill(""),weekDaysShort:[],months:Array(12).fill(""),years:"",year:"",month:"",week:"",day:"",today:"",noEvent:"",allDay:"",deleteEvent:"",createEvent:"",dateFormat:"dddd MMMM D, YYYY",am:"am",pm:"pm"},ht=["years","year","month","week","day"],gt=new $s(Ye),Fl={name:"vue-cal",components:{"vuecal-cell":wt,"vuecal-header":Xs,WeekdaysHeadings:_t,AllDayBar:vl},provide(){return{vuecal:this,utils:this.utils,modules:this.modules,previous:this.previous,next:this.next,switchView:this.switchView,updateSelectedDate:this.updateSelectedDate,editEvents:this.editEvents,view:this.view,domEvents:this.domEvents}},props:{activeView:{type:String,default:"week"},allDayBarHeight:{type:[String,Number],default:"25px"},cellClickHold:{type:Boolean,default:!0},cellContextmenu:{type:Boolean,default:!1},clickToNavigate:{type:Boolean,default:!1},dblclickToNavigate:{type:Boolean,default:!0},disableDatePrototypes:{type:Boolean,default:!1},disableDays:{type:Array,default:()=>[]},disableViews:{type:Array,default:()=>[]},dragToCreateEvent:{type:Boolean,default:!0},dragToCreateThreshold:{type:Number,default:15},editableEvents:{type:[Boolean,Object],default:!1},events:{type:Array,default:()=>[]},eventsCountOnYearView:{type:Boolean,default:!1},eventsOnMonthView:{type:[Boolean,String],default:!1},hideBody:{type:Boolean,default:!1},hideTitleBar:{type:Boolean,default:!1},hideViewSelector:{type:Boolean,default:!1},hideWeekdays:{type:Array,default:()=>[]},hideWeekends:{type:Boolean,default:!1},locale:{type:[String,Object],default:"en"},maxDate:{type:[String,Date],default:""},minCellWidth:{type:Number,default:0},minDate:{type:[String,Date],default:""},minEventWidth:{type:Number,default:0},minSplitWidth:{type:Number,default:0},onEventClick:{type:[Function,null],default:null},onEventCreate:{type:[Function,null],default:null},onEventDblclick:{type:[Function,null],default:null},overlapsPerTimeStep:{type:Boolean,default:!1},resizeX:{type:Boolean,default:!1},selectedDate:{type:[String,Date],default:""},showAllDayEvents:{type:[Boolean,String],default:!1},showTimeInCells:{type:Boolean,default:!1},showWeekNumbers:{type:[Boolean,String],default:!1},snapToTime:{type:Number,default:0},small:{type:Boolean,default:!1},specialHours:{type:Object,default:()=>({})},splitDays:{type:Array,default:()=>[]},startWeekOnSunday:{type:Boolean,default:!1},stickySplitLabels:{type:Boolean,default:!1},time:{type:Boolean,default:!0},timeCellHeight:{type:Number,default:40},timeFormat:{type:String,default:""},timeFrom:{type:Number,default:0},timeStep:{type:Number,default:60},timeTo:{type:Number,default:Be},todayButton:{type:Boolean,default:!1},transitions:{type:Boolean,default:!0},twelveHour:{type:Boolean,default:!1},watchRealTime:{type:Boolean,default:!1},xsmall:{type:Boolean,default:!1}},data(){return{ready:!1,texts:{...Ye},utils:{date:(this.disableDatePrototypes?gt.removePrototypes():!1)||gt,cell:null,event:null},modules:{dnd:null},cellsEl:null,view:{id:"",title:"",startDate:null,endDate:null,firstCellDate:null,lastCellDate:null,selectedDate:null,events:[]},eventIdIncrement:1,now:new Date,timeTickerIds:[null,null],domEvents:{resizeAnEvent:{_eid:null,start:null,split:null,segment:null,originalEndTimeMinutes:0,originalEnd:null,end:null,startCell:null,endCell:null},dragAnEvent:{_eid:null},dragCreateAnEvent:{startCursorY:null,start:null,split:null,event:null},focusAnEvent:{_eid:null,mousedUp:!1},clickHoldAnEvent:{_eid:null,timeout:1200,timeoutId:null},dblTapACell:{taps:0,timeout:500},clickHoldACell:{cellId:null,split:null,timeout:1200,timeoutId:null,eventCreated:!1},cancelClickEventCreation:!1},mutableEvents:[],transitionDirection:"right"}},methods:{async loadLocale(l){if(typeof this.locale=="object"){this.texts=Object.assign({},Ye,l),this.utils.date.updateTexts(this.texts);return}const t=await Es(Object.assign({"./i18n/ar.json":()=>se(()=>import("./ar.es-bitOgb9K.js"),[]),"./i18n/bg.json":()=>se(()=>import("./bg.es-5tp0KQRo.js"),[]),"./i18n/bn.json":()=>se(()=>import("./bn.es-C_qR0y0-.js"),[]),"./i18n/bs.json":()=>se(()=>import("./bs.es-DduooXS8.js"),[]),"./i18n/ca.json":()=>se(()=>import("./ca.es-DYDNDJFJ.js"),[]),"./i18n/cs.json":()=>se(()=>import("./cs.es-CvnAvfoI.js"),[]),"./i18n/da.json":()=>se(()=>import("./da.es-C_eJXDX3.js"),[]),"./i18n/de.json":()=>se(()=>import("./de.es-Cp-R9E16.js"),[]),"./i18n/el.json":()=>se(()=>import("./el.es-BZ44a1Tb.js"),[]),"./i18n/en.json":()=>se(()=>import("./en.es-DwVNOttH.js"),[]),"./i18n/es.json":()=>se(()=>import("./es.es-DO8PaQ_q.js"),[]),"./i18n/et.json":()=>se(()=>import("./et.es-DdRIcUrz.js"),[]),"./i18n/fa.json":()=>se(()=>import("./fa.es-XN0av8Tx.js"),[]),"./i18n/fi.json":()=>se(()=>import("./fi.es-B0Iy6aas.js"),[]),"./i18n/fr.json":()=>se(()=>import("./fr.es-B7WXlprl.js"),[]),"./i18n/he.json":()=>se(()=>import("./he.es-BWEk5prp.js"),[]),"./i18n/hr.json":()=>se(()=>import("./hr.es-B_iqHQyr.js"),[]),"./i18n/hu.json":()=>se(()=>import("./hu.es-D_t4Ibxf.js"),[]),"./i18n/id.json":()=>se(()=>import("./id.es-CzHAK-XV.js"),[]),"./i18n/is.json":()=>se(()=>import("./is.es-DChRpym4.js"),[]),"./i18n/it.json":()=>se(()=>import("./it.es-CquQA5xx.js"),[]),"./i18n/ja.json":()=>se(()=>import("./ja.es-B19gsG6H.js"),[]),"./i18n/ka.json":()=>se(()=>import("./ka.es-CuOe65jc.js"),[]),"./i18n/ko.json":()=>se(()=>import("./ko.es-CsMl2USK.js"),[]),"./i18n/lt.json":()=>se(()=>import("./lt.es-vqgjGyMx.js"),[]),"./i18n/mn.json":()=>se(()=>import("./mn.es-BmdwFdas.js"),[]),"./i18n/nl.json":()=>se(()=>import("./nl.es-CFxVMCWy.js"),[]),"./i18n/no.json":()=>se(()=>import("./no.es-qRcuRMwl.js"),[]),"./i18n/pl.json":()=>se(()=>import("./pl.es-BQ3a0ltx.js"),[]),"./i18n/pt-br.json":()=>se(()=>import("./pt-br.es-U9bVHsgs.js"),[]),"./i18n/pt-pt.json":()=>se(()=>import("./pt-pt.es-U9bVHsgs.js"),[]),"./i18n/ro.json":()=>se(()=>import("./ro.es-ldjMjt3l.js"),[]),"./i18n/ru.json":()=>se(()=>import("./ru.es-CS-QKsYL.js"),[]),"./i18n/sk.json":()=>se(()=>import("./sk.es-CAe8sEvL.js"),[]),"./i18n/sl.json":()=>se(()=>import("./sl.es-rdzOxu_X.js"),[]),"./i18n/sq.json":()=>se(()=>import("./sq.es-BY5E06HI.js"),[]),"./i18n/sr.json":()=>se(()=>import("./sr.es-QPseRVBy.js"),[]),"./i18n/sv.json":()=>se(()=>import("./sv.es-BfPUYcV1.js"),[]),"./i18n/tr.json":()=>se(()=>import("./tr.es-Cl6kz_IH.js"),[]),"./i18n/uk.json":()=>se(()=>import("./uk.es-DBEtNQnZ.js"),[]),"./i18n/vi.json":()=>se(()=>import("./vi.es-Bx2g_1jx.js"),[]),"./i18n/zh-cn.json":()=>se(()=>import("./zh-cn.es-BWMmCH-R.js"),[]),"./i18n/zh-hk.json":()=>se(()=>import("./zh-hk.es-DFZ0bKvi.js"),[])}),`./i18n/${l}.json`,3);this.texts=Object.assign({},Ye,t),this.utils.date.updateTexts(this.texts)},loadDragAndDrop(){se(()=>import("./drag-and-drop.es-CbCm7IHa.js"),[]).then(l=>{const{DragAndDrop:t}=l;this.modules.dnd=new t(this)}).catch(()=>console.warn("Vue Cal: Missing drag & drop module."))},validateView(l){return ht.includes(l)||(console.error(`Vue Cal: invalid active-view parameter provided: "${l}".
A valid view must be one of: ${ht.join(", ")}.`),l="week"),this.enabledViews.includes(l)||(console.warn(`Vue Cal: the provided active-view "${l}" is disabled. Using the "${this.enabledViews[0]}" view instead.`),l=this.enabledViews[0]),l},switchToNarrowerView(l=null){this.transitionDirection="right";const t=this.enabledViews[this.enabledViews.indexOf(this.view.id)+1];t&&this.switchView(t,l)},switchView(l,t=null,s=!1){l=this.validateView(l);const n=this.utils.date,i=this.view.startDate&&this.view.startDate.getTime();if(this.transitions&&s){if(this.view.id===l)return;const r=this.enabledViews;this.transitionDirection=r.indexOf(this.view.id)>r.indexOf(l)?"left":"right"}const a=this.view.id;switch(this.view.events=[],this.view.id=l,this.view.firstCellDate=null,this.view.lastCellDate=null,t||(t=this.view.selectedDate||this.view.startDate),l){case"years":{this.view.startDate=new Date(Math.floor(t.getFullYear()/25)*25||2e3,0,1),this.view.endDate=new Date(this.view.startDate.getFullYear()+25,0,1),this.view.endDate.setSeconds(-1);break}case"year":{this.view.startDate=new Date(t.getFullYear(),0,1),this.view.endDate=new Date(t.getFullYear()+1,0,1),this.view.endDate.setSeconds(-1);break}case"month":{this.view.startDate=new Date(t.getFullYear(),t.getMonth(),1),this.view.endDate=new Date(t.getFullYear(),t.getMonth()+1,1),this.view.endDate.setSeconds(-1);let r=new Date(this.view.startDate);if(r.getDay()!==(this.startWeekOnSunday?0:1)&&(r=n.getPreviousFirstDayOfWeek(r,this.startWeekOnSunday)),this.view.firstCellDate=r,this.view.lastCellDate=n.addDays(r,41),this.view.lastCellDate.setHours(23,59,59,0),this.hideWeekends){if([0,6].includes(this.view.firstCellDate.getDay())){const m=this.view.firstCellDate.getDay()===6&&!this.startWeekOnSunday?2:1;this.view.firstCellDate=n.addDays(this.view.firstCellDate,m)}if([0,6].includes(this.view.startDate.getDay())){const m=this.view.startDate.getDay()===6?2:1;this.view.startDate=n.addDays(this.view.startDate,m)}if([0,6].includes(this.view.lastCellDate.getDay())){const m=this.view.lastCellDate.getDay()===0&&!this.startWeekOnSunday?2:1;this.view.lastCellDate=n.subtractDays(this.view.lastCellDate,m)}if([0,6].includes(this.view.endDate.getDay())){const m=this.view.endDate.getDay()===0?2:1;this.view.endDate=n.subtractDays(this.view.endDate,m)}}break}case"week":{t=n.getPreviousFirstDayOfWeek(t,this.startWeekOnSunday);const r=this.hideWeekends?5:7;this.view.startDate=this.hideWeekends&&this.startWeekOnSunday?n.addDays(t,1):t,this.view.startDate.setHours(0,0,0,0),this.view.endDate=n.addDays(t,r),this.view.endDate.setSeconds(-1);break}case"day":{this.view.startDate=t,this.view.startDate.setHours(0,0,0,0),this.view.endDate=new Date(t),this.view.endDate.setHours(23,59,59,0);break}}this.addEventsToView();const u=this.view.startDate&&this.view.startDate.getTime();if(!(a===l&&u===i)&&(this.$emit("update:activeView",l),this.ready)){const r=this.view.startDate,m={view:l,startDate:r,endDate:this.view.endDate,...this.isMonthView?{firstCellDate:this.view.firstCellDate,lastCellDate:this.view.lastCellDate,outOfScopeEvents:this.view.outOfScopeEvents.map(this.cleanupEvent)}:{},events:this.view.events.map(this.cleanupEvent),...this.isWeekView?{week:n.getWeek(this.startWeekOnSunday?n.addDays(r,1):r)}:{}};this.$emit("view-change",m)}},previous(){this.previousNext(!1)},next(){this.previousNext()},previousNext(l=!0){const t=this.utils.date;this.transitionDirection=l?"right":"left";const s=l?1:-1;let n=null;const{startDate:i,id:a}=this.view;switch(a){case"years":n=new Date(i.getFullYear()+25*s,0,1);break;case"year":n=new Date(i.getFullYear()+1*s,1,1);break;case"month":n=new Date(i.getFullYear(),i.getMonth()+1*s,1);break;case"week":n=t[l?"addDays":"subtractDays"](t.getPreviousFirstDayOfWeek(i,this.startWeekOnSunday),7);break;case"day":n=t[l?"addDays":"subtractDays"](i,1);const u=n.getDay(),r=this.startWeekOnSunday?u:(u||7)-1;if(this.weekDays[r].hide){const c=this.weekDays.map((g,w)=>({...g,i:w}));let v=0;l?([...c.slice(r),...c].find(g=>(v++,!g.hide)).i,v--):[...c,...c.slice(0,r)].reverse().find(g=>(v++,!g.hide)).i,n=t[l?"addDays":"subtractDays"](n,v)}break}n&&this.switchView(a,n)},addEventsToView(l=[]){const t=this.utils.event,{startDate:s,endDate:n,firstCellDate:i,lastCellDate:a}=this.view;if(l.length||(this.view.events=[]),l=l.length?l:[...this.mutableEvents],!l||this.isYearsOrYearView&&!this.eventsCountOnYearView)return;let u=l.filter(r=>t.eventInRange(r,s,n));!this.isYearsOrYearView&&!(this.isMonthView&&!this.eventsOnMonthView)&&(u=u.map(r=>r.daysCount>1?t.createEventSegments(r,i||s,a||n):r)),this.view.events.push(...u),this.isMonthView&&(this.view.outOfScopeEvents=[],l.forEach(r=>{(t.eventInRange(r,i,s)||t.eventInRange(r,n,a))&&(this.view.events.some(m=>m._eid===r._eid)||this.view.outOfScopeEvents.push(r))}))},findAncestor(l,t){for(;(l=l.parentElement)&&!l.classList.contains(t););return l},isDOMElementAnEvent(l){return l.classList.contains("vuecal__event")||this.findAncestor(l,"vuecal__event")},onMouseMove(l){const{resizeAnEvent:t,dragAnEvent:s,dragCreateAnEvent:n}=this.domEvents;t._eid===null&&s._eid===null&&!n.start||(l.preventDefault(),t._eid?this.eventResizing(l):this.dragToCreateEvent&&n.start&&this.eventDragCreation(l))},onMouseUp(l){const{focusAnEvent:t,resizeAnEvent:s,clickHoldAnEvent:n,clickHoldACell:i,dragCreateAnEvent:a}=this.domEvents,{_eid:u}=n,{_eid:r}=s;let m=!1;const{event:c,start:v}=a,g=this.isDOMElementAnEvent(l.target),w=t.mousedUp;if(t.mousedUp=!1,g&&(this.domEvents.cancelClickEventCreation=!0),i.eventCreated)return;if(r){const{originalEnd:D,originalEndTimeMinutes:$,endTimeMinutes:y}=s,f=this.view.events.find(M=>M._eid===s._eid);if(m=y&&y!==$,f&&f.end.getTime()!==D.getTime()){const M=this.mutableEvents.find(U=>U._eid===s._eid);M.endTimeMinutes=f.endTimeMinutes,M.end=f.end;const V=this.cleanupEvent(f),P={...this.cleanupEvent(f),end:D,endTimeMinutes:f.originalEndTimeMinutes};this.$emit("event-duration-change",{event:V,oldDate:s.originalEnd,originalEvent:P}),this.$emit("event-change",{event:V,originalEvent:P})}f&&(f.resizing=!1),s._eid=null,s.start=null,s.split=null,s.segment=null,s.originalEndTimeMinutes=null,s.originalEnd=null,s.endTimeMinutes=null,s.startCell=null,s.endCell=null}else v&&(c&&(this.emitWithEvent("event-drag-create",c),a.event.resizing=!1),a.start=null,a.split=null,a.event=null);!g&&!r&&this.unfocusEvent(),n.timeoutId&&!u&&(clearTimeout(n.timeoutId),n.timeoutId=null),i.timeoutId&&(clearTimeout(i.timeoutId),i.timeoutId=null);const C=typeof this.onEventClick=="function";if(w&&!m&&!u&&!c&&C){let D=this.view.events.find($=>$._eid===t._eid);return!D&&this.isMonthView&&(D=this.view.outOfScopeEvents.find($=>$._eid===t._eid)),D&&this.onEventClick(D,l)}},onKeyUp(l){l.keyCode===27&&this.cancelDelete()},eventResizing(l){const{resizeAnEvent:t}=this.domEvents,s=this.view.events.find(c=>c._eid===t._eid)||{segments:{}},{minutes:n,cursorCoords:i}=this.minutesAtCursor(l),a=s.segments&&s.segments[t.segment],{date:u,event:r}=this.utils,m=Math.max(n,this.timeFrom+1,(a||s).startTimeMinutes+1);if(s.endTimeMinutes=t.endTimeMinutes=m,this.snapToTime){const c=s.endTimeMinutes+this.snapToTime/2;s.endTimeMinutes=c-c%this.snapToTime}if(a&&(a.endTimeMinutes=s.endTimeMinutes),s.end.setHours(0,s.endTimeMinutes,s.endTimeMinutes===Be?-1:0,0),this.resizeX&&this.isWeekView){s.daysCount=u.countDays(s.start,s.end);const c=this.cellsEl,v=c.offsetWidth/c.childElementCount,g=Math.floor(i.x/v);if(t.startCell===null&&(t.startCell=g-(s.daysCount-1)),t.endCell!==g){t.endCell=g;const w=u.addDays(s.start,g-t.startCell),C=Math.max(u.countDays(s.start,w),1);if(C!==s.daysCount){let D=null;C>s.daysCount?D=r.addEventSegment(s):D=r.removeEventSegment(s),t.segment=D,s.endTimeMinutes+=.001}}}this.$emit("event-resizing",{_eid:s._eid,end:s.end,endTimeMinutes:s.endTimeMinutes})},eventDragCreation(l){const{dragCreateAnEvent:t}=this.domEvents,{start:s,startCursorY:n,split:i}=t,a=new Date(s),{minutes:u,cursorCoords:{y:r}}=this.minutesAtCursor(l);if(!(!t.event&&Math.abs(n-r)<this.dragToCreateThreshold))if(t.event){if(a.setHours(0,u,u===Be?-1:0,0),this.snapToTime){let v=a.getHours()*60+a.getMinutes();const g=v+this.snapToTime/2;v=g-g%this.snapToTime,a.setHours(0,v,0,0)}const m=s<a,{event:c}=t;c.start=m?s:a,c.end=m?a:s,c.startTimeMinutes=c.start.getHours()*60+c.start.getMinutes(),c.endTimeMinutes=c.end.getHours()*60+c.end.getMinutes()}else{if(t.event=this.utils.event.createAnEvent(s,1,{split:i}),!t.event){t.start=null,t.split=null,t.event=null;return}t.event.resizing=!0}},unfocusEvent(){const{focusAnEvent:l,clickHoldAnEvent:t}=this.domEvents,s=this.view.events.find(n=>n._eid===(l._eid||t._eid));l._eid=null,t._eid=null,s&&(s.focused=!1,s.deleting=!1)},cancelDelete(){const{clickHoldAnEvent:l}=this.domEvents;if(l._eid){const t=this.view.events.find(s=>s._eid===l._eid);t&&(t.deleting=!1),l._eid=null,l.timeoutId=null}},onEventTitleBlur(l,t){if(t.title===l.target.innerHTML)return;const s=t.title;t.title=l.target.innerHTML;const n=this.cleanupEvent(t);this.$emit("event-title-change",{event:n,oldTitle:s}),this.$emit("event-change",{event:n,originalEvent:{...n,title:s}})},updateMutableEvents(){const l=this.utils.date;this.mutableEvents=[],this.events.forEach(t=>{const s=typeof t.start=="string"?l.stringToDate(t.start):t.start,n=l.formatDateLite(s),i=l.dateToMinutes(s);let a=null;typeof t.end=="string"&&t.end.includes("24:00")?(a=new Date(t.end.replace(" 24:00","")),a.setHours(23,59,59,0)):a=typeof t.end=="string"?l.stringToDate(t.end):t.end;let u=l.formatDateLite(a),r=l.dateToMinutes(a);(!r||r===Be)&&(!this.time||typeof t.end=="string"&&t.end.length===10?a.setHours(23,59,59,0):a.setSeconds(a.getSeconds()-1),u=l.formatDateLite(a),r=Be);const m=n!==u;t=Object.assign({...this.utils.event.eventDefaults},t,{_eid:`${this._.uid}_${this.eventIdIncrement++}`,segments:m?{}:null,start:s,startTimeMinutes:i,end:a,endTimeMinutes:r,daysCount:m?l.countDays(s,a):1,class:t.class}),this.mutableEvents.push(t)})},minutesAtCursor(l){return this.utils.cell.minutesAtCursor(l)},createEvent(l,t,s={}){return this.utils.event.createAnEvent(l,t,s)},cleanupEvent(l){return l={...l},["segments","deletable","deleting","titleEditable","resizable","resizing","draggable","dragging","draggingStatic","focused"].forEach(s=>{s in l&&delete l[s]}),l.repeat||delete l.repeat,l},emitWithEvent(l,t){this.$emit(l,this.cleanupEvent(t))},updateSelectedDate(l){if(l&&typeof l=="string"?l=this.utils.date.stringToDate(l):l=new Date(l),l&&l instanceof Date){const{selectedDate:t}=this.view;t&&(this.transitionDirection=t.getTime()>l.getTime()?"left":"right"),l.setHours(0,0,0,0),(!t||t.getTime()!==l.getTime())&&(this.view.selectedDate=l),this.switchView(this.view.id)}this.$emit("update:selected-date",this.view.selectedDate)},getWeekNumber(l){const t=this.utils.date,n=this.firstCellDateWeekNumber+l,i=this.startWeekOnSunday?1:0;return n>52?t.getWeek(t.addDays(this.view.firstCellDate,7*l+i)):n},timeTick(){this.now=new Date,this.timeTickerIds[1]=setTimeout(this.timeTick,60*1e3)},updateDateTexts(){this.utils.date.updateTexts(this.texts)},alignWithScrollbar(){if(document.getElementById("vuecal-align-with-scrollbar"))return;const l=this.$refs.vuecal.getElementsByClassName("vuecal__scrollbar-check")[0],t=l.offsetWidth-l.children[0].offsetWidth;if(t){const s=document.createElement("style");s.id="vuecal-align-with-scrollbar",s.type="text/css",s.innerHTML=`.vuecal--view-with-time .vuecal__weekdays-headings,.vuecal--view-with-time .vuecal__all-day {padding-right: ${t}px}`,document.head.appendChild(s)}},cellOrSplitHasEvents(l,t=null){return l.length&&(!t&&l.length||t&&l.some(s=>s.split===t.id))}},created(){this.utils.cell=new Ms(this),this.utils.event=new js(this,this.utils.date),this.loadLocale(this.locale),this.editEvents.drag&&this.loadDragAndDrop(),this.updateMutableEvents(this.events),this.view.id=this.currentView,this.selectedDate?this.updateSelectedDate(this.selectedDate):(this.view.selectedDate=new Date,this.switchView(this.currentView)),this.time&&this.watchRealTime&&(this.timeTickerIds[0]=setTimeout(this.timeTick,(60-this.now.getSeconds())*1e3))},mounted(){const l=this.utils.date,t="ontouchstart"in window,{resize:s,drag:n,create:i,delete:a,title:u}=this.editEvents,r=this.onEventClick&&typeof this.onEventClick=="function";(s||n||i||a||u||r)&&window.addEventListener(t?"touchend":"mouseup",this.onMouseUp),(s||n||i&&this.dragToCreateEvent)&&window.addEventListener(t?"touchmove":"mousemove",this.onMouseMove,{passive:!1}),u&&window.addEventListener("keyup",this.onKeyUp),t&&(this.$refs.vuecal.oncontextmenu=function(v){v.preventDefault(),v.stopPropagation()}),this.hideBody||this.alignWithScrollbar();const m=this.view.startDate,c={view:this.view.id,startDate:m,endDate:this.view.endDate,...this.isMonthView?{firstCellDate:this.view.firstCellDate,lastCellDate:this.view.lastCellDate}:{},events:this.view.events.map(this.cleanupEvent),...this.isWeekView?{week:l.getWeek(this.startWeekOnSunday?l.addDays(m,1):m)}:{}};this.$emit("ready",c),this.ready=!0},beforeUnmount(){const l="ontouchstart"in window;window.removeEventListener(l?"touchmove":"mousemove",this.onMouseMove,{passive:!1}),window.removeEventListener(l?"touchend":"mouseup",this.onMouseUp),window.removeEventListener("keyup",this.onKeyUp),this.timeTickerIds[0]&&clearTimeout(this.timeTickerIds[0]),this.timeTickerIds[1]&&clearTimeout(this.timeTickerIds[1]),this.timeTickerIds=[null,null]},computed:{editEvents(){return this.editableEvents&&typeof this.editableEvents=="object"?{title:!!this.editableEvents.title,drag:!!this.editableEvents.drag,resize:!!this.editableEvents.resize,create:!!this.editableEvents.create,delete:!!this.editableEvents.delete}:{title:!!this.editableEvents,drag:!!this.editableEvents,resize:!!this.editableEvents,create:!!this.editableEvents,delete:!!this.editableEvents}},views(){return{years:{label:this.texts.years,enabled:!this.disableViews.includes("years")},year:{label:this.texts.year,enabled:!this.disableViews.includes("year")},month:{label:this.texts.month,enabled:!this.disableViews.includes("month")},week:{label:this.texts.week,enabled:!this.disableViews.includes("week")},day:{label:this.texts.day,enabled:!this.disableViews.includes("day")}}},currentView(){return this.validateView(this.activeView)},enabledViews(){return Object.keys(this.views).filter(l=>this.views[l].enabled)},hasTimeColumn(){return this.time&&this.isWeekOrDayView},isShortMonthView(){return this.isMonthView&&this.eventsOnMonthView==="short"},firstCellDateWeekNumber(){const l=this.utils.date,t=this.view.firstCellDate;return l.getWeek(this.startWeekOnSunday?l.addDays(t,1):t)},timeCells(){const l=[];for(let t=this.timeFrom,s=this.timeTo;t<s;t+=this.timeStep)l.push({hours:Math.floor(t/60),minutes:t%60,label:this.utils.date.formatTime(t,this.TimeFormat),value:t});return l},TimeFormat(){return this.timeFormat||(this.twelveHour?"h:mm{am}":"HH:mm")},daySplits(){return(this.splitDays.filter(l=>!l.hide)||[]).map((l,t)=>({...l,id:l.id||t+1}))},hasSplits(){return this.daySplits.length&&this.isWeekOrDayView},hasShortEvents(){return this.showAllDayEvents==="short"},cellOrSplitMinWidth(){let l=null;return this.hasSplits&&this.minSplitWidth?l=this.visibleDaysCount*this.minSplitWidth*this.daySplits.length:this.minCellWidth&&this.isWeekView&&(l=this.visibleDaysCount*this.minCellWidth),l},allDayBar(){let l=this.allDayBarHeight||null;return l&&!isNaN(l)&&(l+="px"),{cells:this.viewCells,options:this.$props,label:this.texts.allDay,shortEvents:this.hasShortEvents,daySplits:this.hasSplits&&this.daySplits||[],cellOrSplitMinWidth:this.cellOrSplitMinWidth,height:l}},minTimestamp(){let l=null;return this.minDate&&typeof this.minDate=="string"?l=this.utils.date.stringToDate(this.minDate):this.minDate&&this.minDate instanceof Date&&(l=this.minDate),l?l.getTime():null},maxTimestamp(){let l=null;return this.maxDate&&typeof this.maxDate=="string"?l=this.utils.date.stringToDate(this.maxDate):this.maxDate&&this.maxDate instanceof Date&&(l=this.maxDate),l?l.getTime():null},weekDays(){let{weekDays:l,weekDaysShort:t=[]}=this.texts;return l=l.slice(0).map((s,n)=>({label:s,...t.length?{short:t[n]}:{},hide:this.hideWeekends&&n>=5||this.hideWeekdays.length&&this.hideWeekdays.includes(n+1)})),this.startWeekOnSunday&&l.unshift(l.pop()),l},weekDaysInHeader(){return this.isMonthView||this.isWeekView&&!this.minCellWidth&&!(this.hasSplits&&this.minSplitWidth)},months(){return this.texts.months.map(l=>({label:l}))},specialDayHours(){return!this.specialHours||!Object.keys(this.specialHours).length?{}:Array(7).fill("").map((l,t)=>{let s=this.specialHours[t+1]||[];return Array.isArray(s)||(s=[s]),l=[],s.forEach(({from:n,to:i,class:a,label:u},r)=>{l[r]={day:t+1,from:[null,void 0].includes(n)?null:n*1,to:[null,void 0].includes(i)?null:i*1,class:a||"",label:u||""}}),l})},viewTitle(){const l=this.utils.date;let t="";const s=this.view.startDate,n=s.getFullYear(),i=s.getMonth();switch(this.view.id){case"years":{t=this.texts.years;break}case"year":{t=n;break}case"month":{t=`${this.months[i].label} ${n}`;break}case"week":{const a=this.view.endDate,u=s.getFullYear();let r=this.texts.months[s.getMonth()];this.xsmall&&(r=r.substring(0,3));let m=`${r} ${u}`;if(a.getMonth()!==s.getMonth()){const c=a.getFullYear();let v=this.texts.months[a.getMonth()];this.xsmall&&(v=v.substring(0,3)),u===c?m=`${r} - ${v} ${u}`:this.small?m=`${r.substring(0,3)} ${u} - ${v.substring(0,3)} ${c}`:m=`${r} ${u} - ${v} ${c}`}t=`${this.texts.week} ${l.getWeek(this.startWeekOnSunday?l.addDays(s,1):s)} (${m})`;break}case"day":{t=this.utils.date.formatDate(s,this.texts.dateFormat,this.texts);break}}return t},viewCells(){const l=this.utils.date;let t=[],s=null,n=!1;this.watchRealTime||(this.now=new Date);const i=this.now;switch(this.view.id){case"years":{s=this.view.startDate.getFullYear(),t=Array.apply(null,Array(25)).map((a,u)=>{const r=new Date(s+u,0,1),m=new Date(s+u+1,0,1);return m.setSeconds(-1),{startDate:r,formattedDate:l.formatDateLite(r),endDate:m,content:s+u,current:s+u===i.getFullYear()}});break}case"year":{s=this.view.startDate.getFullYear(),t=Array.apply(null,Array(12)).map((a,u)=>{const r=new Date(s,u,1),m=new Date(s,u+1,1);return m.setSeconds(-1),{startDate:r,formattedDate:l.formatDateLite(r),endDate:m,content:this.xsmall?this.months[u].label.substr(0,3):this.months[u].label,current:u===i.getMonth()&&s===i.getFullYear()}});break}case"month":{const a=this.view.startDate.getMonth(),u=new Date(this.view.firstCellDate);n=!1,t=Array.apply(null,Array(42)).map((r,m)=>{const c=l.addDays(u,m),v=new Date(c);v.setHours(23,59,59,0);const g=!n&&l.isToday(c)&&!n++;return{startDate:c,formattedDate:l.formatDateLite(c),endDate:v,content:c.getDate(),today:g,outOfScope:c.getMonth()!==a,class:`vuecal__cell--day${c.getDay()||7}`}}),(this.hideWeekends||this.hideWeekdays.length)&&(t=t.filter(r=>{const m=r.startDate.getDay()||7;return!(this.hideWeekends&&m>=6||this.hideWeekdays.length&&this.hideWeekdays.includes(m))}));break}case"week":{n=!1;const a=this.view.startDate,u=this.weekDays;t=u.map((r,m)=>{const c=l.addDays(a,this.startWeekOnSunday&&this.hideWeekends?m-1:m),v=new Date(c);v.setHours(23,59,59,0);const g=(c.getDay()||7)-1;return{startDate:c,formattedDate:l.formatDateLite(c),endDate:v,today:!n&&l.isToday(c)&&!n++,specialHours:this.specialDayHours[g]||[]}}).filter((r,m)=>!u[m].hide);break}case"day":{const a=this.view.startDate,u=new Date(this.view.startDate);u.setHours(23,59,59,0);const r=(a.getDay()||7)-1;t=[{startDate:a,formattedDate:l.formatDateLite(a),endDate:u,today:l.isToday(a),specialHours:this.specialDayHours[r]||[]}];break}}return t},visibleDaysCount(){return this.isDayView?1:7-this.weekDays.reduce((l,t)=>l+t.hide,0)},cellWidth(){return 100/this.visibleDaysCount},cssClasses(){const{resizeAnEvent:l,dragAnEvent:t,dragCreateAnEvent:s}=this.domEvents;return{[`vuecal--${this.view.id}-view`]:!0,[`vuecal--${this.locale}`]:this.locale,"vuecal--no-time":!this.time,"vuecal--view-with-time":this.hasTimeColumn,"vuecal--week-numbers":this.showWeekNumbers&&this.isMonthView,"vuecal--twelve-hour":this.twelveHour,"vuecal--click-to-navigate":this.clickToNavigate,"vuecal--hide-weekends":this.hideWeekends,"vuecal--split-days":this.hasSplits,"vuecal--sticky-split-labels":this.hasSplits&&this.stickySplitLabels,"vuecal--overflow-x":this.minCellWidth&&this.isWeekView||this.hasSplits&&this.minSplitWidth,"vuecal--small":this.small,"vuecal--xsmall":this.xsmall,"vuecal--resizing-event":l._eid,"vuecal--drag-creating-event":s.event,"vuecal--dragging-event":t._eid,"vuecal--events-on-month-view":this.eventsOnMonthView,"vuecal--short-events":this.isMonthView&&this.eventsOnMonthView==="short","vuecal--has-touch":typeof window<"u"&&"ontouchstart"in window}},isYearsOrYearView(){return["years","year"].includes(this.view.id)},isYearsView(){return this.view.id==="years"},isYearView(){return this.view.id==="year"},isMonthView(){return this.view.id==="month"},isWeekOrDayView(){return["week","day"].includes(this.view.id)},isWeekView(){return this.view.id==="week"},isDayView(){return this.view.id==="day"}},watch:{events:{handler(l,t){this.updateMutableEvents(l),this.addEventsToView()},deep:!0},locale(l){this.loadLocale(l)},selectedDate(l){this.updateSelectedDate(l)},activeView(l){this.switchView(l)}}},Bl=Ne(Fl,[["render",Rl]]),Hl={class:"bg-white p-6 rounded-xl shadow-md hover:shadow-lg transition-shadow"},Wl={class:"flex justify-between items-center mb-4"},Yl={class:"flex gap-3"},zl={class:"flex rounded-md shadow-sm mr-3"},ql={key:0,class:"mb-4 bg-gray-50 p-4 rounded-lg"},Gl={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},Kl=["value"],Jl={class:"mt-1 relative rounded-md shadow-sm"},Zl={key:1,class:"text-center text-gray-600 text-sm animate-pulse py-4"},Xl={key:2,class:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-md"},Ql={key:3},ea={key:0,class:"space-y-4"},ta={key:0,class:"flex justify-between"},sa={class:"flex-grow"},la={class:"text-sm text-red-500 italic"},aa={class:"flex items-center mt-1"},ia={class:"text-xs text-gray-500"},na={key:1},oa={class:"flex-grow"},ra={class:"flex justify-between items-center mb-3"},da={class:"text-sm text-gray-600 bg-blue-100 px-2 py-1 rounded-full"},ua={class:"mb-3"},ca={class:"text-sm text-gray-700 ml-6"},ma={class:"mb-3"},va={class:"text-sm text-gray-700 ml-6"},pa={class:"mb-2"},ha={class:"text-sm text-gray-700 ml-6"},ga={class:"flex items-center mt-3 pt-2 border-t border-blue-200"},ya={class:"text-xs text-gray-500"},fa={key:1,class:"text-gray-400 text-sm"},ba={key:4,class:"mt-4"},_a={class:"flex justify-between items-center mb-6"},wa={class:"text-lg font-medium text-gray-900"},xa=["innerHTML"],ka=["innerHTML"],Da={key:0,class:"mt-1 text-xs p-1 rounded bg-red-50 border-l-2 border-red-500 text-red-700"},Ca={class:"mt-6 bg-white rounded-lg shadow p-4"},Ea={key:0},$a={class:"font-medium text-gray-800 mb-2"},Sa={class:"font-medium text-blue-800"},Ma={class:"text-sm text-gray-600 mt-1"},Ta={key:1,class:"text-gray-500 text-sm"},ja={__name:"DailyStandups",props:{projectId:{type:Number,required:!0},users:{type:Array,default:()=>[]}},emits:["standupAdded"],setup(l,{emit:t}){const s=l,n=k("list"),i=k(!1),a=k(!1),u=k(""),r=k([]),m=k(""),c=ke({startDate:"",endDate:"",search:"",userId:""}),v=_=>{const x=ce(_);return x.isValid()?{start:x.clone().startOf("month").format("YYYY-MM-DD"),end:x.clone().endOf("month").format("YYYY-MM-DD")}:(console.warn("getMonthRange received an invalid input, defaulting to current date:",_),{start:ce().startOf("month").format("YYYY-MM-DD"),end:ce().endOf("month").format("YYYY-MM-DD")})};let g=null;const w=()=>{clearTimeout(g),g=setTimeout(()=>{D()},500)},C=async()=>{a.value=!0,u.value="";try{const _=new URLSearchParams;c.startDate&&_.append("start_date",c.startDate),c.endDate&&_.append("end_date",c.endDate),c.search&&_.append("search",c.search),c.userId&&_.append("user_id",String(c.userId));const x=_.toString(),j=`/api/projects/${s.projectId}/sections/notes?type=standup${x?`&${x}`:""}`,Z=await window.axios.get(j);r.value=Z.data.filter(ie=>ie.type==="standup")}catch(_){console.error("Error fetching project standups:",_),u.value="Failed to load standups. Please try again."}finally{a.value=!1}},D=()=>{C()},$=()=>{c.search="",c.userId="",c.startDate="",c.endDate="",C()},y=()=>{m.value=ce(m.value).subtract(1,"month").format("YYYY-MM-DD")},f=()=>{m.value=ce(m.value).add(1,"month").format("YYYY-MM-DD")};de(()=>m.value,_=>{if(n.value==="calendar"&&_){const x=v(_);c.startDate=x.start,c.endDate=x.end,C()}}),de(()=>n.value,_=>{_==="calendar"?(c.search="",c.userId="",m.value=v(new Date).start):(c.startDate="",c.endDate="",C())});const M=R(()=>(r.value||[]).map(_=>{var Z;if(!(_!=null&&_.created_at))return null;const x=ce(_.created_at);if(!x.isValid())return null;const j=I(_.content);return{start:x.format("YYYY-MM-DD HH:mm"),end:x.format("YYYY-MM-DD HH:mm"),title:`${((Z=_.user)==null?void 0:Z.name)||"Unknown"} - Standup`,content:`Yesterday: ${j.yesterday}
Today: ${j.today}
Blockers: ${j.blockers}`,class:"standup-event",standupData:_}}).filter(Boolean));fe(()=>{C()});const V=R(()=>{if(!r.value)return[];let _=[...r.value];if(c.startDate&&(_=_.filter(x=>x.created_at&&ce(x.created_at).isSameOrAfter(c.startDate,"day"))),c.endDate&&(_=_.filter(x=>x.created_at&&ce(x.created_at).isSameOrBefore(c.endDate,"day"))),c.userId&&(_=_.filter(x=>x.user_id===parseInt(c.userId))),c.search){const x=c.search.toLowerCase();_=_.filter(j=>j.content&&j.content!=="[Encrypted content could not be decrypted]"&&j.content.toLowerCase().includes(x))}return _.sort((x,j)=>ce(j.created_at).valueOf()-ce(x.created_at).valueOf())}),P=_=>{const x=ce(_).day();return x>=1&&x<=5},U=_=>ce(_).isBefore(ce(),"day"),T=(_,x)=>ce(_).isSame(x,"day"),I=_=>{var B,A,S,O;if(!_||typeof _!="string"||_==="[Encrypted content could not be decrypted]"||_.trim()==="")return{yesterday:"N/A",today:"N/A",blockers:"N/A",date:"N/A"};const x=((B=_.match(/\*\*Yesterday:\*\* ([^\n]+)/))==null?void 0:B[1].trim())||"Nothing",j=((A=_.match(/\*\*Today:\*\* ([^\n]+)/))==null?void 0:A[1].trim())||"Nothing",Z=((S=_.match(/\*\*Blockers:\*\* ([^\n]+)/))==null?void 0:S[1].trim())||"None",ie=((O=_.match(/\*\*Daily Standup - ([^*]+)\*\*/))==null?void 0:O[1].trim())||ce().format("L");return{yesterday:x,today:j,blockers:Z,date:ie}},b=R(()=>{const _={};return(r.value||[]).forEach(x=>{if(!(x!=null&&x.created_at))return;const j=ce(x.created_at).format("YYYY-MM-DD");_[j]||(_[j]=[]),_[j].push(x)}),_});return(_,x)=>(o(),d("div",Hl,[e("div",Wl,[x[11]||(x[11]=e("h4",{class:"text-lg font-semibold text-gray-900"},"Daily Standups",-1)),e("div",Yl,[e("div",zl,[e("button",{type:"button",onClick:x[0]||(x[0]=j=>n.value="list"),class:ee([n.value==="list"?"bg-indigo-100 text-indigo-700":"bg-white text-gray-700 hover:text-gray-500","px-4 py-2 text-sm font-medium rounded-l-md border border-gray-300 focus:z-10 focus:outline-none focus:ring-1 focus:ring-indigo-500"])},x[8]||(x[8]=[e("span",{class:"flex items-center"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 6h16M4 10h16M4 14h16M4 18h16"})]),H(" List ")],-1)]),2),e("button",{type:"button",onClick:x[1]||(x[1]=j=>n.value="calendar"),class:ee([n.value==="calendar"?"bg-indigo-100 text-indigo-700":"bg-white text-gray-700 hover:text-gray-500","px-4 py-2 text-sm font-medium rounded-r-md border border-gray-300 focus:z-10 focus:outline-none focus:ring-1 focus:ring-indigo-500"])},x[9]||(x[9]=[e("span",{class:"flex items-center"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})]),H(" Calendar ")],-1)]),2)]),p(ue,{class:"bg-blue-600 hover:bg-blue-700 transition-colors",onClick:x[2]||(x[2]=j=>i.value=!0)},{default:N(()=>x[10]||(x[10]=[H(" Submit Standup ",-1)])),_:1,__:[10]})])]),n.value==="list"?(o(),d("div",ql,[e("div",Gl,[e("div",null,[x[12]||(x[12]=e("label",{for:"standupStartDate",class:"block text-sm font-medium text-gray-700 mb-1"},"From Date",-1)),me(e("input",{type:"date",id:"standupStartDate","onUpdate:modelValue":x[3]||(x[3]=j=>c.startDate=j),class:"mt-1 block w-full border-gray-300 focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md",onChange:D},null,544),[[be,c.startDate]])]),e("div",null,[x[13]||(x[13]=e("label",{for:"standupEndDate",class:"block text-sm font-medium text-gray-700 mb-1"},"To Date",-1)),me(e("input",{type:"date",id:"standupEndDate","onUpdate:modelValue":x[4]||(x[4]=j=>c.endDate=j),class:"mt-1 block w-full border-gray-300 focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md",onChange:D},null,544),[[be,c.endDate]])]),e("div",null,[x[15]||(x[15]=e("label",{for:"standupUserFilter",class:"block text-sm font-medium text-gray-700 mb-1"},"User",-1)),me(e("select",{id:"standupUserFilter","onUpdate:modelValue":x[5]||(x[5]=j=>c.userId=j),class:"mt-1 block w-full border-gray-300 focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md",onChange:D},[x[14]||(x[14]=e("option",{value:""},"All Users",-1)),(o(!0),d(J,null,Q(s.users,j=>(o(),d("option",{key:j.id,value:j.id},h(j.name),9,Kl))),128))],544),[[We,c.userId]])]),e("div",null,[x[17]||(x[17]=e("label",{for:"standupSearchFilter",class:"block text-sm font-medium text-gray-700 mb-1"},"Search Content",-1)),e("div",Jl,[me(e("input",{type:"text",id:"standupSearchFilter","onUpdate:modelValue":x[6]||(x[6]=j=>c.search=j),class:"focus:ring-indigo-500 focus:border-indigo-500 block w-full pr-10 sm:text-sm border-gray-300 rounded-md",placeholder:"Search in standup content...",onInput:w},null,544),[[be,c.search]]),x[16]||(x[16]=e("div",{class:"absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none"},[e("svg",{class:"h-5 w-5 text-gray-400",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},[e("path",{"fill-rule":"evenodd",d:"M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z","clip-rule":"evenodd"})])],-1))])])]),e("div",{class:"mt-3 flex justify-end"},[e("button",{type:"button",class:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",onClick:$}," Reset Filters ")])])):E("",!0),a.value?(o(),d("div",Zl,"Loading standups...")):u.value?(o(),d("div",Xl,h(u.value),1)):n.value==="list"?(o(),d("div",Ql,[V.value.length?(o(),d("div",ea,[(o(!0),d(J,null,Q(V.value,j=>{var Z,ie;return o(),d("div",{key:j.id,class:"p-4 bg-blue-50 rounded-md shadow-sm hover:bg-blue-100 transition-colors border-l-4 border-blue-500"},[j.content==="[Encrypted content could not be decrypted]"?(o(),d("div",ta,[e("div",sa,[e("p",la,[H(h(j.content),1),x[18]||(x[18]=e("span",{class:"text-xs text-red-400 block mt-1"},"(There was an issue decrypting this standup. Please contact an administrator.)",-1))]),e("div",aa,[e("p",ia,"Submitted by "+h(((Z=j.user)==null?void 0:Z.name)||"Unknown")+" on "+h(K(ce)(j.created_at).format("L")),1)])])])):(o(),d("div",na,[e("div",oa,[e("div",ra,[x[19]||(x[19]=e("h3",{class:"text-md font-bold text-gray-800"},"Daily Standup",-1)),e("span",da,h(I(j.content).date),1)]),e("div",ua,[x[20]||(x[20]=e("div",{class:"flex items-center mb-1"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 text-blue-600 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})]),e("span",{class:"font-semibold text-sm text-gray-700"},"Yesterday:")],-1)),e("p",ca,h(I(j.content).yesterday),1)]),e("div",ma,[x[21]||(x[21]=e("div",{class:"flex items-center mb-1"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 text-green-600 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})]),e("span",{class:"font-semibold text-sm text-gray-700"},"Today:")],-1)),e("p",va,h(I(j.content).today),1)]),e("div",pa,[x[22]||(x[22]=e("div",{class:"flex items-center mb-1"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 text-red-600 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})]),e("span",{class:"font-semibold text-sm text-gray-700"},"Blockers:")],-1)),e("p",ha,h(I(j.content).blockers),1)]),e("div",ga,[e("p",ya,"Submitted by "+h(((ie=j.user)==null?void 0:ie.name)||"Unknown")+" on "+h(K(ce)(j.created_at).format("L")),1)])])]))])}),128))])):(o(),d("p",fa,"No daily standups found for the selected criteria."))])):n.value==="calendar"?(o(),d("div",ba,[e("div",_a,[e("button",{onClick:y,class:"p-2 rounded-full bg-gray-100 hover:bg-gray-200 transition-colors"},x[23]||(x[23]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])),e("h3",wa,h(m.value?K(ce)(m.value).format("MMMM YYYY"):"Loading..."),1),e("button",{onClick:f,class:"p-2 rounded-full bg-gray-100 hover:bg-gray-200 transition-colors"},x[24]||(x[24]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)]))]),p(K(Bl),{class:"vuecal--blue-theme","active-view":"month",events:M.value,"selected-date":m.value,"hide-title-bar":"","disable-views":["week","day","years","year"],twelveHour:!0,"time-from":480,"time-to":1200,"time-step":30,"events-on-month-view":"short"},{event:N(({event:j})=>[e("div",{class:"vuecal__event-title",innerHTML:j.title},null,8,xa),e("div",{class:"vuecal__event-content",innerHTML:j.content},null,8,ka)]),"cell-content":N(({view:j,date:Z})=>[j.id==="month"?(o(),d(J,{key:0},[Z&&P(Z)&&U(Z)&&!M.value.some(ie=>T(ie.start,Z))?(o(),d("div",Da," No standups ")):E("",!0)],64)):E("",!0)]),_:1},8,["events","selected-date"]),x[26]||(x[26]=es('<div class="mt-4 flex items-center space-x-4 text-sm"><div class="flex items-center"><span class="inline-block w-3 h-3 bg-blue-50 border-l-2 border-blue-500 mr-1"></span><span>Standup submitted</span></div><div class="flex items-center"><span class="inline-block w-3 h-3 bg-red-50 border-l-2 border-red-500 mr-1"></span><span>Missing standup</span></div></div>',1)),e("div",Ca,[x[25]||(x[25]=e("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"Standups Outside Current Month View",-1)),Object.entries(b.value).some(([j])=>!K(ce)(j).isSame(m.value,"month"))?(o(),d("div",Ea,[(o(!0),d(J,null,Q(Object.entries(b.value).filter(([j])=>!K(ce)(j).isSame(m.value,"month")).sort((j,Z)=>K(ce)(j[0]).valueOf()-K(ce)(Z[0]).valueOf()),([j,Z])=>(o(),d("div",{key:j,class:"mb-4"},[e("div",$a,h(K(ce)(j).format("dddd, MMMM Do YYYY")),1),(o(!0),d(J,null,Q(Z,ie=>{var B;return o(),d("div",{key:ie.id,class:"p-2 mb-2 rounded bg-blue-50 border-l-2 border-blue-500"},[e("div",Sa,h(((B=ie.user)==null?void 0:B.name)||"Unknown"),1),e("div",Ma,h(K(ce)(ie.created_at).format("LT")),1)])}),128))]))),128))])):(o(),d("div",Ta,"No standups outside the current month view."))])])):E("",!0),p(yt,{show:i.value,onClose:x[7]||(x[7]=j=>i.value=!1),onStandupAdded:C,projectId:l.projectId},null,8,["show","projectId"])]))}},Va={class:"relative"},Aa={key:0,class:"text-gray-400 text-sm"},Ia=["onClick"],Oa=["placeholder"],La={key:0,class:"absolute z-50 w-full bg-white border border-gray-300 rounded-md shadow-lg mt-1 max-h-60 overflow-y-auto"},Ua={class:"py-1"},Na={key:0,class:"px-4 py-2 text-gray-500 text-sm"},Pa=["onClick"],Ra={__name:"CustomMultiSelect",props:{modelValue:{type:Array,default:()=>[]},options:{type:Array,default:()=>[],required:!0},placeholder:{type:String,default:"Select items"},labelKey:{type:String,default:"name"},trackBy:{type:String,default:"id"}},emits:["update:modelValue"],setup(l,{emit:t}){const s=l,n=t,i=k(!1),a=k(""),u=R(()=>{if(!a.value)return s.options;const v=a.value.toLowerCase();return s.options.filter(g=>g[s.labelKey].toLowerCase().includes(v))});de(()=>s.modelValue,v=>{},{deep:!0});const r=v=>{const g=[...s.modelValue],w=g.findIndex(C=>C===v[s.trackBy]);w===-1?g.push(v[s.trackBy]):g.splice(w,1),n("update:modelValue",g),a.value=""},m=v=>{const g=s.options.find(w=>w[s.trackBy]===v);return g?g[s.labelKey]:""},c=v=>s.modelValue.includes(v);return(v,g)=>{const w=ts("click-outside");return me((o(),d("div",Va,[e("div",{class:"flex flex-wrap items-center w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm cursor-pointer min-h-[38px] bg-white focus-within:border-indigo-500 focus-within:ring-indigo-500",onClick:g[2]||(g[2]=C=>i.value=!i.value)},[l.modelValue.length===0&&!a.value?(o(),d("span",Aa,h(l.placeholder),1)):E("",!0),(o(!0),d(J,null,Q(l.modelValue,C=>(o(),d("div",{key:C,class:"inline-flex items-center bg-indigo-100 text-indigo-800 text-xs font-medium px-2.5 py-0.5 rounded mr-2 mb-1"},[H(h(m(C))+" ",1),e("button",{type:"button",onClick:we(D=>r(l.options.find($=>$[l.trackBy]===C)),["stop"]),class:"ml-1 text-indigo-800 hover:text-indigo-900 focus:outline-none"},g[3]||(g[3]=[e("svg",{class:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]),8,Ia)]))),128)),me(e("input",{type:"text","onUpdate:modelValue":g[0]||(g[0]=C=>a.value=C),onInput:g[1]||(g[1]=C=>i.value=!0),class:"flex-grow border-none focus:ring-0 p-0 text-sm placeholder-gray-400 bg-transparent outline-none",placeholder:l.modelValue.length===0?"Search...":""},null,40,Oa),[[be,a.value]])]),i.value?(o(),d("div",La,[e("ul",Ua,[u.value.length===0?(o(),d("li",Na,"No items found.")):E("",!0),(o(!0),d(J,null,Q(u.value,C=>(o(),d("li",{key:C[l.trackBy],class:ee(["px-4 py-2 cursor-pointer hover:bg-gray-100 text-sm",{"bg-indigo-50 text-indigo-900":c(C[l.trackBy])}]),onClick:D=>r(C)},h(C[l.labelKey]),11,Pa))),128))])])):E("",!0)])),[[w,()=>i.value=!1]])}}},Le=Ee(Ra,[["__scopeId","data-v-5326f069"]]),Fa={class:"mt-6 space-y-6"},Ba={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},Ha={class:"flex items-center"},Wa={class:"flex items-center"},Ya={__name:"MeetingModal",props:{show:{type:Boolean,default:!1},projectId:{type:Number,required:!0},projectUsers:{type:Array,default:()=>[]}},emits:["close","saved"],setup(l,{emit:t}){const s=l,n=t,i=()=>Intl.DateTimeFormat().resolvedOptions().timeZone,a=["Africa/Cairo","Africa/Johannesburg","Africa/Lagos","America/Anchorage","America/Bogota","America/Chicago","America/Denver","America/Los_Angeles","America/Mexico_City","America/New_York","America/Phoenix","America/Sao_Paulo","America/Toronto","America/Vancouver","Asia/Dubai","Asia/Hong_Kong","Asia/Jerusalem","Asia/Kolkata","Asia/Seoul","Asia/Shanghai","Asia/Singapore","Asia/Tokyo","Australia/Melbourne","Australia/Perth","Australia/Sydney","Europe/Amsterdam","Europe/Berlin","Europe/Dublin","Europe/Istanbul","Europe/London","Europe/Madrid","Europe/Moscow","Europe/Paris","Europe/Rome","Pacific/Auckland","Pacific/Honolulu","UTC","GMT","Europe/Belfast","America/Adak","America/Boise","America/Detroit","America/Indianapolis","America/Juneau","America/Louisville","America/Menominee","America/Nome","America/Sitka","America/Yakutat","Asia/Karachi","Asia/Kolkata","Pacific/Auckland","Pacific/Chatham","Europe/Athens","Europe/Brussels","Europe/Budapest","Europe/Copenhagen","Europe/Helsinki","Europe/Lisbon","Europe/Oslo","Europe/Stockholm","Europe/Zurich","Europe/Vienna","Europe/Warsaw","Europe/Zurich","Europe/Sofia","Europe/Prague","Europe/Malta","Europe/Luxembourg","Europe/Kiev","Europe/Rome"].sort(),u=R(()=>a.map(f=>({value:f,label:f}))),r=R(()=>{const f=i(),M=a.includes(f);return console.log("DEBUG: Is detected timezone in list?",M,"Detected:",f),M?f:(console.log("DEBUG: Falling back to UTC for timezone as detected timezone not in list."),"UTC")}),m=ke({summary:"",description:"",start_datetime:"",end_datetime:"",attendee_user_ids:[],location:"",with_google_meet:!0,timezone:r.value,enable_recording:!1}),c=()=>{m.summary="",m.description="",m.attendee_user_ids=[],m.location="",m.with_google_meet=!0,m.timezone=r.value,m.enable_recording=!1,g(),console.log("DEBUG: Form reset. Current timezone in form:",m.timezone)},v=f=>{const M=new Date(f),V=M.getFullYear(),P=String(M.getMonth()+1).padStart(2,"0"),U=String(M.getDate()).padStart(2,"0"),T=String(M.getHours()).padStart(2,"0"),I=String(M.getMinutes()).padStart(2,"0");return`${V}-${P}-${U}T${T}:${I}`},g=()=>{const f=new Date,M=new Date(f.getTime()+3600*1e3),V=new Date(f.getTime()+7200*1e3);m.start_datetime=v(M),m.end_datetime=v(V),console.log("DEBUG: Default times set. Start:",m.start_datetime,"End:",m.end_datetime)};g(),de(()=>s.show,f=>{f&&c()},{immediate:!0});const w=f=>f?(console.log(f),f.replace("T"," ")+":00"):"",C=f=>{const M={...f};return M.start_datetime=w(f.start_datetime),M.end_datetime=w(f.end_datetime),console.log(M),M},D=R(()=>`/api/projects/${s.projectId}/meetings`),$=f=>{n("saved",f)},y=f=>{console.error("DEBUG: MeetingModal submission error:",f)};return(f,M)=>(o(),X(Ce,{show:l.show,title:"Schedule a Meeting","api-endpoint":D.value,"http-method":"post","form-data":m,"format-data-for-api":C,"submit-button-text":"Schedule Meeting","success-message":"Meeting scheduled successfully!",onClose:M[9]||(M[9]=V=>f.$emit("close")),onSubmitted:$,onError:y},{default:N(({errors:V})=>[e("div",Fa,[e("div",null,[p(Y,{for:"summary",value:"Meeting Title"}),p(oe,{id:"summary",modelValue:m.summary,"onUpdate:modelValue":M[0]||(M[0]=P=>m.summary=P),type:"text",class:"mt-1 block w-full",placeholder:"Project Status Meeting",required:""},null,8,["modelValue"]),p(le,{message:V.summary?V.summary[0]:"",class:"mt-2"},null,8,["message"])]),e("div",null,[p(Y,{for:"description",value:"Description"}),me(e("textarea",{id:"description","onUpdate:modelValue":M[1]||(M[1]=P=>m.description=P),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",rows:"3",placeholder:"Meeting agenda and details..."},null,512),[[be,m.description]]),p(le,{message:V.description?V.description[0]:"",class:"mt-2"},null,8,["message"])]),e("div",Ba,[e("div",null,[p(Y,{for:"start_datetime",value:"Start Date & Time"}),p(oe,{id:"start_datetime",modelValue:m.start_datetime,"onUpdate:modelValue":M[2]||(M[2]=P=>m.start_datetime=P),type:"datetime-local",class:"mt-1 block w-full",required:""},null,8,["modelValue"]),p(le,{message:V.start_datetime?V.start_datetime[0]:"",class:"mt-2"},null,8,["message"])]),e("div",null,[p(Y,{for:"end_datetime",value:"End Date & Time"}),p(oe,{id:"end_datetime",modelValue:m.end_datetime,"onUpdate:modelValue":M[3]||(M[3]=P=>m.end_datetime=P),type:"datetime-local",class:"mt-1 block w-full",required:""},null,8,["modelValue"]),p(le,{message:V.end_datetime?V.end_datetime[0]:"",class:"mt-2"},null,8,["message"])])]),e("div",null,[p(Y,{for:"attendees",value:"Attendees"}),p(Le,{id:"attendees",modelValue:m.attendee_user_ids,"onUpdate:modelValue":M[4]||(M[4]=P=>m.attendee_user_ids=P),options:s.projectUsers,"label-key":"name","track-by":"id",placeholder:"Select attendees",class:"mt-1"},null,8,["modelValue","options"]),M[10]||(M[10]=e("p",{class:"mt-1 text-sm text-gray-500"}," Select project members to invite to this meeting ",-1)),p(le,{message:V.attendee_user_ids?V.attendee_user_ids[0]:"",class:"mt-2"},null,8,["message"])]),e("div",null,[p(Y,{for:"location",value:"Location (Optional)"}),p(oe,{id:"location",modelValue:m.location,"onUpdate:modelValue":M[5]||(M[5]=P=>m.location=P),type:"text",class:"mt-1 block w-full",placeholder:"Office, Conference Room, etc."},null,8,["modelValue"]),p(le,{message:V.location?V.location[0]:"",class:"mt-2"},null,8,["message"])]),e("div",null,[p(Y,{for:"timezone",value:"Timezone"}),p(he,{id:"timezone",modelValue:m.timezone,"onUpdate:modelValue":M[6]||(M[6]=P=>m.timezone=P),options:u.value,"value-key":"value","label-key":"label",placeholder:"Select timezone",class:"mt-1"},null,8,["modelValue","options"]),M[11]||(M[11]=e("p",{class:"mt-1 text-sm text-gray-500"}," Select your timezone for this meeting ",-1)),p(le,{message:V.timezone?V.timezone[0]:"",class:"mt-2"},null,8,["message"])]),e("div",Ha,[me(e("input",{id:"with_google_meet","onUpdate:modelValue":M[7]||(M[7]=P=>m.with_google_meet=P),type:"checkbox",class:"h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"},null,512),[[Qe,m.with_google_meet]]),M[12]||(M[12]=e("label",{for:"with_google_meet",class:"ml-2 block text-sm text-gray-900"}," Create Google Meet video conference ",-1))]),e("div",Wa,[me(e("input",{id:"enable_recording","onUpdate:modelValue":M[8]||(M[8]=P=>m.enable_recording=P),type:"checkbox",class:"h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"},null,512),[[Qe,m.enable_recording]]),M[13]||(M[13]=e("label",{for:"enable_recording",class:"ml-2 block text-sm text-gray-900"}," Enable recording and transcript ",-1))])])]),_:1},8,["show","api-endpoint","form-data"]))}},za=Ee(Ya,[["__scopeId","data-v-4e53a3e5"]]),qa={class:"p-6"},Ga={key:0,class:"mb-4 p-3 bg-green-100 text-green-800 rounded-md"},Ka={key:1,class:"mb-4 p-3 bg-red-100 text-red-800 rounded-md"},Ja={class:"mb-4"},Za=["value"],Xa={class:"mt-6 flex justify-end space-x-3"},Qa={__name:"ProjectMagicLinkModal",props:{show:{type:Boolean,default:!1},projectId:{type:Number,required:!0},projectClients:{type:Array,default:()=>[]}},emits:["close"],setup(l,{emit:t}){const s=l,n=t,i=k(!1),a=k(""),u=k(""),r=k(""),m=async()=>{var v,g;if(!a.value){r.value="Please select a client email";return}i.value=!0,u.value="",r.value="";try{const w=await window.axios.post(`/api/projects/${s.projectId}/magic-link`,{email:a.value});w.data.success?(u.value=w.data.message,a.value=""):r.value=w.data.message||"Failed to send magic link"}catch(w){console.error("Error sending magic link:",w),r.value=((g=(v=w.response)==null?void 0:v.data)==null?void 0:g.message)||"An error occurred while sending the magic link"}finally{i.value=!1}},c=()=>{a.value="",u.value="",r.value="",n("close")};return(v,g)=>(o(),X(Se,{show:l.show,onClose:c},{default:N(()=>[e("div",qa,[e("div",{class:"flex justify-between items-center mb-4"},[g[2]||(g[2]=e("h3",{class:"text-lg font-semibold text-gray-900"},"Send Magic Link to Client",-1)),e("button",{onClick:c,class:"text-gray-400 hover:text-gray-500"},g[1]||(g[1]=[e("svg",{class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),u.value?(o(),d("div",Ga,h(u.value),1)):E("",!0),r.value?(o(),d("div",Ka,h(r.value),1)):E("",!0),e("div",Ja,[p(Y,{for:"client-email",value:"Select Client"}),me(e("select",{id:"client-email","onUpdate:modelValue":g[0]||(g[0]=w=>a.value=w),class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full"},[g[3]||(g[3]=e("option",{value:""},"Select a client",-1)),(o(!0),d(J,null,Q(l.projectClients,w=>(o(),d("option",{key:w.id,value:w.email},h(w.name)+" ("+h(w.email)+") ",9,Za))),128))],512),[[We,a.value]]),g[4]||(g[4]=e("p",{class:"mt-2 text-sm text-gray-500"}," The magic link will be sent to the selected client's email address. ",-1))]),e("div",Xa,[p(ye,{onClick:c,type:"button"},{default:N(()=>g[5]||(g[5]=[H(" Cancel ",-1)])),_:1,__:[5]}),p(ue,{onClick:m,disabled:i.value||!a.value,class:"bg-purple-600 hover:bg-purple-700"},{default:N(()=>[H(h(i.value?"Sending...":"Send Magic Link"),1)]),_:1},8,["disabled"])])])]),_:1},8,["show"]))}},ei={class:"mt-6 space-y-6"},ti={class:"mt-2 flex space-x-4"},si={class:"inline-flex items-center"},li={class:"inline-flex items-center"},ai={key:0},ii={key:1},ni=["required"],oi={__name:"ResourceModal",props:{show:{type:Boolean,default:!1},projectId:{type:Number,required:!0},resource:{type:Object,default:null}},emits:["close","saved"],setup(l,{emit:t}){const s=l,n=t,i=k({name:"",type:"link",url:"",file:null,description:""}),a=k(null),u=R(()=>s.resource?`/api/projects/${s.projectId}/resources/${s.resource.id}`:`/api/projects/${s.projectId}/resources`),r=R(()=>s.resource?"put":"post"),m=R(()=>s.resource?"Update Resource":"Add Resource"),c=R(()=>s.resource?"Resource updated successfully!":"Resource added successfully!");de(()=>s.show,D=>{D&&(s.resource?i.value={name:s.resource.name,type:s.resource.type,url:s.resource.type==="link"?s.resource.url:"",file:null,description:s.resource.description||""}:i.value={name:"",type:"link",url:"",file:null,description:""},a.value&&(a.value.value=""))},{immediate:!0});const v=D=>{i.value.file=D.target.files[0]||null},g=D=>{const $=new FormData;return $.append("name",D.name||""),$.append("type",D.type||"link"),$.append("description",D.description||""),D.type==="link"?$.append("url",D.url||""):D.type==="file"&&D.file&&$.append("file",D.file),(r.value==="put"||r.value==="patch")&&$.append("_method","PUT"),$},w=D=>{n("saved",D.resource)},C=()=>{n("close")};return(D,$)=>(o(),X(Ce,{show:l.show,title:l.resource?"Edit Resource":"Add Resource","api-endpoint":u.value,"http-method":r.value,"form-data":i.value,"submit-button-text":m.value,"success-message":c.value,"format-data-for-api":g,onClose:C,onSubmitted:w},{default:N(({errors:y})=>[e("div",ei,[e("div",null,[p(Y,{for:"resource-type",value:"Resource Type"}),e("div",ti,[e("label",si,[me(e("input",{type:"radio","onUpdate:modelValue":$[0]||($[0]=f=>i.value.type=f),value:"link",class:"form-radio text-indigo-600"},null,512),[[mt,i.value.type]]),$[5]||($[5]=e("span",{class:"ml-2 text-gray-700"},"Link",-1))]),e("label",li,[me(e("input",{type:"radio","onUpdate:modelValue":$[1]||($[1]=f=>i.value.type=f),value:"file",class:"form-radio text-indigo-600"},null,512),[[mt,i.value.type]]),$[6]||($[6]=e("span",{class:"ml-2 text-gray-700"},"File",-1))])])]),e("div",null,[p(Y,{for:"resource-name",value:"Name"}),p(oe,{id:"resource-name",modelValue:i.value.name,"onUpdate:modelValue":$[2]||($[2]=f=>i.value.name=f),type:"text",class:"mt-1 block w-full",placeholder:"Enter resource name",required:""},null,8,["modelValue"]),p(le,{message:y.name?y.name[0]:"",class:"mt-2"},null,8,["message"])]),i.value.type==="link"?(o(),d("div",ai,[p(Y,{for:"resource-url",value:"URL"}),p(oe,{id:"resource-url",modelValue:i.value.url,"onUpdate:modelValue":$[3]||($[3]=f=>i.value.url=f),type:"url",class:"mt-1 block w-full",placeholder:"https://example.com",required:""},null,8,["modelValue"]),p(le,{message:y.url?y.url[0]:"",class:"mt-2"},null,8,["message"])])):E("",!0),i.value.type==="file"?(o(),d("div",ii,[p(Y,{for:"resource-file",value:"File"}),e("input",{id:"resource-file",ref_key:"fileInputRef",ref:a,type:"file",class:"mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100",onChange:v,required:!l.resource||i.value.type==="file"},null,40,ni),p(le,{message:y.file?y.file[0]:"",class:"mt-2"},null,8,["message"])])):E("",!0),e("div",null,[p(Y,{for:"resource-description",value:"Description (Optional)"}),me(e("textarea",{id:"resource-description","onUpdate:modelValue":$[4]||($[4]=f=>i.value.description=f),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",rows:"3",placeholder:"Enter a description for this resource"},null,512),[[be,i.value.description]]),p(le,{message:y.description?y.description[0]:"",class:"mt-2"},null,8,["message"])])])]),_:1},8,["show","title","api-endpoint","http-method","form-data","submit-button-text","success-message"]))}},ri=Ee(oi,[["__scopeId","data-v-f508dda8"]]),di={class:"flex flex-col space-y-6"},ui={class:"grid grid-cols-1 sm:grid-cols-2 gap-6"},ci={key:0},mi={class:"grid grid-cols-1 sm:grid-cols-2 gap-6"},vi={class:"mb-4"},pi={key:0,class:"text-xs text-gray-500 mt-1"},hi={key:0,class:"text-xs text-gray-500 mt-1"},gi={class:"flex justify-between items-center mb-3"},yi={key:0,class:"flex items-center"},fi={key:1},bi={class:"bg-gray-100 p-4 rounded-lg shadow-inner min-h-[300px]"},_i={key:0,class:"flex items-center justify-center h-full"},wi=["innerHTML"],xi={__name:"ComposeEmailModal",props:{show:{type:Boolean,default:!1},projectId:{type:Number,required:!0},clients:{type:Array,default:()=>[]}},emits:["close"],setup(l,{emit:t}){const s=l,n=t,i=k([]),a=k(""),u=k(!1),r=k({}),m=k({}),c=k(!1),v=ke({template_id:null,template_data:{},project_id:s.projectId,client_ids:[],subject:"",greeting_name:"",custom_greeting_name:"",status:"pending_approval"});et(s.projectId);const g=R(()=>i.value.find(U=>U.id===v.template_id)),w=async U=>{c.value=!0,m.value={};const T=new Set;U.placeholders.forEach(I=>{(I.is_repeatable||I.is_selectable)&&I.source_model&&T.add(I.source_model)});try{const I=Array.from(T).map(b=>{const _=b.split("\\").pop(),x=`/api/projects/${s.projectId}/model-data/${_}`;return window.axios.get(x).then(j=>{m.value[_]=j.data})});await Promise.all(I)}catch(I){console.error("Failed to fetch source model data:",I)}finally{c.value=!1}},C=async()=>{try{const U=await window.axios.get("/api/email-templates");i.value=U.data}catch(U){console.error("Failed to fetch email templates:",U)}},D=async()=>{if(!v.template_id||v.client_ids.length===0){a.value='<p class="text-gray-500 italic">Select a template and at least one recipient to see a preview.</p>';return}u.value=!0;try{const U=v.client_ids[0],T=typeof U=="object"?U.id:U,I=await window.axios.post(`/api/projects/${s.projectId}/email-preview`,{template_id:v.template_id,client_id:T,template_data:v.template_data});a.value=I.data.body_html,I.data.subject&&(v.subject=I.data.subject)}catch(U){console.error("Failed to fetch email preview:",U),a.value='<p class="text-red-500 italic">Error loading preview.</p>'}finally{u.value=!1}};de(()=>s.show,U=>{U&&(Object.assign(v,{template_id:null,template_data:{},project_id:s.projectId,client_ids:[],subject:"",greeting_name:"",custom_greeting_name:"",status:"pending_approval"}),a.value="",r.value={},m.value={},C())}),de(g,U=>{v.template_data={},U&&U.placeholders&&(U.placeholders.forEach(T=>{T.is_dynamic?v.template_data[T.name]="":(T.is_repeatable||T.is_selectable)&&(T.is_repeatable?v.template_data[T.name]=[]:v.template_data[T.name]=null)}),w(U))});const $=async()=>{if(Array.isArray(v.client_ids)&&v.client_ids.length>0&&typeof v.client_ids[0]=="object"&&(v.client_ids=v.client_ids.map(U=>U.id)),!v.subject&&g.value&&(v.subject=g.value.subject||""),v.client_ids.length>0){const U=v.client_ids[0],T=s.clients.find(I=>I.id===U);T&&(v.greeting_name=T.name||"")}return console.log("Form data prepared:",JSON.stringify(v)),!0},y=()=>{n("close")},f=()=>{n("close")},M=R(()=>i.value.map(U=>({value:U.id,label:U.name}))),V=R(()=>g.value?g.value.placeholders.filter(U=>U.is_dynamic||U.is_repeatable||U.is_selectable):[]),P=R(()=>"/api/emails/templated");return fe(()=>{C()}),(U,T)=>(o(),X(Ce,{show:l.show,title:"Compose Email from Template","api-endpoint":P.value,"http-method":"post","form-data":v,"submit-button-text":"Submit for Approval","success-message":"Email submitted for approval successfully!",onClose:f,onSubmitted:y,"before-submit":$},{default:N(({errors:I})=>[e("div",di,[e("div",ui,[e("div",null,[p(Y,{for:"template",value:"Select Template"}),p(he,{id:"template",modelValue:v.template_id,"onUpdate:modelValue":T[0]||(T[0]=b=>v.template_id=b),options:M.value,placeholder:"Select a template","value-key":"value","label-key":"label","allow-empty":!0,class:"mt-1"},null,8,["modelValue","options"]),p(le,{message:I.template_id?I.template_id[0]:"",class:"mt-2"},null,8,["message"])]),e("div",null,[p(Y,{for:"client_ids",value:"Recipients"}),p(Le,{id:"client_ids",modelValue:v.client_ids,"onUpdate:modelValue":T[1]||(T[1]=b=>v.client_ids=b),options:l.clients,placeholder:"Select clients to send to","label-key":"name","track-by":"id","preserve-search":!0,"object-value":!0,class:"mt-1"},null,8,["modelValue","options"]),p(le,{message:I.client_ids?I.client_ids[0]:"",class:"mt-2"},null,8,["message"])])]),g.value?(o(),d("div",ci,[T[2]||(T[2]=e("h4",{class:"text-md font-semibold text-gray-800 mb-3"},"Dynamic Placeholders",-1)),e("div",mi,[(o(!0),d(J,null,Q(V.value,b=>(o(),d("div",{key:b.id},[e("div",vi,[p(Y,{for:b.name,value:b.name},null,8,["for","value"]),b.is_repeatable&&b.source_model?(o(),d(J,{key:0},[p(Le,{id:b.name,modelValue:v.template_data[b.name],"onUpdate:modelValue":_=>v.template_data[b.name]=_,options:m.value[b.source_model.split("\\").pop()]||[],placeholder:`Select one or more ${b.name}`,"label-key":b.source_attribute,"track-by":"id",class:"mt-1"},null,8,["id","modelValue","onUpdate:modelValue","options","placeholder","label-key"]),c.value?(o(),d("div",pi," Loading "+h(b.source_model.split("\\").pop())+"... ",1)):E("",!0)],64)):b.is_selectable&&b.source_model?(o(),d(J,{key:1},[p(he,{id:b.name,modelValue:v.template_data[b.name],"onUpdate:modelValue":_=>v.template_data[b.name]=_,options:m.value[b.source_model.split("\\").pop()]||[],placeholder:`Select a ${b.name}`,"value-key":b.trackBy??"id","label-key":b.source_attribute,"allow-empty":!0,class:"mt-1"},null,8,["id","modelValue","onUpdate:modelValue","options","placeholder","value-key","label-key"]),c.value?(o(),d("div",hi," Loading "+h(b.source_model.split("\\").pop())+"... ",1)):E("",!0)],64)):b.is_dynamic&&b.is_link?(o(),X(oe,{key:2,id:b.name,type:"url",class:"mt-1 block w-full",modelValue:v.template_data[b.name],"onUpdate:modelValue":_=>v.template_data[b.name]=_,placeholder:"Enter URL"},null,8,["id","modelValue","onUpdate:modelValue"])):(o(),X(oe,{key:3,id:b.name,type:"text",class:"mt-1 block w-full",modelValue:v.template_data[b.name],"onUpdate:modelValue":_=>v.template_data[b.name]=_},null,8,["id","modelValue","onUpdate:modelValue"])),p(le,{message:I[`template_data.${b.name}`]?I[`template_data.${b.name}`][0]:"",class:"mt-2"},null,8,["message"])])]))),128))])])):E("",!0),e("div",null,[e("div",gi,[T[4]||(T[4]=e("h4",{class:"text-md font-semibold text-gray-800"},"Email Preview",-1)),p(ue,{onClick:D,disabled:!v.template_id||v.client_ids.length===0||u.value,class:ee({"opacity-50 cursor-not-allowed":!v.template_id||v.client_ids.length===0||u.value})},{default:N(()=>[u.value?(o(),d("span",yi,T[3]||(T[3]=[e("svg",{class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),H(" Loading... ",-1)]))):(o(),d("span",fi," Refresh Preview "))]),_:1},8,["disabled","class"])]),e("div",bi,[u.value?(o(),d("div",_i,T[5]||(T[5]=[e("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-500"},null,-1)]))):(o(),d("div",{key:1,innerHTML:a.value},null,8,wi))])])])]),_:1},8,["show","api-endpoint","form-data"]))}},ki={class:"bg-white p-6 rounded-xl shadow-md hover:shadow-lg transition-shadow mb-6"},Di={class:"flex justify-between items-center mb-4"},Ci={class:"flex gap-3"},Ei={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},$i={class:"text-2xl font-bold text-gray-900 tracking-tight mb-2"},Si={class:"text-gray-600 text-base"},Mi={class:"space-y-3 text-sm text-gray-700"},Ti={class:"flex flex-wrap gap-2 mt-2 items-center"},ji=["href"],Vi=["href"],Ai=["href"],Ii={key:3,class:"text-gray-500 text-sm"},Oi={class:"relative"},Li=["onClick"],Ui={key:0,xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 text-indigo-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},Ni={key:1,xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 text-indigo-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},Pi={key:0,class:"resource-tooltip absolute left-0 bottom-full mb-2 w-48 z-10"},Ri={class:"bg-white rounded-md shadow-lg p-3 text-sm border border-gray-200"},Fi={class:"flex justify-between items-center mb-2"},Bi={class:"font-medium text-gray-900"},Hi={key:0,class:"text-gray-600 text-xs mb-2"},Wi={class:"flex justify-between mt-2 pt-2 border-t border-gray-100"},Yi=["href"],zi={class:"flex space-x-2"},qi=["onClick"],Gi=["onClick"],Ki={class:"p-6"},Ji={key:0,class:"mb-4 p-4 bg-green-50 border border-green-200 text-green-700 rounded-md"},Zi={key:1,class:"mb-4 p-4 bg-red-50 border border-red-200 text-red-700 rounded-md"},Xi={class:"mb-4"},Qi={key:0,class:"text-gray-500 text-sm mt-1"},en={key:1,class:"text-red-500 text-sm mt-1"},tn={class:"flex justify-end mt-6"},sn={__name:"ProjectGeneralInfoCard",props:{project:{type:Object,required:!0},projectId:{type:Number,required:!0},canManageProjects:{type:Boolean,required:!0},canEditProjects:{type:Boolean,required:!1},isSuperAdmin:{type:Boolean,required:!0}},emits:["openEditModal","openStandupModal","openMeetingModal","resourceSaved","openComposeModal"],setup(l,{emit:t}){const s=l,n=t,i=k(!1),a=k(null),u=k([]),r=k(!1),m=k(null),c=k(!1),v=k(!1),g=k(!1),w=k({client_ids:[]}),C=k({}),D=k(""),$=k([]),y=k(!1),f=k("");et(s.projectId);const M=async()=>{r.value=!0;try{const A=await window.axios.get(`/api/projects/${s.projectId}/resources`);A.data.success?u.value=A.data.resources:console.error("Failed to fetch resources:",A.data.message)}catch(A){console.error("Error fetching resources:",A)}finally{r.value=!1}},V=()=>{a.value=null,i.value=!0},P=A=>{a.value=A,i.value=!0},U=async A=>{if(confirm("Are you sure you want to delete this resource?"))try{const S=await window.axios.delete(`/api/projects/${s.projectId}/resources/${A}`);S.data.success?u.value=u.value.filter(O=>O.id!==A):console.error("Failed to delete resource:",S.data.message)}catch(S){console.error("Error deleting resource:",S)}},T=A=>{if(a.value){const S=u.value.findIndex(O=>O.id===A.id);S!==-1&&(u.value[S]=A)}else u.value.push(A);n("resourceSaved",A)},I=A=>{m.value=m.value===A?null:A},b=()=>{m.value=null},_=A=>{if(m.value!==null){const S=A.target.closest(".resource-tooltip"),O=A.target.closest(".resource-button");!S&&!O&&b()}};fe(()=>{M(),document.addEventListener("click",_)}),ss(()=>{document.removeEventListener("click",_)});const x=async()=>{var A,S;y.value=!0,f.value="";try{const O=await window.axios.get(`/api/projects/${s.projectId}/sections/clients?type=clients`);console.log(O),$.value=O.data}catch(O){console.error("Failed to fetch project clients:",O),f.value=((S=(A=O.response)==null?void 0:A.data)==null?void 0:S.message)||"Failed to load client data."}finally{y.value=!1}},j=()=>{w.value.client_ids=[],C.value={},D.value="",v.value=!0,x()},Z=()=>{c.value=!0,x()},ie=()=>{v.value=!1},B=async()=>{if(C.value={},D.value="",g.value=!0,!w.value.client_ids||w.value.client_ids.length===0){C.value={client_ids:["Please select a client."]},g.value=!1;return}try{const A=w.value.client_ids[0];if(!$.value.find(z=>z.id===A)){C.value={client_ids:["Selected client does not have a valid email."]},g.value=!1;return}const O=await window.axios.post(`/api/projects/${s.projectId}/magic-link`,{client_id:A});O.data.success&&(D.value=O.data.message,w.value.client_ids=[])}catch(A){A.response&&A.response.status===422?C.value=A.response.data.errors:A.response&&A.response.data.message?C.value={general:[A.response.data.message]}:C.value={general:["An unexpected error occurred. Please try again."]}}finally{g.value=!1}};return(A,S)=>{var O;return o(),d(J,null,[e("div",ki,[e("div",Di,[S[12]||(S[12]=e("h4",{class:"text-lg font-semibold text-gray-900"},"General Information",-1)),e("div",Ci,[p(ue,{class:"bg-blue-600 hover:bg-blue-700 transition-colors",onClick:S[0]||(S[0]=z=>n("openStandupModal"))},{default:N(()=>S[8]||(S[8]=[H(" Daily Standup ",-1)])),_:1,__:[8]}),l.canEditProjects||l.isSuperAdmin?(o(),X(ue,{key:0,onClick:S[1]||(S[1]=z=>A.$inertia.visit("/projects/"+l.projectId+"/edit")),class:"bg-indigo-600 hover:bg-indigo-700 transition-colors"},{default:N(()=>S[9]||(S[9]=[H(" Edit Project ",-1)])),_:1,__:[9]})):E("",!0),l.canManageProjects||l.isSuperAdmin?(o(),X(ue,{key:1,class:"bg-green-600 hover:bg-green-700 transition-colors",onClick:S[2]||(S[2]=z=>n("openMeetingModal"))},{default:N(()=>S[10]||(S[10]=[H(" Schedule Meeting ",-1)])),_:1,__:[10]})):E("",!0),l.canManageProjects||l.isSuperAdmin?(o(),X(ue,{key:2,class:"bg-blue-400 hover:bg-blue-600 transition-colors",onClick:Z},{default:N(()=>S[11]||(S[11]=[H(" Compose Email ",-1)])),_:1,__:[11]})):E("",!0),l.canManageProjects?(o(),X(ue,{key:3,class:"bg-purple-600 hover:bg-purple-700 transition-colors",onClick:j,disabled:g.value},{default:N(()=>[H(h(g.value?"Sending...":"Send Magic Link"),1)]),_:1},8,["disabled"])):E("",!0)])]),e("div",Ei,[e("div",null,[e("h3",$i,h(l.project.name),1),e("p",Si,h(l.project.description||"No description provided"),1)]),e("div",Mi,[e("p",null,[S[13]||(S[13]=e("strong",{class:"text-gray-900"},"Status:",-1)),H(" "+h(((O=l.project.status)==null?void 0:O.replace("_"," ").toUpperCase())||"N/A"),1)]),e("p",null,[S[14]||(S[14]=e("strong",{class:"text-gray-900"},"Project Type:",-1)),H(" "+h(l.project.project_type||"N/A"),1)]),e("p",null,[S[15]||(S[15]=e("strong",{class:"text-gray-900"},"Source:",-1)),H(" "+h(l.project.source||"N/A"),1)]),e("div",Ti,[e("button",{onClick:V,class:"p-2 bg-gray-100 rounded-full hover:bg-gray-200 transition-colors",title:"Add Resource"},S[16]||(S[16]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 text-indigo-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1)])),l.project.website?(o(),d("a",{key:0,href:l.project.website,target:"_blank",class:"p-2 bg-gray-100 rounded-full hover:bg-gray-200 transition-colors",title:"Visit Website"},S[17]||(S[17]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 text-indigo-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9"})],-1)]),8,ji)):E("",!0),l.project.social_media_link?(o(),d("a",{key:1,href:l.project.social_media_link,target:"_blank",class:"p-2 bg-gray-100 rounded-full hover:bg-gray-200 transition-colors",title:"Social Media"},S[18]||(S[18]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 text-indigo-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"})],-1)]),8,Vi)):E("",!0),l.project.google_drive_link?(o(),d("a",{key:2,href:l.project.google_drive_link,target:"_blank",class:"p-2 bg-gray-100 rounded-full hover:bg-gray-200 transition-colors",title:"Google Drive"},S[19]||(S[19]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 text-indigo-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1)]),8,Ai)):E("",!0),r.value?(o(),d("div",Ii," Loading resources... ")):(o(!0),d(J,{key:4},Q(u.value,z=>(o(),d("div",{key:z.id,class:"relative"},[e("div",Oi,[e("button",{onClick:we(re=>I(z.id),["prevent"]),class:"resource-button p-2 bg-gray-100 rounded-full hover:bg-gray-200 transition-colors block"},[z.type==="link"?(o(),d("svg",Ui,S[20]||(S[20]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101"},null,-1),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10.172 13.828a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.102 1.101"},null,-1)]))):(o(),d("svg",Ni,S[21]||(S[21]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"},null,-1)])))],8,Li),m.value===z.id?(o(),d("div",Pi,[e("div",Ri,[e("div",Fi,[e("h4",Bi,h(z.name),1),e("button",{onClick:we(b,["prevent"]),class:"text-gray-400 hover:text-gray-600"},S[22]||(S[22]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),z.description?(o(),d("p",Hi,h(z.description),1)):E("",!0),e("div",Wi,[e("a",{href:z.url,target:"_blank",class:"text-xs text-indigo-600 hover:text-indigo-800"}," Open Link ",8,Yi),e("div",zi,[e("button",{onClick:we(re=>P(z),["prevent"]),class:"p-1 text-gray-500 hover:text-indigo-600",title:"Edit"},S[23]||(S[23]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1)]),8,qi),e("button",{onClick:we(re=>U(z.id),["prevent"]),class:"p-1 text-gray-500 hover:text-red-600",title:"Delete"},S[24]||(S[24]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]),8,Gi)])])]),S[25]||(S[25]=e("div",{class:"absolute left-5 bottom-0 transform translate-y-1/2 rotate-45 w-2 h-2 bg-white border-r border-b border-gray-200"},null,-1))])):E("",!0)])]))),128))])])])]),p(ri,{show:i.value,"project-id":l.projectId,resource:a.value,onClose:S[3]||(S[3]=z=>i.value=!1),onSaved:T},null,8,["show","project-id","resource"]),p(Se,{show:v.value,onClose:ie},{default:N(()=>[e("div",Ki,[S[28]||(S[28]=e("h2",{class:"text-lg font-medium text-gray-900 mb-4"}," Send Magic Link ",-1)),D.value?(o(),d("div",Ji,h(D.value),1)):E("",!0),C.value.general?(o(),d("div",Zi,h(C.value.general[0]),1)):E("",!0),e("form",{onSubmit:we(B,["prevent"])},[e("div",Xi,[p(Y,{for:"client",value:"Select Client"}),y.value?(o(),d("div",Qi,"Loading clients...")):f.value?(o(),d("div",en,h(f.value),1)):(o(),X(Le,{key:2,id:"client",modelValue:w.value.client_ids,"onUpdate:modelValue":S[4]||(S[4]=z=>w.value.client_ids=z),options:$.value,placeholder:"Select a client","label-key":"name","track-by":"id",class:"mt-1"},null,8,["modelValue","options"])),p(le,{message:C.value.client_ids?C.value.client_ids[0]:"",class:"mt-2"},null,8,["message"]),S[26]||(S[26]=e("p",{class:"mt-2 text-sm text-gray-500"}," Select a client to send them a magic link for project access. ",-1))]),e("div",tn,[p(ye,{onClick:ie,class:"mr-3"},{default:N(()=>S[27]||(S[27]=[H(" Cancel ",-1)])),_:1,__:[27]}),p(ue,{type:"submit",class:"bg-purple-600 hover:bg-purple-700 transition-colors",disabled:g.value},{default:N(()=>[H(h(g.value?"Sending...":"Send Magic Link"),1)]),_:1},8,["disabled"])])],32)])]),_:1},8,["show"]),p(xi,{show:c.value,title:"Compose New Email","api-endpoint":"/api/emails/templated","http-method":"post",clients:$.value,"submit-button-text":"Submit for Approval","success-message":"Email submitted for approval successfully!","project-id":l.projectId,onClose:S[5]||(S[5]=z=>c.value=!1),onSubmitted:S[6]||(S[6]=z=>c.value=!1),onError:S[7]||(S[7]=z=>console.error("Email submission error:",z))},null,8,["show","clients","project-id"])],64)}}},ln=Ee(sn,[["__scopeId","data-v-5f39fde9"]]),an={class:"grid grid-cols-2 sm:grid-cols-4 gap-4 mb-6"},nn={class:"bg-white p-4 rounded-xl shadow-md hover:shadow-lg transition-shadow"},on={class:"text-2xl font-bold text-indigo-600"},rn={class:"bg-white p-4 rounded-xl shadow-md hover:shadow-lg transition-shadow"},dn={class:"text-2xl font-bold text-indigo-600"},un={class:"bg-white p-4 rounded-xl shadow-md hover:shadow-lg transition-shadow"},cn={class:"text-2xl font-bold text-indigo-600"},mn={class:"bg-white p-4 rounded-xl shadow-md hover:shadow-lg transition-shadow"},vn={class:"text-2xl font-bold text-indigo-600"},pn={__name:"ProjectStatsCards",props:{tasks:{type:Array,required:!0},emails:{type:Array,required:!0}},setup(l){const t=l,s=R(()=>t.tasks.filter(u=>u.status!=="Done").length),n=R(()=>t.emails.filter(u=>u.type==="received").length),i=R(()=>{const u=t.emails.filter(r=>r.status==="received"||r.type==="received");if(u.length>0){const r=[...u].sort((m,c)=>new Date(c.created_at)-new Date(m.created_at));return new Date(r[0].created_at).toLocaleDateString()}return"N/A"}),a=R(()=>{const u=t.tasks.filter(r=>r.status!=="Done");if(u.length>0){const r=u.filter(m=>m.due_date);if(r.length>0)return[...r].sort((c,v)=>new Date(c.due_date)-new Date(v.due_date))[0].due_date}return"N/A"});return(u,r)=>(o(),d("div",an,[e("div",nn,[r[0]||(r[0]=e("h4",{class:"text-sm font-semibold text-gray-500 mb-1"},"Pending Tasks",-1)),e("p",on,h(s.value),1)]),e("div",rn,[r[1]||(r[1]=e("h4",{class:"text-sm font-semibold text-gray-500 mb-1"},"Received Emails",-1)),e("p",dn,h(n.value),1)]),e("div",un,[r[2]||(r[2]=e("h4",{class:"text-sm font-semibold text-gray-500 mb-1"},"Last Email Received",-1)),e("p",cn,h(i.value),1)]),e("div",mn,[r[3]||(r[3]=e("h4",{class:"text-sm font-semibold text-gray-500 mb-1"},"Next Task Deadline",-1)),e("p",vn,h(a.value),1)])]))}},hn={class:"bg-white p-4 rounded-xl shadow-md mb-6"},gn={class:"border-b border-gray-200"},yn={class:"-mb-px flex space-x-8 overflow-x-auto"},fn={__name:"ProjectTabsNavigation",props:{selectedTab:{type:String,default:null},canViewEmails:{type:Boolean,required:!0},canViewNotes:{type:Boolean,required:!0},canViewDeliverables:{type:Boolean,required:!0},canViewSeoReports:{type:Boolean,required:!0}},emits:["update:selectedTab"],setup(l,{emit:t}){const s=l,n=t,i=R({get:()=>s.selectedTab,set:a=>n("update:selectedTab",a)});return(a,u)=>(o(),d("div",hn,[e("div",gn,[e("nav",yn,[e("button",{onClick:u[0]||(u[0]=r=>i.value=null),class:ee([i.value===null?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300","whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm"])}," Overview ",2),e("button",{onClick:u[1]||(u[1]=r=>i.value="tasks"),class:ee([i.value==="tasks"?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300","whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm"])}," Project Tasks ",2),l.canViewEmails?(o(),d("button",{key:0,onClick:u[2]||(u[2]=r=>i.value="emails"),class:ee([i.value==="emails"?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300","whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm"])}," Email Communication ",2)):E("",!0),l.canViewNotes?(o(),d("button",{key:1,onClick:u[3]||(u[3]=r=>i.value="notes"),class:ee([i.value==="notes"?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300","whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm"])}," Notes ",2)):E("",!0),l.canViewNotes?(o(),d("button",{key:2,onClick:u[4]||(u[4]=r=>i.value="standups"),class:ee([i.value==="standups"?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300","whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm"])}," Daily Standups ",2)):E("",!0),l.canViewDeliverables?(o(),d("button",{key:3,onClick:u[5]||(u[5]=r=>i.value="deliverables"),class:ee([i.value==="deliverables"?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300","whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm"])}," Deliverables ",2)):E("",!0),l.canViewSeoReports?(o(),d("button",{key:4,onClick:u[6]||(u[6]=r=>i.value="seo-reports"),class:ee([i.value==="seo-reports"?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300","whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm"])}," SEO Reports ",2)):E("",!0)])])]))}},bn={class:"space-y-4"},_n={key:0,class:"text-sm text-gray-500"},wn={class:"flex justify-between items-center"},xn={key:0,class:"text-sm text-gray-500"},kn="put",Dn="Update Task",Cn="Task updated successfully!",En={__name:"EditTaskModal",props:{show:Boolean,projectId:Number,selectedTask:Object,projectUsers:Array,taskTypes:Array,milestones:Array,loadingTaskTypes:Boolean,loadingMilestones:Boolean},emits:["close","saved","open-add-milestone-modal"],setup(l,{emit:t}){const s=l,n=t,i=ke({name:"",description:"",assigned_to_user_id:null,due_date:null,status:"To Do",task_type_id:null,milestone_id:null}),a=["To Do","In Progress","Done","Blocked","Archived"],u=R(()=>"Edit Task"),r=R(()=>{var D;return`/api/tasks/${(D=s.selectedTask)==null?void 0:D.id}`});de(()=>[s.show,s.selectedTask],([D,$],[y,f]=[])=>{var M;if(D&&$){let V=null;if($.milestone){const T=s.milestones.find(I=>I.name===$.milestone);T&&(V=T.id)}else $.milestone_id&&(V=$.milestone_id);let P=null;if($.task_type){const T=s.taskTypes.find(I=>I.name===$.task_type);T&&(P=T.id)}else $.task_type_id&&(P=$.task_type_id);let U=null;if($.assigned_to&&$.assigned_to!=="Unassigned"){const T=(M=s.projectUsers)==null?void 0:M.find(I=>I.name===$.assigned_to);T&&(U=T.id)}else $.assigned_to_id&&(U=$.assigned_to_id);Object.assign(i,{name:$.title,description:$.description||"",assigned_to_user_id:U,due_date:$.due_date||null,status:$.status,task_type_id:P,milestone_id:V})}else D||Object.assign(i,{name:"",description:"",assigned_to_user_id:null,due_date:null,status:"To Do",task_type_id:null,milestone_id:null})},{immediate:!0});const m=D=>{n("saved",D),n("close")},c=()=>{n("open-add-milestone-modal")},v=()=>{n("close")},g=R(()=>s.projectUsers.map(D=>({value:D.id,label:D.name}))),w=R(()=>s.taskTypes.map(D=>({value:D.id,label:D.name}))),C=R(()=>s.milestones.map(D=>({value:D.id,label:D.name})));return(D,$)=>(o(),X(Ce,{show:l.show,title:u.value,"api-endpoint":r.value,"http-method":kn,"form-data":i,"submit-button-text":Dn,"success-message":Cn,onClose:v,onSubmitted:m},{default:N(({errors:y})=>[e("div",bn,[e("div",null,[p(Y,{for:"task-name",value:"Task Name"}),p(oe,{id:"task-name",modelValue:i.name,"onUpdate:modelValue":$[0]||($[0]=f=>i.name=f),type:"text",class:"mt-1 block w-full",placeholder:"Enter task name",required:""},null,8,["modelValue"]),p(le,{message:y.name?y.name[0]:"",class:"mt-2"},null,8,["message"])]),e("div",null,[p(Y,{for:"task-description",value:"Description"}),me(e("textarea",{id:"task-description","onUpdate:modelValue":$[1]||($[1]=f=>i.description=f),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",rows:"3",placeholder:"Enter task description"},null,512),[[be,i.description]]),p(le,{message:y.description?y.description[0]:"",class:"mt-2"},null,8,["message"])]),e("div",null,[p(Y,{for:"task-status",value:"Status"}),p(he,{id:"task-status",modelValue:i.status,"onUpdate:modelValue":$[2]||($[2]=f=>i.status=f),options:a.map(f=>({value:f,label:f})),"value-key":"value","label-key":"label",placeholder:"Select status",class:"mt-1"},null,8,["modelValue","options"]),p(le,{message:y.status?y.status[0]:"",class:"mt-2"},null,8,["message"])]),e("div",null,[p(Y,{for:"task-due-date",value:"Due Date"}),p(oe,{id:"task-due-date",modelValue:i.due_date,"onUpdate:modelValue":$[3]||($[3]=f=>i.due_date=f),type:"date",class:"mt-1 block w-full"},null,8,["modelValue"]),p(le,{message:y.due_date?y.due_date[0]:"",class:"mt-2"},null,8,["message"])]),e("div",null,[p(Y,{for:"task-assigned-to",value:"Assigned To"}),p(he,{id:"task-assigned-to",modelValue:i.assigned_to_user_id,"onUpdate:modelValue":$[4]||($[4]=f=>i.assigned_to_user_id=f),options:g.value,"value-key":"value","label-key":"label",placeholder:"Unassigned",class:"mt-1","allow-empty":!0},null,8,["modelValue","options"]),p(le,{message:y.assigned_to_user_id?y.assigned_to_user_id[0]:"",class:"mt-2"},null,8,["message"])]),e("div",null,[p(Y,{for:"task-type",value:"Task Type"}),l.loadingTaskTypes?(o(),d("div",_n,"Loading task types...")):(o(),X(he,{key:1,id:"task-type",modelValue:i.task_type_id,"onUpdate:modelValue":$[5]||($[5]=f=>i.task_type_id=f),options:w.value,"value-key":"value","label-key":"label",placeholder:"Select a task type",class:"mt-1","allow-empty":!0},null,8,["modelValue","options"])),p(le,{message:y.task_type_id?y.task_type_id[0]:"",class:"mt-2"},null,8,["message"])]),e("div",null,[e("div",wn,[p(Y,{for:"task-milestone",value:"Milestone"}),e("button",{type:"button",onClick:c,class:"text-sm text-indigo-600 hover:text-indigo-800"}," + Create New Milestone ")]),l.loadingMilestones?(o(),d("div",xn,"Loading milestones...")):(o(),X(he,{key:1,id:"task-milestone",modelValue:i.milestone_id,"onUpdate:modelValue":$[6]||($[6]=f=>i.milestone_id=f),options:C.value,"value-key":"value","label-key":"label",placeholder:"No milestone",class:"mt-1","allow-empty":!0},null,8,["modelValue","options"])),p(le,{message:y.milestone_id?y.milestone_id[0]:"",class:"mt-2"},null,8,["message"])])])]),_:1},8,["show","title","api-endpoint","form-data"]))}},$n={class:"bg-white p-6 rounded-xl shadow-md hover:shadow-lg transition-shadow"},Sn={class:"flex justify-between items-center mb-4"},Mn={class:"flex gap-2"},Tn={key:0},jn={key:1},Vn={class:"mb-6 overflow-x-auto"},An={key:0,class:"text-center text-gray-600 text-sm animate-pulse py-4"},In={key:1,class:"text-center py-4"},On={key:2,class:"relative py-8"},Ln={class:"relative flex justify-between"},Un={key:0,class:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Nn={key:1,class:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Pn={key:2,class:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Rn={key:3,class:"w-2 h-2 bg-white rounded-full"},Fn={class:"absolute -top-8 transform -translate-x-1/2 left-1/2 w-32"},Bn=["title"],Hn={class:"absolute top-8 transform -translate-x-1/2 left-1/2"},Wn={class:"text-xs text-gray-500 whitespace-nowrap"},Yn={class:"mb-6 bg-gray-50 p-4 rounded-lg"},zn={class:"flex flex-wrap items-center gap-4"},qn={class:"flex-1 min-w-[200px]"},Gn={class:"flex-1 min-w-[200px]"},Kn={class:"flex-1 min-w-[200px]"},Jn={class:"flex-1 min-w-[200px]"},Zn={key:0,class:"mt-3 text-sm text-gray-600"},Xn={key:0,class:"text-red-600 font-medium"},Qn={key:0,class:"text-center text-gray-600 text-sm animate-pulse py-4"},eo={key:1,class:"text-center py-4"},to={class:"text-red-600 text-sm font-medium"},so={key:2,class:"overflow-x-auto"},lo={class:"min-w-full divide-y divide-gray-200"},ao={class:"bg-white divide-y divide-gray-200"},io={class:"px-4 py-3 text-sm text-gray-900"},no={class:"px-4 py-3 text-sm text-gray-700"},oo={class:"px-4 py-3 text-sm text-gray-700"},ro={class:"px-4 py-3 text-sm text-gray-700"},uo={class:"px-4 py-3 text-sm text-gray-700"},co={class:"px-4 py-3 text-right"},mo={class:"flex justify-end space-x-2"},vo=["onClick"],po=["onClick"],ho=["onClick"],go=["onClick"],yo=["onClick"],fo={key:3,class:"text-center py-4"},bo={__name:"ProjectTasksTab",props:{projectId:{type:Number,required:!0},projectUsers:{type:Array,default:()=>[]},canManageProjects:{type:Boolean,required:!0}},emits:["tasksUpdated","openTaskDetailSidebar","open-create-task-modal"],setup(l,{emit:t}){const s=l,n=t,i=k([]),a=k(!0),u=k(""),r=k(!1),m=k(null),c=k(!1),v=k(!1),g=k(null),w=k([]),C=k([]),D=k(!1),$=k(!1),y=ke({status:"",assigned_to_user_id:null,milestone_id:null,due_date_range:""}),f=[{value:"",label:"All Statuses"},{value:"To Do",label:"To Do"},{value:"In Progress",label:"In Progress"},{value:"Done",label:"Done"},{value:"Blocked",label:"Blocked"},{value:"Archived",label:"Archived"}],M=R(()=>{const F=[{value:null,label:"All Users"},{value:-1,label:"Unassigned"}];return F.push(...s.projectUsers.map(L=>({value:L.id,label:L.name}))),F}),V=R(()=>{const F=[{value:null,label:"All Milestones"},{value:-1,label:"No Milestone"}];return F.push(...C.value.map(L=>({value:L.id,label:L.name}))),F}),P=[{value:"",label:"All Dates"},{value:"today",label:"Due Today"},{value:"this_week",label:"Due This Week"},{value:"next_week",label:"Due Next Week"},{value:"overdue",label:"Overdue"},{value:"no_date",label:"No Due Date"}],U=R(()=>!C.value||!C.value.length?[]:[...C.value].sort((F,L)=>F.completion_date?L.completion_date?new Date(F.completion_date)-new Date(L.completion_date):-1:1)),T=R(()=>i.value.length?i.value.filter(F=>{if(y.status&&F.status!==y.status)return!1;if(y.assigned_to_user_id!==null){const L=parseInt(y.assigned_to_user_id);if(L===-1){if(F.assigned_to!=="Unassigned"&&F.assigned_to_id!==null)return!1}else if(F.assigned_to_id!==L)return!1}if(y.milestone_id!==null){const L=parseInt(y.milestone_id);if(L===-1){if(F.milestone_id)return!1}else if(F.milestone_id!==L)return!1}if(y.due_date_range){const L=new Date;L.setHours(0,0,0,0);const q=F.due_date?new Date(F.due_date):null;switch(y.due_date_range){case"today":if(!q||q.toDateString()!==L.toDateString())return!1;break;case"this_week":{if(!q)return!1;const ae=new Date(L);if(ae.setDate(L.getDate()+(6-L.getDay())),q<L||q>ae)return!1;break}case"next_week":{if(!q)return!1;const ae=new Date(L);ae.setDate(L.getDate()+(7-L.getDay()));const Pe=new Date(ae);if(Pe.setDate(ae.getDate()+6),q<ae||q>Pe)return!1;break}case"overdue":{if(!q||q>=L)return!1;break}case"no_date":{if(q)return!1;break}}}return!0}):[]),I=()=>{y.status="",y.assigned_to_user_id=null,y.milestone_id=null,y.due_date_range=""},b=async()=>{a.value=!0,u.value="";try{const F=await window.axios.get(`/api/projects/${s.projectId}/tasks`);i.value=F.data,n("tasksUpdated",i.value)}catch(F){u.value="Failed to load tasks data.",console.error("Error fetching project tasks:",F),F.response&&F.response.data&&F.response.data.message&&(u.value=F.response.data.message)}finally{a.value=!1}},_=async()=>{D.value=!0;try{const F=await window.axios.get("/api/task-types");w.value=F.data}catch(F){console.error("Error fetching task types:",F)}finally{D.value=!1}},x=async()=>{$.value=!0;try{const F=await window.axios.get(`/api/projects/${s.projectId}/milestones`);C.value=F.data}catch(F){console.error("Error fetching milestones:",F)}finally{$.value=!1}},j=()=>{n("open-create-task-modal")},Z=async F=>{m.value=F,await _(),await x(),r.value=!0},ie=()=>{b()},B=F=>{console.log("ProjectTasksTab: Emitting open-task-detail-sidebar for taskId:",F.id),n("openTaskDetailSidebar",F.id)},A=()=>{c.value=!0},S=F=>{C.value.push(F),b()},O=F=>{g.value=F,v.value=!0},z=()=>{b()},re=async F=>{try{await window.axios.post(`/api/tasks/${F.id}/complete`),await b()}catch(L){console.error("Error marking task as completed:",L),alert("Failed to mark task as completed. Please try again.")}},Me=async F=>{try{await window.axios.post(`/api/tasks/${F.id}/start`),await b()}catch(L){console.error("Error starting task:",L),alert("Failed to start task. Please try again.")}};return fe(()=>{b(),_(),x()}),de(()=>s.projectUsers,()=>{}),de(()=>s.taskTypes,()=>{}),de(()=>s.milestones,()=>{}),(F,L)=>(o(),d("div",$n,[e("div",Sn,[L[8]||(L[8]=e("h4",{class:"text-lg font-semibold text-gray-900"},"Project Tasks",-1)),e("div",Mn,[p(ye,{onClick:b,disabled:a.value,class:"text-indigo-600 hover:text-indigo-800"},{default:N(()=>[a.value?(o(),d("span",jn,"Loading...")):(o(),d("span",Tn,"Refresh"))]),_:1},8,["disabled"]),l.canManageProjects?(o(),X(ue,{key:0,class:"bg-indigo-600 hover:bg-indigo-700 transition-colors",onClick:j},{default:N(()=>L[7]||(L[7]=[H(" Add Task ",-1)])),_:1,__:[7]})):E("",!0)])]),e("div",Vn,[$.value?(o(),d("div",An," Loading milestones... ")):U.value.length?(o(),d("div",On,[L[13]||(L[13]=e("div",{class:"absolute h-1 bg-gray-200 top-1/2 left-0 right-0 transform -translate-y-1/2"},null,-1)),e("div",Ln,[(o(!0),d(J,null,Q(U.value,(q,ae)=>(o(),d("div",{key:q.id,class:ee(["flex flex-col items-center relative z-10",{"ml-4":ae===0,"mr-4":ae===U.value.length-1}])},[e("div",{class:ee(["w-6 h-6 rounded-full shadow-lg flex items-center justify-center",{"bg-gray-300":q.status==="Not Started","bg-blue-500":q.status==="In Progress","bg-green-500":q.status==="Completed","bg-red-500":q.status==="Overdue"}])},[q.status==="Completed"?(o(),d("svg",Un,L[10]||(L[10]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)]))):q.status==="In Progress"?(o(),d("svg",Nn,L[11]||(L[11]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 10V3L4 14h7v7l9-11h-7z"},null,-1)]))):q.status==="Overdue"?(o(),d("svg",Pn,L[12]||(L[12]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"},null,-1)]))):(o(),d("span",Rn))],2),e("div",Fn,[e("p",{class:"text-xs font-medium text-gray-700 text-center truncate",title:q.name},h(q.name),9,Bn)]),e("div",Hn,[e("p",Wn,h(q.completion_date?new Date(q.completion_date).toLocaleDateString():"No date"),1)])],2))),128))])])):(o(),d("div",In,L[9]||(L[9]=[e("p",{class:"text-gray-400 text-sm"},"No milestones found for this project.",-1)])))]),e("div",Yn,[e("div",zn,[e("div",qn,[p(Y,{for:"status-filter",value:"Status"}),p(he,{id:"status-filter",modelValue:y.status,"onUpdate:modelValue":L[0]||(L[0]=q=>y.status=q),options:f,"value-key":"value","label-key":"label",placeholder:"All Statuses",class:"mt-1"},null,8,["modelValue"])]),e("div",Gn,[p(Y,{for:"assigned-filter",value:"Assigned To"}),p(he,{id:"assigned-filter",modelValue:y.assigned_to_user_id,"onUpdate:modelValue":L[1]||(L[1]=q=>y.assigned_to_user_id=q),options:M.value,"value-key":"value","label-key":"label",placeholder:"All Users",class:"mt-1"},null,8,["modelValue","options"])]),e("div",Kn,[p(Y,{for:"milestone-filter",value:"Milestone"}),p(he,{id:"milestone-filter",modelValue:y.milestone_id,"onUpdate:modelValue":L[2]||(L[2]=q=>y.milestone_id=q),options:V.value,"value-key":"value","label-key":"label",placeholder:"All Milestones",class:"mt-1"},null,8,["modelValue","options"])]),e("div",Jn,[p(Y,{for:"due-date-filter",value:"Due Date"}),p(he,{id:"due-date-filter",modelValue:y.due_date_range,"onUpdate:modelValue":L[3]||(L[3]=q=>y.due_date_range=q),options:P,"value-key":"value","label-key":"label",placeholder:"All Dates",class:"mt-1"},null,8,["modelValue"])]),e("div",{class:"flex items-end"},[e("button",{type:"button",onClick:I,class:"px-3 py-2 text-sm text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-md transition-colors"}," Clear Filters ")])]),Object.values(y).some(q=>q!==null&&q!=="")?(o(),d("div",Zn,[e("p",null,[H(" Showing "+h(T.value.length)+" of "+h(i.value.length)+" tasks ",1),T.value.length===0?(o(),d("span",Xn," (No tasks match the current filters) ")):E("",!0)])])):E("",!0)]),a.value?(o(),d("div",Qn," Loading tasks... ")):u.value?(o(),d("div",eo,[e("p",to,h(u.value),1)])):i.value.length?(o(),d("div",so,[e("table",lo,[L[14]||(L[14]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Title"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Status"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Assigned To"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Due Date"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Milestone"),e("th",{class:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"Actions")])],-1)),e("tbody",ao,[(o(!0),d(J,null,Q(T.value,q=>(o(),d("tr",{key:q.id,class:"hover:bg-gray-50 transition-colors"},[e("td",io,h(q.title),1),e("td",no,[e("span",{class:ee({"px-2 py-1 rounded-full text-xs font-medium":!0,"bg-yellow-100 text-yellow-800":q.status==="To Do","bg-blue-100 text-blue-800":q.status==="In Progress","bg-green-100 text-green-800":q.status==="Done","bg-red-100 text-red-800":q.status==="Blocked","bg-gray-100 text-gray-800":q.status==="Archived"})},h(q.status),3)]),e("td",oo,h(q.assigned_to),1),e("td",ro,h(q.due_date?q.due_date:"N/A"),1),e("td",uo,h(q.milestone||"N/A"),1),e("td",co,[e("div",mo,[e("button",{onClick:ae=>B(q),class:"text-purple-600 hover:text-purple-800 text-sm font-medium"}," View ",8,vo),e("button",{onClick:ae=>Z(q),class:"text-indigo-600 hover:text-indigo-800 text-sm font-medium"}," Edit ",8,po),e("button",{onClick:ae=>O(q),class:"text-blue-600 hover:text-blue-800 text-sm font-medium"}," Add Note ",8,ho),q.status==="To Do"?(o(),d("button",{key:0,onClick:ae=>Me(q),class:"text-blue-600 hover:text-blue-800 text-sm font-medium"}," Start ",8,go)):E("",!0),q.status!=="Done"?(o(),d("button",{key:1,onClick:ae=>re(q),class:"text-green-600 hover:text-green-800 text-sm font-medium"}," Complete ",8,yo)):E("",!0)])])]))),128))])])])):(o(),d("div",fo,L[15]||(L[15]=[e("p",{class:"text-gray-400 text-sm"},"No tasks found for this project.",-1),e("p",{class:"text-gray-500 text-sm mt-2"},' Click the "Add Task" button to create a new task. ',-1)]))),p(En,{show:r.value,"project-id":l.projectId,"selected-task":m.value,"project-users":l.projectUsers,"task-types":w.value,milestones:C.value,"loading-task-types":D.value,"loading-milestones":$.value,onClose:L[4]||(L[4]=q=>r.value=!1),onSaved:ie,onOpenAddMilestoneModal:A},null,8,["show","project-id","selected-task","project-users","task-types","milestones","loading-task-types","loading-milestones"]),p(zt,{show:c.value,"project-id":l.projectId,onClose:L[5]||(L[5]=q=>c.value=!1),onSaved:S},null,8,["show","project-id"]),p(qt,{show:v.value,"task-for-note":g.value,onClose:L[6]||(L[6]=q=>v.value=!1),onNoteAdded:z},null,8,["show","task-for-note"])]))}},_o={class:"p-6"},wo={key:0,class:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4",role:"alert"},xo={class:"block sm:inline"},ko={class:"mb-4"},Do={class:"mb-6"},Co={class:"flex justify-end space-x-3"},Eo={__name:"InsertLinkModal",props:{show:{type:Boolean,default:!1}},emits:["close","insert"],setup(l,{emit:t}){const s=t,n=k(""),i=k(""),a=k(""),u=()=>{if(!n.value.trim()){a.value="Link text cannot be empty.";return}let m=i.value.trim();!m.startsWith("http://")&&!m.startsWith("https://")&&(m="http://"+m);try{new URL(m)}catch{a.value="Please enter a valid URL (e.g., https://example.com or www.example.com).";return}const c=`[${n.value.trim()}] {${m}}`;s("insert",c),r()},r=()=>{n.value="",i.value="",a.value="",s("close")};return(m,c)=>(o(),X(Se,{show:l.show,onClose:r,"max-width":"md"},{default:N(()=>[e("div",_o,[c[4]||(c[4]=e("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"Insert Link",-1)),a.value?(o(),d("div",wo,[e("span",xo,h(a.value),1)])):E("",!0),e("div",ko,[p(Y,{for:"link_text",value:"Link Text"}),p(oe,{id:"link_text",type:"text",class:"mt-1 block w-full",modelValue:n.value,"onUpdate:modelValue":c[0]||(c[0]=v=>n.value=v),onKeyup:Oe(u,["enter"])},null,8,["modelValue"])]),e("div",Do,[p(Y,{for:"link_url",value:"URL"}),p(oe,{id:"link_url",type:"text",class:"mt-1 block w-full",modelValue:i.value,"onUpdate:modelValue":c[1]||(c[1]=v=>i.value=v),placeholder:"e.g., https://www.example.com",onKeyup:Oe(u,["enter"])},null,8,["modelValue"])]),e("div",Co,[p(ye,{onClick:r},{default:N(()=>c[2]||(c[2]=[H("Cancel",-1)])),_:1,__:[2]}),p(ue,{onClick:u},{default:N(()=>c[3]||(c[3]=[H("Insert",-1)])),_:1,__:[3]})])])]),_:1},8,["show"]))}},$o={class:"p-6"},So={key:0,class:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4",role:"alert"},Mo={class:"block sm:inline"},To={class:"mb-4"},jo={class:"mb-6"},Vo={class:"flex justify-end space-x-3"},Ao={__name:"InsertListModal",props:{show:{type:Boolean,default:!1}},emits:["close","insert"],setup(l,{emit:t}){const s=t,n=k(""),i=k("bullet"),a=k(""),u=()=>{const m=n.value.split(`
`).map(g=>g.trim()).filter(g=>g!=="");if(m.length===0){a.value="Please enter at least one list item.";return}const c=i.value==="bullet"?"ul":"ol";let v=`<${c}>`;m.forEach(g=>{v+=`<li>${g}</li>`}),v+=`</${c}>`,s("insert",v),r()},r=()=>{n.value="",i.value="bullet",a.value="",s("close")};return(m,c)=>(o(),X(Se,{show:l.show,onClose:r,"max-width":"md"},{default:N(()=>[e("div",$o,[c[5]||(c[5]=e("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"Insert List",-1)),a.value?(o(),d("div",So,[e("span",Mo,h(a.value),1)])):E("",!0),e("div",To,[p(Y,{for:"list_items",value:"List Items (one per line)"}),me(e("textarea",{id:"list_items",rows:"6",class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full","onUpdate:modelValue":c[0]||(c[0]=v=>n.value=v),placeholder:"Enter each list item on a new line"},null,512),[[be,n.value]])]),e("div",jo,[p(Y,{for:"list_type",value:"List Type"}),me(e("select",{id:"list_type",class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full","onUpdate:modelValue":c[1]||(c[1]=v=>i.value=v)},c[2]||(c[2]=[e("option",{value:"bullet"},"Bulleted List",-1),e("option",{value:"numbered"},"Numbered List",-1)]),512),[[We,i.value]])]),e("div",Vo,[p(ye,{onClick:r},{default:N(()=>c[3]||(c[3]=[H("Cancel",-1)])),_:1,__:[3]}),p(ue,{onClick:u},{default:N(()=>c[4]||(c[4]=[H("Insert List",-1)])),_:1,__:[4]})])])]),_:1},8,["show"]))}};function xt(l){const t=i=>{const a=/\[([^\]]+?)\][\s\u00A0]*\{([^}]+?)\}/g;return i.replace(a,(u,r,m)=>{let c=m.trim();return!c.startsWith("http://")&&!c.startsWith("https://")&&(c=`https://${c}`),`<a href="${c}" target="_blank" style="color: #1a73e8; text-decoration: underline;">${r.trim()}</a>`})},s=i=>{const a=/<(ul|ol)>(.*?)<\/(ul|ol)>/gs;return i.replace(a,(u,r,m)=>{const c=r,v=c==="ul"?"list-style-type: disc;":"list-style-type: decimal;",g=/<li>(.*?)<\/li>/gs,w=m.replace(g,(C,D)=>`<li style="margin-bottom: 5px; font-family: 'Inter', sans-serif; font-size: 16px; line-height: 1.6; color: #1a202c;">${D}</li>`);return`<${c} style="margin: 0; padding: 0 0 0 20px; ${v}">${w}</${c}>`})};return{processedHtmlBody:R(()=>{let i=l.value;return i=t(i),i=s(i),i})}}const Io={key:0},Oo={class:"mb-4"},Lo={class:"mb-6"},Uo={class:"mb-2 flex justify-end space-x-2"},No={key:0,class:"min-h-[300px] flex items-center justify-center bg-gray-50 rounded-md"},Po={key:1},Ro={key:0,class:"text-red-500 mb-2"},Fo={class:"mb-2 flex justify-end space-x-2"},Bo={key:1},Ho={class:"mb-6"},Wo={__name:"EmailActionModal",props:{show:{type:Boolean,default:!1},title:{type:String,required:!0},apiEndpoint:{type:String,required:!0},httpMethod:{type:String,default:"post"},submitButtonText:{type:String,default:"Save"},successMessage:{type:String,default:"Operation successful!"},emailId:{type:Number,required:!1},projectId:{type:Number,required:!0}},emits:["close","submitted","error","fetchEmails"],setup(l,{emit:t}){const s=l,n=t,i=ke({}),a=k(!1),u=k(!1),r=async()=>{if(s.emailId){u.value=!0;try{for(const x in i)delete i[x];if(s.title==="Reject Email"){Object.assign(i,{rejection_reason:""}),u.value=!1;return}const _=(await window.axios.get(`/api/emails/${s.emailId}/edit-content`)).data;_.body_html&&!_.body&&(_.body=_.body_html),Object.assign(i,_),console.log("Fetched email data:",i)}catch(b){console.error("Failed to fetch email data:",b),n("error",b)}finally{u.value=!1}}};de(()=>s.show,b=>{b&&s.emailId&&r()});const m=k(!1),c=k(!1),v=R(()=>(console.log("editorBodyContent computed property called"),console.log("Using localFormData.body:",i.body),i.body||"")),{processedHtmlBody:g}=xt(v),w=b=>{const _={...b};return s.title==="Edit and Approve Email"&&(_.body=g.value),_},C=()=>{console.log("EmailActionModal is closing"),n("close")},D=b=>{n("submitted",b)},$=b=>{n("error",b)},y=()=>{m.value=!0},f=b=>{i.body+=b,m.value=!1},M=()=>{c.value=!0},V=b=>{i.body+=b,c.value=!1},P=k({}),U=k(!1),T=async()=>{U.value=!0;try{console.log("Saving email with ID:",s.emailId),console.log("Email data:",{subject:i.subject,body:i.body}),await window.axios.post(`/api/emails/${s.emailId}/update`,{subject:i.subject,body:i.body}),console.log("Email saved successfully"),alert("Email saved successfully!"),U.value=!1,n("fetchEmails"),C()}catch(b){U.value=!1,console.error("Error saving email:",b);let _="Failed to save email.";b.response&&b.response.data.message&&(_=b.response.data.message),P.value=_,alert(_)}},I=()=>{if(s.emailId){const b=`/emails/${s.emailId}/preview`;window.open(b,"_blank")}else console.warn("Cannot preview email: Email ID not available.")};return(b,_)=>(o(),d(J,null,[p(Ce,{show:l.show,title:l.title,"api-endpoint":l.apiEndpoint,"http-method":l.httpMethod,"form-data":i,"submit-button-text":l.submitButtonText,"success-message":l.successMessage,"format-data-for-api":w,onClose:C,onSubmitted:D,onError:$,"max-width":"3xl"},{default:N(({errors:x})=>[l.title==="Edit and Approve Email"?(o(),d("div",Io,[e("div",Oo,[p(Y,{for:"edit_subject",value:"Subject"}),p(oe,{id:"edit_subject",type:"text",class:"mt-1 block w-full",modelValue:i.subject,"onUpdate:modelValue":_[0]||(_[0]=j=>i.subject=j),required:""},null,8,["modelValue"]),p(le,{message:x.subject?x.subject[0]:"",class:"mt-2"},null,8,["message"])]),e("div",Lo,[e("div",Uo,[p(ye,{type:"button",onClick:M},{default:N(()=>_[5]||(_[5]=[H(" Insert List ",-1)])),_:1,__:[5]}),p(ye,{type:"button",onClick:y},{default:N(()=>_[6]||(_[6]=[H(" Insert Link ",-1)])),_:1,__:[6]})]),p(Y,{for:"edit_body",value:"Email Body",class:"sr-only"}),a.value?(o(),d("div",No,_[7]||(_[7]=[e("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-500"},null,-1)]))):(o(),d("div",Po,[v.value?E("",!0):(o(),d("div",Ro,"Warning: Email body content is empty!")),p(bt,{id:"edit_body",modelValue:i.body,"onUpdate:modelValue":_[1]||(_[1]=j=>i.body=j),value:v.value,placeholder:"Edit your email here...",height:"300px"},null,8,["modelValue","value"])])),p(le,{message:x.body?x.body[0]:"",class:"mt-2"},null,8,["message"])]),e("div",Fo,[p(ue,{type:"button",disabled:U.value,onClick:T},{default:N(()=>[H(h(U.value?"Saving...":"Save"),1)]),_:1},8,["disabled"]),p(ye,{type:"button",onClick:I},{default:N(()=>_[8]||(_[8]=[H(" Preview Email ",-1)])),_:1,__:[8]})])])):l.title==="Reject Email"?(o(),d("div",Bo,[e("div",Ho,[p(Y,{for:"rejection_reason",value:"Rejection Reason"}),me(e("textarea",{id:"rejection_reason",rows:"5",class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full","onUpdate:modelValue":_[2]||(_[2]=j=>i.rejection_reason=j),required:"",placeholder:"Please provide a reason for rejecting this email (minimum 10 characters)"},null,512),[[be,i.rejection_reason]]),p(le,{message:x.rejection_reason?x.rejection_reason[0]:"",class:"mt-2"},null,8,["message"])])])):E("",!0)]),_:1},8,["show","title","api-endpoint","http-method","form-data","submit-button-text","success-message"]),p(Eo,{show:m.value,onClose:_[3]||(_[3]=x=>m.value=!1),onInsert:f},null,8,["show"]),p(Ao,{show:c.value,onClose:_[4]||(_[4]=x=>c.value=!1),onInsert:V},null,8,["show"])],64))}},Yo=Ee(Wo,[["__scopeId","data-v-e68fe9d9"]]);function zo(l){const t=Ue();return{userSignature:R(()=>{const n=t.value&&t.value.name?t.value.name:"",i=l.name??"",a="+61 456 639 389",u="ozeeweb.com.au",r="#1a73e8",m="#fbbc05",c="#1a202c",v="#4a5568",g="#e5e7eb",w="#f9fafb",C=`${window.location.origin}/logo.png`,D=`https://img.icons8.com/ios-filled/20/${r.substring(1)}/facebook-new.png`,$=`https://img.icons8.com/ios-filled/20/${r.substring(1)}/twitter.png`,y=`https://img.icons8.com/ios-filled/20/${r.substring(1)}/linkedin.png`,f=`https://img.icons8.com/ios-filled/20/${r.substring(1)}/instagram-new.png`;return`
            <div style="font-family: 'Inter', sans-serif; padding: 20px; border: 1px solid ${g}; margin-top: 30px; background-color: ${w}; border-radius: 8px; overflow: hidden; box-shadow: 0 0 0 3px ${m};">
                <table role="presentation" cellspacing="0" cellpadding="0" width="100%">
                    <tr>
                        <td style="vertical-align: middle;">
                            <p style="margin: 0; font-size: 18px; color: ${c};">Best Regards</p>
                            <p style="margin: 0; font-size: 18px; font-weight: bold; color: ${c};">${n}</p>
                            <p style="margin: 5px 0 5px 0; font-size: 14px; color: ${v};">${i}</p>
                            <p style="margin: 0 0 15px 0; font-size: 12px; color: ${v};">
                                Your website and social media are like your home, first impressions matter!
                            </p>
                            <table role="presentation" cellspacing="0" cellpadding="0">
                                <tr>
                                    <td style="padding-right: 15px;">
                                        <p style="margin: 0; font-size: 13px; color: ${v};">📞 ${a}</p>
                                        <p style="margin: 5px 0 0 0; font-size: 13px; color: ${v};">🌐 <a href="https://${u}" target="_blank" style="color: ${r}; text-decoration: none;">${u}</a></p>
                                    </td>
                                </tr>
                            </table>
                            <div style="margin-top: 15px; text-align: left;">
                                <a href="https://www.facebook.com/yourprofile" target="_blank" style="display: inline-block; margin-right: 8px; color: ${r}; text-decoration: none;">
                                    <img src="${D}" alt="Facebook" style="vertical-align: middle;">
                                </a>
                                <a href="https://twitter.com/yourhandle" target="_blank" style="display: inline-block; margin-right: 8px; color: ${r}; text-decoration: none;">
                                    <img src="${$}" alt="Twitter" style="vertical-align: middle;">
                                </a>
                                <a href="https://www.linkedin.com/in/yourprofile" target="_blank" style="display: inline-block; margin-right: 8px; color: ${r}; text-decoration: none;">
                                    <img src="${y}" alt="LinkedIn" style="vertical-align: middle;">
                                </a>
                                <a href="https://www.instagram.com/yourprofile" target="_blank" style="display: inline-block; margin-right: 8px; color: ${r}; text-decoration: none;">
                                    <img src="${f}" alt="Instagram" style="vertical-align: middle;">
                                </a>
                            </div>
                        </td>
                        <td style="padding-left: 20px; vertical-align: middle; width: 120px; text-align: right;">
                            <img src="${C}" alt="Company Logo" width="100" style="display: block; border-radius: 8px; margin-left: auto;">
                        </td>
                    </tr>
                </table>

                <p style="margin-top: 25px; font-size: 12px; color: ${v}; text-align: center;">
                    Powered by MMS IT & Web Solutions PTY Ltd.
                </p>
                <p style="margin-top: 10px; font-style: italic; color: ${v}; text-align: center; font-size: 13px;">
                    Please consider the environment before printing this email.
                </p>
                <p style="margin-top: 10px; text-align: center; font-size: 13px;">
                    How did I do? <a href="https://www.example.com/review" target="_blank" style="color: ${r}; text-decoration: none; font-weight: bold;">Leave a review!</a>
                </p>
            </div>
        `})}}const qo={class:"mb-4"},Go={key:0,class:"text-gray-500 text-sm"},Ko={key:1,class:"text-red-500 text-sm"},Jo={class:"mb-4"},Zo={class:"mb-6"},Xo={class:"mb-2 flex justify-end space-x-2"},Qo={class:"mb-4"},er={key:0,class:"mt-2"},tr={class:"text-gray-700 text-base mb-2"},sr=["innerHTML"],lr={class:"p-6"},ar={key:0,class:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4",role:"alert"},ir={class:"block sm:inline"},nr={class:"mb-4"},or={class:"mb-6"},rr={class:"flex justify-end space-x-3"},dr={class:"p-6"},ur={key:0,class:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4",role:"alert"},cr={class:"block sm:inline"},mr={class:"mb-4"},vr={class:"mb-6"},pr={class:"flex justify-end space-x-3"},hr={__name:"ComponseEmailModal",props:{show:{type:Boolean,default:!1},projectId:{type:Number,required:!0},userProjectRole:{type:Object,required:!0}},emits:["close","submitted","error"],setup(l,{emit:t}){const s=l,n=t,i=ke({project_id:s.projectId,client_ids:[],subject:"",body:"",status:"pending_approval"}),a=k([]),u=k(!0),r=k(""),m=k(!1),c=k(""),v=k(""),g=k(""),w=k(!1),C=k(""),D=k("bullet"),$=k(""),y=k("full_name"),f=k(""),M=k([{value:"full_name",label:"Full Name"},{value:"first_name",label:"First Name"},{value:"last_name",label:"Last Name"},{value:"custom",label:"Custom"}]),{userSignature:V}=zo(R(()=>s.userProjectRole)),P=R(()=>i.body||""),{processedHtmlBody:U}=xt(P),T=R(()=>{if(i.client_ids&&i.client_ids.length>0){const S=i.client_ids[0],O=a.value.find(z=>z.id===S);if(O){const z=O.name.split(" ").filter(F=>F.length>0),re=z.length>0?z[0]:"",Me=z.length>1?z[z.length-1]:"";switch(y.value){case"full_name":return`Hi ${O.name},`;case"first_name":return`Hi ${re},`;case"last_name":return`Hi ${Me},`;case"custom":return`Hi ${f.value.trim()||"there"},`;default:return`Hi ${O.name},`}}}return"Hi there,"});de(()=>s.show,S=>{S&&(Object.assign(i,{project_id:s.projectId,client_ids:[],subject:"",body:"",status:"pending_approval"}),y.value="full_name",f.value="",r.value="",A())},{immediate:!0});const I=S=>{const O={...S};return O.client_ids&&Array.isArray(O.client_ids)&&(O.client_ids=O.client_ids.map(z=>({id:z}))),O.body=U.value,O.greeting_name=T.value,O.custom_greeting_name=f.value.trim(),O.first_client_id=i.client_ids&&i.client_ids.length>0?i.client_ids[0]:null,O},b=()=>{n("close")},_=S=>{n("submitted",S)},x=S=>{n("error",S)},j=()=>{c.value="",v.value="",g.value="",m.value=!0},Z=()=>{if(!c.value.trim()){g.value="Link text cannot be empty.";return}let S=v.value.trim();!S.startsWith("http://")&&!S.startsWith("https://")&&(S="http://"+S);try{new URL(S)}catch{g.value="Please enter a valid URL (e.g., https://example.com or www.example.com).";return}const O=`[${c.value.trim()}] {${S}}`;i.body+=O,m.value=!1,c.value="",v.value="",g.value=""},ie=()=>{C.value="",D.value="bullet",$.value="",w.value=!0},B=()=>{const S=C.value.split(`
`).map(re=>re.trim()).filter(re=>re!=="");if(S.length===0){$.value="Please enter at least one list item.";return}const O=D.value==="bullet"?"ul":"ol";let z=`<${O}>`;S.forEach(re=>{z+=`<li>${re}</li>`}),z+=`</${O}>`,i.body+=z,w.value=!1,C.value="",$.value=""},A=async()=>{var S,O;u.value=!0,r.value=null;try{const z=await window.axios.get(`/api/projects/${s.projectId}/sections/clients?type=clients`);a.value=z.data}catch(z){console.error("Failed to fetch project clients:",z),r.value=((O=(S=z.response)==null?void 0:S.data)==null?void 0:O.message)||"Failed to load client data."}finally{u.value=!1}};return fe(()=>{}),(S,O)=>(o(),d(J,null,[p(Ce,{show:l.show,title:"Compose New Email","api-endpoint":"/api/emails","http-method":"post","form-data":i,"submit-button-text":"Submit for Approval","success-message":"Email submitted for approval successfully!","format-data-for-api":I,onClose:b,onSubmitted:_,onError:x,"max-width":"3xl"},{default:N(({errors:z})=>[e("div",qo,[p(Y,{for:"client_ids",value:"To (Clients)"}),u.value?(o(),d("div",Go,"Loading clients...")):r.value?(o(),d("div",Ko,h(r.value),1)):(o(),X(Le,{key:2,modelValue:i.client_ids,"onUpdate:modelValue":O[0]||(O[0]=re=>i.client_ids=re),options:a.value,placeholder:"Select one or more clients","label-key":"name","value-key":"id"},null,8,["modelValue","options"])),p(le,{message:z.client_ids?z.client_ids[0]:"",class:"mt-2"},null,8,["message"])]),e("div",Jo,[p(Y,{for:"subject",value:"Subject"}),p(oe,{id:"subject",type:"text",class:"mt-1 block w-full",modelValue:i.subject,"onUpdate:modelValue":O[1]||(O[1]=re=>i.subject=re),required:""},null,8,["modelValue"]),p(le,{message:z.subject?z.subject[0]:"",class:"mt-2"},null,8,["message"])]),e("div",Zo,[e("div",Xo,[p(ye,{type:"button",onClick:ie},{default:N(()=>O[13]||(O[13]=[H(" Insert List ",-1)])),_:1,__:[13]}),p(ye,{type:"button",onClick:j},{default:N(()=>O[14]||(O[14]=[H(" Insert Link ",-1)])),_:1,__:[14]})]),e("div",Qo,[p(Y,{for:"greeting_type",value:"Address Client By"}),p(he,{id:"greeting_type",modelValue:y.value,"onUpdate:modelValue":O[2]||(O[2]=re=>y.value=re),options:M.value,"value-key":"value","label-key":"label",class:"mt-1 block w-full"},null,8,["modelValue","options"]),y.value==="custom"?(o(),d("div",er,[p(Y,{for:"custom_greeting_name",value:"Custom Name"}),p(oe,{id:"custom_greeting_name",type:"text",class:"mt-1 block w-full",modelValue:f.value,"onUpdate:modelValue":O[3]||(O[3]=re=>f.value=re),placeholder:"e.g., Azaan"},null,8,["modelValue"])])):E("",!0)]),e("p",tr,h(T.value),1),p(Y,{for:"body",value:"Email Body",class:"sr-only"}),p(bt,{id:"body",modelValue:i.body,"onUpdate:modelValue":O[4]||(O[4]=re=>i.body=re),placeholder:"Compose your email here...",height:"300px"},null,8,["modelValue"]),p(le,{message:z.body?z.body[0]:"",class:"mt-2"},null,8,["message"])]),K(V)?(o(),d("div",{key:0,class:"unselectable-signature",innerHTML:K(V)},null,8,sr)):E("",!0)]),_:1},8,["show","form-data"]),p(Se,{show:m.value,onClose:O[8]||(O[8]=z=>m.value=!1),"max-width":"md"},{default:N(()=>[e("div",lr,[O[17]||(O[17]=e("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"Insert Link",-1)),g.value?(o(),d("div",ar,[e("span",ir,h(g.value),1)])):E("",!0),e("div",nr,[p(Y,{for:"link_text",value:"Link Text"}),p(oe,{id:"link_text",type:"text",class:"mt-1 block w-full",modelValue:c.value,"onUpdate:modelValue":O[5]||(O[5]=z=>c.value=z),onKeyup:Oe(Z,["enter"])},null,8,["modelValue"])]),e("div",or,[p(Y,{for:"link_url",value:"URL"}),p(oe,{id:"link_url",type:"text",class:"mt-1 block w-full",modelValue:v.value,"onUpdate:modelValue":O[6]||(O[6]=z=>v.value=z),placeholder:"e.g., https://www.example.com",onKeyup:Oe(Z,["enter"])},null,8,["modelValue"])]),e("div",rr,[p(ye,{onClick:O[7]||(O[7]=z=>m.value=!1)},{default:N(()=>O[15]||(O[15]=[H("Cancel",-1)])),_:1,__:[15]}),p(ue,{onClick:Z},{default:N(()=>O[16]||(O[16]=[H("Insert",-1)])),_:1,__:[16]})])])]),_:1},8,["show"]),p(Se,{show:w.value,onClose:O[12]||(O[12]=z=>w.value=!1),"max-width":"md"},{default:N(()=>[e("div",dr,[O[21]||(O[21]=e("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"Insert List",-1)),$.value?(o(),d("div",ur,[e("span",cr,h($.value),1)])):E("",!0),e("div",mr,[p(Y,{for:"list_items",value:"List Items (one per line)"}),me(e("textarea",{id:"list_items",rows:"6",class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full","onUpdate:modelValue":O[9]||(O[9]=z=>C.value=z),placeholder:"Enter each list item on a new line"},null,512),[[be,C.value]])]),e("div",vr,[p(Y,{for:"list_type",value:"List Type"}),me(e("select",{id:"list_type",class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full","onUpdate:modelValue":O[10]||(O[10]=z=>D.value=z)},O[18]||(O[18]=[e("option",{value:"bullet"},"Bulleted List",-1),e("option",{value:"numbered"},"Numbered List",-1)]),512),[[We,D.value]])]),e("div",pr,[p(ye,{onClick:O[11]||(O[11]=z=>w.value=!1)},{default:N(()=>O[19]||(O[19]=[H("Cancel",-1)])),_:1,__:[19]}),p(ue,{onClick:B},{default:N(()=>O[20]||(O[20]=[H("Insert List",-1)])),_:1,__:[20]})])])]),_:1},8,["show"])],64))}},kt=Ee(hr,[["__scopeId","data-v-70bf1503"]]),gr={class:"mb-4"},yr={class:"grid grid-cols-1 sm:grid-cols-2 gap-6 mt-4"},fr={key:2},br={key:0,class:"text-gray-500 text-sm mt-1"},_r={class:"mt-6"},wr={class:"flex justify-between items-center mb-3"},xr=["innerHTML"],kr={__name:"EditTemplateEmailModal",props:{show:Boolean,title:String,apiEndpoint:String,httpMethod:{type:String,default:"post"},submitButtonText:String,successMessage:String,emailId:Number,projectId:Number,clientId:{type:Number,default:null}},emits:["close","submitted","error"],setup(l,{expose:t,emit:s}){const n=l,i=s,a=ke({subject:"",template_id:null,template_data:{}}),u=k([]),r=k({}),m=k(!1),c=k(""),v=k(!1),g=R(()=>u.value.find(T=>T.id===a.template_id)),w=R(()=>g.value?g.value.placeholders.filter(T=>T.is_dynamic||T.is_repeatable||T.is_selectable):[]),C=async()=>{try{const T=await window.axios.get("/api/email-templates");u.value=T.data}catch(T){console.error("Failed to fetch email templates:",T)}},D=async T=>{if(!(!T||!T.placeholders)){m.value=!0,r.value={};try{const I=T.placeholders.filter(x=>(x.is_selectable||x.is_repeatable)&&x.source_model);if(I.length===0){m.value=!1;return}const b={};I.forEach(x=>{b[x.source_model]||(b[x.source_model]=[]),b[x.source_model].push(x)});const _=Object.keys(b).map(async x=>{try{const j=await window.axios.get(`/api/source-models/${encodeURIComponent(x)}`);b[x].forEach(Z=>{r.value[Z.name]=j.data.map(ie=>({id:ie.id,label:ie[Z.source_attribute]||ie.name||`ID: ${ie.id}`}))})}catch(j){console.error(`Failed to fetch data for model ${x}:`,j),b[x].forEach(Z=>{r.value[Z.name]=[]})}});await Promise.all(_)}catch(I){console.error("Error fetching source models data:",I)}finally{m.value=!1}}},$=async T=>{if(Object.assign(a,{subject:"",template_id:null,template_data:{}}),c.value="",r.value={},T.template_id){await C(),a.subject=T.subject,a.template_id=T.template_id,a.template_data=T.template_data||{};const I=u.value.find(b=>b.id===a.template_id);I&&await D(I),f()}else console.error("This modal is only for template-based emails")};t({setData:$});const y=T=>{const I={...T};if(I.composition_type="template",typeof I.template_data=="object"&&I.template_data!==null){const b=u.value.find(_=>_.id===I.template_id);if(b&&b.placeholders){const _={};b.placeholders.forEach(x=>{const j=x.name,Z=I.template_data[j];Z!=null&&(x.is_repeatable&&Array.isArray(Z)||x.is_selectable,_[j]=Z)}),I.template_data=_}}else if(typeof I.template_data=="string")try{I.template_data=JSON.parse(I.template_data)}catch(b){console.error("Error parsing template_data:",b),I.template_data={}}else I.template_data={};return I},f=async()=>{v.value=!0;try{const T={},I=u.value.find(x=>x.id===a.template_id);I&&I.placeholders?I.placeholders.forEach(x=>{const j=x.name,Z=a.template_data[j];Z!=null&&(x.is_repeatable&&Array.isArray(Z)||x.is_selectable,T[j]=Z)}):Object.assign(T,a.template_data);const b={template_id:a.template_id,template_data:T};n.clientId&&(b.client_id=n.clientId);const _=await window.axios.post(`/api/projects/${n.projectId}/email-preview`,b);c.value=_.data.body_html,a.subject=_.data.subject}catch(T){console.error("Error fetching preview:",T),c.value='<p class="text-red-500 italic">Error loading preview.</p>'}finally{v.value=!1}},M=()=>{i("close")},V=T=>{i("submitted",T)},P=T=>{i("error",T)};de(()=>n.show,T=>{T&&n.emailId&&U()});const U=async()=>{if(n.emailId)try{const I=(await window.axios.get(`/api/emails/${n.emailId}/edit-content`)).data;if(!I.template_id){console.error("This email does not use a template"),i("close");return}await $(I)}catch(T){console.error("Failed to fetch email data:",T),i("error",T)}};return fe(()=>{C()}),(T,I)=>(o(),X(Ce,{show:l.show,title:l.title,"api-endpoint":l.apiEndpoint,"http-method":l.httpMethod,"form-data":a,"submit-button-text":l.submitButtonText,"success-message":l.successMessage,"format-data-for-api":y,onClose:M,onSubmitted:V,onError:P,"max-width":"4xl"},{default:N(({errors:b})=>[e("div",gr,[p(Y,{for:"edit_subject",value:"Subject"}),p(oe,{id:"edit_subject",type:"text",class:"mt-1 block w-full",modelValue:a.subject,"onUpdate:modelValue":I[0]||(I[0]=_=>a.subject=_),required:""},null,8,["modelValue"]),p(le,{message:b.subject?b.subject[0]:"",class:"mt-2"},null,8,["message"])]),e("div",null,[I[2]||(I[2]=e("h4",{class:"text-md font-semibold text-gray-800 mb-3 border-b pb-2"},"Editing Template Fields",-1)),e("div",yr,[(o(!0),d(J,null,Q(w.value,_=>(o(),d("div",{key:_.id},[p(Y,{for:_.name,value:_.name},null,8,["for","value"]),_.is_dynamic&&!_.is_selectable&&!_.is_repeatable?(o(),X(oe,{key:0,type:"text",class:"mt-1 block w-full",modelValue:a.template_data[_.name],"onUpdate:modelValue":x=>a.template_data[_.name]=x},null,8,["modelValue","onUpdate:modelValue"])):_.is_selectable?(o(),X(he,{key:1,id:_.name,modelValue:a.template_data[_.name],"onUpdate:modelValue":x=>a.template_data[_.name]=x,options:r.value[_.name]||[],"value-key":"id","label-key":"label",class:"mt-1 block w-full",disabled:m.value},null,8,["id","modelValue","onUpdate:modelValue","options","disabled"])):_.is_repeatable?(o(),d("div",fr,[m.value?(o(),d("div",br,"Loading options...")):(o(),X(Le,{key:1,modelValue:a.template_data[_.name],"onUpdate:modelValue":x=>a.template_data[_.name]=x,options:r.value[_.name]||[],placeholder:`Select ${_.name}`,"label-key":"label","value-key":"id",class:"mt-1"},null,8,["modelValue","onUpdate:modelValue","options","placeholder"]))])):(o(),X(oe,{key:3,type:"text",class:"mt-1 block w-full",modelValue:a.template_data[_.name],"onUpdate:modelValue":x=>a.template_data[_.name]=x},null,8,["modelValue","onUpdate:modelValue"])),p(le,{message:b[`template_data.${_.name}`]?b[`template_data.${_.name}`][0]:"",class:"mt-2"},null,8,["message"])]))),128))]),e("div",_r,[e("div",wr,[I[1]||(I[1]=e("h4",{class:"text-md font-semibold text-gray-800"},"Email Preview",-1)),p(ue,{onClick:f,disabled:v.value},{default:N(()=>[H(h(v.value?"Loading...":"Refresh Preview"),1)]),_:1},8,["disabled"])]),e("div",{class:"bg-gray-100 p-4 rounded-lg shadow-inner min-h-[300px]",innerHTML:c.value},null,8,xr)])])]),_:1},8,["show","title","api-endpoint","http-method","form-data","submit-button-text","success-message"]))}},Dr={class:"p-6"},Cr={key:0,class:"space-y-4"},Er={class:"border-b pb-4"},$r={class:"text-xl font-medium text-gray-900 mb-2"},Sr={class:"grid grid-cols-2 gap-4 text-sm"},Mr={class:"text-gray-600"},Tr={class:"text-gray-900"},jr={class:"text-gray-600 mt-1"},Vr={class:"text-gray-600"},Ar={class:"text-gray-900"},Ir={class:"prose max-w-none"},Or=["innerHTML"],Lr={key:0,class:"mt-4 p-4 bg-red-50 rounded-md"},Ur={class:"text-red-700"},Nr={key:1,class:"mt-4 text-sm text-gray-600"},Pr={key:0},Rr={key:2,class:"mt-6 flex justify-end space-x-2"},Fr={__name:"EmailDetailsModal",props:{show:{type:Boolean,required:!0},email:{type:Object,required:!0},canApproveEmails:{type:Boolean,required:!0}},emits:["close","edit","reject"],setup(l,{emit:t}){const s=l,n=t,i=()=>{n("close")},a=()=>{n("edit",s.email)},u=()=>{n("reject",s.email)};return(r,m)=>(o(),X(Se,{show:l.show,onClose:i},{default:N(()=>{var c;return[e("div",Dr,[e("div",{class:"flex justify-between items-center mb-4"},[m[1]||(m[1]=e("h3",{class:"text-lg font-semibold text-gray-900"},"Email Details",-1)),e("button",{onClick:i,class:"text-gray-400 hover:text-gray-500"},m[0]||(m[0]=[e("svg",{class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),l.email?(o(),d("div",Cr,[e("div",Er,[e("h4",$r,h(l.email.subject),1),e("div",Sr,[e("div",null,[e("p",Mr,[m[2]||(m[2]=H("From: ",-1)),e("span",Tr,h(((c=l.email.sender)==null?void 0:c.name)||"N/A"),1)]),e("p",jr,[m[3]||(m[3]=H("Status: ",-1)),e("span",{class:ee({"px-2 py-1 rounded-full text-xs font-medium":!0,"bg-green-100 text-green-800":l.email.status==="sent","bg-yellow-100 text-yellow-800":l.email.status==="pending_approval","bg-red-100 text-red-800":l.email.status==="rejected","bg-gray-100 text-gray-800":l.email.status==="draft"})},h(l.email.status?l.email.status.replace("_"," ").toUpperCase():"N/A"),3)])]),e("div",null,[e("p",Vr,[m[4]||(m[4]=H("Date: ",-1)),e("span",Ar,h(new Date(l.email.created_at).toLocaleString()),1)])])])]),e("div",Ir,[e("div",{innerHTML:l.email.body},null,8,Or)]),l.email.rejection_reason?(o(),d("div",Lr,[m[5]||(m[5]=e("h5",{class:"font-medium text-red-800"},"Rejection Reason:",-1)),e("p",Ur,h(l.email.rejection_reason),1)])):E("",!0),l.email.approver?(o(),d("div",Nr,[e("p",null,"Approved/Rejected by: "+h(l.email.approver.name),1),l.email.sent_at?(o(),d("p",Pr,"Sent at: "+h(new Date(l.email.sent_at).toLocaleString()),1)):E("",!0)])):E("",!0),(l.email.status==="pending_approval"||l.email.status==="pending_approval_received")&&l.canApproveEmails?(o(),d("div",Rr,[p(ue,{onClick:a,class:"bg-blue-600 hover:bg-blue-700"},{default:N(()=>m[6]||(m[6]=[H("Edit & Approve",-1)])),_:1,__:[6]}),p(ye,{onClick:u,class:"text-red-600 hover:text-red-800"},{default:N(()=>m[7]||(m[7]=[H("Reject",-1)])),_:1,__:[7]})])):E("",!0)])):E("",!0)])]}),_:1},8,["show"]))}},Br={key:0,class:"text-center text-gray-600 text-sm animate-pulse py-4"},Hr={key:1,class:"text-center text-red-600 text-sm font-medium py-4"},Wr={key:2,class:"overflow-x-auto"},Yr={class:"min-w-full divide-y divide-gray-200"},zr={class:"bg-white divide-y divide-gray-200"},qr={class:"px-4 py-3 text-sm text-gray-900"},Gr={class:"px-4 py-3 text-sm text-gray-700"},Kr={class:"px-4 py-3 text-sm text-gray-700"},Jr={class:"px-4 py-3 text-sm text-gray-700"},Zr={class:"px-4 py-3 text-sm text-gray-700"},Xr={class:"px-4 py-3 text-right"},Qr={key:3,class:"text-gray-400 text-sm"},ed={__name:"EmailList",props:{emails:{type:Array,required:!0},loading:{type:Boolean,default:!1},error:{type:String,default:""}},emits:["view"],setup(l,{emit:t}){const s=t,n=i=>{s("view",i)};return(i,a)=>(o(),d("div",null,[l.loading?(o(),d("div",Br," Loading email data... ")):l.error?(o(),d("div",Hr,h(l.error),1)):l.emails.length?(o(),d("div",Wr,[e("table",Yr,[a[1]||(a[1]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Subject"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"From"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Date"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Type"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Status"),e("th",{class:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"Actions")])],-1)),e("tbody",zr,[(o(!0),d(J,null,Q(l.emails,u=>{var r;return o(),d("tr",{key:u.id,class:"hover:bg-gray-50 transition-colors"},[e("td",qr,h(u.subject),1),e("td",Gr,h(((r=u.sender)==null?void 0:r.name)||"N/A"),1),e("td",Kr,h(new Date(u.created_at).toLocaleDateString()),1),e("td",Jr,[e("span",{class:ee({"px-2 py-1 rounded-full text-xs font-medium":!0,"bg-blue-100 text-blue-800":u.type==="sent","bg-purple-100 text-purple-800":u.type==="received"})},h(u.type?u.type.toUpperCase():"N/A"),3)]),e("td",Zr,[e("span",{class:ee({"px-2 py-1 rounded-full text-xs font-medium":!0,"bg-green-100 text-green-800":u.status==="sent","bg-yellow-100 text-yellow-800":u.status==="pending_approval","bg-red-100 text-red-800":u.status==="rejected","bg-gray-100 text-gray-800":u.status==="draft"})},h(u.status?u.status.replace("_"," ").toUpperCase():"N/A"),3)]),e("td",Xr,[p(ye,{class:"text-indigo-600 hover:text-indigo-800",onClick:m=>n(u)},{default:N(()=>a[0]||(a[0]=[H(" View ",-1)])),_:2,__:[0]},1032,["onClick"])])])}),128))])])])):(o(),d("p",Qr,"No email communication found."))]))}},td={key:0,class:"bg-white p-6 rounded-xl shadow-md hover:shadow-lg transition-shadow"},sd={class:"flex justify-between items-center mb-4"},ld={key:0,class:"flex gap-3"},ad={key:1,class:"mt-2 bg-red-100 border border-red-400 text-red-700 px-4 py-2 rounded relative",role:"alert"},id={class:"block sm:inline"},nd={class:"mb-4 bg-gray-50 p-4 rounded-lg"},od={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},rd={class:"mt-1 relative rounded-md shadow-sm"},dd={__name:"ProjectEmailsTab",props:{projectId:{type:Number,required:!0},canViewEmails:{type:Boolean,required:!0},canComposeEmails:{type:Boolean,required:!0},canApproveEmails:{type:Boolean,required:!0},userProjectRole:{type:Object,required:!0},openCompose:{type:Boolean,required:!1,default:!1}},emits:["emailsUpdated","resetOpenCompose"],setup(l,{emit:t}){const s=l,n=t,i=k([]),a=k(!0),u=k(""),r=k(null),m=k(!1),c=k(!1),v=k(""),g=k(""),w=k("post"),C=k(""),D=k(""),$=k(!1),y=k(!1),f=k(null),M=k(""),V=k(""),P=k(""),U=k(null);Ue();const T=ke({type:"",startDate:"",endDate:"",search:""});let I=null;const b=()=>{j()},_=()=>{T.type="",T.startDate="",T.endDate="",T.search="",j()},x=()=>{clearTimeout(I),I=setTimeout(()=>{b()},500)},j=async()=>{a.value=!0,u.value="";try{const F=new URLSearchParams;T.type&&F.append("type",T.type),T.startDate&&F.append("start_date",T.startDate),T.endDate&&F.append("end_date",T.endDate),T.search&&F.append("search",T.search);const L=F.toString(),q=`/api/projects/${s.projectId}/emails-simplified${L?`?${L}`:""}`,ae=await window.axios.get(q);i.value=ae.data,n("emailsUpdated",i.value)}catch(F){u.value="Failed to load email data.",console.error("Error fetching project emails:",F)}finally{a.value=!1}},Z=async F=>{r.value=null,m.value=!0;try{const L=await window.axios.get(`/api/emails/${F.id}`);r.value={...F,subject:L.data.subject,body:L.data.body_html}}catch(L){console.error("Failed to fetch full email details:",L),r.value={subject:"Error",body:"Failed to load email content.",created_at:new Date().toISOString(),status:"error",sender:{name:"System"}}}},ie=async F=>{try{console.log("Opening email editor for email ID:",F.id),r.value=F;const q=(await window.axios.get(`/api/emails/${F.id}/edit-content`)).data;q.template_id?(console.log("Opening template-based email editor for email ID:",F.id),f.value=F.id,M.value=`/api/emails/${F.id}/edit-and-approve`,V.value="Approve & Send",P.value="Email updated and approved successfully!",U.value=q.client_id,y.value=!0,m.value=!1):(v.value="Edit and Approve Email",g.value=`/api/emails/${F.id}/edit-and-approve`,w.value="post",C.value="Approve & Send",D.value="Email updated and approved successfully!",c.value=!0,m.value=!1)}catch(L){console.error("Failed to determine email type:",L),u.value="Failed to load email for editing."}},B=F=>{r.value=F,v.value="Reject Email",g.value=`/api/emails/${F.id}/reject`,w.value="post",C.value="Reject Email",D.value="Email rejected successfully!",c.value=!0,m.value=!1},A=async F=>{console.log("Form submitted successfully:",F),await j(),c.value=!1},S=()=>{c.value=!1},O=()=>{$.value=!1,n("resetOpenCompose")},z=async F=>{console.log("Compose email submitted successfully:",F),await j(),$.value=!1,n("resetOpenCompose")},re=()=>{y.value=!1},Me=async F=>{console.log("Template email edited and submitted successfully:",F),await j(),y.value=!1};return de(()=>s.openCompose,F=>{console.log("Watcher triggered: openCompose changed to",F),F&&(console.log("Opening compose email modal"),$.value=!0)}),fe(()=>{s.canViewEmails&&j(),s.openCompose&&($.value=!0)}),(F,L)=>{var q;return l.canViewEmails?(o(),d("div",td,[e("div",sd,[L[10]||(L[10]=e("h4",{class:"text-lg font-semibold text-gray-900"},"Email Communication",-1)),l.canComposeEmails?(o(),d("div",ld,[p(ue,{class:"bg-indigo-600 hover:bg-indigo-700 transition-colors",onClick:L[0]||(L[0]=ae=>$.value=!0)},{default:N(()=>L[9]||(L[9]=[H(" Compose Email ",-1)])),_:1,__:[9]})])):E("",!0),u.value?(o(),d("div",ad,[e("span",id,h(u.value),1)])):E("",!0)]),e("div",nd,[e("div",od,[e("div",null,[p(Y,{for:"typeFilter",value:"Type"}),me(e("select",{id:"typeFilter","onUpdate:modelValue":L[1]||(L[1]=ae=>T.type=ae),class:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md",onChange:b},L[11]||(L[11]=[e("option",{value:""},"All Types",-1),e("option",{value:"sent"},"Sent",-1),e("option",{value:"received"},"Received",-1)]),544),[[We,T.type]])]),e("div",null,[p(Y,{for:"startDate",value:"From Date"}),p(oe,{type:"date",id:"startDate",modelValue:T.startDate,"onUpdate:modelValue":L[2]||(L[2]=ae=>T.startDate=ae),class:"mt-1 block w-full",onChange:b},null,8,["modelValue"])]),e("div",null,[p(Y,{for:"endDate",value:"To Date"}),p(oe,{type:"date",id:"endDate",modelValue:T.endDate,"onUpdate:modelValue":L[3]||(L[3]=ae=>T.endDate=ae),class:"mt-1 block w-full",onChange:b},null,8,["modelValue"])]),e("div",null,[p(Y,{for:"searchFilter",value:"Search Content"}),e("div",rd,[p(oe,{type:"text",id:"searchFilter",modelValue:T.search,"onUpdate:modelValue":L[4]||(L[4]=ae=>T.search=ae),class:"block w-full pr-10",placeholder:"Search in email content...",onInput:x},null,8,["modelValue"]),L[12]||(L[12]=e("div",{class:"absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none"},[e("svg",{class:"h-5 w-5 text-gray-400",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},[e("path",{"fill-rule":"evenodd",d:"M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z","clip-rule":"evenodd"})])],-1))])])]),e("div",{class:"mt-3 flex justify-end"},[e("button",{type:"button",class:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",onClick:_}," Reset Filters ")])]),p(ed,{emails:i.value,loading:a.value,error:u.value,onView:Z},null,8,["emails","loading","error"]),p(Fr,{show:m.value,email:r.value,"can-approve-emails":l.canApproveEmails,onClose:L[5]||(L[5]=ae=>m.value=!1),onEdit:ie,onReject:B},null,8,["show","email","can-approve-emails"]),p(kt,{show:$.value,"project-id":l.projectId,"user-project-role":l.userProjectRole,onClose:O,onSubmitted:z,onError:L[6]||(L[6]=ae=>console.error("ComposeEmailModal error:",ae))},null,8,["show","project-id","user-project-role"]),p(Yo,{show:c.value,title:v.value,"api-endpoint":g.value,"http-method":w.value,"submit-button-text":C.value,"success-message":D.value,"email-id":(q=r.value)==null?void 0:q.id,"project-id":l.projectId,onClose:S,onSubmitted:A,onError:L[7]||(L[7]=ae=>console.error("EmailActionModal error:",ae)),onFetchEmails:j},null,8,["show","title","api-endpoint","http-method","submit-button-text","success-message","email-id","project-id"]),p(kr,{show:y.value,title:"Edit Template Email","api-endpoint":M.value,"http-method":"post","submit-button-text":V.value,"success-message":P.value,"email-id":f.value,"project-id":l.projectId,"client-id":U.value,onClose:re,onSubmitted:Me,onError:L[8]||(L[8]=ae=>console.error("EditTemplateEmailModal error:",ae))},null,8,["show","api-endpoint","submit-button-text","success-message","email-id","project-id","client-id"])])):E("",!0)}}},ud={key:0,class:"bg-white p-6 rounded-xl shadow-md hover:shadow-lg transition-shadow"},cd={class:"flex justify-between items-center mb-4"},md={class:"flex gap-3"},vd={class:"mb-4 bg-gray-50 p-4 rounded-lg"},pd={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},hd={class:"mt-1 relative rounded-md shadow-sm"},gd={class:"mb-8 p-4 bg-blue-50 rounded-md"},yd={class:"flex items-center"},fd={class:"text-sm text-blue-800"},bd={key:0,class:"text-center text-gray-600 text-sm animate-pulse py-4"},_d={key:1,class:"text-center text-red-600 text-sm font-medium py-4"},wd={key:2,class:"space-y-4"},xd={class:"flex justify-between"},kd={class:"flex-grow"},Dd={key:0,class:"text-xs text-red-400 block mt-1"},Cd={class:"flex items-center mt-1"},Ed={class:"text-xs text-gray-500"},$d={key:0,class:"ml-2 px-2 py-0.5 bg-indigo-100 text-indigo-800 text-xs rounded-full"},Sd={key:0},Md={key:3,class:"text-gray-400 text-sm"},Td={class:"p-6"},jd={class:"flex justify-between items-center mb-4"},Vd={key:0,class:"mb-4 p-3 bg-gray-100 rounded-md"},Ad={class:"text-sm text-gray-700"},Id={class:"text-xs text-gray-500 mt-1"},Od={key:1,class:"mb-4"},Ld={key:0,class:"text-center py-4"},Ud={key:1,class:"space-y-3 max-h-60 overflow-y-auto"},Nd={class:"text-sm text-gray-700"},Pd={class:"text-xs text-gray-500 mt-1"},Rd={key:2,class:"text-center py-3"},Fd={key:2,class:"mb-4"},Bd={key:0,class:"mt-2 text-sm text-red-600"},Hd={key:3,class:"mt-6 flex justify-end"},Wd={__name:"ProjectNotesTab",props:{projectId:{type:Number,required:!0},googleChatId:{type:String,default:null},canViewNotes:{type:Boolean,required:!0},canAddNotes:{type:Boolean,required:!0}},emits:["notesUpdated"],setup(l,{emit:t}){const s=l,n=t,i=k([]),a=k(!0),u=k(""),r=k(!1),m=k(!1),c=k(null),v=k(""),g=k(""),w=k([]),C=k(!1),D=ke({startDate:"",endDate:"",search:""});let $=null;const y=async()=>{a.value=!0,u.value="";try{const I=new URLSearchParams;D.startDate&&I.append("start_date",D.startDate),D.endDate&&I.append("end_date",D.endDate),D.search&&I.append("search",D.search);const b=I.toString(),_=`/api/projects/${s.projectId}/notes${b?`?${b}`:""}`,x=await window.axios.get(_);i.value=x.data,n("notesUpdated",i.value)}catch(I){u.value="Failed to load notes data.",console.error("Error fetching project notes:",I)}finally{a.value=!1}},f=()=>{r.value=!0},M=async I=>{c.value=I,v.value="",g.value="",w.value=[],C.value=!0,m.value=!0;try{const b=await window.axios.get(`/api/projects/${s.projectId}/notes/${I.id}/replies`);b.data.success?w.value=b.data.replies:console.error("Failed to fetch replies:",b.data.message)}catch(b){console.error("Error fetching replies:",b)}finally{C.value=!1}},V=async()=>{var I,b;if(!c.value||!v.value.trim()){g.value="Reply content is required";return}g.value="";try{const _=await window.axios.post(`/api/projects/${s.projectId}/notes/${c.value.id}/reply`,{content:v.value});if(_.data.success){v.value="",C.value=!0;const x=await window.axios.get(`/api/projects/${s.projectId}/notes/${c.value.id}/replies`);x.data.success&&(w.value=x.data.replies),C.value=!1,await y()}else g.value=_.data.message||"Failed to send reply"}catch(_){console.error("Error sending reply:",_),g.value=((b=(I=_.response)==null?void 0:I.data)==null?void 0:b.message)||"An error occurred while sending the reply"}},P=()=>{y()},U=()=>{D.startDate="",D.endDate="",D.search="",y()},T=()=>{clearTimeout($),$=setTimeout(()=>{P()},500)};return fe(()=>{s.canViewNotes&&y()}),(I,b)=>l.canViewNotes?(o(),d("div",ud,[e("div",cd,[b[10]||(b[10]=e("h4",{class:"text-lg font-semibold text-gray-900"},"Project Notes",-1)),e("div",md,[l.canAddNotes?(o(),X(ue,{key:0,class:"bg-indigo-600 hover:bg-indigo-700 transition-colors",onClick:f},{default:N(()=>b[9]||(b[9]=[H(" Add Note ",-1)])),_:1,__:[9]})):E("",!0)])]),e("div",vd,[e("div",pd,[e("div",null,[p(Y,{for:"noteStartDate",value:"From Date"}),p(oe,{type:"date",id:"noteStartDate",modelValue:D.startDate,"onUpdate:modelValue":b[0]||(b[0]=_=>D.startDate=_),class:"mt-1 block w-full",onChange:P},null,8,["modelValue"])]),e("div",null,[p(Y,{for:"noteEndDate",value:"To Date"}),p(oe,{type:"date",id:"noteEndDate",modelValue:D.endDate,"onUpdate:modelValue":b[1]||(b[1]=_=>D.endDate=_),class:"mt-1 block w-full",onChange:P},null,8,["modelValue"])]),e("div",null,[p(Y,{for:"noteSearchFilter",value:"Search Content"}),e("div",hd,[p(oe,{type:"text",id:"noteSearchFilter",modelValue:D.search,"onUpdate:modelValue":b[2]||(b[2]=_=>D.search=_),class:"block w-full pr-10",placeholder:"Search in note content...",onInput:T},null,8,["modelValue"]),b[11]||(b[11]=e("div",{class:"absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none"},[e("svg",{class:"h-5 w-5 text-gray-400",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},[e("path",{"fill-rule":"evenodd",d:"M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z","clip-rule":"evenodd"})])],-1))])])]),e("div",{class:"mt-3 flex justify-end"},[e("button",{type:"button",class:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",onClick:U}," Reset Filters ")])]),e("div",gd,[e("div",yd,[b[13]||(b[13]=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 text-blue-600 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),e("p",fd,[b[12]||(b[12]=H(" Daily Standups are now available in their own dedicated tab. ",-1)),e("button",{onClick:b[3]||(b[3]=_=>I.$emit("changeTab","standups")),class:"text-blue-600 hover:text-blue-800 font-medium underline"}," Click here to view Daily Standups ")])])]),e("div",null,[b[15]||(b[15]=e("h5",{class:"text-md font-semibold text-gray-900 mb-4 border-b pb-2"},"Notes",-1)),a.value?(o(),d("div",bd," Loading notes... ")):u.value?(o(),d("div",_d,h(u.value),1)):i.value.length?(o(),d("div",wd,[(o(!0),d(J,null,Q(i.value,_=>{var x;return o(),d("div",{key:_.id,class:"p-4 bg-gray-50 rounded-md shadow-sm hover:bg-gray-100 transition-colors"},[e("div",xd,[e("div",kd,[e("p",{class:ee(["text-sm",{"text-gray-700":_.content!=="[Encrypted content could not be decrypted]","text-red-500 italic":_.content==="[Encrypted content could not be decrypted]"}])},[H(h(_.content)+" ",1),_.content==="[Encrypted content could not be decrypted]"?(o(),d("span",Dd," (There was an issue decrypting this note. Please contact an administrator.) ")):E("",!0)],2),e("div",Cd,[e("p",Ed,"Added by "+h(((x=_.user)==null?void 0:x.name)||"Unknown")+" on "+h(new Date(_.created_at).toLocaleDateString()),1),_.reply_count>0?(o(),d("span",$d,h(_.reply_count)+" "+h(_.reply_count===1?"reply":"replies"),1)):E("",!0)])]),l.googleChatId&&_.chat_message_id?(o(),d("div",Sd,[p(ye,{class:"text-sm text-indigo-600 hover:text-indigo-800",onClick:j=>M(_)},{default:N(()=>b[14]||(b[14]=[H(" View ",-1)])),_:2,__:[14]},1032,["onClick"])])):E("",!0)])])}),128))])):(o(),d("p",Md,"No notes available."))]),p(ft,{show:r.value,"project-id":l.projectId,onClose:b[4]||(b[4]=_=>r.value=!1),onNoteAdded:y},null,8,["show","project-id"]),p(Se,{show:m.value,onClose:b[8]||(b[8]=_=>m.value=!1)},{default:N(()=>{var _;return[e("div",Td,[e("div",jd,[b[17]||(b[17]=e("h3",{class:"text-lg font-semibold text-gray-900"},"Reply to Note",-1)),e("button",{onClick:b[5]||(b[5]=x=>m.value=!1),class:"text-gray-400 hover:text-gray-500"},b[16]||(b[16]=[e("svg",{class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),c.value?(o(),d("div",Vd,[e("p",Ad,h(c.value.content),1),e("p",Id,"Added by "+h(((_=c.value.user)==null?void 0:_.name)||"Unknown")+" on "+h(new Date(c.value.created_at).toLocaleDateString()),1)])):E("",!0),c.value?(o(),d("div",Od,[b[20]||(b[20]=e("h4",{class:"text-sm font-medium text-gray-700 mb-2"},"Replies",-1)),C.value?(o(),d("div",Ld,b[18]||(b[18]=[e("p",{class:"text-gray-500 text-sm"},"Loading replies...",-1)]))):w.value.length?(o(),d("div",Ud,[(o(!0),d(J,null,Q(w.value,x=>{var j;return o(),d("div",{key:x.id,class:"p-2 bg-gray-50 rounded border-l-2 border-indigo-300"},[e("p",Nd,h(x.content),1),e("p",Pd,"Replied by "+h(((j=x.user)==null?void 0:j.name)||"Unknown")+" on "+h(new Date(x.created_at).toLocaleDateString()),1)])}),128))])):(o(),d("div",Rd,b[19]||(b[19]=[e("p",{class:"text-gray-500 text-sm"},"No replies yet. Be the first to reply!",-1)])))])):E("",!0),l.canAddNotes?(o(),d("div",Fd,[p(Y,{for:"reply-content",value:"Your Reply"}),me(e("textarea",{id:"reply-content","onUpdate:modelValue":b[6]||(b[6]=x=>v.value=x),class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full h-32",placeholder:"Enter your reply..."},null,512),[[be,v.value]]),g.value?(o(),d("p",Bd,h(g.value),1)):E("",!0)])):E("",!0),l.canAddNotes?(o(),d("div",Hd,[p(ye,{onClick:b[7]||(b[7]=x=>m.value=!1),class:"mr-2"},{default:N(()=>b[21]||(b[21]=[H("Cancel",-1)])),_:1,__:[21]}),p(ue,{onClick:V},{default:N(()=>b[22]||(b[22]=[H("Send Reply",-1)])),_:1,__:[22]})])):E("",!0)])]}),_:1},8,["show"])])):E("",!0)}},Yd={class:"w-full"},zd={key:0,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"},qd={key:1,class:"text-red-600 text-sm py-2 text-center"},Gd={key:2,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"},Kd={class:"p-4 bg-blue-100 rounded-lg shadow-sm transition-shadow hover:shadow-lg"},Jd={class:"text-2xl font-bold text-blue-900 mt-1"},Zd={class:"p-4 bg-green-100 rounded-lg shadow-sm transition-shadow hover:shadow-lg"},Xd={class:"text-2xl font-bold text-green-900 mt-1"},Qd={class:"p-4 bg-red-100 rounded-lg shadow-sm transition-shadow hover:shadow-lg"},eu={class:"text-2xl font-bold mt-1"},tu={key:3,class:"space-y-2 text-sm text-gray-700 mt-6 pt-4 border-t border-gray-200"},su={key:0},lu={class:"text-gray-900 whitespace-pre-wrap"},au={key:4,class:"text-gray-400 text-sm mt-4 text-center"},iu={__name:"ProjectFinancialsCard",props:{projectId:{type:Number,required:!0},canViewProjectServicesAndPayments:{type:Boolean,default:!1},canViewProjectTransactions:{type:Boolean,default:!1}},setup(l){const t=l,s=k(null),n=k([]),i=k(!0),a=k(null),u=He,r=R(()=>{var C;if(!ge.value||Object.keys(ge.value).length===0)return 0;const w=parseFloat(((C=s.value)==null?void 0:C.total_amount)||0);return Ie(w,"USD",u.value)}),m=R(()=>!n.value.length||!ge.value||Object.keys(ge.value).length===0?0:n.value.filter(w=>w.type==="expense").reduce((w,C)=>w+Ie(parseFloat(C.amount||0),C.currency,u.value),0)),c=R(()=>!n.value.length||!ge.value||Object.keys(ge.value).length===0?0:n.value.filter(w=>w.type==="income").reduce((w,C)=>w+Ie(parseFloat(C.amount||0),C.currency,u.value),0)),v=R(()=>c.value-m.value),g=async()=>{var w,C;if(i.value=!0,a.value=null,n.value=[],!ge.value||Object.keys(ge.value).length===0){a.value="Currency rates not loaded. Please try again.",i.value=!1;return}if(!t.canViewProjectServicesAndPayments&&!t.canViewProjectTransactions){a.value="You don't have permission to view project financials.",i.value=!1;return}try{if(t.canViewProjectServicesAndPayments){const D=await window.axios.get(`/api/projects/${t.projectId}/sections/services-payment`);s.value=D.data}else s.value=null;if(t.canViewProjectTransactions){const D=await window.axios.get(`/api/projects/${t.projectId}/sections/transactions`);n.value=D.data}else n.value=[]}catch(D){console.error("Failed to fetch project financials:",D),a.value=((C=(w=D.response)==null?void 0:w.data)==null?void 0:C.message)||"Failed to load financial data."}finally{i.value=!1}};return de([()=>t.canViewProjectServicesAndPayments,()=>t.canViewProjectTransactions,u,ge],(w,C)=>{t.projectId&&ge.value&&Object.keys(ge.value).length>0?g():t.projectId||(i.value=!0,a.value=null)},{immediate:!0,deep:!0}),(w,C)=>{var D,$;return o(),d("div",Yd,[i.value?(o(),d("div",zd,[(o(),d(J,null,Q(4,y=>e("div",{key:y,class:"p-4 bg-gray-100 rounded-lg animate-pulse h-24"},C[0]||(C[0]=[e("div",{class:"h-4 bg-gray-200 rounded w-1/2 mb-3"},null,-1),e("div",{class:"h-6 bg-gray-200 rounded w-3/4"},null,-1)]))),64))])):a.value?(o(),d("div",qd,[e("p",null,h(a.value),1)])):(o(),d("div",Gd,[e("div",Kd,[C[1]||(C[1]=e("p",{class:"text-sm font-medium text-blue-800"},"Contract Value",-1)),e("p",Jd,h(K(Ve)(r.value,K(u).value)),1)]),e("div",Zd,[C[2]||(C[2]=e("p",{class:"text-sm font-medium text-green-800"},"Total Income",-1)),e("p",Xd,h(K(Ve)(c.value,K(u))),1)]),e("div",Qd,[C[3]||(C[3]=e("p",{class:"text-sm font-medium text-red-800"},"Total Expenses",-1)),e("p",eu,h(K(Ve)(m.value,K(u))),1)]),e("div",{class:ee(["p-4 rounded-lg shadow-sm transition-shadow hover:shadow-lg",{"bg-green-100":v.value>=0,"bg-red-100":v.value<0}])},[e("p",{class:ee(["text-sm font-medium",{"text-green-800":v.value>=0,"text-red-800":v.value<0}])},"Profit/Loss",2),e("p",{class:ee(["text-2xl font-bold mt-1",{"text-green-900":v.value>=0,"text-red-900":v.value<0}])},h(K(Ve)(v.value,K(u))),3)],2)])),!i.value&&!a.value&&((D=s.value)!=null&&D.contract_details)?(o(),d("dl",tu,[($=s.value)!=null&&$.contract_details?(o(),d("div",su,[C[4]||(C[4]=e("dt",{class:"font-medium w-full block mt-2"},"Contract Details:",-1)),e("dd",lu,h(s.value.contract_details),1)])):E("",!0)])):E("",!0),!i.value&&!a.value&&!s.value&&!n.value.length?(o(),d("p",au," No financial information available. ")):E("",!0)])}}},nu={class:"bg-white p-6 rounded-xl shadow-md transition-shadow hover:shadow-lg"},ou={key:0},ru={key:1,class:"text-red-600 text-sm py-2"},du={key:2,class:"space-y-1 text-sm text-gray-700"},uu={key:0},cu={key:3,class:"text-gray-400 text-sm"},mu={__name:"ProjectClientsCard",props:{projectId:{type:Number,required:!0},canViewClientContacts:{type:Boolean,default:!1}},setup(l){const t=l,s=k([]),n=k(!0),i=k(null),a=async()=>{var u,r;if(n.value=!0,i.value=null,!t.canViewClientContacts){i.value="You don't have permission to view project clients.",n.value=!1;return}try{const m=await window.axios.get(`/api/projects/${t.projectId}/sections/clients?type=clients`);s.value=m.data}catch(m){console.error("Failed to fetch project clients:",m),i.value=((r=(u=m.response)==null?void 0:u.data)==null?void 0:r.message)||"Failed to load client data."}finally{n.value=!1}};return fe(()=>{a()}),de(()=>t.canViewClientContacts,()=>{a()}),(u,r)=>(o(),d("div",nu,[r[1]||(r[1]=e("h4",{class:"text-lg font-semibold text-gray-900 mb-4"},"Project Clients",-1)),n.value?(o(),d("div",ou,r[0]||(r[0]=[e("div",{class:"space-y-3"},[e("div",{class:"h-4 bg-gray-200 rounded animate-pulse w-3/4"}),e("div",{class:"h-4 bg-gray-200 rounded animate-pulse w-2/3"}),e("div",{class:"h-4 bg-gray-200 rounded animate-pulse w-1/2"})],-1)]))):i.value?(o(),d("div",ru,[e("p",null,h(i.value),1)])):s.value.length?(o(),d("ul",du,[(o(!0),d(J,null,Q(s.value,m=>(o(),d("li",{key:m.id},[H(h(m.name)+" ",1),m.email?(o(),d("span",uu,"("+h(m.email)+")",1)):E("",!0)]))),128))])):(o(),d("p",cu,"No clients assigned."))]))}},vu={class:"bg-white p-6 rounded-xl shadow-md transition-shadow hover:shadow-lg"},pu={key:0},hu={key:1,class:"text-red-600 text-sm py-2"},gu={key:2},yu={key:0,class:"space-y-2 text-sm text-gray-700 mb-4"},fu={class:"font-medium"},bu={class:"text-xs text-gray-500 mt-1"},_u={key:1,class:"text-gray-400 text-sm mb-4"},wu={__name:"ProjectTeamCard",props:{projectId:{type:Number,required:!0},canViewUsers:{type:Boolean,default:!1}},setup(l){const t=l,s=Ue(),n=k([]),i=k(!0),a=k(null),u=async()=>{var m,c;if(i.value=!0,a.value=null,!t.canViewUsers){a.value="You don't have permission to view project team members.",i.value=!1,n.value=[];return}try{const v=await window.axios.get(`/api/projects/${t.projectId}/sections/users`);n.value=v.data.users||[],console.log("Fetched team users:",n.value)}catch(v){console.error("Failed to fetch project users:",v),a.value=((c=(m=v.response)==null?void 0:m.data)==null?void 0:c.message)||"Failed to load team data."}finally{i.value=!1}},r=m=>{if(!m.availabilities||m.availabilities.length===0)return"No availability submitted for today.";const c=m.availabilities[0];return c.is_available?c.time_slots&&c.time_slots.length>0?`${c.time_slots.map(g=>`${g.start_time}-${g.end_time}`).join(", ")}`:"No specific slots provided.":`Not available today: ${c.reason||"No reason provided"}`};return fe(()=>{u()}),de([()=>t.canViewUsers,()=>s.value,()=>t.projectId],()=>{u()},{deep:!0}),(m,c)=>(o(),d("div",vu,[c[3]||(c[3]=e("h4",{class:"text-lg font-semibold text-gray-900 mb-4"},"Project Team",-1)),i.value?(o(),d("div",pu,c[0]||(c[0]=[e("div",{class:"space-y-3"},[e("div",{class:"h-4 bg-gray-200 rounded animate-pulse w-3/4"}),e("div",{class:"h-4 bg-gray-200 rounded animate-pulse w-2/3"}),e("div",{class:"h-4 bg-gray-200 rounded animate-pulse w-1/2"})],-1)]))):a.value?(o(),d("div",hu,[e("p",null,h(a.value),1)])):(o(),d("div",gu,[n.value.length?(o(),d("ul",yu,[(o(!0),d(J,null,Q(n.value,v=>{var g;return o(),d("li",{key:v.id,class:"border-b pb-2 last:border-b-0"},[e("div",null,[e("strong",null,h(v.name),1),c[1]||(c[1]=H(" (Role: ",-1)),e("span",fu,h(((g=v.pivot)==null?void 0:g.role)||"N/A"),1),c[2]||(c[2]=H(") ",-1))]),e("div",bu," Today's Availability: "+h(r(v)),1)])}),128))])):(o(),d("p",_u,"No team members assigned."))]))]))}},xu={class:"bg-white p-6 rounded-xl shadow-md transition-shadow hover:shadow-lg"},ku={key:0,class:"space-y-3"},Du={key:1,class:"text-red-600 text-sm py-2 text-center"},Cu={key:2},Eu={class:"space-y-1 text-sm text-gray-700"},$u={key:0},Su={class:"inline-block text-gray-900"},Mu={class:"inline-block text-gray-900"},Tu={class:"inline-block text-gray-900"},ju={key:1},Vu={key:0,class:"text-gray-400 text-sm"},Au={key:1,class:"text-gray-400 text-sm"},Iu={key:0,class:"mt-4 text-right"},Ou={__name:"UserFinancialCard",props:{projectId:{type:Number,required:!0}},emits:["viewUserTransactions"],setup(l,{emit:t}){const s=l,n=t,i=Ue(),a=k(!0),u=k(null),r=k([]),m=He,c=async()=>{var $,y;if(a.value=!0,u.value=null,!i.value||!i.value.id||!s.projectId){r.value=[],a.value=!1;return}if(!ge.value||Object.keys(ge.value).length===0){u.value="Currency rates not loaded. Please try again.",a.value=!1;return}try{const f=await window.axios.get(`/api/projects/${s.projectId}/sections/transactions?user_id=${i.value.id}`);r.value=f.data,console.log("User-specific transactions:",r.value)}catch(f){console.error("Failed to fetch user transactions for UserFinancialsCard:",f),u.value=((y=($=f.response)==null?void 0:$.data)==null?void 0:y.message)||"Failed to load your financial data.",r.value=[]}finally{a.value=!1}},v=R(()=>!i.value||!i.value.id||!r.value.length||!ge.value||Object.keys(ge.value).length===0?0:r.value.filter(y=>y.type==="expense").reduce((y,f)=>y+Ie(parseFloat(f.amount||0),f.currency,m.value),0)),g=R(()=>!i.value||!i.value.id||!r.value.length||!ge.value||Object.keys(ge.value).length===0?0:r.value.filter(y=>y.type==="bonus").reduce((y,f)=>y+Ie(parseFloat(f.amount||0),f.currency,m.value),0)),w=R(()=>!i.value||!i.value.id||!r.value.length||!ge.value||Object.keys(ge.value).length===0?0:r.value.filter(y=>(y.type==="expense"||y.type==="bonus")&&y.is_paid===1).reduce((y,f)=>y+Ie(parseFloat(f.amount||0),f.currency,m.value),0)),C=R(()=>i.value&&(v.value>0||g.value>0||w.value>0));fe(()=>{c()}),de([()=>i.value,()=>s.projectId,m,ge],()=>{c()},{deep:!0});const D=()=>{n("viewUserTransactions")};return($,y)=>(o(),d("div",xu,[y[5]||(y[5]=e("h4",{class:"text-lg font-semibold text-gray-900 mb-4"},"Your Financials",-1)),a.value?(o(),d("div",ku,y[0]||(y[0]=[e("div",{class:"h-4 bg-gray-200 rounded animate-pulse w-full"},null,-1),e("div",{class:"h-4 bg-gray-200 rounded animate-pulse w-5/6"},null,-1),e("div",{class:"h-4 bg-gray-200 rounded animate-pulse w-3/4"},null,-1)]))):u.value?(o(),d("div",Du,[e("p",null,h(u.value),1)])):(o(),d("div",Cu,[e("dl",Eu,[C.value?(o(),d("div",$u,[e("div",null,[y[1]||(y[1]=e("dt",{class:"font-medium inline-block w-32"},"Agreed Amount:",-1)),e("dd",Su,h(K(Ve)(v.value,K(m))),1)]),e("div",null,[y[2]||(y[2]=e("dt",{class:"font-medium inline-block w-32"},"Bonus Amount:",-1)),e("dd",Mu,h(K(Ve)(g.value,K(m))),1)]),e("div",null,[y[3]||(y[3]=e("dt",{class:"font-medium inline-block w-32"},"Received Amount:",-1)),e("dd",Tu,h(K(Ve)(w.value,K(m))),1)])])):(o(),d("div",ju,[K(i)?(o(),d("p",Au," Your financials for this project are not available or you're not assigned. ")):(o(),d("p",Vu," Sign in to view your specific financials. "))]))]),K(i)?(o(),d("div",Iu,[p(ue,{onClick:D},{default:N(()=>y[4]||(y[4]=[H(" View Transactions ",-1)])),_:1,__:[4]})])):E("",!0)]))]))}},Lu=Ee(Ou,[["__scopeId","data-v-34bab241"]]),Uu={class:"p-4"},Nu={key:0,class:"text-center text-gray-600"},Pu={key:1,class:"text-red-600 text-sm py-2"},Ru={key:2,class:"text-gray-500 text-center py-4"},Fu={key:3,class:"overflow-x-auto"},Bu={class:"min-w-full divide-y divide-gray-200"},Hu={class:"bg-white divide-y divide-gray-200"},Wu={class:"px-4 py-3 text-sm text-gray-900"},Yu={class:"px-4 py-3 text-sm text-gray-700"},zu={class:"px-4 py-3 text-sm text-right text-gray-900"},qu={class:"px-4 py-3 text-sm"},Gu={class:"px-4 py-3 text-sm text-gray-700"},Ku={__name:"UserTransactionsModal",props:{show:{type:Boolean,default:!1},projectId:{type:Number,required:!0},projectName:{type:String,required:!1}},emits:["close"],setup(l,{emit:t}){const s=l,n=Ue(),i=k(!0),a=k(null),u=k([]);k("PKR");const r=(c,v="USD")=>isNaN(c)||c==null?"0.00":new Intl.NumberFormat("en-US",{style:"currency",currency:v,minimumFractionDigits:2,maximumFractionDigits:2}).format(c),m=async()=>{var c,v;if(i.value=!0,a.value=null,u.value=[],!n.value||!n.value.id||!s.projectId){a.value="User not authenticated or project ID missing.",i.value=!1;return}try{const g=await window.axios.get(`/api/projects/${s.projectId}/sections/transactions?user_id=${n.value.id}`);u.value=g.data}catch(g){console.error("Failed to fetch user-specific transactions for modal:",g),a.value=((v=(c=g.response)==null?void 0:c.data)==null?void 0:v.message)||"Failed to load transactions."}finally{i.value=!1}};return de(()=>s.show,c=>{c&&m()},{immediate:!1}),de([()=>{var c;return(c=n.value)==null?void 0:c.id},()=>s.projectId],(c,v)=>{s.show&&m()},{deep:!0}),R(()=>`Your Transactions for Project ${s.projectId}`),(c,v)=>(o(),X(Ce,{show:l.show,title:"Transactions for: "+l.projectName,"show-footer":!1,onClose:v[0]||(v[0]=g=>c.$emit("close")),"hide-submit-button":!0,"hide-cancel-button":!0,"api-endpoint":null,"form-data":"{}"},{default:N(({errors:g})=>[e("div",Uu,[i.value?(o(),d("div",Nu,v[1]||(v[1]=[e("div",{class:"space-y-3"},[e("div",{class:"h-4 bg-gray-200 rounded animate-pulse w-full"}),e("div",{class:"h-4 bg-gray-200 rounded animate-pulse w-5/6"}),e("div",{class:"h-4 bg-gray-200 rounded animate-pulse w-full"}),e("div",{class:"h-4 bg-gray-200 rounded animate-pulse w-2/3"})],-1)]))):a.value?(o(),d("div",Pu,[e("p",null,h(a.value),1)])):u.value.length===0?(o(),d("div",Ru," No transactions found for you on this project. ")):(o(),d("div",Fu,[e("table",Bu,[v[2]||(v[2]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Description"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Type"),e("th",{class:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"Amount"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Status"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Date")])],-1)),e("tbody",Hu,[(o(!0),d(J,null,Q(u.value,w=>(o(),d("tr",{key:w.id,class:"hover:bg-gray-50 transition-colors"},[e("td",Wu,h(w.description),1),e("td",Yu,h(w.type),1),e("td",zu,h(r(w.amount,w.currency)),1),e("td",qu,[e("span",{class:ee({"px-2 py-1 rounded-full text-xs font-medium":!0,"bg-green-100 text-green-800":w.is_paid===1,"bg-yellow-100 text-yellow-800":w.is_paid===0})},h(w.is_paid===1?"Paid":"Unpaid"),3)]),e("td",Gu,h(new Date(w.created_at).toLocaleDateString()),1)]))),128))])])]))])]),_:1},8,["show","title"]))}},Ju={class:"space-y-4"},Zu={key:0},Xu=["disabled"],Qu={key:0,class:"mt-4"},ec=["src"],tc={class:"flex items-center"},sc="Create New Deliverable",lc="post",ac="Create Deliverable",ic="Deliverable created successfully!",Dt={__name:"CreateDeliverableModal",props:{show:{type:Boolean,default:!1},projectId:{type:[String,Number],required:!0}},emits:["close","saved"],setup(l,{emit:t}){const s=l,n=t,i=ke({title:"",description:"",type:"blog_post",content_url:"",content_url_type:null,attachment_file:null,is_visible_to_client:!0,initial_status:"pending_review"}),a=[{value:"blog_post",label:"Blog Post"},{value:"design_mockup",label:"Design Mockup"},{value:"social_media_post",label:"Social Media Post"},{value:"report",label:"Report"},{value:"contract_draft",label:"Contract Draft"},{value:"proposal",label:"Proposal"},{value:"other",label:"Other"}],u=[{value:"pending_review",label:"Pending Review (Requires Client Approval)"},{value:"for_information",label:"For Information Only (No Approval Needed)"}],r=[{value:null,label:"Select Type (if providing URL)"},{value:"google_doc",label:"Google Document (Doc, Sheet, Slide)"},{value:"pdf",label:"PDF Document"},{value:"image",label:"Image (JPG, PNG, GIF)"},{value:"video",label:"Video (YouTube, Vimeo, etc.)"},{value:"other",label:"Other Web Link"}],m=k(null),c=k(null);de(()=>s.show,y=>{y&&(Object.assign(i,{title:"",description:"",type:"blog_post",content_url:"",content_url_type:null,attachment_file:null,is_visible_to_client:!0,initial_status:"pending_review"}),c.value=null,m.value&&(m.value.value=""))});const v=y=>{const f=y.target.files[0];if(f)if(i.attachment_file=f,i.content_url="",i.content_url_type=null,f.type.startsWith("image/")){const M=new FileReader;M.onload=V=>{c.value=V.target.result},M.readAsDataURL(f)}else c.value=null;else i.attachment_file=null,c.value=null},g=()=>{i.content_url?(i.attachment_file=null,c.value=null,m.value&&(m.value.value="")):i.content_url_type=null},w=y=>{const f=new FormData;return f.append("title",y.title),f.append("description",y.description||""),f.append("type",y.type),f.append("is_visible_to_client",y.is_visible_to_client?1:0),f.append("initial_status",y.initial_status),y.attachment_file?f.append("attachment_file",y.attachment_file):y.content_url&&(f.append("content_url",y.content_url),f.append("content_url_type",y.content_url_type||"")),f},C=R(()=>`/api/projects/${s.projectId}/deliverables`),D=y=>{n("saved",y),n("close")},$=()=>{n("close")};return(y,f)=>(o(),X(Ce,{show:l.show,title:sc,"api-endpoint":C.value,"http-method":lc,"form-data":i,"submit-button-text":ac,"success-message":ic,"format-data-for-api":w,onClose:$,onSubmitted:D},{default:N(({errors:M})=>[e("div",Ju,[e("div",null,[p(Y,{for:"title",value:"Title"}),p(oe,{id:"title",modelValue:i.title,"onUpdate:modelValue":f[0]||(f[0]=V=>i.title=V),type:"text",class:"mt-1 block w-full",required:"",autofocus:""},null,8,["modelValue"]),p(le,{message:M.title?M.title[0]:"",class:"mt-2"},null,8,["message"])]),e("div",null,[p(Y,{for:"description",value:"Description"}),me(e("textarea",{id:"description","onUpdate:modelValue":f[1]||(f[1]=V=>i.description=V),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",rows:"3",placeholder:"Enter deliverable description"},null,512),[[be,i.description]]),p(le,{message:M.description?M.description[0]:"",class:"mt-2"},null,8,["message"])]),e("div",null,[p(Y,{for:"type",value:"Deliverable Type"}),p(he,{id:"type",modelValue:i.type,"onUpdate:modelValue":f[2]||(f[2]=V=>i.type=V),options:a,"value-key":"value","label-key":"label",placeholder:"Select a type",class:"mt-1 block w-full",required:""},null,8,["modelValue"]),p(le,{message:M.type?M.type[0]:"",class:"mt-2"},null,8,["message"])]),e("div",null,[p(Y,{for:"initial_status",value:"Initial Status"}),p(he,{id:"initial_status",modelValue:i.initial_status,"onUpdate:modelValue":f[3]||(f[3]=V=>i.initial_status=V),options:u,"value-key":"value","label-key":"label",class:"mt-1 block w-full",required:""},null,8,["modelValue"]),p(le,{message:M.initial_status?M.initial_status[0]:"",class:"mt-2"},null,8,["message"])]),e("div",null,[p(Y,{for:"content_url",value:"Content URL (for Google Docs, external links)"}),p(oe,{id:"content_url",modelValue:i.content_url,"onUpdate:modelValue":f[4]||(f[4]=V=>i.content_url=V),type:"url",class:"mt-1 block w-full",disabled:!!i.attachment_file,onInput:g,placeholder:"e.g., https://docs.google.com/document/d/..."},null,8,["modelValue","disabled"]),f[7]||(f[7]=e("p",{class:"text-xs text-gray-500 mt-1"},"Leave empty if uploading a file below.",-1)),p(le,{message:M.content_url?M.content_url[0]:"",class:"mt-2"},null,8,["message"])]),i.content_url&&!i.attachment_file?(o(),d("div",Zu,[p(Y,{for:"content_url_type",value:"Type of Content URL"}),p(he,{id:"content_url_type",modelValue:i.content_url_type,"onUpdate:modelValue":f[5]||(f[5]=V=>i.content_url_type=V),options:r,"value-key":"value","label-key":"label",placeholder:"Select the type of content this URL links to",class:"mt-1 block w-full",required:""},null,8,["modelValue"]),p(le,{message:M.content_url_type?M.content_url_type[0]:"",class:"mt-2"},null,8,["message"])])):E("",!0),e("div",null,[p(Y,{for:"attachment_file",value:"Upload File (PDF, Image)"}),e("input",{id:"attachment_file",ref_key:"fileInput",ref:m,type:"file",onChange:v,class:"mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100",disabled:!!i.content_url,accept:"application/pdf,image/*"},null,40,Xu),f[9]||(f[9]=e("p",{class:"text-xs text-gray-500 mt-1"},"Max 10MB. Leave empty if providing a URL above.",-1)),p(le,{message:M.attachment_file?M.attachment_file[0]:"",class:"mt-2"},null,8,["message"]),c.value?(o(),d("div",Qu,[f[8]||(f[8]=e("p",{class:"text-sm font-medium text-gray-700 mb-2"},"Image Preview:",-1)),e("img",{src:c.value,alt:"File Preview",class:"max-w-full h-auto rounded-lg shadow-md max-h-60 object-contain"},null,8,ec)])):E("",!0)]),e("div",tc,[me(e("input",{id:"is_visible_to_client",type:"checkbox","onUpdate:modelValue":f[6]||(f[6]=V=>i.is_visible_to_client=V),class:"rounded border-gray-300 text-indigo-600 shadow-sm focus:ring-indigo-500"},null,512),[[Qe,i.is_visible_to_client]]),p(Y,{for:"is_visible_to_client",value:"Visible to Client",class:"ml-2"}),p(le,{message:M.is_visible_to_client?M.is_visible_to_client[0]:"",class:"mt-2"},null,8,["message"])])])]),_:1},8,["show","api-endpoint","form-data"]))}};function nc(){return{formatDate:n=>n?new Date(n).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"",formatDateTime:n=>n?new Date(n).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"",timeAgo:n=>{if(!n)return"";const i=new Date(n),u=Math.floor((new Date-i)/1e3);let r=u/31536e3;return r>1?Math.floor(r)+" years ago":(r=u/2592e3,r>1?Math.floor(r)+" months ago":(r=u/86400,r>1?Math.floor(r)+" days ago":(r=u/3600,r>1?Math.floor(r)+" hours ago":(r=u/60,r>1?Math.floor(r)+" minutes ago":Math.floor(u)+" seconds ago"))))}}}const oc={class:"p-6 bg-white rounded-lg shadow-md min-h-[calc(100vh-6rem)]"},rc={class:"flex justify-between items-center mb-4"},dc={class:"flex gap-2"},uc={key:0},cc={key:1},mc={class:"mb-6 bg-gray-50 p-4 rounded-lg"},vc={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4"},pc={key:0,class:"mt-3 text-sm text-gray-600"},hc={key:0,class:"text-red-600 font-medium"},gc={key:0,class:"text-center text-gray-600 text-sm animate-pulse py-4"},yc={key:1,class:"text-center py-4"},fc={class:"text-red-600 text-sm font-medium"},bc={key:2,class:"overflow-x-auto"},_c={class:"min-w-full divide-y divide-gray-200"},wc={class:"bg-white divide-y divide-gray-200"},xc={class:"px-4 py-3 text-sm text-gray-900"},kc={class:"px-4 py-3 text-sm text-gray-700 capitalize"},Dc={class:"px-4 py-3 text-sm text-gray-700"},Cc={class:"px-4 py-3 text-sm text-gray-700"},Ec={class:"px-4 py-3 text-sm text-gray-700"},$c={class:"px-4 py-3 text-sm text-gray-700"},Sc={class:"px-4 py-3 text-sm text-gray-700"},Mc={class:"px-4 py-3 text-right"},Tc={class:"flex justify-end space-x-2"},jc=["onClick"],Vc={key:3,class:"text-center py-4"},Ac={__name:"ProjectDeliverableTab",props:{projectId:{type:[String,Number],required:!0},canCreateDeliverables:{type:Boolean,default:!1},canViewDeliverables:{type:Boolean,default:!1}},emits:["deliverablesUpdated","openDeliverableDetailSidebar"],setup(l,{emit:t}){const s=l,n=t,i=k([]),a=k(!0),u=k(null),r=k(!1),m=k({status:"",type:"",visibility:"",clientStatus:""}),c=[{value:"",label:"All Statuses"},{value:"pending_review",label:"Pending Review"},{value:"for_information",label:"For Information"},{value:"approved",label:"Approved"},{value:"revisions_requested",label:"Revisions Requested"},{value:"completed",label:"Completed"}],v=[{value:"",label:"All Types"},{value:"blog_post",label:"Blog Post"},{value:"design_mockup",label:"Design Mockup"},{value:"social_media_post",label:"Social Media Post"},{value:"report",label:"Report"},{value:"contract_draft",label:"Contract Draft"},{value:"proposal",label:"Proposal"},{value:"other",label:"Other"}],g=[{value:"",label:"All Visibility"},{value:"visible_to_client",label:"Visible to Client"},{value:"not_visible_to_client",label:"Not Visible to Client"}],w=[{value:"",label:"All Client Status"},{value:"read",label:"Read"},{value:"unread",label:"Unread"},{value:"approved",label:"Approved"},{value:"revisions_requested",label:"Revisions Requested"}],C=V=>{var U;if(!V.is_visible_to_client)return{status:"N/A",class:"bg-gray-100 text-gray-800"};const P=(U=V.client_interactions)==null?void 0:U[0];return P?P.approved_at?{status:"Approved",class:"bg-green-100 text-green-800"}:P.revisions_requested_at?{status:"Revisions Requested",class:"bg-yellow-100 text-yellow-800"}:P.rejected_at?{status:"Rejected",class:"bg-red-100 text-red-800"}:P.read_at?{status:`Read on ${new Date(P.read_at).toLocaleDateString()}`,class:"bg-blue-100 text-blue-800"}:{status:"Unread",class:"bg-red-100 text-red-800"}:{status:"Unread",class:"bg-red-100 text-red-800"}},D=R(()=>i.value.length?i.value.filter(V=>{const P=C(V);return!(m.value.status&&V.status!==m.value.status||m.value.type&&V.type!==m.value.type||m.value.visibility&&(m.value.visibility==="visible_to_client"&&!V.is_visible_to_client||m.value.visibility==="not_visible_to_client"&&V.is_visible_to_client)||m.value.clientStatus&&(m.value.clientStatus==="read"&&!P.status.startsWith("Read")||m.value.clientStatus==="unread"&&P.status!=="Unread"||m.value.clientStatus==="approved"&&P.status!=="Approved"||m.value.clientStatus==="revisions_requested"&&P.status!=="Revisions Requested"))}):[]),$=()=>{m.value.status="",m.value.type="",m.value.visibility="",m.value.clientStatus=""},y=async()=>{if(!s.canViewDeliverables){u.value="You do not have permission to view deliverables.",a.value=!1;return}a.value=!0,u.value=null;try{const V=await window.axios.get(route("projects.deliverables.index",s.projectId));i.value=V.data}catch(V){console.error("Error fetching deliverables:",V),u.value="Failed to load deliverables."}finally{a.value=!1}},f=()=>{y(),n("deliverablesUpdated")},M=V=>{n("openDeliverableDetailSidebar",V)};return fe(()=>{y()}),de(()=>s.projectId,()=>{y()}),(V,P)=>(o(),d("div",oc,[e("div",rc,[P[7]||(P[7]=e("h4",{class:"text-lg font-semibold text-gray-900"},"Project Deliverables & Approvals",-1)),e("div",dc,[p(ye,{onClick:y,disabled:a.value,class:"text-indigo-600 hover:text-indigo-800"},{default:N(()=>[a.value?(o(),d("span",cc,"Loading...")):(o(),d("span",uc,"Refresh"))]),_:1},8,["disabled"]),l.canCreateDeliverables?(o(),X(ue,{key:0,onClick:P[0]||(P[0]=U=>r.value=!0),class:"bg-indigo-600 hover:bg-indigo-700 transition-colors"},{default:N(()=>P[6]||(P[6]=[H(" Add New Deliverable ",-1)])),_:1,__:[6]})):E("",!0)])]),e("div",mc,[e("div",vc,[e("div",null,[p(Y,{for:"deliverable-status-filter",value:"Status"}),p(he,{id:"deliverable-status-filter",modelValue:m.value.status,"onUpdate:modelValue":P[1]||(P[1]=U=>m.value.status=U),options:c,placeholder:"All Statuses",class:"mt-1"},null,8,["modelValue"])]),e("div",null,[p(Y,{for:"deliverable-type-filter",value:"Type"}),p(he,{id:"deliverable-type-filter",modelValue:m.value.type,"onUpdate:modelValue":P[2]||(P[2]=U=>m.value.type=U),options:v,placeholder:"All Types",class:"mt-1"},null,8,["modelValue"])]),e("div",null,[p(Y,{for:"deliverable-visibility-filter",value:"Visibility"}),p(he,{id:"deliverable-visibility-filter",modelValue:m.value.visibility,"onUpdate:modelValue":P[3]||(P[3]=U=>m.value.visibility=U),options:g,placeholder:"All Visibility",class:"mt-1"},null,8,["modelValue"])]),e("div",null,[p(Y,{for:"deliverable-client-status-filter",value:"Client Status"}),p(he,{id:"deliverable-client-status-filter",modelValue:m.value.clientStatus,"onUpdate:modelValue":P[4]||(P[4]=U=>m.value.clientStatus=U),options:w,placeholder:"All Client Status",class:"mt-1"},null,8,["modelValue"])])]),e("div",{class:"flex justify-end mt-4"},[e("button",{type:"button",onClick:$,class:"px-3 py-2 text-sm text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-md transition-colors"}," Clear Filters ")]),Object.values(m.value).some(U=>U!==null&&U!=="")?(o(),d("div",pc,[e("p",null,[H(" Showing "+h(D.value.length)+" of "+h(i.value.length)+" deliverables ",1),D.value.length===0?(o(),d("span",hc," (No deliverables match the current filters) ")):E("",!0)])])):E("",!0)]),a.value?(o(),d("div",gc," Loading deliverables... ")):u.value?(o(),d("div",yc,[e("p",fc,h(u.value),1)])):D.value.length?(o(),d("div",bc,[e("table",_c,[P[8]||(P[8]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Title"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Type"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Status"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Submitted By"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Submitted On"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Visibility"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Client Status"),H(),e("th",{class:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"Actions")])],-1)),e("tbody",wc,[(o(!0),d(J,null,Q(D.value,U=>{var T;return o(),d("tr",{key:U.id,class:"hover:bg-gray-50 transition-colors"},[e("td",xc,h(U.title),1),e("td",kc,h(U.type.replace(/_/g," ")),1),e("td",Dc,[e("span",{class:ee({"px-2 py-1 rounded-full text-xs font-medium":!0,"bg-yellow-100 text-yellow-800":U.status==="pending_review"||U.status==="revisions_requested","bg-green-100 text-green-800":U.status==="approved","bg-blue-100 text-blue-800":U.status==="completed","bg-gray-100 text-gray-800":U.status==="for_information"})},h(U.status.replace(/_/g," ").replace(/\b\w/g,I=>I.toUpperCase())),3)]),e("td",Cc,h(((T=U.team_member)==null?void 0:T.name)||"Unknown"),1),e("td",Ec,h(new Date(U.submitted_at).toLocaleDateString()),1),e("td",$c,[e("span",{class:ee({"px-2 py-1 rounded-full text-xs font-medium":!0,"bg-green-100 text-green-800":U.is_visible_to_client,"bg-red-100 text-red-800":!U.is_visible_to_client})},h(U.is_visible_to_client?"Visible":"Hidden"),3)]),e("td",Sc,[e("span",{class:ee(["px-2 py-1 rounded-full text-xs font-medium",C(U).class])},h(C(U).status),3)]),e("td",Mc,[e("div",Tc,[e("button",{onClick:I=>M(U.id),class:"text-purple-600 hover:text-purple-800 text-sm font-medium"}," View Details ",8,jc)])])])}),128))])])])):(o(),d("div",Vc,P[9]||(P[9]=[e("p",{class:"text-gray-400 text-sm"},"No deliverables found for this project.",-1),e("p",{class:"text-gray-500 text-sm mt-2"},' Click the "Add New Deliverable" button to create one. ',-1)]))),p(Dt,{show:r.value,"project-id":l.projectId,onClose:P[5]||(P[5]=U=>r.value=!1),onSaved:f},null,8,["show","project-id"])]))}},Ic=Ee(Ac,[["__scopeId","data-v-40d67f52"]]),Oc={key:0,class:"text-center py-8 text-gray-500"},Lc={key:1,class:"text-center py-8 text-red-600"},Uc={key:2,class:"space-y-6"},Nc={class:"bg-gray-50 p-4 rounded-lg shadow-sm"},Pc={class:"text-xl font-bold text-gray-900 mb-2"},Rc={class:"flex items-center space-x-2 text-sm text-gray-600 mb-4"},Fc={class:"text-indigo-600 font-medium"},Bc={class:"text-gray-700"},Hc={class:"text-gray-700 leading-relaxed"},Wc={class:"mt-4 space-y-2 text-sm"},Yc={key:0,class:"text-blue-600 hover:underline"},zc=["href"],qc={key:1,class:"text-blue-600 hover:underline"},Gc=["href"],Kc={key:2,class:"text-green-600 font-medium"},Jc={class:"bg-white p-4 rounded-lg shadow-sm"},Zc={key:0,class:"space-y-3"},Xc={class:"font-semibold text-gray-800"},Qc={class:"text-sm text-gray-700"},em={class:"font-medium"},tm={key:0,class:"text-xs text-gray-500 ml-2"},sm={key:0,class:"text-sm text-gray-600 mt-1"},lm={key:1,class:"text-gray-500 text-sm py-2"},am={class:"bg-white p-4 rounded-lg shadow-sm"},im={class:"flex justify-between items-center mb-4 border-b pb-2"},nm={class:"space-y-3 mb-4"},om={key:0,class:"space-y-3"},rm={class:"text-sm text-gray-700"},dm={class:"text-xs text-gray-500 mt-1"},um={key:0},cm={key:1,class:"ml-2 text-gray-400"},mm={key:1,class:"text-gray-500 text-sm py-2"},vm={key:3,class:"text-center py-8 text-gray-500"},pm={__name:"DeliverableDetailSidebar",props:{projectId:{type:Number,required:!0},deliverableId:{type:Number,required:!0}},emits:["close","deliverable-updated"],setup(l,{emit:t}){const s=l,n=t,i=k(null),a=k(!0),u=k(""),{formatDateTime:r,timeAgo:m}=nc(),c=ls({comment_text:"",context:""}),v=async()=>{a.value=!0,u.value="";try{const y=await window.axios.get(route("projects.deliverables.show",{project:s.projectId,deliverable:s.deliverableId}));i.value=y.data}catch(y){u.value="Failed to load deliverable details.",console.error("Error fetching deliverable details:",y)}finally{a.value=!1}};de(()=>s.deliverableId,y=>{y?v():i.value=null},{immediate:!0});const g=k(!1),w=async()=>{var y,f;if(i.value){g.value=!0,c.errors={};try{const M=await window.axios.post(`/api/projects/${s.projectId}/deliverables/${s.deliverableId}/comments`,{comment_text:c.comment_text,context:c.context});c.comment_text="",c.context="",v(),n("deliverable-updated")}catch(M){console.error("Error adding comment:",M),M.response&&M.response.status===422?c.errors=M.response.data.errors:console.error("Failed to add comment:",((f=(y=M.response)==null?void 0:y.data)==null?void 0:f.message)||M.message)}finally{g.value=!1}}},C=R(()=>i.value?{"bg-yellow-100 text-yellow-800":i.value.status==="pending_review"||i.value.status==="revisions_requested","bg-green-100 text-green-800":i.value.status==="approved","bg-blue-100 text-blue-800":i.value.status==="completed","bg-gray-100 text-gray-800":i.value.status==="for_information"}:""),D=y=>{let f="No Action Yet",M="";return y.approved_at?(f="Approved",M=r(y.approved_at)):y.revisions_requested_at?(f="Revisions Requested",M=r(y.revisions_requested_at)):y.rejected_at?(f="Rejected",M=r(y.rejected_at)):y.read_at&&(f="Read",M=r(y.read_at)),{status:f,timestamp:M}},$=y=>y.creator_type==="App\\Models\\Client"?"Client":y.creator_type==="App\\Models\\User"?"Team Member":"Unknown";return(y,f)=>{var M;return a.value?(o(),d("div",Oc," Loading deliverable details... ")):u.value?(o(),d("div",Lc,h(u.value),1)):i.value?(o(),d("div",Uc,[e("div",Nc,[e("h4",Pc,h(i.value.title),1),e("div",Rc,[e("span",{class:ee(["px-2 py-1 rounded-full text-xs font-medium",C.value])},h(i.value.status.replace(/_/g," ").replace(/\b\w/g,V=>V.toUpperCase())),3),e("span",Fc," | "+h(i.value.type.replace(/_/g," "))+" | ",1),e("span",Bc," Submitted by: "+h(((M=i.value.team_member)==null?void 0:M.name)||"Unknown"),1)]),e("p",Hc,h(i.value.description||"No description provided."),1),e("div",Wc,[i.value.content_url?(o(),d("div",Yc,[e("a",{href:i.value.content_url,target:"_blank",rel:"noopener noreferrer"},"View Content Link ("+h(i.value.mime_type||"Unknown Type")+")",9,zc)])):E("",!0),i.value.attachment_path?(o(),d("div",qc,[e("a",{href:i.value.attachment_path,target:"_blank",rel:"noopener noreferrer"},"View Attachment",8,Gc)])):E("",!0),e("div",{class:ee(i.value.is_visible_to_client?"text-green-600":"text-red-600")}," Visibility: "+h(i.value.is_visible_to_client?"Visible to Client":"Not Visible to Client"),3),i.value.overall_approved_at?(o(),d("div",Kc," Overall Approved by Client on "+h(K(r)(i.value.overall_approved_at)),1)):E("",!0)])]),e("div",Jc,[f[3]||(f[3]=e("h5",{class:"text-lg font-semibold text-gray-800 border-b pb-2 mb-4"},"Client Interactions",-1)),i.value.client_interactions&&i.value.client_interactions.length>0?(o(),d("div",Zc,[(o(!0),d(J,null,Q(i.value.client_interactions,V=>{var P;return o(),d("div",{key:V.id,class:"p-3 bg-gray-50 rounded-md"},[e("p",Xc,h(((P=V.client)==null?void 0:P.name)||"Unknown Client"),1),e("p",Qc,[f[2]||(f[2]=H(" Status: ",-1)),e("span",em,h(D(V).status),1),D(V).timestamp?(o(),d("span",tm," ("+h(D(V).timestamp)+") ",1)):E("",!0)]),V.feedback_text?(o(),d("p",sm,'Feedback: "'+h(V.feedback_text)+'"',1)):E("",!0)])}),128))])):(o(),d("div",lm,"No client interactions recorded yet."))]),e("div",am,[e("div",im,[f[5]||(f[5]=e("h5",{class:"text-lg font-semibold text-gray-800"},"Comments",-1)),p(ue,{onClick:w,disabled:K(c).processing,class:"bg-indigo-600 hover:bg-indigo-700 transition-colors"},{default:N(()=>f[4]||(f[4]=[H(" Add Comment ",-1)])),_:1,__:[4]},8,["disabled"])]),e("div",nm,[e("div",null,[p(Y,{for:"new-comment-text",value:"New Comment",class:"sr-only"}),me(e("textarea",{id:"new-comment-text","onUpdate:modelValue":f[0]||(f[0]=V=>K(c).comment_text=V),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",rows:"3",placeholder:"Type your comment here..."},null,512),[[be,K(c).comment_text]]),p(le,{message:K(c).errors.comment_text,class:"mt-2"},null,8,["message"])]),e("div",null,[p(Y,{for:"comment-context",value:"Context (Optional, e.g., 'Paragraph 2', 'Image 1')",class:"sr-only"}),p(oe,{id:"comment-context",modelValue:K(c).context,"onUpdate:modelValue":f[1]||(f[1]=V=>K(c).context=V),type:"text",class:"mt-1 block w-full",placeholder:"Context (optional)"},null,8,["modelValue"]),p(le,{message:K(c).errors.context,class:"mt-2"},null,8,["message"])])]),i.value.comments&&i.value.comments.length>0?(o(),d("div",om,[(o(!0),d(J,null,Q(i.value.comments,V=>(o(),d("div",{key:V.id,class:"p-3 bg-gray-50 rounded-md"},[e("p",rm,h(V.content),1),e("p",dm,[H(" By "+h(V.creator_name||"Unknown")+" ("+h($(V))+") ",1),V.created_at?(o(),d("span",um,h(K(m)(V.created_at)),1)):E("",!0),V.context?(o(),d("span",cm,"("+h(V.context)+")",1)):E("",!0)])]))),128))])):(o(),d("div",mm,"No comments for this deliverable yet."))])])):(o(),d("div",vm," Select a deliverable to view details. "))}}},hm={class:"p-6 bg-white rounded-lg shadow-md min-h-[calc(100vh-6rem)]"},gm={class:"flex justify-between items-center mb-4"},ym={class:"mb-6 bg-gray-50 p-4 rounded-lg"},fm={class:"flex items-center gap-4"},bm={class:"flex-1 min-w-[200px]"},_m={key:0,class:"text-red-600 text-sm mt-2"},wm={key:1,class:"text-gray-600 text-sm mt-2 animate-pulse"},xm={key:2,class:"text-gray-500 text-sm mt-2"},km={class:"mt-6"},Dm={class:"flex justify-between items-center mb-3"},Cm={class:"text-md font-medium text-gray-800"},Em={key:0},$m={key:1},Sm={key:0,class:"text-center text-gray-600 text-sm animate-pulse py-8"},Mm={key:1,class:"text-center py-8"},Tm={class:"text-red-600 text-sm font-medium"},jm={key:2,class:"text-center py-8"},Vm={class:"text-red-600 text-sm font-medium"},Am={key:3,class:"space-y-8"},Im={class:"bg-gray-50 p-6 rounded-lg shadow-sm grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"},Om={class:"flex flex-col items-center p-3 bg-white rounded-md shadow-xs"},Lm={class:"text-lg font-semibold text-gray-900"},Um={class:"flex flex-col items-center p-3 bg-white rounded-md shadow-xs"},Nm={class:"text-lg font-semibold text-gray-900"},Pm={class:"flex flex-col items-center p-3 bg-white rounded-md shadow-xs"},Rm={class:"text-lg font-semibold text-gray-900"},Fm={class:"flex flex-col items-center p-3 bg-white rounded-md shadow-xs"},Bm={class:"text-lg font-semibold text-gray-900"},Hm={class:"flex flex-col items-center p-3 bg-white rounded-md shadow-xs"},Wm={class:"text-lg font-semibold text-gray-900"},Ym={class:"flex flex-col items-center p-3 bg-white rounded-md shadow-xs"},zm={class:"text-lg font-semibold text-gray-900"},qm={class:"flex flex-col items-center p-3 bg-white rounded-md shadow-xs"},Gm={class:"text-lg font-semibold text-gray-900"},Km={class:"bg-white p-6 rounded-lg shadow-sm"},Jm={class:"overflow-x-auto max-h-60"},Zm={class:"min-w-full divide-y divide-gray-200"},Xm={class:"bg-white divide-y divide-gray-200"},Qm={class:"px-4 py-3 text-sm text-gray-900"},ev={class:"px-4 py-3 text-sm text-gray-700"},tv={class:"px-4 py-3 text-sm text-gray-700"},sv={key:0,class:"text-gray-500 text-sm py-2"},lv={class:"bg-white p-6 rounded-lg shadow-sm"},av={class:"overflow-x-auto max-h-60"},iv={class:"min-w-full divide-y divide-gray-200"},nv={class:"bg-white divide-y divide-gray-200"},ov={class:"px-4 py-3 text-sm text-gray-900"},rv={class:"px-4 py-3 text-sm text-gray-700"},dv={class:"px-4 py-3 text-sm text-gray-700"},uv={class:"px-4 py-3 text-sm text-gray-700"},cv={class:"px-4 py-3 text-sm text-gray-700"},mv={key:0,class:"text-gray-500 text-sm py-2"},vv={class:"bg-white p-6 rounded-lg shadow-sm"},pv={class:"overflow-x-auto max-h-60"},hv={class:"min-w-full divide-y divide-gray-200"},gv={class:"bg-white divide-y divide-gray-200"},yv={class:"px-4 py-3 text-sm text-gray-900"},fv={class:"px-4 py-3 text-sm text-gray-700"},bv={key:0,class:"text-gray-500 text-sm py-2"},_v={class:"bg-white p-6 rounded-lg shadow-sm"},wv={class:"overflow-x-auto"},xv={class:"min-w-full divide-y divide-gray-200"},kv={class:"bg-white divide-y divide-gray-200"},Dv={class:"px-4 py-3 text-sm text-gray-900"},Cv={class:"px-4 py-3 text-sm text-gray-700"},Ev={key:0,class:"text-gray-500 text-sm py-2"},$v={class:"bg-white p-6 rounded-lg shadow-sm"},Sv={class:"overflow-x-auto"},Mv={class:"min-w-full divide-y divide-gray-200"},Tv={class:"bg-white divide-y divide-gray-200"},jv={class:"px-4 py-3 text-sm text-gray-900"},Vv={class:"px-4 py-3 text-sm text-gray-700"},Av={key:0,class:"text-gray-500 text-sm py-2"},Iv={class:"bg-white p-6 rounded-lg shadow-sm"},Ov={class:"overflow-x-auto max-h-60"},Lv={class:"min-w-full divide-y divide-gray-200"},Uv={class:"bg-white divide-y divide-gray-200"},Nv={class:"px-4 py-3 text-sm text-gray-900"},Pv={class:"px-4 py-3 text-sm text-gray-700"},Rv={key:0,class:"text-gray-500 text-sm py-2"},Fv={class:"bg-white p-6 rounded-lg shadow-sm grid grid-cols-1 md:grid-cols-2 gap-6"},Bv={key:0,class:"space-y-2"},Hv={class:"font-medium"},Wv={key:1,class:"text-gray-500 text-sm py-2"},Yv={key:0,class:"space-y-2"},zv={class:"font-medium"},qv={key:1,class:"text-gray-500 text-sm py-2"},Gv={key:4,class:"text-center py-8 text-gray-500"},Kv={__name:"SeoReportTab",props:{projectId:{type:[String,Number],required:!0},canCreateSeoReports:{type:Boolean,default:!1}},emits:["openCreateSeoReportModal"],setup(l,{emit:t}){const s=l,n=t,i=k([]),a=k(""),u=k(null),r=k(!0),m=k(!1),c=k(null),v=k(null),g=k(null),w=async()=>{r.value=!0,c.value=null;try{const B=await window.axios.get(`/api/projects/${s.projectId}/seo-reports/available-months`);i.value=B.data.map(A=>({value:A,label:new Date(A+"-01").toLocaleString("en-US",{year:"numeric",month:"long"})})),i.value.length>0&&(a.value=i.value[0].value)}catch(B){console.error("Error fetching available months:",B),c.value="Failed to load available report months."}finally{r.value=!1}},C=B=>{const S=["clientName","reportingPeriod","authorityScoreValue","totalClicksValue","totalImpressionsValue","averagePositionValue","totalBacklinksValue","clicksImpressions","trafficSources","deviceUsage","countryPerformance","coreVitals","topQueries","keywordRankings","backlinks","zeroClickKeywords"].filter(O=>!(O in B));return S.length>0?`Report data is missing expected top-level keys: ${S.join(", ")}. Please ensure the JSON structure is correct.`:!B.clicksImpressions||!Array.isArray(B.clicksImpressions.labels)||!Array.isArray(B.clicksImpressions.clicks)?"clicksImpressions data is malformed.":!B.trafficSources||!Array.isArray(B.trafficSources.labels)||!Array.isArray(B.trafficSources.sessions)?"trafficSources data is malformed.":null},D=async()=>{if(!a.value){u.value=null,g.value=null;return}m.value=!0,v.value=null,g.value=null;try{const A=(await window.axios.get(`/api/projects/${s.projectId}/seo-reports/${a.value}`)).data,S=C(A);S?(g.value=S,u.value=null):u.value=A}catch(B){console.error("Error fetching SEO report:",B),v.value="Failed to load SEO report for the selected month.",u.value=null,g.value=null}finally{m.value=!1}},$=(B=null)=>{n("openCreateSeoReportModal",B)},y=R(()=>{var B;return((B=u.value)==null?void 0:B.clientName)||"N/A"}),f=R(()=>{var B;return((B=u.value)==null?void 0:B.reportingPeriod)||"N/A"}),M=R(()=>{var B;return((B=u.value)==null?void 0:B.authorityScoreValue)||"N/A"}),V=R(()=>{var B;return((B=u.value)==null?void 0:B.totalClicksValue)||"N/A"}),P=R(()=>{var B;return((B=u.value)==null?void 0:B.totalImpressionsValue)||"N/A"}),U=R(()=>{var B;return((B=u.value)==null?void 0:B.averagePositionValue)||"N/A"}),T=R(()=>{var B;return((B=u.value)==null?void 0:B.totalBacklinksValue)||"N/A"}),I=R(()=>{var B;return((B=u.value)==null?void 0:B.clicksImpressions)||{labels:[],clicks:[],impressions:[]}}),b=R(()=>{var B;return((B=u.value)==null?void 0:B.trafficSources)||{labels:[],sessions:[],colors:[]}}),_=R(()=>{var B;return((B=u.value)==null?void 0:B.deviceUsage)||{labels:[],clicks:[],colors:[]}}),x=R(()=>{var B;return((B=u.value)==null?void 0:B.countryPerformance)||{labels:[],clicks:[]}}),j=R(()=>{var B;return((B=u.value)==null?void 0:B.coreVitals)||{mobile:{},desktop:{}}}),Z=R(()=>{var B;return((B=u.value)==null?void 0:B.topQueries)||[]}),ie=R(()=>{var B;return((B=u.value)==null?void 0:B.keywordRankings)||[]});return fe(()=>{w()}),de(()=>s.projectId,()=>{w()}),de(a,B=>{B?D():(u.value=null,g.value=null)}),(B,A)=>(o(),d("div",hm,[e("div",gm,[A[4]||(A[4]=e("h4",{class:"text-lg font-semibold text-gray-900"},"SEO Reports",-1)),l.canCreateSeoReports?(o(),X(ue,{key:0,onClick:A[0]||(A[0]=S=>$()),class:"bg-indigo-600 hover:bg-indigo-700 transition-colors"},{default:N(()=>A[3]||(A[3]=[H(" Add New Report ",-1)])),_:1,__:[3]})):E("",!0)]),e("div",ym,[e("div",fm,[e("div",bm,[p(Y,{for:"seo-report-month-filter",value:"Select Report Month"}),p(he,{id:"seo-report-month-filter",modelValue:a.value,"onUpdate:modelValue":A[1]||(A[1]=S=>a.value=S),options:i.value,"value-key":"value","label-key":"label",placeholder:"Select a month",disabled:r.value||i.value.length===0,class:"mt-1"},null,8,["modelValue","options","disabled"])])]),c.value?(o(),d("div",_m,h(c.value),1)):E("",!0),r.value?(o(),d("div",wm,"Loading available months...")):E("",!0),!r.value&&i.value.length===0?(o(),d("div",xm,"No SEO reports available for this project.")):E("",!0)]),e("div",km,[e("div",Dm,[e("h5",Cm,[a.value?(o(),d("span",Em,"Report for "+h(new Date(a.value+"-01").toLocaleString("en-US",{year:"numeric",month:"long"})),1)):(o(),d("span",$m,"Select a month to view report"))]),l.canCreateSeoReports&&u.value&&a.value?(o(),X(ue,{key:0,onClick:A[2]||(A[2]=S=>$({report_date:a.value,data:JSON.stringify(u.value,null,2)})),class:"bg-blue-500 hover:bg-blue-600 transition-colors text-sm py-1 px-3"},{default:N(()=>A[5]||(A[5]=[H(" Edit Report ",-1)])),_:1,__:[5]})):E("",!0)]),m.value?(o(),d("div",Sm," Loading SEO report data... ")):v.value?(o(),d("div",Mm,[e("p",Tm,h(v.value),1)])):g.value?(o(),d("div",jm,[e("p",Vm,"Data Structure Error: "+h(g.value),1),A[6]||(A[6]=e("p",{class:"text-gray-500 text-sm mt-2"},"Please ensure the JSON data conforms to the expected format.",-1))])):u.value?(o(),d("div",Am,[e("div",Im,[e("div",Om,[A[7]||(A[7]=e("p",{class:"text-sm text-gray-500"},"Client Name",-1)),e("p",Lm,h(y.value),1)]),e("div",Um,[A[8]||(A[8]=e("p",{class:"text-sm text-gray-500"},"Reporting Period",-1)),e("p",Nm,h(f.value),1)]),e("div",Pm,[A[9]||(A[9]=e("p",{class:"text-sm text-gray-500"},"Authority Score",-1)),e("p",Rm,h(M.value),1)]),e("div",Fm,[A[10]||(A[10]=e("p",{class:"text-sm text-gray-500"},"Total Clicks",-1)),e("p",Bm,h(V.value),1)]),e("div",Hm,[A[11]||(A[11]=e("p",{class:"text-sm text-gray-500"},"Total Impressions",-1)),e("p",Wm,h(P.value),1)]),e("div",Ym,[A[12]||(A[12]=e("p",{class:"text-sm text-gray-500"},"Average Position",-1)),e("p",zm,h(U.value),1)]),e("div",qm,[A[13]||(A[13]=e("p",{class:"text-sm text-gray-500"},"Total Backlinks",-1)),e("p",Gm,h(T.value),1)])]),e("div",Km,[A[15]||(A[15]=e("h5",{class:"text-lg font-semibold text-gray-800 border-b pb-2 mb-4"},"Clicks & Impressions Trend",-1)),e("div",Jm,[e("table",Zm,[A[14]||(A[14]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Date"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Clicks"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Impressions")])],-1)),e("tbody",Xm,[(o(!0),d(J,null,Q(I.value.labels,(S,O)=>(o(),d("tr",{key:O},[e("td",Qm,h(S),1),e("td",ev,h(I.value.clicks[O]),1),e("td",tv,h(I.value.impressions[O]),1)]))),128))])])]),I.value.labels.length?E("",!0):(o(),d("p",sv,"No clicks and impressions data available."))]),e("div",lv,[A[17]||(A[17]=e("h5",{class:"text-lg font-semibold text-gray-800 border-b pb-2 mb-4"},"Top Queries",-1)),e("div",av,[e("table",iv,[A[16]||(A[16]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Query"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Clicks"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Impressions"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"CTR"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Position")])],-1)),e("tbody",nv,[(o(!0),d(J,null,Q(Z.value,S=>(o(),d("tr",{key:S.query},[e("td",ov,h(S.query),1),e("td",rv,h(S.clicks),1),e("td",dv,h(S.impressions),1),e("td",uv,h(S.ctr)+"%",1),e("td",cv,h(S.position),1)]))),128))])])]),Z.value.length?E("",!0):(o(),d("p",mv,"No top queries data available."))]),e("div",vv,[A[19]||(A[19]=e("h5",{class:"text-lg font-semibold text-gray-800 border-b pb-2 mb-4"},"Keyword Rankings",-1)),e("div",pv,[e("table",hv,[A[18]||(A[18]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Keyword"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Ranking")])],-1)),e("tbody",gv,[(o(!0),d(J,null,Q(ie.value,S=>(o(),d("tr",{key:S.keyword},[e("td",yv,h(S.keyword),1),e("td",fv,h(S.ranking),1)]))),128))])])]),ie.value.length?E("",!0):(o(),d("p",bv,"No keyword rankings data available."))]),e("div",_v,[A[21]||(A[21]=e("h5",{class:"text-lg font-semibold text-gray-800 border-b pb-2 mb-4"},"Traffic Sources",-1)),e("div",wv,[e("table",xv,[A[20]||(A[20]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Source"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Sessions")])],-1)),e("tbody",kv,[(o(!0),d(J,null,Q(b.value.labels,(S,O)=>(o(),d("tr",{key:S},[e("td",Dv,h(S),1),e("td",Cv,h(b.value.sessions[O]),1)]))),128))])])]),b.value.labels.length?E("",!0):(o(),d("p",Ev,"No traffic sources data available."))]),e("div",$v,[A[23]||(A[23]=e("h5",{class:"text-lg font-semibold text-gray-800 border-b pb-2 mb-4"},"Device Usage",-1)),e("div",Sv,[e("table",Mv,[A[22]||(A[22]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Device"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Clicks")])],-1)),e("tbody",Tv,[(o(!0),d(J,null,Q(_.value.labels,(S,O)=>(o(),d("tr",{key:S},[e("td",jv,h(S),1),e("td",Vv,h(_.value.clicks[O]),1)]))),128))])])]),_.value.labels.length?E("",!0):(o(),d("p",Av,"No device usage data available."))]),e("div",Iv,[A[25]||(A[25]=e("h5",{class:"text-lg font-semibold text-gray-800 border-b pb-2 mb-4"},"Country Performance (Top 10)",-1)),e("div",Ov,[e("table",Lv,[A[24]||(A[24]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Country"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Clicks")])],-1)),e("tbody",Uv,[(o(!0),d(J,null,Q(x.value.labels,S=>(o(),d("tr",{key:S},[e("td",Nv,h(S),1),e("td",Pv,h(x.value.clicks[x.value.labels.indexOf(S)]),1)]))),128))])])]),x.value.labels.length?E("",!0):(o(),d("p",Rv,"No country performance data available."))]),e("div",Fv,[e("div",null,[A[26]||(A[26]=e("h5",{class:"text-lg font-semibold text-gray-800 border-b pb-2 mb-4"},"Core Vitals (Mobile)",-1)),j.value.mobile&&j.value.mobile.labels&&j.value.mobile.labels.length?(o(),d("div",Bv,[(o(!0),d(J,null,Q(j.value.mobile.labels,(S,O)=>(o(),d("div",{key:S,class:"flex justify-between items-center text-sm text-gray-700"},[e("span",null,h(S)+":",1),e("span",Hv,h(j.value.mobile.scores[O]),1)]))),128))])):(o(),d("p",Wv,"No mobile core vitals data available."))]),e("div",null,[A[27]||(A[27]=e("h5",{class:"text-lg font-semibold text-gray-800 border-b pb-2 mb-4"},"Core Vitals (Desktop)",-1)),j.value.desktop&&j.value.desktop.labels&&j.value.desktop.labels.length?(o(),d("div",Yv,[(o(!0),d(J,null,Q(j.value.desktop.labels,(S,O)=>(o(),d("div",{key:S,class:"flex justify-between items-center text-sm text-gray-700"},[e("span",null,h(S)+":",1),e("span",zv,h(j.value.desktop.scores[O]),1)]))),128))])):(o(),d("p",qv,"No desktop core vitals data available."))])])])):(o(),d("div",Gv," No report data to display. Please select a month from the dropdown. "))])]))}},Jv=Ee(Kv,[["__scopeId","data-v-37cb2f02"]]),Zv={class:"space-y-4"},Xv={key:0,class:"text-xs text-gray-500 mt-1 text-red-500"},Qv=["onBlur"],ep={__name:"CreateSeoReportModal",props:{show:{type:Boolean,default:!1},projectId:{type:[String,Number],required:!0},initialData:{type:Object,default:null}},emits:["close","saved"],setup(l,{emit:t}){const s=l,n=t,i=ke({report_date:"",data:""}),a=k(null);de(()=>[s.show,s.initialData],([y,f])=>{y&&(f?Object.assign(i,{report_date:f.report_date||"",data:f.data||""}):Object.assign(i,{report_date:"",data:""}))},{immediate:!0});const u=y=>{let f=y.data;try{f=JSON.stringify(JSON.parse(y.data))}catch{console.warn("Provided data is not valid JSON, sending as plain string. Backend should validate.")}return{report_date:y.report_date,data:f}},r=R(()=>s.initialData?"Edit SEO Report":"Create New SEO Report"),m=R(()=>`/api/projects/${s.projectId}/seo-reports`),c=R(()=>"post"),v=R(()=>s.initialData?"Update Report":"Create Report"),g=R(()=>s.initialData?"SEO Report updated successfully!":"SEO Report created successfully!"),w=y=>{n("saved",y),n("close")},C=()=>{n("close")},D=()=>{try{const y=JSON.parse(i.data);i.data=JSON.stringify(y,null,2)}catch(y){console.error("Invalid JSON for pretty print:",y)}},$=y=>{if(i.data)try{JSON.parse(i.data),y.data&&y.data[0]==="The data field must be a valid JSON string."&&(y.data=[])}catch{(!y.data||y.data.length===0)&&(y.data=["The data field must be a valid JSON string."])}};return(y,f)=>(o(),X(Ce,{show:l.show,title:r.value,"api-endpoint":m.value,"http-method":c.value,"form-data":i,"submit-button-text":v.value,"success-message":g.value,"format-data-for-api":u,onClose:C,onSubmitted:w},{default:N(({errors:M})=>[e("div",Zv,[e("div",null,[p(Y,{for:"report_date",value:"Report Month (YYYY-MM)"}),p(oe,{id:"report_date",modelValue:i.report_date,"onUpdate:modelValue":f[0]||(f[0]=V=>i.report_date=V),type:"text",class:"mt-1 block w-full",placeholder:"e.g., 2025-07",required:"",autofocus:"",pattern:"\\d{4}-\\d{2}",title:"Please enter a date in YYYY-MM format (e.g., 2025-07)",disabled:!!l.initialData},null,8,["modelValue","disabled"]),p(le,{message:M.report_date?M.report_date[0]:"",class:"mt-2"},null,8,["message"]),f[2]||(f[2]=e("p",{class:"text-xs text-gray-500 mt-1"},"Enter the report month in YYYY-MM format (e.g., 2025-07).",-1)),l.initialData?(o(),d("p",Xv,"Note: Report month cannot be changed when editing.")):E("",!0)]),e("div",null,[p(Y,{for:"report_data",value:"Report Data (JSON)"}),me(e("textarea",{id:"report_data",ref_key:"jsonInputRef",ref:a,"onUpdate:modelValue":f[1]||(f[1]=V=>i.data=V),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 font-mono",rows:"10",placeholder:'Enter JSON data for the report, e.g., {"keywords_ranked": 150, "traffic": 1200, "rankings": {"keyword1": 5, "keyword2": 12}}',required:"",onBlur:V=>$(M)},null,40,Qv),[[be,i.data]]),p(le,{message:M.data?M.data[0]:"",class:"mt-2"},null,8,["message"]),e("div",{class:"flex justify-end mt-2"},[e("button",{type:"button",onClick:D,class:"text-sm text-indigo-600 hover:text-indigo-800 font-medium"}," Format JSON ")])])])]),_:1},8,["show","title","api-endpoint","http-method","form-data","submit-button-text","success-message"]))}},tp={class:"py-8 max-w-full mx-auto px-4 sm:px-6 lg:px-8"},sp={key:0,class:"text-center text-gray-600 text-lg animate-pulse"},lp={key:1,class:"text-center text-red-600 text-lg font-medium"},ap={key:2,class:"space-y-8"},ip={class:"flex justify-end items-center mb-5"},np={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"},op={key:1},rp={key:0,class:"bg-white p-6 rounded-xl shadow-md hover:shadow-lg transition-shadow mb-6"},dp={class:"flex justify-between items-center mb-4"},up={class:"overflow-x-auto"},cp={class:"min-w-full divide-y divide-gray-200"},mp={class:"bg-white divide-y divide-gray-200"},vp={class:"px-4 py-3 text-sm text-gray-900"},pp={class:"px-4 py-3 text-sm text-gray-700"},hp={class:"px-4 py-3 text-sm text-gray-700"},gp={class:"px-4 py-3 text-right"},yp=["onClick"],fp={key:1,class:"bg-white p-6 rounded-xl shadow-md hover:shadow-lg transition-shadow mb-6"},bp={class:"flex justify-between items-center mb-4"},_p={key:2,class:"bg-white p-6 rounded-xl shadow-md hover:shadow-lg transition-shadow mb-6"},wp={class:"flex justify-between items-center mb-4"},xp={key:0,class:"text-gray-400 text-sm"},kp={key:1,class:"overflow-x-auto"},Dp={class:"min-w-full divide-y divide-gray-200"},Cp={class:"bg-white divide-y divide-gray-200"},Ep={class:"px-4 py-3 text-sm text-gray-900"},$p={class:"px-4 py-3 text-sm text-gray-700"},Sp={class:"px-4 py-3 text-sm text-gray-700"},Mp={class:"px-4 py-3 text-sm text-gray-700"},Tp={class:"px-4 py-3 text-sm text-gray-700"},jp={class:"px-4 py-3 text-right"},Vp={key:3,class:"bg-white p-6 rounded-xl shadow-md hover:shadow-lg transition-shadow mb-6"},Ap={class:"flex justify-between items-center mb-4"},Ip={class:"flex items-center gap-4"},Op={key:0},Lp={key:0,class:"space-y-4"},Up={class:"flex justify-between"},Np={class:"flex-grow"},Pp={key:0,class:"text-xs text-red-400 block mt-1"},Rp={class:"flex items-center mt-1"},Fp={class:"text-xs text-gray-500"},Bp={key:0,class:"ml-2 px-2 py-0.5 bg-indigo-100 text-indigo-800 text-xs rounded-full"},Hp={key:0},Wp={key:1,class:"text-gray-400 text-sm"},Yp={__name:"Show",setup(l){const t=Ue(),s=as().props.id,n=k({clients:[],users:[],notes:[],transactions:[],documents:[],meetings:[],tasks:[],emails:[],deliverables:[]}),i=k(!0),a=k(""),u=k(!1),r=k(!1),m=k(!1),c=k(!1),v=k(!1),g=k(!1),w=k(!1),C=k(!1),D=k(!1),$=k(null),y=k(null),f=k(!1),M=k(!1),V=k(null),P=[{value:"active",label:"Active"},{value:"completed",label:"Completed"},{value:"on_hold",label:"On Hold"},{value:"archived",label:"Archived"}],U=[{value:"Website Designing",label:"Website Designing"},{value:"SEO",label:"SEO"},{value:"Social Media",label:"Social Media"},{value:"Content Writing",label:"Content Writing"},{value:"Graphic Design",label:"Graphic Design"}],T=[{value:"UpWork",label:"UpWork"},{value:"Direct",label:"Direct Client"},{value:"Wix Marketplace",label:"Wix Marketplace"},{value:"Referral",label:"Referral"}],I=k(null),b=k(null),_=is(n),{canDo:x,canView:j}=et(s),Z=R(()=>{var te,W;return((W=(te=t.value)==null?void 0:te.role_data)==null?void 0:W.slug)==="super-admin"}),ie=R(()=>x("manage_projects").value||Z.value),B=R(()=>x("edit_projects").value||Z.value),A=R(()=>j("emails").value),S=R(()=>x("compose_emails").value),O=R(()=>x("approve_emails").value),z=R(()=>j("project_notes").value),re=R(()=>x("add_project_notes").value),Me=R(()=>j("deliverables").value),F=R(()=>x("create_deliverables").value),L=R(()=>j("seo_reports").value),q=R(()=>x("create_seo_reports").value),ae=R(()=>j("client_contacts").value);R(()=>j("users").value);const Pe=R(()=>j("project_financial",_).value),tt=R(()=>j("project_transactions").value);R(()=>j("client_financial").value);const Ct=[{value:"PKR",label:"PKR"},{value:"AUD",label:"AUD"},{value:"INR",label:"INR"},{value:"USD",label:"USD"},{value:"EUR",label:"EUR"},{value:"GBP",label:"GBP"}],qe=k([]),Et=async()=>{try{const te=await window.axios.get(`/api/projects/${s}/due-and-overdue-tasks`);qe.value=te.data}catch(te){console.error("Error fetching due and overdue tasks:",te)}},st=R(()=>n.value.notes?[...n.value.notes].filter(te=>te.type!=="standup").sort((te,W)=>new Date(W.created_at)-new Date(te.created_at)).slice(0,3):[]),lt=k([]),Ge=async()=>{try{const te=await window.axios.get(`/api/projects/${s}/emails-simplified`,{params:{limit:5}});lt.value=te.data}catch(te){console.error("Error fetching latest emails:",te)}},De=async()=>{i.value=!0,a.value="";try{const te=await window.axios.get(`/api/projects/${s}`);n.value=te.data,console.log("Full project data received (Show.vue main fetch):",n.value),await Et()}catch(te){a.value="Failed to load project data.",console.error("Error fetching project data:",te),te.response&&(te.response.status===401||te.response.status===403)&&(a.value="You are not authorized to view this project or your session expired. Please log in.")}finally{i.value=!1}},$t=te=>{n.value=te,u.value=!1,De()},St=te=>{n.value.tasks=te},Mt=te=>{n.value.emails=te,A.value&&Ge()},at=te=>{n.value.notes=te},Tt=()=>{De()},jt=()=>{I.value&&I.value.fetchMeetings()},it=()=>{De()},Vt=te=>{b.value=te,Ke(),ot()},At=()=>{g.value=!0},It=()=>{w.value=!0,b.value="emails"},Ot=async()=>{w.value=!1,await De(),A.value&&await Ge()},Lt=()=>{w.value=!1},nt=te=>{$.value=te,y.value=null,D.value=!0},Ke=()=>{D.value=!1,$.value=null},Ut=()=>{De()},Nt=te=>{n.value.tasks=n.value.tasks.filter(W=>W.id!==te),De(),Ke()},Pt=te=>{y.value=te,$.value=null,D.value=!0},ot=()=>{D.value=!1,y.value=null},Rt=()=>{De()},Ft=()=>{f.value=!0},Bt=()=>{f.value=!1,De()},Ht=(te=null)=>{V.value=te,M.value=!0},Wt=()=>{M.value=!1};return fe(async()=>{console.log("Show.vue mounted, fetching initial data...");try{await ns(s),console.log("Project permissions fetched (includes global)")}catch(te){console.error(`Error fetching permissions for project ${s}:`,te)}await ds(),await De(),A.value&&await Ge()}),(te,W)=>{const Yt=je("SecondaryButton");return o(),d(J,null,[p(K(os),{title:n.value.name||"Project Details"},null,8,["title"]),p(Zt,null,{default:N(()=>{var rt;return[e("div",tp,[i.value?(o(),d("div",sp," Loading project details... ")):a.value?(o(),d("div",lp,h(a.value),1)):(o(),d("div",ap,[p(ln,{project:n.value,"project-id":K(s),"can-manage-projects":ie.value,"is-super-admin":Z.value,"can-edit-projects":B.value,onOpenEditModal:W[0]||(W[0]=G=>u.value=!0),onOpenStandupModal:W[1]||(W[1]=G=>m.value=!0),onOpenMeetingModal:W[2]||(W[2]=G=>r.value=!0),onOpenMagicLinkModal:W[3]||(W[3]=G=>v.value=!0),onResourceSaved:De,onOpenComposeModal:It},null,8,["project","project-id","can-manage-projects","is-super-admin","can-edit-projects"]),p(ks,{"project-id":K(s),ref_key:"meetingsListComponent",ref:I},null,8,["project-id"]),p(pn,{tasks:n.value.tasks||[],emails:n.value.emails||[]},null,8,["tasks","emails"]),e("div",ip,[p(he,{id:"display-currency-switcher",modelValue:K(He),"onUpdate:modelValue":W[4]||(W[4]=G=>rs(He)?He.value=G:null),options:Ct,"value-key":"value","label-key":"label",class:"w-20",containerClasses:"max-w-[150px]"},null,8,["modelValue"])]),Pe.value&&tt.value?(o(),X(iu,{key:0,"project-id":K(s),"can-view-project-services-and-payments":Pe.value,"can-view-project-transactions":tt.value},null,8,["project-id","can-view-project-services-and-payments","can-view-project-transactions"])):E("",!0),e("div",np,[ae.value?(o(),X(mu,{key:0,"project-id":K(s),"can-view-client-contacts":ae.value},null,8,["project-id","can-view-client-contacts"])):E("",!0),p(wu,{"project-id":K(s),"can-view-users":!0},null,8,["project-id"]),p(Lu,{"project-id":K(s),onViewUserTransactions:At},null,8,["project-id"])]),p(fn,{selectedTab:b.value,"onUpdate:selectedTab":W[5]||(W[5]=G=>b.value=G),"can-view-emails":A.value,"can-view-notes":z.value,"can-view-deliverables":Me.value,"can-view-seo-reports":L.value},null,8,["selectedTab","can-view-emails","can-view-notes","can-view-deliverables","can-view-seo-reports"]),b.value===null?(o(),d("div",op,[qe.value.length>0?(o(),d("div",rp,[e("div",dp,[W[25]||(W[25]=e("h4",{class:"text-lg font-semibold text-gray-900"},"Due & Overdue Tasks",-1)),e("button",{onClick:W[6]||(W[6]=G=>b.value="tasks"),class:"text-sm text-indigo-600 hover:text-indigo-800 font-medium"}," View All Tasks → ")]),e("div",up,[e("table",cp,[W[26]||(W[26]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Title"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Status"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Assigned To"),e("th",{class:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"Actions")])],-1)),e("tbody",mp,[(o(!0),d(J,null,Q(qe.value,G=>{var Te;return o(),d("tr",{key:G.id,class:"hover:bg-gray-50 transition-colors"},[e("td",vp,h(G.name),1),e("td",pp,[e("span",{class:ee({"px-2 py-1 rounded-full text-xs font-medium":!0,"bg-yellow-100 text-yellow-800":G.status==="To Do","bg-blue-100 text-blue-800":G.status==="In Progress","bg-green-100 text-green-800":G.status==="Done","bg-red-100 text-red-800":G.status==="Blocked","bg-gray-100 text-gray-800":G.status==="Archived"})},h(G.status),3)]),e("td",hp,h((Te=G.assigned_to)==null?void 0:Te.name),1),e("td",gp,[e("button",{onClick:dt=>nt(G.id),class:"text-indigo-600 hover:text-indigo-800 text-sm font-medium"}," View/Edit ",8,yp)])])}),128))])])])])):(o(),d("div",fp,[e("div",bp,[W[27]||(W[27]=e("h4",{class:"text-lg font-semibold text-gray-900"},"Due & Overdue Tasks",-1)),e("button",{onClick:W[7]||(W[7]=G=>b.value="tasks"),class:"text-sm text-indigo-600 hover:text-indigo-800 font-medium"}," View All Tasks → ")]),W[28]||(W[28]=e("p",{class:"text-gray-400 text-sm"},"No due or overdue tasks.",-1))])),A.value?(o(),d("div",_p,[e("div",wp,[W[29]||(W[29]=e("h4",{class:"text-lg font-semibold text-gray-900"},"Latest Emails",-1)),e("button",{onClick:W[8]||(W[8]=G=>b.value="emails"),class:"text-sm text-indigo-600 hover:text-indigo-800 font-medium"}," View All Emails → ")]),(rt=n.value.emails)!=null&&rt.length?(o(),d("div",kp,[e("table",Dp,[W[31]||(W[31]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Subject"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"From"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Date"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Type"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Status"),e("th",{class:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"Actions")])],-1)),e("tbody",Cp,[(o(!0),d(J,null,Q(lt.value,G=>{var Te;return o(),d("tr",{key:G.id,class:"hover:bg-gray-50 transition-colors"},[e("td",Ep,h(G.subject),1),e("td",$p,h(((Te=G.sender)==null?void 0:Te.name)||"N/A"),1),e("td",Sp,h(new Date(G.created_at).toLocaleDateString()),1),e("td",Mp,[e("span",{class:ee({"px-2 py-1 rounded-full text-xs font-medium":!0,"bg-blue-100 text-blue-800":G.type==="sent","bg-purple-100 text-purple-800":G.type==="received"})},h(G.type?G.type.toUpperCase():"N/A"),3)]),e("td",Tp,[e("span",{class:ee({"px-2 py-1 rounded-full text-xs font-medium":!0,"bg-green-100 text-green-800":G.status==="sent","bg-yellow-100 text-yellow-800":G.status==="pending_approval","bg-blue-200 text-blue-900":G.status==="pending_approval_received","bg-red-100 text-red-800":G.status==="rejected","bg-gray-100 text-gray-800":G.status==="draft"})},h(G.status.replace("_"," ").toUpperCase()),3)]),e("td",jp,[p(Yt,{class:"text-indigo-600 hover:text-indigo-800",onClick:dt=>te.viewEmail(G)},{default:N(()=>W[30]||(W[30]=[H(" View ",-1)])),_:2,__:[30]},1032,["onClick"])])])}),128))])])])):(o(),d("div",xp,"No email communication found."))])):E("",!0),z.value?(o(),d("div",Vp,[e("div",Ap,[W[33]||(W[33]=e("h4",{class:"text-lg font-semibold text-gray-900"},"Latest Notes",-1)),e("div",Ip,[e("button",{onClick:W[9]||(W[9]=G=>b.value="notes"),class:"text-sm text-indigo-600 hover:text-indigo-800 font-medium"}," View All Notes → "),re.value?(o(),d("div",Op,[p(ue,{class:"bg-indigo-600 hover:bg-indigo-700 transition-colors",onClick:W[10]||(W[10]=G=>c.value=!0)},{default:N(()=>W[32]||(W[32]=[H(" Add Note ",-1)])),_:1,__:[32]})])):E("",!0)])]),st.value.length?(o(),d("div",Lp,[(o(!0),d(J,null,Q(st.value,G=>{var Te;return o(),d("div",{key:G.id,class:"p-4 bg-gray-50 rounded-md shadow-sm hover:bg-gray-100 transition-colors"},[e("div",Up,[e("div",Np,[e("p",{class:ee(["text-sm",{"text-gray-700":G.content!=="[Encrypted content could not be decrypted]","text-red-500 italic":G.content==="[Encrypted content could not be decrypted]"}])},[H(h(G.content)+" ",1),G.content==="[Encrypted content could not be decrypted]"?(o(),d("span",Pp," (There was an issue decrypting this note. Please contact an administrator.) ")):E("",!0)],2),e("div",Rp,[e("p",Fp,"Added by "+h(((Te=G.user)==null?void 0:Te.name)||"Unknown")+" on "+h(new Date(G.created_at).toLocaleDateString()),1),G.reply_count>0?(o(),d("span",Bp,h(G.reply_count)+" "+h(G.reply_count===1?"reply":"replies"),1)):E("",!0)])]),z.value&&G.chat_message_id&&n.value.google_chat_id?(o(),d("div",Hp,[e("button",{onClick:W[11]||(W[11]=dt=>b.value="notes"),class:"text-sm text-indigo-600 hover:text-indigo-800 font-medium"}," View ")])):E("",!0)])])}),128))])):(o(),d("p",Wp,"No notes available."))])):E("",!0)])):E("",!0),b.value==="tasks"?(o(),X(bo,{key:2,"project-id":K(s),"project-users":n.value.users||[],"can-manage-projects":ie.value,onTasksUpdated:St,onOpenTaskDetailSidebar:nt,onOpenCreateTaskModal:Ft},null,8,["project-id","project-users","can-manage-projects"])):E("",!0),b.value==="emails"?(o(),X(dd,{key:3,"project-id":K(s),"can-view-emails":A.value,"can-compose-emails":S.value,"can-approve-emails":O.value,"user-project-role":K(_),"open-compose":w.value,onEmailsUpdated:Mt,onResetOpenCompose:W[12]||(W[12]=G=>w.value=!1)},null,8,["project-id","can-view-emails","can-compose-emails","can-approve-emails","user-project-role","open-compose"])):E("",!0),b.value==="standups"?(o(),X(ja,{key:4,projectId:K(s),users:n.value.users||[],onStandupAdded:it},null,8,["projectId","users"])):E("",!0),b.value==="notes"?(o(),X(Wd,{key:5,"project-id":K(s),"google-chat-id":n.value.google_chat_id,"can-view-notes":z.value,"can-add-notes":re.value,onNotesUpdated:at,onChangeTab:Vt},null,8,["project-id","google-chat-id","can-view-notes","can-add-notes"])):E("",!0),b.value==="deliverables"?(o(),X(Ic,{key:6,"project-id":K(s),"can-create-deliverables":F.value,"can-view-deliverables":Me.value,onDeliverablesUpdated:Tt,onOpenDeliverableDetailSidebar:Pt},null,8,["project-id","can-create-deliverables","can-view-deliverables"])):E("",!0),b.value==="seo-reports"?(o(),X(Jv,{key:7,"project-id":K(s),"can-create-seo-reports":q.value,onOpenCreateSeoReportModal:Ht},null,8,["project-id","can-create-seo-reports"])):E("",!0)]))]),p(Se,{show:u.value,onClose:W[14]||(W[14]=G=>u.value=!1)},{default:N(()=>[p(us,{show:u.value,project:n.value,statusOptions:P,departmentOptions:U,sourceOptions:T,clientRoleOptions:[],userRoleOptions:[],paymentTypeOptions:[],onClose:W[13]||(W[13]=G=>u.value=!1),onSubmit:$t},null,8,["show","project"])]),_:1},8,["show"]),p(za,{show:r.value,onClose:W[15]||(W[15]=G=>r.value=!1),onSaved:jt,projectId:K(s),projectUsers:n.value.users||[]},null,8,["show","projectId","projectUsers"]),p(yt,{show:m.value,onClose:W[16]||(W[16]=G=>m.value=!1),onStandupAdded:it,projectId:K(s)},null,8,["show","projectId"]),p(ft,{show:c.value,"project-id":K(s),onClose:W[17]||(W[17]=G=>c.value=!1),onNoteAdded:at},null,8,["show","project-id"]),p(Qa,{show:v.value,"project-id":K(s),"project-clients":n.value.clients||[],onClose:W[18]||(W[18]=G=>v.value=!1)},null,8,["show","project-id","project-clients"]),p(Ku,{show:g.value,"project-id":K(s),"project-name":n.value.name,onClose:W[19]||(W[19]=G=>g.value=!1)},null,8,["show","project-id","project-name"]),p(kt,{show:w.value,"project-id":K(s),"user-project-role":K(_),onClose:Lt,onSubmitted:Ot,onError:W[20]||(W[20]=G=>console.error("Error composing email:",G))},null,8,["show","project-id","user-project-role"]),p(Gt,{show:D.value,"onUpdate:show":W[21]||(W[21]=G=>D.value=G),title:$.value?"Task Details":y.value?"Deliverable Details":"Details",initialWidth:50},{content:N(()=>[$.value?(o(),X(Kt,{key:0,"task-id":$.value,"project-users":n.value.users||[],onClose:Ke,onTaskUpdated:Ut,onTaskDeleted:Nt},null,8,["task-id","project-users"])):y.value?(o(),X(pm,{key:1,"project-id":K(s),"deliverable-id":y.value,onClose:ot,onDeliverableUpdated:Rt},null,8,["project-id","deliverable-id"])):E("",!0)]),_:1},8,["show","title"]),p(Jt,{show:f.value,"project-id":K(s),onClose:W[22]||(W[22]=G=>f.value=!1),onSaved:Bt},null,8,["show","project-id"]),p(Dt,{show:C.value,"project-id":K(s),onClose:W[23]||(W[23]=G=>C.value=!1),onSaved:te.handleDeliverableSaved},null,8,["show","project-id","onSaved"]),p(ep,{"project-id":K(s),show:M.value,"initial-data":V.value,onClose:W[24]||(W[24]=G=>M.value=!1),onSaved:Wt},null,8,["project-id","show","initial-data"])]}),_:1})],64)}}},ah=Ee(Yp,[["__scopeId","data-v-4fb56b07"]]);export{ah as default};
