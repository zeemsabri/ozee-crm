import{r as d,c as E,e as $,a as u,o as c,b as m,i as k,d as o,u as b,w as _,m as v,j as y,s as S,p}from"./app-0RB-mjiy.js";import{_ as j}from"./InputLabel-Cnr1QJ2p.js";import{_ as A}from"./TextInput-uOLgIx2M.js";import{_ as B}from"./EmailEditor-BhqFdpEi.js";import{_ as g}from"./InputError-Bqxa1dAi.js";import{_ as N}from"./PrimaryButton-CXujG8WJ.js";import{_ as M}from"./SecondaryButton-DKeLgF1R.js";import{u as R}from"./useEmailSignature-BnJxYPzV.js";import{_ as T}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./EmailEditor.vue_vue_type_style_index_0_lang-BdgrmfU1.js";const q={key:0,class:"flex justify-center py-8"},H={key:1,class:"p-4 space-y-6"},L={class:"mb-4"},U={class:"mb-6"},z=["innerHTML"],D={class:"flex items-center justify-end space-x-2"},F={__name:"CustomEmailApprovalContent",props:{email:{type:Object,required:!0}},emits:["submitted","error"],setup(h,{emit:x}){const i=h,r=x,n=d(!1),t=d(!1),s=d({subject:"",body:""}),{userSignature:f}=R(E(()=>({}))),V=async()=>{var a;if((a=i.email)!=null&&a.id){n.value=!0;try{const{data:e}=await p.get(`/api/emails/${i.email.id}/edit-content`);s.value.subject=e.subject;const l=e.body_html||e.body;console.log("para:"),console.log(l),l.paragraphs&&e.full_html?s.value.body=e.full_html:s.value.body=l}catch(e){console.error("Failed to load email content",e),r("error",e)}finally{n.value=!1}}},w=async()=>{t.value=!0;try{await p.post(`/api/emails/${i.email.id}/edit-and-approve`,{subject:s.value.subject,body:s.value.body,composition_type:"custom"}),r("submitted")}catch(a){console.error("Approve custom email failed",a),r("error",a)}finally{t.value=!1}},C=async()=>{t.value=!0;try{await p.post(`/api/emails/${i.email.id}/reject`,{rejection_reason:"Rejected by approver."}),r("submitted")}catch(a){console.error("Reject custom email failed",a),r("error",a)}finally{t.value=!1}};return $(()=>i.email,a=>{a&&V()},{immediate:!0}),(a,e)=>n.value?(c(),u("div",q,e[3]||(e[3]=[m("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-500"},null,-1)]))):(c(),u("div",H,[m("form",{onSubmit:e[2]||(e[2]=S(()=>{},["prevent"]))},[m("div",L,[o(j,{for:"subject",value:"Subject"}),o(A,{id:"subject",type:"text",class:"mt-1 block w-full",modelValue:s.value.subject,"onUpdate:modelValue":e[0]||(e[0]=l=>s.value.subject=l),required:""},null,8,["modelValue"]),o(g,{message:"",class:"mt-2"})]),m("div",U,[o(j,{for:"body",value:"Email Body",class:"sr-only"}),o(B,{id:"body",modelValue:s.value.body,"onUpdate:modelValue":e[1]||(e[1]=l=>s.value.body=l),placeholder:"Edit the email here...",height:"300px"},null,8,["modelValue"]),o(g,{message:"",class:"mt-2"})]),b(f)?(c(),u("div",{key:0,class:"unselectable-signature",innerHTML:b(f)},null,8,z)):k("",!0),m("div",D,[o(N,{onClick:w,class:y({"opacity-25":t.value}),disabled:t.value},{default:_(()=>e[4]||(e[4]=[v(" Approve & Send ",-1)])),_:1,__:[4]},8,["class","disabled"]),o(M,{onClick:C,class:y({"opacity-25":t.value}),disabled:t.value},{default:_(()=>e[5]||(e[5]=[v(" Reject ",-1)])),_:1,__:[5]},8,["class","disabled"])])],32)]))}},Z=T(F,[["__scopeId","data-v-f9541581"]]);export{Z as default};
