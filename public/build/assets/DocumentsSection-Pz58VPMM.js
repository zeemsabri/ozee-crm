import{r as i,E as B,s as U,B as F,w as z,i as l,o as r,b as t,G as x,e as I,g,m as p,t as d,f as O,k as T,F as Z,j as q}from"./app-CYi4MQ32.js";import $ from"./TicketNotesSidebar-CjO6IFoe.js";import{_ as P}from"./_plugin-vue_export-helper-DlAUqK2U.js";const G={class:"p-6 bg-white rounded-xl shadow-lg font-inter min-h-[calc(100vh-6rem)]"},Q={class:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6"},Y={class:"text-2xl font-bold text-gray-900 mb-4 sm:mb-0 flex items-center"},J=["href"],K={class:"mb-8 p-6 border border-blue-200 bg-blue-50 rounded-xl shadow-md"},R={class:"flex flex-col sm:flex-row items-center space-y-4 sm:space-y-0 sm:space-x-4"},W=["disabled"],X={key:0,class:"flex items-center"},ee={key:1,class:"flex items-center"},te={key:0,class:"mt-3 text-sm text-gray-700"},oe={class:"font-semibold"},se={key:1,class:"mt-3 text-sm text-red-600 font-semibold"},le={class:"relative mb-6"},re={key:0,class:"text-center text-gray-600 py-12"},ne={key:1,class:"text-center text-red-600 py-12"},ae={key:2,class:"text-center text-gray-500 py-12"},ie={key:3,class:"text-center text-gray-500 py-12"},de={class:"text-lg mb-2"},ce={key:4,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"},ue={class:"w-1/3 flex-shrink-0 bg-gray-200 flex items-center justify-center relative"},he=["src","alt"],pe=["innerHTML"],ve={class:"flex-1 p-4 flex flex-col justify-between"},ge={class:"text-base font-semibold text-gray-900 line-clamp-2 mb-1"},we={class:"text-sm text-gray-600 mb-2"},me={class:"flex items-center mb-1"},fe={key:0,class:"flex items-center"},xe={class:"flex space-x-2 mt-auto"},ke=["href"],ye=["onClick"],be={__name:"DocumentsSection",props:{initialAuthToken:{type:String,required:!0},projectId:{type:[String,Number],required:!0},documents:{type:Array,default:()=>[]},projectData:{type:[Object,null],default:()=>({})}},emits:["add-activity"],setup(u,{emit:H}){const v=u,A=H,w=i(!0),m=i(!1),c=i([]),n=i(null),a=i([]),h=i(""),k=i(!1),M=i(null),{showModal:f}=B("modalService"),{addActivity:j}=B("activityService"),_=U(()=>{if(!h.value)return a.value;const o=h.value.toLowerCase();return a.value.filter(e=>e.filename.toLowerCase().includes(o)||e.notes&&e.notes.some(s=>s.content.toLowerCase().includes(o)))}),C=async()=>{w.value=!0,n.value=null;try{const o=await fetch(`/api/client-api/project/${v.projectId}/documents`,{headers:{Authorization:`Bearer ${v.initialAuthToken}`,"Content-Type":"application/json",Accept:"application/json"}}),e=await o.json();if(!o.ok){const s=e.errors?Object.values(e.errors).flat().join(`
`):e.message||"Failed to fetch documents.";throw new Error(s)}a.value=e}catch(o){console.error("Error fetching documents:",o),n.value=o.message||"An unexpected error occurred while fetching documents.",f("Error",n.value,"alert")}finally{w.value=!1}},D=o=>{c.value=Array.from(o.target.files),n.value=null},V=o=>{M.value=o,k.value=!0},S=()=>{C(),A("add-activity","A new note was added to a document.")},N=async()=>{if(c.value.length===0){f("No Files Selected","Please select one or more files to upload.","alert");return}m.value=!0,n.value=null;const o=new FormData;c.value.forEach(e=>{o.append("documents[]",e)}),o.append("project_id",v.projectId);try{const e=await fetch("/api/client-api/documents",{method:"POST",headers:{Authorization:`Bearer ${v.initialAuthToken}`,Accept:"application/json"},body:o}),s=await e.json();if(!e.ok){const b=s.errors?Object.values(s.errors).flat().join(`
`):s.message||"Failed to upload documents.";throw new Error(b)}a.value=[...a.value,...s.documents],a.value.sort((b,E)=>new Date(E.created_at).getTime()-new Date(b.created_at).getTime()),c.value=[];const y=document.getElementById("document-upload-input");y&&(y.value=""),f("Upload Successful","Your document(s) have been uploaded successfully!","alert"),j&&j(`Uploaded ${s.documents.length} new document(s).`)}catch(e){console.error("Error uploading documents:",e),n.value=e.message||"An unexpected error occurred during upload.",f("Upload Error",n.value,"alert")}finally{m.value=!1}},L=o=>o?o.includes("pdf")?'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-file-text text-red-500"><path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"/><path d="M14 2v4a2 2 0 0 0 2 2h4"/><path d="M10 9H8"/><path d="M16 13H8"/><path d="M16 17H8"/></svg>':o.includes("image")?'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-image text-purple-500"><rect width="18" height="18" x="3" y="3" rx="2" ry="2"/><circle cx="9" cy="9" r="2"/><path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"/></svg>':o.includes("wordprocessingml")||o.includes("msword")?'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-file-type-doc text-blue-500"><path d="M14.5 22H18a2 2 0 0 0 2-2V7.5L14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h8.5"/><path d="M14 2v6a2 2 0 0 0 2 2h6"/><path d="M8 12h4"/><path d="M8 16h4"/><path d="M8 20h4"/></svg>':o.includes("spreadsheetml")||o.includes("excel")?'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-file-spreadsheet text-green-600"><path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"/><path d="M14 2v4a2 2 0 0 0 2 2h4"/><path d="M8 13h2"/><path d="M8 17h2"/><path d="M14 13h2"/><path d="M14 17h2"/></svg>':o.includes("presentationml")||o.includes("powerpoint")?'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-file-type-ppt text-orange-500"><path d="M14.5 22H18a2 2 0 0 0 2-2V7.5L14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h8.5"/><path d="M14 2v6a2 2 0 0 0 2 2h6"/><path d="M10 12h4"/><path d="M12 12v6"/></svg>':'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-file text-gray-500"><path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"/><path d="M14 2v4a2 2 0 0 0 2 2h4"/></svg>':'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-file text-gray-500"><path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"/><path d="M14 2v4a2 2 0 0 0 2 2h4"/></svg>';return F(()=>{C()}),z(()=>v.documents,o=>{o&&o.length>0&&a.value.length===0&&(a.value=[...o])},{immediate:!0}),(o,e)=>(r(),l("div",G,[t("div",Q,[t("h2",Y,[e[2]||(e[2]=t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"lucide lucide-folder-open mr-2 w-6 h-6"},[t("path",{d:"M6 14H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h2.5L7 4.5 8.5 3h8A2 2 0 0 1 19 5v2"}),t("path",{d:"M22 10H10c-.6 0-1 .4-1 1v9c0 .6.4 1 1 1h12c.6 0 1-.4 1-1V11c0-.6-.4-1-1-1Z"})],-1)),p(" "+d(u.projectData.name??"Project")+" Documents ",1)]),u.projectData.google_drive_link?(r(),l("a",{key:0,href:u.projectData.google_drive_link,target:"_blank",rel:"noopener noreferrer",class:"bg-indigo-600 text-white py-2 px-5 rounded-lg font-semibold hover:bg-indigo-700 transition-all duration-200 ease-in-out transform hover:scale-105 shadow-md flex items-center"},e[3]||(e[3]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"lucide lucide-folder-open mr-2"},[t("path",{d:"M6 14H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h2.5L7 4.5 8.5 3h8A2 2 0 0 1 19 5v2"}),t("path",{d:"M22 10H10c-.6 0-1 .4-1 1v9c0 .6.4 1 1 1h12c.6 0 1-.4 1-1V11c0-.6-.4-1-1-1Z"})],-1),p(" Open in Google Drive ",-1)]),8,J)):g("",!0)]),t("div",K,[e[7]||(e[7]=x('<h3 class="text-xl font-bold text-blue-800 mb-4 flex items-center" data-v-0592e9c6><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-upload mr-2" data-v-0592e9c6><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" data-v-0592e9c6></path><polyline points="17 8 12 3 7 8" data-v-0592e9c6></polyline><line x1="12" x2="12" y1="3" y2="15" data-v-0592e9c6></line></svg> Upload New Documents </h3>',1)),t("div",R,[t("input",{type:"file",id:"document-upload-input",multiple:"",onChange:D,class:"flex-1 block w-full text-sm text-gray-900 border border-gray-300 rounded-lg cursor-pointer bg-white focus:outline-none file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-blue-100 file:text-blue-700 hover:file:bg-blue-200 transition-colors duration-200"},null,32),t("button",{onClick:N,disabled:m.value||c.value.length===0,class:"bg-green-600 text-white py-2.5 px-6 rounded-lg font-semibold hover:bg-green-700 transition-all duration-200 ease-in-out transform hover:scale-105 shadow-md disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center min-w-[120px]"},[m.value?(r(),l("span",X,e[4]||(e[4]=[t("svg",{class:"animate-spin h-5 w-5 text-white mr-3",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),p(" Uploading... ",-1)]))):(r(),l("span",ee,e[5]||(e[5]=[x('<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-file-plus mr-2" data-v-0592e9c6><path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z" data-v-0592e9c6></path><path d="M14 2v4a2 2 0 0 0 2 2h4" data-v-0592e9c6></path><path d="M12 18v-6" data-v-0592e9c6></path><path d="M9 15h6" data-v-0592e9c6></path></svg> Upload Files ',2)])))],8,W)]),c.value.length>0?(r(),l("p",te,[e[6]||(e[6]=p(" Selected: ",-1)),t("span",oe,d(c.value.length)+" file(s)",1)])):g("",!0),n.value?(r(),l("p",se,d(n.value),1)):g("",!0)]),e[17]||(e[17]=x('<h3 class="text-xl font-bold text-gray-900 mb-4 flex items-center" data-v-0592e9c6><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-files mr-2" data-v-0592e9c6><path d="M15.5 2H8.6c-.4 0-.8.2-1.1.5-.3.3-.5.7-.5 1.1v12.8c0 .4.2.8.5 1.1.3.3.7.5 1.1.5H20.4c.4 0 .8-.2 1.1-.5.3-.3.5-.7.5-1.1V6.5L15.5 2z" data-v-0592e9c6></path><path d="M3 7.6v12.8c0 .4.2.8.5 1.1.3.3.7.5 1.1.5h9.8" data-v-0592e9c6></path><path d="M15 2v5h5" data-v-0592e9c6></path></svg> All Project Documents </h3>',1)),t("div",le,[O(t("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=s=>h.value=s),placeholder:"Search documents by file name or notes...",class:"w-full p-3 pl-10 border border-gray-300 rounded-xl shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 transition duration-200","aria-label":"Search Documents"},null,512),[[T,h.value]]),e[8]||(e[8]=t("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"lucide lucide-search text-gray-400 w-5 h-5"},[t("circle",{cx:"11",cy:"11",r:"8"}),t("path",{d:"m21 21-4.3-4.3"})])],-1))]),w.value?(r(),l("div",re,e[9]||(e[9]=[t("svg",{class:"animate-spin h-8 w-8 text-indigo-500 mx-auto mb-3",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),t("p",null,"Loading documents...",-1)]))):n.value&&!w.value?(r(),l("div",ne,[e[10]||(e[10]=t("p",{class:"font-semibold mb-2"},"Error loading documents:",-1)),t("p",null,d(n.value),1)])):a.value.length===0?(r(),l("div",ae,e[11]||(e[11]=[t("p",{class:"text-lg mb-2"},"No documents have been uploaded for this project yet.",-1),t("p",null,'Use the "Upload New Documents" section above to add your files.',-1)]))):_.value.length===0&&h.value?(r(),l("div",ie,[t("p",de,'No documents match your search "'+d(h.value)+'".',1),e[12]||(e[12]=t("p",null,"Try a different keyword or clear your search.",-1))])):(r(),l("div",ce,[(r(!0),l(Z,null,q(_.value,s=>(r(),l("div",{key:s.id,class:"bg-gray-50 rounded-lg shadow-sm border border-gray-200 flex overflow-hidden hover:shadow-md transition-shadow duration-200 h-40"},[t("div",ue,[s.thumbnail?(r(),l("img",{key:0,src:s.thumbnail,alt:s.filename,class:"absolute inset-0 w-full h-full object-cover",loading:"lazy",onerror:"this.onerror=null;this.src='https://placehold.co/150x160/E2E8F0/64748B?text=File';"},null,8,he)):(r(),l("div",{key:1,innerHTML:L(s.mime_type),class:"text-gray-500 w-12 h-12"},null,8,pe))]),t("div",ve,[t("div",null,[t("h3",ge,d(s.filename),1),t("div",we,[t("div",me,[e[13]||(e[13]=x('<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-calendar mr-1 text-gray-500" data-v-0592e9c6><rect width="18" height="18" x="3" y="4" rx="2" ry="2" data-v-0592e9c6></rect><path d="M16 2v4" data-v-0592e9c6></path><path d="M8 2v4" data-v-0592e9c6></path><path d="M3 10h18" data-v-0592e9c6></path></svg>',1)),t("span",null,"Uploaded: "+d(new Date(s.created_at).toLocaleDateString()),1)]),s.notes&&s.notes.length>0?(r(),l("div",fe,[e[14]||(e[14]=t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"lucide lucide-message-square mr-1 text-gray-500"},[t("path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V3a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"})],-1)),t("span",null,d(s.notes.length)+" Note(s)",1)])):g("",!0)])]),t("div",xe,[s.path?(r(),l("a",{key:0,href:s.path,target:"_blank",rel:"noopener noreferrer",class:"flex-1 bg-blue-600 text-white py-2 px-3 rounded-lg font-semibold text-xs hover:bg-blue-700 transition-all duration-200 ease-in-out transform hover:scale-105 shadow-md flex items-center justify-center"},e[15]||(e[15]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"lucide lucide-download mr-1"},[t("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),t("polyline",{points:"7 10 12 15 17 10"}),t("line",{x1:"12",x2:"12",y1:"15",y2:"3"})],-1),p(" Download ",-1)]),8,ke)):g("",!0),t("button",{onClick:y=>V(s),class:"flex-1 bg-gray-300 text-gray-800 py-2 px-3 rounded-lg font-semibold text-xs hover:bg-gray-400 transition-all duration-200 ease-in-out transform hover:scale-105 shadow-md flex items-center justify-center"},e[16]||(e[16]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"lucide lucide-message-square-plus mr-1"},[t("path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V3a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"}),t("path",{d:"M12 7v6"}),t("path",{d:"M9 10h6"})],-1),p(" Add Note ",-1)]),8,ye)])])]))),128))])),I($,{isOpen:k.value,"onUpdate:isOpen":e[1]||(e[1]=s=>k.value=s),"selected-item":M.value,initialAuthToken:u.initialAuthToken,"note-for":"documents",projectId:u.projectId,onNoteAddedSuccess:S},null,8,["isOpen","selected-item","initialAuthToken","projectId"])]))}},Ce=P(be,[["__scopeId","data-v-0592e9c6"]]);export{Ce as default};
