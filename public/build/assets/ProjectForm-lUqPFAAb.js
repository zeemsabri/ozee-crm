import{x as ie,r as $,ae as E,z as pe,w as se,B as me,i as d,o as n,b as t,m as R,g as b,e as o,f as ge,k as ke,c as Z,a as H,p as W,ad as oe,s as K,F as ue,j as ce,t as V,d as He,aI as Ge,v as Ve,af as Ye,al as Ne,h as C,aJ as We,l as Je,aw as Xe,aK as Qe,aL as Ze,aM as et,an as tt}from"./app-BcHKRy8Y.js";import{_ as U}from"./InputLabel-FoWjQGRi.js";import{_ as G}from"./TextInput-3GGxZrCp.js";import{_ as T}from"./InputError-DWGlKjdM.js";import{P as ee}from"./PrimaryButton-CLnMvtm0.js";import{S as ae}from"./SelectDropdown-BOg5I1bh.js";import{T as at,j as st,k as lt}from"./AuthenticatedLayout-CgSDeV-R.js";import{P as ot,_ as nt}from"./ProjectTypeInput-BssWssqK.js";import{_ as be}from"./SecondaryButton-BBOwirgA.js";import{D as rt}from"./DangerButton-DaIGxTKv.js";import{_ as it}from"./Modal-Bxl1wU_H.js";import{_ as dt}from"./Checkbox-BJVyhDpU.js";const ut=$([]),ct=$([]),Ce=$([]),Ie=$([]),De=async e=>{try{const f=(await ie.get(`/api/roles?type=${e}`)).data.map(v=>({value:v.id,label:v.name}));return e==="client"?ut.value=f:e==="project"&&(ct.value=f),f}catch(g){return console.error(`Error fetching ${e} roles:`,g),E(`Failed to load ${e} roles. Please refresh the page.`),[]}},mt=async(e,g)=>{try{let a;return g&&!e||e&&(a=await window.axios.get("/api/clients"),Ce.value=a.data.data||a.data),Ce.value}catch(a){return console.error("Error fetching clients:",a),E("Failed to load clients. Please try again."),[]}},vt=async(e,g)=>{try{let a;return g&&!e||e&&(a=await window.axios.get("/api/users"),Ie.value=a.data),Ie.value}catch(a){return console.error("Error fetching users:",a),E("Failed to load users. Please try again."),[]}},xe=async(e,g,a)=>{let f="",v=null;try{switch(g){case"basic":f=`/api/projects/${e}/sections/basic`;break;case"client":(a.canViewProjectClients||a.canManageProjectClients||a.canViewProjectUsers||a.canManageProjectUsers)&&(f=`/api/projects/${e}/sections/clients-users`);break;case"services":(a.canViewProjectServicesAndPayments||a.canManageProjectServicesAndPayments)&&(f=`/api/projects/${e}/sections/services-payment`);break;case"documents":a.canViewProjectDocuments&&(f=`/api/projects/${e}/sections/documents`);break;case"notes":(a.canViewProjectNotes||a.canAddProjectNotes)&&(f=`/api/projects/${e}/sections/notes?type=private`);break;case"transactions":return null;default:return console.warn(`Attempted to fetch data for unknown tab: ${g}`),null}return f&&(v=(await window.axios.get(f)).data),v}catch(P){throw console.error(`Error fetching data for tab '${g}':`,P),E(`Failed to load data for ${g} section. Please try again.`),P}},pt={class:"space-y-6 bg-white p-6 rounded-lg border border-gray-100 font-inter"},gt={key:0,class:"text-center py-8 text-gray-500 text-lg"},yt={key:1,class:"grid grid-cols-1 md:grid-cols-2 gap-6"},ft={key:0},bt={key:1},wt={key:2},ht=["disabled"],xt={key:0,class:"mt-2"},kt=["src"],jt={class:"mt-6"},_t=["disabled"],Pt={class:"mt-6"},$t={class:"mt-6"},St={class:"mt-6 flex justify-end"},Vt={key:0,class:"flex items-center"},Ct={key:1},It={__name:"ProjectEditBasicInfo",props:{projectId:{type:[Number,String],required:!0},errors:{type:Object,default:()=>({})},statusOptions:{type:Array,required:!0,default:()=>[{value:"active",label:"Active"},{value:"completed",label:"Completed"},{value:"paid",label:"Paid"},{value:"on_hold",label:"On-hold"}]},sourceOptions:{type:Array,required:!0},canManageProjects:{type:Boolean,default:!1},canManageProjectBasicDetails:{type:Boolean,default:!1},isSaving:{type:Boolean,default:!1}},setup(e){const g=e,a=pe({id:null,name:"",description:"",website:"",social_media_link:"",preferred_keywords:"",google_chat_id:"",google_drive_link:"",logo:null,status:"active",project_type:"",source:"",tags:[],tags_data:[],timezone:null}),f=$(!1),v=$(!0),P=w=>{const r=w.target.files[0];r?a.logo=r:a.logo=null},N=async()=>{f.value=!0;const w=new FormData,r=["id","tags","tags_data","logo"];for(const s in a)r.includes(s)||a[s]!==null&&a[s]!==void 0&&w.append(s,a[s]);Array.isArray(a.tags)&&a.tags.forEach(s=>{const i=typeof s=="object"&&s!==null&&s.id?s.id:s;i!=null&&w.append("tags[]",i)}),a.logo instanceof File&&w.append("logo",a.logo),w.append("_method","PUT");try{const s=await window.axios.post(`/api/projects/${g.projectId}/sections/basic`,w,{headers:{"Content-Type":"multipart/form-data"}});oe("Project basic information updated successfully!"),s.data&&Object.assign(a,{name:s.data.name||a.name,description:s.data.description||a.description,website:s.data.website||a.website,social_media_link:s.data.social_media_link||a.social_media_link,preferred_keywords:s.data.preferred_keywords||a.preferred_keywords,google_chat_id:s.data.google_chat_id||a.google_chat_id,google_drive_link:s.data.google_drive_link||a.google_drive_link,logo:s.data.logo||a.logo,status:s.data.status||a.status,project_type:s.data.project_type||a.project_type,source:s.data.source||a.source,tags:s.data.tags||a.tags,tags_data:s.data.tags_data||a.tags_data,timezone:s.data.timezone||a.timezone})}catch(s){console.error("Error saving basic info:",s);let i="Failed to save basic information.";s.response&&s.response.data&&s.response.data.message&&(i=s.response.data.message),E(i)}finally{f.value=!1}},I=async()=>{if(!g.projectId){v.value=!1;return}v.value=!0;try{const w=await xe(g.projectId,"basic",{});w&&Object.assign(a,{id:w.id||g.projectId,name:w.name||"",description:w.description||"",website:w.website||"",social_media_link:w.social_media_link||"",preferred_keywords:w.preferred_keywords||"",google_chat_id:w.google_chat_id||"",google_drive_link:w.google_drive_link||"",logo:w.logo||null,status:w.status||"active",project_type:w.project_type||"",source:w.source||"",tags:w.tags||[],tags_data:w.tags_data||[],timezone:w.timezone||null})}catch(w){console.error("Error fetching basic info:",w),E("Failed to load basic project information.")}finally{v.value=!1}};return se(()=>g.projectId,async w=>{setTimeout(async()=>{w&&await I()},500)},{immediate:!0}),me(()=>{}),(w,r)=>(n(),d("div",pt,[v.value?(n(),d("div",gt,r[12]||(r[12]=[t("svg",{class:"animate-spin h-8 w-8 text-indigo-500 mx-auto mb-3",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),R(" Loading basic project information... ",-1)]))):(n(),d("div",yt,[t("div",null,[o(U,{for:"name",value:"Project Name"}),o(G,{id:"name",type:"text",class:"mt-1 block w-full rounded-lg shadow-sm",modelValue:a.name,"onUpdate:modelValue":r[0]||(r[0]=s=>a.name=s),required:"",autofocus:"",disabled:!e.canManageProjects||f.value||e.isSaving},null,8,["modelValue","disabled"]),o(T,{message:e.errors.name?e.errors.name[0]:"",class:"mt-2"},null,8,["message"])]),t("div",null,[o(U,{for:"website",value:"Website"}),o(G,{id:"website",type:"url",class:"mt-1 block w-full rounded-lg shadow-sm",modelValue:a.website,"onUpdate:modelValue":r[1]||(r[1]=s=>a.website=s),disabled:!e.canManageProjects||f.value||e.isSaving},null,8,["modelValue","disabled"]),o(T,{message:e.errors.website?e.errors.website[0]:"",class:"mt-2"},null,8,["message"])]),t("div",null,[o(U,{for:"social_media_link",value:"Social Media Link"}),o(G,{id:"social_media_link",type:"url",class:"mt-1 block w-full rounded-lg shadow-sm",modelValue:a.social_media_link,"onUpdate:modelValue":r[2]||(r[2]=s=>a.social_media_link=s),disabled:!e.canManageProjects||f.value||e.isSaving},null,8,["modelValue","disabled"]),o(T,{message:e.errors.social_media_link?e.errors.social_media_link[0]:"",class:"mt-2"},null,8,["message"])]),e.canManageProjectBasicDetails?(n(),d("div",ft,[o(U,{for:"google_chat_id",value:"Google Chat ID"}),o(G,{id:"google_chat_id",type:"text",class:"mt-1 block w-full rounded-lg shadow-sm",modelValue:a.google_chat_id,"onUpdate:modelValue":r[3]||(r[3]=s=>a.google_chat_id=s),disabled:!e.canManageProjects||f.value||e.isSaving},null,8,["modelValue","disabled"]),o(T,{message:e.errors.google_chat_id?e.errors.google_chat_id[0]:"",class:"mt-2"},null,8,["message"])])):b("",!0),e.canManageProjectBasicDetails?(n(),d("div",bt,[o(U,{for:"google_drive_link",value:"Google Drive Link"}),o(G,{id:"google_drive_link",type:"text",class:"mt-1 block w-full rounded-lg shadow-sm",modelValue:a.google_drive_link,"onUpdate:modelValue":r[4]||(r[4]=s=>a.google_drive_link=s),disabled:!e.canManageProjects||f.value||e.isSaving},null,8,["modelValue","disabled"]),o(T,{message:e.errors.google_drive_link?e.errors.google_drive_link[0]:"",class:"mt-2"},null,8,["message"])])):b("",!0),t("div",null,[o(U,{for:"status",value:"Status"}),o(ae,{id:"status",modelValue:a.status,"onUpdate:modelValue":r[5]||(r[5]=s=>a.status=s),options:e.statusOptions,valueKey:"value",labelKey:"label",placeholder:"Select Project Status",disabled:!e.canManageProjects||f.value||e.isSaving,required:!0,class:"mt-1 block w-full"},null,8,["modelValue","options","disabled"]),o(T,{message:e.errors.status?e.errors.status[0]:"",class:"mt-2"},null,8,["message"])]),t("div",null,[o(ot,{id:"project_type",modelValue:a.project_type,"onUpdate:modelValue":r[6]||(r[6]=s=>a.project_type=s),disabled:!e.canManageProjects||f.value||e.isSaving,class:"mt-1 block w-full"},null,8,["modelValue","disabled"]),o(T,{message:e.errors.project_type?e.errors.project_type[0]:"",class:"mt-2"},null,8,["message"])]),t("div",null,[o(U,{for:"source",value:"Source"}),o(ae,{id:"source",modelValue:a.source,"onUpdate:modelValue":r[7]||(r[7]=s=>a.source=s),options:e.sourceOptions,valueKey:"value",labelKey:"label",placeholder:"Select a Source",disabled:!e.canManageProjects||f.value||e.isSaving,class:"mt-1 block w-full"},null,8,["modelValue","options","disabled"]),o(T,{message:e.errors.source?e.errors.source[0]:"",class:"mt-2"},null,8,["message"])]),t("div",null,[o(nt,{id:"timezone",modelValue:a.timezone,"onUpdate:modelValue":r[8]||(r[8]=s=>a.timezone=s),disabled:!e.canManageProjects||f.value||e.isSaving,class:"mt-1 block w-full"},null,8,["modelValue","disabled"]),o(T,{message:e.errors.timezone?e.errors.timezone[0]:"",class:"mt-2"},null,8,["message"])]),e.canManageProjectBasicDetails?(n(),d("div",wt,[o(U,{for:"logo",value:"Project Logo"}),t("input",{type:"file",id:"logo",onChange:P,class:"mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100 cursor-pointer",accept:"image/*",disabled:!e.canManageProjectBasicDetails||f.value||e.isSaving},null,40,ht),a.logo&&typeof a.logo=="string"?(n(),d("div",xt,[r[13]||(r[13]=t("p",{class:"text-sm text-gray-600"},"Current Logo:",-1)),t("img",{src:a.logo,alt:"Project Logo",class:"h-20 w-20 object-contain rounded-lg shadow-md border border-gray-200"},null,8,kt)])):b("",!0),o(T,{message:e.errors.logo?e.errors.logo[0]:"",class:"mt-2"},null,8,["message"])])):b("",!0)])),t("div",jt,[o(U,{for:"description",value:"Description"}),ge(t("textarea",{id:"description",class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-lg shadow-sm mt-1 block w-full","onUpdate:modelValue":r[9]||(r[9]=s=>a.description=s),disabled:!e.canManageProjects||f.value||e.isSaving,rows:"4"},null,8,_t),[[ke,a.description]]),o(T,{message:e.errors.description?e.errors.description[0]:"",class:"mt-2"},null,8,["message"])]),t("div",Pt,[o(U,{for:"preferred_keywords",value:"Client Preferred Keywords"}),o(G,{id:"preferred_keywords",type:"text",class:"mt-1 block w-full rounded-lg shadow-sm",modelValue:a.preferred_keywords,"onUpdate:modelValue":r[10]||(r[10]=s=>a.preferred_keywords=s),disabled:!e.canManageProjects||f.value||e.isSaving},null,8,["modelValue","disabled"]),o(T,{message:e.errors.preferred_keywords?e.errors.preferred_keywords[0]:"",class:"mt-2"},null,8,["message"])]),t("div",$t,[o(at,{modelValue:a.tags,"onUpdate:modelValue":r[11]||(r[11]=s=>a.tags=s),initialTags:a.tags_data,label:"Associated Tags",placeholder:"Search or add tags",error:e.errors.tags?e.errors.tags[0]:"",disabled:!e.canManageProjects||f.value||e.isSaving},null,8,["modelValue","initialTags","error","disabled"])]),t("div",St,[e.canManageProjectBasicDetails?(n(),Z(ee,{key:0,onClick:N,disabled:!e.canManageProjects||f.value||e.isSaving,class:W([{"opacity-50 cursor-not-allowed":f.value||e.isSaving},"px-6 py-2 rounded-lg text-base shadow-md hover:shadow-lg transition-all"])},{default:H(()=>[f.value||e.isSaving?(n(),d("span",Vt,r[14]||(r[14]=[t("svg",{class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),R(" Updating... ",-1)]))):(n(),d("span",Ct," Update Basic Information "))]),_:1},8,["disabled","class"])):b("",!0)])]))}},Dt={class:"mb-4"},Ut={class:"mt-2"},Mt={key:0,class:"text-gray-500 text-sm mb-2"},At={class:"mb-4"},Nt={key:1,class:"space-y-3"},Bt={class:"flex-grow text-gray-800 font-medium"},Tt={class:"text-gray-600 text-sm"},Ot={class:"flex items-center space-x-2"},Rt=["onClick"],Ft={key:2,class:"p-4 bg-gray-50 rounded-lg text-gray-600 text-center border border-dashed border-gray-200"},Ue={__name:"MultiSelectWithRoles",props:{label:{type:String,required:!0},items:{type:Array,default:()=>[]},endpoint:{type:String,default:""},selectedItems:{type:Array,default:()=>[]},itemText:{type:String,default:"name"},itemSubtext:{type:String,default:"email"},itemValue:{type:String,default:"id"},roleOptions:{type:Array,default:()=>[]},roleType:{type:String,default:"application"},defaultRoleId:{type:Number,default:null},error:{type:String,default:""},placeholder:{type:String,default:"Select an item"},showRemoveButton:{type:Boolean,default:!0},disabled:{type:Boolean,default:!1}},emits:["update:selectedItems"],setup(e,{emit:g}){const a=e,f=g,v=$([]),P=$([]),N=$([]),I=$([]),w=$(!1),r=async()=>{if(!(a.roleOptions.length>0))try{const p=(await ie.get(`/api/roles?type=${a.roleType}`)).data;N.value=p.map(y=>({value:y.id,label:y.name}))}catch(c){console.error("Error fetching roles:",c)}},s=K(()=>N.value.length>0?N.value:a.roleOptions),i=()=>a.defaultRoleId?a.defaultRoleId:s.value.length>0?s.value[0].value:1,j=()=>{v.value=[],P.value=[],!(!a.selectedItems||a.selectedItems.length===0)&&a.selectedItems.forEach(c=>{const p=typeof c=="object"?c[a.itemValue]:c,y=typeof c=="object"&&c.role_id!==void 0?c.role_id:i();if(!v.value.includes(p))v.value.push(p),P.value.push({id:p,role_id:y});else{const z=P.value.find(F=>F.id===p);z&&z.role_id!==y&&(z.role_id=y)}})};se(()=>a.selectedItems,(c,p)=>{JSON.stringify(c)!==JSON.stringify(p)&&j()},{deep:!0,immediate:!0}),se(P,c=>{f("update:selectedItems",c)},{deep:!0});const x=c=>{a.disabled||c&&!v.value.includes(c)&&(v.value.push(c),P.value.push({id:c,role_id:i()}))},D=c=>{a.disabled||(v.value=v.value.filter(p=>p!==c),P.value=P.value.filter(p=>p.id!==c))},Y=(c,p)=>{if(a.disabled)return;const y=P.value.find(z=>z.id===c);y&&(y.role_id=parseInt(p))},J=c=>B.value.find(p=>p[a.itemValue]===c),X=c=>{const p=P.value.find(y=>y.id===c);return p?p.role_id:i()},M=async()=>{if(a.endpoint){w.value=!0;try{const c=await ie.get(a.endpoint);c.data&&Array.isArray(c.data)?I.value=c.data:c.data&&c.data.data&&Array.isArray(c.data.data)&&(I.value=c.data.data)}catch(c){console.error("Error fetching items from endpoint:",c)}finally{w.value=!1}}},B=K(()=>a.endpoint&&I.value.length>0?I.value:a.items),ne=K(()=>B.value.filter(c=>!v.value.includes(c[a.itemValue])).map(c=>({value:c[a.itemValue],label:`${c[a.itemText]} (${c[a.itemSubtext]})`})));return me(()=>{r(),a.endpoint&&M()}),(c,p)=>(n(),d("div",Dt,[o(U,{value:e.label},null,8,["value"]),t("div",Ut,[w.value?(n(),d("div",Mt,"Loading available items...")):b("",!0),t("div",At,[o(ae,{modelValue:c.selectedItemToAdd,"onUpdate:modelValue":p[0]||(p[0]=y=>c.selectedItemToAdd=y),options:ne.value,valueKey:"value",labelKey:"label",placeholder:e.placeholder,disabled:w.value||e.disabled,onChange:x,class:"w-full"},null,8,["modelValue","options","placeholder","disabled"])]),v.value.length>0?(n(),d("div",Nt,[(n(!0),d(ue,null,ce(v.value,y=>{var z,F;return n(),d("div",{key:y,class:"flex items-center p-3 border border-gray-200 rounded-lg bg-gray-50 shadow-sm"},[t("div",Bt,[R(V((z=J(y))==null?void 0:z[e.itemText])+" ",1),t("span",Tt,"("+V((F=J(y))==null?void 0:F[e.itemSubtext])+")",1)]),t("div",Ot,[o(ae,{modelValue:X(y),"onUpdate:modelValue":h=>Y(y,h),options:s.value,valueKey:"value",labelKey:"label",placeholder:"Select Role",disabled:e.disabled,class:"w-32"},null,8,["modelValue","onUpdate:modelValue","options","disabled"]),e.showRemoveButton&&!e.disabled?(n(),d("button",{key:0,type:"button",class:"text-red-500 hover:text-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 rounded-full p-1 transition-colors duration-200",onClick:h=>D(y),"aria-label":"Remove item"},p[1]||(p[1]=[t("svg",{class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]),8,Rt)):b("",!0)])])}),128))])):(n(),d("div",Ft," No "+V(e.label.toLowerCase())+" selected. ",1))]),o(T,{message:e.error,class:"mt-2"},null,8,["message"])]))}},Et={class:"space-y-8"},zt={key:0,class:"bg-gray-50 p-6 rounded-lg shadow-inner border border-gray-200"},Lt={key:0,class:"mt-6 flex justify-end"},qt={key:0},Kt={key:1},Ht={key:1,class:"mt-3 text-green-600 text-sm flex items-center"},Gt={key:2,class:"mt-3 text-red-600 text-sm flex items-center"},Yt={class:"bg-gray-50 p-6 rounded-lg shadow-inner border border-gray-200"},Wt=["disabled"],Jt={key:1,class:"bg-gray-50 p-6 rounded-lg shadow-inner border border-gray-200"},Xt={key:0,class:"mt-6 flex justify-end"},Qt={key:0},Zt={key:1},ea={key:1,class:"mt-3 text-green-600 text-sm flex items-center"},ta={key:2,class:"mt-3 text-red-600 text-sm flex items-center"},aa={__name:"ProjectFormClientsUsers",props:{projectId:{type:[Number,String],required:!0},errors:{type:Object,default:()=>({})},clientRoleOptions:{type:Array,default:()=>[]},userRoleOptions:{type:Array,default:()=>[]},clients:{type:Array,default:()=>[]},users:{type:Array,default:()=>[]},canViewProjectClients:{type:Boolean,default:!1},canManageProjectClients:{type:Boolean,default:!1},canViewProjectUsers:{type:Boolean,default:!1},canManageProjectUsers:{type:Boolean,default:!1},isSaving:{type:Boolean,default:!1}},setup(e){const g=e,a=pe({client_ids:[],user_ids:[],contract_details:""}),f=$(!1),v=$(!1),P=$(""),N=$(!1),I=$(!1),w=$(""),r=async()=>{if(g.projectId)try{const j=await xe(g.projectId,"client",{canViewProjectClients:g.canViewProjectClients,canManageProjectClients:g.canManageProjectClients,canViewProjectUsers:g.canViewProjectUsers,canManageProjectUsers:g.canManageProjectUsers});j&&(a.client_ids=j.clients?j.clients.map(x=>{var D;return{id:x.id,role_id:((D=x.pivot)==null?void 0:D.role_id)||(g.clientRoleOptions.length>0?g.clientRoleOptions[0].value:null)}}):[],a.user_ids=j.users?j.users.map(x=>{var D;return{id:x.id,role_id:((D=x.pivot)==null?void 0:D.role_id)||(g.userRoleOptions.length>0?g.userRoleOptions[0].value:null)}}):[],a.contract_details=j.contract_details||"")}catch(j){console.error("Error fetching clients/users data:",j),E("Failed to load clients and users data.")}};se(()=>g.projectId,async j=>{j&&await r()},{immediate:!0});const s=async()=>{var j,x;if(!g.projectId){E("Project ID is missing. Cannot save clients.");return}if(!a.client_ids||a.client_ids.length===0){E("Please select at least one client to save.");return}f.value=!0,v.value=!1,P.value="";try{await window.axios.post(`/api/projects/${g.projectId}/attach-clients`,{client_ids:a.client_ids}),oe("Clients saved successfully!"),v.value=!0,await r()}catch(D){console.error("Error saving clients:",D),P.value=((x=(j=D.response)==null?void 0:j.data)==null?void 0:x.message)||"Failed to save clients.",E(P.value)}finally{f.value=!1,setTimeout(()=>v.value=!1,3e3)}},i=async()=>{var j,x;if(!g.projectId){E("Project ID is missing. Cannot save users.");return}if(!a.user_ids||a.user_ids.length===0){E("Please select at least one user to save.");return}N.value=!0,I.value=!1,w.value="";try{await window.axios.post(`/api/projects/${g.projectId}/attach-users`,{user_ids:a.user_ids}),oe("Users saved successfully!"),I.value=!0,await r()}catch(D){console.error("Error saving users:",D),w.value=((x=(j=D.response)==null?void 0:j.data)==null?void 0:x.message)||"Failed to save users.",E(w.value)}finally{N.value=!1,setTimeout(()=>I.value=!1,3e3)}};return me(()=>{}),(j,x)=>(n(),d("div",Et,[e.canViewProjectClients?(n(),d("div",zt,[x[5]||(x[5]=t("h3",{class:"text-xl font-semibold text-gray-800 mb-5"},"Project Clients",-1)),o(Ue,{label:"Select Clients",items:e.clients,selectedItems:a.client_ids,"onUpdate:selectedItems":x[0]||(x[0]=D=>a.client_ids=D),roleOptions:e.clientRoleOptions,roleType:"client",error:e.errors.client_ids?e.errors.client_ids[0]:"",placeholder:"Search and select clients to add",disabled:!e.canManageProjectClients||e.isSaving||f.value,readonly:!e.canManageProjectClients&&e.canViewProjectClients,showRemoveButton:e.canManageProjectClients,class:"mb-4"},null,8,["items","selectedItems","roleOptions","error","disabled","readonly","showRemoveButton"]),e.canManageProjectClients?(n(),d("div",Lt,[o(ee,{onClick:s,disabled:f.value||e.isSaving,class:"px-6 py-3 rounded-lg text-lg shadow-md hover:shadow-lg transition-all duration-200"},{default:H(()=>[f.value?(n(),d("span",qt,"Saving Clients...")):(n(),d("span",Kt,"Save Clients"))]),_:1},8,["disabled"])])):b("",!0),v.value?(n(),d("div",Ht,x[3]||(x[3]=[t("svg",{class:"h-5 w-5 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1),R(" Clients saved successfully! ",-1)]))):b("",!0),P.value?(n(),d("div",Gt,[x[4]||(x[4]=t("svg",{class:"h-5 w-5 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),R(" "+V(P.value),1)])):b("",!0)])):b("",!0),t("div",Yt,[x[6]||(x[6]=t("h3",{class:"text-xl font-semibold text-gray-800 mb-5"},"Contract Information",-1)),o(U,{for:"contract_details",value:"Contract Details",class:"mb-1"}),ge(t("textarea",{id:"contract_details",class:"block w-full px-4 py-2 border-gray-300 rounded-lg shadow-sm focus:border-indigo-500 focus:ring-indigo-500 transition-colors duration-200 resize-y min-h-[120px]","onUpdate:modelValue":x[1]||(x[1]=D=>a.contract_details=D),disabled:!e.canManageProjectClients||e.isSaving,placeholder:"Enter contract terms, agreements, or important notes about the client relationship."},null,8,Wt),[[ke,a.contract_details]]),o(T,{message:e.errors.contract_details?e.errors.contract_details[0]:"",class:"mt-2"},null,8,["message"])]),e.canViewProjectUsers?(n(),d("div",Jt,[x[9]||(x[9]=t("h3",{class:"text-xl font-semibold text-gray-800 mb-5"},"Assign Project Users",-1)),o(Ue,{label:"Assign Users",items:e.users,selectedItems:a.user_ids,"onUpdate:selectedItems":x[2]||(x[2]=D=>a.user_ids=D),roleOptions:e.userRoleOptions,roleType:"project",defaultRoleId:2,error:e.errors.user_ids?e.errors.user_ids[0]:"",placeholder:"Search and assign users to this project",disabled:!e.canManageProjectUsers||e.isSaving||N.value,readonly:!e.canManageProjectUsers&&e.canViewProjectUsers,showRemoveButton:e.canManageProjectUsers,class:"mb-4"},null,8,["items","selectedItems","roleOptions","error","disabled","readonly","showRemoveButton"]),e.canManageProjectUsers?(n(),d("div",Xt,[o(ee,{onClick:i,disabled:N.value||e.isSaving,class:"px-6 py-3 rounded-lg text-lg shadow-md hover:shadow-lg transition-all duration-200"},{default:H(()=>[N.value?(n(),d("span",Qt,"Saving Users...")):(n(),d("span",Zt,"Save Users"))]),_:1},8,["disabled"])])):b("",!0),I.value?(n(),d("div",ea,x[7]||(x[7]=[t("svg",{class:"h-5 w-5 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1),R(" Users saved successfully! ",-1)]))):b("",!0),w.value?(n(),d("div",ta,[x[8]||(x[8]=t("svg",{class:"h-5 w-5 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),R(" "+V(w.value),1)])):b("",!0)])):b("",!0)]))}},sa={class:"space-y-6"},la={key:0,class:"bg-gray-50 p-6 rounded-lg shadow-inner border border-gray-200"},oa={class:"mt-6"},na={key:0},ra={key:1},ia={key:0,class:"text-sm text-red-500 mt-3"},da={key:1,class:"mt-8 bg-white p-6 rounded-lg shadow-md border border-gray-200"},ua={class:"space-y-3"},ca={class:"flex items-center"},ma={class:"mr-3 text-indigo-500"},va={key:0,class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},pa={key:1,class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},ga={key:2,class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},ya={key:3,class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},fa=["href"],ba={key:1,class:"text-gray-700 font-medium break-all mr-4"},wa=["onClick","disabled"],ha={key:2,class:"p-6 bg-gray-50 rounded-lg text-gray-600 text-center border border-gray-200 shadow-sm"},xa={__name:"ProjectFormDocuments",props:{projectId:{type:[Number,String],required:!0},errors:{type:Object,default:()=>({})},canUploadProjectDocuments:{type:Boolean,default:!1},canViewProjectDocuments:{type:Boolean,default:!1},isSaving:{type:Boolean,default:!1}},setup(e){const g=e,a=pe({documents:[]}),f=$(null),v=$(!1),P=async()=>{if(g.projectId)try{const r=await xe(g.projectId,"documents",{canViewProjectDocuments:g.canViewProjectDocuments});r&&(a.documents=r||[])}catch(r){console.error("Error fetching documents data:",r),E("Failed to load documents data.")}};se(()=>g.projectId,async r=>{r&&await P()},{immediate:!0});const N=r=>{const s=Array.from(r.target.files);if(s.length>0){const i=Array.isArray(a.documents)?a.documents.filter(j=>typeof j=="object"&&"path"in j):[];a.documents=[...i,...s]}},I=async()=>{if(!g.projectId){E("Project ID is missing. Cannot upload documents.");return}const r=a.documents.filter(s=>s&&typeof s=="object"&&"name"in s&&"size"in s&&"type"in s);if(!r||r.length===0){E("Please select documents to upload.");return}v.value=!0;try{const s=new FormData;r.forEach((j,x)=>{s.append(`documents[${x}]`,j)});const i=await window.axios.post(`/api/projects/${g.projectId}/documents`,s,{headers:{"Content-Type":"multipart/form-data"}});a.documents=i.data.documents||[],oe("Documents uploaded successfully!"),await P()}catch(s){E("Failed to upload documents."),console.error("Error uploading documents:",s)}finally{v.value=!1,f.value&&(f.value.value="")}},w=r=>{a.documents=a.documents.filter((s,i)=>i!==r)};return me(()=>{}),(r,s)=>(n(),d("div",sa,[e.canUploadProjectDocuments?(n(),d("div",la,[o(U,{for:"documents-upload",value:"Upload New Documents",class:"mb-2 text-lg"}),t("input",{type:"file",id:"documents-upload",ref_key:"documentFileInput",ref:f,onChange:N,class:"mt-2 block w-full text-sm text-gray-600 file:mr-4 file:py-2.5 file:px-5 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100 transition-colors duration-200 cursor-pointer",multiple:"",accept:".pdf,.doc,.docx,.jpg,.jpeg,.png,.gif"},null,544),s[0]||(s[0]=t("p",{class:"text-sm text-gray-500 mt-2"},"Supported formats: PDF, DOC, DOCX, JPG, JPEG, PNG, GIF. Max file size: 5MB.",-1)),o(T,{message:e.errors.documents?e.errors.documents[0]:"",class:"mt-2"},null,8,["message"]),t("div",oa,[o(ee,{type:"button",onClick:I,disabled:!e.projectId||!a.documents||!a.documents.some(i=>i&&typeof i=="object"&&"name"in i&&"size"in i&&"type"in i)||v.value||e.isSaving,class:"px-6 py-3 rounded-lg text-lg shadow-md hover:shadow-lg transition-all duration-200"},{default:H(()=>[v.value?(n(),d("span",na,"Uploading...")):(n(),d("span",ra,"Upload Selected Documents"))]),_:1},8,["disabled"]),e.projectId?b("",!0):(n(),d("p",ia," Please save the project first before uploading documents. "))])])):b("",!0),e.canViewProjectDocuments&&a.documents&&a.documents.length>0?(n(),d("div",da,[s[7]||(s[7]=t("h3",{class:"text-xl font-semibold text-gray-800 mb-5"},"Existing Project Documents",-1)),t("ul",ua,[(n(!0),d(ue,null,ce(a.documents,(i,j)=>(n(),d("li",{key:j,class:"flex items-center justify-between p-4 bg-gray-50 rounded-md border border-gray-100 shadow-sm transition-shadow hover:shadow-md duration-200"},[t("div",ca,[t("span",ma,[typeof i=="object"&&"type"in i&&i.type.includes("image")?(n(),d("svg",va,s[1]||(s[1]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 002.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"},null,-1)]))):typeof i=="object"&&"type"in i&&i.type.includes("pdf")?(n(),d("svg",pa,s[2]||(s[2]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"},null,-1)]))):typeof i=="object"&&"type"in i&&(i.type.includes("word")||i.type.includes("document"))?(n(),d("svg",ga,s[3]||(s[3]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"},null,-1)]))):(n(),d("svg",ya,s[4]||(s[4]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"},null,-1)])))]),typeof i=="object"&&"path"in i?(n(),d("a",{key:0,href:`/storage/${i.path}`,target:"_blank",class:"text-blue-600 hover:text-blue-800 hover:underline font-medium break-all mr-4"},V(i.filename),9,fa)):(n(),d("span",ba,[R(V(i.name)+" ",1),s[5]||(s[5]=t("span",{class:"text-gray-500 text-sm"},"(Pending Upload)",-1))]))]),e.canUploadProjectDocuments?(n(),d("button",{key:0,type:"button",onClick:x=>w(j),class:"p-2 rounded-full text-red-500 hover:bg-red-100 hover:text-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 transition-colors duration-200",title:"Remove document",disabled:v.value||e.isSaving},s[6]||(s[6]=[t("svg",{class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]),8,wa)):b("",!0)]))),128))])])):e.canViewProjectDocuments?(n(),d("div",ha," No documents found for this project. ")):b("",!0),s[8]||(s[8]=t("div",{class:"mt-6 p-4 bg-blue-50 rounded-lg text-blue-700 text-sm border border-blue-200"},[t("p",null,"Note: Uploaded documents will be stored in the project's designated Google Drive folder.")],-1))]))}},ka={class:"p-6 bg-white rounded-lg font-inter"},ja={key:0,class:"p-6 bg-gray-50 rounded-lg text-gray-600 text-center border border-gray-200 shadow-sm"},_a={key:1},Pa={class:"mb-6 flex justify-between items-center"},$a={key:0,class:"flex items-center"},Sa={key:1},Va={key:0,class:"text-sm text-red-500 mb-4 bg-red-50 p-3 rounded-md border border-red-200"},Ca={key:1,class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6"},Ia={class:"flex justify-between items-start mb-3"},Da=["onClick","disabled"],Ua=["onUpdate:modelValue","readonly"],Ma={class:"mt-auto pt-3 border-t border-gray-100 text-xs text-gray-500 flex justify-between items-center"},Aa={class:"font-medium text-gray-700"},Na={key:2,class:"p-8 bg-gray-50 rounded-lg text-gray-600 text-center border border-gray-200 shadow-sm flex flex-col items-center justify-center h-64"},Ba={__name:"ProjectFormNotes",props:{projectId:{type:[Number,String],required:!0},errors:{type:Object,default:()=>({})},canAddProjectNotes:{type:Boolean,default:!1},canViewProjectNotes:{type:Boolean,default:!1},isSaving:{type:Boolean,default:!1}},setup(e){const g=e,a=pe({notes:[]}),f=$(!1),v=async()=>{if(g.projectId)try{const r=await xe(g.projectId,"notes",{canViewProjectNotes:g.canViewProjectNotes,canAddProjectNotes:g.canAddProjectNotes});r&&(a.notes=r.map(s=>{var i,j;return{id:s.id,content:s.content,created_at:s.created_at,creator_name:s.creator_name||((i=s.user)==null?void 0:i.name)||((j=s.creator)==null?void 0:j.name)||"Unknown"}})||[])}catch(r){console.error("Error fetching notes data:",r),E("Failed to load notes data.")}};se(()=>g.projectId,async r=>{r&&await v()},{immediate:!0});const P=()=>{g.canAddProjectNotes&&a.notes.push({id:null,content:"",created_at:new Date().toISOString(),creator_name:"You"})},N=r=>{g.canAddProjectNotes&&a.notes.splice(r,1)},I=async()=>{if(!g.projectId){E("Project ID is missing. Cannot save notes.");return}f.value=!0;const r=a.notes.map(s=>({id:s.id||null,content:s.content}));try{const s=await window.axios.put(`/api/projects/${g.projectId}/sections/notes?type=private`,{notes:r});a.notes=s.data.notes.map(i=>{var j,x;return{id:i.id,content:i.content,created_at:i.created_at,creator_name:i.creator_name||((j=i.user)==null?void 0:j.name)||((x=i.creator)==null?void 0:x.name)||"Unknown"}})||[],oe("Notes updated successfully!"),await v()}catch(s){console.error("Error updating notes:",s),E("Failed to update notes.")}finally{f.value=!1}},w=r=>r?new Date(r).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A";return me(()=>{}),(r,s)=>(n(),d("div",ka,[e.canViewProjectNotes?(n(),d("div",_a,[t("div",Pa,[o(ee,{onClick:P,type:"button",class:"px-5 py-2.5 rounded-lg text-base shadow-sm hover:shadow-md transition-all duration-200",disabled:!e.canAddProjectNotes||f.value||e.isSaving},{default:H(()=>s[0]||(s[0]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 4v16m8-8H4"})],-1),R(" Add New Note ",-1)])),_:1,__:[0]},8,["disabled"]),o(ee,{onClick:I,disabled:!e.projectId||!e.canAddProjectNotes||f.value||e.isSaving,class:W([{"opacity-50 cursor-not-allowed":f.value||e.isSaving},"px-6 py-3 rounded-lg text-lg shadow-md hover:shadow-lg transition-all duration-200"])},{default:H(()=>[f.value||e.isSaving?(n(),d("span",$a,s[1]||(s[1]=[t("svg",{class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),R(" Saving... ",-1)]))):(n(),d("span",Sa,"Save All Notes"))]),_:1},8,["disabled","class"])]),e.projectId?b("",!0):(n(),d("p",Va," Please save the project first before adding or editing notes. ")),a.notes&&a.notes.length>0?(n(),d("div",Ca,[(n(!0),d(ue,null,ce(a.notes,(i,j)=>(n(),d("div",{key:i.id||`new-note-${j}`,class:W(["relative bg-white p-5 rounded-lg shadow-md border border-gray-200 flex flex-col h-64 transition-all duration-200 ease-in-out hover:shadow-lg",{"opacity-75 cursor-not-allowed":!e.canAddProjectNotes||f.value||e.isSaving}])},[t("div",Ia,[o(U,{value:`Note ${j+1}`,class:"text-sm font-semibold text-gray-700"},null,8,["value"]),e.canAddProjectNotes?(n(),d("button",{key:0,type:"button",onClick:x=>N(j),class:"p-1 rounded-full text-red-500 hover:bg-red-100 hover:text-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 transition-colors duration-200",title:"Remove note",disabled:f.value||e.isSaving},s[2]||(s[2]=[t("svg",{class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1)]),8,Da)):b("",!0)]),ge(t("textarea",{"onUpdate:modelValue":x=>i.content=x,readonly:!e.canAddProjectNotes||f.value||e.isSaving,placeholder:"Type your note content here...",class:"flex-grow border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-lg shadow-sm block w-full resize-none transition-colors duration-200 p-3 text-sm overflow-auto",rows:"6"},null,8,Ua),[[ke,i.content]]),o(T,{message:e.errors[`notes.${j}.content`]?e.errors[`notes.${j}.content`][0]:"",class:"mt-2"},null,8,["message"]),t("div",Ma,[t("span",null,[s[3]||(s[3]=R("By: ",-1)),t("span",Aa,V(i.creator_name||"Unknown"),1)]),t("span",null,"Last updated: "+V(w(i.created_at)),1)])],2))),128))])):(n(),d("div",Na,s[4]||(s[4]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-16 w-16 text-gray-400 mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"1"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1),t("p",{class:"text-lg font-medium"},"No notes found for this project.",-1),t("p",{class:"text-sm mt-2"},'Click "Add New Note" to start creating your project notes.',-1)])))])):(n(),d("div",ja," You do not have permission to view project notes. "))]))}},Ta=["value","rows"],Oa={__name:"TextareaInput",props:{modelValue:[String,Number],rows:{type:[String,Number],default:3}},emits:["update:modelValue"],setup(e){const g=$(null);return me(()=>{g.value.hasAttribute("autofocus")&&g.value.focus()}),(a,f)=>(n(),d("textarea",{class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full",value:e.modelValue,rows:e.rows,onInput:f[0]||(f[0]=v=>a.$emit("update:modelValue",v.target.value)),ref_key:"input",ref:g},null,40,Ta))}},Ra={class:"p-6 bg-gray-50 rounded-xl shadow-lg"},Fa={class:"flex justify-between items-center mb-6"},Ea={key:0,class:"flex justify-center py-8"},za={key:1,class:"bg-white p-8 rounded-lg text-center border border-dashed border-gray-300"},La={key:2,class:"space-y-6"},qa={class:"flex justify-between items-start"},Ka={class:"text-xl font-medium text-gray-900"},Ha={class:"mt-2 flex items-center flex-wrap space-x-4 text-sm text-gray-500"},Ga={key:0,class:"text-gray-700"},Ya={key:1,class:"text-gray-700"},Wa={key:0,class:"mt-4 text-base text-gray-600"},Ja={key:0,class:"flex space-x-2"},Xa={class:"p-6 bg-white rounded-lg"},Qa={class:"text-2xl font-bold text-gray-900 mb-6"},Za={class:"p-4 bg-indigo-50 rounded-lg border border-indigo-200"},es={class:"flex justify-end space-x-3 mt-6"},ts={__name:"ProjectDeliverables",props:{projectId:{type:[Number,String],required:!0},errors:{type:Object,default:()=>({})},isSaving:{type:Boolean,default:!1},canManageProjectDeliverables:{type:Boolean,default:!1},canViewProjectDeliverables:{type:Boolean,default:!0}},emits:["checklist-item-toggled"],setup(e,{emit:g}){const a=e,f=$([]),v=$([]),P=$(!0),N=$([]),I=$(!1),w=$("create"),r=$({id:null,name:"",description:"",milestone_id:null,status:"pending",due_date:"",details:{deliverable_type_key:null,checklist:[]}}),s=$({}),i=$(null),j=[{value:"pending",label:"Pending"},{value:"in_progress",label:"In Progress"},{value:"completed",label:"Completed"},{value:"cancelled",label:"Cancelled"}],x=K(()=>{const c=v.value.find(p=>{var y;return p.key===((y=r.value.details)==null?void 0:y.deliverable_type_key)});return(c==null?void 0:c.checklistItemPlaceholder)||"e.g., Task 1, Task 2, Task 3"});se(()=>a.projectId,D,{immediate:!0});async function D(){if(a.projectId){P.value=!0;try{const c=await ie.get(`/api/projects/${a.projectId}/project-deliverables`);f.value=c.data;const p=await ie.get(`/api/projects/${a.projectId}/milestones`);N.value=p.data;const y=await ie.get("/api/project-deliverable-types");v.value=y.data}catch(c){console.error("Error fetching data:",c),E("Failed to load project data")}finally{P.value=!1}}}function Y(){w.value="create",r.value={id:null,name:"",description:"",milestone_id:null,status:"pending",due_date:"",details:{deliverable_type_key:null,checklist:[{name:"",completed:!1}]}},s.value={},i.value=null,I.value=!0}function J(c){w.value="edit",r.value=JSON.parse(JSON.stringify(c)),r.value.details.checklist||(r.value.details.checklist=[]),(r.value.details.checklist.length===0||r.value.details.checklist[r.value.details.checklist.length-1].name!=="")&&r.value.details.checklist.push({name:"",completed:!1}),s.value={},i.value=r.value.details.deliverable_type_key??null,I.value=!0}async function X(c){var z;if(c===i.value)return;if((((z=r.value.details)==null?void 0:z.checklist)||[]).some(F=>((F==null?void 0:F.name)||"").trim()!=="")){if(!await Ge("Changing the deliverable type may clear your existing checklist items. Do you want to proceed?",{confirmText:"Proceed",cancelText:"Cancel",type:"warning"})){r.value.details.deliverable_type_key=i.value;return}r.value.details.checklist=[{name:"",completed:!1}]}i.value=c}async function M(){s.value={};try{let c;const p=r.value.details.checklist.filter(z=>z.name.trim()!==""),y={...r.value,details:{...r.value.details,checklist:p}};w.value==="create"?(c=await ie.post(`/api/projects/${a.projectId}/project-deliverables`,y),oe("Project deliverable created successfully")):(c=await ie.put(`/api/project-deliverables/${r.value.id}`,y),oe("Project deliverable updated successfully")),await D(),I.value=!1}catch(c){console.error("Error saving deliverable:",c),c.response&&c.response.data&&c.response.data.errors?s.value=c.response.data.errors:E("Failed to save project deliverable")}}async function B(c){if(confirm("Are you sure you want to delete this deliverable?"))try{await ie.delete(`/api/project-deliverables/${c}`),oe("Project deliverable deleted successfully"),await D()}catch(p){console.error("Error deleting deliverable:",p),E("Failed to delete project deliverable")}}function ne(c){return c?new Date(c).toLocaleDateString():"N/A"}return(c,p)=>(n(),d("div",Ra,[t("div",Fa,[p[10]||(p[10]=t("h3",{class:"text-2xl font-bold text-gray-900"},"Project Deliverables",-1)),e.canManageProjectDeliverables?(n(),Z(ee,{key:0,onClick:Y,disabled:e.isSaving||P.value},{default:H(()=>p[9]||(p[9]=[R(" Add Deliverable ",-1)])),_:1,__:[9]},8,["disabled"])):b("",!0)]),P.value?(n(),d("div",Ea,p[11]||(p[11]=[t("div",{class:"animate-spin rounded-full h-10 w-10 border-b-2 border-indigo-600"},null,-1)]))):f.value.length===0?(n(),d("div",za,[p[13]||(p[13]=t("p",{class:"text-gray-600 text-lg"},"No deliverables have been added to this project yet.",-1)),e.canManageProjectDeliverables?(n(),Z(ee,{key:0,onClick:Y,class:"mt-6"},{default:H(()=>p[12]||(p[12]=[R(" Add Your First Deliverable ",-1)])),_:1,__:[12]})):b("",!0)])):(n(),d("div",La,[(n(!0),d(ue,null,ce(f.value,y=>{var z;return n(),d("div",{key:y.id,class:"bg-white border border-gray-200 rounded-xl p-6 shadow-sm hover:shadow-lg transition-all duration-300"},[t("div",qa,[t("div",null,[t("h4",Ka,V(y.name),1),t("div",Ha,[t("span",{class:W({"font-medium py-1 px-3 rounded-full text-white":!0,"bg-yellow-500":y.status==="pending","bg-blue-500":y.status==="in_progress","bg-green-500":y.status==="completed","bg-red-500":y.status==="cancelled"})},V(y.status.replace("_"," ").toUpperCase()),3),y.milestone?(n(),d("span",Ga,[p[14]||(p[14]=t("span",{class:"font-semibold"},"Milestone:",-1)),R(" "+V(y.milestone.name),1)])):b("",!0),y.due_date?(n(),d("span",Ya,[p[15]||(p[15]=t("span",{class:"font-semibold"},"Due:",-1)),R(" "+V(ne(y.due_date)),1)])):b("",!0)]),y.description?(n(),d("p",Wa,V(y.description),1)):b("",!0),(z=y.details)!=null&&z.checklist&&y.details.checklist.length>0?(n(),Z(st,{key:1,items:y.details.checklist,"api-endpoint":`/api/project-deliverables/${y.id}`,title:"Deliverable Checklist:","payload-transformer":(F,h)=>({...y,details:{...y.details,checklist:F}}),onItemToggled:F=>c.$emit("checklist-item-toggled",{deliverable:y,index:F.index,completed:F.completed})},null,8,["items","api-endpoint","payload-transformer","onItemToggled"])):b("",!0)]),e.canManageProjectDeliverables?(n(),d("div",Ja,[o(be,{onClick:F=>J(y),size:"sm"},{default:H(()=>p[16]||(p[16]=[R(" Edit ",-1)])),_:2,__:[16]},1032,["onClick"]),o(rt,{onClick:F=>B(y.id),size:"sm"},{default:H(()=>p[17]||(p[17]=[R(" Delete ",-1)])),_:2,__:[17]},1032,["onClick"])])):b("",!0)])])}),128))])),o(it,{show:I.value,onClose:p[8]||(p[8]=y=>I.value=!1),maxWidth:"2xl"},{default:H(()=>{var y,z,F,h,u;return[t("div",Xa,[t("h3",Qa,V(w.value==="create"?"Add New Deliverable":"Edit Deliverable"),1),t("form",{onSubmit:He(M,["prevent"]),class:"space-y-6"},[t("div",null,[o(U,{for:"name",value:"Name"}),o(G,{id:"name",modelValue:r.value.name,"onUpdate:modelValue":p[0]||(p[0]=l=>r.value.name=l),type:"text",class:"mt-1 block w-full",required:""},null,8,["modelValue"]),o(T,{message:(y=s.value.name)==null?void 0:y[0],class:"mt-2"},null,8,["message"])]),t("div",null,[o(U,{for:"description",value:"Description"}),o(Oa,{id:"description",modelValue:r.value.description,"onUpdate:modelValue":p[1]||(p[1]=l=>r.value.description=l),class:"mt-1 block w-full",rows:"3"},null,8,["modelValue"]),o(T,{message:(z=s.value.description)==null?void 0:z[0],class:"mt-2"},null,8,["message"])]),t("div",null,[o(U,{for:"milestone_id",value:"Milestone (Optional)"}),o(ae,{id:"milestone_id",modelValue:r.value.milestone_id,"onUpdate:modelValue":p[2]||(p[2]=l=>r.value.milestone_id=l),options:N.value,valueKey:"id",labelKey:"name",placeholder:"Select a milestone",class:"mt-1 block w-full"},null,8,["modelValue","options"]),o(T,{message:(F=s.value.milestone_id)==null?void 0:F[0],class:"mt-2"},null,8,["message"])]),t("div",null,[o(U,{for:"status",value:"Status"}),o(ae,{id:"status",modelValue:r.value.status,"onUpdate:modelValue":p[3]||(p[3]=l=>r.value.status=l),options:j,valueKey:"value",labelKey:"label",placeholder:"Select a Status",class:"mt-1 block w-full"},null,8,["modelValue"]),o(T,{message:(h=s.value.status)==null?void 0:h[0],class:"mt-2"},null,8,["message"])]),t("div",null,[o(U,{for:"due_date",value:"Due Date (Optional)"}),o(G,{id:"due_date",modelValue:r.value.due_date,"onUpdate:modelValue":p[4]||(p[4]=l=>r.value.due_date=l),type:"date",class:"mt-1 block w-full"},null,8,["modelValue"]),o(T,{message:(u=s.value.due_date)==null?void 0:u[0],class:"mt-2"},null,8,["message"])]),t("div",Za,[p[18]||(p[18]=t("h4",{class:"text-lg font-semibold text-indigo-800 mb-4"},"Deliverable Checklist",-1)),t("div",null,[o(U,{for:"deliverable_type_key",value:"Deliverable Type"}),o(ae,{id:"deliverable_type_key",modelValue:r.value.details.deliverable_type_key,"onUpdate:modelValue":[p[5]||(p[5]=l=>r.value.details.deliverable_type_key=l),X],options:v.value,valueKey:"key",labelKey:"name",placeholder:"Select a Deliverable Type",class:"mt-1 block w-full",required:""},null,8,["modelValue","options"])]),o(lt,{modelValue:r.value.details.checklist,"onUpdate:modelValue":p[6]||(p[6]=l=>r.value.details.checklist=l),placeholder:x.value,label:"Checklist Items",containerClass:"mt-4"},null,8,["modelValue","placeholder"])]),t("div",es,[o(be,{onClick:p[7]||(p[7]=l=>I.value=!1),disabled:e.isSaving},{default:H(()=>p[19]||(p[19]=[R(" Cancel ",-1)])),_:1,__:[19]},8,["disabled"]),o(ee,{type:"submit",disabled:e.isSaving},{default:H(()=>[R(V(w.value==="create"?"Create":"Update"),1)]),_:1},8,["disabled"])])],32)])]}),_:1},8,["show"])]))}},as={class:"p-6 bg-white rounded-lg font-inter"},ss={key:0,class:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4",role:"alert"},ls={class:"block sm:inline ml-2"},os={key:1,class:"flex items-center justify-center py-8"},ns={key:2},rs={key:0,class:"bg-gradient-to-r from-blue-500 to-indigo-600 text-white p-6 rounded-lg shadow-md mb-6"},is={class:"flex items-center justify-between"},ds={class:"text-3xl font-bold mt-1"},us={class:"text-sm opacity-90 mt-2"},cs={class:"font-semibold"},ms={class:"font-semibold"},vs={key:1,class:"bg-gray-100 text-gray-600 p-4 rounded-lg shadow-sm mb-6 text-center"},ps={class:"bg-gray-50 p-6 rounded-lg shadow-sm mb-6 border border-gray-200"},gs={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},ys=["disabled"],fs=["value"],bs={class:"bg-gray-50 p-6 rounded-lg shadow-sm mb-6 border border-gray-200"},ws={class:"mb-4"},hs={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-1 gap-4"},xs={class:"flex items-center justify-between"},ks=["for"],js={class:"ms-2 text-base font-medium text-gray-800"},_s=["onClick"],Ps={key:0,class:"mt-4 pt-4 border-t border-gray-200"},$s={class:"grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4"},Ss={class:"grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4"},Vs=["id","onUpdate:modelValue","disabled"],Cs={key:0,class:"mt-4 p-4 bg-blue-50 rounded-lg border border-blue-200"},Is={class:"flex justify-between items-center mb-3"},Ds={class:"space-y-4"},Us={class:"flex justify-between items-center mb-2"},Ms=["onClick"],As={class:"grid grid-cols-1 sm:grid-cols-2 gap-4"},Ns=["onClick"],Bs={key:0},Ts={class:"mt-6 pt-4 border-t border-gray-200"},Os={key:1,class:"mt-4 flex items-center"},Rs={key:2,class:"mt-6 flex justify-end"},Fs={__name:"ServicesAndPaymentForm",props:{projectId:{type:[Number,String],required:!0},paymentTypeOptions:{type:Array,required:!0},canManageProjectServicesAndPayments:{type:Boolean,required:!0},canViewProjectServicesAndPayments:{type:Boolean,required:!0}},emits:["updated"],setup(e,{emit:g}){const a=e,f=g,v=$({}),P=$(!1),N=[{value:"PKR",label:"PKR"},{value:"AUD",label:"AUD"},{value:"INR",label:"INR"},{value:"USD",label:"USD"},{value:"EUR",label:"EUR"},{value:"GBP",label:"GBP"}],w=$([...[{value:"Website Designing",label:"Website Designing"},{value:"SEO",label:"SEO"},{value:"Social Media",label:"Social Media"},{value:"Content Writing",label:"Content Writing"},{value:"Graphic Design",label:"Graphic Design"}]]),r=$(""),s=$(!1),i=pe({services:[],service_details:[],payment_type:"one_off",currency:"AUD"}),j=pe({}),x=K(()=>{let h=0;return i.services.forEach(u=>{const l=c(u);l&&l.amount&&(h+=parseFloat(l.amount))}),h.toFixed(2)}),D=K(()=>{let h=null,u=null;const l=new Date;return l.setHours(0,0,0,0),i.service_details.forEach(k=>{k.frequency==="one_off"&&k.payment_breakdown&&k.payment_breakdown.forEach(A=>{var O;if(A.due_date){const q=new Date(A.due_date);q.setHours(0,0,0,0),q>=l&&(!h||q<h.date)&&(h={date:q,serviceId:k.service_id,paymentLabel:A.label},u=((O=w.value.find(ve=>ve.value===k.service_id))==null?void 0:O.label)||k.service_id)}})}),h?{date:h.date.toLocaleDateString(),serviceLabel:u,paymentLabel:h.paymentLabel}:null}),Y=K(()=>{const h=i.services.filter(u=>{const l=c(u);return l&&l.frequency!=="monthly"});return h.length===0?!0:h.every(u=>p(u)===100)}),J=K(()=>!a.projectId||!a.canManageProjectServicesAndPayments||!Y.value),X=()=>{const h=r.value.trim();h&&!w.value.some(u=>u.label.toLowerCase()===h.toLowerCase())&&(w.value.push({value:h,label:h}),r.value="",s.value=!1)},M=async()=>{if(a.projectId){P.value=!0;try{const u=(await window.axios.get(`/api/projects/${a.projectId}/sections/services-payment`)).data;return i.services=u.services||[],i.service_details=u.service_details||[],i.payment_type=u.payment_type||"one_off",i.currency=u.currency||"AUD",i.services.forEach(l=>{w.value.some(k=>k.value===l)||w.value.push({value:l,label:l}),j[l]=!1}),i.service_details.forEach(l=>{if(l.payment_breakdown&&!Array.isArray(l.payment_breakdown)){const k=l.payment_breakdown;l.payment_breakdown=[{label:"First",percentage:parseInt(k.first)||30,due_date:null},{label:"Second",percentage:parseInt(k.second)||30,due_date:null},{label:"Third",percentage:parseInt(k.third)||40,due_date:null}]}else!l.payment_breakdown||l.payment_breakdown.length===0?l.payment_breakdown=[{label:"Payment 1",percentage:100,due_date:null}]:l.payment_breakdown.forEach(k=>{k.due_date===void 0&&(k.due_date=null)})}),u}catch(h){return console.error("Error fetching services and payment data:",h),v.value.general="Failed to fetch services and payment data.",null}finally{P.value=!1}}},B=async()=>{v.value={},P.value=!0;try{const h={services:i.services,service_details:i.service_details,total_amount:parseFloat(x.value),payment_type:i.payment_type,currency:i.currency},u=await window.axios.put(`/api/projects/${a.projectId}/sections/services-payment`,h);oe("Services and payment information updated successfully!"),f("updated")}catch(h){h.response&&h.response.status===422?v.value=h.response.data.errors:h.response&&h.response.data.message?v.value.general=h.response.data.message:(v.value.general="Failed to update services and payment information.",console.error("Error:",h))}finally{P.value=!1}},ne=(h,u)=>{u?(i.service_details.some(l=>l.service_id===h)||i.service_details.push({service_id:h,amount:"",frequency:"one_off",start_date:"",payment_breakdown:[{label:"Payment 1",percentage:100,due_date:null}],currency:i.currency}),j[h]=!0):(i.service_details=i.service_details.filter(l=>l.service_id!==h),j[h]=!1)},c=h=>{let u=i.service_details.find(l=>l.service_id===h);if(!u)u={service_id:h,amount:"",frequency:"one_off",start_date:"",payment_breakdown:[{label:"Payment 1",percentage:100,due_date:null}],currency:i.currency},i.service_details.push(u);else if(u.payment_breakdown&&!Array.isArray(u.payment_breakdown)){const l=u.payment_breakdown;u.payment_breakdown=[{label:"First",percentage:parseInt(l.first)||30,due_date:null},{label:"Second",percentage:parseInt(l.second)||30,due_date:null},{label:"Third",percentage:parseInt(l.third)||40,due_date:null}]}else!u.payment_breakdown||u.payment_breakdown.length===0?u.payment_breakdown=[{label:"Payment 1",percentage:100,due_date:null}]:u.payment_breakdown.forEach(l=>{l.due_date===void 0&&(l.due_date=null)});return u},p=h=>{const u=c(h);return!u.payment_breakdown||!Array.isArray(u.payment_breakdown)?0:u.payment_breakdown.reduce((l,k)=>l+(parseInt(k.percentage)||0),0)},y=h=>{const u=c(h);if(u.payment_breakdown||(u.payment_breakdown=[]),!Array.isArray(u.payment_breakdown)){const A=u.payment_breakdown;u.payment_breakdown=[{label:"First",percentage:parseInt(A.first)||30,due_date:null},{label:"Second",percentage:parseInt(A.second)||30,due_date:null},{label:"Third",percentage:parseInt(A.third)||40,due_date:null}]}const l=u.payment_breakdown.length;let k=0;if(l>0){const A=u.payment_breakdown[l-1];k=Math.floor(A.percentage/2),A.percentage-=k}else k=100;u.payment_breakdown.push({label:`Payment ${l+1}`,percentage:k,due_date:null})},z=(h,u)=>{const l=c(h);if(!l.payment_breakdown||!Array.isArray(l.payment_breakdown)||l.payment_breakdown.length<=1)return;const k=parseInt(l.payment_breakdown[u].percentage)||0;if(l.payment_breakdown.splice(u,1),k>0&&l.payment_breakdown.length>0){const A=u>0&&u<=l.payment_breakdown.length?u-1:0;l.payment_breakdown[A].percentage=(parseInt(l.payment_breakdown[A].percentage)||0)+k}l.payment_breakdown.forEach((A,O)=>{A.label=`Payment ${O+1}`})},F=h=>{j[h]=!j[h]};return se(()=>a.projectId,h=>{h&&M()},{immediate:!0}),(h,u)=>(n(),d("div",as,[v.value.general?(n(),d("div",ss,[u[6]||(u[6]=t("strong",{class:"font-bold"},"Error!",-1)),t("span",ls,V(v.value.general),1)])):b("",!0),P.value?(n(),d("div",os,u[7]||(u[7]=[t("svg",{class:"animate-spin -ml-1 mr-3 h-8 w-8 text-blue-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),t("span",{class:"text-gray-600"},"Loading services and payment data...",-1)]))):(n(),d("div",ns,[D.value?(n(),d("div",rs,[t("div",is,[t("div",null,[u[10]||(u[10]=t("p",{class:"text-sm opacity-90"},"Next Payment Due",-1)),t("p",ds,V(D.value.date),1),t("p",us,[u[8]||(u[8]=R(" For: ",-1)),t("span",cs,V(D.value.serviceLabel),1),u[9]||(u[9]=R(" - ",-1)),t("span",ms,V(D.value.paymentLabel),1)])]),u[11]||(u[11]=t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-12 w-12 opacity-70",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1))])])):(n(),d("div",vs," No upcoming payment due dates found for one-off services. ")),t("div",ps,[u[13]||(u[13]=t("h4",{class:"text-xl font-semibold text-gray-700 mb-4"},"Overall Project Payment Details",-1)),t("div",gs,[t("div",null,[o(U,{for:"calculated_total_amount",value:"Calculated Total Amount"}),o(G,{id:"calculated_total_amount",type:"text",class:"mt-1 block w-full bg-gray-100 cursor-not-allowed",value:x.value,disabled:""},null,8,["value"]),u[12]||(u[12]=t("p",{class:"text-sm text-gray-500 mt-1"},"This amount is automatically calculated from selected services.",-1))]),t("div",null,[o(U,{for:"payment_type",value:"Payment Type"}),ge(t("select",{id:"payment_type",class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full p-2.5","onUpdate:modelValue":u[0]||(u[0]=l=>i.payment_type=l),required:"",disabled:!e.canManageProjectServicesAndPayments},[(n(!0),d(ue,null,ce(e.paymentTypeOptions,l=>(n(),d("option",{key:l.value,value:l.value},V(l.label),9,fs))),128))],8,ys),[[Ve,i.payment_type]]),o(T,{message:v.value.payment_type?v.value.payment_type[0]:"",class:"mt-2"},null,8,["message"])]),t("div",null,[o(U,{for:"overall_currency",value:"Overall Project Currency"}),o(ae,{id:"overall_currency",modelValue:i.currency,"onUpdate:modelValue":u[1]||(u[1]=l=>i.currency=l),options:N,"value-key":"value","label-key":"label",class:"w-full mt-1",disabled:!e.canManageProjectServicesAndPayments},null,8,["modelValue","disabled"]),o(T,{message:v.value.currency?v.value.currency[0]:"",class:"mt-2"},null,8,["message"])])])]),t("div",bs,[u[20]||(u[20]=t("h4",{class:"text-xl font-semibold text-gray-700 mb-4"},"Manage Services",-1)),t("div",ws,[o(U,{for:"services",value:"Select Services",class:"mb-2"}),t("div",hs,[(n(!0),d(ue,null,ce(w.value,l=>(n(),d("div",{key:l.value,class:"bg-white p-4 rounded-lg shadow-sm border border-gray-200"},[t("div",xs,[t("label",{for:`service_${l.value}`,class:"flex items-center cursor-pointer"},[o(dt,{id:`service_${l.value}`,value:l.value,checked:i.services,"onUpdate:checked":[u[2]||(u[2]=k=>i.services=k),k=>ne(l.value,k)],disabled:!e.canManageProjectServicesAndPayments},null,8,["id","value","checked","onUpdate:checked","disabled"]),t("span",js,V(l.label),1)],8,ks),(i.services||[]).includes(l.value)?(n(),d("button",{key:0,onClick:k=>F(l.value),type:"button",class:W(["text-gray-500 hover:text-gray-700 transition-transform duration-200",{"rotate-180":j[l.value]}])},u[14]||(u[14]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"})],-1)]),10,_s)):b("",!0)]),(i.services||[]).includes(l.value)&&j[l.value]?(n(),d("div",Ps,[t("div",$s,[t("div",null,[o(U,{for:`service_amount_${l.value}`,value:"Amount"},null,8,["for"]),o(G,{id:`service_amount_${l.value}`,type:"number",step:"0.01",placeholder:"Service Amount",class:"w-full mt-1",modelValue:c(l.value).amount,"onUpdate:modelValue":k=>c(l.value).amount=k,disabled:!e.canManageProjectServicesAndPayments},null,8,["id","modelValue","onUpdate:modelValue","disabled"])]),t("div",null,[o(U,{for:`service_currency_${l.value}`,value:"Currency"},null,8,["for"]),o(ae,{id:`service_currency_${l.value}`,modelValue:c(l.value).currency,"onUpdate:modelValue":k=>c(l.value).currency=k,options:N,"value-key":"value","label-key":"label",class:"w-full mt-1",disabled:!e.canManageProjectServicesAndPayments},null,8,["id","modelValue","onUpdate:modelValue","disabled"])])]),t("div",Ss,[t("div",null,[o(U,{for:`service_frequency_${l.value}`,value:"Frequency"},null,8,["for"]),ge(t("select",{id:`service_frequency_${l.value}`,class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full p-2.5","onUpdate:modelValue":k=>c(l.value).frequency=k,disabled:!e.canManageProjectServicesAndPayments},u[15]||(u[15]=[t("option",{value:"monthly"},"Monthly",-1),t("option",{value:"one_off"},"One off",-1)]),8,Vs),[[Ve,c(l.value).frequency]])]),t("div",null,[o(U,{for:`service_start_date_${l.value}`,value:"Start Date"},null,8,["for"]),o(G,{id:`service_start_date_${l.value}`,type:"date",class:"w-full mt-1",modelValue:c(l.value).start_date,"onUpdate:modelValue":k=>c(l.value).start_date=k,disabled:!e.canManageProjectServicesAndPayments},null,8,["id","modelValue","onUpdate:modelValue","disabled"])])]),c(l.value).frequency!=="monthly"?(n(),d("div",Cs,[t("div",Is,[o(U,{value:"Payment Breakdown (%)",class:"text-base font-medium text-blue-800"}),e.canManageProjectServicesAndPayments?(n(),Z(ee,{key:0,type:"button",onClick:k=>y(l.value),class:"px-4 py-2 text-sm"},{default:H(()=>u[16]||(u[16]=[R(" + Add Payment Step ",-1)])),_:2,__:[16]},1032,["onClick"])):b("",!0)]),t("div",Ds,[(n(!0),d(ue,null,ce(c(l.value).payment_breakdown,(k,A)=>(n(),d("div",{key:A,class:"bg-white p-4 rounded-md shadow-sm border border-blue-100"},[t("div",Us,[o(U,{for:`payment_label_${A}_${l.value}`,value:k.label,class:"font-semibold"},null,8,["for","value"]),e.canManageProjectServicesAndPayments&&c(l.value).payment_breakdown.length>1?(n(),d("button",{key:0,type:"button",class:"text-red-500 hover:text-red-700 p-1 rounded-full hover:bg-red-100 transition-colors",onClick:O=>z(l.value,A),title:"Remove payment step"},u[17]||(u[17]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor"},[t("path",{"fill-rule":"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 011-1h4a1 1 0 110 2H8a1 1 0 01-1-1zm-1 3a1 1 0 100 2h8a1 1 0 100-2H6z","clip-rule":"evenodd"})],-1)]),8,Ms)):b("",!0)]),t("div",As,[t("div",null,[o(U,{for:`payment_percentage_${A}_${l.value}`,value:"Percentage (%)",class:"text-sm"},null,8,["for"]),o(G,{id:`payment_percentage_${A}_${l.value}`,type:"number",min:"0",max:"100",class:"w-full mt-1",modelValue:k.percentage,"onUpdate:modelValue":O=>k.percentage=O,modelModifiers:{number:!0},onInput:O=>{k.percentage=Math.max(0,Math.min(100,parseInt(O.target.value)||0))},disabled:!e.canManageProjectServicesAndPayments},null,8,["id","modelValue","onUpdate:modelValue","onInput","disabled"])]),t("div",null,[o(U,{for:`payment_due_date_${A}_${l.value}`,value:"Due Date (Optional)",class:"text-sm"},null,8,["for"]),o(G,{id:`payment_due_date_${A}_${l.value}`,type:"date",class:"w-full mt-1",modelValue:k.due_date,"onUpdate:modelValue":O=>k.due_date=O,disabled:!e.canManageProjectServicesAndPayments},null,8,["id","modelValue","onUpdate:modelValue","disabled"]),e.canManageProjectServicesAndPayments&&k.due_date?(n(),d("button",{key:0,type:"button",class:"text-xs text-red-500 hover:text-red-700 mt-1",onClick:O=>k.due_date=null}," Clear Date ",8,Ns)):b("",!0)])])]))),128))]),t("div",{class:W(["text-sm mt-4 p-2 rounded-md",{"bg-green-100 text-green-700":p(l.value)===100,"bg-red-100 text-red-700 font-bold":p(l.value)!==100}])},[R(" Total Percentage: "+V(p(l.value))+"% ",1),p(l.value)!==100?(n(),d("span",Bs," (Total must be 100%) ")):b("",!0)],2)])):b("",!0)])):b("",!0)]))),128))])]),t("div",Ts,[e.canManageProjectServicesAndPayments&&!s.value?(n(),d("button",{key:0,type:"button",class:"inline-flex items-center px-4 py-2 bg-blue-600 border border-transparent rounded-md font-semibold text-xs text-white uppercase tracking-widest hover:bg-blue-700 active:bg-blue-900 focus:outline-none focus:border-blue-900 focus:ring ring-blue-300 disabled:opacity-25 transition ease-in-out duration-150 shadow-md",onClick:u[3]||(u[3]=l=>s.value=!0)},u[18]||(u[18]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 4v16m8-8H4"})],-1),R(" Add New Service/Department ",-1)]))):b("",!0),e.canManageProjectServicesAndPayments&&s.value?(n(),d("div",Os,[o(G,{type:"text",class:"flex-grow mr-2 border-gray-300 rounded-md shadow-sm p-2.5",modelValue:r.value,"onUpdate:modelValue":u[4]||(u[4]=l=>r.value=l),placeholder:"Enter new service/department name",onKeyup:Ye(X,["enter"])},null,8,["modelValue"]),o(ee,{onClick:X},{default:H(()=>u[19]||(u[19]=[R("Add",-1)])),_:1,__:[19]}),t("button",{type:"button",class:"ml-2 text-sm text-gray-500 hover:text-gray-700 px-3 py-2 rounded-md transition-colors",onClick:u[5]||(u[5]=l=>{s.value=!1,r.value=""})}," Cancel ")])):b("",!0)]),o(T,{message:v.value.services?v.value.services[0]:"",class:"mt-2"},null,8,["message"])]),e.canManageProjectServicesAndPayments?(n(),d("div",Rs,[o(ee,{onClick:B,disabled:J.value,class:W([{"opacity-50 cursor-not-allowed":J.value},"px-6 py-3 text-base"])},{default:H(()=>u[21]||(u[21]=[R(" Update Services & Payment ",-1)])),_:1,__:[21]},8,["disabled","class"])])):b("",!0)]))]))}},Q=$({}),Es=localStorage.getItem("displayCurrency"),Be=$(Es||"USD");se(Be,e=>{localStorage.setItem("displayCurrency",e)});const Me=async()=>{try{const e=await window.axios.get("/api/currency-rates");Q.value=e.data,console.log("Fetched currency rates:",Q.value)}catch(e){console.error("Failed to fetch currency rates:",e),Q.value={PKR:.0034,AUD:.65,INR:.012,EUR:1.08,GBP:1.28,USD:1}}},le=(e,g="USD")=>{if(isNaN(e)||e==null)return"0.00";try{return new Intl.NumberFormat("en-US",{style:"currency",currency:g,minimumFractionDigits:2,maximumFractionDigits:2}).format(e)}catch(a){return console.warn(`Error formatting currency for ${e} ${g}:`,a),`${g} ${parseFloat(e).toFixed(2)}`}},fe=(e,g,a)=>{if(isNaN(e)||e==null||!g||!a)return 0;if(g.toUpperCase()===a.toUpperCase())return Number(e);const f=Q.value,v=f[g.toUpperCase()],P=f[a.toUpperCase()];if(!v||!P)return console.warn(`Missing conversion rates for: ${g} or ${a}. Cannot perform conversion.`),Number(e);const I=Number(e)*v/P;return Number(I.toFixed(2))},zs={class:"p-6 bg-white rounded-lg"},Ls={key:0,class:"text-red-600 text-sm mb-4"},qs={key:1,class:"mb-6 p-4 bg-gray-50 rounded-md"},Ks={class:"mb-6"},Hs={class:"flex justify-end items-center mb-4"},Gs={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},Ys={class:"p-3 bg-blue-100 rounded-md"},Ws={class:"text-lg font-bold text-blue-800"},Js={class:"p-3 bg-red-100 rounded-md"},Xs={class:"text-lg font-bold text-red-800"},Qs={class:"text-xs text-gray-500"},Zs={class:"p-3 bg-purple-100 rounded-md"},el={class:"text-lg font-bold text-purple-800"},tl={class:"p-3 bg-green-100 rounded-md"},al={class:"text-lg font-bold text-green-800"},sl={class:"p-3 bg-yellow-100 rounded-md col-span-full md:col-span-1"},ll={class:"text-lg font-bold text-yellow-800"},ol={class:"text-xs text-gray-500"},nl={class:"p-3 bg-orange-100 rounded-md col-span-full md:col-span-1"},rl={class:"text-lg font-bold text-orange-900 mt-1"},il={class:"text-xs text-gray-500"},dl={class:"p-3 bg-gray-100 rounded-md col-span-full md:col-span-1"},ul={class:"text-lg font-bold mt-1 text-green-400"},cl={class:"p-3 bg-gray-100 rounded-md col-span-full md:col-span-1"},ml={class:"text-lg font-bold text-red-400 mt-1"},vl={class:"grid grid-cols-1 gap-4 md:grid-cols-2"},pl={key:0},gl={key:1},yl={class:"mt-4 flex justify-end"},fl={key:2},bl={key:0,class:"space-y-3"},wl={key:1,class:"p-4 bg-gray-50 rounded-md text-gray-600 text-center"},hl={key:2,class:"space-y-4"},xl={class:"flex justify-between items-start mb-2"},kl={class:"flex-grow"},jl={class:"font-medium text-gray-900 text-lg"},_l={class:"text-xs text-gray-500 mt-1"},Pl={class:"flex-shrink-0 text-right"},$l={key:0,class:"text-sm text-gray-600"},Sl={class:"flex justify-between items-end text-xs text-gray-600 mt-2 border-t border-gray-200 pt-2"},Vl={key:0,class:"block"},Cl={key:1,class:"block"},Il={key:2,class:"block mt-1 text-gray-500"},Dl={class:"flex space-x-2 mt-2"},Ul={key:0,class:"mt-4 p-4 bg-blue-50 rounded-md border border-blue-200"},Ml={class:"text-md font-medium text-gray-900 mb-4"},Al={class:"mb-4"},Nl={class:"mb-4"},Bl={class:"flex items-center"},Tl=["disabled"],Ol={class:"text-sm text-gray-700"},Rl={key:0,class:"mb-4"},Fl={class:"flex justify-end space-x-2"},Ae=.25,El={__name:"ProjectTransactions",props:{projectId:{type:[Number,String],required:!0},userProjectRole:{type:Object,default:()=>({})}},setup(e){const g=e,{canDo:a,canManage:f}=Ne(()=>g.projectId),v=f("project_expenses",g.userProjectRole),P=f("project_income",g.userProjectRole),N=a("view_project_transactions",g.userProjectRole),I=$([]),w=$([]),r=$({}),s=$(""),i=$(!1),j=$(null),x=$(""),D=$(!1),Y=$({}),J=$(null),X=$(""),M=$({description:"",amount:"",currency:"PKR",user_id:null,hours_spent:"",type:"expense"}),B=Be,ne=[{value:"PKR",label:"PKR"},{value:"AUD",label:"AUD"},{value:"INR",label:"INR"},{value:"USD",label:"USD"},{value:"EUR",label:"EUR"},{value:"GBP",label:"GBP"}],c=[{value:"expense",label:"Expense"},{value:"income",label:"Income"},{value:"bonus",label:"Bonus"}],p=K(()=>w.value.map(_=>({value:_.id,label:_.name||"Unknown User"}))),y=()=>{const _=new Date,m=_.getFullYear(),L=String(_.getMonth()+1).padStart(2,"0"),te=String(_.getDate()).padStart(2,"0");return`${m}-${L}-${te}`},z=async()=>{if(!(!g.projectId||!N.value))try{const _=await window.axios.get(`/api/projects/${g.projectId}/sections/clients-users`);w.value=_.data.users||[]}catch(_){s.value="Failed to fetch users.",console.error("Error fetching users:",_)}},F=async()=>{if(!(!g.projectId||!N.value)){i.value=!0;try{(!Q.value||Object.keys(Q.value).length===0)&&await Me();const _=await window.axios.get(`/api/projects/${g.projectId}/sections/transactions`);I.value=_.data}catch(_){s.value="Failed to fetch transactions.",console.error("Error fetching transactions:",_)}finally{i.value=!1}}},h=async()=>{var _;if(!v.value&&!P.value){E("You do not have permission to manage transactions.");return}if(!M.value.amount||isNaN(M.value.amount)){r.value.amount=["Please enter a valid amount"];return}if(M.value.type==="expense"&&!v.value){E("You do not have permission to add expenses.");return}if(M.value.type==="income"&&!P.value){E("You do not have permission to add income.");return}if(M.value.type==="bonus"&&!v.value){E("You do not have permission to add bonuses.");return}r.value={},s.value="",i.value=!0;try{const m={...M.value,amount:Number(M.value.amount)},L=await window.axios.post(`/api/projects/${g.projectId}/transactions`,m);await F(),u(),oe("Transaction saved successfully!")}catch(m){((_=m.response)==null?void 0:_.status)===422?r.value=m.response.data.errors:(s.value="Failed to save transaction.",console.error("Error saving transaction:",m))}finally{i.value=!1}},u=()=>{M.value={description:"",amount:"",currency:"PKR",user_id:null,hours_spent:"",type:"expense"}},l=async _=>{if(!v.value&&!P.value){E("You do not have permission to delete transactions.");return}if(window.confirm("Are you sure you want to delete this transaction?"))try{const m=I.value[_].id;await window.axios.delete(`/api/projects/${g.projectId}/transactions/${m}`),await F(),oe("Transaction deleted successfully!")}catch(m){s.value="Failed to delete transaction.",console.error("Error deleting transaction:",m)}},k=_=>{if(!v.value&&!P.value){E("You do not have permission to manage transactions.");return}const m=I.value[_];j.value===m.id?(j.value=null,J.value=null,X.value=""):(J.value=_,j.value=m.id,x.value=m.amount,D.value=!1,Y.value={},X.value=y(),(Number(m.amount)===0||Math.abs(Number(x.value)-Number(m.amount))<.01)&&(D.value=!0))};se(x,_=>{if(J.value!==null){const m=I.value[J.value];D.value=Math.abs(Number(_)-Number(m.amount))<.01}});const A=()=>{j.value=null,J.value=null,x.value="",D.value=!1,Y.value={},X.value=""},O=async()=>{var te;if(!v.value&&!P.value){E("You do not have permission to manage transactions.");return}const _=J.value,m=I.value[_],L=Number(x.value);if(!D.value&&(!x.value||isNaN(L)||L<=0||L>Number(m.amount))){Y.value.amount=["Please enter a valid amount between 0 and "+le(Number(m.amount),m.currency)];return}if(!X.value){Y.value.date=["Please select a payment date."];return}Y.value={},i.value=!0;try{const de=m.id,ye=D.value||Math.abs(L-Number(m.amount))<.01,he={payment_amount:ye?Number(m.amount):L,pay_in_full:ye,transaction_currency:m.currency,transaction_type:m.type,original_description:m.description,payment_date:X.value};await window.axios.patch(`/api/projects/${g.projectId}/transactions/${de}/process-payment`,he),await F(),oe("Payment processed successfully!"),A()}catch(de){((te=de.response)==null?void 0:te.status)===422?Y.value=de.response.data.errors:(s.value="Failed to process payment.",console.error("Error processing payment:",de))}finally{i.value=!1}},q=K(()=>!Q.value||Object.keys(Q.value).length===0?0:I.value.filter(_=>_.type==="income").reduce((_,m)=>_+fe(parseFloat(m.amount||0),m.currency,B.value),0)),ve=K(()=>!Q.value||Object.keys(Q.value).length===0?0:I.value.filter(_=>_.type==="expense").reduce((_,m)=>_+fe(parseFloat(m.amount||0),m.currency,B.value),0)),we=K(()=>!Q.value||Object.keys(Q.value).length===0?0:I.value.filter(_=>_.type==="bonus").reduce((_,m)=>_+fe(parseFloat(m.amount||0),m.currency,B.value),0)),Te=K(()=>le(q.value,B.value)),Oe=K(()=>le(ve.value,B.value)),Re=K(()=>le(we.value,B.value)),Fe=K(()=>{if(!Q.value||Object.keys(Q.value).length===0)return le(0,B.value);const _=ve.value+we.value;return le(q.value-_,B.value)}),Ee=K(()=>q.value===0?"0.00%":`${(ve.value/q.value*100).toFixed(2)}%`),ze=K(()=>q.value===0?"0.00%":`${((ve.value+we.value)/q.value*100).toFixed(2)}%`),Le=K(()=>{if(q.value<=0)return le(0,B.value);const _=q.value*Ae;return le(_,B.value)}),qe=K(()=>{const _=I.value.filter(L=>(L.type==="expense"||L.type==="bonus")&&L.is_paid&&L.payment_date);if(_.length===0)return"N/A";const m=_.reduce((L,te)=>new Date(te.payment_date)>new Date(L.payment_date)?te:L);return new Date(m.payment_date).toLocaleDateString()}),Ke=K(()=>{const _=I.value.filter(L=>L.type==="income"&&L.payment_date);if(_.length===0)return"N/A";const m=_.reduce((L,te)=>new Date(te.payment_date)>new Date(L.payment_date)?te:L);return new Date(m.payment_date).toLocaleDateString()});return me(async()=>{const _=localStorage.getItem("displayCurrency");_&&(B.value=_),await Me(),F(),z()}),se([()=>g.projectId,B,Q],()=>{g.projectId&&Q.value&&Object.keys(Q.value).length>0&&(F(),z())},{deep:!0}),se(B,_=>{_&&localStorage.setItem("displayCurrency",_)},{deep:!0}),(_,m)=>{var L,te,de,ye,he,je;return n(),d("div",zs,[s.value?(n(),d("div",Ls,V(s.value),1)):b("",!0),C(v)||C(P)?(n(),d("div",qs,[t("div",Ks,[t("div",Hs,[m[10]||(m[10]=t("span",{class:"text-sm font-medium text-gray-700 mr-2"},"Currency:",-1)),o(ae,{id:"transactions-display-currency-switcher",modelValue:C(B),"onUpdate:modelValue":m[0]||(m[0]=S=>We(B)?B.value=S:null),options:ne,"value-key":"value","label-key":"label",class:"w-24"},null,8,["modelValue"])]),m[19]||(m[19]=t("h4",{class:"text-md font-medium text-gray-700 mb-2"},"Summary",-1)),t("div",Gs,[t("div",Ys,[m[11]||(m[11]=t("p",{class:"text-sm text-gray-600"},"Total Income",-1)),t("p",Ws,V(Te.value),1)]),t("div",Js,[m[12]||(m[12]=t("p",{class:"text-sm text-gray-600"},"Total Expenses",-1)),t("p",Xs,V(Oe.value),1),t("p",Qs,"("+V(Ee.value)+" of Income)",1)]),t("div",Zs,[m[13]||(m[13]=t("p",{class:"text-sm text-gray-600"},"Total Bonuses",-1)),t("p",el,V(Re.value),1)]),t("div",tl,[m[14]||(m[14]=t("p",{class:"text-sm text-gray-600"},"Balance",-1)),t("p",al,V(Fe.value),1)]),t("div",sl,[m[15]||(m[15]=t("p",{class:"text-sm text-gray-600"},"Expense + Bonus",-1)),t("p",ll,V(C(le)(ve.value+we.value,C(B))),1),t("p",ol,"("+V(ze.value)+" of Income)",1)]),t("div",nl,[m[16]||(m[16]=t("p",{class:"text-sm font-medium text-orange-800"},"Estimated Income Tax (AUD)",-1)),t("p",rl,V(Le.value),1),t("p",il," (Based on "+V((Ae*100).toFixed(1))+"% of Total Income. This is an estimation.) ",1)]),t("div",dl,[m[17]||(m[17]=t("p",{class:"text-sm font-medium text-gray-800"},"Last Payment Received Date",-1)),t("p",ul,V(Ke.value),1)]),t("div",cl,[m[18]||(m[18]=t("p",{class:"text-sm font-medium text-gray-800"},"Last Payment Sent Date",-1)),t("p",ml,V(qe.value),1)])])]),m[20]||(m[20]=t("h4",{class:"text-md font-medium text-gray-700 mb-4"},"Add Transaction",-1)),t("div",vl,[t("div",null,[o(U,{for:"description",value:"Description"}),o(G,{id:"description",modelValue:M.value.description,"onUpdate:modelValue":m[1]||(m[1]=S=>M.value.description=S),class:"mt-1 block w-full",disabled:i.value},null,8,["modelValue","disabled"]),o(T,{message:(L=r.value.description)==null?void 0:L[0],class:"mt-2"},null,8,["message"])]),t("div",null,[o(U,{for:"amount",value:"Amount"}),o(G,{id:"amount",type:"number",modelValue:M.value.amount,"onUpdate:modelValue":m[2]||(m[2]=S=>M.value.amount=S),class:"mt-1 block w-full",disabled:i.value},null,8,["modelValue","disabled"]),o(T,{message:(te=r.value.amount)==null?void 0:te[0],class:"mt-2"},null,8,["message"])]),t("div",null,[o(U,{for:"currency",value:"Currency"}),o(ae,{id:"currency",modelValue:M.value.currency,"onUpdate:modelValue":m[3]||(m[3]=S=>M.value.currency=S),options:ne,disabled:i.value},null,8,["modelValue","disabled"]),o(T,{message:(de=r.value.currency)==null?void 0:de[0],class:"mt-2"},null,8,["message"])]),t("div",null,[o(U,{for:"type",value:"Type"}),o(ae,{id:"type",modelValue:M.value.type,"onUpdate:modelValue":m[4]||(m[4]=S=>M.value.type=S),options:c,disabled:i.value||!C(v)&&M.value.type==="expense"&&M.value.type!=="bonus"||!C(P)&&M.value.type==="income"},null,8,["modelValue","disabled"]),o(T,{message:(ye=r.value.type)==null?void 0:ye[0],class:"mt-2"},null,8,["message"])]),M.value.type==="expense"||M.value.type==="bonus"?(n(),d("div",pl,[o(U,{for:"user_id",value:"User"}),o(ae,{id:"user_id",modelValue:M.value.user_id,"onUpdate:modelValue":m[5]||(m[5]=S=>M.value.user_id=S),options:p.value,disabled:i.value||!w.value.length,placeholder:"Select a user"},null,8,["modelValue","options","disabled"]),o(T,{message:(he=r.value.user_id)==null?void 0:he[0],class:"mt-2"},null,8,["message"])])):b("",!0),M.value.type==="expense"||M.value.type==="bonus"?(n(),d("div",gl,[o(U,{for:"hours_spent",value:"Hours Spent (Optional)"}),o(G,{id:"hours_spent",type:"number",modelValue:M.value.hours_spent,"onUpdate:modelValue":m[6]||(m[6]=S=>M.value.hours_spent=S),class:"mt-1 block w-full",disabled:i.value},null,8,["modelValue","disabled"]),o(T,{message:(je=r.value.hours_spent)==null?void 0:je[0],class:"mt-2"},null,8,["message"])])):b("",!0)]),t("div",yl,[o(ee,{onClick:h,disabled:i.value},{default:H(()=>[R(V(i.value?"Saving...":"Save Transaction"),1)]),_:1},8,["disabled"])])])):b("",!0),C(N)?(n(),d("div",fl,[m[24]||(m[24]=t("h4",{class:"text-md font-medium text-gray-700 mb-4"},"Transaction History",-1)),i.value?(n(),d("div",bl,m[21]||(m[21]=[t("div",{class:"h-4 bg-gray-200 rounded animate-pulse w-full"},null,-1),t("div",{class:"h-4 bg-gray-200 rounded animate-pulse w-5/6"},null,-1),t("div",{class:"h-4 bg-gray-200 rounded animate-pulse w-3/4"},null,-1)]))):I.value.length===0?(n(),d("div",wl," No transactions found for this project. ")):(n(),d("div",hl,[(n(!0),d(ue,null,ce(I.value,(S,_e)=>{var Pe,$e,Se;return n(),d("div",{key:S.id,class:W([{"bg-green-50 border-green-200":S.type==="income","bg-red-50 border-red-200":S.type==="expense","bg-purple-50 border-purple-200":S.type==="bonus","border-l-4":!0},"p-4 rounded-md shadow-sm transition-all duration-200 ease-in-out hover:shadow-md"])},[t("div",xl,[t("div",kl,[t("p",jl,V(S.description),1),t("p",_l,V(S.type==="income"?"Income":S.type==="expense"?"Expense":"Bonus")+" on "+V(new Date(S.created_at).toLocaleDateString()),1)]),t("div",Pl,[t("p",{class:W(["text-lg font-bold",{"text-green-700":S.type==="income","text-red-700":S.type==="expense","text-purple-700":S.type==="bonus"}])},V(C(le)(S.amount,S.currency)),3),S.currency.toUpperCase()!==C(B).toUpperCase()?(n(),d("p",$l," ("+V(C(le)(C(fe)(S.amount,S.currency,C(B)),C(B)))+") ",1)):b("",!0),t("span",{class:W(["block text-xs mt-1",S.is_paid?"text-green-600":"text-red-600"])},V(S.is_paid?"Paid":"Unpaid"),3)])]),t("div",Sl,[t("div",null,[S.user_id?(n(),d("span",Vl,"User: "+V(((Pe=w.value.find(re=>re.id===S.user_id))==null?void 0:Pe.name)||"Unknown"),1)):b("",!0),S.hours_spent?(n(),d("span",Cl,"Hours: "+V(S.hours_spent),1)):b("",!0),(S.type==="expense"||S.type==="bonus")&&q.value>0?(n(),d("span",Il,V((C(fe)(S.amount,S.currency,C(B))/q.value*100).toFixed(2))+"% of Income ",1)):b("",!0)]),t("div",Dl,[!S.is_paid&&(C(v)||C(P))?(n(),Z(be,{key:0,onClick:re=>k(_e),class:W({"text-green-600":S.type!=="income","text-blue-600":S.type==="income"})},{default:H(()=>[R(V(S.type==="income"?"Receive":"Pay"),1)]),_:2},1032,["onClick","class"])):b("",!0),C(v)||C(P)?(n(),Z(be,{key:1,onClick:re=>l(_e),class:"text-red-600"},{default:H(()=>m[22]||(m[22]=[R(" Delete ",-1)])),_:2,__:[22]},1032,["onClick"])):b("",!0)])]),j.value===S.id?(n(),d("div",Ul,[t("h4",Ml,V(S.type==="income"?"Record Receipt":"Make Payment"),1),t("div",Al,[o(U,{for:"payment_date",value:"Date"}),o(G,{id:"payment_date",type:"date",modelValue:X.value,"onUpdate:modelValue":m[7]||(m[7]=re=>X.value=re),class:"mt-1 block w-full",disabled:i.value},null,8,["modelValue","disabled"]),o(T,{message:($e=Y.value.date)==null?void 0:$e[0],class:"mt-2"},null,8,["message"])]),t("div",Nl,[t("label",Bl,[ge(t("input",{type:"checkbox","onUpdate:modelValue":m[8]||(m[8]=re=>D.value=re),class:"mr-2 rounded text-blue-600 focus:ring-blue-500",disabled:i.value},null,8,Tl),[[Je,D.value]]),t("span",Ol,V(S.type==="income"?"Receive in Full":"Pay in Full"),1)])]),D.value?b("",!0):(n(),d("div",Rl,[o(U,{for:"payment_amount",value:"Amount"}),o(G,{id:"payment_amount",type:"number",modelValue:x.value,"onUpdate:modelValue":m[9]||(m[9]=re=>x.value=re),class:"mt-1 block w-full",disabled:i.value,placeholder:"Enter partial "+(S.type==="income"?"receipt":"payment")+" amount (Max: "+C(le)(S.amount,S.currency)+")"},null,8,["modelValue","disabled","placeholder"]),o(T,{message:(Se=Y.value.amount)==null?void 0:Se[0],class:"mt-2"},null,8,["message"])])),t("div",Fl,[o(be,{onClick:A,disabled:i.value},{default:H(()=>m[23]||(m[23]=[R(" Cancel ",-1)])),_:1,__:[23]},8,["disabled"]),o(ee,{onClick:O,disabled:i.value},{default:H(()=>[R(V(i.value?"Processing...":S.type==="income"?"Record Receipt":"Submit Payment"),1)]),_:2},1032,["disabled"])])])):b("",!0)],2)}),128))]))])):b("",!0)])}}},zl={class:"p-6 w-full mx-auto bg-white rounded-xl shadow-2xl transition-all duration-300"},Ll={class:"border-b border-gray-200 mb-6"},ql={class:"flex -mb-px space-x-4 overflow-x-auto pb-2"},Kl={class:"py-4"},lo={__name:"ProjectForm",props:{projectId:{type:[Number,String],default:null},statusOptions:{type:Array,required:!0},departmentOptions:{type:Array,required:!0},sourceOptions:{type:Array,required:!0},clientRoleOptions:{type:Array,default:()=>[]},userRoleOptions:{type:Array,default:()=>[]},paymentTypeOptions:{type:Array,required:!0},errors:{type:Object,default:()=>({})},isSaving:{type:Boolean,default:!1}},emits:["close"],setup(e,{emit:g}){Xe();const a=e,f=$(a.projectId);se(()=>a.projectId,A=>{f.value=A,A&&Qe(A)},{immediate:!0}),Ze(f);const v=et(f),{canDo:P,canView:N,canManage:I}=Ne(f),w=P("manage_projects",v);P("create_clients",v);const r=P("upload_project_documents",v),s=I("project_services_and_payments",v),i=P("add_project_notes",v),j=I("project_users",v),x=I("project_clients",v),D=P("manage_project_basic_details",v),Y=N("project_documents",v),J=N("project_services_and_payments",v),X=N("project_notes",v),M=N("project_users",v),B=N("project_clients",v),ne=N("project_transactions",v),c=N("project_deliverables"),p=I("project_deliverables"),y=$("basic"),z=K(()=>B.value&&M.value?"Clients and Users":B.value?"Clients":M.value?"Users":"Clients and Users"),F=$([]),h=$([]),u=$([]),l=$([]),k=A=>{if(A!=="basic"&&!a.projectId){tt("Please create the project first before managing this section."),y.value="basic";return}y.value=A};return me(async()=>{try{F.value=await De("client"),h.value=await De("project"),u.value=await mt(!0,null),l.value=await vt(!0,null)}catch(A){console.error("Error fetching global data for ProjectForm:",A)}}),(A,O)=>(n(),d("div",zl,[O[7]||(O[7]=t("div",{class:"flex justify-between items-center pb-4 mb-6 border-b border-gray-200"},[t("h2",{class:"text-2xl font-semibold text-gray-800"},"Edit Project")],-1)),t("div",Ll,[t("nav",ql,[t("button",{onClick:O[0]||(O[0]=q=>k("basic")),class:W(["py-3 px-5 text-center border-b-2 font-medium text-base rounded-t-lg transition-colors duration-200 whitespace-nowrap",y.value==="basic"?"border-indigo-600 text-indigo-700 bg-indigo-50":"border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300 hover:bg-gray-50"])}," Basic Information ",2),e.projectId&&(C(B)||C(M))?(n(),d("button",{key:0,onClick:O[1]||(O[1]=q=>k("client")),class:W(["py-3 px-5 text-center border-b-2 font-medium text-base rounded-t-lg transition-colors duration-200 whitespace-nowrap",y.value==="client"?"border-indigo-600 text-indigo-700 bg-indigo-50":"border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300 hover:bg-gray-50"])},V(z.value),3)):b("",!0),e.projectId&&(C(s)||C(J))?(n(),d("button",{key:1,onClick:O[2]||(O[2]=q=>k("services")),class:W(["py-3 px-5 text-center border-b-2 font-medium text-base rounded-t-lg transition-colors duration-200 whitespace-nowrap",y.value==="services"?"border-indigo-600 text-indigo-700 bg-indigo-50":"border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300 hover:bg-gray-50"])}," Services & Payment ",2)):b("",!0),e.projectId&&C(ne)?(n(),d("button",{key:2,onClick:O[3]||(O[3]=q=>k("transactions")),class:W(["py-3 px-5 text-center border-b-2 font-medium text-base rounded-t-lg transition-colors duration-200 whitespace-nowrap",y.value==="transactions"?"border-indigo-600 text-indigo-700 bg-indigo-50":"border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300 hover:bg-gray-50"])}," Transactions ",2)):b("",!0),e.projectId&&C(Y)?(n(),d("button",{key:3,onClick:O[4]||(O[4]=q=>k("documents")),class:W(["py-3 px-5 text-center border-b-2 font-medium text-base rounded-t-lg transition-colors duration-200 whitespace-nowrap",y.value==="documents"?"border-indigo-600 text-indigo-700 bg-indigo-50":"border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300 hover:bg-gray-50"])}," Documents ",2)):b("",!0),e.projectId&&(C(i)||C(X))?(n(),d("button",{key:4,onClick:O[5]||(O[5]=q=>k("notes")),class:W(["py-3 px-5 text-center border-b-2 font-medium text-base rounded-t-lg transition-colors duration-200 whitespace-nowrap",y.value==="notes"?"border-indigo-600 text-indigo-700 bg-indigo-50":"border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300 hover:bg-gray-50"])}," Notes ",2)):b("",!0),e.projectId&&(C(p)||C(c))?(n(),d("button",{key:5,onClick:O[6]||(O[6]=q=>k("deliverables")),class:W(["py-3 px-5 text-center border-b-2 font-medium text-base rounded-t-lg transition-colors duration-200 whitespace-nowrap",y.value==="deliverables"?"border-indigo-600 text-indigo-700 bg-indigo-50":"border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300 hover:bg-gray-50"])}," Deliverables ",2)):b("",!0)])]),t("div",Kl,[y.value==="basic"?(n(),Z(It,{key:0,projectId:e.projectId,errors:a.errors,statusOptions:e.statusOptions,sourceOptions:e.sourceOptions,canManageProjects:C(w),canManageProjectBasicDetails:C(D),isSaving:a.isSaving},null,8,["projectId","errors","statusOptions","sourceOptions","canManageProjects","canManageProjectBasicDetails","isSaving"])):b("",!0),y.value==="client"?(n(),Z(aa,{key:1,projectId:e.projectId,errors:a.errors,clientRoleOptions:F.value,userRoleOptions:h.value,clients:u.value,users:l.value,canViewProjectClients:C(B),canManageProjectClients:C(x),canViewProjectUsers:C(M),canManageProjectUsers:C(j),isSaving:a.isSaving},null,8,["projectId","errors","clientRoleOptions","userRoleOptions","clients","users","canViewProjectClients","canManageProjectClients","canViewProjectUsers","canManageProjectUsers","isSaving"])):b("",!0),y.value==="services"?(n(),Z(Fs,{key:2,projectId:e.projectId,departmentOptions:e.departmentOptions,paymentTypeOptions:e.paymentTypeOptions,canManageProjectServicesAndPayments:C(s),canViewProjectServicesAndPayments:C(J),isSaving:a.isSaving},null,8,["projectId","departmentOptions","paymentTypeOptions","canManageProjectServicesAndPayments","canViewProjectServicesAndPayments","isSaving"])):b("",!0),y.value==="transactions"&&C(ne)?(n(),Z(El,{key:3,projectId:e.projectId,userProjectRole:C(v),isSaving:a.isSaving},null,8,["projectId","userProjectRole","isSaving"])):b("",!0),y.value==="documents"?(n(),Z(xa,{key:4,projectId:e.projectId,errors:a.errors,canUploadProjectDocuments:C(r),canViewProjectDocuments:C(Y),isSaving:a.isSaving},null,8,["projectId","errors","canUploadProjectDocuments","canViewProjectDocuments","isSaving"])):b("",!0),y.value==="notes"?(n(),Z(Ba,{key:5,projectId:e.projectId,errors:a.errors,canAddProjectNotes:C(i),canViewProjectNotes:C(X),"is-saving":a.isSaving},null,8,["projectId","errors","canAddProjectNotes","canViewProjectNotes","is-saving"])):b("",!0),y.value==="deliverables"?(n(),Z(ts,{key:6,projectId:e.projectId,errors:a.errors,canManageProjectDeliverables:C(p),canViewProjectDeliverables:C(c),isSaving:a.isSaving},null,8,["projectId","errors","canManageProjectDeliverables","canViewProjectDeliverables","isSaving"])):b("",!0)])]))}};export{lo as _,fe as a,Me as b,Q as c,Be as d,le as f};
