import{C as j,r as d,c as g,D as q,f as G,e as H,g as J,o as n,w as S,b as t,a as r,t as i,m as Q,i as k,v as X,x as Z,d as v,F as ee,l as te,j as F,p as _}from"./app-CU8Enz16.js";import{_ as se}from"./AuthenticatedLayout-abPaN7Ss.js";import{S as y}from"./SelectDropdown-DsHC57Ev.js";import"./PrimaryButton-COKGJaSm.js";import"./Modal-Cqj67yeb.js";import"./InputLabel-Caxyu6DF.js";import"./InputError-BnBfB1Lj.js";import"./SecondaryButton-FTQRB9KZ.js";import"./index-CVB6L0-X.js";import"./BaseFormModal-Ce2OEYKp.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./TextInput-Bf6QSqan.js";import"./debounce-C-hnF4Z3.js";import"./ApplicationLogo-2ZZGYW6V.js";import"./createLucideIcon-B2SLs8wL.js";import"./plus-DW9FnXnk.js";import"./DangerButton-DW1wgMQQ.js";import"./moment-BLMuvzoS.js";import"./NoticeboardModal-De9xzDnJ.js";/* empty css                                                                       */const le={class:"py-8 bg-gray-50 min-h-screen"},ae={class:"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8"},oe={class:"bg-white shadow-xl rounded-2xl p-6"},ne={class:"mb-6 border-b pb-4"},re={class:"flex flex-col sm:flex-row justify-between items-center mt-3 text-sm font-medium text-gray-500"},ie={class:"flex items-center space-x-2"},de={class:"text-2xl font-extrabold text-cyan-600"},ce={class:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-4 mb-6"},ue={class:"col-span-1"},pe={class:"col-span-1"},me={class:"col-span-1"},ge={class:"col-span-1"},fe={key:0,class:"col-span-1"},be={key:0,class:"flex justify-center items-center h-48"},xe={key:1},ve={key:0,class:"text-center py-10 text-gray-500"},_e={key:1,class:"divide-y divide-gray-200"},ye={class:"flex-1 w-full sm:w-auto"},he={class:"flex items-center space-x-2"},we={class:"text-xs text-gray-500 font-mono"},je={key:0,class:"text-xs text-gray-400 font-medium"},ke={class:"mt-1 font-medium text-gray-900 leading-snug"},Ce={class:"mt-2"},Ve={class:"mt-3 sm:mt-0 text-right w-full sm:w-auto"},Pe={key:2,class:"mt-6 flex flex-col sm:flex-row items-center justify-between"},Me={class:"text-sm text-gray-600 mb-2 sm:mb-0"},Ae={class:"flex space-x-2"},Se=["disabled"],Fe=["disabled"],Ze={__name:"Index",setup(De){const u=j({loading:!1,error:null}),C=new Date,D=a=>a<10?"0"+a:""+a,f=d(`${C.getFullYear()}-${D(C.getMonth()+1)}`),b=d([]),o=j({current_page:1,per_page:20,total:0,last_page:1}),l=j({pointable_type:"",project_id:null,user_id:null,status:"paid"}),T=[{value:"Task",label:"Task"},{value:"Milestone",label:"Milestone"},{value:"Kudo",label:"Kudo"},{value:"ProjectNote",label:"Project Note"},{value:"Email",label:"Email"},{value:"WeeklyStreak",label:"Weekly Standup Streak"}],N=g(()=>[{value:null,label:"All Statuses"},{value:"paid",label:"Awarded"},{value:"pending",label:"Pending"},{value:"refunded",label:"Refunded"},{value:"cancelled",label:"Cancelled"},{value:"rejected",label:"Rejected"},{value:"consumed",label:"Consumed"},{value:"denied",label:"Denied"}]),V=d([]),O=g(()=>[{value:null,label:"All Projects"},...V.value]),P=d([]),U=g(()=>[{value:null,label:"Me"},{value:"all",label:"All Users"},...P.value]),z=g(()=>[{value:"",label:"All Types"},...T]),{canDo:B}=q(),h=g(()=>B("manage_projects").value),w=d(0);d(0),d(!1);const p=async()=>{const{year:a,month:e}=M();try{const s={year:a,month:e},m=(l.user_id==="all","/api/points-ledger/total");l.user_id!=="all"&&(s.user_id=l.user_id);const Y=await _.get(m,{params:s});w.value=Y.data.total_points||0}catch(s){console.error("Failed to fetch total points",s),w.value=0}},L=async()=>{try{const[a,e]=await Promise.all([_.get("/api/projects-simplified"),h.value?_.get("/api/users"):Promise.resolve({data:[]})]);V.value=(a.data||[]).map(s=>({value:s.id,label:s.name})),P.value=(e.data||[]).map(s=>({value:s.id,label:s.name}))}catch(a){console.error("Failed to fetch filter options",a)}},M=()=>{const[a,e]=f.value.split("-");return{year:parseInt(a,10),month:parseInt(e,10)}},c=async()=>{const{year:a,month:e}=M();u.loading=!0,u.error=null;try{const s={year:a,month:e,page:o.current_page,per_page:o.per_page};l.pointable_type&&(s.pointable_type=l.pointable_type),l.project_id&&(s.project_id=l.project_id),h.value&&l.user_id!==null&&(s.user_id=l.user_id),l.status&&(s.status=l.status);const m=await _.get("/api/points-ledger",{params:s});b.value=Array.isArray(m.data.data)?m.data.data:[],Object.assign(o,m.data.pagination||{})}catch(s){console.error("Failed to fetch points ledger",s),u.error="Failed to load ledger.",b.value=[]}finally{u.loading=!1}},R=()=>{o.current_page=1,p(),c()},x=()=>{o.current_page=1,c(),p()},W=()=>{l.pointable_type="",l.project_id=null,l.user_id=null,l.status="paid",o.current_page=1,c(),p()},A=a=>{o.current_page=a,c()},$=()=>{o.current_page=1,c(),p()},I=a=>new Date(a).toLocaleString(),E=a=>{switch(a){case"paid":return"Awarded";case"denied":return"Denied";default:return a}},K=a=>{const e="inline-block px-2 py-0.5 rounded-full text-xs capitalize ";switch(a){case"paid":return e+"bg-green-100 text-green-700";case"pending":return e+"bg-yellow-100 text-yellow-700";case"rejected":case"cancelled":case"denied":return e+"bg-red-100 text-red-700";default:return e+"bg-gray-100 text-gray-700"}};return G(async()=>{await L(),await c(),await p()}),H(f,()=>{}),(a,e)=>(n(),J(se,null,{header:S(()=>e[7]||(e[7]=[t("h2",{class:"font-semibold text-xl text-gray-800 leading-tight"},"My Points Ledger",-1)])),default:S(()=>[t("div",le,[t("div",ae,[t("div",oe,[t("div",ne,[e[10]||(e[10]=t("h3",{class:"text-lg font-bold text-gray-700"},"Points Summary",-1)),t("div",re,[t("div",ie,[e[8]||(e[8]=t("span",{class:"text-sm"},"Total Points for selected month:",-1)),t("span",de,i(w.value),1)]),t("div",{class:"mt-4 sm:mt-0"},[t("button",{onClick:$,class:"inline-flex items-center px-4 py-2 bg-cyan-600 hover:bg-cyan-700 text-white font-semibold rounded-lg shadow-md transition-transform transform hover:scale-105"},e[9]||(e[9]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2",viewBox:"0 0 20 20",fill:"currentColor"},[t("path",{"fill-rule":"evenodd",d:"M4 2a1 1 0 011 1v2.128a8 8 0 109.11-1.353l-.924-.925a1 1 0 01.707-1.707L16 0h4v4l-2.062 2.062a10.001 10.001 0 01-14.864 1.353V3a1 1 0 011-1zm12 8a6 6 0 11-12 0 6 6 0 0112 0z","clip-rule":"evenodd"})],-1),Q(" Refresh ",-1)]))])])]),t("div",ce,[t("div",ue,[e[11]||(e[11]=t("label",{for:"month-select",class:"block text-sm font-medium text-gray-700 mb-1"},"Month",-1)),X(t("input",{type:"month",id:"month-select","onUpdate:modelValue":e[0]||(e[0]=s=>f.value=s),onChange:R,class:"w-full border-gray-300 rounded-lg shadow-sm focus:border-cyan-500 focus:ring-cyan-500"},null,544),[[Z,f.value]])]),t("div",pe,[e[12]||(e[12]=t("label",{for:"type-select",class:"block text-sm font-medium text-gray-700 mb-1"},"Type",-1)),v(y,{id:"type-select",options:z.value,modelValue:l.pointable_type,"onUpdate:modelValue":e[1]||(e[1]=s=>l.pointable_type=s),placeholder:"All Types",onChange:x,class:"w-full"},null,8,["options","modelValue"])]),t("div",me,[e[13]||(e[13]=t("label",{for:"status-select",class:"block text-sm font-medium text-gray-700 mb-1"},"Status",-1)),v(y,{id:"status-select",options:N.value,modelValue:l.status,"onUpdate:modelValue":e[2]||(e[2]=s=>l.status=s),placeholder:"All Statuses",onChange:x,class:"w-full"},null,8,["options","modelValue"])]),t("div",ge,[e[14]||(e[14]=t("label",{for:"project-select",class:"block text-sm font-medium text-gray-700 mb-1"},"Project",-1)),v(y,{id:"project-select",options:O.value,modelValue:l.project_id,"onUpdate:modelValue":e[3]||(e[3]=s=>l.project_id=s),placeholder:"All Projects",onChange:x,class:"w-full"},null,8,["options","modelValue"])]),h.value?(n(),r("div",fe,[e[15]||(e[15]=t("label",{for:"user-select",class:"block text-sm font-medium text-gray-700 mb-1"},"User",-1)),v(y,{id:"user-select",options:U.value,modelValue:l.user_id,"onUpdate:modelValue":e[4]||(e[4]=s=>l.user_id=s),placeholder:"Me",onChange:x,class:"w-full"},null,8,["options","modelValue"])])):k("",!0),t("div",{class:"col-span-1 flex items-end"},[t("button",{onClick:W,class:"w-full inline-flex items-center justify-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-cyan-500"}," Clear Filters ")])]),u.loading?(n(),r("div",be,e[16]||(e[16]=[t("div",{class:"animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-cyan-500"},null,-1)]))):(n(),r("div",xe,[b.value.length===0?(n(),r("div",ve,e[17]||(e[17]=[t("p",null,"No ledger entries found for the selected filters.",-1)]))):(n(),r("ul",_e,[(n(!0),r(ee,null,te(b.value,s=>(n(),r("li",{key:s.id,class:"py-4 px-3 sm:px-0 flex flex-col sm:flex-row items-start sm:items-center justify-between transition-all duration-200 hover:bg-gray-50 rounded-lg"},[t("div",ye,[t("div",he,[t("span",we,i(I(s.created_at)),1),s.project?(n(),r("span",je," • "+i(s.project.name),1)):k("",!0)]),t("div",ke,i(s.description||"—"),1),t("div",Ce,[t("span",{class:F([K(s.status),"font-semibold px-2 py-0.5 rounded-full text-xs capitalize"])},i(E(s.status)),3)])]),t("div",Ve,[t("div",{class:F(["text-xl font-extrabold",s.points_awarded>=0?"text-green-600":"text-red-600"])},i(Math.round(s.points_awarded))+" pts ",3)])]))),128))])),o.total>o.per_page?(n(),r("div",Pe,[t("div",Me,"Showing "+i(o.current_page*o.per_page-o.per_page+1)+" to "+i(Math.min(o.current_page*o.per_page,o.total))+" of "+i(o.total)+" entries",1),t("div",Ae,[t("button",{disabled:o.current_page<=1,onClick:e[5]||(e[5]=s=>A(o.current_page-1)),class:"px-4 py-2 border rounded-md disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-100 transition-colors duration-200"}," Previous ",8,Se),t("button",{disabled:o.current_page>=o.last_page,onClick:e[6]||(e[6]=s=>A(o.current_page+1)),class:"px-4 py-2 border rounded-md disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-100 transition-colors duration-200"}," Next ",8,Fe)])])):k("",!0)]))])])])]),_:1}))}};export{Ze as default};
