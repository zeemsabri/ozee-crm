import{a as i,o as l,b as e,r as w,c as k,e as ue,g as Q,w as H,i as A,d as p,G as K,t as g,H as Xe,I as Ce,m as I,j as G,C as J,F as ee,l as oe,x as Je,y as ht,u as c,n as wt,k as we,q as _t,f as kt,h as Ct,J as $t,K as Dt,D as jt,L as ce,M as Mt}from"./app-DX_kpFIm.js";import{B as ve,a as St,_ as At}from"./AuthenticatedLayout-4_vVQXnG.js";import{S as me}from"./SelectDropdown-BJCCW54h.js";import{P as ie}from"./PrimaryButton-sFvYxQdk.js";import{_ as Qe}from"./SecondaryButton-BU2P0zIF.js";import{c as W,a as pe,d as Pt,f as Z,b as Bt}from"./currency-BeHlUI7j.js";import{_ as te}from"./InputLabel-CPEJYW8f.js";import{_ as le}from"./TextInput-C27byKBs.js";import{_ as se}from"./InputError-LF5oFGJM.js";import{_ as Tt}from"./Modal-Bz-jdteD.js";import{r as _e,a as Lt}from"./PlusIcon-C2N4BMul.js";import{r as Rt}from"./MagnifyingGlassIcon-C7UQA8eY.js";import{a as ke,r as Vt}from"./PlusCircleIcon-B0H94AGI.js";import{r as ze,a as Nt,b as It}from"./XCircleIcon-Dn-ZdoZX.js";import{r as Ft}from"./TrashIcon-CnLwBc6q.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./Checkbox-B4rLB8uU.js";import"./ApplicationLogo-CdjsY3HW.js";import"./DangerButton-CBQdq_r-.js";import"./moment-BLMuvzoS.js";/* empty css                                                                       */function Ut($,E){return l(),i("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m19.5 8.25-7.5 7.5-7.5-7.5"})])}function Et($,E){return l(),i("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M21 12a2.25 2.25 0 0 0-2.25-2.25H15a3 3 0 1 1-6 0H5.25A2.25 2.25 0 0 0 3 12m18 0v6a2.25 2.25 0 0 1-2.25 2.25H5.25A2.25 2.25 0 0 1 3 18v-6m18 0V9M3 12V9m18 0a2.25 2.25 0 0 0-2.25-2.25H5.25A2.25 2.25 0 0 0 3 9m18 0V6a2.25 2.25 0 0 0-2.25-2.25H5.25A2.25 2.25 0 0 0 3 6v3"})])}const qt={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ot={key:0},Kt={class:"md:col-span-2"},Ge={__name:"MilestoneExpendableModal",props:{show:Boolean,title:String,milestone:Object,users:Object,currencyOptions:Array,isBudgetForm:{type:Boolean,default:!1},isUserSelectionRequired:{type:Boolean,default:!1},projectTotalBudget:Number,projectBudgetCurrency:String,milestoneStats:Object},emits:["close","submitted"],setup($,{emit:E}){const n=$,V=E,o=w({}),b=w(""),M=w("post"),C=w(""),P=w(""),h=w({}),R=k(()=>{var S;return((Array.isArray((S=n.users)==null?void 0:S.users)?n.users.users:n.users)||[]).map(u=>({value:u.id,label:u.name}))});ue(()=>n.show,r=>{r&&n.milestone&&(h.value={},n.isBudgetForm?(o.value=n.milestone.budget?{...n.milestone.budget,amount:Number(n.milestone.budget.amount)}:{name:"Milestone Budget",description:"",amount:"",currency:"PKR"},b.value=n.milestone.budget?`/api/projects/${n.milestone.project_id}/expendables/${n.milestone.budget.id}`:`/api/projects/${n.milestone.project_id}/expendables`,M.value=n.milestone.budget?"put":"post",C.value=n.milestone.budget?"Update Budget":"Create Budget",P.value=n.milestone.budget?"Milestone budget updated successfully":"Milestone budget created successfully"):(o.value={name:"",description:"",amount:"",currency:"PKR",user_id:null},b.value=`/api/projects/${n.milestone.project_id}/expendables`,M.value="post",C.value="Create Contract",P.value="Contract created and sent for approval"))},{immediate:!0,deep:!0});const T=()=>{var u,x;h.value={};let r=!1;o.value.name||(h.value.name=["Name is required."],r=!0),(!o.value.amount||Number(o.value.amount)<=0)&&(h.value.amount=h.value.amount||[],h.value.amount.push("Amount must be a positive number."),r=!0),n.isUserSelectionRequired&&!o.value.user_id&&(h.value.user_id=["User selection is required for contracts."],r=!0),W(Number(o.value.amount||0),o.value.currency,n.projectBudgetCurrency);const S=W(Number(o.value.amount||0),o.value.currency,((u=n.milestone.budget)==null?void 0:u.currency)||"PKR");if(n.isBudgetForm){n.projectTotalBudget<=0&&(K("No project budget left. Ask a project admin to add more budget."),r=!0);const f=n.milestone.budget?W(Number(n.milestone.budget.amount||0),n.milestone.budget.currency,n.projectBudgetCurrency):0;n.milestoneStats.approvedAmt+(S-f)>W(n.projectTotalBudget,n.projectBudgetCurrency,((x=n.milestone.budget)==null?void 0:x.currency)||"PKR")&&(h.value.amount=["Cannot add more budget than the project's total expendable budget."],r=!0)}else S>n.milestoneStats.remaining&&(h.value.amount=["Cannot add a contract more than the remaining milestone budget."],r=!0);return!r},U=r=>({...r,amount:Number(r.amount||0),user_id:n.isBudgetForm?null:r.user_id,expendable_type:"Milestone",expendable_id:n.milestone.id}),N=r=>{V("submitted",r)},q=()=>{V("close")};return(r,S)=>(l(),Q(ve,{show:$.show,title:$.title,"api-endpoint":b.value,"http-method":M.value,"form-data":o.value,"submit-button-text":C.value,"success-message":P.value,"format-data-for-api":U,"before-submit":T,onSubmitted:N,onClose:q},{default:H(({errors:u})=>{var x,f,F,D,m,v,Y,d,j,L;return[e("div",qt,[e("div",null,[p(te,{for:"name",value:"Name"}),p(le,{id:"name",modelValue:o.value.name,"onUpdate:modelValue":S[0]||(S[0]=O=>o.value.name=O),class:"mt-1 w-full",placeholder:"e.g., Asset Purchase"},null,8,["modelValue"]),p(se,{message:((x=h.value.name)==null?void 0:x[0])||((f=u.name)==null?void 0:f[0]),class:"mt-1"},null,8,["message"])]),e("div",null,[p(te,{for:"amount",value:"Amount"}),p(le,{id:"amount",type:"number",step:"0.01",modelValue:o.value.amount,"onUpdate:modelValue":S[1]||(S[1]=O=>o.value.amount=O),class:"mt-1 w-full"},null,8,["modelValue"]),p(se,{message:((F=h.value.amount)==null?void 0:F[0])||((D=u.amount)==null?void 0:D[0]),class:"mt-1"},null,8,["message"])]),e("div",null,[p(te,{for:"currency",value:"Currency"}),p(me,{id:"currency",modelValue:o.value.currency,"onUpdate:modelValue":S[2]||(S[2]=O=>o.value.currency=O),options:$.currencyOptions,"value-key":"value","label-key":"label",class:"mt-1 w-full"},null,8,["modelValue","options"]),p(se,{message:((m=h.value.currency)==null?void 0:m[0])||((v=u.currency)==null?void 0:v[0]),class:"mt-1"},null,8,["message"])]),$.isBudgetForm?A("",!0):(l(),i("div",Ot,[p(te,{for:"user",value:"User"}),p(me,{id:"user",modelValue:o.value.user_id,"onUpdate:modelValue":S[3]||(S[3]=O=>o.value.user_id=O),options:R.value,"value-key":"value","label-key":"label",class:"mt-1 w-full",placeholder:"Select user"},null,8,["modelValue","options"]),p(se,{message:((Y=h.value.user_id)==null?void 0:Y[0])||((d=u.user_id)==null?void 0:d[0]),class:"mt-1"},null,8,["message"])])),e("div",Kt,[p(te,{for:"description",value:"Description (optional)"}),p(le,{id:"description",modelValue:o.value.description,"onUpdate:modelValue":S[4]||(S[4]=O=>o.value.description=O),class:"mt-1 w-full",placeholder:"Details"},null,8,["modelValue"]),p(se,{message:((j=h.value.description)==null?void 0:j[0])||((L=u.description)==null?void 0:L[0]),class:"mt-1"},null,8,["message"])])])]}),_:1},8,["show","title","api-endpoint","http-method","form-data","submit-button-text","success-message"]))}},Ht={class:"text-sm text-gray-600 mb-4"},Yt={class:"mt-2"},zt={__name:"ReasonModal",props:{show:{type:Boolean,default:!1},title:{type:String,default:"Reason Required"},message:{type:String,required:!0},type:{type:String,default:"info",validator:$=>["info","warning"].includes($)},apiEndpoint:{type:String,required:!0},httpMethod:{type:String,required:!0}},emits:["submitted","close"],setup($,{emit:E}){const n=$,V=E,o=w({reason:""}),b=w({}),M=()=>!o.value.reason||!o.value.reason.trim()?(K("Reason is required."),b.value.reason=["Reason is required."],!1):(b.value={},!0),C=()=>{V("submitted")},P=()=>{V("close")};return ue(()=>n.show,h=>{h&&(o.value={reason:""},b.value={})}),(h,R)=>(l(),Q(ve,{show:$.show,title:$.title,"api-endpoint":$.apiEndpoint,"http-method":$.httpMethod,"form-data":o.value,"submit-button-text":"Submit","success-message":"Operation successful!","before-submit":M,onClose:P,onSubmitted:C},{default:H(({errors:T})=>{var U,N;return[e("p",Ht,g($.message),1),e("div",Yt,[p(te,{for:"reason-input",value:"Reason"}),p(le,{id:"reason-input",modelValue:o.value.reason,"onUpdate:modelValue":R[0]||(R[0]=q=>o.value.reason=q),class:"mt-1 block w-full",onKeyup:Xe(C,["enter"])},null,8,["modelValue"]),p(se,{message:((U=T.reason)==null?void 0:U[0])||((N=b.value.reason)==null?void 0:N[0]),class:"mt-1"},null,8,["message"])])]}),_:1},8,["show","title","api-endpoint","http-method","form-data"]))}},Gt={class:"space-y-4"},Xt={key:1,id:"final-task-list",class:"space-y-3"},Jt={class:"flex items-center justify-between"},Qt={class:"flex-1"},Wt=["onClick"],Zt={key:0,class:"mt-0.5 text-xs text-gray-600 truncate"},es=["id","value","onBlur","onKeyup"],ts={class:"flex items-center space-x-2 ml-4"},ss=["onClick"],os=["onClick"],ns={key:0,class:"mt-4"},ls=["onUpdate:modelValue"],as={class:"flex flex-col sm:flex-row sm:items-center space-y-2 sm:space-y-0 sm:space-x-4 text-xs text-gray-500 mt-2"},rs={class:"flex items-center space-x-2"},is=["onClick"],us=["onClick"],ds=["value","onChange","min","max"],cs={class:"flex items-center space-x-2"},ps=["onClick"],ms=["onClick"],vs=["onClick"],gs={class:"flex justify-end space-x-3"},fs={__name:"BulkTaskModal",props:{show:{type:Boolean,default:!1},contractId:{type:Number,required:!0},completionDate:{type:String,required:!1,default:null}},emits:["close","tasks-submitted"],setup($,{emit:E}){const n=$,V=E,o=Ce([]),b=w(""),M=w({show:!1,text:"",type:"success"}),C=new Date,P=new Date(C);P.setDate(C.getDate()+1);const h=w("");ue(()=>n.show,m=>{m||(o.splice(0,o.length),b.value="",h.value="",M.value={show:!1,text:"",type:"success"})});const R=()=>{h.value&&h.value.trim()!==""&&(o.push({name:h.value,dueDate:"",priority:"Medium",contract_id:n.contractId,description:"",isEditingName:!1,showDescription:!1}),h.value="",M.value.show=!1)},T=m=>{o.splice(m,1)},U=(m,v)=>{o[m].priority=v},N=(m,v)=>{const Y=new Date(C.getFullYear(),C.getMonth(),C.getDate()),d=n.completionDate?new Date(n.completionDate):null,j=new Date(v);if(M.value.show=!1,d&&j>d){M.value={show:!0,text:"The selected due date is after the milestone completion date.",type:"error"},o[m].dueDate="";return}if(j<Y){M.value={show:!0,text:"The selected due date cannot be in the past.",type:"error"},o[m].dueDate="";return}o[m].dueDate=v},q=m=>{o[m].showDescription=!o[m].showDescription},r=m=>{o[m].isEditingName=!0,wt(()=>{document.getElementById(`task-name-input-${m}`).focus()})},S=(m,v)=>{v.trim()&&(o[m].name=v),o[m].isEditingName=!1},u=m=>({tasks:m}),x=k(()=>o.length===0||o.some(m=>!m.name.trim()||!m.dueDate||!m.priority)),f=m=>{console.log("Submitting tasks to API:",o),M.value={show:!0,text:"Tasks submitted successfully!",type:"success"},setTimeout(()=>{M.value.show=!1,V("tasks-submitted"),m()},1500)},F=k(()=>o),D=m=>{const v=n.completionDate?new Date(n.completionDate):null,Y=new Date(C.getFullYear(),C.getMonth(),C.getDate()),d=new Date(m);return d>=Y&&(!v||d<=v)};return(m,v)=>(l(),Q(ve,{show:$.show,title:"Create Tasks in Bulk","api-endpoint":"/api/tasks/bulk","http-method":"post","form-data":F.value,"format-data-for-api":u,"submit-button-text":"Create Tasks",onClose:v[1]||(v[1]=Y=>m.$emit("close")),onSubmitted:f},{default:H(({errors:Y})=>[e("div",Gt,[M.value.show?(l(),i("div",{key:0,class:G(["mb-4 p-4 rounded-lg transition-all duration-300 ease-in-out",{"bg-green-100 text-green-700 border border-green-200":M.value.type==="success","bg-red-100 text-red-700 border border-red-200":M.value.type==="error"}])},g(M.value.text),3)):A("",!0),e("form",{onSubmit:J(R,["prevent"]),class:"relative"},[p(le,{modelValue:h.value,"onUpdate:modelValue":v[0]||(v[0]=d=>h.value=d),id:"task-name-input",placeholder:"e.g., 'Finish project report'",class:"w-full p-4 pr-12 text-lg border border-gray-300 rounded-xl focus:ring-indigo-500 focus:border-indigo-500 shadow-sm transition-all duration-200 ease-in-out"},null,8,["modelValue"]),v[2]||(v[2]=e("button",{type:"submit",class:"absolute right-4 top-1/2 -translate-y-1/2 p-2 text-indigo-600 hover:text-indigo-800"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})])],-1))],32),v[8]||(v[8]=e("hr",{class:"my-6 border-gray-200"},null,-1)),o.length>0?(l(),i("div",Xt,[v[7]||(v[7]=e("h2",{class:"text-lg font-semibold text-gray-800"},"Tasks to Create:",-1)),(l(!0),i(ee,null,oe(o,(d,j)=>(l(),i("div",{key:j,class:"flex flex-col p-4 bg-gray-50 rounded-xl border border-gray-200 group transition-all duration-200 ease-in-out"},[e("div",Jt,[e("div",Qt,[d.isEditingName?(l(),i("input",{key:1,id:`task-name-input-${j}`,type:"text",value:d.name,onBlur:L=>S(j,L.target.value),onKeyup:Xe(L=>S(j,L.target.value),["enter"]),class:"text-sm font-semibold text-gray-800 w-full rounded-md border-gray-300 focus:ring-indigo-500 focus:border-indigo-500 shadow-sm"},null,40,es)):(l(),i(ee,{key:0},[e("p",{onClick:L=>r(j),class:"text-sm font-semibold text-gray-800 truncate cursor-pointer hover:underline"},g(d.name),9,Wt),d.description&&d.description.trim().length?(l(),i("p",Zt,g(d.description),1)):A("",!0)],64))]),e("div",ts,[e("button",{type:"button",onClick:L=>q(j),class:G(["p-1 rounded-full transition-all duration-200 ease-in-out",[d.showDescription||d.description&&d.description.trim().length?"text-indigo-600 hover:text-indigo-700":"text-gray-400 hover:text-indigo-500"]]),title:"Add description"},v[3]||(v[3]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",class:"h-5 w-5"},[e("path",{d:"M19.5 14.25h-15m15-5.25h-15M9 19.5H4.5A1.5 1.5 0 013 18V6a1.5 1.5 0 011.5-1.5H15L21 9v9a1.5 1.5 0 01-1.5 1.5H15"})],-1)]),10,ss),e("button",{type:"button",onClick:L=>T(j),class:"remove-final-task p-1 rounded-full text-red-500 opacity-0 group-hover:opacity-100 transition-all duration-200 ease-in-out"},v[4]||(v[4]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z","clip-rule":"evenodd"})],-1)]),8,os)])]),d.showDescription?(l(),i("div",ns,[Je(e("textarea",{"onUpdate:modelValue":L=>d.description=L,rows:"2",placeholder:"Add an optional description...",class:"w-full rounded-md border-gray-300 focus:ring-indigo-500 focus:border-indigo-500 shadow-sm text-sm"},null,8,ls),[[ht,d.description]])])):A("",!0),e("div",as,[e("div",rs,[v[5]||(v[5]=e("span",{class:"font-medium"},"Due:",-1)),D(c(C).toISOString().split("T")[0])?(l(),i("button",{key:0,type:"button",onClick:L=>N(j,c(C).toISOString().split("T")[0]),class:G(["px-2 py-0.5 rounded-full text-indigo-600 bg-indigo-100 text-xs hover:bg-indigo-200",{"bg-indigo-300 font-semibold":d.dueDate===c(C).toISOString().split("T")[0]}])},"Today",10,is)):A("",!0),D(c(P).toISOString().split("T")[0])?(l(),i("button",{key:1,type:"button",onClick:L=>N(j,c(P).toISOString().split("T")[0]),class:G(["px-2 py-0.5 rounded-full text-indigo-600 bg-indigo-100 text-xs hover:bg-indigo-200",{"bg-indigo-300 font-semibold":d.dueDate===c(P).toISOString().split("T")[0]}])},"Tomorrow",10,us)):A("",!0),e("input",{type:"date",value:d.dueDate,onChange:L=>N(j,L.target.value),min:c(C).toISOString().split("T")[0],max:$.completionDate,required:"",class:G([d.dueDate?"border-gray-300":"border-red-300","p-1 rounded-lg border text-xs focus:ring-indigo-500 focus:border-indigo-500 shadow-sm transition-all duration-200 ease-in-out"])},null,42,ds)]),e("div",cs,[v[6]||(v[6]=e("span",{class:"font-medium"},"Priority:",-1)),e("button",{type:"button",onClick:L=>U(j,"Low"),class:G(["px-2 py-0.5 rounded-full text-gray-500 bg-gray-100 text-xs hover:bg-gray-200",{"bg-gray-200 font-semibold":d.priority==="Low"}])},"Low",10,ps),e("button",{type:"button",onClick:L=>U(j,"Medium"),class:G(["px-2 py-0.5 rounded-full text-blue-600 bg-blue-100 text-xs hover:bg-blue-200",{"bg-blue-200 font-semibold":d.priority==="Medium"}])},"Medium",10,ms),e("button",{type:"button",onClick:L=>U(j,"High"),class:G(["px-2 py-0.5 rounded-full text-red-600 bg-red-100 text-xs hover:bg-red-200",{"bg-red-200 font-semibold":d.priority==="High"}])},"High",10,vs)])])]))),128))])):A("",!0)])]),footer:H(({close:Y})=>[e("div",gs,[p(Qe,{onClick:Y,type:"button"},{default:H(()=>v[9]||(v[9]=[I(" Cancel ",-1)])),_:2,__:[9]},1032,["onClick"]),p(ie,{type:"submit",disabled:x.value,class:G({"opacity-50 cursor-not-allowed":x.value})},{default:H(()=>v[10]||(v[10]=[I(" Create Tasks ",-1)])),_:1,__:[10]},8,["disabled","class"])])]),_:1},8,["show","form-data"]))}},bs={class:"space-y-3"},ys={__name:"MilestoneCompletionDateModal",props:{show:{type:Boolean,default:!1},milestoneId:{type:[Number,String],required:!0},initialCompletionDate:{type:String,default:null}},emits:["close","updated"],setup($,{emit:E}){const n=$,V=E,o=Ce({completion_date:n.initialCompletionDate||null}),b=Ce({completion_date:null});ue(()=>n.show,R=>{R&&(o.completion_date=n.initialCompletionDate||null,b.completion_date=null)});const M=k(()=>`/api/milestones/${n.milestoneId}`),C=()=>(b.completion_date=null,o.completion_date?!0:(b.completion_date=["Completion date is required."],!1)),P=R=>{V("updated",R),V("close")},h=()=>V("close");return(R,T)=>(l(),Q(ve,{show:$.show,title:"Set Milestone Completion Date","api-endpoint":M.value,"http-method":"put","form-data":o,"submit-button-text":"Save Date","success-message":"Milestone updated","before-submit":C,onClose:h,onSubmitted:P},{default:H(({errors:U})=>{var N,q;return[e("div",bs,[T[1]||(T[1]=e("p",{class:"text-sm text-gray-600"}," This milestone does not have a completion date. Please set it to continue creating tasks for its contracts. ",-1)),e("div",null,[p(te,{for:"milestone-completion-date",value:"Completion Date"}),p(le,{id:"milestone-completion-date",modelValue:o.completion_date,"onUpdate:modelValue":T[0]||(T[0]=r=>o.completion_date=r),type:"date",class:"mt-1 block w-full",required:""},null,8,["modelValue"]),p(se,{message:((N=U.completion_date)==null?void 0:N[0])||((q=b.completion_date)==null?void 0:q[0]),class:"mt-1"},null,8,["message"])])])]}),_:1},8,["show","api-endpoint","form-data"]))}},xs={class:"mt-8 p-6 md:p-8 bg-white rounded-2xl shadow-xl space-y-8 font-sans"},hs={class:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 border-b pb-4"},ws={class:"flex-1"},_s={class:"text-xl font-bold text-gray-900"},ks={class:"text-sm text-gray-500 mt-1"},Cs={key:0},$s={class:"flex items-center gap-4 flex-shrink-0"},Ds={class:"relative w-28 h-28"},js={class:"w-full h-full transform -rotate-90"},Ms=["stroke-dashoffset"],Ss=["stroke-dashoffset"],As={class:"absolute inset-0 flex items-center justify-center"},Ps={class:"text-2xl font-bold text-gray-900"},Bs={class:"space-y-8 px-4"},Ts={class:"relative w-full h-2 rounded-full bg-gray-200"},Ls={class:"absolute -top-6 left-1/2 -translate-x-1/2 text-xs font-medium text-indigo-700 w-max"},Rs={class:"relative w-full h-4 mt-4 -top-8"},Vs={class:"w-2 h-2 rounded-full bg-gray-400 shadow-sm z-10 group relative"},Ns={key:0,class:"absolute -top-1 -right-1 w-3 h-3 text-xs bg-gray-500 text-white rounded-full flex items-center justify-center font-bold"},Is={class:"absolute top-full mt-2 w-max p-2 text-xs text-center text-white bg-gray-800 rounded-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none z-20"},Fs={class:"font-bold border-b pb-1 mb-1"},Us={class:"absolute top-full mt-2 w-max min-w-[70px]"},Es={class:"text-gray-500 text-xs truncate"},qs={__name:"ProjectProgressTimeline",props:{milestones:{type:Array,default:()=>[]},showTicks:{type:Boolean,default:!0},title:{type:String,default:"Project Progress & Timeline"},progressLabel:{type:String,default:"Project Progress"},timelineLabel:{type:String,default:"Timeline"}},setup($){const E=$,n=k(()=>(E.milestones||[]).filter(u=>!!(u!=null&&u.completion_date))),V=k(()=>[...n.value].sort((u,x)=>{const f=new Date(u.completion_date),F=new Date(x.completion_date);return f-F})),o=k(()=>(E.milestones||[]).length),b=k(()=>(E.milestones||[]).filter(u=>((u==null?void 0:u.status)||"").toLowerCase()==="completed")),M=k(()=>(E.milestones||[]).filter(u=>((u==null?void 0:u.status)||"").toLowerCase()==="approved")),C=k(()=>b.value.length+M.value.length);k(()=>o.value?Math.round(b.value.length/o.value*100):0);const P=k(()=>o.value?Math.round(M.value.length/o.value*100):0),h=k(()=>o.value?Math.round(C.value/o.value*100):0),R=k(()=>V.value.length?new Date(V.value[0].completion_date):null),T=k(()=>V.value.length?new Date(V.value[V.value.length-1].completion_date):null),U=k(()=>{if(!R.value||!T.value)return 0;const u=v=>new Date(v.getFullYear(),v.getMonth(),v.getDate(),12,0,0),x=u(R.value),f=u(T.value),F=u(new Date),D=f-x;if(D<=0)return 100;let m=(F-x)/D*100;return m<0&&(m=0),m>100&&(m=100),Math.round(m)}),N=u=>{const x=new Date,F=new Date(u)-x,D=Math.ceil(F/(1e3*60*60*24));return D===0?"Due Today":D>0?`${D} day${D===1?"":"s"} left`:`${Math.abs(D)} day${Math.abs(D)===1?"":"s"} overdue`},q=u=>{if(!R.value||!T.value)return 0;const x=new Date(R.value),f=new Date(T.value),F=new Date(u),D=f-x;return D<=0?100:(F-x)/D*100},r=k(()=>{const u={};return V.value.forEach(x=>{const f=new Date(x.completion_date).toLocaleDateString();u[f]||(u[f]={date:x.completion_date,milestones:[]}),u[f].milestones.push(x)}),Object.values(u)}),S=u=>{const x=Math.max(2,Math.min(98,u)),f=u<5?"0%":u>95?"-100%":"-50%";return{left:`${x}%`,transform:`translateX(${f})`}};return(u,x)=>(l(),i("div",xs,[e("header",hs,[e("div",ws,[e("h2",_s,g($.title),1),e("p",ks,[I(g(C.value)+" of "+g(o.value)+" milestones completed. ",1),R.value&&T.value?(l(),i("span",Cs," Project timeline: "+g(new Date(R.value).toLocaleDateString())+" — "+g(new Date(T.value).toLocaleDateString())+". ",1)):A("",!0)])]),e("div",$s,[e("div",Ds,[(l(),i("svg",js,[x[0]||(x[0]=e("circle",{class:"text-gray-200","stroke-width":"8",stroke:"currentColor",fill:"transparent",r:"44",cx:"56",cy:"56"},null,-1)),e("circle",{class:"text-indigo-500","stroke-width":"8","stroke-dasharray":276.46,"stroke-dashoffset":276.46-276.46*h.value/100,"stroke-linecap":"round",stroke:"currentColor",fill:"transparent",r:"44",cx:"56",cy:"56",style:{transition:"stroke-dashoffset 0.5s ease-in-out"}},null,8,Ms),x[1]||(x[1]=e("circle",{class:"text-gray-300","stroke-width":"8",stroke:"currentColor",fill:"transparent",r:"32",cx:"56",cy:"56"},null,-1)),e("circle",{class:"text-green-500","stroke-width":"8","stroke-dasharray":201.06,"stroke-dashoffset":201.06-201.06*P.value/100,"stroke-linecap":"round",stroke:"currentColor",fill:"transparent",r:"32",cx:"56",cy:"56",style:{transition:"stroke-dashoffset 0.5s ease-in-out"}},null,8,Ss)])),e("div",As,[e("span",Ps,g(h.value)+"%",1)])])])]),e("div",Bs,[e("div",Ts,[e("div",{class:"h-full bg-indigo-500 rounded-full",style:we({width:U.value+"%"})},null,4),R.value&&T.value?(l(),i("div",{key:0,class:"absolute top-1/2 -translate-y-1/2",style:we({left:`calc(${U.value}% - 8px)`})},[e("div",Ls," Today: "+g(new Date().toLocaleDateString()),1),x[2]||(x[2]=e("div",{class:"w-4 h-4 rounded-full bg-indigo-700 border-2 border-white shadow-md transform scale-125 transition-transform duration-200",title:"Today"},null,-1))],4)):A("",!0)]),e("div",Rs,[(l(!0),i(ee,null,oe(r.value,(f,F)=>(l(),i("div",{key:F,class:"absolute top-0 flex flex-col items-center text-center",style:we(S(q(f.date)))},[e("div",Vs,[f.milestones.length>1?(l(),i("div",Ns,g(f.milestones.length),1)):A("",!0),e("div",Is,[e("p",Fs,g(new Date(f.date).toLocaleDateString()),1),(l(!0),i(ee,null,oe(f.milestones,D=>(l(),i("p",{key:D.id,class:"text-left text-gray-300"}," - "+g(D.name),1))),128))])]),e("div",Us,[e("p",Es,g(new Date(f.date).toLocaleDateString()),1),e("p",{class:G(["text-xs font-medium truncate",{"text-red-500":N(f.date).includes("overdue"),"text-gray-600":!N(f.date).includes("overdue")}])},g(N(f.date)),3)])],4))),128))])])]))}},Os={class:"flex flex-col md:flex-row items-start md:items-center justify-between gap-4"},Ks={class:"flex items-center gap-3 w-full md:w-auto"},Hs={class:"flex-grow md:flex-grow-0 w-full md:w-64"},Ys={class:"w-24 md:w-32 flex-shrink-0"},zs={class:"py-8"},Gs={class:"max-w-7xl mx-auto sm:px-6 lg:px-8 space-y-6"},Xs={key:0},Js={class:"bg-white rounded-xl p-6 shadow-sm"},Qs={class:"grid grid-cols-1 md:grid-cols-3 gap-6"},Ws={class:"bg-green-50 rounded-lg p-5 shadow-sm flex flex-col justify-between"},Zs={class:"text-3xl font-bold text-green-900"},eo={class:"bg-yellow-50 rounded-lg p-5 shadow-sm flex flex-col justify-between"},to={class:"text-3xl font-bold text-yellow-900"},so={class:"bg-blue-50 rounded-lg p-5 shadow-sm flex flex-col justify-between"},oo={class:"text-3xl font-bold text-blue-900"},no={class:"bg-white rounded-xl shadow-sm p-6"},lo={class:"flex flex-col sm:flex-row items-start sm:items-center justify-between border-b pb-4 mb-4"},ao={class:"flex items-center gap-2"},ro={class:"flex space-x-2 mt-2 sm:mt-0"},io=["onClick"],uo={key:0,class:"text-center text-gray-500 py-12"},co={key:1},po={key:0,class:"text-center text-gray-500 py-12"},mo={key:1,class:"text-center text-gray-500 py-12"},vo={key:2,class:"space-y-4"},go=["onClick"],fo={class:"flex-grow"},bo={class:"font-bold text-lg text-gray-900 mb-1"},yo={key:0,class:"text-sm text-gray-600"},xo={class:"mt-1 text-xs text-gray-500 flex items-center gap-2"},ho={key:0},wo={class:"font-medium text-gray-700"},_o={key:1},ko={class:"flex items-center gap-4 text-sm text-gray-700"},Co={class:"hidden sm:flex items-center gap-4"},$o={class:"inline-flex items-center gap-1 text-gray-600"},Do={class:"font-semibold text-gray-800"},jo={class:"inline-flex items-center gap-1 text-gray-600"},Mo={class:"font-semibold text-green-700"},So={class:"inline-flex items-center gap-1 text-gray-600"},Ao={class:"font-semibold text-blue-700"},Po=["onClick"],Bo={class:"flex items-center gap-2"},To=["onClick"],Lo=["onClick"],Ro={class:"border-t border-gray-200 p-5 bg-white rounded-b-xl"},Vo={class:"mb-5"},No={class:"flex flex-wrap gap-2 text-xs"},Io={class:"inline-flex items-center gap-1 px-2 py-1 rounded-full bg-gray-100 text-gray-700"},Fo={class:"font-semibold"},Uo={class:"inline-flex items-center gap-1 px-2 py-1 rounded-full bg-slate-100 text-slate-700"},Eo={class:"font-semibold"},qo={class:"inline-flex items-center gap-1 px-2 py-1 rounded-full bg-blue-100 text-blue-700"},Oo={class:"font-semibold"},Ko={class:"inline-flex items-center gap-1 px-2 py-1 rounded-full bg-yellow-100 text-yellow-700"},Ho={class:"font-semibold"},Yo={class:"inline-flex items-center gap-1 px-2 py-1 rounded-full bg-orange-100 text-orange-700"},zo={class:"font-semibold"},Go={class:"inline-flex items-center gap-1 px-2 py-1 rounded-full bg-green-100 text-green-700"},Xo={class:"font-semibold"},Jo={class:"inline-flex items-center gap-1 px-2 py-1 rounded-full bg-red-100 text-red-700"},Qo={class:"font-semibold"},Wo={class:"flex justify-between items-center mb-4"},Zo={class:"flex items-center gap-2"},en={key:0,class:"text-center text-gray-500 text-sm py-4"},tn={key:1,class:"space-y-2"},sn={class:"flex items-center gap-2"},on={key:0,class:"text-gray-600 text-xs sm:text-sm"},nn={class:"font-medium"},ln={class:"flex items-center gap-4 mt-2 sm:mt-0"},an={class:"text-right"},rn={class:"font-semibold"},un={key:0,class:"text-gray-500 block text-xs"},dn={class:"flex gap-1.5"},cn=["onClick"],pn=["onClick"],mn=["onClick"],vn=["onClick"],gn={class:"mt-6 pt-4 border-t border-gray-200 flex flex-col items-start gap-2"},fn={class:"flex flex-wrap items-center gap-3"},bn={key:0,class:"text-sm text-red-600"},yn={class:"p-6 bg-white rounded-lg shadow-xl"},xn={class:"flex items-center justify-between mb-4"},hn={key:0,class:"text-gray-500 text-center py-4"},wn={key:1},_n={key:0,class:"text-gray-500 text-center py-4"},kn={key:1,class:"space-y-3 max-h-96 overflow-y-auto pr-2"},Cn={class:"text-sm text-gray-600 flex justify-between items-center mb-1"},$n={class:"font-medium"},Dn={class:"text-xs text-gray-400"},jn={class:"mt-1 text-gray-800 text-sm whitespace-pre-line"},Xn={__name:"Index",setup($){const E=w([]),n=w(null),V=w(!1),o=w("active"),b=w([]),M=w(!1),C=w(!1),P=w(!1),h=w(!1),R=w(!1),T=w([]),U=w(!1),N=w(!1),q=w(null),r=w(null),S=w(!1),u=w(null),x=w(null),f=w(null),F=[{value:"PKR",label:"PKR"},{value:"AUD",label:"AUD"},{value:"INR",label:"INR"},{value:"USD",label:"USD"},{value:"EUR",label:"EUR"},{value:"GBP",label:"GBP"}],{canDo:D}=_t();D("manage_project_financial");const m=D("approve_milestone_expendables"),v=D("approve_expendables"),Y=D("approve_milestones");D("view_monthly_budgets");const d=Pt,j=w(null),L=w("PKR"),O=w([]),We=[{id:"active",label:"Active Milestones"},{id:"completed",label:"Completed"},{id:"approved",label:"Approved"}],Ze=k(()=>(b.value||[]).filter(s=>!!s.completion_date)),ae=k(()=>[...Ze.value].sort((s,t)=>{const y=new Date(s.completion_date),B=new Date(t.completion_date);return y-B})),$e=k(()=>(b.value||[]).length),et=k(()=>(b.value||[]).filter(s=>{const t=(s.status||"").toLowerCase();return t==="completed"||t==="approved"}).length);k(()=>$e.value?Math.round(et.value/$e.value*100):0);const De=k(()=>ae.value.length?new Date(ae.value[0].completion_date):null),je=k(()=>ae.value.length?new Date(ae.value[ae.value.length-1].completion_date):null);k(()=>{if(!De.value||!je.value)return 0;const s=ne=>new Date(ne.getFullYear(),ne.getMonth(),ne.getDate(),12,0,0),t=s(De.value),y=s(je.value),B=s(new Date),z=y-t;if(z<=0)return 100;let X=(B-t)/z*100;return X<0&&(X=0),X>100&&(X=100),Math.round(X)});const Me=k(()=>b.value?o.value==="active"?b.value.filter(s=>s.status.toLowerCase()==="in progress"||s.status.toLowerCase()==="not started"||s.status.toLowerCase()==="pending"):o.value==="completed"?b.value.filter(s=>s.status.toLowerCase()==="completed"):o.value==="approved"?b.value.filter(s=>s.status.toLowerCase()==="approved"):b.value:[]),tt=k(()=>!b.value||!pe.value||Object.keys(pe.value).length===0?0:b.value.reduce((s,t)=>t.status.toLowerCase()!=="approved"?s+(t.expendable||[]).filter(y=>y.status==="Accepted").reduce((y,B)=>y+W(parseFloat(B.amount??0),B.currency,d.value),0):s,0)),st=k(()=>!b.value||!pe.value||Object.keys(pe.value).length===0?0:b.value.reduce((s,t)=>s+(t.expendable||[]).filter(y=>y.status==="Pending Approval").reduce((y,B)=>y+W(parseFloat(B.amount??0),B.currency,d.value),0),0)),ot=k(()=>{if(j.value==null)return Z(0,d.value);const s=W(parseFloat(j.value??0),L.value,d.value),t=b.value.reduce((y,B)=>y+(B.expendable||[]).filter(z=>z.status==="Accepted").reduce((z,X)=>z+W(parseFloat(X.amount??0),X.currency,d.value),0),0);return Z(s-t,d.value)});k(()=>{var t;return((Array.isArray((t=O.value)==null?void 0:t.users)?O.value.users:O.value)||[]).map(y=>({value:y.id,label:y.name}))});const re=s=>{if(!s)return{};const t=s.budget?W(Number(s.budget.amount||0),s.budget.currency,d.value):0,y=(s.expendable||[]).filter(B=>B.status==="Accepted").reduce((B,z)=>B+W(Number(z.amount||0),z.currency,d.value),0);return{budgetAmt:t,approvedAmt:y,remaining:t-y}},Se=s=>s?s.budget!==null:null,nt=(s,t)=>{if(!(!s||!t)){if(!s.completion_date){u.value=s,x.value=t.id,S.value=!0;return}r.value=s,q.value=t.id,N.value=!0}},lt=s=>{try{if(s&&s.id){const y=(b.value||[]).findIndex(B=>B.id===s.id);y!==-1&&(b.value[y]={...b.value[y],...s})}}catch(y){console.error("Failed to merge updated milestone",y)}const t=(b.value||[]).find(y=>{var B;return y.id===((s==null?void 0:s.id)||((B=u.value)==null?void 0:B.id))});r.value=t||s||u.value,q.value=x.value,S.value=!1,N.value=!0,u.value=null,x.value=null},at=async()=>{try{const{data:s}=await window.axios.get("/api/projects-simplified");E.value=(s||[]).map(t=>({value:t.id,label:t.name}))}catch(s){console.error(s),K("Failed to load projects")}},de=async()=>{if(n.value){V.value=!0;try{const{data:s}=await window.axios.get(`/api/projects/${n.value}/milestones-with-expendables`);b.value=(s||[]).map(t=>({...t,_collapsed:!0}))}catch(s){console.error(s),K("Failed to load milestones")}finally{V.value=!1}}},rt=async s=>{if(!s||!s.id){K("Invalid milestone selected.");return}r.value=s,R.value=!0,h.value=!0;try{const{data:t}=await window.axios.get(`/api/milestones/${s.id}/reasons`);T.value=Array.isArray(t)?t:[]}catch(t){console.error(t),K("Failed to load reasons")}finally{R.value=!1}},it=async()=>{if(n.value)try{const{data:s}=await window.axios.get(`/api/projects/${n.value}/sections/users?type=users`);O.value=s||[]}catch(s){console.error(s),K("Failed to load users")}},Ae=async()=>{if(n.value)try{const{data:s}=await window.axios.get(`/api/projects/${n.value}/expendable-budget`);j.value=Number(s.total_expendable_amount||0),L.value=s.currency}catch(s){console.error(s)}},ge=async()=>{if(!n.value){b.value=[],j.value=0,L.value="PKR";return}await Promise.all([de(),it(),Ae()])},fe=()=>{Mt("Operation successful!"),P.value=!1,r.value=null,f.value=null,de()},ut=s=>{if(!s||!s.id){K("Invalid milestone selected.");return}r.value=s,M.value=!0},dt=s=>{if(!s||!s.id){K("Invalid milestone selected.");return}r.value=s,C.value=!0},ct=()=>{P.value=!1,r.value=null,f.value=null},pt=async s=>{if(!s||!s.id){K("Invalid milestone.");return}await ce("Mark this milestone as complete?")&&(r.value={...s,action:"complete",apiEndpoint:`/api/milestones/${s.id}/complete`,httpMethod:"post"},P.value=!0)},mt=async s=>{if(!s||!s.id){K("Invalid milestone.");return}await ce("Approve this completed milestone?")&&(r.value={...s,action:"approve",apiEndpoint:`/api/milestones/${s.id}/approve`,httpMethod:"post"},P.value=!0)},vt=async s=>{if(!s||!s.id){K("Invalid milestone.");return}await ce("Reject this completed milestone?")&&(r.value={...s,action:"reject",apiEndpoint:`/api/milestones/${s.id}/reject`,httpMethod:"post"},P.value=!0)},gt=async s=>{if(!s||!s.id){K("Invalid contract.");return}f.value={...s,action:"accept",apiEndpoint:`/api/projects/${n.value}/expendables/${s.id}/accept`,httpMethod:"post"},P.value=!0},ft=async s=>{if(!s||!s.id){K("Invalid contract.");return}f.value={...s,action:"reject",apiEndpoint:`/api/projects/${n.value}/expendables/${s.id}/reject`,httpMethod:"post"},P.value=!0},bt=async s=>{if(!s||!s.id){K("Invalid contract.");return}f.value={...s,action:"delete",apiEndpoint:`/api/projects/${n.value}/expendables/${s.id}`,httpMethod:"delete"},P.value=!0},yt=async s=>{if(!s||!s.id){K("Invalid milestone.");return}await ce("Reopen this milestone to move it back to active?")&&(r.value={...s,action:"reopen",apiEndpoint:`/api/milestones/${s.id}/reopen`,httpMethod:"post"},P.value=!0)},Pe=s=>{s._collapsed=!s._collapsed},be=s=>!s||!Array.isArray(s.expendable)?!1:s.expendable.some(t=>((t==null?void 0:t.status)||"Pending Approval")==="Pending Approval"),ye=s=>!!(s&&Array.isArray(s.expendable)&&s.expendable.length>0),xe=s=>{try{if(!s)return null;const t=new Date(s),y=new Date,B=new Date(t.getFullYear(),t.getMonth(),t.getDate(),12,0,0),z=new Date(y.getFullYear(),y.getMonth(),y.getDate(),12,0,0),X=1440*60*1e3;return Math.round((B-z)/X)}catch{return null}},xt=s=>{const t=xe(s);return t===null?"":t<0?`Overdue by ${Math.abs(t)} day${Math.abs(t)===1?"":"s"}`:t===0?"Due today":`${t} day${t===1?"":"s"} remaining`};return kt(async()=>{const s=localStorage.getItem("displayCurrency");s&&(d.value=s),await Bt(),await at(),n.value&&await ge()}),ue(d,async s=>{s&&(localStorage.setItem("displayCurrency",s),n.value&&await Promise.all([Ae(),de()]))}),(s,t)=>(l(),Q(At,null,{header:H(()=>[e("div",Os,[t[13]||(t[13]=e("h2",{class:"font-semibold text-2xl text-gray-800"},"Project Financials",-1)),e("div",Ks,[e("button",{onClick:ge,class:"p-2 rounded-full text-gray-500 hover:bg-gray-100 transition-colors",title:"Refresh"},[p(c(ke),{class:"h-5 w-5"})]),e("div",Hs,[p(me,{id:"project-select",modelValue:n.value,"onUpdate:modelValue":[t[0]||(t[0]=y=>n.value=y),ge],options:E.value,placeholder:"Select a project"},null,8,["modelValue","options"])]),e("div",Ys,[p(me,{id:"expendables-display-currency",modelValue:c(d),"onUpdate:modelValue":t[1]||(t[1]=y=>Dt(d)?d.value=y:null),options:F,placeholder:"Currency"},null,8,["modelValue"])]),p(c(jt),{href:s.route("admin.pm-payout-calculator.index"),class:"inline-flex items-center px-3 py-1 border border-transparent text-xs leading-4 font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:border-indigo-700 focus:ring active:bg-indigo-700 transition ease-in-out duration-150"},{default:H(()=>t[12]||(t[12]=[I(" Payout Calculator ",-1)])),_:1,__:[12]},8,["href"])])])]),default:H(()=>{var y,B,z,X,ne,Be,Te,Le,Re,Ve,Ne,Ie,Fe,Ue,Ee,qe,Oe,Ke;return[p(c(Ct),{title:"Project Financials Dashboard"}),e("div",zs,[e("div",Gs,[n.value?(l(),i("section",Xs,[e("div",Js,[t[20]||(t[20]=e("h3",{class:"text-xl font-semibold text-gray-900 mb-4"},"Financial Summary",-1)),e("div",Qs,[e("div",Ws,[e("div",null,[t[14]||(t[14]=e("div",{class:"text-sm font-medium text-green-700 mb-1"},"Approved Contracts",-1)),e("div",Zs,g(c(Z)(tt.value,c(d))),1)]),t[15]||(t[15]=e("p",{class:"text-xs text-green-600 mt-2"},"Total value of all accepted contracts.",-1))]),e("div",eo,[e("div",null,[t[16]||(t[16]=e("div",{class:"text-sm font-medium text-yellow-700 mb-1"},"Pending Approval",-1)),e("div",to,g(c(Z)(st.value,c(d))),1)]),t[17]||(t[17]=e("p",{class:"text-xs text-yellow-600 mt-2"},"Contracts awaiting review and approval.",-1))]),e("div",so,[e("div",null,[t[18]||(t[18]=e("div",{class:"text-sm font-medium text-blue-700 mb-1"},"Remaining Project Budget",-1)),e("div",oo,g(ot.value),1)]),t[19]||(t[19]=e("p",{class:"text-xs text-blue-600 mt-2"},"Budget available for new expenditures.",-1))])]),p(qs,{milestones:b.value},null,8,["milestones"])])])):A("",!0),e("section",no,[e("div",lo,[e("div",ao,[t[21]||(t[21]=e("h3",{class:"text-xl font-semibold text-gray-900"},"Project Milestones",-1)),n.value?(l(),i("button",{key:0,onClick:t[2]||(t[2]=a=>U.value=!0),class:"p-1.5 rounded-full text-white bg-indigo-600 hover:bg-indigo-700 disabled:opacity-50",title:"Add Milestone"},[p(c(_e),{class:"h-4 w-4"})])):A("",!0)]),e("div",ro,[(l(),i(ee,null,oe(We,a=>e("button",{key:a.id,onClick:_=>o.value=a.id,class:G(["py-2 px-4 rounded-full text-sm font-medium transition",o.value===a.id?"bg-indigo-600 text-white shadow":"bg-gray-100 text-gray-700 hover:bg-gray-200"])},g(a.label),11,io)),64))])]),n.value?(l(),i("div",co,[V.value?(l(),i("div",po,[p(c(ke),{class:"animate-spin h-8 w-8 mx-auto mb-2 text-indigo-500"}),t[23]||(t[23]=e("p",null,"Loading milestones...",-1))])):Me.value.length?(l(),i("div",vo,[(l(!0),i(ee,null,oe(Me.value,a=>(l(),i("div",{key:a.id,class:"border border-gray-200 rounded-xl bg-gray-50 shadow-sm transition-all duration-300 hover:shadow-lg"},[e("div",{class:"p-5 flex items-center justify-between cursor-pointer",onClick:_=>Pe(a)},[e("div",fo,[e("div",bo,g(a.name),1),a.description?(l(),i("div",yo,g(a.description),1)):A("",!0),e("div",xo,[a.completion_date?(l(),i("span",ho,[t[25]||(t[25]=I(" Due by: ",-1)),e("span",wo,g(new Date(a.completion_date).toLocaleDateString()),1)])):(l(),i("span",_o,"No completion date")),a.completion_date?(l(),i("span",{key:2,class:G([xe(a.completion_date)<0?"text-red-600":xe(a.completion_date)===0?"text-orange-600":"text-green-600"])}," • "+g(xt(a.completion_date)),3)):A("",!0)])]),e("div",ko,[e("div",Co,[e("span",$o,[p(c(Et),{class:"h-4 w-4 text-gray-500"}),t[26]||(t[26]=I(" Budget: ",-1)),e("span",Do,g(c(Z)(re(a).budgetAmt,c(d))),1)]),e("span",jo,[p(c(ze),{class:"h-4 w-4 text-green-600"}),t[27]||(t[27]=I(" Approved: ",-1)),e("span",Mo,g(c(Z)(re(a).approvedAmt,c(d))),1)]),e("span",So,[p(c(ke),{class:"h-4 w-4 text-blue-600"}),t[28]||(t[28]=I(" Remaining: ",-1)),e("span",Ao,g(c(Z)(re(a).remaining,c(d))),1)])]),o.value==="active"?(l(),i("button",{key:0,onClick:J(_=>dt(a),["stop"]),class:"p-2 rounded-full text-gray-500 hover:text-blue-500 hover:bg-gray-100 transition-colors"},[Se(a)?(l(),Q(c(Lt),{key:0,class:"h-5 w-5"})):(l(),Q(c(Vt),{key:1,class:"h-5 w-5"}))],8,Po)):A("",!0),e("div",Bo,[e("button",{onClick:J(_=>rt(a),["stop"]),class:"p-2 rounded-full text-blue-600 hover:bg-blue-100 transition-colors",title:"View reasons"},[p(c(Nt),{class:"h-5 w-5"})],8,To),e("button",{onClick:J(_=>Pe(a),["stop"]),class:"p-2 transition-transform duration-300"},[p(c(Ut),{class:G(["h-6 w-6 text-gray-500",a._collapsed?"":"rotate-180"])},null,8,["class"])],8,Lo)])])],8,go),Je(e("div",Ro,[e("div",Vo,[t[36]||(t[36]=e("h5",{class:"text-sm font-semibold text-gray-800 mb-2"},"Task Stats",-1)),e("div",No,[e("span",Io,[t[29]||(t[29]=I(" Total ",-1)),e("span",Fo,g(a.tasks_total_count||0),1)]),e("span",Uo,[t[30]||(t[30]=I(" To Do ",-1)),e("span",Eo,g(a.tasks_todo_count||0),1)]),e("span",qo,[t[31]||(t[31]=I(" In Progress ",-1)),e("span",Oo,g(a.tasks_in_progress_count||0),1)]),e("span",Ko,[t[32]||(t[32]=I(" Paused ",-1)),e("span",Ho,g(a.tasks_paused_count||0),1)]),e("span",Yo,[t[33]||(t[33]=I(" Blocked ",-1)),e("span",zo,g(a.tasks_blocked_count||0),1)]),e("span",Go,[t[34]||(t[34]=I(" Done ",-1)),e("span",Xo,g(a.tasks_done_count||0),1)]),e("span",Jo,[t[35]||(t[35]=I(" Archived ",-1)),e("span",Qo,g(a.tasks_archived_count||0),1)])])]),e("div",Wo,[t[38]||(t[38]=e("h4",{class:"text-lg font-semibold text-gray-800"},"Contracts",-1)),e("div",Zo,[o.value==="active"?(l(),Q(ie,{key:0,onClick:J(_=>ut(a),["stop"]),class:"flex items-center gap-1"},{default:H(()=>[p(c(_e),{class:"h-4 w-4"}),t[37]||(t[37]=I(" Add Contract ",-1))]),_:2,__:[37]},1032,["onClick"])):A("",!0)])]),!a.expendable||!a.expendable.length?(l(),i("div",en,"No contracts found.")):(l(),i("ul",tn,[(l(!0),i(ee,null,oe(a.expendable||[],_=>{var He,Ye;return l(),i("li",{key:_.id,class:"flex flex-col sm:flex-row items-start sm:items-center justify-between text-sm gap-2 p-3 rounded-lg bg-gray-100 shadow-sm"},[e("div",sn,[e("span",{class:G(["inline-block text-xs px-2 py-0.5 rounded-full font-medium",{"bg-gray-200 text-gray-700":_.status==="Pending Approval","bg-green-200 text-green-700":_.status==="Accepted","bg-red-200 text-red-700":_.status==="Rejected"}])},g(_.status||"Pending Approval"),3),_.user&&_.user.name?(l(),i("span",on,g(_.user.name),1)):A("",!0),e("span",nn,g(_.name),1)]),e("div",ln,[e("div",an,[e("span",rn,g(c(Z)(c(W)(parseFloat(_.amount??0),_.currency||c(d),c(d)),c(d))),1),_.currency&&((He=_.currency)==null?void 0:He.toUpperCase())!==((Ye=c(d))==null?void 0:Ye.toUpperCase())?(l(),i("span",un," ("+g(c(Z)(parseFloat(_.amount??0),_.currency))+") ",1)):A("",!0)]),e("div",dn,[_.status==="Accepted"?(l(),i("button",{key:0,onClick:J(he=>nt(a,_),["stop"]),class:"p-1 rounded-full text-indigo-600 hover:bg-indigo-200 transition-colors",title:"Add tasks"},[p(c(_e),{class:"h-5 w-5"})],8,cn)):A("",!0),_.status==="Pending Approval"&&o.value!=="approved"?(l(),i(ee,{key:1},[c(m)||c(v)?(l(),i("button",{key:0,onClick:J(he=>gt(_),["stop"]),class:"p-1 rounded-full text-green-600 hover:bg-green-200 transition-colors",title:"Approve"},[p(c(ze),{class:"h-5 w-5"})],8,pn)):A("",!0),c(m)||c(v)?(l(),i("button",{key:1,onClick:J(he=>ft(_),["stop"]),class:"p-1 rounded-full text-red-600 hover:bg-red-200 transition-colors",title:"Reject"},[p(c(It),{class:"h-5 w-5"})],8,mn)):A("",!0)],64)):A("",!0),_.status==="Rejected"&&o.value!=="approved"?(l(),i("button",{key:2,onClick:J(he=>bt(_),["stop"]),class:"p-1 rounded-full text-red-600 hover:bg-red-200 transition-colors",title:"Delete"},[p(c(Ft),{class:"h-5 w-5"})],8,vn)):A("",!0)])])])}),128))])),e("div",gn,[e("div",fn,[a.status.toLowerCase()!=="completed"&&o.value==="active"?(l(),Q(ie,{key:0,onClick:J(_=>pt(a),["stop"]),disabled:be(a)&&ye(a),title:be(a)&&ye(a)?"Approve or reject all contracts before completing the milestone.":""},{default:H(()=>t[39]||(t[39]=[I(" Mark Complete ",-1)])),_:2,__:[39]},1032,["onClick","disabled","title"])):a.status.toLowerCase()==="completed"&&o.value==="completed"&&c(Y)?(l(),Q(ie,{key:1,onClick:J(_=>mt(a),["stop"]),class:"bg-green-600 hover:bg-green-700"},{default:H(()=>t[40]||(t[40]=[I("Approve Milestone",-1)])),_:2,__:[40]},1032,["onClick"])):A("",!0),a.status.toLowerCase()==="completed"&&o.value==="completed"&&c(Y)?(l(),Q(ie,{key:2,onClick:J(_=>vt(a),["stop"]),class:"bg-red-600 hover:bg-red-700"},{default:H(()=>t[41]||(t[41]=[I("Reject Milestone",-1)])),_:2,__:[41]},1032,["onClick"])):a.status.toLowerCase()==="approved"&&o.value==="approved"&&c(Y)?(l(),Q(Qe,{key:3,onClick:J(_=>yt(a),["stop"])},{default:H(()=>t[42]||(t[42]=[I("Reopen Milestone",-1)])),_:2,__:[42]},1032,["onClick"])):A("",!0)]),a.status.toLowerCase()!=="completed"&&o.value==="active"&&be(a)&&ye(a)?(l(),i("p",bn," You have pending contracts. Approve or reject each contract before marking this milestone complete. ")):A("",!0)])],512),[[$t,!a._collapsed]])]))),128))])):(l(),i("div",mo,t[24]||(t[24]=[e("p",null,"No milestones found for this project in the selected tab.",-1)])))])):(l(),i("div",uo,[p(c(Rt),{class:"h-12 w-12 mx-auto mb-2 text-gray-400"}),t[22]||(t[22]=e("p",{class:"text-lg"},"Please select a project to view its milestones.",-1))]))])])]),p(Ge,{show:M.value,title:"Add New Contract",milestone:r.value,users:O.value,"currency-options":F,"is-user-selection-required":!0,onClose:t[3]||(t[3]=a=>M.value=!1),onSubmitted:fe,"project-total-budget":j.value,"project-budget-currency":L.value,"milestone-stats":re(r.value)},null,8,["show","milestone","users","project-total-budget","project-budget-currency","milestone-stats"]),p(Ge,{show:C.value,title:Se(r.value)?"Update Milestone Budget":"Add Milestone Budget",milestone:r.value,users:O.value,"currency-options":F,"is-budget-form":!0,"is-user-selection-required":!1,onClose:t[4]||(t[4]=a=>C.value=!1),onSubmitted:fe,"project-total-budget":j.value,"project-budget-currency":L.value,"milestone-stats":re(r.value)},null,8,["show","title","milestone","users","project-total-budget","project-budget-currency","milestone-stats"]),p(zt,{show:P.value,title:((y=r.value)==null?void 0:y.action)==="approve"?"Approve Milestone":((B=r.value)==null?void 0:B.action)==="reject"?"Reject Milestone":((z=r.value)==null?void 0:z.action)==="reopen"?"Reopen Milestone":r.value?"Provide Milestone Review":((X=f.value)==null?void 0:X.action)==="accept"?"Approve Contract":((ne=f.value)==null?void 0:ne.action)==="reject"?"Reject Contract":"Delete Contract",message:((Be=r.value)==null?void 0:Be.action)==="approve"?"Please provide a reason for approving this milestone (required):":((Te=r.value)==null?void 0:Te.action)==="reject"?"Please provide a reason for rejecting this milestone (required):":((Le=r.value)==null?void 0:Le.action)==="reopen"?"Please provide a reason for reopening this milestone (required):":r.value?"Please provide a review explaining why this milestone is complete (required):":((Re=f.value)==null?void 0:Re.action)==="accept"?"Please provide a reason for approval (required):":((Ve=f.value)==null?void 0:Ve.action)==="reject"?"Please provide a reason for rejection (required):":"Provide a reason for deleting this rejected expendable (required):",type:((Ne=r.value)==null?void 0:Ne.action)==="reject"||((Ie=r.value)==null?void 0:Ie.action)==="reopen"?"warning":"info","api-endpoint":r.value?r.value.apiEndpoint:(Fe=f.value)==null?void 0:Fe.apiEndpoint,"http-method":r.value?r.value.httpMethod:(Ue=f.value)==null?void 0:Ue.httpMethod,onClose:ct,onSubmitted:fe},null,8,["show","title","message","type","api-endpoint","http-method"]),p(St,{show:U.value,"project-id":Number(n.value),onClose:t[5]||(t[5]=a=>U.value=!1),onSaved:t[6]||(t[6]=()=>{U.value=!1,de()}),"contract-id":q.value},null,8,["show","project-id","contract-id"]),p(Tt,{show:h.value,onClose:t[8]||(t[8]=()=>{h.value=!1,r.value=null,T.value=[]})},{default:H(()=>[e("div",yn,[e("div",xn,[t[44]||(t[44]=e("h3",{class:"text-lg font-semibold"},"Milestone Reasons",-1)),e("button",{class:"text-gray-500 hover:text-gray-700",onClick:t[7]||(t[7]=()=>{h.value=!1,r.value=null,T.value=[]})},t[43]||(t[43]=[e("svg",{class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),R.value?(l(),i("div",hn,"Loading...")):(l(),i("div",wn,[T.value.length?(l(),i("ul",kn,[(l(!0),i(ee,null,oe(T.value,a=>(l(),i("li",{key:a.id,class:"p-4 rounded-lg bg-gray-50 shadow-sm border border-gray-200"},[e("div",Cn,[e("span",$n,g(a.creator_name||"Unknown"),1),e("span",Dn,g(new Date(a.created_at).toLocaleString()),1)]),e("div",jn,g(a.content),1)]))),128))])):(l(),i("div",_n,"No reasons found."))]))])]),_:1},8,["show"]),p(fs,{show:N.value,"contract-id":Number(q.value),"completion-date":(Ee=r.value)!=null&&Ee.completion_date?String(r.value.completion_date).split("T")[0]:null,onClose:t[9]||(t[9]=()=>{N.value=!1,q.value=null}),onTasksSubmitted:t[10]||(t[10]=()=>{N.value=!1,q.value=null})},null,8,["show","contract-id","completion-date"]),p(ys,{show:S.value,"milestone-id":Number(((qe=u.value)==null?void 0:qe.id)||((Oe=r.value)==null?void 0:Oe.id)),"initial-completion-date":(Ke=u.value)!=null&&Ke.completion_date?String(u.value.completion_date).split("T")[0]:null,onClose:t[11]||(t[11]=()=>{S.value=!1,u.value=null}),onUpdated:lt},null,8,["show","milestone-id","initial-completion-date"])]}),_:1}))}};export{Xn as default};
