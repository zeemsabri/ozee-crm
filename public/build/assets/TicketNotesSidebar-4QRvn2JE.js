import{r as y,aS as F,m as h,p as x,b as _,q as M,o as r,w as O,c as n,l as b,y as q,a,t as u,n as m,F as B,j as D,g as z,v as $,i as E,_ as R}from"./app-WIHyXZWG.js";import{_ as L}from"./_plugin-vue_export-helper-DlAUqK2U.js";const P={class:"relative bg-white w-full sm:w-96 h-full flex flex-col p-6 shadow-2xl rounded-l-xl"},U={class:"flex justify-between items-center pb-5 mb-4 border-b border-gray-200"},V={class:"text-xl font-bold text-gray-900 flex-1 truncate pr-2"},H={key:0},J={key:1},Z={key:2},G={key:0,class:"text-center text-gray-500 py-8"},K={class:"whitespace-pre-wrap text-base leading-relaxed"},Q={class:"pt-6 border-t border-gray-200 mt-4"},W=["disabled"],X=["disabled"],Y={key:0,class:"flex items-center"},ee={key:1,class:"flex items-center"},te={__name:"TicketNotesSidebar",props:{isOpen:{type:Boolean,required:!0},selectedItem:{type:Object,default:null},initialAuthToken:{type:String,required:!0},projectId:{type:[String,Number],required:!0},noteFor:{type:String,required:!0}},emits:["update:isOpen","note-added-success"],setup(l,{emit:C}){const o=l,v=C,i=y(""),d=y(!1),c=y([]),p=y(null),{showModal:w}=F("modalService");h(()=>o.selectedItem,e=>{e?(c.value=Array.isArray(e.notes)?[...e.notes]:[],x(()=>{g()})):c.value=[]},{immediate:!0}),h(()=>o.isOpen,e=>{e?x(()=>{g()}):(i.value="",d.value=!1)}),h(c,()=>{x(()=>{g()})},{deep:!0});const k=()=>{v("update:isOpen",!1)},g=()=>{p.value&&(p.value.scrollTop=p.value.scrollHeight)},S=async e=>{d.value=!0;try{const t=await fetch(`/api/client-api/${o.noteFor}/${o.selectedItem.id}/notes`,{method:"POST",headers:{Authorization:`Bearer ${o.initialAuthToken}`,"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(e)}),s=await t.json();if(!t.ok){const A=s.errors?Object.values(s.errors).flat().join(`
`):s.message||"API request failed.";throw new Error(A)}return s}catch(t){throw console.error(`Error adding note to ${o.noteFor} ${o.selectedItem.id}:`,t),w("Error",t.message||"Failed to add message.","alert"),t}finally{d.value=!1}},j=async()=>{if(!i.value.trim()){w("Message Required","Please type a message before submitting.","alert");return}try{const e=await S({comment_text:i.value,type:"note"});e.note&&(c.value.push(e.note),i.value="",v("note-added-success"))}catch{}},f=e=>e.creator_type==="App\\Models\\Client",I=e=>e?new Date(e).toLocaleString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A",T=_(()=>{var t;if(!o.selectedItem||o.noteFor!=="tasks")return"";switch((t=o.selectedItem.status)==null?void 0:t.toLowerCase()){case"completed":return"text-green-600";case"to do":return"text-yellow-600";case"in progress":return"text-blue-600";case"blocked":return"text-red-600";default:return"text-gray-600"}}),N=_(()=>{var e;return!o.selectedItem||o.noteFor!=="tasks"?"":(e=o.selectedItem.status)==null?void 0:e.replace(/_/g," ").replace(/\b\w/g,t=>t.toUpperCase())});return(e,t)=>(r(),M(R,{name:"slide-fade"},{default:O(()=>[l.isOpen&&l.selectedItem?(r(),n("div",{key:0,class:"fixed right-0 top-0 h-full w-full sm:w-96 bg-gray-900 bg-opacity-50 flex justify-end z-50 font-inter",onClick:q(k,["self"])},[a("div",P,[a("div",U,[a("h3",V,[l.noteFor==="tasks"?(r(),n("span",H,"Task: "+u(l.selectedItem.name),1)):l.noteFor==="documents"?(r(),n("span",J,"Document: "+u(l.selectedItem.filename),1)):(r(),n("span",Z,"Details"))]),l.noteFor==="tasks"&&l.selectedItem.status?(r(),n("span",{key:0,class:m(["px-3 py-1 rounded-full text-xs font-semibold capitalize",T.value])},u(N.value),3)):b("",!0),a("button",{onClick:k,class:"text-gray-500 hover:text-gray-800 text-4xl ml-4 leading-none transition-colors duration-200","aria-label":"Close"},"Ã—")]),a("div",{ref_key:"notesContainerRef",ref:p,class:"flex-1 overflow-y-auto py-4 space-y-4"},[c.value.length===0?(r(),n("div",G," No messages for this item yet. ")):b("",!0),(r(!0),n(B,null,D(c.value,s=>(r(),n("div",{key:s.id,class:m(["flex",f(s)?"justify-end":"justify-start"])},[a("div",{class:m(["p-4 rounded-xl max-w-[80%] shadow-sm",f(s)?"bg-indigo-500 text-white rounded-br-none":"bg-gray-200 text-gray-800 rounded-bl-none"])},[a("p",{class:m(["font-semibold mb-1",{"text-indigo-100":f(s)}])},u(s.creator_name||"System"),3),a("p",K,u(s.content),1),a("p",{class:m(["text-xs mt-2",f(s)?"text-indigo-200 text-right":"text-gray-600 text-left"])},u(I(s.created_at)),3)],2)],2))),128))],512),a("div",Q,[z(a("textarea",{"onUpdate:modelValue":t[0]||(t[0]=s=>i.value=s),placeholder:"Type your message here...",rows:"3",class:"w-full p-3 border border-gray-300 rounded-lg mb-3 focus:ring-indigo-500 focus:border-indigo-500 transition-colors duration-200 resize-y shadow-sm",disabled:d.value},null,8,W),[[$,i.value]]),a("button",{onClick:j,class:"w-full bg-blue-600 text-white py-3 px-4 rounded-lg font-semibold hover:bg-blue-700 transition-all duration-200 ease-in-out transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed shadow-md flex items-center justify-center",disabled:d.value||!i.value.trim()},[d.value?(r(),n("span",Y,"Sending...")):(r(),n("span",ee,t[1]||(t[1]=[a("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"lucide lucide-send mr-2"},[a("path",{d:"m22 2-7 20-4-9-9-4 20-7Z"}),a("path",{d:"M15 15l4 4"})],-1),E(" Send Message ",-1)])))],8,X)])])])):b("",!0)]),_:1}))}},oe=L(te,[["__scopeId","data-v-d38be247"]]);export{oe as default};
