import{D as Qe,r as i,m as S,l as le,q as at,o as r,w as O,a,c as u,k as f,e as c,f as J,v as ne,y as Ve,t as A,F as he,i as ot,z as $t,g as we,n as Y,s as Ae,p as Xe,b8 as At,E as Vt,b as Ze,u as et,h as Mt,A as Ut,V as It,G as tt}from"./app-NvjusqzW.js";import{d as Bt,a as Ft}from"./currency-CwaaF8yO.js";import{h as Lt,i as Ht,_ as Ot}from"./AuthenticatedLayout-9BaesGC2.js";import Wt from"./Filters-C5fke9Kd.js";import Et from"./ProjectCards-D15Tqt3X.js";import Nt from"./Sidebar-C-WElBXh.js";import{_ as zt}from"./KanbanBoard-BqXlTFZn.js";import{B as Rt}from"./BaseFormModal-BZDOdKaG.js";import{_ as Kt}from"./PrimaryButton-DyMJ23zT.js";import{_ as qt}from"./SecondaryButton-BVXB-fHo.js";import{_ as Yt}from"./TextInput-DQ5o7k5N.js";import{_ as oe}from"./InputLabel-B-JvZrPi.js";import{S as j}from"./SelectDropdown-D8hFvJSz.js";import Jt from"./DailyWorkLog-CDPawRq3.js";import{a as Gt,u as Qt,s as st,c as Xt,r as Zt,p as es,b as ts}from"./taskState-BHp-2wa2.js";import"./Modal-WfuBHZw-.js";import"./InputError-C86gSAlz.js";import"./index-BS9jytds.js";import"./debounce-C-hnF4Z3.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./RightSidebar-DHBV3G6o.js";import"./ApplicationLogo-CZE5GbwZ.js";import"./MultiSelectDropdown-C-Vnog0G.js";import"./createLucideIcon-BMutPSMD.js";import"./plus-CF8K5TQq.js";import"./DangerButton-BC4GbFUV.js";import"./moment-BLMuvzoS.js";import"./NoticeboardModal-B4hKXa1i.js";import"./x-DJm6jnpc.js";import"./ProjectCard-DOmeEMhX.js";/* empty css                                                                       */const ss={class:"space-y-6"},as={class:"grid grid-cols-1 md:grid-cols-2 gap-4 bg-gray-50 p-4 rounded-xl border border-gray-200"},os={class:"space-y-1"},ls={class:"space-y-1"},ns={class:"space-y-1"},is={class:"space-y-1"},rs={class:"space-y-1"},ds=["disabled"],us={key:0,class:"text-xs text-red-500 mt-1"},cs={key:0,class:"space-y-3 max-h-[400px] overflow-y-auto pr-2"},ps={class:"text-lg font-semibold text-gray-800 flex items-center justify-between"},ms={class:"flex items-center justify-between"},vs={class:"flex-1"},gs=["onClick"],ys=["id","onUpdate:modelValue","onBlur","onKeyup"],fs={class:"flex items-center space-x-2 ml-4"},_s=["onClick"],hs=["onClick"],ws={key:0,class:"mt-2"},ks=["onUpdate:modelValue"],bs={class:"flex flex-wrap items-center gap-3 mt-2 text-[11px]"},xs={class:"flex items-center gap-1"},Ds=["onUpdate:modelValue"],Cs={class:"flex items-center gap-1"},Ts={class:"flex items-center gap-1"},js={class:"flex justify-end space-x-3"},Ss={__name:"WorkspaceBulkTaskModal",props:{show:{type:Boolean,default:!1}},emits:["close","tasks-submitted"],setup(ke,{emit:w}){const P=ke,G=w,g=Qe([]),C=i(""),M=i({show:!1,text:"",type:"success"}),W=i([]),B=i([]),F=i([]),ie=i(!1),v=Qe({project_id:null,milestone_id:null,assigned_to_user_id:null,due_date:null,priority:"medium"});new Date().toISOString().split("T")[0],new Date(new Date().setDate(new Date().getDate()+1)).toISOString().split("T")[0];const Q=[{value:"low",label:"Low"},{value:"medium",label:"Medium"},{value:"high",label:"High"}],be=async()=>{try{const{data:n}=await Ae.get("/api/projects-simplified");W.value=n}catch(n){console.error("Failed to fetch projects",n)}},Me=async n=>{if(!n){B.value=[];return}try{const{data:o}=await Ae.get(`/api/projects/${n}/milestones`);B.value=o;const l=o.find(h=>h.name.toLowerCase()==="support");l&&(v.milestone_id=l.id)}catch(o){console.error("Failed to fetch milestones",o)}},E=async n=>{if(!n){F.value=[];return}try{const{data:o}=await Ae.get(`/api/projects/${n}/users`);F.value=o}catch(o){console.error("Failed to fetch users",o)}};S(()=>v.project_id,async n=>{n?(ie.value=!0,await Promise.all([Me(n),E(n)]),ie.value=!1):(B.value=[],F.value=[],v.milestone_id=null,v.assigned_to_user_id=null)}),S(()=>P.show,n=>{n?be():(g.splice(0,g.length),C.value="",M.value={show:!1,text:"",type:"success"})});const X=()=>{C.value&&C.value.trim()!==""&&(g.push({name:C.value,due_date:v.due_date||"",priority:v.priority||"medium",assigned_to_user_id:v.assigned_to_user_id||null,milestone_id:v.milestone_id||null,description:"",isEditingName:!1,showDescription:!1}),C.value="",M.value.show=!1,Xe(()=>{document.getElementById("bulk-task-name-input").focus()}))},xe=n=>g.splice(n,1),k=n=>{g[n].showDescription=!g[n].showDescription},N=n=>{g[n].isEditingName=!0,Xe(()=>{document.getElementById(`bulk-task-name-input-${n}`).focus()})},$=(n,o)=>{o.trim()&&(g[n].name=o),g[n].isEditingName=!1},z=()=>({tasks:g.map(n=>({...n,project_id:v.project_id}))}),b=le(()=>g.length===0||!v.project_id||g.some(n=>!n.name.trim())),T=n=>{M.value={show:!0,text:"Tasks created successfully!",type:"success"},setTimeout(()=>{M.value.show=!1,G("tasks-submitted"),n()},1500)};return(n,o)=>(r(),at(Rt,{show:ke.show,title:"Create Tasks in Bulk","api-endpoint":"/api/tasks/bulk-workspace","http-method":"post","form-data":{},"format-data-for-api":z,onClose:o[7]||(o[7]=l=>n.$emit("close")),onSubmitted:T},{footer:O(({close:l})=>[a("div",js,[c(qt,{onClick:l},{default:O(()=>o[14]||(o[14]=[we("Cancel",-1)])),_:2,__:[14]},1032,["onClick"]),c(Kt,{onClick:o[6]||(o[6]=h=>n.$emit("submit")),disabled:b.value,class:Y({"opacity-50 cursor-not-allowed":b.value})},{default:O(()=>[we(" Create "+A(g.length)+" Tasks ",1)]),_:1},8,["disabled","class"])])]),default:O(()=>[a("div",ss,[a("div",as,[a("div",os,[c(oe,{for:"project_id",value:"Project (Required)"}),c(j,{id:"project_id",modelValue:v.project_id,"onUpdate:modelValue":o[0]||(o[0]=l=>v.project_id=l),options:W.value,"value-key":"id","label-key":"name",placeholder:"Select Project",required:""},null,8,["modelValue","options"])]),a("div",ls,[c(oe,{for:"milestone_id",value:"Default Milestone"}),c(j,{id:"milestone_id",modelValue:v.milestone_id,"onUpdate:modelValue":o[1]||(o[1]=l=>v.milestone_id=l),options:B.value,"value-key":"id","label-key":"name",placeholder:"No Milestone (Use Support)",disabled:!v.project_id},null,8,["modelValue","options","disabled"])]),a("div",ns,[c(oe,{for:"assigned_to_user_id",value:"Default Assignee"}),c(j,{id:"assigned_to_user_id",modelValue:v.assigned_to_user_id,"onUpdate:modelValue":o[2]||(o[2]=l=>v.assigned_to_user_id=l),options:F.value,"value-key":"id","label-key":"name",placeholder:"Unassigned",disabled:!v.project_id},null,8,["modelValue","options","disabled"])]),a("div",is,[c(oe,{for:"due_date",value:"Default Due Date"}),J(a("input",{type:"date",id:"due_date","onUpdate:modelValue":o[3]||(o[3]=l=>v.due_date=l),class:"w-full mt-1 rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 text-sm"},null,512),[[ne,v.due_date]])]),a("div",rs,[c(oe,{for:"default_priority",value:"Default Priority"}),c(j,{id:"default_priority",modelValue:v.priority,"onUpdate:modelValue":o[4]||(o[4]=l=>v.priority=l),options:Q,placeholder:"Select Priority"},null,8,["modelValue"])])]),a("form",{onSubmit:Ve(X,["prevent"]),class:"relative"},[c(Yt,{modelValue:C.value,"onUpdate:modelValue":o[5]||(o[5]=l=>C.value=l),id:"bulk-task-name-input",placeholder:"Type task name and press Enter...",class:"w-full p-4 pr-12 text-lg border border-gray-300 rounded-xl focus:ring-indigo-500 focus:border-indigo-500 shadow-sm transition-all",disabled:!v.project_id},null,8,["modelValue","disabled"]),a("button",{type:"submit",class:"absolute right-4 top-1/2 -translate-y-1/2 p-2 text-indigo-600 hover:text-indigo-800 disabled:opacity-50",disabled:!v.project_id||!C.value},o[8]||(o[8]=[a("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})],-1)]),8,ds),v.project_id?f("",!0):(r(),u("p",us,"Please select a project first."))],32),g.length>0?(r(),u("div",cs,[a("h2",ps," Tasks to Create ("+A(g.length)+") ",1),(r(!0),u(he,null,ot(g,(l,h)=>(r(),u("div",{key:h,class:"p-4 bg-white rounded-xl border border-gray-200 group transition-all hover:border-indigo-300 shadow-sm"},[a("div",ms,[a("div",vs,[l.isEditingName?J((r(),u("input",{key:1,id:`bulk-task-name-input-${h}`,type:"text","onUpdate:modelValue":y=>l.name=y,onBlur:y=>$(h,l.name),onKeyup:$t(y=>$(h,l.name),["enter"]),class:"text-sm font-semibold text-gray-800 w-full rounded-md border-gray-300 focus:ring-indigo-500 focus:border-indigo-500"},null,40,ys)),[[ne,l.name]]):(r(),u("p",{key:0,onClick:y=>N(h),class:"text-sm font-semibold text-gray-800 cursor-pointer hover:underline"},A(l.name),9,gs))]),a("div",fs,[a("button",{onClick:y=>k(h),type:"button",class:"p-1 text-gray-400 hover:text-indigo-600"},o[9]||(o[9]=[a("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor"},[a("path",{"fill-rule":"evenodd",d:"M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm2 6a1 1 0 011-1h6a1 1 0 110 2H7a1 1 0 01-1-1zm1 3a1 1 0 100 2h6a1 1 0 100-2H7z","clip-rule":"evenodd"})],-1)]),8,_s),a("button",{onClick:y=>xe(h),type:"button",class:"p-1 text-red-400 hover:text-red-600"},o[10]||(o[10]=[a("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor"},[a("path",{"fill-rule":"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z","clip-rule":"evenodd"})],-1)]),8,hs)])]),l.showDescription?(r(),u("div",ws,[J(a("textarea",{"onUpdate:modelValue":y=>l.description=y,rows:"2",placeholder:"Task description...",class:"w-full rounded-md border-gray-300 text-sm focus:ring-indigo-500 focus:border-indigo-500"},null,8,ks),[[ne,l.description]])])):f("",!0),a("div",bs,[a("div",xs,[o[11]||(o[11]=a("span",{class:"text-gray-500 font-medium"},"Due:",-1)),J(a("input",{type:"date","onUpdate:modelValue":y=>l.due_date=y,class:"p-1 border-gray-200 rounded text-[10px]"},null,8,Ds),[[ne,l.due_date]])]),a("div",Cs,[o[12]||(o[12]=a("span",{class:"text-gray-500 font-medium"},"Assign:",-1)),c(j,{modelValue:l.assigned_to_user_id,"onUpdate:modelValue":y=>l.assigned_to_user_id=y,options:F.value,"value-key":"id","label-key":"name",placeholder:"Unassigned",width:"auto"},null,8,["modelValue","onUpdate:modelValue","options"])]),a("div",Ts,[o[13]||(o[13]=a("span",{class:"text-gray-500 font-medium"},"Priority:",-1)),c(j,{modelValue:l.priority,"onUpdate:modelValue":y=>l.priority=y,options:Q,placeholder:"Select Priority",width:"auto"},null,8,["modelValue","onUpdate:modelValue"])])])]))),128))])):f("",!0)])]),_:1},8,["show"]))}},Ps={class:"flex items-center justify-between"},$s={class:"flex items-center gap-3"},As={class:"flex items-center rounded-lg border border-gray-200 overflow-hidden shadow-sm"},Vs={class:"py-10"},Ms={key:0,class:"max-w-3xl mx-auto"},Us={class:"mb-6"},Is={key:0,class:"flex flex-col lg:flex-row gap-8"},Bs={class:"lg:w-2/3"},Fs={class:"lg:w-1/3"},Ls={key:1,class:"mt-4"},Hs={class:"mb-3 flex flex-col gap-3"},Os={class:"flex items-center justify-between gap-4"},Ws={class:"flex items-center gap-2"},Es={key:0,class:"text-xs text-gray-500"},Ns={key:1,class:"text-xs text-red-600"},zs={class:"relative"},Rs={key:0,class:"absolute right-0 mt-2 w-56 bg-white border rounded-md shadow-lg z-10 p-3"},Ks={class:"space-y-2"},qs=["value"],Ys={class:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-7 gap-3 py-2 border-b border-gray-100"},Js={class:"relative"},Gs={class:"absolute inset-y-0 right-2 flex items-center gap-1"},Qs={class:"flex items-center gap-2"},Xs={class:"flex-1"},Zs={class:"flex items-center gap-2"},ea={class:"flex-1"},ta={class:"flex items-center gap-2"},sa={class:"flex-1"},aa={key:0,class:"flex items-center gap-2"},oa={class:"flex-1"},la={class:"flex items-center gap-2"},na={class:"flex-1"},ia={class:"flex items-center gap-2"},ra={class:"flex-1"},da=["onDragstart","onClick","title"],ua={key:0,class:"absolute top-1 right-1 text-red-500",title:"Overdue"},ca={class:"flex items-start gap-1"},pa={class:"text-sm font-medium text-gray-800 truncate flex-1"},ma=["title"],va={key:1,class:"text-xs text-gray-500 truncate"},ga={class:"text-xs text-gray-500 truncate"},ya={key:2,class:"text-xs text-gray-500 truncate"},fa={class:"mt-2 pt-2 border-t border-gray-100 flex justify-end"},_a=["onClick"],ha={key:1,class:"flex items-center gap-1 text-[10px] font-medium text-green-600"},wa={key:0,class:"mt-6 flex justify-center"},ka=["disabled"],Za={__name:"Index",setup(ke){const w=i(localStorage.getItem("workspace_view")||"projects");S(w,t=>{try{localStorage.setItem("workspace_view",t)}catch{}});const P=i(w.value==="kanban");S(P,t=>{w.value=t?"kanban":"projects"}),S(w,t=>{P.value=t==="kanban"});const G=i([{id:1,name:"Project Phoenix",role:"Manager",health:"at-risk",alert:{text:"Client email from Project Phoenix requires a reply.",timer:"3h 25m",incentive:"Reply in time to earn 50 points."},overview:{milestone:"3 of 5 - Design Phase (60% Complete)",budget:"$15,000 / $25,000 Used",status:"On Track"},tasks:{today:[{name:"Create new ad copy",status:"started",assignee:"Alex Ray"},{name:"Review wireframes",status:"blocked",assignee:"Sarah Chen"}],tomorrow:[{name:"Client feedback call",status:"paused",assignee:"Jane Doe"},{name:"Design review meeting",status:"complete",assignee:"Team A"}],completed:[{name:"Initial Project Kickoff",status:"complete"}]},communication:{lastSent:"Today at 9:15 AM",lastReceived:"3 days ago at 4:30 PM"}},{id:2,name:"Project Odyssey",role:"Contributor",health:"needs-attention",tasks:{today:[{name:"Develop login API endpoint",status:"blocked"},{name:"Write unit tests for checkout process",status:"started"}],tomorrow:[{name:"Refactor database schema",status:"paused"}],completed:[{name:"Update documentation",status:"complete"}]},milestone:{name:"Backend API Development",deadline:"September 5, 2025",progress:75,incentive:"Complete on time to earn a 5% bonus and 200 points!"}},{id:3,name:"Project Gemini",role:"Manager",health:"on-track",alert:null,overview:{milestone:"2 of 4 - Testing Phase (95% Complete)",budget:"$8,000 / $10,000 Used",status:"In Progress"},tasks:{today:[{name:"User Acceptance Testing",status:"complete"}],tomorrow:[{name:"Deploy to staging",status:"started"}],completed:[{name:"Initial QA Review",status:"complete"}]},communication:{lastSent:"Yesterday at 11:00 AM",lastReceived:"Yesterday at 10:45 AM"}},{id:4,name:"Project Alpha",role:"Contributor",health:"on-track",tasks:{today:[],tomorrow:[],completed:[{name:"Initial project setup",status:"complete"},{name:"Write documentation",status:"complete"}]},milestone:{name:"Project Kickoff",deadline:"September 20, 2025",progress:100,incentive:"Complete on time to earn a 5% bonus and 200 points!"}}]),g=i("all"),C=i(""),M=i("with");le(()=>g.value==="all"?G.value:g.value==="manager"?G.value.filter(t=>t.role==="Manager"):g.value==="contributor"?G.value.filter(t=>t.role==="Contributor"):[]);const W=i(["Follow up with Alex on Project Phoenix","Prepare for sprint planning"]),B=i(localStorage.getItem("my_dashboard_notes")||"");function F(t){t&&W.value.push(t)}function ie(t){W.value.splice(t,1)}function v(t){B.value=t,localStorage.setItem("my_dashboard_notes",t)}S(P,t=>{try{localStorage.setItem("workspace_kanban_view",t?"1":"0")}catch{}});const Q=[{key:"To Do",title:"To Do"},{key:"In Progress",title:"In Progress"},{key:"Paused",title:"Paused"},{key:"Blocked",title:"Blocked"},{key:"Done",title:"Done"},{key:"Archived",title:"Archived"}],be=["To Do","In Progress","Paused","Blocked","Done"],E=i((()=>{try{const t=JSON.parse(localStorage.getItem("workspace_kanban_columns")||"null");if(Array.isArray(t)&&t.length)return t}catch{}return be})()),X=i(!1);S(E,t=>{try{localStorage.setItem("workspace_kanban_columns",JSON.stringify(t))}catch{}},{deep:!0});const xe=le(()=>Q.filter(t=>E.value.includes(t.key))),k=i([]),N=i(new Set),$=i(!1),z=i(""),b=i(""),T=i("all"),n=i("all"),o=i(null),l=i(null),h=i(""),y=i(null),Z=i([]),R=i([]),re=i([]),lt=At(),{canDo:De}=Vt(),x=new Date,L=new Date(x);L.setDate(x.getDate()-x.getDay()),L.setHours(0,0,0,0);const K=new Date(L);K.setDate(L.getDate()+6),K.setHours(23,59,59,999);const de=new Date(x);de.setDate(x.getDate()-1),de.setHours(0,0,0,0);const Ue=new Date(de);Ue.setHours(23,59,59,999);const ue=new Date(L);ue.setMilliseconds(-1);const Ce=new Date(ue);Ce.setDate(ue.getDate()-6),Ce.setHours(0,0,0,0);const Ie=new Date(x.getFullYear(),x.getMonth(),1),Be=new Date(x.getFullYear(),x.getMonth()+1,0);Be.setHours(23,59,59,999);const ce=new Date(Ie);ce.setMilliseconds(-1);const Fe=new Date(ce.getFullYear(),ce.getMonth(),1);Fe.setHours(0,0,0,0);const Te=new Date(x);Te.setDate(x.getDate()-6),Te.setHours(0,0,0,0);const je=new Date(x);je.setDate(x.getDate()-29),je.setHours(0,0,0,0);const nt=[{value:"",label:"All Priorities"},{value:"high",label:"High"},{value:"medium",label:"Medium"},{value:"low",label:"Low"}],it=()=>{b.value="",o.value=null,l.value=null,h.value="",y.value=null,T.value="all",n.value="all"},rt=()=>{o.value=null},dt=()=>{l.value=null},ut=()=>{h.value=""},ct=()=>{y.value=null},pt=()=>{T.value="all"},mt=()=>{n.value="all"},vt=()=>{b.value=""},Se=new Map,gt=async()=>{try{const{data:t}=await window.axios.get("/api/projects-simplified"),s=Array.isArray(t)?t.map(e=>({value:e.id,label:e.name})):[];Z.value=[{value:null,label:"All Projects"},...s]}catch(t){console.error("Failed to fetch projects-simplified",t),Z.value=[{value:null,label:"All Projects"}]}},Le=async()=>{try{const{data:t}=await window.axios.get("/api/users"),s=(Array.isArray(t)?t:[]).map(e=>({value:e.id,label:e.name}));R.value=[{value:"__all__",label:"All Users"},...s]}catch(t){console.error("Failed to fetch users",t),R.value=[{value:"__all__",label:"All Users"}]}},Pe=async t=>{if(!t&&t!==0)return[];if(Se.has(t))return Se.get(t);try{const{data:s}=await window.axios.get(`/api/projects/${t}/users`),e=(Array.isArray(s)?s:[]).map(d=>({value:d.id,label:d.name}));return Se.set(t,e),e}catch(s){return console.error("Failed to fetch project users",s),[]}},He=async()=>{const t=Z.value.map(d=>d.value).filter(d=>d!==null),s=new Map;await Promise.all(t.map(async d=>{const p=await Pe(d);for(const m of p)s.has(m.value)||s.set(m.value,m)}));const e=Array.from(s.values()).sort((d,p)=>String(d.label).localeCompare(String(p.label)));R.value=[{value:"__all__",label:"All Users"},...e]},yt=async t=>{if(re.value=[],!!t)try{const{data:s}=await window.axios.get(`/api/projects/${t}/milestones`);re.value=(Array.isArray(s)?s:[]).map(e=>({value:e.id,label:e.name}))}catch(s){console.warn("Failed to fetch project milestones; falling back to none",s),re.value=[]}};Ze(async()=>{try{await lt.fetchGlobalPermissions()}catch{}await gt(),await ft(),De("view_all_user").value?await Le():await He()}),S(o,async t=>{if(y.value=null,await yt(t),De("view_all_user").value)if(t){const s=await Pe(t);R.value=[{value:"__all__",label:"All Users"},...s]}else await Le();else if(t){const s=await Pe(t);R.value=[{value:"__all__",label:"All Users"},...s]}else await He();if(P.value&&l.value==="__all__"){const s={};t&&(s.project_id=t),U.value=1,await We(s)}});const ft=async()=>{try{const t=new Date().toISOString().slice(0,10),{data:s}=await window.axios.get("/api/daily-tasks",{params:{date:t}});N.value=new Set(s.map(e=>e.task_id))}catch(t){console.error("Failed to fetch today daily log tasks",t)}},_t=async t=>{try{const s=new Date().toISOString().slice(0,10);await window.axios.post("/api/daily-tasks",{task_ids:[t.id],date:s}),N.value.add(t.id)}catch(s){console.error("Failed to add task to daily log",s)}},U=i(1),pe=i(1),me=async(t,s=!1)=>{$.value=!0,z.value="";try{b.value&&!t.search&&(t.search=b.value),t.page=U.value,t.per_page||(t.per_page=100);const{data:e}=await window.axios.get("/api/tasks",{params:t}),d=Array.isArray(e)?e:Array.isArray(e==null?void 0:e.data)?e.data:[];if(s){const p=new Set(k.value.map(V=>V.id)),m=d.filter(V=>!p.has(V.id));k.value=[...k.value,...m]}else k.value=d;!Array.isArray(e)&&e.last_page?(pe.value=e.last_page,U.value=e.current_page):pe.value=1}catch(e){console.error("Failed to load tasks",e),z.value="Failed to load tasks",s||(k.value=[])}finally{$.value=!1}},Oe=async(t=!1)=>{var e,d;const s=(d=(e=tt().props.auth)==null?void 0:e.user)==null?void 0:d.id;s&&await me({assigned_to_user_id:s,per_page:100},t)},We=async(t={},s=!1)=>{const e=new Date().toISOString().slice(0,10);let d={...t,per_page:100,statuses:"To Do,In Progress,Paused,Blocked,Done"};if(b.value||(d.due_until=e),!De("view_all_user").value&&!t.project_id){const p=Z.value.map(m=>m.value).filter(m=>m!==null);p.length>0&&(d.project_ids=p.join(","))}await me(d,s)};S(P,t=>{setTimeout(()=>{t&&k.value.length===0&&!$.value&&Oe()},500)},{immediate:!0});const $e=async(t=!1)=>{var d,p;if(!P.value)return;const s=(p=(d=tt().props.auth)==null?void 0:d.user)==null?void 0:p.id,e={};o.value&&(e.project_id=o.value),l.value==="__all__"?await We(e,t):l.value?await me({...e,assigned_to_user_id:l.value,per_page:100},t):s&&await me({...e,assigned_to_user_id:s,per_page:100},t)};S(l,async t=>{U.value=1,await $e()});const ht=async()=>{U.value>=pe.value||(U.value++,await $e(!0))};let Ee=null;S(b,t=>{P.value&&(clearTimeout(Ee),Ee=setTimeout(async()=>{U.value=1,await $e()},400))});const wt=le(()=>{const t=(b.value||"").toLowerCase().trim();return(k.value||[]).filter(e=>{var ze,Re,Ke,qe,Ye,Je;const d=!t||String(e.name||e.title||"").toLowerCase().includes(t)||String(((ze=e.milestone)==null?void 0:ze.name)||"").toLowerCase().includes(t)||String(((Re=e.project)==null?void 0:Re.name)||"").toLowerCase().includes(t)||String(e.description||"").toLowerCase().includes(t),p=((Ke=e.project)==null?void 0:Ke.id)??((qe=e.milestone)==null?void 0:qe.project_id)??null,m=!o.value||p&&String(p)===String(o.value),V=e.assigned_to_user_id??((Ye=e.assigned_to)==null?void 0:Ye.id)??e.assigned_to_id??null,fe=!l.value||l.value==="__all__"||V&&String(V)===String(l.value),_e=!h.value||String(e.priority||"").toLowerCase()===String(h.value),se=((Je=e.milestone)==null?void 0:Je.id)??null,ae=!y.value||se&&String(se)===String(y.value);let I=!0;if(T.value&&T.value!=="all"){const H=e.due_date?new Date(e.due_date):null;if(!H)I=!1;else{const _=new Date(H);_.setHours(0,0,0,0);const q=new Date;q.setHours(0,0,0,0),T.value==="today"?I=_.getTime()===q.getTime():T.value==="overdue"?I=_.getTime()<q.getTime():T.value==="week"&&(I=H>=L&&H<=K)}}let D=!0;if(n.value&&n.value!=="all"){const H=e.completed_at||(e.status==="Done"?e.updated_at:null);if(!H)D=!1;else{const _=new Date(H),q=new Date(_);q.setHours(0,0,0,0);const Ge=new Date;switch(Ge.setHours(0,0,0,0),n.value){case"completed_today":D=q.getTime()===Ge.getTime();break;case"completed_yesterday":D=_>=de&&_<=Ue;break;case"completed_this_week":D=_>=L&&_<=K;break;case"completed_last_week":D=_>=Ce&&_<=ue;break;case"completed_this_month":D=_>=Ie&&_<=Be;break;case"completed_last_month":D=_>=Fe&&_<=ce;break;case"completed_last_7":D=_>=Te&&_<=K;break;case"completed_last_30":D=_>=je&&_<=K;break;default:D=!0}D&&(D=e.status==="Done")}}return d&&m&&fe&&_e&&ae&&I&&D})}),kt=le(()=>{const t={"To Do":[],"In Progress":[],Paused:[],Blocked:[],Done:[],Archived:[]};for(const s of wt.value){const e=s.status&&t[s.status]!==void 0?s.status:"To Do";t[e].push(s)}return t.Done&&t.Done.length>0&&(t.Done.sort((s,e)=>new Date(e.updated_at||e.completed_at||0)-new Date(s.updated_at||s.completed_at||0)),t.Done=t.Done.slice(0,10)),t}),ee=i(!1),ve=i(!1),bt=()=>{ee.value=!0},xt=()=>{ve.value=!0,ee.value=!1},Dt=()=>{ee.value=!1,ve.value=!0},Ne=()=>{Oe()},ge=i(!1),ye=i(null),Ct=t=>{ye.value=t,ge.value=!0},Tt=async t=>{if(ye.value)try{const s=await ts(ye.value,t);te(s)}catch(s){console.error("Failed to block task from workspace:",s)}finally{ge.value=!1,ye.value=null}},jt=(t,s)=>t===s?null:t==="To Do"&&s==="In Progress"?"start":t==="In Progress"&&s==="Paused"?"pause":t==="Paused"&&s==="In Progress"?"resume":t==="In Progress"&&s==="Done"?"complete":(t==="To Do"||t==="In Progress"||t==="Paused")&&s==="Blocked"?"block":t==="Blocked"&&s==="In Progress"?"unblock_to_inprogress":t==="Done"&&s==="To Do"?"revise":null,te=t=>{if(!t)return;const s=k.value.findIndex(e=>String(e.id)===String(t.id));s>=0?k.value[s]={...k.value[s],...t}:k.value.push(t)},St=async({data:t,to:s})=>{if(!t||!s)return;const e=t.status,d=jt(e,s);if(!d)return;const p={...t};t.status=s,te(t);try{let m;switch(d){case"start":m=await st(p);break;case"pause":m=await es(p);break;case"resume":m=await Zt(p);break;case"complete":m=await Xt(p);break;case"block":return t.status=p.status,te(p),Ct(p);case"unblock_to_inprogress":m=await Qt(p),m.status==="To Do"&&(m=await st(m));break;case"revise":m=await Gt(p);break;default:m=(await window.axios.put(`/api/tasks/${t.id}`,{status:s})).data}te(m)}catch(m){console.error("Failed to update task status",m),te(p)}},Pt=async({columnKey:t,taskName:s})=>{try{const e=await window.axios.post("/api/tasks/quick",{name:s,status:t,project_id:o.value});e.data&&e.data.id&&k.value.push(e.data)}catch(e){console.error("Failed to quick add task",e),e.response&&e.response.data&&e.response.data.message?alert(`Error: ${e.response.data.message}`):alert("Failed to quickly add task.")}};return Ze(async()=>{try{const t=localStorage.getItem("displayCurrency");t&&(Bt.value=t),await Ft()}catch(t){console.warn("Currency initialization failed in Workspace/Index.vue:",t)}}),(t,s)=>(r(),u(he,null,[c(et(Mt),{title:"My Workspace"}),c(Ot,null,{header:O(()=>[a("div",Ps,[a("div",$s,[s[18]||(s[18]=a("h2",{class:"font-semibold text-xl text-gray-800 leading-tight"},"Workspace",-1)),a("div",As,[a("button",{type:"button",class:Y(["px-3 py-1.5 text-sm transition font-medium",w.value==="projects"?"bg-indigo-600 text-white":"bg-white text-gray-600 hover:bg-gray-50"]),onClick:s[0]||(s[0]=e=>w.value="projects")},"Projects",2),a("button",{type:"button",class:Y(["px-3 py-1.5 text-sm transition font-medium border-l border-r border-gray-200",w.value==="kanban"?"bg-indigo-600 text-white":"bg-white text-gray-600 hover:bg-gray-50"]),onClick:s[1]||(s[1]=e=>w.value="kanban")},"Kanban",2),a("button",{type:"button",class:Y(["px-3 py-1.5 text-sm transition font-medium",w.value==="daily"?"bg-indigo-600 text-white":"bg-white text-gray-600 hover:bg-gray-50"]),onClick:s[2]||(s[2]=e=>w.value="daily")},"ðŸ“‹ Daily Log",2)])])])]),default:O(()=>[a("div",Vs,[a("div",{class:Y(w.value==="kanban"?"max-w-none w-full px-4 sm:px-6 lg:px-8":"max-w-7xl mx-auto sm:px-6 lg:px-8")},[w.value==="daily"?(r(),u("div",Ms,[c(Jt)])):(r(),u(he,{key:1},[a("div",Us,[w.value==="projects"?(r(),at(Wt,{key:0,"onUpdate:filter":s[3]||(s[3]=e=>g.value=e),"active-filter":g.value,search:C.value,"onUpdate:search":s[4]||(s[4]=e=>C.value=e),"pending-filter":M.value,"onUpdate:pending":s[5]||(s[5]=e=>M.value=e)},null,8,["active-filter","search","pending-filter"])):f("",!0)]),P.value?(r(),u("div",Ls,[a("div",Hs,[a("div",Os,[s[20]||(s[20]=a("h3",{class:"text-lg font-semibold text-gray-800"},"My Tasks (Kanban)",-1)),a("div",Ws,[$.value?(r(),u("span",Es,"Loading...")):z.value?(r(),u("span",Ns,A(z.value),1)):f("",!0),a("div",zs,[a("button",{type:"button",class:"px-3 py-1.5 text-sm border rounded-md bg-white hover:bg-gray-50",onClick:s[6]||(s[6]=e=>X.value=!X.value)}," Columns "),X.value?(r(),u("div",Rs,[a("div",Ks,[(r(),u(he,null,ot(Q,e=>a("label",{key:e.key,class:"flex items-center gap-2 text-sm"},[J(a("input",{type:"checkbox",class:"rounded",value:e.key,"onUpdate:modelValue":s[7]||(s[7]=d=>E.value=d)},null,8,qs),[[Ut,E.value]]),a("span",null,A(e.title),1)])),64)),s[19]||(s[19]=a("div",{class:"text-xs text-gray-500 pt-1"},"Tip: Archived is optional",-1))])])):f("",!0)]),a("button",{type:"button",class:"px-3 py-1.5 text-sm border rounded-md bg-white hover:bg-gray-50 text-red-500",onClick:it,title:"Clear all filters"}," Reset Filters "),a("button",{type:"button",class:"px-3 py-1.5 text-sm font-medium text-white bg-indigo-600 rounded-md hover:bg-indigo-700 shadow-sm",onClick:bt}," Add Task "),a("button",{type:"button",class:"px-3 py-1.5 text-sm font-medium text-indigo-600 bg-indigo-50 border border-indigo-200 rounded-md hover:bg-indigo-100",onClick:xt}," Bulk Tasks ")])]),a("div",Ys,[a("div",Js,[J(a("input",{type:"text","onUpdate:modelValue":s[8]||(s[8]=e=>b.value=e),placeholder:"Search tasks...",class:"w-full pr-16 px-3 py-2 rounded-md border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500"},null,512),[[ne,b.value]]),a("div",Gs,[b.value?(r(),u("button",{key:0,type:"button",class:"text-xs text-gray-600 hover:text-gray-900",onClick:vt},"Clear")):f("",!0)])]),a("div",Qs,[a("div",Xs,[c(j,{modelValue:o.value,"onUpdate:modelValue":s[9]||(s[9]=e=>o.value=e),options:Z.value,placeholder:"Filter by project"},null,8,["modelValue","options"])]),o.value?(r(),u("button",{key:0,type:"button",class:"text-xs text-gray-600 hover:text-gray-900",onClick:rt},"Clear")):f("",!0)]),a("div",Zs,[a("div",ea,[c(j,{modelValue:l.value,"onUpdate:modelValue":s[10]||(s[10]=e=>l.value=e),options:R.value,placeholder:"Filter by assignee"},null,8,["modelValue","options"])]),l.value?(r(),u("button",{key:0,type:"button",class:"text-xs text-gray-600 hover:text-gray-900",onClick:dt},"Clear")):f("",!0)]),a("div",ta,[a("div",sa,[c(j,{modelValue:h.value,"onUpdate:modelValue":s[11]||(s[11]=e=>h.value=e),options:nt,placeholder:"Priority"},null,8,["modelValue"])]),h.value?(r(),u("button",{key:0,type:"button",class:"text-xs text-gray-600 hover:text-gray-900",onClick:ut},"Clear")):f("",!0)]),o.value?(r(),u("div",aa,[a("div",oa,[c(j,{modelValue:y.value,"onUpdate:modelValue":s[12]||(s[12]=e=>y.value=e),options:re.value,placeholder:"Filter by milestone"},null,8,["modelValue","options"])]),y.value?(r(),u("button",{key:0,type:"button",class:"text-xs text-gray-600 hover:text-gray-900",onClick:ct},"Clear")):f("",!0)])):f("",!0),a("div",la,[a("div",na,[c(j,{modelValue:T.value,"onUpdate:modelValue":s[13]||(s[13]=e=>T.value=e),options:[{value:"all",label:"All Due"},{value:"today",label:"Due Today"},{value:"overdue",label:"Overdue"},{value:"week",label:"Due This Week"}],placeholder:"Due filter"},null,8,["modelValue"])]),T.value!=="all"?(r(),u("button",{key:0,type:"button",class:"text-xs text-gray-600 hover:text-gray-900",onClick:pt},"Clear")):f("",!0)]),a("div",ia,[a("div",ra,[c(j,{modelValue:n.value,"onUpdate:modelValue":s[14]||(s[14]=e=>n.value=e),options:[{value:"all",label:"All Completed"},{value:"completed_today",label:"Completed Today"},{value:"completed_yesterday",label:"Completed Yesterday"},{value:"completed_this_week",label:"Completed This Week"},{value:"completed_last_week",label:"Completed Last Week"},{value:"completed_this_month",label:"Completed This Month"},{value:"completed_last_month",label:"Completed Last Month"},{value:"completed_last_7",label:"Completed in Last 7 Days"},{value:"completed_last_30",label:"Completed in Last 30 Days"}],placeholder:"Completed filter"},null,8,["modelValue"])]),n.value!=="all"?(r(),u("button",{key:0,type:"button",class:"text-xs text-gray-600 hover:text-gray-900",onClick:mt},"Clear")):f("",!0)])])]),c(zt,{columns:xe.value,"items-by-column":kt.value,loading:$.value,"is-add-task-disabled":!o.value,"add-task-disabled-tooltip":"Action Required: Please select a Project from the filters above before adding a card.",onDrop:St,onAddTask:Pt},{item:O(({item:e,columnKey:d})=>{var p,m,V,fe,_e,se;return[a("div",{class:Y(["relative p-3 rounded-md bg-white border border-gray-200 shadow-sm cursor-move border-l-4",[String(e.priority||"").toLowerCase()==="high"?"border-l-red-500":String(e.priority||"").toLowerCase()==="medium"?"border-l-yellow-500":String(e.priority||"").toLowerCase()==="low"?"border-l-green-500":"border-l-gray-200",e.due_date&&new Date(e.due_date)<new Date(new Date().setHours(0,0,0,0))&&e.status!=="Done"?"ring-1 ring-red-300":""]]),draggable:"true",onDragstart:ae=>ae.dataTransfer.setData("text/plain",JSON.stringify(e)),onClick:Ve(ae=>{var I;return et(It)(e.id,(I=e.milestone)==null?void 0:I.project_id)},["stop"]),title:(p=e.milestone)!=null&&p.name?`${e.name} â€” ${e.milestone.name}`:e.name},[e.due_date&&new Date(e.due_date)<new Date(new Date().setHours(0,0,0,0))&&e.status!=="Done"?(r(),u("div",ua,s[21]||(s[21]=[a("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor"},[a("path",{"fill-rule":"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.487 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11.75 13a.75.75 0 01-1.5 0v-2.25a.75.75 0 011.5 0V13zm-1.5-7.5a.75.75 0 011.5 0v1.5a.75.75 0 01-1.5 0V5.5z","clip-rule":"evenodd"})],-1)]))):f("",!0),a("div",ca,[a("div",pa,A(e.name||e.title||"Task"),1),e.source&&e.source!=="local"?(r(),u("div",{key:0,class:"text-indigo-500 mt-0.5 flex-shrink-0",title:`External Task: ${e.source}`},s[22]||(s[22]=[a("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"})],-1)]),8,ma)):f("",!0)]),(m=e.milestone)!=null&&m.name?(r(),u("div",va,A(e.milestone.name),1)):f("",!0),a("div",ga,A(((V=e.project)==null?void 0:V.name)||((_e=(fe=e.milestone)==null?void 0:fe.project)==null?void 0:_e.name)),1),!l.value||l.value==="__all__"?(r(),u("div",ya,A((se=e.assigned_to)==null?void 0:se.name),1)):f("",!0),a("div",fa,[!N.value.has(e.id)&&e.status!=="Done"&&e.status!=="Archived"?(r(),u("button",{key:0,type:"button",onClick:Ve(ae=>_t(e),["stop"]),class:"flex items-center gap-1 text-[10px] font-medium text-indigo-600 hover:text-indigo-800 transition-colors"},s[23]||(s[23]=[a("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-3 w-3",viewBox:"0 0 20 20",fill:"currentColor"},[a("path",{"fill-rule":"evenodd",d:"M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z","clip-rule":"evenodd"})],-1),we(" Daily Log ",-1)]),8,_a)):N.value.has(e.id)?(r(),u("div",ha,s[24]||(s[24]=[a("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-3 w-3",viewBox:"0 0 20 20",fill:"currentColor"},[a("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z","clip-rule":"evenodd"})],-1),we(" In Log ",-1)]))):f("",!0)])],42,da)]}),_:1},8,["columns","items-by-column","loading","is-add-task-disabled"]),c(Lt,{show:ee.value,"project-id":o.value,onClose:s[15]||(s[15]=e=>ee.value=!1),onSaved:Ne,onSwitchToBulk:Dt},null,8,["show","project-id"]),c(Ss,{show:ve.value,onClose:s[16]||(s[16]=e=>ve.value=!1),onTasksSubmitted:Ne},null,8,["show"]),c(Ht,{show:ge.value,title:"Block Task","confirm-text":"Block Task",placeholder:"Enter reason for blocking...",onClose:s[17]||(s[17]=e=>ge.value=!1),onConfirm:Tt},null,8,["show"]),U.value<pe.value?(r(),u("div",wa,[a("button",{onClick:ht,disabled:$.value,class:"px-5 py-2.5 rounded-md border border-gray-300 bg-white text-gray-700 font-medium hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed shadow-sm transition-all"},A($.value?"Loading...":"Load More Tasks"),9,ka)])):f("",!0)])):(r(),u("div",Is,[a("div",Bs,[c(Et,{search:C.value,"active-filter":g.value,"pending-filter":M.value},null,8,["search","active-filter","pending-filter"])]),a("div",Fs,[c(Nt,{"checklist-items":W.value,notes:B.value,onAddChecklistItem:F,onRemoveChecklistItem:ie,onUpdateNotes:v},null,8,["checklist-items","notes"])])]))],64))],2)])]),_:1})],64))}};export{Za as default};
