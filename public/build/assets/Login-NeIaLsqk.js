import{B as I,r as d,m as S,a as g,o as i,w as c,b as a,f as v,g as f,d as r,e as w,h as V,t as _,q as z,z as B,p as k,n as P,j as p}from"./app-CwLjNXT3.js";import{_ as A}from"./Checkbox-C0IliKwo.js";import{_ as E}from"./GuestLayout-CRVCrjf5.js";import{_ as y}from"./InputError-BZ-n7H_N.js";import{_ as b}from"./InputLabel-BSEjZJ95.js";import{P as $}from"./PrimaryButton-Bn1p3q-j.js";import{_ as x}from"./TextInput-C-mFm0N_.js";import"./ApplicationLogo-B9jAedvC.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const N={key:0,class:"mb-4 text-sm font-medium text-green-600"},R={class:"mt-4"},q={class:"mt-4 block"},T={class:"flex items-center"},C={class:"mt-4 flex items-center justify-end"},L={key:0,class:"mt-4 text-sm text-red-600 text-center"},J={__name:"Login",props:{canResetPassword:{type:Boolean,default:!1},status:{type:String,default:""}},setup(u){const t=I({email:"",password:"",remember:!1,timezone:""}),l=d({}),n=d(""),m=d(!1);S(()=>{try{const e=Intl.DateTimeFormat().resolvedOptions().timeZone||"";t.timezone=e}catch{t.timezone=""}});const h=async()=>{m.value=!0,l.value={},n.value="";try{const e=await p.post("/api/login",t),s=e.data.token,o=e.data.user;localStorage.setItem("authToken",s),localStorage.setItem("userRole",o.role),localStorage.setItem("userId",o.id),localStorage.setItem("userEmail",o.email),localStorage.setItem("remembered",t.remember?"true":"false"),p.defaults.headers.common.Authorization=`Bearer ${s}`,window.location.href=route("dashboard")}catch(e){e.response?e.response.status===422?l.value=e.response.data.errors:e.response.data.message?n.value=e.response.data.message:(n.value="An unexpected API error occurred.",console.error("API Error during login:",e.response.data)):(n.value="An unexpected error occurred during login. Please check your network connection.",console.error("Network or client-side error during login:",e)),localStorage.removeItem("authToken"),localStorage.removeItem("userRole"),localStorage.removeItem("userId"),localStorage.removeItem("userEmail"),delete p.defaults.headers.common.Authorization}finally{m.value=!1,t.reset("password")}};return(e,s)=>(i(),g(E,null,{default:c(()=>[a(w(V),{title:"Log in"}),u.status?(i(),v("div",N,_(u.status),1)):f("",!0),r("form",{onSubmit:z(h,["prevent"])},[r("div",null,[a(b,{for:"email",value:"Email"}),a(x,{id:"email",type:"email",class:"mt-1 block w-full",modelValue:t.email,"onUpdate:modelValue":s[0]||(s[0]=o=>t.email=o),required:"",autofocus:"",autocomplete:"username"},null,8,["modelValue"]),a(y,{class:"mt-2",message:l.value.email?l.value.email[0]:""},null,8,["message"])]),r("div",R,[a(b,{for:"password",value:"Password"}),a(x,{id:"password",type:"password",class:"mt-1 block w-full",modelValue:t.password,"onUpdate:modelValue":s[1]||(s[1]=o=>t.password=o),required:"",autocomplete:"current-password"},null,8,["modelValue"]),a(y,{class:"mt-2",message:l.value.password?l.value.password[0]:""},null,8,["message"])]),r("div",q,[r("label",T,[a(A,{name:"remember",checked:t.remember,"onUpdate:checked":s[2]||(s[2]=o=>t.remember=o)},null,8,["checked"]),s[3]||(s[3]=r("span",{class:"ms-2 text-sm text-gray-600"},"Remember me",-1))])]),r("div",C,[u.canResetPassword?(i(),g(w(B),{key:0,href:e.route("password.request"),class:"rounded-md text-sm text-gray-600 underline hover:text-gray-900 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2"},{default:c(()=>s[4]||(s[4]=[k(" Forgot your password? ",-1)])),_:1,__:[4]},8,["href"])):f("",!0),a($,{class:P(["ms-4",{"opacity-25":m.value}]),disabled:m.value},{default:c(()=>s[5]||(s[5]=[k(" Log in ",-1)])),_:1,__:[5]},8,["class","disabled"])]),n.value?(i(),v("div",L,_(n.value),1)):f("",!0)],32)]),_:1}))}};export{J as default};
