import{d as S,r as N,w as H,c as r,m as v,o as i,a as e,f as d,u as c,j as T,t as n,g as $,F as D,k as j,n as w,q as J,i as E,K as M}from"./app-D7QPKPE4.js";import{u as K}from"./workflowStore-Bea4wnAA.js";import{P as V,S as U}from"./splitpanes-BBwilVKY.js";import{c as y}from"./createLucideIcon-Bev7MvDm.js";import{X}from"./x-2hL9HgOV.js";import{C as z}from"./clock-B100N6N7.js";import{C as Q}from"./chevron-down-BthP1NpZ.js";/**
 * @license lucide-vue-next v0.536.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=y("activity",[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]]);/**
 * @license lucide-vue-next v0.536.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O=y("chevron-right",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-vue-next v0.536.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=y("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-vue-next v0.536.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=y("circle-check",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-vue-next v0.536.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=y("external-link",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);/**
 * @license lucide-vue-next v0.536.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=y("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]]),oe={key:0,class:"fixed inset-0 bg-slate-900/60 backdrop-blur-sm z-50 flex items-center justify-center p-4"},ae={class:"bg-white rounded-xl shadow-2xl w-full max-w-[95vw] h-[90vh] flex flex-col overflow-hidden border border-slate-200"},le={class:"flex items-center justify-between px-6 py-4 border-b bg-slate-50"},ie={class:"flex items-center gap-3"},ne={class:"p-2 bg-indigo-100 rounded-lg text-indigo-600"},re={key:0,class:"text-sm font-medium text-slate-500"},de={class:"text-indigo-600"},ce={class:"flex items-center gap-4"},ue={class:"flex items-center bg-white border border-slate-200 rounded-lg px-2 py-1 space-x-2 shadow-sm"},pe=["disabled"],xe={key:0,class:"text-sm font-medium text-slate-600 min-w-[80px] text-center"},me=["disabled"],fe={class:"flex-1 overflow-hidden relative"},ve={key:0,class:"absolute inset-0 z-10 bg-white/80 flex items-center justify-center"},he={class:"p-4 space-y-4"},ge={key:0,class:"text-center py-20"},be=["onClick"],_e={class:"flex items-center gap-3"},we={class:"flex items-center gap-2"},ye={class:"text-sm font-bold text-slate-700"},ke={key:0,class:"text-[10px] bg-indigo-50 text-indigo-600 px-1.5 py-0.5 rounded font-bold"},Se={class:"text-xs text-slate-500 flex items-center gap-1"},Ce={class:"flex items-center gap-2"},Le={class:"text-xs font-medium text-slate-400"},Te={key:0,class:"bg-slate-50/50 p-2 space-y-1"},De={key:0,class:"flex-1 flex flex-col items-center justify-center p-10 text-center opacity-40"},Ee={class:"px-6 py-5 border-b flex items-start justify-between bg-white sticky top-0 z-20"},Me={class:"flex items-center gap-2 mb-1"},Ne={class:"text-xl font-extrabold text-slate-800"},$e={class:"flex items-center gap-4 text-xs font-medium text-slate-500"},je={class:"flex items-center gap-1.5"},ze={key:0,class:"px-2 border-l border-slate-200"},Ie={key:1,class:"px-2 border-l border-slate-200"},Pe={class:"flex items-center gap-1.5 px-3 py-1.5 bg-slate-100 hover:bg-slate-200 text-slate-600 rounded-lg text-xs font-bold transition"},Re={class:"flex items-center px-6 border-b bg-slate-50/50"},qe=["onClick"],Ve={class:"flex-1 overflow-auto p-6 bg-slate-50/30"},Oe={class:"space-y-6 animate-in fade-in slide-in-from-bottom-2 duration-300"},Be={class:"relative group"},Fe={class:"p-4 bg-slate-900 text-indigo-300 rounded-xl overflow-x-auto text-sm font-mono shadow-lg max-h-[400px]"},Ae={class:"p-4 bg-white border border-slate-200 text-slate-700 rounded-xl overflow-x-auto text-xs font-mono shadow-sm"},We={class:"animate-in fade-in slide-in-from-bottom-2 duration-300"},Ge={class:"p-4 bg-slate-100 border border-slate-200 text-slate-800 rounded-xl overflow-x-auto text-sm font-mono"},He={class:"space-y-6 animate-in fade-in slide-in-from-bottom-2 duration-300"},Je={class:"p-4 bg-white border border-slate-200 text-slate-700 rounded-xl overflow-x-auto text-sm font-mono shadow-sm"},Ke={key:0},Ue={class:"p-4 bg-white border border-slate-200 text-slate-700 rounded-xl overflow-x-auto text-sm font-mono shadow-sm"},Xe={class:"animate-in fade-in slide-in-from-bottom-2 duration-300"},Qe={key:0,class:"bg-red-50 border border-red-200 rounded-xl p-5"},Ye={class:"flex items-center gap-2 mb-3 text-red-600"},Ze={class:"text-sm text-red-800 font-mono leading-relaxed bg-white/50 p-4 rounded-lg border border-red-100 break-words"},et={key:1,class:"flex flex-col items-center justify-center py-20 opacity-30"},tt={name:"StepItem",props:["step","idx","total","selectedStep"],emits:["select"],template:`
    <div class="space-y-1">
      <div 
        @click="$emit('select', step)"
        class="group flex items-center gap-3 p-2.5 rounded-lg cursor-pointer transition select-none"
        :class="[
            selectedStep?.id === step.id 
            ? 'bg-indigo-600 text-white shadow-md' 
            : 'hover:bg-white hover:shadow-sm text-slate-600'
        ]"
      >
        <div class="flex-shrink-0 flex flex-col items-center">
            <div :class="[
                'w-2 h-2 rounded-full',
                selectedStep?.id === step.id ? 'bg-white' : (step.status === 'success' ? 'bg-emerald-500' : (step.status === 'failed' ? 'bg-red-500' : 'bg-amber-500'))
            ]"></div>
            <div v-if="idx < total - 1 || step.children?.length" class="w-0.5 h-4 my-1 opacity-20" :class="selectedStep?.id === step.id ? 'bg-white' : 'bg-slate-400'"></div>
        </div>
        <div class="flex-1 min-w-0">
          <div class="flex items-center justify-between gap-2">
            <p class="text-xs font-bold truncate">
              {{ step.step?.name || \`Step #\${step.step_id}\` }}
            </p>
            <p v-if="step.duration_ms" class="text-[10px] opacity-70 whitespace-nowrap">{{ step.duration_ms }}ms</p>
          </div>
          <p class="text-[10px] uppercase tracking-wider opacity-60 font-semibold">
            {{ step.step?.step_type || 'Unknown Type' }}
          </p>
        </div>
      </div>
      
      <!-- Nested Children -->
      <div v-if="step.children?.length" class="ml-5 border-l border-slate-200 pl-1 space-y-1">
        <StepItem 
          v-for="(child, cIdx) in step.children" 
          :key="child.id"
          :step="child"
          :idx="cIdx"
          :total="step.children.length"
          :selectedStep="selectedStep"
          @select="$emit('select', $event)"
        />
      </div>
    </div>
  `},ut={__name:"WorkflowLogsModal",setup(st){const C=K(),g=S(()=>C.logsModal),B=()=>C.hideLogs(),x=S(()=>g.value.meta||null),I=S(()=>x.value&&x.value.current_page>1),P=S(()=>x.value&&x.value.current_page<x.value.last_page),F=()=>{I.value&&C.goToLogsPage(x.value.current_page-1)},A=()=>{P.value&&C.goToLogsPage(x.value.current_page+1)},R=a=>{try{return a?new Date(a).toLocaleString([],{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"}):""}catch{return a||""}},o=N(null),b=N(new Set),q=S(()=>{const a=g.value.items;if(!a.length)return[];const t={};a.forEach(s=>{t[s.id]={...s,children:[]}});const l=[],m=s=>{let p=s;for(;p.parent_execution_log_id&&t[p.parent_execution_log_id];)p=t[p.parent_execution_log_id];return p},h={};return a.forEach(s=>{const p=t[s.id];let u,L=!1;s.execution_id?u=s.execution_id:(u=`root-${m(p).id}`,L=!0),h[u]||(h[u]={id:u,isLegacy:L,startTime:s.executed_at,endTime:s.executed_at,status:"success",steps:[],allStepsMap:{},totalDuration:0,totalCost:0});const f=h[u];f.allStepsMap[s.id]=p,new Date(s.executed_at)<new Date(f.startTime)&&(f.startTime=s.executed_at),new Date(s.executed_at)>new Date(f.endTime)&&(f.endTime=s.executed_at),s.status==="failed"?f.status="failed":s.status==="scheduled"&&f.status!=="failed"&&(f.status="scheduled"),f.totalDuration+=s.duration_ms||0,f.totalCost+=Number(s.cost||0)}),Object.values(h).forEach(s=>{Object.values(s.allStepsMap).sort((u,L)=>u.id-L.id).forEach(u=>{u.parent_execution_log_id&&s.allStepsMap[u.parent_execution_log_id]?s.allStepsMap[u.parent_execution_log_id].children.push(u):s.steps.push(u)}),delete s.allStepsMap,l.push(s)}),l.sort((s,p)=>new Date(p.startTime)-new Date(s.startTime))}),W=a=>{b.value.has(a)?b.value.delete(a):b.value.add(a)},G=a=>{o.value=a},k=a=>{try{return a==null||a===""?"":typeof a=="string"?a:JSON.stringify(a,null,2)}catch{return String(a)}};H(()=>g.value.items,a=>{a.length>0&&!o.value&&(o.value=a[0])},{immediate:!0});const _=N("output");return(a,t)=>g.value.show?(i(),r("div",oe,[e("div",ae,[e("div",le,[e("div",ie,[e("div",ne,[d(c(Y),{class:"w-5 h-5"})]),e("div",null,[t[1]||(t[1]=e("h3",{class:"text-xl font-bold text-slate-800"},"Workflow Executions",-1)),g.value.workflow?(i(),r("p",re,[t[0]||(t[0]=T(" Tracing logic for ",-1)),e("span",de,n(g.value.workflow.name),1)])):v("",!0)])]),e("div",ce,[e("div",ue,[e("button",{onClick:F,disabled:!I.value,class:"p-1 hover:bg-slate-100 disabled:opacity-30 rounded transition"},[d(c(O),{class:"w-5 h-5 rotate-180"})],8,pe),x.value?(i(),r("span",xe," Page "+n(x.value.current_page)+" / "+n(x.value.last_page),1)):v("",!0),e("button",{onClick:A,disabled:!P.value,class:"p-1 hover:bg-slate-100 disabled:opacity-30 rounded transition"},[d(c(O),{class:"w-5 h-5"})],8,me)]),e("button",{onClick:B,class:"p-2 hover:bg-slate-100 rounded-full text-slate-400 hover:text-slate-600 transition"},[d(c(X),{class:"w-6 h-6"})])])]),e("div",fe,[g.value.isLoading?(i(),r("div",ve,t[2]||(t[2]=[e("div",{class:"flex flex-col items-center gap-2"},[e("div",{class:"animate-spin rounded-full h-10 w-10 border-b-2 border-indigo-600"}),e("p",{class:"text-slate-500 font-medium"},"Fetching logs...")],-1)]))):v("",!0),d(c(U),{class:"default-theme h-full"},{default:$(()=>[d(c(V),{"min-size":"25",size:"35",class:"bg-slate-50 border-r border-slate-200 overflow-y-auto"},{default:$(()=>[e("div",he,[!q.value.length&&!g.value.isLoading?(i(),r("div",ge,[d(c(z),{class:"w-12 h-12 text-slate-200 mx-auto mb-3"}),t[3]||(t[3]=e("p",{class:"text-slate-400"},"No execution logs found yet.",-1))])):v("",!0),(i(!0),r(D,null,j(q.value,l=>(i(),r("div",{key:l.id,class:w(["bg-white rounded-xl border border-slate-200 overflow-hidden shadow-sm transition hover:shadow-md",{"ring-2 ring-indigo-500 ring-offset-0":o.value&&l.steps.some(m=>m.id===o.value.id)}])},[e("div",{onClick:m=>W(l.id),class:w(["px-4 py-3 flex items-center justify-between cursor-pointer hover:bg-slate-50 transition select-none border-b border-transparent",{"border-slate-100":b.value.has(l.id)}])},[e("div",_e,[e("div",{class:w(["w-2.5 h-2.5 rounded-full",l.status==="success"?"bg-emerald-500":l.status==="failed"?"bg-red-500":"bg-amber-500 shadow-sm shadow-amber-200"])},null,2),e("div",null,[e("div",we,[e("p",ye,n(l.isLegacy?"Standalone Step":`Run #${l.id.substring(0,8)}`),1),l.totalCost>0?(i(),r("span",ke," $"+n(l.totalCost.toFixed(4)),1)):v("",!0)]),e("p",Se,[d(c(z),{class:"w-3 h-3"}),T(" "+n(R(l.startTime)),1)])])]),e("div",Ce,[e("span",Le,n(l.steps.length)+" steps",1),d(c(Q),{class:w(["w-5 h-5 text-slate-400 transition-transform duration-200",{"rotate-180":b.value.has(l.id)}])},null,8,["class"])])],10,be),b.value.has(l.id)?(i(),r("div",Te,[(i(!0),r(D,null,j(l.steps,(m,h)=>(i(),J(tt,{key:m.id,step:m,idx:h,total:l.steps.length,selectedStep:o.value,onSelect:G},null,8,["step","idx","total","selectedStep"]))),128))])):v("",!0)],2))),128))])]),_:1}),d(c(V),{class:"bg-white flex flex-col overflow-hidden"},{default:$(()=>{var l,m,h;return[o.value?(i(),r(D,{key:1},[e("div",Ee,[e("div",null,[e("div",Me,[e("h4",Ne,n(((l=o.value.step)==null?void 0:l.name)||`Step Execution #${o.value.id}`),1),e("span",{class:w(["px-2 py-0.5 rounded-full text-[10px] font-bold uppercase tracking-wider",o.value.status==="success"?"bg-emerald-100 text-emerald-700":o.value.status==="failed"?"bg-red-100 text-red-700":"bg-amber-100 text-amber-700"])},n(o.value.status),3)]),e("div",$e,[e("span",je,[d(c(z),{class:"w-3.5 h-3.5"}),T(" "+n(R(o.value.executed_at)),1)]),o.value.duration_ms?(i(),r("span",ze,"Duration: "+n(o.value.duration_ms)+"ms",1)):v("",!0),o.value.token_usage?(i(),r("span",Ie,"Tokens: "+n(o.value.token_usage),1)):v("",!0)])]),e("div",null,[e("button",Pe,[d(c(te),{class:"w-3.5 h-3.5"}),t[6]||(t[6]=T(" Raw Log Info ",-1))])])]),e("div",Re,[(i(),r(D,null,j(["output","input","config","error"],s=>e("button",{key:s,onClick:p=>_.value=s,class:w(["px-4 py-3 text-xs font-bold uppercase tracking-widest transition-all border-b-2 -mb-px",[_.value===s?"border-indigo-600 text-indigo-600 bg-white":"border-transparent text-slate-400 hover:text-slate-600"]])},n(s),11,qe)),64))]),e("div",Ve,[E(e("div",Oe,[e("div",null,[t[8]||(t[8]=e("p",{class:"text-[11px] font-black uppercase text-slate-400 tracking-wider mb-2"},"Parsed Output",-1)),e("div",Be,[e("pre",Fe,n(k(o.value.parsed_output)||"No parsed output available"),1),t[7]||(t[7]=e("button",{class:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 bg-slate-700 text-white p-1 rounded text-xs transition"},"Copy",-1))])]),e("div",null,[t[9]||(t[9]=e("p",{class:"text-[11px] font-black uppercase text-slate-400 tracking-wider mb-2"},"Raw Data",-1)),e("pre",Ae,n(k(o.value.raw_output)||"-"),1)])],512),[[M,_.value==="output"]]),E(e("div",We,[t[10]||(t[10]=e("p",{class:"text-[11px] font-black uppercase text-slate-400 tracking-wider mb-2"},"Input Context (Variables)",-1)),e("pre",Ge,n(k(o.value.input_context)||"No input context found"),1)],512),[[M,_.value==="input"]]),E(e("div",He,[e("div",null,[t[11]||(t[11]=e("p",{class:"text-[11px] font-black uppercase text-slate-400 tracking-wider mb-2"},"Step Configuration",-1)),e("pre",Je,n(k((m=o.value.step)==null?void 0:m.step_config)||"-"),1)]),(h=o.value.step)!=null&&h.condition_rules?(i(),r("div",Ke,[t[12]||(t[12]=e("p",{class:"text-[11px] font-black uppercase text-slate-400 tracking-wider mb-2"},"Logic Rules",-1)),e("pre",Ue,n(k(o.value.step.condition_rules)),1)])):v("",!0)],512),[[M,_.value==="config"]]),E(e("div",Xe,[o.value.error_message?(i(),r("div",Qe,[e("div",Ye,[d(c(Z),{class:"w-5 h-5"}),t[13]||(t[13]=e("h5",{class:"font-bold"},"Execution Error",-1))]),e("p",Ze,n(o.value.error_message),1)])):(i(),r("div",et,[d(c(ee),{class:"w-12 h-12 text-emerald-500 mb-3"}),t[14]||(t[14]=e("p",{class:"font-bold"},"No errors reported for this step",-1))]))],512),[[M,_.value==="error"]])])],64)):(i(),r("div",De,[d(c(se),{class:"w-16 h-16 mb-4"}),t[4]||(t[4]=e("h4",{class:"text-lg font-bold"},"Select a step to investigate",-1)),t[5]||(t[5]=e("p",null,"Execution details, inputs, and outputs will appear here.",-1))]))]}),_:1})]),_:1})])])])):v("",!0)}};export{ut as default};
