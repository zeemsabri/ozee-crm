import{r as x,c as L,e as T,s as F,g as q,o,w as C,b as e,y as f,a as r,i as p,d as m,u as n,x as U,A,C as z,F as E,l as $,t as g,D as G,j as R,G as H,m as N,p as I,H as W}from"./app-BHf0N9zz.js";import{_ as Z}from"./AuthenticatedLayout-88u_3LuH.js";import{_ as V}from"./InputError-BTuy46PJ.js";import{_ as B}from"./InputLabel-DD9FndyX.js";import{P as J}from"./PrimaryButton-pwvb5d_L.js";import{_ as K}from"./TextInput-DNpKL3DE.js";import"./Modal-D3kGOx9y.js";import"./SecondaryButton-DQPsNT8c.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./SelectDropdown-CJaRwMp5.js";import"./Checkbox-Cbx42CvW.js";import"./ApplicationLogo-GD7jeGHr.js";import"./DangerButton-ChVOiEUe.js";import"./moment-BLMuvzoS.js";const Q={class:"font-semibold text-xl text-gray-800 leading-tight"},X={class:"py-12"},Y={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},ee={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},te={class:"p-6 bg-white border-b border-gray-200"},se={class:"mb-6 border border-gray-200 rounded-lg overflow-hidden"},oe={class:"text-gray-500"},re={key:0},ie={key:1},ae={key:0,class:"p-4"},ne={class:"mb-4"},le={class:"mb-6 border border-gray-200 rounded-lg overflow-hidden"},de={class:"text-gray-500"},ce={key:0},pe={key:1},ue={key:0,class:"p-4"},me={class:"mb-6 border border-gray-200 rounded-lg overflow-hidden"},ge={class:"text-gray-500"},ye={key:0},xe={key:1},ve={key:0,class:"p-4"},fe={class:"mb-4"},he={class:"relative"},be={key:0,class:"text-sm text-gray-500"},_e={key:1},we=["onClick"],ke={class:"font-medium text-gray-800"},je={class:"text-gray-500"},Ce={key:0},Ue={key:1},Ee={key:0,class:"p-3"},$e={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3"},Re={class:"flex items-center h-5"},Ve=["id","value"],Pe=["for"],Se={class:"mb-6 border border-gray-200 rounded-lg overflow-hidden"},Ae={class:"text-gray-500"},Ne={key:0},Be={key:1},Me={key:0,class:"p-4"},Oe={key:0,class:"mb-6"},De={class:"overflow-x-auto"},Le={class:"min-w-full divide-y divide-gray-200"},Te={class:"bg-white divide-y divide-gray-200"},Fe={class:"px-6 py-4 whitespace-nowrap"},qe={class:"text-sm font-medium text-gray-900"},ze={class:"px-6 py-4 whitespace-nowrap"},Ge={class:"text-sm text-gray-500"},He={class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium"},Ie=["onClick"],We={key:1,class:"mb-6"},Ze={class:"overflow-x-auto"},Je={class:"min-w-full divide-y divide-gray-200"},Ke={class:"bg-white divide-y divide-gray-200"},Qe={class:"px-6 py-4 whitespace-nowrap"},Xe={class:"text-sm font-medium text-gray-900"},Ye={class:"px-6 py-4 whitespace-nowrap"},et={class:"text-sm text-gray-500"},tt={class:"px-6 py-4 whitespace-nowrap"},st={class:"text-sm text-gray-500"},ot={class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium"},rt=["onClick"],it={key:2,class:"text-sm text-gray-500 p-4 bg-gray-50 rounded-lg"},at={class:"flex items-center justify-end mt-4"},_t={__name:"Edit",props:{role:Object,permissions:Object,rolePermissions:Array,applicationUsers:Array,projectUsers:Array},setup(l){const u=l,h=x(!0),b=x(!0),_=x(!0),w=x(!0),v=x({}),y=x(""),P=()=>{u.permissions&&Object.keys(u.permissions).forEach(a=>{v.value[a]=!1})};P();const k=a=>{if(!y.value)return!1;const t=y.value.toLowerCase();return a.name.toLowerCase().includes(t)||a.description&&a.description.toLowerCase().includes(t)},M=L(()=>{if(!y.value)return{};const a={};return Object.entries(u.permissions).forEach(([t,s])=>{const d=s.filter(c=>k(c));d.length>0&&(a[t]=d)}),a});T(y,a=>{if(!a){P();return}Object.keys(M.value).forEach(t=>{v.value[t]=!0})});const i=F({name:u.role.name,description:u.role.description||"",type:u.role.type||"",permissions:u.rolePermissions||[]}),j=x(!1),S=(a,t,s=null)=>{if(j.value)return;j.value=!0;const d={user_id:a,role_id:u.role.id,role_type:t};s&&(d.project_id=s),W.post(route("admin.roles.revoke-user"),d,{preserveScroll:!0,onSuccess:()=>{j.value=!1},onError:()=>{j.value=!1}})},O=async()=>{try{i.processing=!0;const a=await I.put(`/api/roles/${u.role.id}`,{name:i.name,description:i.description,permissions:i.permissions,type:i.type||"application"});i.clearErrors(),console.log("Role updated successfully",a.data)}catch(a){a.response&&a.response.status===422?(i.setError("name",a.response.data.errors.name),i.setError("description",a.response.data.errors.description),i.setError("permissions",a.response.data.errors.permissions)):console.error("Error updating role:",a)}finally{i.processing=!1}};return(a,t)=>(o(),q(Z,null,{header:C(()=>[e("h2",Q," Edit Role: "+g(l.role.name),1)]),default:C(()=>[e("div",X,[e("div",Y,[e("div",ee,[e("div",te,[e("form",{onSubmit:f(O,["prevent"])},[e("div",se,[e("button",{onClick:t[0]||(t[0]=f(s=>h.value=!h.value,["prevent"])),class:"w-full flex justify-between items-center p-4 bg-gray-50 hover:bg-gray-100 transition-colors"},[t[10]||(t[10]=e("h3",{class:"text-lg font-semibold text-gray-900"},"Basic Information",-1)),e("span",oe,[h.value?(o(),r("span",re,"▼")):(o(),r("span",ie,"▶"))])]),h.value?(o(),r("div",ae,[e("div",ne,[m(B,{for:"name",value:"Role Name"}),m(K,{id:"name",type:"text",class:"mt-1 block w-full",modelValue:n(i).name,"onUpdate:modelValue":t[1]||(t[1]=s=>n(i).name=s),required:"",autofocus:""},null,8,["modelValue"]),m(V,{class:"mt-2",message:n(i).errors.name},null,8,["message"])]),e("div",null,[m(B,{for:"description",value:"Role Description"}),U(e("textarea",{id:"description",class:"mt-1 block w-full border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm","onUpdate:modelValue":t[2]||(t[2]=s=>n(i).description=s),rows:"3",placeholder:"Describe the purpose and scope of this role"},null,512),[[A,n(i).description]]),m(V,{class:"mt-2",message:n(i).errors.description},null,8,["message"])])])):p("",!0)]),e("div",le,[e("button",{onClick:t[3]||(t[3]=f(s=>b.value=!b.value,["prevent"])),class:"w-full flex justify-between items-center p-4 bg-gray-50 hover:bg-gray-100 transition-colors"},[t[11]||(t[11]=e("h3",{class:"text-lg font-semibold text-gray-900"},"Role Type",-1)),e("span",de,[b.value?(o(),r("span",ce,"▼")):(o(),r("span",pe,"▶"))])]),b.value?(o(),r("div",ue,[t[13]||(t[13]=e("p",{class:"text-sm text-gray-600 mb-2"},"Select the scope where this role will be applied",-1)),U(e("select",{id:"type",class:"block w-full border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm","onUpdate:modelValue":t[4]||(t[4]=s=>n(i).type=s),required:""},t[12]||(t[12]=[e("option",{value:""},"Select a type",-1),e("option",{value:"application"},"Application",-1),e("option",{value:"client"},"Client",-1),e("option",{value:"project"},"Project",-1)]),512),[[z,n(i).type]]),m(V,{class:"mt-2",message:n(i).errors.type},null,8,["message"])])):p("",!0)]),e("div",me,[e("button",{onClick:t[5]||(t[5]=f(s=>_.value=!_.value,["prevent"])),class:"w-full flex justify-between items-center p-4 bg-gray-50 hover:bg-gray-100 transition-colors"},[t[14]||(t[14]=e("h3",{class:"text-lg font-semibold text-gray-900"},"Permissions",-1)),e("span",ge,[_.value?(o(),r("span",ye,"▼")):(o(),r("span",xe,"▶"))])]),_.value?(o(),r("div",ve,[t[17]||(t[17]=e("p",{class:"text-sm text-gray-600 mb-4"},"Select the permissions to assign to this role",-1)),e("div",fe,[e("div",he,[t[16]||(t[16]=e("div",{class:"absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none"},[e("svg",{class:"w-4 h-4 text-gray-500","aria-hidden":"true",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 20 20"},[e("path",{stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"m19 19-4-4m0-7A7 7 0 1 1 1 8a7 7 0 0 1 14 0Z"})])],-1)),U(e("input",{type:"search","onUpdate:modelValue":t[6]||(t[6]=s=>y.value=s),class:"block w-full p-2 pl-10 pr-10 text-sm text-gray-900 border border-gray-300 rounded-lg bg-gray-50 focus:ring-indigo-500 focus:border-indigo-500",placeholder:"Search permissions..."},null,512),[[A,y.value]]),y.value?(o(),r("button",{key:0,onClick:t[7]||(t[7]=s=>y.value=""),class:"absolute inset-y-0 right-0 flex items-center pr-3 text-gray-500 hover:text-gray-700",type:"button"},t[15]||(t[15]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))):p("",!0)])]),Object.keys(l.permissions).length===0?(o(),r("div",be," No permissions available. Please create some permissions first. ")):(o(),r("div",_e,[(o(!0),r(E,null,$(l.permissions,(s,d)=>(o(),r("div",{key:d,class:"mb-6 border border-gray-200 rounded-lg overflow-hidden"},[e("button",{onClick:f(c=>v.value[d]=!v.value[d],["prevent"]),class:"w-full flex justify-between items-center p-3 bg-gray-50 hover:bg-gray-100 transition-colors"},[e("h4",ke,g(d),1),e("span",je,[v.value[d]?(o(),r("span",Ce,"▼")):(o(),r("span",Ue,"▶"))])],8,we),v.value[d]?(o(),r("div",Ee,[e("div",$e,[(o(!0),r(E,null,$(s,c=>(o(),r("div",{key:c.id,class:"flex items-start"},[e("div",Re,[U(e("input",{id:`permission-${c.id}`,type:"checkbox",value:c.id,"onUpdate:modelValue":t[8]||(t[8]=D=>n(i).permissions=D),class:"focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300 rounded"},null,8,Ve),[[G,n(i).permissions]])]),e("div",{class:R(["ml-3 text-sm",{"bg-yellow-100 p-1 rounded":k(c)}])},[e("label",{for:`permission-${c.id}`,class:R(["font-medium",k(c)?"text-gray-900":"text-gray-700"])},g(c.name),11,Pe),c.description?(o(),r("p",{key:0,class:R(k(c)?"text-gray-700":"text-gray-500")},g(c.description),3)):p("",!0)],2)]))),128))])])):p("",!0)]))),128))])),m(V,{class:"mt-2",message:n(i).errors.permissions},null,8,["message"])])):p("",!0)]),e("div",Se,[e("button",{onClick:t[9]||(t[9]=f(s=>w.value=!w.value,["prevent"])),class:"w-full flex justify-between items-center p-4 bg-gray-50 hover:bg-gray-100 transition-colors"},[t[18]||(t[18]=e("h3",{class:"text-lg font-semibold text-gray-900"},"Users with this Role",-1)),e("span",Ae,[w.value?(o(),r("span",Ne,"▼")):(o(),r("span",Be,"▶"))])]),w.value?(o(),r("div",Me,[l.applicationUsers&&l.applicationUsers.length>0?(o(),r("div",Oe,[t[20]||(t[20]=e("h4",{class:"font-medium text-gray-700 mb-2"},"Application Users",-1)),e("div",De,[e("table",Le,[t[19]||(t[19]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Name "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Email "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Actions ")])],-1)),e("tbody",Te,[(o(!0),r(E,null,$(l.applicationUsers,s=>(o(),r("tr",{key:s.id},[e("td",Fe,[e("div",qe,g(s.name),1)]),e("td",ze,[e("div",Ge,g(s.email),1)]),e("td",He,[e("button",{onClick:d=>S(s.id,"application"),class:"text-red-600 hover:text-red-900"}," Revoke ",8,Ie)])]))),128))])])])])):p("",!0),l.projectUsers&&l.projectUsers.length>0?(o(),r("div",We,[t[22]||(t[22]=e("h4",{class:"font-medium text-gray-700 mb-2"},"Project Users",-1)),e("div",Ze,[e("table",Je,[t[21]||(t[21]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Name "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Email "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Project "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Actions ")])],-1)),e("tbody",Ke,[(o(!0),r(E,null,$(l.projectUsers,s=>(o(),r("tr",{key:`${s.id}-${s.project_id}`},[e("td",Qe,[e("div",Xe,g(s.name),1)]),e("td",Ye,[e("div",et,g(s.email),1)]),e("td",tt,[e("div",st,g(s.project_name),1)]),e("td",ot,[e("button",{onClick:d=>S(s.id,"project",s.project_id),class:"text-red-600 hover:text-red-900"}," Revoke ",8,rt)])]))),128))])])])])):p("",!0),(!l.applicationUsers||l.applicationUsers.length===0)&&(!l.projectUsers||l.projectUsers.length===0)?(o(),r("div",it," No users have been assigned this role. ")):p("",!0)])):p("",!0)]),e("div",at,[m(n(H),{href:a.route("admin.roles.index"),class:"inline-flex items-center px-4 py-2 bg-gray-300 border border-transparent rounded-md font-semibold text-xs text-gray-800 uppercase tracking-widest hover:bg-gray-400 active:bg-gray-500 focus:outline-none focus:border-gray-500 focus:ring focus:ring-gray-300 disabled:opacity-25 transition mr-2"},{default:C(()=>t[23]||(t[23]=[N(" Cancel ",-1)])),_:1,__:[23]},8,["href"]),m(J,{class:R(["ml-4",{"opacity-25":n(i).processing}]),disabled:n(i).processing},{default:C(()=>t[24]||(t[24]=[N(" Update Role ",-1)])),_:1,__:[24]},8,["class","disabled"])])],32)])])])])]),_:1}))}};export{_t as default};
