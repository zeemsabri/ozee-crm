import{l as A,G as J,r as p,D,b as K,c as n,o as d,e as o,u as Q,h as W,w as u,a as t,k as R,t as m,F as V,i as U,g as _,y as B,f as q,H as X,v as Z}from"./app-B7zt4a3c.js";import{_ as ee}from"./AuthenticatedLayout-BHs-_Akd.js";import{_ as k}from"./PrimaryButton-CLAx9hgG.js";import{_ as P}from"./SecondaryButton-D-pNohvm.js";import{_ as w}from"./InputLabel-Dv81o_rC.js";import{_ as te}from"./TextInput-DQXuiN1m.js";import{_ as E}from"./InputError-Mt9U77nq.js";import{_ as L}from"./Modal-C-eVHoKX.js";import{R as se}from"./RichTextEditor-B3hpUgHr.js";import"./index-CRx4duYF.js";import"./BaseFormModal-CyEESeqj.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./SelectDropdown-DYsx7BC1.js";/* empty css                                                                       */import"./debounce-C-hnF4Z3.js";import"./RightSidebar-CciAqVoN.js";import"./ApplicationLogo-I-WEemHp.js";import"./MultiSelectDropdown-CmHEl0rc.js";import"./createLucideIcon-DU4WP9ew.js";import"./plus-gdCtVgZw.js";import"./DangerButton-g9_bNAYR.js";import"./moment-BLMuvzoS.js";import"./taskState-Ca6C4ycI.js";import"./NoticeboardModal-Dc2LiXKP.js";import"./x-r7k7kXKt.js";const oe={class:"py-12"},ae={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},re={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},le={class:"p-6 text-gray-900"},ie={key:0,class:"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative mb-4",role:"alert"},ne={class:"block sm:inline"},de={key:1,class:"text-gray-600"},pe={key:2,class:"text-red-600"},ue={key:3,class:"text-gray-600"},ce={key:4},me={class:"overflow-x-auto"},ve={class:"w-full divide-y divide-gray-200"},_e={class:"bg-white divide-y divide-gray-200"},fe={class:"px-4 py-4 whitespace-nowrap"},xe={class:"px-4 py-4 whitespace-nowrap"},ge={class:"px-4 py-4 truncate max-w-xs"},ye={class:"px-4 py-4 whitespace-nowrap"},be={class:"px-4 py-4 whitespace-nowrap"},we={class:"px-4 py-4 whitespace-nowrap flex space-x-2"},je={class:"p-6"},he={key:0},ke={class:"mb-4"},Ee=["value"],$e={class:"mb-4"},Ce={id:"client_name",class:"mt-1 p-2 border border-gray-300 rounded-md bg-gray-50"},Ae={class:"mb-4"},Re={class:"mb-6"},Ve={class:"mt-6 flex justify-end space-x-2"},Pe={class:"p-6"},Se={key:0},Me={class:"mb-6"},Ne={class:"mt-6 flex justify-end space-x-2"},it={__name:"PendingApprovals",setup(Fe){const S=A(()=>J().props.auth.user),$=p([]),j=p([]),T=p([]),C=p(!0),r=p(""),f=p(""),x=p(!1),g=p(!1),v=p(null),l=D({project_id:"",client_id:"",subject:"",body:""}),c=p({}),y=D({rejection_reason:""}),b=p({}),z=A(()=>S.value.role==="contractor"?j.value.filter(s=>s.users&&s.users.some(e=>e.id===S.value.id)):j.value);A(()=>{const s=j.value.find(e=>e.id===l.project_id);return s?T.value.find(e=>e.id===s.client_id):null});const h=async()=>{C.value=!0,r.value="";try{const s=await window.axios.get("/api/emails/pending-approval-simplified");$.value=s.data;const e=await window.axios.get("/api/projects");j.value=e.data}catch(s){r.value="Failed to load data.",console.error("Error fetching initial data:",s),s.response&&(s.response.status===401||s.response.status===403)&&(r.value="You are not authorized to view this content or your session expired. Please log in.")}finally{C.value=!1}},G=s=>{var e;v.value=s,l.project_id=(e=s.project)==null?void 0:e.id,l.subject=s.subject,l.body=s.body,c.value={},x.value=!0},H=async()=>{c.value={},r.value="";try{const s={project_id:l.project_id,subject:l.subject,body:l.body};await window.axios.post(`/api/emails/${v.value.id}/edit-and-approve`,s),f.value="Email updated and approved successfully!",x.value=!1,await h()}catch(s){s.response&&s.response.status===422?c.value=s.response.data.errors:s.response&&s.response.data.message?r.value=s.response.data.message:(r.value="Failed to update and approve email.",console.error("Error updating and approving email:",s))}},I=async s=>{r.value="";try{await window.axios.post(`/api/emails/${s.id}/approve`),f.value="Email approved successfully!",await h()}catch(e){e.response&&e.response.data.message?r.value=e.response.data.message:(r.value="Failed to approve email.",console.error("Error approving email:",e))}},O=s=>{v.value=s,y.rejection_reason="",b.value={},g.value=!0},Y=async()=>{b.value={},r.value="";try{await window.axios.post(`/api/emails/${v.value.id}/reject`,{rejection_reason:y.rejection_reason}),f.value="Email rejected successfully!",y.rejection_reason="",g.value=!1,await h()}catch(s){s.response&&s.response.status===422?b.value=s.response.data.errors:s.response&&s.response.data.message?r.value=s.response.data.message:(r.value="Failed to reject email.",console.error("Error rejecting email:",s))}};return K(()=>{h()}),(s,e)=>(d(),n(V,null,[o(Q(W),{title:"Pending Approvals"}),o(ee,null,{header:u(()=>e[8]||(e[8]=[t("h2",{class:"font-semibold text-xl text-gray-800 leading-tight"},"Pending Email Approvals",-1)])),default:u(()=>[t("div",oe,[t("div",ae,[t("div",re,[t("div",le,[e[13]||(e[13]=t("h3",{class:"text-2xl font-bold mb-4"},"Emails Pending Approval",-1)),f.value?(d(),n("div",ie,[t("span",ne,m(f.value),1)])):R("",!0),C.value?(d(),n("div",de,"Loading pending emails...")):r.value?(d(),n("div",pe,m(r.value),1)):$.value.length===0?(d(),n("div",ue,"No pending emails found.")):(d(),n("div",ce,[t("div",me,[t("table",ve,[e[12]||(e[12]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{scope:"col",class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Project"),t("th",{scope:"col",class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Client"),t("th",{scope:"col",class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Subject"),t("th",{scope:"col",class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Sender"),t("th",{scope:"col",class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Submitted On"),t("th",{scope:"col",class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Actions")])],-1)),t("tbody",_e,[(d(!0),n(V,null,U($.value,a=>{var i,M,N;return d(),n("tr",{key:a.id},[t("td",fe,m(((i=a.project)==null?void 0:i.name)||"N/A"),1),t("td",xe,m(((M=a.client)==null?void 0:M.name)||"N/A"),1),t("td",ge,m(a.subject),1),t("td",ye,m(((N=a.sender)==null?void 0:N.name)||"N/A"),1),t("td",be,m(new Date(a.created_at).toLocaleString()),1),t("td",we,[o(k,{onClick:F=>I(a),class:"text-xs px-2 py-1"},{default:u(()=>e[9]||(e[9]=[_("Approve",-1)])),_:2,__:[9]},1032,["onClick"]),o(k,{onClick:F=>G(a),class:"text-xs px-2 py-1"},{default:u(()=>e[10]||(e[10]=[_("Edit & Approve",-1)])),_:2,__:[10]},1032,["onClick"]),o(P,{onClick:F=>O(a),class:"text-xs px-2 py-1"},{default:u(()=>e[11]||(e[11]=[_("Reject",-1)])),_:2,__:[11]},1032,["onClick"])])])}),128))])])])]))])])])]),o(L,{show:x.value,onClose:e[4]||(e[4]=a=>x.value=!1),"max-width":"3xl"},{default:u(()=>{var a;return[t("div",je,[e[17]||(e[17]=t("h2",{class:"text-2xl font-bold text-gray-900 mb-4"},"Edit and Approve Email",-1)),v.value?(d(),n("div",he,[t("form",{onSubmit:B(H,["prevent"])},[t("div",ke,[o(w,{for:"project_id",value:"Project"}),q(t("select",{id:"project_id",class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full","onUpdate:modelValue":e[0]||(e[0]=i=>l.project_id=i),required:""},[e[14]||(e[14]=t("option",{value:"",disabled:""},"Select a Project",-1)),(d(!0),n(V,null,U(z.value,i=>(d(),n("option",{key:i.id,value:i.id},m(i.name),9,Ee))),128))],512),[[X,l.project_id]]),o(E,{message:c.value.project_id?c.value.project_id[0]:"",class:"mt-2"},null,8,["message"])]),t("div",$e,[o(w,{for:"client_name",value:"Client"}),t("div",Ce,m(((a=v.value.client)==null?void 0:a.name)||"N/A"),1)]),t("div",Ae,[o(w,{for:"subject",value:"Subject"}),o(te,{id:"subject",type:"text",class:"mt-1 block w-full",modelValue:l.subject,"onUpdate:modelValue":e[1]||(e[1]=i=>l.subject=i),required:""},null,8,["modelValue"]),o(E,{message:c.value.subject?c.value.subject[0]:"",class:"mt-2"},null,8,["message"])]),t("div",Re,[o(w,{for:"body",value:"Email Body"}),o(se,{id:"body",modelValue:l.body,"onUpdate:modelValue":e[2]||(e[2]=i=>l.body=i),placeholder:"Edit your email here...",height:"300px"},null,8,["modelValue"]),o(E,{message:c.value.body?c.value.body[0]:"",class:"mt-2"},null,8,["message"])]),t("div",Ve,[o(P,{onClick:e[3]||(e[3]=i=>x.value=!1)},{default:u(()=>e[15]||(e[15]=[_("Cancel",-1)])),_:1,__:[15]}),o(k,{type:"submit"},{default:u(()=>e[16]||(e[16]=[_("Save & Approve",-1)])),_:1,__:[16]})])],32)])):R("",!0)])]}),_:1},8,["show"]),o(L,{show:g.value,onClose:e[7]||(e[7]=a=>g.value=!1),"max-width":"2xl"},{default:u(()=>[t("div",Pe,[e[20]||(e[20]=t("h2",{class:"text-2xl font-bold text-gray-900 mb-4"},"Reject Email",-1)),v.value?(d(),n("div",Se,[t("form",{onSubmit:B(Y,["prevent"])},[t("div",Me,[o(w,{for:"rejection_reason",value:"Rejection Reason"}),q(t("textarea",{id:"rejection_reason",rows:"5",class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full","onUpdate:modelValue":e[5]||(e[5]=a=>y.rejection_reason=a),required:"",placeholder:"Please provide a reason for rejecting this email (minimum 10 characters)"},null,512),[[Z,y.rejection_reason]]),o(E,{message:b.value.rejection_reason?b.value.rejection_reason[0]:"",class:"mt-2"},null,8,["message"])]),t("div",Ne,[o(P,{onClick:e[6]||(e[6]=a=>g.value=!1)},{default:u(()=>e[18]||(e[18]=[_("Cancel",-1)])),_:1,__:[18]}),o(k,{type:"submit",class:"bg-red-600 hover:bg-red-700"},{default:u(()=>e[19]||(e[19]=[_("Reject Email",-1)])),_:1,__:[19]})])],32)])):R("",!0)])]),_:1},8,["show"])]),_:1})],64))}};export{it as default};
