import{r as g,c as Y,p as U,f as Z,a as l,o,d as _,u as s,h as R,w as k,b as t,i as u,t as i,m,F as L,l as H,j as J,q as ee,v as te,g as se}from"./app-DISKht3j.js";import{R as ae,_ as oe}from"./AuthenticatedLayout-CY7h59sL.js";import{P as F}from"./PrimaryButton-angFb9vz.js";import{_ as le}from"./SecondaryButton-CVp2-APy.js";import{_ as ie}from"./Modal-CVZ63Sco.js";import ne from"./CustomComposeEmailContent-55qhB54K.js";import de from"./CustomEmailApprovalContent-CDxW_E_q.js";import{_ as re}from"./EmailDetailsContent-CBu8NeC1.js";import ue from"./EmailActionContent-CMZ_q-gN.js";import me from"./ReceivedEmailActionContent-Dmx-71NV.js";import"./InputLabel-Z506aO7S.js";import"./InputError-C6KY5JMQ.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./TextInput-pYzuy-6l.js";import"./SelectDropdown-BxQFBrAw.js";/* empty css                                                                       */import"./Checkbox-CwiUiVvH.js";import"./ApplicationLogo-DgH39U2z.js";import"./DangerButton-Bs-aL8KU.js";import"./moment-BLMuvzoS.js";import"./NoticeboardModal-CHL0kfK7.js";import"./CustomMultiSelect-DaxDtG2o.js";import"./EmailEditor-DuRc-lD-.js";import"./EmailEditor.vue_vue_type_style_index_0_lang-BfTJQqtk.js";import"./useEmailSignature-wgWI-PWG.js";import"./useEmailTemplate-BizVh9Gt.js";import"./EmailAttachmentsList-BzUu_g_s.js";import"./TrashIcon-a0Pa8mjE.js";import"./TaskCreationForm-CfXAZ_t0.js";function pe(y){const D=g(!1),C=g(""),h=g(null),N=g([]),a=g(!1),E=g(""),$=g(!1),P=Y(()=>{if(!h.value)return"";const f=h.value.first_name||"",x=h.value.last_name||"";return`${f} ${x}`.trim()||h.value.email||"Lead"}),T=async()=>{var f,x;if(y!=null&&y.value){D.value=!0,C.value="";try{const{data:r}=await U.get(`/api/leads/${y.value}`);h.value=r}catch(r){console.error("Failed to load lead",r),C.value=((x=(f=r==null?void 0:r.response)==null?void 0:f.data)==null?void 0:x.message)||"Failed to load lead"}finally{D.value=!1}}},S=async()=>{var f,x;if(y!=null&&y.value){a.value=!0,E.value="";try{const{data:r}=await U.get("/api/project_notes",{params:{noteable_id:y.value,noteable_type:"App\\Models\\Lead"}});N.value=Array.isArray(r)?r:(r==null?void 0:r.data)??[]}catch(r){console.error("Failed to load notes",r),E.value=((x=(f=r==null?void 0:r.response)==null?void 0:f.data)==null?void 0:x.message)||"Failed to load notes"}finally{a.value=!1}}};return{loading:D,error:C,lead:h,fullName:P,notes:N,notesLoading:a,notesError:E,savingNote:$,fetchLead:T,fetchNotes:S,addNote:async f=>{var x,r;if(!(!(y!=null&&y.value)||!f||!f.trim()))try{$.value=!0,await U.post("/api/project_notes",{body:f,noteable_id:y.value,noteable_type:"App\\Models\\Lead"}),await S()}catch(b){throw console.error("Failed to save note",b),E.value=((r=(x=b==null?void 0:b.response)==null?void 0:x.data)==null?void 0:r.message)||"Failed to save note",b}finally{$.value=!1}}}}const ve={class:"flex items-center justify-between w-full"},ce={class:"flex items-center gap-3"},ge={class:"flex items-center gap-2"},ye={key:1,class:"text-sm text-gray-500"},_e={class:"py-6 min-h-screen w-full"},fe={class:"w-full px-4 sm:px-6 lg:px-8"},xe={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},be={class:"p-6 text-gray-900"},we={key:0,class:"mb-4 text-red-600"},ke={key:1,class:"animate-pulse space-y-3"},he={key:2,class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},Ce={class:"lg:col-span-2 space-y-6"},Ee={class:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm"},Le={class:"font-medium"},$e={key:0},Ne={class:"font-medium"},Se={key:1},je={class:"font-medium"},Ae={key:2},Fe={class:"font-medium"},De={key:3},Pe={class:"font-medium"},Te={key:4},Be={class:"font-medium"},Ve={key:5},ze={class:"font-medium"},Ue={key:6},Me={class:"font-medium"},qe={key:7},Ie={class:"font-medium"},Oe={key:8},We={class:"font-medium"},Ge={key:9},He={class:"font-medium"},Je={key:10},Ke={class:"font-medium"},Qe={key:11},Xe={class:"font-medium"},Ye={class:"flex items-center justify-between mb-2"},Ze={key:0,class:"text-gray-500 text-sm"},Re={key:1,class:"text-red-600 text-sm"},et={key:2,class:"text-gray-500 text-sm"},tt={key:3,class:"overflow-x-auto shadow rounded-md border border-gray-100"},st={class:"min-w-full divide-y divide-gray-200"},at={class:"bg-white divide-y divide-gray-200"},ot=["onClick"],lt={class:"px-4 py-2 text-sm text-gray-900"},it={class:"px-4 py-2 text-sm"},nt={class:"px-4 py-2 text-sm text-gray-500"},dt={class:"px-4 py-2 text-sm text-gray-500"},rt={key:0,class:"p-2 flex justify-end gap-1"},ut=["disabled"],mt={class:"px-2 py-1 text-sm"},pt=["disabled"],vt={class:"lg:col-span-1"},ct={class:"mb-3 flex gap-2"},gt={key:0,class:"text-red-600 text-sm mb-2"},yt={key:1,class:"text-gray-500 text-sm"},_t={class:"relative"},ft={class:"space-y-4"},xt={class:"border rounded-md p-3 bg-white"},bt={class:"text-sm whitespace-pre-wrap"},wt={class:"text-xs text-gray-500 mt-1 flex items-center gap-2"},kt={key:0,class:"inline-flex items-center px-2 py-0.5 rounded bg-gray-100 text-gray-600"},ht={key:0,class:"text-sm text-gray-500"},Ct={class:"p-6"},Et={key:0,class:"text-red-600 text-sm mt-2"},Lt={class:"mt-6 flex justify-end gap-2"},$t={key:0},Nt={key:1},St={key:2},jt={key:3},At={key:4},ns={__name:"LeadDetails",props:{id:{type:Number,required:!0},lead:{type:Object,default:null}},setup(y){const C=g(y.id),{loading:h,error:N,lead:a,fullName:E,notes:$,notesLoading:P,notesError:T,savingNote:S,fetchLead:O,fetchNotes:f,addNote:x}=pe(C),r=g(""),b=g(!1),j=g(!1),B=g(""),K=async()=>{var c,e;if(a.value){j.value=!0,B.value="";try{const{data:p}=await window.axios.post(`/api/leads/${a.value.id}/convert`),v=(p==null?void 0:p.client_id)||(p==null?void 0:p.id)||p;b.value=!1,v&&(window.location.href=`/clients/${v}`)}catch(p){console.error("Conversion failed",p),B.value=((e=(c=p==null?void 0:p.response)==null?void 0:c.data)==null?void 0:e.message)||"Failed to convert lead"}finally{j.value=!1}}},M=g([]),q=g(!1),V=g(""),w=g({current_page:1,last_page:1,total:0}),I=async(c=1)=>{var e,p;q.value=!0,V.value="";try{const{data:v}=await U.get(`/api/leads/${C.value}/emails`,{params:{page:c}});M.value=v.data||[],w.value={current_page:v.current_page||1,last_page:v.last_page||1,total:v.total||(Array.isArray(v.data)?v.data.length:0)}}catch(v){console.error("Failed to load lead emails",v),V.value=((p=(e=v==null?void 0:v.response)==null?void 0:e.data)==null?void 0:p.message)||"Failed to load emails"}finally{q.value=!1}},n=g({show:!1,mode:null,title:"",data:null,loading:!1}),W=()=>{n.value={show:!0,mode:"custom-compose",title:"Compose Email to Lead",data:null,loading:!1}},Q=c=>{n.value={show:!0,mode:"view-email",title:"Email Details",data:c,loading:!1}},X=c=>{n.value.show=!0,n.value.data=c,c.type==="received"&&(c.status==="pending_approval_received"||c.status==="received")?(n.value.mode="received-edit",n.value.title="Approve Received Email"):c.template_id?(n.value.mode="edit",n.value.title="Edit & Approve Template Email"):(n.value.mode="custom-edit",n.value.title="Edit & Approve Custom Email")},z=()=>{n.value.show=!1,I(w.value.current_page)},G=c=>{c<1||c>w.value.last_page||I(c)};return Z(async()=>{await O(),await f(),await I(1)}),(c,e)=>(o(),l(L,null,[_(s(R),{title:`Lead: ${s(E)}`},null,8,["title"]),_(oe,null,{header:k(()=>{var p;return[t("div",ve,[t("div",null,[t("div",ce,[e[9]||(e[9]=t("h2",{class:"font-semibold text-xl text-gray-800 leading-tight"},"Lead Details",-1)),s(a)?(o(),l("span",{key:0,class:J(["text-xs px-2 py-0.5 rounded-full capitalize",{"bg-gray-100 text-gray-700":!s(a).status||s(a).status.toLowerCase()==="new","bg-blue-100 text-blue-700":s(a).status&&s(a).status.toLowerCase()==="contacted","bg-amber-100 text-amber-700":s(a).status&&s(a).status.toLowerCase()==="qualified","bg-emerald-100 text-emerald-700":s(a).status&&s(a).status.toLowerCase()==="converted","bg-rose-100 text-rose-700":s(a).status&&s(a).status.toLowerCase()==="lost"}])},i(s(a).status||"new"),3)):u("",!0)])]),t("div",ge,[_(F,{onClick:W},{default:k(()=>e[10]||(e[10]=[m("Compose Email",-1)])),_:1,__:[10]}),(((p=s(a))==null?void 0:p.status)||"").toLowerCase()!=="converted"?(o(),se(F,{key:0,onClick:e[0]||(e[0]=v=>b.value=!0)},{default:k(()=>e[11]||(e[11]=[m("Convert to Client",-1)])),_:1,__:[11]})):(o(),l("span",ye,"Already converted"))])])]}),default:k(()=>{var p,v;return[t("div",_e,[t("div",fe,[t("div",xe,[t("div",be,[s(N)?(o(),l("div",we,i(s(N)),1)):u("",!0),s(h)?(o(),l("div",ke,e[12]||(e[12]=[t("div",{class:"h-5 bg-gray-200 rounded w-1/3"},null,-1),t("div",{class:"h-4 bg-gray-200 rounded w-1/2"},null,-1),t("div",{class:"h-32 bg-gray-100 rounded"},null,-1)]))):u("",!0),s(a)&&!s(h)?(o(),l("div",he,[t("section",Ce,[t("div",null,[e[37]||(e[37]=t("h3",{class:"text-lg font-semibold mb-2"},"Profile",-1)),t("div",Ee,[t("div",null,[e[13]||(e[13]=t("span",{class:"text-gray-500"},"Name:",-1)),e[14]||(e[14]=m()),t("span",Le,i(s(E)),1)]),s(a).email?(o(),l("div",$e,[e[15]||(e[15]=t("span",{class:"text-gray-500"},"Email:",-1)),e[16]||(e[16]=m()),t("span",Ne,i(s(a).email),1)])):u("",!0),s(a).phone?(o(),l("div",Se,[e[17]||(e[17]=t("span",{class:"text-gray-500"},"Phone:",-1)),e[18]||(e[18]=m()),t("span",je,i(s(a).phone),1)])):u("",!0),s(a).company?(o(),l("div",Ae,[e[19]||(e[19]=t("span",{class:"text-gray-500"},"Company:",-1)),e[20]||(e[20]=m()),t("span",Fe,i(s(a).company),1)])):u("",!0),s(a).title?(o(),l("div",De,[e[21]||(e[21]=t("span",{class:"text-gray-500"},"Title:",-1)),e[22]||(e[22]=m()),t("span",Pe,i(s(a).title),1)])):u("",!0),s(a).source?(o(),l("div",Te,[e[23]||(e[23]=t("span",{class:"text-gray-500"},"Source:",-1)),e[24]||(e[24]=m()),t("span",Be,i(s(a).source),1)])):u("",!0),s(a).pipeline_stage?(o(),l("div",Ve,[e[25]||(e[25]=t("span",{class:"text-gray-500"},"Pipeline Stage:",-1)),e[26]||(e[26]=m()),t("span",ze,i(s(a).pipeline_stage),1)])):u("",!0),s(a).estimated_value?(o(),l("div",Ue,[e[27]||(e[27]=t("span",{class:"text-gray-500"},"Estimated Value:",-1)),e[28]||(e[28]=m()),t("span",Me,i(s(a).estimated_value)+" "+i(s(a).currency||"USD"),1)])):u("",!0),s(a).website?(o(),l("div",qe,[e[29]||(e[29]=t("span",{class:"text-gray-500"},"Website:",-1)),e[30]||(e[30]=m()),t("span",Ie,i(s(a).website),1)])):u("",!0),s(a).address||s(a).city||s(a).state||s(a).zip||s(a).country?(o(),l("div",Oe,[e[31]||(e[31]=t("span",{class:"text-gray-500"},"Address:",-1)),t("div",We,[m(i(s(a).address)+" ",1),s(a).city?(o(),l(L,{key:0},[m(", "+i(s(a).city),1)],64)):u("",!0),s(a).state?(o(),l(L,{key:1},[m(", "+i(s(a).state),1)],64)):u("",!0),s(a).zip?(o(),l(L,{key:2},[m(i(s(a).zip),1)],64)):u("",!0),s(a).country?(o(),l(L,{key:3},[m(", "+i(s(a).country),1)],64)):u("",!0)])])):u("",!0),(p=s(a).assigned_to)!=null&&p.name||s(a).assigned_to_id?(o(),l("div",Ge,[e[32]||(e[32]=t("span",{class:"text-gray-500"},"Assigned:",-1)),t("span",He,i(((v=s(a).assigned_to)==null?void 0:v.name)||`User #${s(a).assigned_to_id}`),1)])):u("",!0),s(a).tags?(o(),l("div",Je,[e[33]||(e[33]=t("span",{class:"text-gray-500"},"Tags:",-1)),e[34]||(e[34]=m()),t("span",Ke,i(s(a).tags),1)])):u("",!0),s(a).notes?(o(),l("div",Qe,[e[35]||(e[35]=t("span",{class:"text-gray-500"},"Notes:",-1)),e[36]||(e[36]=m()),t("span",Xe,i(s(a).notes),1)])):u("",!0)])]),t("div",null,[t("div",Ye,[e[39]||(e[39]=t("h3",{class:"text-lg font-semibold"},"Emails",-1)),_(F,{onClick:W},{default:k(()=>e[38]||(e[38]=[m("Compose Email",-1)])),_:1,__:[38]})]),q.value?(o(),l("div",Ze,"Loading emails...")):V.value?(o(),l("div",Re,i(V.value),1)):M.value.length===0?(o(),l("div",et,"No emails found for this lead.")):(o(),l("div",tt,[t("table",st,[e[40]||(e[40]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase"},"Subject"),t("th",{class:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase"},"Status"),t("th",{class:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase"},"Type"),t("th",{class:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase"},"Date")])],-1)),t("tbody",at,[(o(!0),l(L,null,H(M.value,d=>(o(),l("tr",{key:d.id,class:"hover:bg-gray-50 cursor-pointer",onClick:A=>Q(d)},[t("td",lt,i(d.subject),1),t("td",it,[t("span",{class:J({"px-2 py-1 rounded-full text-xs font-medium":!0,"bg-green-100 text-green-800":d.status==="sent","bg-yellow-100 text-yellow-800":d.status==="pending_approval"||d.status==="pending_approval_received","bg-blue-100 text-blue-800":d.status==="received"})},i((d.status||"n/a").replace(/_/g," ").toUpperCase()),3)]),t("td",nt,i(d.type),1),t("td",dt,i(new Date(d.created_at).toLocaleString()),1)],8,ot))),128))])]),w.value.last_page>1?(o(),l("div",rt,[t("button",{class:"px-2 py-1 text-sm border rounded",disabled:w.value.current_page===1,onClick:e[1]||(e[1]=d=>G(w.value.current_page-1))},"Prev",8,ut),t("span",mt,"Page "+i(w.value.current_page)+" of "+i(w.value.last_page),1),t("button",{class:"px-2 py-1 text-sm border rounded",disabled:w.value.current_page===w.value.last_page,onClick:e[2]||(e[2]=d=>G(w.value.current_page+1))},"Next",8,pt)])):u("",!0)]))])]),t("aside",vt,[e[43]||(e[43]=t("h3",{class:"text-lg font-semibold mb-2"},"Notes",-1)),t("div",ct,[ee(t("input",{"onUpdate:modelValue":e[3]||(e[3]=d=>r.value=d),type:"text",class:"flex-1 rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",placeholder:"Add a note..."},null,512),[[te,r.value]]),_(F,{disabled:s(S)||!r.value.trim(),onClick:e[4]||(e[4]=async()=>{await s(x)(r.value),r.value=""})},{default:k(()=>[m(i(s(S)?"Saving...":"Save"),1)]),_:1},8,["disabled"])]),s(T)?(o(),l("div",gt,i(s(T)),1)):u("",!0),s(P)?(o(),l("div",yt,"Loading notes...")):u("",!0),t("div",_t,[e[42]||(e[42]=t("div",{class:"absolute left-3 top-0 bottom-0 w-px bg-gray-200","aria-hidden":"true"},null,-1)),t("ul",ft,[(o(!0),l(L,null,H(s($),d=>{var A;return o(),l("li",{key:d.id,class:"relative pl-8"},[e[41]||(e[41]=t("div",{class:"absolute left-0 top-1.5 w-2 h-2 bg-indigo-400 rounded-full"},null,-1)),t("div",xt,[t("div",bt,i(d.body||d.content||d.note||""),1),t("div",wt,[d.type?(o(),l("span",kt,i(d.type),1)):u("",!0),t("span",null,"By "+i(((A=d.user)==null?void 0:A.name)||"User")+" • "+i(new Date(d.created_at).toLocaleString()),1)])])])}),128)),!s(P)&&s($).length===0?(o(),l("li",ht,"No notes have been added yet.")):u("",!0)])])])])):u("",!0)])])])]),_(ie,{show:b.value,onClose:e[6]||(e[6]=d=>b.value=!1)},{default:k(()=>[t("div",Ct,[e[45]||(e[45]=t("h3",{class:"text-lg font-semibold mb-2"},"Convert to Client",-1)),e[46]||(e[46]=t("p",null,"Are you sure you want to convert this lead into a client?",-1)),B.value?(o(),l("div",Et,i(B.value),1)):u("",!0),t("div",Lt,[_(le,{disabled:j.value,onClick:e[5]||(e[5]=d=>b.value=!1)},{default:k(()=>e[44]||(e[44]=[m("Cancel",-1)])),_:1,__:[44]},8,["disabled"]),_(F,{disabled:j.value,onClick:K},{default:k(()=>[m(i(j.value?"Converting...":"Convert"),1)]),_:1},8,["disabled"])])])]),_:1},8,["show"]),_(ae,{show:n.value.show,title:n.value.title,onClose:e[8]||(e[8]=d=>n.value.show=!1)},{content:k(()=>{var d;return[n.value.mode==="custom-compose"?(o(),l("div",$t,[_(ne,{"project-id":null,"user-project-role":{},"force-recipient-mode":"leads","preset-lead-ids":[C.value],"hide-recipient-controls":!0,onSubmitted:z,onError:()=>{}},null,8,["preset-lead-ids"])])):n.value.mode==="view-email"?(o(),l("div",Nt,[_(re,{email:n.value.data,"can-approve-emails":(d=n.value.data)==null?void 0:d.can_approve,onEdit:X,onReject:e[7]||(e[7]=A=>{n.value.mode="reject",n.value.data=A,n.value.title="Reject Email"})},null,8,["email","can-approve-emails"])])):n.value.mode==="edit"||n.value.mode==="reject"?(o(),l("div",St,[_(ue,{email:n.value.data,mode:n.value.mode,onSubmitted:z},null,8,["email","mode"])])):n.value.mode==="received-edit"?(o(),l("div",jt,[_(me,{email:n.value.data,onSubmitted:z,onError:()=>{}},null,8,["email"])])):n.value.mode==="custom-edit"?(o(),l("div",At,[_(de,{email:n.value.data,onSubmitted:z,onError:()=>{}},null,8,["email"])])):u("",!0)]}),_:1},8,["show","title"])]}),_:1})],64))}};export{ns as default};
