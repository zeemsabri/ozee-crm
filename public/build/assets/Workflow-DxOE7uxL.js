import D from"./TriggerStep-0DmZso3X.js";import $ from"./ConditionStep-B9iQ_FiJ.js";import H from"./ActionStep-v3RZ9PER.js";import U from"./AIStep-BPmxOSnc.js";import L from"./ForEachStep-9aCN_mZC.js";import j from"./FetchRecordsStep-CFL2xi8f.js";import B from"./ScheduleTriggerStep-a44IcFNJ.js";import R from"./AddStepButton-DTO5l955.js";import{u as M}from"./workflowStore-BNZwy7SN.js";import P from"./TransformStep-D9u1zp-O.js";import{l as G,C as W,c as m,o as a,F as C,a as i,e as g,i as V,q,k as y,K}from"./app-ChNNGQpZ.js";import"./StepCard-DYRoAA9j.js";import"./trash-CbwuI-mN.js";import"./createLucideIcon-Zi0Lz4se.js";import"./SelectDropdown-M38VjQTw.js";/* empty css                                                                       */import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./RelationshipPathPicker-13cUzy7_.js";import"./plus-BP7uux2D.js";import"./DataTokenInserter-D9CDvgIr.js";import"./RelatedDataPicker-Dy4Zm3WA.js";import"./BaseFormModal-DIxmT_Gd.js";import"./Modal-BVF4Zl1w.js";import"./PrimaryButton-NC2t_HoE.js";import"./SecondaryButton-D0KIHOxV.js";import"./PromptForm-C8oQl6Zf.js";import"./ResponseBuilder-DFmWbOig.js";import"./FieldBuilder-BByWxW5h.js";import"./chevron-down-PWupSI7Z.js";import"./circle-x-DVpxCf6p.js";const Y={class:"flex flex-col items-center w-full space-y-4"},z={key:0,class:"text-center p-8 border-2 border-dashed rounded-lg w-full max-w-md"},J={class:"flex justify-center"},Q={class:"w-full flex flex-col items-center"},X={key:1,class:"w-full flex mt-4 space-x-4"},Z={class:"flex-1 bg-green-50/50 p-4 rounded-lg border border-green-200"},tt={class:"flex-1 bg-red-50/50 p-4 rounded-lg border border-red-200"},et={key:2,class:"w-full mt-4 p-4 rounded-lg border border-purple-300 bg-purple-50/50"},vt={__name:"Workflow",props:{steps:{type:Array,required:!0},fullContextSteps:{type:Array,default:()=>[]},loopContextSchema:{type:Object,default:null},allowTrigger:{type:Boolean,default:!0}},emits:["update:steps","add-trigger"],setup(n,{emit:k}){const I=M(),N=G(()=>I.automationSchema||[]),u=n,S=k,F={TRIGGER:D,SCHEDULE_TRIGGER:B,FETCH_RECORDS:j,CONDITION:$,ACTION:H,AI_PROMPT:U,FOR_EACH:L,TRANSFORM_CONTENT:P},b=p=>F[p]||null;function v(p){var h,_,O,T;const t=(h=p.step_config)==null?void 0:h.sourceArray;if(!t)return null;const s=t.match(/{{step_(\w+)\.(.+)}}/);if(!s)return null;const e=s[1],r=s[2],o=u.fullContextSteps.find(l=>l.id==e),f=l=>{const c=String((l==null?void 0:l.type)||"").toLowerCase(),E=String((l==null?void 0:l.itemType)||"").toLowerCase();return c==="array of objects"||c==="array"&&E==="object"};if((o==null?void 0:o.step_type)==="AI_PROMPT"){const l=(O=(_=o.step_config)==null?void 0:_.responseStructure)==null?void 0:O.find(c=>c.name===r);return f(l)?{name:"Loop Item",columns:l.schema||[]}:null}if((o==null?void 0:o.step_type)==="FETCH_RECORDS"&&r==="records"){const l=(T=o.step_config)==null?void 0:T.model;if(!l)return null;const c=N.value.find(d=>d.name===l);return c?{name:"Loop Item",columns:(c.columns||[]).map(d=>typeof d=="string"?{name:d}:d)}:null}return null}function x(p,t){const s=[...u.steps];s[p]=t,S("update:steps",s)}function w(p,t){const s={id:`temp_${Date.now()}`,step_type:t,name:`New ${t.replace("_"," ")} Step`,step_config:{}};if(t==="CONDITION"&&(s.if_true=[],s.if_false=[]),t==="FOR_EACH"&&(s.children=[]),t==="FETCH_RECORDS"){const o=u.steps.slice(0,p).slice().reverse().find(f=>f&&f.step_type==="FETCH_RECORDS"&&f.step_config&&f.step_config.model);o&&(s.step_config={model:o.step_config.model,conditions:[]})}const e=[...u.steps];e.splice(p,0,s),S("update:steps",e)}function A(p){const t=u.steps.filter((s,e)=>e!==p);S("update:steps",t)}return(p,t)=>{const s=W("Workflow",!0);return a(),m("div",Y,[n.steps.length===0?(a(),m("div",z,[n.allowTrigger?(a(),m(C,{key:0},[t[2]||(t[2]=i("h3",{class:"text-lg font-semibold text-gray-700"},"Start your Automation",-1)),t[3]||(t[3]=i("p",{class:"text-sm text-gray-500 mt-1 mb-4"},"Every workflow starts with a trigger. How should this one begin?",-1)),i("button",{onClick:t[0]||(t[0]=e=>p.$emit("add-trigger")),class:"px-4 py-2 text-sm font-semibold rounded-md bg-indigo-600 text-white hover:bg-indigo-700"}," Add Trigger ")],64)):(a(),m(C,{key:1},[t[4]||(t[4]=i("h3",{class:"text-lg font-semibold text-gray-700"},"Start this flow",-1)),t[5]||(t[5]=i("p",{class:"text-sm text-gray-500 mt-1 mb-4"},"Choose a step to add in this branch.",-1)),i("div",J,[g(R,{onSelect:t[1]||(t[1]=e=>w(0,e))})])],64))])):(a(!0),m(C,{key:1},V(n.steps,(e,r)=>(a(),m(C,{key:e.id},[i("div",Q,[b(e.step_type)?(a(),q(K(b(e.step_type)),{key:0,step:e,"all-steps-before":[...n.fullContextSteps,...n.steps.slice(0,r)],"loop-context-schema":n.loopContextSchema,onDelete:!n.allowTrigger||r>0?()=>A(r):null,"onUpdate:step":o=>x(r,o)},null,40,["step","all-steps-before","loop-context-schema","onDelete","onUpdate:step"])):y("",!0),e.step_type==="CONDITION"?(a(),m("div",X,[i("div",Z,[t[6]||(t[6]=i("p",{class:"text-center font-bold text-green-700 mb-4"},"IF YES",-1)),g(s,{steps:e.if_true||[],"onUpdate:steps":o=>x(r,{...e,if_true:o}),"full-context-steps":[...n.fullContextSteps,...n.steps.slice(0,r+1)],"loop-context-schema":n.loopContextSchema,"allow-trigger":!1},null,8,["steps","onUpdate:steps","full-context-steps","loop-context-schema"])]),i("div",tt,[t[7]||(t[7]=i("p",{class:"text-center font-bold text-red-700 mb-4"},"IF NO",-1)),g(s,{steps:e.if_false||[],"onUpdate:steps":o=>x(r,{...e,if_false:o}),"full-context-steps":[...n.fullContextSteps,...n.steps.slice(0,r+1)],"loop-context-schema":n.loopContextSchema,"allow-trigger":!1},null,8,["steps","onUpdate:steps","full-context-steps","loop-context-schema"])])])):y("",!0),e.step_type==="FOR_EACH"?(a(),m("div",et,[t[8]||(t[8]=i("p",{class:"text-center font-bold text-purple-700 mb-4"},"DO THIS FOR EACH ITEM",-1)),g(s,{steps:e.children||[],"onUpdate:steps":o=>x(r,{...e,children:o}),"full-context-steps":[...n.fullContextSteps,...n.steps.slice(0,r+1)],"loop-context-schema":v(e),"allow-trigger":!1},null,8,["steps","onUpdate:steps","full-context-steps","loop-context-schema"])])):y("",!0)]),g(R,{onSelect:o=>w(r+1,o)},null,8,["onSelect"])],64))),128))])}}};export{vt as default};
