import{_ as O,r as p,E as q,w,H as _,s as k,c as B,o as r,a as F,i as l,g as m,d as M,b as a,t as u,n as y,F as D,j as E,m as z,f as R,k as V,T as $}from"./app-DcG5Qsxo.js";const P={class:"relative bg-white w-full h-full flex flex-col p-4"},U={class:"flex justify-between items-center pb-4 border-b border-gray-200"},H={key:0,class:"text-xl font-semibold text-gray-800 flex-1 truncate pr-2"},L={key:1,class:"text-xl font-semibold text-gray-800 flex-1 truncate pr-2"},J={key:0,class:"text-center text-gray-500 py-8"},K={class:"font-semibold mb-1"},W={key:0},G={class:"whitespace-pre-wrap"},Q={class:"text-xs text-gray-500 mt-1 text-right"},X={class:"pt-4 border-t border-gray-200"},Y=["disabled"],Z=["disabled"],ee={key:0},te={key:1},se={__name:"TicketNotesSidebar",props:{isOpen:{type:Boolean,required:!0},selectedItem:{type:Object,default:null},initialAuthToken:{type:String,required:!0},projectId:{type:[String,Number],required:!0},noteFor:{type:String,required:!0}},emits:["update:isOpen","note-added-success"],setup(n,{emit:N}){const o=n,h=N,i=p(""),c=p(!1),d=p([]),f=p(null),{showModal:x}=q("modalService");w(()=>o.selectedItem,e=>{e?(d.value=[...e.notes||[]],_(()=>{v()})):d.value=[]},{immediate:!0}),w(d,()=>{_(()=>{v()})},{deep:!0});const g=()=>{h("update:isOpen",!1),i.value="",c.value=!1},v=()=>{f.value&&(f.value.scrollTop=f.value.scrollHeight)},I=async e=>{c.value=!0,console.log(o.selectedItem);try{const s=await fetch(`/api/client-api/${o.noteFor}/${o.selectedItem.id}/notes`,{method:"POST",headers:{Authorization:`Bearer ${o.initialAuthToken}`,"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(e)}),t=await s.json();if(!s.ok){const A=t.errors?Object.values(t.errors).flat().join(`
`):t.message||"API request failed.";throw new Error(A)}return t}catch(s){throw console.error(`Error adding note to task ${o.selectedItem.id}:`,s),x("Error",s.message||"Failed to add comment.","alert"),s}finally{c.value=!1}},C=async()=>{if(!i.value.trim()){x("Note Required","Please type a message before submitting.","alert");return}try{const e=await I({comment_text:i.value});e.note&&(d.value.push(e.note),i.value="",h("note-added-success"))}catch{}},S=e=>e.creator_name??"UNKNOWN",b=e=>e.author&&e.author.type==="client",T=k(()=>{if(!o.selectedItem)return"";switch(o.selectedItem.status){case"completed":return"text-green-600";case"pending":return"text-yellow-600";case"in_progress":return"text-blue-600";case"blocked":return"text-red-600";default:return"text-gray-600"}}),j=k(()=>{var e;return o.selectedItem?(e=o.selectedItem.status)==null?void 0:e.replace(/_/g," ").replace(/\b\w/g,s=>s.toUpperCase()):""});return(e,s)=>(r(),B($,{name:"slide-fade"},{default:F(()=>[n.isOpen&&n.selectedItem?(r(),l("div",{key:0,class:"fixed right-0 top-0 h-full w-full sm:w-96 bg-white shadow-xl flex flex-col z-40 transition-transform duration-300 ease-in-out",onClick:M(g,["self"])},[a("div",{class:"absolute inset-0 bg-gray-900 bg-opacity-50",onClick:g}),a("div",P,[a("div",U,[n.selectedItem.name?(r(),l("h3",H,"Task: "+u(n.selectedItem.name),1)):m("",!0),n.selectedItem.filename?(r(),l("h3",L,"File: "+u(n.selectedItem.filename),1)):m("",!0),a("span",{class:y(["text-sm font-medium",T.value])},u(j.value),3),a("button",{onClick:g,class:"text-gray-500 hover:text-gray-800 text-3xl ml-4 leading-none","aria-label":"Close"},"Ã—")]),a("div",{ref_key:"notesContainerRef",ref:f,class:"flex-1 overflow-y-auto py-4 space-y-4"},[d.value.length===0?(r(),l("div",J," No notes for this task yet. ")):m("",!0),(r(!0),l(D,null,E(d.value,t=>(r(),l("div",{key:t.id,class:y(["flex items-start",b(t)?"justify-end":"justify-start"])},[a("div",{class:y(["p-3 rounded-lg max-w-[80%]",b(t)?"bg-blue-100 text-blue-800 rounded-br-none":"bg-gray-100 text-gray-800 rounded-bl-none"])},[a("p",K,[b(t)?m("",!0):(r(),l("span",W,u(S(t)),1)),s[1]||(s[1]=z(": ",-1))]),a("p",G,u(t.content),1),a("p",Q,u(new Date(t.created_at).toLocaleString()),1)],2)],2))),128))],512),a("div",X,[R(a("textarea",{"onUpdate:modelValue":s[0]||(s[0]=t=>i.value=t),placeholder:"Type your message here...",rows:"3",class:"w-full p-2 border border-gray-300 rounded-lg mb-2 focus:ring-blue-500 focus:border-blue-500 resize-y",disabled:c.value},null,8,Y),[[V,i.value]]),a("button",{onClick:C,class:"w-full bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",disabled:c.value||!i.value.trim()},[c.value?(r(),l("span",ee,"Sending...")):(r(),l("span",te,"Send Message"))],8,Z)])])])):m("",!0)]),_:1}))}},oe=O(se,[["__scopeId","data-v-99f10a48"]]);export{oe as default};
