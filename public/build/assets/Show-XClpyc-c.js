import{B as Te,n as ss,T as as,a as ls,o as is,q as os,t as ns,R as rs,_ as ds,v as us}from"./AuthenticatedLayout-DHhyP1e3.js";import{a as r,o as i,b as e,c as F,aQ as Se,d as v,i as D,aR as st,w as B,O as oe,m as q,t as g,g as Q,aS as ht,an as gt,j as te,k as _e,F as X,l as ae,ak as Ke,aT as le,S as kt,G as Le,aM as cs,C as Ce,r as b,I as De,e as ne,f as be,x as ve,y as we,z as qe,u as H,R as ms,A as at,aU as ft,q as Xe,B as vs,aq as ps,ap as hs,M as Dt,H as lt,aA as Ue,p as Je,s as gs,v as fs,aP as ys,ar as bs,aN as _s,h as ws,K as xs,X as ks,as as Ds}from"./app-Dj9kxnzE.js";import{_ as Cs}from"./ProjectForm-_1X3p_w3.js";import{_ as je}from"./Modal-CuAYo9yB.js";import{P as ce}from"./PrimaryButton-C_hRsqdY.js";import{b as Ct,_ as $t,a as jt}from"./TaskList-DC9UdUf4.js";import{h as ue}from"./moment-BLMuvzoS.js";import{_ as G}from"./InputLabel-ZJteNQaM.js";import{_ as re}from"./TextInput-CLPsQmoX.js";import{_ as ie}from"./InputError-DlBwpuYB.js";import{O as Oe}from"./CustomMultiSelect-aDZPBGf3.js";import{S as me}from"./SelectDropdown-De4rbmCw.js";import{_ as Me}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as fe}from"./SecondaryButton-BMQGlT3z.js";import{a as $s,r as js}from"./PlusIcon-BBX5ZEny.js";import{r as Ts}from"./PaperAirplaneIcon-B7KHwLU8.js";import{_ as Tt}from"./EmailEditor-BCGZosby.js";import{_ as Es}from"./EmailList-K0ZglRGY.js";import{b as ge,c as Ie,d as ze,f as Ve,a as Ms}from"./currency-CLVzcZXN.js";import{_ as Ss}from"./NoticeboardModal-DPrwbKUV.js";import{r as Vs}from"./ChevronDownIcon-gl_WMTWR.js";import"./Checkbox-CSmlXWDe.js";import"./ApplicationLogo-QvkRjSWn.js";import"./DangerButton-jRU7iRVV.js";import"./ProjectTypeInput-DLrEm6Zh.js";/* empty css                                                                       */import"./EmailEditor.vue_vue_type_style_index_0_lang-BopklTo_.js";function As(s,t){return i(),r("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 1 0 0-16 8 8 0 0 0 0 16Zm3.857-9.809a.75.75 0 0 0-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 1 0-1.06 1.061l2.5 2.5a.75.75 0 0 0 1.137-.089l4-5.5Z","clip-rule":"evenodd"})])}function Is(s,t){return i(),r("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"fill-rule":"evenodd",d:"M11.78 5.22a.75.75 0 0 1 0 1.06L8.06 10l3.72 3.72a.75.75 0 1 1-1.06 1.06l-4.25-4.25a.75.75 0 0 1 0-1.06l4.25-4.25a.75.75 0 0 1 1.06 0Z","clip-rule":"evenodd"})])}function Ls(s,t){return i(),r("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"fill-rule":"evenodd",d:"M8.22 5.22a.75.75 0 0 1 1.06 0l4.25 4.25a.75.75 0 0 1 0 1.06l-4.25 4.25a.75.75 0 0 1-1.06-1.06L11.94 10 8.22 6.28a.75.75 0 0 1 0-1.06Z","clip-rule":"evenodd"})])}function Os(s,t){return i(),r("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"fill-rule":"evenodd",d:"M9.47 6.47a.75.75 0 0 1 1.06 0l4.25 4.25a.75.75 0 1 1-1.06 1.06L10 8.06l-3.72 3.72a.75.75 0 0 1-1.06-1.06l4.25-4.25Z","clip-rule":"evenodd"})])}function Us(s,t){return i(),r("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{d:"M10.75 10.818v2.614A3.13 3.13 0 0 0 11.888 13c.482-.315.612-.648.612-.875 0-.227-.13-.56-.612-.875a3.13 3.13 0 0 0-1.138-.432ZM8.33 8.62c.053.055.115.11.184.164.208.16.46.284.736.363V6.603a2.45 2.45 0 0 0-.35.13c-.14.065-.27.143-.386.233-.377.292-.514.627-.514.909 0 .184.058.39.202.592.037.051.08.102.128.152Z"}),e("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 1 1-16 0 8 8 0 0 1 16 0Zm-8-6a.75.75 0 0 1 .75.75v.316a3.78 3.78 0 0 1 1.653.713c.426.33.744.74.925 1.2a.75.75 0 0 1-1.395.55 1.35 1.35 0 0 0-.447-.563 2.187 2.187 0 0 0-.736-.363V9.3c.698.093 1.383.32 1.959.696.787.514 1.29 1.27 1.29 2.13 0 .86-.504 1.616-1.29 2.13-.576.377-1.261.603-1.96.696v.299a.75.75 0 1 1-1.5 0v-.3c-.697-.092-1.382-.318-1.958-.695-.482-.315-.857-.717-1.078-1.188a.75.75 0 1 1 1.359-.636c.08.173.245.376.54.569.313.205.706.353 1.138.432v-2.748a3.782 3.782 0 0 1-1.653-.713C6.9 9.433 6.5 8.681 6.5 7.875c0-.805.4-1.558 1.097-2.096a3.78 3.78 0 0 1 1.653-.713V4.75A.75.75 0 0 1 10 4Z","clip-rule":"evenodd"})])}function yt(s,t){return i(),r("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{d:"M3 4a2 2 0 0 0-2 2v1.161l8.441 4.221a1.25 1.25 0 0 0 1.118 0L19 7.162V6a2 2 0 0 0-2-2H3Z"}),e("path",{d:"m19 8.839-7.77 3.885a2.75 2.75 0 0 1-2.46 0L1 8.839V14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V8.839Z"})])}function Ps(s,t){return i(),r("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{d:"M16.555 5.412a8.028 8.028 0 0 0-3.503-2.81 14.899 14.899 0 0 1 1.663 4.472 8.547 8.547 0 0 0 1.84-1.662ZM13.326 7.825a13.43 13.43 0 0 0-2.413-5.773 8.087 8.087 0 0 0-1.826 0 13.43 13.43 0 0 0-2.413 5.773A8.473 8.473 0 0 0 10 8.5c1.18 0 2.304-.24 3.326-.675ZM6.514 9.376A9.98 9.98 0 0 0 10 10c1.226 0 2.4-.22 3.486-.624a13.54 13.54 0 0 1-.351 3.759A13.54 13.54 0 0 1 10 13.5c-1.079 0-2.128-.127-3.134-.366a13.538 13.538 0 0 1-.352-3.758ZM5.285 7.074a14.9 14.9 0 0 1 1.663-4.471 8.028 8.028 0 0 0-3.503 2.81c.529.638 1.149 1.199 1.84 1.66ZM17.334 6.798a7.973 7.973 0 0 1 .614 4.115 13.47 13.47 0 0 1-3.178 1.72 15.093 15.093 0 0 0 .174-3.939 10.043 10.043 0 0 0 2.39-1.896ZM2.666 6.798a10.042 10.042 0 0 0 2.39 1.896 15.196 15.196 0 0 0 .174 3.94 13.472 13.472 0 0 1-3.178-1.72 7.973 7.973 0 0 1 .615-4.115ZM10 15c.898 0 1.778-.079 2.633-.23a13.473 13.473 0 0 1-1.72 3.178 8.099 8.099 0 0 1-1.826 0 13.47 13.47 0 0 1-1.72-3.178c.855.151 1.735.23 2.633.23ZM14.357 14.357a14.912 14.912 0 0 1-1.305 3.04 8.027 8.027 0 0 0 4.345-4.345c-.953.542-1.971.981-3.04 1.305ZM6.948 17.397a8.027 8.027 0 0 1-4.345-4.345c.953.542 1.971.981 3.04 1.305a14.912 14.912 0 0 0 1.305 3.04Z"})])}function Ns(s,t){return i(),r("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{d:"m2.695 14.762-1.262 3.155a.5.5 0 0 0 .65.65l3.155-1.262a4 4 0 0 0 1.343-.886L17.5 5.501a2.121 2.121 0 0 0-3-3L3.58 13.419a4 4 0 0 0-.885 1.343Z"})])}function Rs(s,t){return i(),r("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"fill-rule":"evenodd",d:"M2 3.5A1.5 1.5 0 0 1 3.5 2h1.148a1.5 1.5 0 0 1 1.465 1.175l.716 3.223a1.5 1.5 0 0 1-1.052 1.767l-.933.267c-.41.117-.643.555-.48.95a11.542 11.542 0 0 0 6.254 6.254c.395.163.833-.07.95-.48l.267-.933a1.5 1.5 0 0 1 1.767-1.052l3.223.716A1.5 1.5 0 0 1 18 15.352V16.5a1.5 1.5 0 0 1-1.5 1.5H15c-1.149 0-2.263-.15-3.326-.43A13.022 13.022 0 0 1 2.43 8.326 13.019 13.019 0 0 1 2 5V3.5Z","clip-rule":"evenodd"})])}function Et(s,t){return i(),r("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{d:"M7 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6ZM14.5 9a2.5 2.5 0 1 0 0-5 2.5 2.5 0 0 0 0 5ZM1.615 16.428a1.224 1.224 0 0 1-.569-1.175 6.002 6.002 0 0 1 11.908 0c.058.467-.172.92-.57 1.174A9.953 9.953 0 0 1 7 18a9.953 9.953 0 0 1-5.385-1.572ZM14.5 16h-.106c.07-.297.088-.611.048-.933a7.47 7.47 0 0 0-1.588-3.755 4.502 4.502 0 0 1 5.874 2.636.818.818 0 0 1-.36.98A7.465 7.465 0 0 1 14.5 16Z"})])}function Fs(s,t){return i(),r("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 1 0 0-16 8 8 0 0 0 0 16ZM8.28 7.22a.75.75 0 0 0-1.06 1.06L8.94 10l-1.72 1.72a.75.75 0 1 0 1.06 1.06L10 11.06l1.72 1.72a.75.75 0 1 0 1.06-1.06L11.06 10l1.72-1.72a.75.75 0 0 0-1.06-1.06L10 8.94 8.28 7.22Z","clip-rule":"evenodd"})])}function Bs(s,t){return i(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 0 1 2.25-2.25h13.5A2.25 2.25 0 0 1 21 7.5v11.25m-18 0A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75m-18 0v-7.5A2.25 2.25 0 0 1 5.25 9h13.5A2.25 2.25 0 0 1 21 11.25v7.5m-9-6h.008v.008H12v-.008ZM12 15h.008v.008H12V15Zm0 2.25h.008v.008H12v-.008ZM9.75 15h.008v.008H9.75V15Zm0 2.25h.008v.008H9.75v-.008ZM7.5 15h.008v.008H7.5V15Zm0 2.25h.008v.008H7.5v-.008Zm6.75-4.5h.008v.008h-.008v-.008Zm0 2.25h.008v.008h-.008V15Zm0 2.25h.008v.008h-.008v-.008Zm2.25-4.5h.008v.008H16.5v-.008Zm0 2.25h.008v.008H16.5V15Z"})])}function Hs(s,t){return i(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M20.25 8.511c.884.284 1.5 1.128 1.5 2.097v4.286c0 1.136-.847 2.1-1.98 2.193-.34.027-.68.052-1.02.072v3.091l-3-3c-1.354 0-2.694-.055-4.02-.163a2.115 2.115 0 0 1-.825-.242m9.345-8.334a2.126 2.126 0 0 0-.476-.095 48.64 48.64 0 0 0-8.048 0c-1.131.094-1.976 1.057-1.976 2.192v4.286c0 .837.46 1.58 1.155 1.951m9.345-8.334V6.637c0-1.621-1.152-3.026-2.76-3.235A48.455 48.455 0 0 0 11.25 3c-2.115 0-4.198.137-6.24.402-1.608.209-2.76 1.614-2.76 3.235v6.226c0 1.621 1.152 3.026 2.76 3.235.577.075 1.157.14 1.74.194V21l4.155-4.155"})])}function Ws(s,t){return i(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m21 7.5-2.25-1.313M21 7.5v2.25m0-2.25-2.25 1.313M3 7.5l2.25-1.313M3 7.5l2.25 1.313M3 7.5v2.25m9 3 2.25-1.313M12 12.75l-2.25-1.313M12 12.75V15m0 6.75 2.25-1.313M12 21.75V19.5m0 2.25-2.25-1.313m0-16.875L12 2.25l2.25 1.313M21 14.25v2.25l-2.25 1.313m-13.5 0L3 16.5v-2.25"})])}function Ys(s,t){return i(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3.75 9.776c.112-.017.227-.026.344-.026h15.812c.117 0 .232.009.344.026m-16.5 0a2.25 2.25 0 0 0-1.883 2.542l.857 6a2.25 2.25 0 0 0 2.227 1.932H19.05a2.25 2.25 0 0 0 2.227-1.932l.857-6a2.25 2.25 0 0 0-1.883-2.542m-16.5 0V6A2.25 2.25 0 0 1 6 3.75h3.879a1.5 1.5 0 0 1 1.06.44l2.122 2.12a1.5 1.5 0 0 0 1.06.44H18A2.25 2.25 0 0 1 20.25 9v.776"})])}function zs(s,t){return i(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 21a9.004 9.004 0 0 0 8.716-6.747M12 21a9.004 9.004 0 0 1-8.716-6.747M12 21c2.485 0 4.5-4.03 4.5-9S14.485 3 12 3m0 18c-2.485 0-4.5-4.03-4.5-9S9.515 3 12 3m0 0a8.997 8.997 0 0 1 7.843 4.582M12 3a8.997 8.997 0 0 0-7.843 4.582m15.686 0A11.953 11.953 0 0 1 12 10.5c-2.998 0-5.74-1.1-7.843-2.918m15.686 0A8.959 8.959 0 0 1 21 12c0 .778-.099 1.533-.284 2.253m0 0A17.919 17.919 0 0 1 12 16.5c-3.162 0-6.133-.815-8.716-2.247m0 0A9.015 9.015 0 0 1 3 12c0-1.605.42-3.113 1.157-4.418"})])}function qs(s,t){return i(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M13.19 8.688a4.5 4.5 0 0 1 1.242 7.244l-4.5 4.5a4.5 4.5 0 0 1-6.364-6.364l1.757-1.757m13.35-.622 1.757-1.757a4.5 4.5 0 0 0-6.364-6.364l-4.5 4.5a4.5 4.5 0 0 0 1.242 7.244"})])}function Zs(s,t){return i(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M7.217 10.907a2.25 2.25 0 1 0 0 2.186m0-2.186c.18.324.283.696.283 1.093s-.103.77-.283 1.093m0-2.186 9.566-5.314m-9.566 7.5 9.566 5.314m0 0a2.25 2.25 0 1 0 3.935 2.186 2.25 2.25 0 0 0-3.935-2.186Zm0-12.814a2.25 2.25 0 1 0 3.933-2.185 2.25 2.25 0 0 0-3.933 2.185Z"})])}function Gs(s,t){return i(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9.813 15.904 9 18.75l-.813-2.846a4.5 4.5 0 0 0-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 0 0 3.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 0 0 3.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 0 0-3.09 3.09ZM18.259 8.715 18 9.75l-.259-1.035a3.375 3.375 0 0 0-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 0 0 2.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 0 0 2.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 0 0-2.456 2.456ZM16.894 20.567 16.5 21.75l-.394-1.183a2.25 2.25 0 0 0-1.423-1.423L13.5 18.75l1.183-.394a2.25 2.25 0 0 0 1.423-1.423l.394-1.183.394 1.183a2.25 2.25 0 0 0 1.423 1.423l1.183.394-1.183.394a2.25 2.25 0 0 0-1.423 1.423Z"})])}function Mt(s){const t=o=>{const l=/\[([^\]]+?)\][\s\u00A0]*\{([^}]+?)\}/g;return o.replace(l,(m,d,c)=>{let u=c.trim();return!u.startsWith("http://")&&!u.startsWith("https://")&&(u=`https://${u}`),`<a href="${u}" target="_blank" style="color: #1a73e8; text-decoration: underline;">${d.trim()}</a>`})},a=o=>{const l=/<(ul|ol)>(.*?)<\/(ul|ol)>/gs;return o.replace(l,(m,d,c)=>{const u=d,h=u==="ul"?"list-style-type: disc;":"list-style-type: decimal;",x=/<li>(.*?)<\/li>/gs,T=c.replace(x,(A,_)=>`<li style="margin-bottom: 5px; font-family: 'Inter', sans-serif; font-size: 16px; line-height: 1.6; color: #1a202c;">${_}</li>`);return`<${u} style="margin: 0; padding: 0 0 0 20px; ${h}">${T}</${u}>`})};return{processedHtmlBody:F(()=>{let o=s.value;return o=t(o),o=a(o),o})}}var Ks=Object.defineProperty,Js=(s,t,a)=>t in s?Ks(s,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[t]=a,Ee=(s,t,a)=>Js(s,typeof t!="symbol"?t+"":t,a);const Xs=(s,t,a)=>{const n=s[t];return n?typeof n=="function"?n():Promise.resolve(n):new Promise((o,l)=>{(typeof queueMicrotask=="function"?queueMicrotask:setTimeout)(l.bind(null,new Error("Unknown variable dynamic import: "+t+(t.split("/").length!==a?". Note that variables only represent file names one level deep.":""))))})};let He,bt,_t,ke,We={},Ae={};class Qs{constructor(t,a=!1){Ee(this,"texts",{}),Ee(this,"dateToMinutes",n=>n.getHours()*60+n.getMinutes()),ke=this,this._texts=t,!a&&Date&&!Date.prototype.addDays&&this._initDatePrototypes()}_initDatePrototypes(){Date.prototype.addDays=function(t){return ke.addDays(this,t)},Date.prototype.subtractDays=function(t){return ke.subtractDays(this,t)},Date.prototype.addHours=function(t){return ke.addHours(this,t)},Date.prototype.subtractHours=function(t){return ke.subtractHours(this,t)},Date.prototype.addMinutes=function(t){return ke.addMinutes(this,t)},Date.prototype.subtractMinutes=function(t){return ke.subtractMinutes(this,t)},Date.prototype.getWeek=function(){return ke.getWeek(this)},Date.prototype.isToday=function(){return ke.isToday(this)},Date.prototype.isLeapYear=function(){return ke.isLeapYear(this)},Date.prototype.format=function(t="YYYY-MM-DD"){return ke.formatDate(this,t)},Date.prototype.formatTime=function(t="HH:mm"){return ke.formatTime(this,t)}}removePrototypes(){delete Date.prototype.addDays,delete Date.prototype.subtractDays,delete Date.prototype.addHours,delete Date.prototype.subtractHours,delete Date.prototype.addMinutes,delete Date.prototype.subtractMinutes,delete Date.prototype.getWeek,delete Date.prototype.isToday,delete Date.prototype.isLeapYear,delete Date.prototype.format,delete Date.prototype.formatTime}updateTexts(t){this._texts=t}_todayFormatted(){return bt!==new Date().getDate()&&(He=new Date,bt=He.getDate(),_t=`${He.getFullYear()}-${He.getMonth()}-${He.getDate()}`),_t}addDays(t,a){const n=new Date(t.valueOf());return n.setDate(n.getDate()+a),n}subtractDays(t,a){const n=new Date(t.valueOf());return n.setDate(n.getDate()-a),n}addHours(t,a){const n=new Date(t.valueOf());return n.setHours(n.getHours()+a),n}subtractHours(t,a){const n=new Date(t.valueOf());return n.setHours(n.getHours()-a),n}addMinutes(t,a){const n=new Date(t.valueOf());return n.setMinutes(n.getMinutes()+a),n}subtractMinutes(t,a){const n=new Date(t.valueOf());return n.setMinutes(n.getMinutes()-a),n}getWeek(t){const a=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate())),n=a.getUTCDay()||7;a.setUTCDate(a.getUTCDate()+4-n);const o=new Date(Date.UTC(a.getUTCFullYear(),0,1));return Math.ceil(((a-o)/864e5+1)/7)}isToday(t){return`${t.getFullYear()}-${t.getMonth()}-${t.getDate()}`===this._todayFormatted()}isLeapYear(t){const a=t.getFullYear();return!(a%400)||a%100&&!(a%4)}getPreviousFirstDayOfWeek(t=null,a){const n=t&&new Date(t.valueOf())||new Date,o=a?7:6;return n.setDate(n.getDate()-(n.getDay()+o)%7),n}stringToDate(t){return t instanceof Date?t:(t.length===10&&(t+=" 00:00"),new Date(t.replace(/-/g,"/")))}countDays(t,a){typeof t=="string"&&(t=t.replace(/-/g,"/")),typeof a=="string"&&(a=a.replace(/-/g,"/")),t=new Date(t).setHours(0,0,0,0),a=new Date(a).setHours(0,0,1,0);const n=(new Date(a).getTimezoneOffset()-new Date(t).getTimezoneOffset())*60*1e3;return Math.ceil((a-t-n)/(24*3600*1e3))}datesInSameTimeStep(t,a,n){return Math.abs(t.getTime()-a.getTime())<=n*60*1e3}formatDate(t,a="YYYY-MM-DD",n=null){if(n||(n=this._texts),a||(a="YYYY-MM-DD"),a==="YYYY-MM-DD")return this.formatDateLite(t);We={},Ae={};const o={YYYY:()=>this._hydrateDateObject(t,n).YYYY,YY:()=>this._hydrateDateObject(t,n).YY(),M:()=>this._hydrateDateObject(t,n).M,MM:()=>this._hydrateDateObject(t,n).MM(),MMM:()=>this._hydrateDateObject(t,n).MMM(),MMMM:()=>this._hydrateDateObject(t,n).MMMM(),MMMMG:()=>this._hydrateDateObject(t,n).MMMMG(),D:()=>this._hydrateDateObject(t,n).D,DD:()=>this._hydrateDateObject(t,n).DD(),S:()=>this._hydrateDateObject(t,n).S(),d:()=>this._hydrateDateObject(t,n).d,dd:()=>this._hydrateDateObject(t,n).dd(),ddd:()=>this._hydrateDateObject(t,n).ddd(),dddd:()=>this._hydrateDateObject(t,n).dddd(),HH:()=>this._hydrateTimeObject(t,n).HH,H:()=>this._hydrateTimeObject(t,n).H,hh:()=>this._hydrateTimeObject(t,n).hh,h:()=>this._hydrateTimeObject(t,n).h,am:()=>this._hydrateTimeObject(t,n).am,AM:()=>this._hydrateTimeObject(t,n).AM,mm:()=>this._hydrateTimeObject(t,n).mm,m:()=>this._hydrateTimeObject(t,n).m};return a.replace(/(\{[a-zA-Z]+\}|[a-zA-Z]+)/g,(l,m)=>{const d=o[m.replace(/\{|\}/g,"")];return d!==void 0?d():m})}formatDateLite(t){const a=t.getMonth()+1,n=t.getDate();return`${t.getFullYear()}-${a<10?"0":""}${a}-${n<10?"0":""}${n}`}formatTime(t,a="HH:mm",n=null,o=!1){let l=!1;if(o){const[c,u,h]=[t.getHours(),t.getMinutes(),t.getSeconds()];c+u+h===141&&(l=!0)}if(t instanceof Date&&a==="HH:mm")return l?"24:00":this.formatTimeLite(t);Ae={},n||(n=this._texts);const m=this._hydrateTimeObject(t,n),d=a.replace(/(\{[a-zA-Z]+\}|[a-zA-Z]+)/g,(c,u)=>{const h=m[u.replace(/\{|\}/g,"")];return h!==void 0?h:u});return l?d.replace("23:59","24:00"):d}formatTimeLite(t){const a=t.getHours(),n=t.getMinutes();return`${(a<10?"0":"")+a}:${(n<10?"0":"")+n}`}_nth(t){if(t>3&&t<21)return"th";switch(t%10){case 1:return"st";case 2:return"nd";case 3:return"rd";default:return"th"}}_hydrateDateObject(t,a){if(We.D)return We;const n=t.getFullYear(),o=t.getMonth()+1,l=t.getDate(),d=(t.getDay()-1+7)%7;return We={YYYY:n,YY:()=>n.toString().substring(2),M:o,MM:()=>(o<10?"0":"")+o,MMM:()=>a.months[o-1].substring(0,3),MMMM:()=>a.months[o-1],MMMMG:()=>(a.monthsGenitive||a.months)[o-1],D:l,DD:()=>(l<10?"0":"")+l,S:()=>this._nth(l),d:d+1,dd:()=>a.weekDays[d][0],ddd:()=>a.weekDays[d].substr(0,3),dddd:()=>a.weekDays[d]},We}_hydrateTimeObject(t,a){if(Ae.am)return Ae;let n,o;t instanceof Date?(n=t.getHours(),o=t.getMinutes()):(n=Math.floor(t/60),o=Math.floor(t%60));const l=n%12?n%12:12,m=(a||{am:"am",pm:"pm"})[n===24||n<12?"am":"pm"];return Ae={H:n,h:l,HH:(n<10?"0":"")+n,hh:(l<10?"0":"")+l,am:m,AM:m.toUpperCase(),m:o,mm:(o<10?"0":"")+o},Ae}}const ea=1440;class ta{constructor(t){Ee(this,"_vuecal",null),Ee(this,"selectCell",(a=!1,n,o)=>{this._vuecal.$emit("cell-click",o?{date:n,split:o}:n),this._vuecal.clickToNavigate||a?this._vuecal.switchToNarrowerView():this._vuecal.dblclickToNavigate&&"ontouchstart"in window&&(this._vuecal.domEvents.dblTapACell.taps++,setTimeout(()=>this._vuecal.domEvents.dblTapACell.taps=0,this._vuecal.domEvents.dblTapACell.timeout),this._vuecal.domEvents.dblTapACell.taps>=2&&(this._vuecal.domEvents.dblTapACell.taps=0,this._vuecal.switchToNarrowerView(),this._vuecal.$emit("cell-dblclick",o?{date:n,split:o}:n)))}),Ee(this,"keyPressEnterCell",(a,n)=>{this._vuecal.$emit("cell-keypress-enter",n?{date:a,split:n}:a),this._vuecal.switchToNarrowerView()}),Ee(this,"getPosition",a=>{const{left:n,top:o}=this._vuecal.cellsEl.getBoundingClientRect(),{clientX:l,clientY:m}="ontouchstart"in window&&a.touches?a.touches[0]:a;return{x:l-n,y:m-o}}),Ee(this,"minutesAtCursor",a=>{let n=0,o={x:0,y:0};const{timeStep:l,timeCellHeight:m,timeFrom:d}=this._vuecal.$props;return typeof a=="number"?n=a:typeof a=="object"&&(o=this.getPosition(a),n=Math.round(o.y*l/parseInt(m)+d)),{minutes:Math.max(Math.min(n,ea),0),cursorCoords:o}}),this._vuecal=t}}const sa=2,et=1440;let pe,he,tt;class aa{constructor(t,a){Ee(this,"_vuecal",null),Ee(this,"eventDefaults",{_eid:null,start:"",startTimeMinutes:0,end:"",endTimeMinutes:0,title:"",content:"",background:!1,allDay:!1,segments:null,repeat:null,daysCount:1,deletable:!0,deleting:!1,titleEditable:!0,resizable:!0,resizing:!1,draggable:!0,dragging:!1,draggingStatic:!1,focused:!1,class:""}),this._vuecal=t,pe=a}createAnEvent(t,a,n){if(typeof t=="string"&&(t=pe.stringToDate(t)),!(t instanceof Date))return!1;const o=pe.dateToMinutes(t);a=a*1||sa*60;const l=o+a,m=pe.addMinutes(new Date(t),a);n.end&&(typeof n.end=="string"&&(n.end=pe.stringToDate(n.end)),n.endTimeMinutes=pe.dateToMinutes(n.end));const d={...this.eventDefaults,_eid:`${this._vuecal._.uid}_${this._vuecal.eventIdIncrement++}`,start:t,startTimeMinutes:o,end:m,endTimeMinutes:l,segments:null,...n};if(!(typeof this._vuecal.onEventCreate=="function"&&!this._vuecal.onEventCreate(d,()=>this.deleteAnEvent(d))))return d.startDateF!==d.endDateF&&(d.daysCount=pe.countDays(d.start,d.end)),this._vuecal.mutableEvents.push(d),this._vuecal.addEventsToView([d]),this._vuecal.emitWithEvent("event-create",d),this._vuecal.$emit("event-change",{event:this._vuecal.cleanupEvent(d),originalEvent:null}),d}addEventSegment(t){t.segments||(t.segments={},t.segments[pe.formatDateLite(t.start)]={start:t.start,startTimeMinutes:t.startTimeMinutes,endTimeMinutes:et,isFirstDay:!0,isLastDay:!1});const a=t.segments[pe.formatDateLite(t.end)];a&&(a.isLastDay=!1,a.endTimeMinutes=et);const n=pe.addDays(t.end,1),o=pe.formatDateLite(n);return n.setHours(0,0,0,0),t.segments[o]={start:n,startTimeMinutes:0,endTimeMinutes:t.endTimeMinutes,isFirstDay:!1,isLastDay:!0},t.end=pe.addMinutes(n,t.endTimeMinutes),t.daysCount=Object.keys(t.segments).length,o}removeEventSegment(t){let a=Object.keys(t.segments).length;if(a<=1)return pe.formatDateLite(t.end);delete t.segments[pe.formatDateLite(t.end)],a--;const n=pe.subtractDays(t.end,1),o=pe.formatDateLite(n),l=t.segments[o];return a?l&&(l.isLastDay=!0,l.endTimeMinutes=t.endTimeMinutes):t.segments=null,t.daysCount=a||1,t.end=n,o}createEventSegments(t,a,n){const o=a.getTime(),l=n.getTime();let m=t.start.getTime(),d=t.end.getTime(),c=!1,u,h,x;for(!t.end.getHours()&&!t.end.getMinutes()&&(d-=1e3),t.segments={},t.repeat?(u=o,h=Math.min(l,t.repeat.until?pe.stringToDate(t.repeat.until).getTime():l)):(u=Math.max(o,m),h=Math.min(l,d));u<=h;){let T=!1;const A=pe.addDays(new Date(u),1).setHours(0,0,0,0);let _,S,p,f;if(t.repeat){const k=new Date(u),M=pe.formatDateLite(k);(c||t.occurrences&&t.occurrences[M])&&(c||(m=t.occurrences[M].start,x=new Date(m).setHours(0,0,0,0),d=t.occurrences[M].end),c=!0,T=!0),_=u===x,S=M===pe.formatDateLite(new Date(d)),p=new Date(_?m:u),f=pe.formatDateLite(p),S&&(c=!1)}else T=!0,_=u===m,S=h===d&&A>h,p=_?t.start:new Date(u),f=pe.formatDateLite(_?t.start:p);T&&(t.segments[f]={start:p,startTimeMinutes:_?t.startTimeMinutes:0,endTimeMinutes:S?t.endTimeMinutes:et,isFirstDay:_,isLastDay:S}),u=A}return t}deleteAnEvent(t){this._vuecal.emitWithEvent("event-delete",t),this._vuecal.mutableEvents=this._vuecal.mutableEvents.filter(a=>a._eid!==t._eid),this._vuecal.view.events=this._vuecal.view.events.filter(a=>a._eid!==t._eid)}checkCellOverlappingEvents(t,a){tt=t.slice(0),he={},t.forEach(o=>{tt.shift(),he[o._eid]||(he[o._eid]={overlaps:[],start:o.start,position:0}),he[o._eid].position=0,tt.forEach(l=>{he[l._eid]||(he[l._eid]={overlaps:[],start:l.start,position:0});const m=this.eventInRange(l,o.start,o.end),d=a.overlapsPerTimeStep?pe.datesInSameTimeStep(o.start,l.start,a.timeStep):1;if(!o.background&&!o.allDay&&!l.background&&!l.allDay&&m&&d)he[o._eid].overlaps.push(l._eid),he[o._eid].overlaps=[...new Set(he[o._eid].overlaps)],he[l._eid].overlaps.push(o._eid),he[l._eid].overlaps=[...new Set(he[l._eid].overlaps)],he[l._eid].position++;else{let c,u;(c=(he[o._eid]||{overlaps:[]}).overlaps.indexOf(l._eid))>-1&&he[o._eid].overlaps.splice(c,1),(u=(he[l._eid]||{overlaps:[]}).overlaps.indexOf(o._eid))>-1&&he[l._eid].overlaps.splice(u,1),he[l._eid].position--}})});let n=0;for(const o in he){const l=he[o],m=l.overlaps.map(d=>({id:d,start:he[d].start}));m.push({id:o,start:l.start}),m.sort((d,c)=>d.start<c.start?-1:d.start>c.start?1:d.id>c.id?-1:1),l.position=m.findIndex(d=>d.id===o),n=Math.max(this.getOverlapsStreak(l,he),n)}return[he,n]}getOverlapsStreak(t,a={}){let n=t.overlaps.length+1,o=[];return t.overlaps.forEach(l=>{o.includes(l)||t.overlaps.filter(d=>d!==l).forEach(d=>{a[d].overlaps.includes(l)||o.push(d)})}),o=[...new Set(o)],n-=o.length,n}eventInRange(t,a,n){if(t.allDay||!this._vuecal.time){const m=new Date(t.start).setHours(0,0,0,0);return new Date(t.end).setHours(23,59,0,0)>=new Date(a).setHours(0,0,0,0)&&m<=new Date(n).setHours(0,0,0,0)}const o=t.start.getTime(),l=t.end.getTime();return o<n.getTime()&&l>a.getTime()}}const la={class:"vuecal__flex vuecal__weekdays-headings"},ia=["onClick"],oa={class:"vuecal__flex weekday-label",grow:""},na={class:"full"},ra={class:"small"},da={class:"xsmall"},ua={key:0},ca={key:0,class:"vuecal__flex vuecal__split-days-headers",grow:""};function ma(s,t,a,n,o,l){return i(),r("div",la,[(i(!0),r(X,null,ae(l.headings,(m,d)=>(i(),r(X,{key:d},[m.hide?D("",!0):(i(),r("div",{key:0,class:te(["vuecal__flex vuecal__heading",{today:m.today,clickable:l.cellHeadingsClickable}]),style:_e(l.weekdayCellStyles),onClick:c=>l.view.id==="week"&&l.selectCell(m.date,c),onDblclick:t[0]||(t[0]=c=>l.view.id==="week"&&l.vuecal.dblclickToNavigate&&a.switchToNarrowerView())},[v(Ke,{name:`slide-fade--${a.transitionDirection}`,appear:l.vuecal.transitions},{default:B(()=>[(i(),r("div",{class:"vuecal__flex",column:"",key:l.vuecal.transitions?`${d}-${m.dayOfMonth}`:!1},[e("div",oa,[oe(s.$slots,"weekday-heading",{heading:l.cleanupHeading(m),view:l.view},()=>[e("span",na,g(m.full),1),e("span",ra,g(m.small),1),e("span",da,g(m.xsmall),1),m.dayOfMonth?(i(),r("span",ua,"Â "+g(m.dayOfMonth),1)):D("",!0)])]),l.vuecal.hasSplits&&l.vuecal.stickySplitLabels?(i(),r("div",ca,[(i(!0),r(X,null,ae(l.vuecal.daySplits,(c,u)=>(i(),r("div",{class:te(["day-split-header",c.class||!1]),key:u},[oe(s.$slots,"split-label",{split:c,view:l.view},()=>[q(g(c.label),1)])],2))),128))])):D("",!0)]))]),_:2},1032,["name","appear"])],46,ia))],64))),128))])}const Pe=(s,t)=>{const a=s.__vccOpts||s;for(const[n,o]of t)a[n]=o;return a},va={inject:["vuecal","utils","view"],props:{transitionDirection:{type:String,default:"right"},weekDays:{type:Array,default:()=>[]},switchToNarrowerView:{type:Function,default:()=>{}}},methods:{selectCell(s,t){s.getTime()!==this.view.selectedDate.getTime()&&(this.view.selectedDate=s),this.utils.cell.selectCell(!1,s,t)},cleanupHeading:s=>({label:s.full,date:s.date,...s.today?{today:s.today}:{}})},computed:{headings(){if(!["month","week"].includes(this.view.id))return[];let s=!1;return this.weekDays.map((a,n)=>{const o=this.utils.date.addDays(this.view.startDate,this.vuecal.startWeekOnSunday&&this.vuecal.hideWeekends?n-1:n);return{hide:a.hide,full:a.label,small:a.short||a.label.substr(0,3),xsmall:a.short||a.label.substr(0,1),...this.view.id==="week"?{dayOfMonth:o.getDate(),date:o,today:!s&&this.utils.date.isToday(o)&&!s++}:{}}})},cellWidth(){return 100/(7-this.weekDays.reduce((s,t)=>s+t.hide,0))},weekdayCellStyles(){return{...this.vuecal.hideWeekdays.length?{width:`${this.cellWidth}%`}:{}}},cellHeadingsClickable(){return this.view.id==="week"&&(this.vuecal.clickToNavigate||this.vuecal.dblclickToNavigate)}}},St=Pe(va,[["render",ma]]),pa={class:"vuecal__header"},ha={key:0,class:"vuecal__flex vuecal__menu",role:"tablist","aria-label":"Calendar views navigation"},ga=["onDragenter","onDragleave","onClick","aria-label"],fa={key:1,class:"vuecal__title-bar"},ya=["aria-label"],ba={class:"vuecal__flex vuecal__title",grow:""},_a=["aria-label"],wa={key:0,class:"vuecal__flex vuecal__split-days-headers"};function xa(s,t,a,n,o,l){const m=Se("weekdays-headings");return i(),r("div",pa,[a.options.hideViewSelector?D("",!0):(i(),r("div",ha,[(i(!0),r(X,null,ae(a.viewProps.views,(d,c)=>(i(),r(X,{key:c},[d.enabled?(i(),r("button",{key:0,class:te(["vuecal__view-btn",{"vuecal__view-btn--active":l.view.id===c,"vuecal__view-btn--highlighted":s.highlightedControl===c}]),type:"button",onDragenter:u=>a.editEvents.drag&&l.dnd&&l.dnd.viewSelectorDragEnter(u,c,s.$data),onDragleave:u=>a.editEvents.drag&&l.dnd&&l.dnd.viewSelectorDragLeave(u,c,s.$data),onClick:u=>l.switchView(c,null,!0),"aria-label":`${d.label} view`},g(d.label),43,ga)):D("",!0)],64))),128))])),a.options.hideTitleBar?D("",!0):(i(),r("div",fa,[e("button",{class:te(["vuecal__arrow vuecal__arrow--prev",{"vuecal__arrow--highlighted":s.highlightedControl==="previous"}]),type:"button",onClick:t[0]||(t[0]=(...d)=>l.previous&&l.previous(...d)),onDragenter:t[1]||(t[1]=d=>a.editEvents.drag&&l.dnd&&l.dnd.viewSelectorDragEnter(d,"previous",s.$data)),onDragleave:t[2]||(t[2]=d=>a.editEvents.drag&&l.dnd&&l.dnd.viewSelectorDragLeave(d,"previous",s.$data)),"aria-label":`Previous ${l.view.id}`},[oe(s.$slots,"arrow-prev")],42,ya),e("div",ba,[v(Ke,{name:a.options.transitions?`slide-fade--${l.transitionDirection}`:""},{default:B(()=>[(i(),Q(kt(l.broaderView?"button":"span"),{type:!!l.broaderView&&"button",key:`${l.view.id}${l.view.startDate.toString()}`,onClick:t[3]||(t[3]=d=>!!l.broaderView&&l.switchToBroaderView()),"aria-label":!!l.broaderView&&`Go to ${l.broaderView} view`},{default:B(()=>[oe(s.$slots,"title")]),_:3},8,["type","aria-label"]))]),_:3},8,["name"])]),a.options.todayButton?(i(),r("button",{key:0,class:te(["vuecal__today-btn",{"vuecal__today-btn--highlighted":s.highlightedControl==="today"}]),type:"button",onClick:t[4]||(t[4]=(...d)=>l.goToToday&&l.goToToday(...d)),onDragenter:t[5]||(t[5]=d=>a.editEvents.drag&&l.dnd&&l.dnd.viewSelectorDragEnter(d,"today",s.$data)),onDragleave:t[6]||(t[6]=d=>a.editEvents.drag&&l.dnd&&l.dnd.viewSelectorDragLeave(d,"today",s.$data)),"aria-label":"Today"},[oe(s.$slots,"today-button")],34)):D("",!0),e("button",{class:te(["vuecal__arrow vuecal__arrow--next",{"vuecal__arrow--highlighted":s.highlightedControl==="next"}]),type:"button",onClick:t[7]||(t[7]=(...d)=>l.next&&l.next(...d)),onDragenter:t[8]||(t[8]=d=>a.editEvents.drag&&l.dnd&&l.dnd.viewSelectorDragEnter(d,"next",s.$data)),onDragleave:t[9]||(t[9]=d=>a.editEvents.drag&&l.dnd&&l.dnd.viewSelectorDragLeave(d,"next",s.$data)),"aria-label":`Next ${l.view.id}`},[oe(s.$slots,"arrow-next")],42,_a)])),a.viewProps.weekDaysInHeader?(i(),Q(m,{key:2,"week-days":a.weekDays,"transition-direction":l.transitionDirection,"switch-to-narrower-view":a.switchToNarrowerView},st({_:2},[s.$slots["weekday-heading"]?{name:"weekday-heading",fn:B(({heading:d,view:c})=>[oe(s.$slots,"weekday-heading",{heading:d,view:c})]),key:"0"}:void 0,s.$slots["split-label"]?{name:"split-label",fn:B(({split:d})=>[oe(s.$slots,"split-label",{split:d,view:l.view})]),key:"1"}:void 0]),1032,["week-days","transition-direction","switch-to-narrower-view"])):D("",!0),v(Ke,{name:`slide-fade--${l.transitionDirection}`},{default:B(()=>[l.showDaySplits?(i(),r("div",wa,[(i(!0),r(X,null,ae(a.daySplits,(d,c)=>(i(),r("div",{class:te(["day-split-header",d.class||!1]),key:c},[oe(s.$slots,"split-label",{split:d,view:l.view.id},()=>[q(g(d.label),1)])],2))),128))])):D("",!0)]),_:3},8,["name"])])}const ka={inject:["vuecal","previous","next","switchView","updateSelectedDate","modules","view"],components:{WeekdaysHeadings:St},props:{options:{type:Object,default:()=>({})},editEvents:{type:Object,required:!0},hasSplits:{type:[Boolean,Number],default:!1},daySplits:{type:Array,default:()=>[]},viewProps:{type:Object,default:()=>({})},weekDays:{type:Array,default:()=>[]},switchToNarrowerView:{type:Function,default:()=>{}}},data:()=>({highlightedControl:null}),methods:{goToToday(){this.updateSelectedDate(new Date(new Date().setHours(0,0,0,0)))},switchToBroaderView(){this.transitionDirection="left",this.broaderView&&this.switchView(this.broaderView)}},computed:{transitionDirection:{get(){return this.vuecal.transitionDirection},set(s){this.vuecal.transitionDirection=s}},broaderView(){const{enabledViews:s}=this.vuecal;return s[s.indexOf(this.view.id)-1]},showDaySplits(){return this.view.id==="day"&&this.hasSplits&&this.options.stickySplitLabels&&!this.options.minSplitWidth},dnd(){return this.modules.dnd}}},Da=Pe(ka,[["render",xa]]),Ca=["draggable"];function $a(s,t,a,n,o,l){return i(),r("div",{class:te(["vuecal__event",l.eventClasses]),style:_e(l.eventStyles),tabindex:"0",onFocus:t[4]||(t[4]=(...m)=>l.focusEvent&&l.focusEvent(...m)),onKeypress:t[5]||(t[5]=Le(Ce((...m)=>l.onEnterKeypress&&l.onEnterKeypress(...m),["stop"]),["enter"])),onMouseenter:t[6]||(t[6]=(...m)=>l.onMouseEnter&&l.onMouseEnter(...m)),onMouseleave:t[7]||(t[7]=(...m)=>l.onMouseLeave&&l.onMouseLeave(...m)),onTouchstart:t[8]||(t[8]=Ce((...m)=>l.onTouchStart&&l.onTouchStart(...m),["stop"])),onMousedown:t[9]||(t[9]=m=>l.onMouseDown(m)),onMouseup:t[10]||(t[10]=(...m)=>l.onMouseUp&&l.onMouseUp(...m)),onTouchend:t[11]||(t[11]=(...m)=>l.onMouseUp&&l.onMouseUp(...m)),onTouchmove:t[12]||(t[12]=(...m)=>l.onTouchMove&&l.onTouchMove(...m)),onDblclick:t[13]||(t[13]=(...m)=>l.onDblClick&&l.onDblClick(...m)),draggable:l.draggable,onDragstart:t[14]||(t[14]=m=>l.draggable&&l.onDragStart(m)),onDragend:t[15]||(t[15]=m=>l.draggable&&l.onDragEnd())},[l.vuecal.editEvents.delete&&a.event.deletable?(i(),r("div",{key:0,class:"vuecal__event-delete",onClick:t[0]||(t[0]=Ce((...m)=>l.deleteEvent&&l.deleteEvent(...m),["stop"])),onTouchstart:t[1]||(t[1]=Ce((...m)=>l.touchDeleteEvent&&l.touchDeleteEvent(...m),["stop"]))},g(l.vuecal.texts.deleteEvent),33)):D("",!0),oe(s.$slots,"event",{event:a.event,view:l.view.id}),l.resizable?(i(),r("div",{key:1,class:"vuecal__event-resize-handle",contenteditable:"false",onMousedown:t[2]||(t[2]=Ce((...m)=>l.onResizeHandleMouseDown&&l.onResizeHandleMouseDown(...m),["stop","prevent"])),onTouchstart:t[3]||(t[3]=Ce((...m)=>l.onResizeHandleMouseDown&&l.onResizeHandleMouseDown(...m),["stop","prevent"]))},null,32)):D("",!0)],46,Ca)}const ja={inject:["vuecal","utils","modules","view","domEvents","editEvents"],props:{cellFormattedDate:{type:String,default:""},event:{type:Object,default:()=>({})},cellEvents:{type:Array,default:()=>[]},overlaps:{type:Array,default:()=>[]},eventPosition:{type:Number,default:0},overlapsStreak:{type:Number,default:0},allDay:{type:Boolean,default:!1}},data:()=>({touch:{dragThreshold:30,startX:0,startY:0,dragged:!1}}),methods:{onMouseDown(s,t=!1){if("ontouchstart"in window&&!t)return!1;const{clickHoldAnEvent:a,focusAnEvent:n,resizeAnEvent:o,dragAnEvent:l}=this.domEvents;if(n._eid===this.event._eid&&a._eid===this.event._eid)return!0;this.focusEvent(),a._eid=null,this.vuecal.editEvents.delete&&this.event.deletable&&(a.timeoutId=setTimeout(()=>{!o._eid&&!l._eid&&(a._eid=this.event._eid,this.event.deleting=!0)},a.timeout))},onMouseUp(s){this.domEvents.focusAnEvent._eid===this.event._eid&&!this.touch.dragged&&(this.domEvents.focusAnEvent.mousedUp=!0),this.touch.dragged=!1},onMouseEnter(s){s.preventDefault(),this.vuecal.emitWithEvent("event-mouse-enter",this.event)},onMouseLeave(s){s.preventDefault(),this.vuecal.emitWithEvent("event-mouse-leave",this.event)},onTouchMove(s){if(typeof this.vuecal.onEventClick!="function")return;const{clientX:t,clientY:a}=s.touches[0],{startX:n,startY:o,dragThreshold:l}=this.touch;(Math.abs(t-n)>l||Math.abs(a-o)>l)&&(this.touch.dragged=!0)},onTouchStart(s){this.touch.startX=s.touches[0].clientX,this.touch.startY=s.touches[0].clientY,this.onMouseDown(s,!0)},onEnterKeypress(s){if(typeof this.vuecal.onEventClick=="function")return this.vuecal.onEventClick(this.event,s)},onDblClick(s){if(typeof this.vuecal.onEventDblclick=="function")return this.vuecal.onEventDblclick(this.event,s)},onDragStart(s){this.dnd&&this.dnd.eventDragStart(s,this.event)},onDragEnd(){this.dnd&&this.dnd.eventDragEnd(this.event)},onResizeHandleMouseDown(){this.focusEvent(),this.domEvents.dragAnEvent._eid=null,this.domEvents.resizeAnEvent=Object.assign(this.domEvents.resizeAnEvent,{_eid:this.event._eid,start:(this.segment||this.event).start,split:this.event.split||null,segment:!!this.segment&&this.utils.date.formatDateLite(this.segment.start),originalEnd:new Date((this.segment||this.event).end),originalEndTimeMinutes:this.event.endTimeMinutes}),this.event.resizing=!0},deleteEvent(s=!1){if("ontouchstart"in window&&!s)return!1;this.utils.event.deleteAnEvent(this.event)},touchDeleteEvent(s){this.deleteEvent(!0)},cancelDeleteEvent(){this.event.deleting=!1},focusEvent(){const{focusAnEvent:s}=this.domEvents,t=s._eid;if(t!==this.event._eid){if(t){const a=this.view.events.find(n=>n._eid===t);a&&(a.focused=!1)}this.vuecal.cancelDelete(),this.vuecal.emitWithEvent("event-focus",this.event),s._eid=this.event._eid,this.event.focused=!0}}},computed:{eventDimensions(){const{startTimeMinutes:s,endTimeMinutes:t}=this.segment||this.event;let a=s-this.vuecal.timeFrom;const n=Math.max(Math.round(a*this.vuecal.timeCellHeight/this.vuecal.timeStep),0);a=Math.min(t,this.vuecal.timeTo)-this.vuecal.timeFrom;const o=Math.round(a*this.vuecal.timeCellHeight/this.vuecal.timeStep),l=Math.max(o-n,5);return{top:n,height:l}},eventStyles(){if(this.event.allDay||!this.vuecal.time||!this.event.endTimeMinutes||this.view.id==="month"||this.allDay)return{};let s=100/Math.min(this.overlaps.length+1,this.overlapsStreak),t=100/(this.overlaps.length+1)*this.eventPosition;this.vuecal.minEventWidth&&s<this.vuecal.minEventWidth&&(s=this.vuecal.minEventWidth,t=(100-this.vuecal.minEventWidth)/this.overlaps.length*this.eventPosition);const{top:a,height:n}=this.eventDimensions;return{top:`${a}px`,height:`${n}px`,width:`${s}%`,left:this.event.left&&`${this.event.left}px`||`${t}%`}},eventClasses(){const{isFirstDay:s,isLastDay:t}=this.segment||{};return{[this.event.class]:!!this.event.class,"vuecal__event--focus":this.event.focused,"vuecal__event--resizing":this.event.resizing,"vuecal__event--background":this.event.background,"vuecal__event--deletable":this.event.deleting,"vuecal__event--all-day":this.event.allDay,"vuecal__event--dragging":!this.event.draggingStatic&&this.event.dragging,"vuecal__event--static":this.event.dragging&&this.event.draggingStatic,"vuecal__event--multiple-days":!!this.segment,"event-start":this.segment&&s&&!t,"event-middle":this.segment&&!s&&!t,"event-end":this.segment&&t&&!s}},segment(){return this.event.segments&&this.event.segments[this.cellFormattedDate]||null},draggable(){const{draggable:s,background:t,daysCount:a}=this.event;return this.vuecal.editEvents.drag&&s&&!t&&a===1},resizable(){const{editEvents:s,time:t}=this.vuecal;return s.resize&&this.event.resizable&&t&&!this.allDay&&(!this.segment||this.segment&&this.segment.isLastDay)&&this.view.id!=="month"},dnd(){return this.modules.dnd}}},Ta=Pe(ja,[["render",$a]]),Ea=["data-split","aria-label","onTouchstart","onMousedown","onDragover","onDrop"],Ma={key:0,class:"cell-time-labels"},Sa=["innerHTML"],Va={key:2,class:"vuecal__cell-events"},Aa=["title"];function Ia(s,t,a,n,o,l){const m=Se("event");return i(),Q(cs,{class:te(["vuecal__cell",l.cellClasses]),name:`slide-fade--${l.transitionDirection}`,tag:"div",appear:a.options.transitions,style:_e(l.cellStyles)},{default:B(()=>[(i(!0),r(X,null,ae(l.splitsCount?l.splits:1,(d,c)=>(i(),r("div",{class:te(["vuecal__flex vuecal__cell-content",l.splitsCount&&l.splitClasses(d)]),key:a.options.transitions?`${l.view.id}-${a.data.content}-${c}`:c,"data-split":l.splitsCount?d.id:!1,column:"",tabindex:"0","aria-label":a.data.content,onFocus:t[0]||(t[0]=u=>l.onCellFocus(u)),onKeypress:t[1]||(t[1]=Le(u=>l.onCellkeyPressEnter(u),["enter"])),onTouchstart:u=>!l.isDisabled&&l.onCellTouchStart(u,l.splitsCount?d.id:null),onMousedown:u=>!l.isDisabled&&l.onCellMouseDown(u,l.splitsCount?d.id:null),onClick:t[2]||(t[2]=u=>!l.isDisabled&&l.onCellClick(u)),onDblclick:t[3]||(t[3]=u=>!l.isDisabled&&l.onCellDblClick(u)),onContextmenu:t[4]||(t[4]=u=>!l.isDisabled&&a.options.cellContextmenu&&l.onCellContextMenu(u)),onDragenter:t[5]||(t[5]=u=>!l.isDisabled&&a.editEvents.drag&&l.dnd&&l.dnd.cellDragEnter(u,s.$data,a.data.startDate)),onDragover:u=>!l.isDisabled&&a.editEvents.drag&&l.dnd&&l.dnd.cellDragOver(u,s.$data,a.data.startDate,l.splitsCount?d.id:null),onDragleave:t[6]||(t[6]=u=>!l.isDisabled&&a.editEvents.drag&&l.dnd&&l.dnd.cellDragLeave(u,s.$data,a.data.startDate)),onDrop:u=>!l.isDisabled&&a.editEvents.drag&&l.dnd&&l.dnd.cellDragDrop(u,s.$data,a.data.startDate,l.splitsCount?d.id:null)},[a.options.showTimeInCells&&a.options.time&&l.isWeekOrDayView&&!a.allDay?(i(),r("div",Ma,[(i(!0),r(X,null,ae(l.vuecal.timeCells,(u,h)=>(i(),r("span",{class:"cell-time-label",key:h},g(u.label),1))),128))])):D("",!0),l.isWeekOrDayView&&!a.allDay&&l.specialHours.length?(i(!0),r(X,{key:1},ae(l.specialHours,(u,h)=>(i(),r("div",{class:te(["vuecal__special-hours",`vuecal__special-hours--day${u.day} ${u.class}`]),style:_e(`height: ${u.height}px;top: ${u.top}px`)},[u.label?(i(),r("div",{key:0,class:"special-hours-label",innerHTML:u.label},null,8,Sa)):D("",!0)],6))),256)):D("",!0),oe(s.$slots,"cell-content",{events:l.events,selectCell:u=>l.selectCell(u,!0),split:l.splitsCount?d:!1}),l.eventsCount&&(l.isWeekOrDayView||l.view.id==="month"&&a.options.eventsOnMonthView)?(i(),r("div",Va,[(i(!0),r(X,null,ae(l.splitsCount?d.events:l.events,(u,h)=>(i(),Q(m,{key:h,"cell-formatted-date":a.data.formattedDate,event:u,"all-day":a.allDay,"cell-events":l.splitsCount?d.events:l.events,overlaps:((l.splitsCount?d.overlaps[u._eid]:s.cellOverlaps[u._eid])||[]).overlaps,"event-position":((l.splitsCount?d.overlaps[u._eid]:s.cellOverlaps[u._eid])||[]).position,"overlaps-streak":l.splitsCount?d.overlapsStreak:s.cellOverlapsStreak},{event:B(({event:x,view:T})=>[oe(s.$slots,"event",{view:T,event:x})]),_:2},1032,["cell-formatted-date","event","all-day","cell-events","overlaps","event-position","overlaps-streak"]))),128))])):D("",!0)],42,Ea))),128)),l.timelineVisible?(i(),r("div",{class:"vuecal__now-line",style:_e(`top: ${l.todaysTimePosition}px`),key:a.options.transitions?`${l.view.id}-now-line`:"now-line",title:l.utils.date.formatTime(l.vuecal.now)},null,12,Aa)):D("",!0)]),_:3},8,["class","name","appear","style"])}const La={inject:["vuecal","utils","modules","view","domEvents"],components:{Event:Ta},props:{options:{type:Object,default:()=>({})},editEvents:{type:Object,required:!0},data:{type:Object,required:!0},cellSplits:{type:Array,default:()=>[]},minTimestamp:{type:[Number,null],default:null},maxTimestamp:{type:[Number,null],default:null},cellWidth:{type:[Number,Boolean],default:!1},allDay:{type:Boolean,default:!1}},data:()=>({cellOverlaps:{},cellOverlapsStreak:1,timeAtCursor:null,highlighted:!1,highlightedSplit:null}),methods:{getSplitAtCursor({target:s}){let a=s.classList.contains("vuecal__cell-split")?s:this.vuecal.findAncestor(s,"vuecal__cell-split");return a&&(a=a.attributes["data-split"].value,parseInt(a).toString()===a.toString()&&(a=parseInt(a))),a||null},splitClasses(s){return{"vuecal__cell-split":!0,"vuecal__cell-split--highlighted":this.highlightedSplit===s.id,[s.class]:!!s.class}},checkCellOverlappingEvents(){this.options.time&&this.eventsCount&&!this.splitsCount&&(this.eventsCount===1?(this.cellOverlaps=[],this.cellOverlapsStreak=1):[this.cellOverlaps,this.cellOverlapsStreak]=this.utils.event.checkCellOverlappingEvents(this.events,this.options))},isDOMElementAnEvent(s){return this.vuecal.isDOMElementAnEvent(s)},selectCell(s,t=!1){const a=this.splitsCount?this.getSplitAtCursor(s):null;this.utils.cell.selectCell(t,this.timeAtCursor,a),this.timeAtCursor=null},onCellkeyPressEnter(s){this.isSelected||this.onCellFocus(s);const t=this.splitsCount?this.getSplitAtCursor(s):null;this.utils.cell.keyPressEnterCell(this.timeAtCursor,t),this.timeAtCursor=null},onCellFocus(s){if(!this.isSelected&&!this.isDisabled){this.isSelected=this.data.startDate;const t=this.splitsCount?this.getSplitAtCursor(s):null,a=this.timeAtCursor||this.data.startDate;this.vuecal.$emit("cell-focus",t?{date:a,split:t}:a)}},onCellMouseDown(s,t=null,a=!1){if("ontouchstart"in window&&!a)return!1;this.isSelected||this.onCellFocus(s);const{clickHoldACell:n,focusAnEvent:o}=this.domEvents;this.domEvents.cancelClickEventCreation=!1,n.eventCreated=!1,this.timeAtCursor=new Date(this.data.startDate);const{minutes:l,cursorCoords:{y:m}}=this.vuecal.minutesAtCursor(s);this.timeAtCursor.setMinutes(l);const d=this.isDOMElementAnEvent(s.target);!d&&o._eid&&((this.view.events.find(c=>c._eid===o._eid)||{}).focused=!1),this.editEvents.create&&!d&&this.setUpEventCreation(s,m)},setUpEventCreation(s,t){if(this.options.dragToCreateEvent&&["week","day"].includes(this.view.id)){const{dragCreateAnEvent:a}=this.domEvents;if(a.startCursorY=t,a.split=this.splitsCount?this.getSplitAtCursor(s):null,a.start=this.timeAtCursor,this.options.snapToTime){let n=this.timeAtCursor.getHours()*60+this.timeAtCursor.getMinutes();const o=n+this.options.snapToTime/2;n=o-o%this.options.snapToTime,a.start.setHours(0,n,0,0)}}else this.options.cellClickHold&&["month","week","day"].includes(this.view.id)&&this.setUpCellHoldTimer(s)},setUpCellHoldTimer(s){const{clickHoldACell:t}=this.domEvents;t.cellId=`${this.vuecal._.uid}_${this.data.formattedDate}`,t.split=this.splitsCount?this.getSplitAtCursor(s):null,t.timeoutId=setTimeout(()=>{if(t.cellId&&!this.domEvents.cancelClickEventCreation){const{_eid:a}=this.utils.event.createAnEvent(this.timeAtCursor,null,t.split?{split:t.split}:{});t.eventCreated=a}},t.timeout)},onCellTouchStart(s,t=null){this.onCellMouseDown(s,t,!0)},onCellClick(s){this.isDOMElementAnEvent(s.target)||this.selectCell(s)},onCellDblClick(s){const t=new Date(this.data.startDate);t.setMinutes(this.vuecal.minutesAtCursor(s).minutes);const a=this.splitsCount?this.getSplitAtCursor(s):null;this.vuecal.$emit("cell-dblclick",a?{date:t,split:a}:t),this.options.dblclickToNavigate&&this.vuecal.switchToNarrowerView()},onCellContextMenu(s){s.stopPropagation(),s.preventDefault();const t=new Date(this.data.startDate),{cursorCoords:a,minutes:n}=this.vuecal.minutesAtCursor(s);t.setMinutes(n);const o=this.splitsCount?this.getSplitAtCursor(s):null;this.vuecal.$emit("cell-contextmenu",{date:t,...a,...o||{},e:s})}},computed:{dnd(){return this.modules.dnd},nowInMinutes(){return this.utils.date.dateToMinutes(this.vuecal.now)},isBeforeMinDate(){return this.minTimestamp!==null&&this.minTimestamp>this.data.endDate.getTime()},isAfterMaxDate(){return this.maxTimestamp&&this.maxTimestamp<this.data.startDate.getTime()},isDisabled(){const{disableDays:s}=this.options,{isYearsOrYearView:t}=this.vuecal;return s.length&&s.includes(this.data.formattedDate)&&!t?!0:this.isBeforeMinDate||this.isAfterMaxDate},isSelected:{get(){let s=!1;const{selectedDate:t}=this.view;return this.view.id==="years"?s=t.getFullYear()===this.data.startDate.getFullYear():this.view.id==="year"?s=t.getFullYear()===this.data.startDate.getFullYear()&&t.getMonth()===this.data.startDate.getMonth():s=t.getTime()===this.data.startDate.getTime(),s},set(s){this.view.selectedDate=s,this.vuecal.$emit("update:selected-date",this.view.selectedDate)}},isWeekOrDayView(){return["week","day"].includes(this.view.id)},transitionDirection(){return this.vuecal.transitionDirection},specialHours(){return this.data.specialHours.map(s=>{let{from:t,to:a}=s;return t=Math.max(t,this.options.timeFrom),a=Math.min(a,this.options.timeTo),{...s,height:(a-t)*this.timeScale,top:(t-this.options.timeFrom)*this.timeScale}})},events(){const{startDate:s,endDate:t}=this.data;let a=[];if(!(["years","year"].includes(this.view.id)&&!this.options.eventsCountOnYearView)){if(a=this.view.events.slice(0),this.view.id==="month"&&a.push(...this.view.outOfScopeEvents),a=a.filter(n=>this.utils.event.eventInRange(n,s,t)),this.options.showAllDayEvents&&this.view.id!=="month"&&(a=a.filter(n=>!!n.allDay===this.allDay)),this.options.time&&this.isWeekOrDayView&&!this.allDay){const{timeFrom:n,timeTo:o}=this.options;a=a.filter(l=>{const m=l.daysCount>1&&l.segments[this.data.formattedDate]||{},d=l.daysCount===1&&l.startTimeMinutes<o&&l.endTimeMinutes>n,c=l.daysCount>1&&m.startTimeMinutes<o&&m.endTimeMinutes>n;return l.allDay||d||c||!1})}this.options.time&&this.isWeekOrDayView&&!(this.options.showAllDayEvents&&this.allDay)&&a.sort((n,o)=>n.start<o.start?-1:1),this.cellSplits.length||this.$nextTick(this.checkCellOverlappingEvents)}return a},eventsCount(){return this.events.length},splits(){return this.cellSplits.map((s,t)=>{const a=this.events.filter(l=>l.split===s.id),[n,o]=this.utils.event.checkCellOverlappingEvents(a.filter(l=>!l.background&&!l.allDay),this.options);return{...s,overlaps:n,overlapsStreak:o,events:a}})},splitsCount(){return this.splits.length},cellClasses(){return{[this.data.class]:!!this.data.class,"vuecal__cell--current":this.data.current,"vuecal__cell--today":this.data.today,"vuecal__cell--out-of-scope":this.data.outOfScope,"vuecal__cell--before-min":this.isDisabled&&this.isBeforeMinDate,"vuecal__cell--after-max":this.isDisabled&&this.isAfterMaxDate,"vuecal__cell--disabled":this.isDisabled,"vuecal__cell--selected":this.isSelected,"vuecal__cell--highlighted":this.highlighted,"vuecal__cell--has-splits":this.splitsCount,"vuecal__cell--has-events":this.eventsCount}},cellStyles(){return{...this.cellWidth?{width:`${this.cellWidth}%`}:{}}},timelineVisible(){const{time:s,timeTo:t}=this.options;return this.data.today&&this.isWeekOrDayView&&s&&!this.allDay&&this.nowInMinutes<=t},todaysTimePosition(){if(!this.data.today||!this.options.time)return;const s=this.nowInMinutes-this.options.timeFrom;return Math.round(s*this.timeScale)},timeScale(){return this.options.timeCellHeight/this.options.timeStep}}},Vt=Pe(La,[["render",Ia]]),Oa={key:0,class:"vuecal__all-day-text",style:{width:"3em"}};function Ua(s,t,a,n,o,l){const m=Se("vuecal-cell");return i(),r("div",{class:"vuecal__flex vuecal__all-day",style:_e(a.cellOrSplitMinWidth&&{height:a.height})},[a.cellOrSplitMinWidth?D("",!0):(i(),r("div",Oa,[e("span",null,g(a.label),1)])),e("div",{class:te(["vuecal__flex vuecal__cells",`${l.view.id}-view`]),grow:"",style:_e(a.cellOrSplitMinWidth?`min-width: ${a.cellOrSplitMinWidth}px`:"")},[(i(!0),r(X,null,ae(a.cells,(d,c)=>(i(),Q(m,{key:c,options:a.options,"edit-events":l.editEvents,data:d,"all-day":!0,"cell-width":a.options.hideWeekdays.length&&(l.vuecal.isWeekView||l.vuecal.isMonthView)&&l.vuecal.cellWidth,"min-timestamp":a.options.minTimestamp,"max-timestamp":a.options.maxTimestamp,"cell-splits":a.daySplits},{event:B(({event:u,view:h})=>[oe(s.$slots,"event",{view:h,event:u})]),_:2},1032,["options","edit-events","data","cell-width","min-timestamp","max-timestamp","cell-splits"]))),128))],6)],4)}const Pa={inject:["vuecal","view","editEvents"],components:{"vuecal-cell":Vt},props:{options:{type:Object,required:!0},cells:{type:Array,required:!0},label:{type:String,required:!0},daySplits:{type:Array,default:()=>[]},shortEvents:{type:Boolean,default:!0},height:{type:String,default:""},cellOrSplitMinWidth:{type:Number,default:null}},computed:{hasCellOrSplitWidth(){return!!(this.options.minCellWidth||this.daySplits.length&&this.options.minSplitWidth)}}},Na=Pe(Pa,[["render",Ua]]),Ra=["lang"],Fa={class:"default"},Ba={key:0,class:"vuecal__flex vuecal__body",grow:""},Ha=["onBlur","innerHTML"],Wa=["innerHTML"],Ya=["innerHTML"],za={class:"vuecal__flex",row:"",grow:""},qa={key:0,class:"vuecal__time-column"},Za={class:"vuecal__time-cell-label"},Ga={key:1,class:"vuecal__flex vuecal__week-numbers",column:""},Ka=["wrap","column"],Ja=["onBlur","innerHTML"],Xa=["innerHTML"],Qa=["innerHTML"],el=["wrap"],tl=["innerHTML"],sl=["innerHTML"],al={key:2,class:"vuecal__cell-events-count"},ll={key:3,class:"vuecal__no-event"},il=["onBlur","innerHTML"],ol=["innerHTML"],nl={key:2,class:"vuecal__event-time"},rl={key:0},dl={key:1,class:"days-to-end"},ul=["innerHTML"],cl={key:0,class:"vuecal__scrollbar-check"};function ml(s,t,a,n,o,l){const m=Se("vuecal-header"),d=Se("all-day-bar"),c=Se("weekdays-headings"),u=Se("vuecal-cell");return i(),r("div",{class:te(["vuecal__flex vuecal",l.cssClasses]),column:"",ref:"vuecal",lang:a.locale},[v(m,{options:s.$props,"edit-events":l.editEvents,"view-props":{views:l.views,weekDaysInHeader:l.weekDaysInHeader},"week-days":l.weekDays,"has-splits":l.hasSplits,"day-splits":l.daySplits,"switch-to-narrower-view":l.switchToNarrowerView},st({"arrow-prev":B(()=>[oe(s.$slots,"arrow-prev",{},()=>[t[0]||(t[0]=q("Â ")),t[1]||(t[1]=e("i",{class:"angle"},null,-1)),t[2]||(t[2]=q("Â "))])]),"arrow-next":B(()=>[oe(s.$slots,"arrow-next",{},()=>[t[3]||(t[3]=q("Â ")),t[4]||(t[4]=e("i",{class:"angle"},null,-1)),t[5]||(t[5]=q("Â "))])]),"today-button":B(()=>[oe(s.$slots,"today-button",{},()=>[e("span",Fa,g(o.texts.today),1)])]),title:B(()=>[oe(s.$slots,"title",{title:l.viewTitle,view:o.view},()=>[q(g(l.viewTitle),1)])]),_:2},[s.$slots["weekday-heading"]?{name:"weekday-heading",fn:B(({heading:h,view:x})=>[oe(s.$slots,"weekday-heading",{heading:h,view:x})]),key:"0"}:void 0,s.$slots["split-label"]?{name:"split-label",fn:B(({split:h})=>[oe(s.$slots,"split-label",{split:h,view:o.view.id})]),key:"1"}:void 0]),1032,["options","edit-events","view-props","week-days","has-splits","day-splits","switch-to-narrower-view"]),a.hideBody?D("",!0):(i(),r("div",Ba,[v(Ke,{name:`slide-fade--${o.transitionDirection}`,appear:a.transitions},{default:B(()=>[(i(),r("div",{class:"vuecal__flex",style:{"min-width":"100%"},key:a.transitions?o.view.id:!1,column:""},[a.showAllDayEvents&&l.hasTimeColumn&&(!l.cellOrSplitMinWidth||l.isDayView&&!a.minSplitWidth)?(i(),Q(d,ht(gt({key:0},l.allDayBar)),{event:B(({event:h,view:x})=>[oe(s.$slots,"event",{view:x,event:h},()=>[l.editEvents.title&&h.titleEditable?(i(),r("div",{key:0,class:"vuecal__event-title vuecal__event-title--edit",contenteditable:"",onBlur:T=>l.onEventTitleBlur(T,h),innerHTML:h.title},null,40,Ha)):h.title?(i(),r("div",{key:1,class:"vuecal__event-title",innerHTML:h.title},null,8,Wa)):D("",!0),h.content&&!l.hasShortEvents&&!l.isShortMonthView?(i(),r("div",{key:2,class:"vuecal__event-content",innerHTML:h.content},null,8,Ya)):D("",!0)])]),_:3},16)):D("",!0),e("div",{class:te(["vuecal__bg",{vuecal__flex:!l.hasTimeColumn}]),column:""},[e("div",za,[l.hasTimeColumn?(i(),r("div",qa,[a.showAllDayEvents&&l.cellOrSplitMinWidth&&!(l.isDayView&&!a.minSplitWidth)?(i(),r("div",{key:0,class:"vuecal__all-day-text",style:_e({height:l.allDayBar.height})},[e("span",null,g(o.texts.allDay),1)],4)):D("",!0),(i(!0),r(X,null,ae(l.timeCells,(h,x)=>(i(),r("div",{class:"vuecal__time-cell",key:x,style:_e(`height: ${a.timeCellHeight}px`)},[oe(s.$slots,"time-cell",{hours:h.hours,minutes:h.minutes},()=>[t[6]||(t[6]=e("span",{class:"vuecal__time-cell-line"},null,-1)),e("span",Za,g(h.label),1)])],4))),128))])):D("",!0),a.showWeekNumbers&&l.isMonthView?(i(),r("div",Ga,[(i(),r(X,null,ae(6,h=>e("div",{class:"vuecal__flex vuecal__week-number-cell",key:h,grow:""},[oe(s.$slots,"week-number-cell",{week:l.getWeekNumber(h-1)},()=>[q(g(l.getWeekNumber(h-1)),1)])])),64))])):D("",!0),e("div",{class:te(["vuecal__flex vuecal__cells",`${o.view.id}-view`]),grow:"",wrap:!l.cellOrSplitMinWidth||!l.isWeekView,column:!!l.cellOrSplitMinWidth},[l.cellOrSplitMinWidth&&l.isWeekView?(i(),Q(c,{key:0,"transition-direction":o.transitionDirection,"week-days":l.weekDays,"switch-to-narrower-view":l.switchToNarrowerView,style:_e(l.cellOrSplitMinWidth?`min-width: ${l.cellOrSplitMinWidth}px`:"")},st({_:2},[s.$slots["weekday-heading"]?{name:"weekday-heading",fn:B(({heading:h,view:x})=>[oe(s.$slots,"weekday-heading",{heading:h,view:x})]),key:"0"}:void 0,s.$slots["split-label"]?{name:"split-label",fn:B(({split:h})=>[oe(s.$slots,"split-label",{split:h,view:o.view.id})]),key:"1"}:void 0]),1032,["transition-direction","week-days","switch-to-narrower-view","style"])):l.hasSplits&&a.stickySplitLabels&&a.minSplitWidth?(i(),r("div",{key:1,class:"vuecal__flex vuecal__split-days-headers",style:_e(l.cellOrSplitMinWidth?`min-width: ${l.cellOrSplitMinWidth}px`:"")},[(i(!0),r(X,null,ae(l.daySplits,(h,x)=>(i(),r("div",{class:te(["day-split-header",h.class||!1]),key:x},[oe(s.$slots,"split-label",{split:h,view:o.view.id},()=>[q(g(h.label),1)])],2))),128))],4)):D("",!0),a.showAllDayEvents&&l.hasTimeColumn&&(l.isWeekView&&l.cellOrSplitMinWidth||l.isDayView&&l.hasSplits&&a.minSplitWidth)?(i(),Q(d,ht(gt({key:2},l.allDayBar)),{event:B(({event:h,view:x})=>[oe(s.$slots,"event",{view:x,event:h},()=>[l.editEvents.title&&h.titleEditable?(i(),r("div",{key:0,class:"vuecal__event-title vuecal__event-title--edit",contenteditable:"",onBlur:T=>l.onEventTitleBlur(T,h),innerHTML:h.title},null,40,Ja)):h.title?(i(),r("div",{key:1,class:"vuecal__event-title",innerHTML:h.title},null,8,Xa)):D("",!0),h.content&&!l.hasShortEvents&&!l.isShortMonthView?(i(),r("div",{key:2,class:"vuecal__event-content",innerHTML:h.content},null,8,Qa)):D("",!0)])]),_:3},16)):D("",!0),e("div",{class:"vuecal__flex",ref:h=>o.cellsEl=h,grow:"",wrap:!l.cellOrSplitMinWidth||!l.isWeekView,style:_e(l.cellOrSplitMinWidth?`min-width: ${l.cellOrSplitMinWidth}px`:"")},[(i(!0),r(X,null,ae(l.viewCells,(h,x)=>(i(),Q(u,{key:x,options:s.$props,"edit-events":l.editEvents,data:h,"cell-width":a.hideWeekdays.length&&(l.isWeekView||l.isMonthView)&&l.cellWidth,"min-timestamp":l.minTimestamp,"max-timestamp":l.maxTimestamp,"cell-splits":l.hasSplits&&l.daySplits||[]},{"cell-content":B(({events:T,split:A,selectCell:_})=>[oe(s.$slots,"cell-content",{cell:h,view:o.view,goNarrower:_,events:T},()=>[A&&!a.stickySplitLabels?(i(),r("div",{key:0,class:"split-label",innerHTML:A.label},null,8,tl)):D("",!0),h.content?(i(),r("div",{key:1,class:"vuecal__cell-date",innerHTML:h.content},null,8,sl)):D("",!0),(l.isMonthView&&!a.eventsOnMonthView||l.isYearsOrYearView&&a.eventsCountOnYearView)&&T.length?(i(),r("div",al,[oe(s.$slots,"events-count",{view:o.view,events:T},()=>[q(g(T.length),1)])])):D("",!0),!l.cellOrSplitHasEvents(T,A)&&l.isWeekOrDayView?(i(),r("div",ll,[oe(s.$slots,"no-event",{},()=>[q(g(o.texts.noEvent),1)])])):D("",!0)])]),event:B(({event:T,view:A})=>[oe(s.$slots,"event",{view:A,event:T},()=>[l.editEvents.title&&T.titleEditable?(i(),r("div",{key:0,class:"vuecal__event-title vuecal__event-title--edit",contenteditable:"",onBlur:_=>l.onEventTitleBlur(_,T),innerHTML:T.title},null,40,il)):T.title?(i(),r("div",{key:1,class:"vuecal__event-title",innerHTML:T.title},null,8,ol)):D("",!0),a.time&&!T.allDay&&!(l.isMonthView&&(T.allDay||a.showAllDayEvents==="short"))&&!l.isShortMonthView?(i(),r("div",nl,[q(g(o.utils.date.formatTime(T.start,l.TimeFormat)),1),T.endTimeMinutes?(i(),r("span",rl,"Â - "+g(o.utils.date.formatTime(T.end,l.TimeFormat,null,!0)),1)):D("",!0),T.daysCount>1&&(T.segments[h.formattedDate]||{}).isFirstDay?(i(),r("small",dl,"Â +"+g(T.daysCount-1)+g((o.texts.day[0]||"").toLowerCase()),1)):D("",!0)])):D("",!0),T.content&&!(l.isMonthView&&T.allDay&&a.showAllDayEvents==="short")&&!l.isShortMonthView?(i(),r("div",{key:3,class:"vuecal__event-content",innerHTML:T.content},null,8,ul)):D("",!0)])]),"no-event":B(()=>[oe(s.$slots,"no-event",{},()=>[q(g(o.texts.noEvent),1)])]),_:2},1032,["options","edit-events","data","cell-width","min-timestamp","max-timestamp","cell-splits"]))),128))],12,el)],10,Ka)])],2)]))]),_:3},8,["name","appear"]),o.ready?D("",!0):(i(),r("div",cl,t[7]||(t[7]=[e("div",null,null,-1)])))]))],10,Ra)}const Ye=1440,Ge={weekDays:Array(7).fill(""),weekDaysShort:[],months:Array(12).fill(""),years:"",year:"",month:"",week:"",day:"",today:"",noEvent:"",allDay:"",deleteEvent:"",createEvent:"",dateFormat:"dddd MMMM D, YYYY",am:"am",pm:"pm"},wt=["years","year","month","week","day"],xt=new Qs(Ge),vl={name:"vue-cal",components:{"vuecal-cell":Vt,"vuecal-header":Da,WeekdaysHeadings:St,AllDayBar:Na},provide(){return{vuecal:this,utils:this.utils,modules:this.modules,previous:this.previous,next:this.next,switchView:this.switchView,updateSelectedDate:this.updateSelectedDate,editEvents:this.editEvents,view:this.view,domEvents:this.domEvents}},props:{activeView:{type:String,default:"week"},allDayBarHeight:{type:[String,Number],default:"25px"},cellClickHold:{type:Boolean,default:!0},cellContextmenu:{type:Boolean,default:!1},clickToNavigate:{type:Boolean,default:!1},dblclickToNavigate:{type:Boolean,default:!0},disableDatePrototypes:{type:Boolean,default:!1},disableDays:{type:Array,default:()=>[]},disableViews:{type:Array,default:()=>[]},dragToCreateEvent:{type:Boolean,default:!0},dragToCreateThreshold:{type:Number,default:15},editableEvents:{type:[Boolean,Object],default:!1},events:{type:Array,default:()=>[]},eventsCountOnYearView:{type:Boolean,default:!1},eventsOnMonthView:{type:[Boolean,String],default:!1},hideBody:{type:Boolean,default:!1},hideTitleBar:{type:Boolean,default:!1},hideViewSelector:{type:Boolean,default:!1},hideWeekdays:{type:Array,default:()=>[]},hideWeekends:{type:Boolean,default:!1},locale:{type:[String,Object],default:"en"},maxDate:{type:[String,Date],default:""},minCellWidth:{type:Number,default:0},minDate:{type:[String,Date],default:""},minEventWidth:{type:Number,default:0},minSplitWidth:{type:Number,default:0},onEventClick:{type:[Function,null],default:null},onEventCreate:{type:[Function,null],default:null},onEventDblclick:{type:[Function,null],default:null},overlapsPerTimeStep:{type:Boolean,default:!1},resizeX:{type:Boolean,default:!1},selectedDate:{type:[String,Date],default:""},showAllDayEvents:{type:[Boolean,String],default:!1},showTimeInCells:{type:Boolean,default:!1},showWeekNumbers:{type:[Boolean,String],default:!1},snapToTime:{type:Number,default:0},small:{type:Boolean,default:!1},specialHours:{type:Object,default:()=>({})},splitDays:{type:Array,default:()=>[]},startWeekOnSunday:{type:Boolean,default:!1},stickySplitLabels:{type:Boolean,default:!1},time:{type:Boolean,default:!0},timeCellHeight:{type:Number,default:40},timeFormat:{type:String,default:""},timeFrom:{type:Number,default:0},timeStep:{type:Number,default:60},timeTo:{type:Number,default:Ye},todayButton:{type:Boolean,default:!1},transitions:{type:Boolean,default:!0},twelveHour:{type:Boolean,default:!1},watchRealTime:{type:Boolean,default:!1},xsmall:{type:Boolean,default:!1}},data(){return{ready:!1,texts:{...Ge},utils:{date:(this.disableDatePrototypes?xt.removePrototypes():!1)||xt,cell:null,event:null},modules:{dnd:null},cellsEl:null,view:{id:"",title:"",startDate:null,endDate:null,firstCellDate:null,lastCellDate:null,selectedDate:null,events:[]},eventIdIncrement:1,now:new Date,timeTickerIds:[null,null],domEvents:{resizeAnEvent:{_eid:null,start:null,split:null,segment:null,originalEndTimeMinutes:0,originalEnd:null,end:null,startCell:null,endCell:null},dragAnEvent:{_eid:null},dragCreateAnEvent:{startCursorY:null,start:null,split:null,event:null},focusAnEvent:{_eid:null,mousedUp:!1},clickHoldAnEvent:{_eid:null,timeout:1200,timeoutId:null},dblTapACell:{taps:0,timeout:500},clickHoldACell:{cellId:null,split:null,timeout:1200,timeoutId:null,eventCreated:!1},cancelClickEventCreation:!1},mutableEvents:[],transitionDirection:"right"}},methods:{async loadLocale(s){if(typeof this.locale=="object"){this.texts=Object.assign({},Ge,s),this.utils.date.updateTexts(this.texts);return}const t=await Xs(Object.assign({"./i18n/ar.json":()=>le(()=>import("./ar.es-bitOgb9K.js"),[]),"./i18n/bg.json":()=>le(()=>import("./bg.es-5tp0KQRo.js"),[]),"./i18n/bn.json":()=>le(()=>import("./bn.es-C_qR0y0-.js"),[]),"./i18n/bs.json":()=>le(()=>import("./bs.es-DduooXS8.js"),[]),"./i18n/ca.json":()=>le(()=>import("./ca.es-DYDNDJFJ.js"),[]),"./i18n/cs.json":()=>le(()=>import("./cs.es-CvnAvfoI.js"),[]),"./i18n/da.json":()=>le(()=>import("./da.es-C_eJXDX3.js"),[]),"./i18n/de.json":()=>le(()=>import("./de.es-Cp-R9E16.js"),[]),"./i18n/el.json":()=>le(()=>import("./el.es-BZ44a1Tb.js"),[]),"./i18n/en.json":()=>le(()=>import("./en.es-DwVNOttH.js"),[]),"./i18n/es.json":()=>le(()=>import("./es.es-DO8PaQ_q.js"),[]),"./i18n/et.json":()=>le(()=>import("./et.es-DdRIcUrz.js"),[]),"./i18n/fa.json":()=>le(()=>import("./fa.es-XN0av8Tx.js"),[]),"./i18n/fi.json":()=>le(()=>import("./fi.es-B0Iy6aas.js"),[]),"./i18n/fr.json":()=>le(()=>import("./fr.es-B7WXlprl.js"),[]),"./i18n/he.json":()=>le(()=>import("./he.es-BWEk5prp.js"),[]),"./i18n/hr.json":()=>le(()=>import("./hr.es-B_iqHQyr.js"),[]),"./i18n/hu.json":()=>le(()=>import("./hu.es-D_t4Ibxf.js"),[]),"./i18n/id.json":()=>le(()=>import("./id.es-CzHAK-XV.js"),[]),"./i18n/is.json":()=>le(()=>import("./is.es-DChRpym4.js"),[]),"./i18n/it.json":()=>le(()=>import("./it.es-CquQA5xx.js"),[]),"./i18n/ja.json":()=>le(()=>import("./ja.es-B19gsG6H.js"),[]),"./i18n/ka.json":()=>le(()=>import("./ka.es-CuOe65jc.js"),[]),"./i18n/ko.json":()=>le(()=>import("./ko.es-CsMl2USK.js"),[]),"./i18n/lt.json":()=>le(()=>import("./lt.es-vqgjGyMx.js"),[]),"./i18n/mn.json":()=>le(()=>import("./mn.es-BmdwFdas.js"),[]),"./i18n/nl.json":()=>le(()=>import("./nl.es-CFxVMCWy.js"),[]),"./i18n/no.json":()=>le(()=>import("./no.es-qRcuRMwl.js"),[]),"./i18n/pl.json":()=>le(()=>import("./pl.es-BQ3a0ltx.js"),[]),"./i18n/pt-br.json":()=>le(()=>import("./pt-br.es-U9bVHsgs.js"),[]),"./i18n/pt-pt.json":()=>le(()=>import("./pt-pt.es-U9bVHsgs.js"),[]),"./i18n/ro.json":()=>le(()=>import("./ro.es-ldjMjt3l.js"),[]),"./i18n/ru.json":()=>le(()=>import("./ru.es-CS-QKsYL.js"),[]),"./i18n/sk.json":()=>le(()=>import("./sk.es-CAe8sEvL.js"),[]),"./i18n/sl.json":()=>le(()=>import("./sl.es-rdzOxu_X.js"),[]),"./i18n/sq.json":()=>le(()=>import("./sq.es-BY5E06HI.js"),[]),"./i18n/sr.json":()=>le(()=>import("./sr.es-QPseRVBy.js"),[]),"./i18n/sv.json":()=>le(()=>import("./sv.es-BfPUYcV1.js"),[]),"./i18n/tr.json":()=>le(()=>import("./tr.es-Cl6kz_IH.js"),[]),"./i18n/uk.json":()=>le(()=>import("./uk.es-DBEtNQnZ.js"),[]),"./i18n/vi.json":()=>le(()=>import("./vi.es-Bx2g_1jx.js"),[]),"./i18n/zh-cn.json":()=>le(()=>import("./zh-cn.es-BWMmCH-R.js"),[]),"./i18n/zh-hk.json":()=>le(()=>import("./zh-hk.es-DFZ0bKvi.js"),[])}),`./i18n/${s}.json`,3);this.texts=Object.assign({},Ge,t),this.utils.date.updateTexts(this.texts)},loadDragAndDrop(){le(()=>import("./drag-and-drop.es-CbCm7IHa.js"),[]).then(s=>{const{DragAndDrop:t}=s;this.modules.dnd=new t(this)}).catch(()=>console.warn("Vue Cal: Missing drag & drop module."))},validateView(s){return wt.includes(s)||(console.error(`Vue Cal: invalid active-view parameter provided: "${s}".
A valid view must be one of: ${wt.join(", ")}.`),s="week"),this.enabledViews.includes(s)||(console.warn(`Vue Cal: the provided active-view "${s}" is disabled. Using the "${this.enabledViews[0]}" view instead.`),s=this.enabledViews[0]),s},switchToNarrowerView(s=null){this.transitionDirection="right";const t=this.enabledViews[this.enabledViews.indexOf(this.view.id)+1];t&&this.switchView(t,s)},switchView(s,t=null,a=!1){s=this.validateView(s);const n=this.utils.date,o=this.view.startDate&&this.view.startDate.getTime();if(this.transitions&&a){if(this.view.id===s)return;const d=this.enabledViews;this.transitionDirection=d.indexOf(this.view.id)>d.indexOf(s)?"left":"right"}const l=this.view.id;switch(this.view.events=[],this.view.id=s,this.view.firstCellDate=null,this.view.lastCellDate=null,t||(t=this.view.selectedDate||this.view.startDate),s){case"years":{this.view.startDate=new Date(Math.floor(t.getFullYear()/25)*25||2e3,0,1),this.view.endDate=new Date(this.view.startDate.getFullYear()+25,0,1),this.view.endDate.setSeconds(-1);break}case"year":{this.view.startDate=new Date(t.getFullYear(),0,1),this.view.endDate=new Date(t.getFullYear()+1,0,1),this.view.endDate.setSeconds(-1);break}case"month":{this.view.startDate=new Date(t.getFullYear(),t.getMonth(),1),this.view.endDate=new Date(t.getFullYear(),t.getMonth()+1,1),this.view.endDate.setSeconds(-1);let d=new Date(this.view.startDate);if(d.getDay()!==(this.startWeekOnSunday?0:1)&&(d=n.getPreviousFirstDayOfWeek(d,this.startWeekOnSunday)),this.view.firstCellDate=d,this.view.lastCellDate=n.addDays(d,41),this.view.lastCellDate.setHours(23,59,59,0),this.hideWeekends){if([0,6].includes(this.view.firstCellDate.getDay())){const c=this.view.firstCellDate.getDay()===6&&!this.startWeekOnSunday?2:1;this.view.firstCellDate=n.addDays(this.view.firstCellDate,c)}if([0,6].includes(this.view.startDate.getDay())){const c=this.view.startDate.getDay()===6?2:1;this.view.startDate=n.addDays(this.view.startDate,c)}if([0,6].includes(this.view.lastCellDate.getDay())){const c=this.view.lastCellDate.getDay()===0&&!this.startWeekOnSunday?2:1;this.view.lastCellDate=n.subtractDays(this.view.lastCellDate,c)}if([0,6].includes(this.view.endDate.getDay())){const c=this.view.endDate.getDay()===0?2:1;this.view.endDate=n.subtractDays(this.view.endDate,c)}}break}case"week":{t=n.getPreviousFirstDayOfWeek(t,this.startWeekOnSunday);const d=this.hideWeekends?5:7;this.view.startDate=this.hideWeekends&&this.startWeekOnSunday?n.addDays(t,1):t,this.view.startDate.setHours(0,0,0,0),this.view.endDate=n.addDays(t,d),this.view.endDate.setSeconds(-1);break}case"day":{this.view.startDate=t,this.view.startDate.setHours(0,0,0,0),this.view.endDate=new Date(t),this.view.endDate.setHours(23,59,59,0);break}}this.addEventsToView();const m=this.view.startDate&&this.view.startDate.getTime();if(!(l===s&&m===o)&&(this.$emit("update:activeView",s),this.ready)){const d=this.view.startDate,c={view:s,startDate:d,endDate:this.view.endDate,...this.isMonthView?{firstCellDate:this.view.firstCellDate,lastCellDate:this.view.lastCellDate,outOfScopeEvents:this.view.outOfScopeEvents.map(this.cleanupEvent)}:{},events:this.view.events.map(this.cleanupEvent),...this.isWeekView?{week:n.getWeek(this.startWeekOnSunday?n.addDays(d,1):d)}:{}};this.$emit("view-change",c)}},previous(){this.previousNext(!1)},next(){this.previousNext()},previousNext(s=!0){const t=this.utils.date;this.transitionDirection=s?"right":"left";const a=s?1:-1;let n=null;const{startDate:o,id:l}=this.view;switch(l){case"years":n=new Date(o.getFullYear()+25*a,0,1);break;case"year":n=new Date(o.getFullYear()+1*a,1,1);break;case"month":n=new Date(o.getFullYear(),o.getMonth()+1*a,1);break;case"week":n=t[s?"addDays":"subtractDays"](t.getPreviousFirstDayOfWeek(o,this.startWeekOnSunday),7);break;case"day":n=t[s?"addDays":"subtractDays"](o,1);const m=n.getDay(),d=this.startWeekOnSunday?m:(m||7)-1;if(this.weekDays[d].hide){const u=this.weekDays.map((x,T)=>({...x,i:T}));let h=0;s?([...u.slice(d),...u].find(x=>(h++,!x.hide)).i,h--):[...u,...u.slice(0,d)].reverse().find(x=>(h++,!x.hide)).i,n=t[s?"addDays":"subtractDays"](n,h)}break}n&&this.switchView(l,n)},addEventsToView(s=[]){const t=this.utils.event,{startDate:a,endDate:n,firstCellDate:o,lastCellDate:l}=this.view;if(s.length||(this.view.events=[]),s=s.length?s:[...this.mutableEvents],!s||this.isYearsOrYearView&&!this.eventsCountOnYearView)return;let m=s.filter(d=>t.eventInRange(d,a,n));!this.isYearsOrYearView&&!(this.isMonthView&&!this.eventsOnMonthView)&&(m=m.map(d=>d.daysCount>1?t.createEventSegments(d,o||a,l||n):d)),this.view.events.push(...m),this.isMonthView&&(this.view.outOfScopeEvents=[],s.forEach(d=>{(t.eventInRange(d,o,a)||t.eventInRange(d,n,l))&&(this.view.events.some(c=>c._eid===d._eid)||this.view.outOfScopeEvents.push(d))}))},findAncestor(s,t){for(;(s=s.parentElement)&&!s.classList.contains(t););return s},isDOMElementAnEvent(s){return s.classList.contains("vuecal__event")||this.findAncestor(s,"vuecal__event")},onMouseMove(s){const{resizeAnEvent:t,dragAnEvent:a,dragCreateAnEvent:n}=this.domEvents;t._eid===null&&a._eid===null&&!n.start||(s.preventDefault(),t._eid?this.eventResizing(s):this.dragToCreateEvent&&n.start&&this.eventDragCreation(s))},onMouseUp(s){const{focusAnEvent:t,resizeAnEvent:a,clickHoldAnEvent:n,clickHoldACell:o,dragCreateAnEvent:l}=this.domEvents,{_eid:m}=n,{_eid:d}=a;let c=!1;const{event:u,start:h}=l,x=this.isDOMElementAnEvent(s.target),T=t.mousedUp;if(t.mousedUp=!1,x&&(this.domEvents.cancelClickEventCreation=!0),o.eventCreated)return;if(d){const{originalEnd:_,originalEndTimeMinutes:S,endTimeMinutes:p}=a,f=this.view.events.find(k=>k._eid===a._eid);if(c=p&&p!==S,f&&f.end.getTime()!==_.getTime()){const k=this.mutableEvents.find(E=>E._eid===a._eid);k.endTimeMinutes=f.endTimeMinutes,k.end=f.end;const M=this.cleanupEvent(f),I={...this.cleanupEvent(f),end:_,endTimeMinutes:f.originalEndTimeMinutes};this.$emit("event-duration-change",{event:M,oldDate:a.originalEnd,originalEvent:I}),this.$emit("event-change",{event:M,originalEvent:I})}f&&(f.resizing=!1),a._eid=null,a.start=null,a.split=null,a.segment=null,a.originalEndTimeMinutes=null,a.originalEnd=null,a.endTimeMinutes=null,a.startCell=null,a.endCell=null}else h&&(u&&(this.emitWithEvent("event-drag-create",u),l.event.resizing=!1),l.start=null,l.split=null,l.event=null);!x&&!d&&this.unfocusEvent(),n.timeoutId&&!m&&(clearTimeout(n.timeoutId),n.timeoutId=null),o.timeoutId&&(clearTimeout(o.timeoutId),o.timeoutId=null);const A=typeof this.onEventClick=="function";if(T&&!c&&!m&&!u&&A){let _=this.view.events.find(S=>S._eid===t._eid);return!_&&this.isMonthView&&(_=this.view.outOfScopeEvents.find(S=>S._eid===t._eid)),_&&this.onEventClick(_,s)}},onKeyUp(s){s.keyCode===27&&this.cancelDelete()},eventResizing(s){const{resizeAnEvent:t}=this.domEvents,a=this.view.events.find(u=>u._eid===t._eid)||{segments:{}},{minutes:n,cursorCoords:o}=this.minutesAtCursor(s),l=a.segments&&a.segments[t.segment],{date:m,event:d}=this.utils,c=Math.max(n,this.timeFrom+1,(l||a).startTimeMinutes+1);if(a.endTimeMinutes=t.endTimeMinutes=c,this.snapToTime){const u=a.endTimeMinutes+this.snapToTime/2;a.endTimeMinutes=u-u%this.snapToTime}if(l&&(l.endTimeMinutes=a.endTimeMinutes),a.end.setHours(0,a.endTimeMinutes,a.endTimeMinutes===Ye?-1:0,0),this.resizeX&&this.isWeekView){a.daysCount=m.countDays(a.start,a.end);const u=this.cellsEl,h=u.offsetWidth/u.childElementCount,x=Math.floor(o.x/h);if(t.startCell===null&&(t.startCell=x-(a.daysCount-1)),t.endCell!==x){t.endCell=x;const T=m.addDays(a.start,x-t.startCell),A=Math.max(m.countDays(a.start,T),1);if(A!==a.daysCount){let _=null;A>a.daysCount?_=d.addEventSegment(a):_=d.removeEventSegment(a),t.segment=_,a.endTimeMinutes+=.001}}}this.$emit("event-resizing",{_eid:a._eid,end:a.end,endTimeMinutes:a.endTimeMinutes})},eventDragCreation(s){const{dragCreateAnEvent:t}=this.domEvents,{start:a,startCursorY:n,split:o}=t,l=new Date(a),{minutes:m,cursorCoords:{y:d}}=this.minutesAtCursor(s);if(!(!t.event&&Math.abs(n-d)<this.dragToCreateThreshold))if(t.event){if(l.setHours(0,m,m===Ye?-1:0,0),this.snapToTime){let h=l.getHours()*60+l.getMinutes();const x=h+this.snapToTime/2;h=x-x%this.snapToTime,l.setHours(0,h,0,0)}const c=a<l,{event:u}=t;u.start=c?a:l,u.end=c?l:a,u.startTimeMinutes=u.start.getHours()*60+u.start.getMinutes(),u.endTimeMinutes=u.end.getHours()*60+u.end.getMinutes()}else{if(t.event=this.utils.event.createAnEvent(a,1,{split:o}),!t.event){t.start=null,t.split=null,t.event=null;return}t.event.resizing=!0}},unfocusEvent(){const{focusAnEvent:s,clickHoldAnEvent:t}=this.domEvents,a=this.view.events.find(n=>n._eid===(s._eid||t._eid));s._eid=null,t._eid=null,a&&(a.focused=!1,a.deleting=!1)},cancelDelete(){const{clickHoldAnEvent:s}=this.domEvents;if(s._eid){const t=this.view.events.find(a=>a._eid===s._eid);t&&(t.deleting=!1),s._eid=null,s.timeoutId=null}},onEventTitleBlur(s,t){if(t.title===s.target.innerHTML)return;const a=t.title;t.title=s.target.innerHTML;const n=this.cleanupEvent(t);this.$emit("event-title-change",{event:n,oldTitle:a}),this.$emit("event-change",{event:n,originalEvent:{...n,title:a}})},updateMutableEvents(){const s=this.utils.date;this.mutableEvents=[],this.events.forEach(t=>{const a=typeof t.start=="string"?s.stringToDate(t.start):t.start,n=s.formatDateLite(a),o=s.dateToMinutes(a);let l=null;typeof t.end=="string"&&t.end.includes("24:00")?(l=new Date(t.end.replace(" 24:00","")),l.setHours(23,59,59,0)):l=typeof t.end=="string"?s.stringToDate(t.end):t.end;let m=s.formatDateLite(l),d=s.dateToMinutes(l);(!d||d===Ye)&&(!this.time||typeof t.end=="string"&&t.end.length===10?l.setHours(23,59,59,0):l.setSeconds(l.getSeconds()-1),m=s.formatDateLite(l),d=Ye);const c=n!==m;t=Object.assign({...this.utils.event.eventDefaults},t,{_eid:`${this._.uid}_${this.eventIdIncrement++}`,segments:c?{}:null,start:a,startTimeMinutes:o,end:l,endTimeMinutes:d,daysCount:c?s.countDays(a,l):1,class:t.class}),this.mutableEvents.push(t)})},minutesAtCursor(s){return this.utils.cell.minutesAtCursor(s)},createEvent(s,t,a={}){return this.utils.event.createAnEvent(s,t,a)},cleanupEvent(s){return s={...s},["segments","deletable","deleting","titleEditable","resizable","resizing","draggable","dragging","draggingStatic","focused"].forEach(a=>{a in s&&delete s[a]}),s.repeat||delete s.repeat,s},emitWithEvent(s,t){this.$emit(s,this.cleanupEvent(t))},updateSelectedDate(s){if(s&&typeof s=="string"?s=this.utils.date.stringToDate(s):s=new Date(s),s&&s instanceof Date){const{selectedDate:t}=this.view;t&&(this.transitionDirection=t.getTime()>s.getTime()?"left":"right"),s.setHours(0,0,0,0),(!t||t.getTime()!==s.getTime())&&(this.view.selectedDate=s),this.switchView(this.view.id)}this.$emit("update:selected-date",this.view.selectedDate)},getWeekNumber(s){const t=this.utils.date,n=this.firstCellDateWeekNumber+s,o=this.startWeekOnSunday?1:0;return n>52?t.getWeek(t.addDays(this.view.firstCellDate,7*s+o)):n},timeTick(){this.now=new Date,this.timeTickerIds[1]=setTimeout(this.timeTick,60*1e3)},updateDateTexts(){this.utils.date.updateTexts(this.texts)},alignWithScrollbar(){if(document.getElementById("vuecal-align-with-scrollbar"))return;const s=this.$refs.vuecal.getElementsByClassName("vuecal__scrollbar-check")[0],t=s.offsetWidth-s.children[0].offsetWidth;if(t){const a=document.createElement("style");a.id="vuecal-align-with-scrollbar",a.type="text/css",a.innerHTML=`.vuecal--view-with-time .vuecal__weekdays-headings,.vuecal--view-with-time .vuecal__all-day {padding-right: ${t}px}`,document.head.appendChild(a)}},cellOrSplitHasEvents(s,t=null){return s.length&&(!t&&s.length||t&&s.some(a=>a.split===t.id))}},created(){this.utils.cell=new ta(this),this.utils.event=new aa(this,this.utils.date),this.loadLocale(this.locale),this.editEvents.drag&&this.loadDragAndDrop(),this.updateMutableEvents(this.events),this.view.id=this.currentView,this.selectedDate?this.updateSelectedDate(this.selectedDate):(this.view.selectedDate=new Date,this.switchView(this.currentView)),this.time&&this.watchRealTime&&(this.timeTickerIds[0]=setTimeout(this.timeTick,(60-this.now.getSeconds())*1e3))},mounted(){const s=this.utils.date,t="ontouchstart"in window,{resize:a,drag:n,create:o,delete:l,title:m}=this.editEvents,d=this.onEventClick&&typeof this.onEventClick=="function";(a||n||o||l||m||d)&&window.addEventListener(t?"touchend":"mouseup",this.onMouseUp),(a||n||o&&this.dragToCreateEvent)&&window.addEventListener(t?"touchmove":"mousemove",this.onMouseMove,{passive:!1}),m&&window.addEventListener("keyup",this.onKeyUp),t&&(this.$refs.vuecal.oncontextmenu=function(h){h.preventDefault(),h.stopPropagation()}),this.hideBody||this.alignWithScrollbar();const c=this.view.startDate,u={view:this.view.id,startDate:c,endDate:this.view.endDate,...this.isMonthView?{firstCellDate:this.view.firstCellDate,lastCellDate:this.view.lastCellDate}:{},events:this.view.events.map(this.cleanupEvent),...this.isWeekView?{week:s.getWeek(this.startWeekOnSunday?s.addDays(c,1):c)}:{}};this.$emit("ready",u),this.ready=!0},beforeUnmount(){const s="ontouchstart"in window;window.removeEventListener(s?"touchmove":"mousemove",this.onMouseMove,{passive:!1}),window.removeEventListener(s?"touchend":"mouseup",this.onMouseUp),window.removeEventListener("keyup",this.onKeyUp),this.timeTickerIds[0]&&clearTimeout(this.timeTickerIds[0]),this.timeTickerIds[1]&&clearTimeout(this.timeTickerIds[1]),this.timeTickerIds=[null,null]},computed:{editEvents(){return this.editableEvents&&typeof this.editableEvents=="object"?{title:!!this.editableEvents.title,drag:!!this.editableEvents.drag,resize:!!this.editableEvents.resize,create:!!this.editableEvents.create,delete:!!this.editableEvents.delete}:{title:!!this.editableEvents,drag:!!this.editableEvents,resize:!!this.editableEvents,create:!!this.editableEvents,delete:!!this.editableEvents}},views(){return{years:{label:this.texts.years,enabled:!this.disableViews.includes("years")},year:{label:this.texts.year,enabled:!this.disableViews.includes("year")},month:{label:this.texts.month,enabled:!this.disableViews.includes("month")},week:{label:this.texts.week,enabled:!this.disableViews.includes("week")},day:{label:this.texts.day,enabled:!this.disableViews.includes("day")}}},currentView(){return this.validateView(this.activeView)},enabledViews(){return Object.keys(this.views).filter(s=>this.views[s].enabled)},hasTimeColumn(){return this.time&&this.isWeekOrDayView},isShortMonthView(){return this.isMonthView&&this.eventsOnMonthView==="short"},firstCellDateWeekNumber(){const s=this.utils.date,t=this.view.firstCellDate;return s.getWeek(this.startWeekOnSunday?s.addDays(t,1):t)},timeCells(){const s=[];for(let t=this.timeFrom,a=this.timeTo;t<a;t+=this.timeStep)s.push({hours:Math.floor(t/60),minutes:t%60,label:this.utils.date.formatTime(t,this.TimeFormat),value:t});return s},TimeFormat(){return this.timeFormat||(this.twelveHour?"h:mm{am}":"HH:mm")},daySplits(){return(this.splitDays.filter(s=>!s.hide)||[]).map((s,t)=>({...s,id:s.id||t+1}))},hasSplits(){return this.daySplits.length&&this.isWeekOrDayView},hasShortEvents(){return this.showAllDayEvents==="short"},cellOrSplitMinWidth(){let s=null;return this.hasSplits&&this.minSplitWidth?s=this.visibleDaysCount*this.minSplitWidth*this.daySplits.length:this.minCellWidth&&this.isWeekView&&(s=this.visibleDaysCount*this.minCellWidth),s},allDayBar(){let s=this.allDayBarHeight||null;return s&&!isNaN(s)&&(s+="px"),{cells:this.viewCells,options:this.$props,label:this.texts.allDay,shortEvents:this.hasShortEvents,daySplits:this.hasSplits&&this.daySplits||[],cellOrSplitMinWidth:this.cellOrSplitMinWidth,height:s}},minTimestamp(){let s=null;return this.minDate&&typeof this.minDate=="string"?s=this.utils.date.stringToDate(this.minDate):this.minDate&&this.minDate instanceof Date&&(s=this.minDate),s?s.getTime():null},maxTimestamp(){let s=null;return this.maxDate&&typeof this.maxDate=="string"?s=this.utils.date.stringToDate(this.maxDate):this.maxDate&&this.maxDate instanceof Date&&(s=this.maxDate),s?s.getTime():null},weekDays(){let{weekDays:s,weekDaysShort:t=[]}=this.texts;return s=s.slice(0).map((a,n)=>({label:a,...t.length?{short:t[n]}:{},hide:this.hideWeekends&&n>=5||this.hideWeekdays.length&&this.hideWeekdays.includes(n+1)})),this.startWeekOnSunday&&s.unshift(s.pop()),s},weekDaysInHeader(){return this.isMonthView||this.isWeekView&&!this.minCellWidth&&!(this.hasSplits&&this.minSplitWidth)},months(){return this.texts.months.map(s=>({label:s}))},specialDayHours(){return!this.specialHours||!Object.keys(this.specialHours).length?{}:Array(7).fill("").map((s,t)=>{let a=this.specialHours[t+1]||[];return Array.isArray(a)||(a=[a]),s=[],a.forEach(({from:n,to:o,class:l,label:m},d)=>{s[d]={day:t+1,from:[null,void 0].includes(n)?null:n*1,to:[null,void 0].includes(o)?null:o*1,class:l||"",label:m||""}}),s})},viewTitle(){const s=this.utils.date;let t="";const a=this.view.startDate,n=a.getFullYear(),o=a.getMonth();switch(this.view.id){case"years":{t=this.texts.years;break}case"year":{t=n;break}case"month":{t=`${this.months[o].label} ${n}`;break}case"week":{const l=this.view.endDate,m=a.getFullYear();let d=this.texts.months[a.getMonth()];this.xsmall&&(d=d.substring(0,3));let c=`${d} ${m}`;if(l.getMonth()!==a.getMonth()){const u=l.getFullYear();let h=this.texts.months[l.getMonth()];this.xsmall&&(h=h.substring(0,3)),m===u?c=`${d} - ${h} ${m}`:this.small?c=`${d.substring(0,3)} ${m} - ${h.substring(0,3)} ${u}`:c=`${d} ${m} - ${h} ${u}`}t=`${this.texts.week} ${s.getWeek(this.startWeekOnSunday?s.addDays(a,1):a)} (${c})`;break}case"day":{t=this.utils.date.formatDate(a,this.texts.dateFormat,this.texts);break}}return t},viewCells(){const s=this.utils.date;let t=[],a=null,n=!1;this.watchRealTime||(this.now=new Date);const o=this.now;switch(this.view.id){case"years":{a=this.view.startDate.getFullYear(),t=Array.apply(null,Array(25)).map((l,m)=>{const d=new Date(a+m,0,1),c=new Date(a+m+1,0,1);return c.setSeconds(-1),{startDate:d,formattedDate:s.formatDateLite(d),endDate:c,content:a+m,current:a+m===o.getFullYear()}});break}case"year":{a=this.view.startDate.getFullYear(),t=Array.apply(null,Array(12)).map((l,m)=>{const d=new Date(a,m,1),c=new Date(a,m+1,1);return c.setSeconds(-1),{startDate:d,formattedDate:s.formatDateLite(d),endDate:c,content:this.xsmall?this.months[m].label.substr(0,3):this.months[m].label,current:m===o.getMonth()&&a===o.getFullYear()}});break}case"month":{const l=this.view.startDate.getMonth(),m=new Date(this.view.firstCellDate);n=!1,t=Array.apply(null,Array(42)).map((d,c)=>{const u=s.addDays(m,c),h=new Date(u);h.setHours(23,59,59,0);const x=!n&&s.isToday(u)&&!n++;return{startDate:u,formattedDate:s.formatDateLite(u),endDate:h,content:u.getDate(),today:x,outOfScope:u.getMonth()!==l,class:`vuecal__cell--day${u.getDay()||7}`}}),(this.hideWeekends||this.hideWeekdays.length)&&(t=t.filter(d=>{const c=d.startDate.getDay()||7;return!(this.hideWeekends&&c>=6||this.hideWeekdays.length&&this.hideWeekdays.includes(c))}));break}case"week":{n=!1;const l=this.view.startDate,m=this.weekDays;t=m.map((d,c)=>{const u=s.addDays(l,this.startWeekOnSunday&&this.hideWeekends?c-1:c),h=new Date(u);h.setHours(23,59,59,0);const x=(u.getDay()||7)-1;return{startDate:u,formattedDate:s.formatDateLite(u),endDate:h,today:!n&&s.isToday(u)&&!n++,specialHours:this.specialDayHours[x]||[]}}).filter((d,c)=>!m[c].hide);break}case"day":{const l=this.view.startDate,m=new Date(this.view.startDate);m.setHours(23,59,59,0);const d=(l.getDay()||7)-1;t=[{startDate:l,formattedDate:s.formatDateLite(l),endDate:m,today:s.isToday(l),specialHours:this.specialDayHours[d]||[]}];break}}return t},visibleDaysCount(){return this.isDayView?1:7-this.weekDays.reduce((s,t)=>s+t.hide,0)},cellWidth(){return 100/this.visibleDaysCount},cssClasses(){const{resizeAnEvent:s,dragAnEvent:t,dragCreateAnEvent:a}=this.domEvents;return{[`vuecal--${this.view.id}-view`]:!0,[`vuecal--${this.locale}`]:this.locale,"vuecal--no-time":!this.time,"vuecal--view-with-time":this.hasTimeColumn,"vuecal--week-numbers":this.showWeekNumbers&&this.isMonthView,"vuecal--twelve-hour":this.twelveHour,"vuecal--click-to-navigate":this.clickToNavigate,"vuecal--hide-weekends":this.hideWeekends,"vuecal--split-days":this.hasSplits,"vuecal--sticky-split-labels":this.hasSplits&&this.stickySplitLabels,"vuecal--overflow-x":this.minCellWidth&&this.isWeekView||this.hasSplits&&this.minSplitWidth,"vuecal--small":this.small,"vuecal--xsmall":this.xsmall,"vuecal--resizing-event":s._eid,"vuecal--drag-creating-event":a.event,"vuecal--dragging-event":t._eid,"vuecal--events-on-month-view":this.eventsOnMonthView,"vuecal--short-events":this.isMonthView&&this.eventsOnMonthView==="short","vuecal--has-touch":typeof window<"u"&&"ontouchstart"in window}},isYearsOrYearView(){return["years","year"].includes(this.view.id)},isYearsView(){return this.view.id==="years"},isYearView(){return this.view.id==="year"},isMonthView(){return this.view.id==="month"},isWeekOrDayView(){return["week","day"].includes(this.view.id)},isWeekView(){return this.view.id==="week"},isDayView(){return this.view.id==="day"}},watch:{events:{handler(s,t){this.updateMutableEvents(s),this.addEventsToView()},deep:!0},locale(s){this.loadLocale(s)},selectedDate(s){this.updateSelectedDate(s)},activeView(s){this.switchView(s)}}},pl=Pe(vl,[["render",ml]]),hl={class:"bg-white p-6 rounded-xl shadow-md hover:shadow-lg transition-shadow"},gl={class:"flex justify-between items-center mb-4"},fl={class:"flex gap-3"},yl={class:"flex rounded-md shadow-sm mr-3"},bl={key:0,class:"mb-4 bg-gray-50 p-4 rounded-lg"},_l={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},wl=["value"],xl={class:"mt-1 relative rounded-md shadow-sm"},kl={key:1,class:"text-center text-gray-600 text-sm animate-pulse py-4"},Dl={key:2,class:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-md"},Cl={key:3},$l={key:0,class:"space-y-4"},jl={key:0,class:"flex justify-between"},Tl={class:"flex-grow"},El={class:"text-sm text-red-500 italic"},Ml={class:"flex items-center mt-1"},Sl={class:"text-xs text-gray-500"},Vl={key:1},Al={class:"flex-grow"},Il={class:"flex justify-between items-center mb-3"},Ll={class:"text-sm text-gray-600 bg-blue-100 px-2 py-1 rounded-full"},Ol={class:"mb-3"},Ul={class:"text-sm text-gray-700 ml-6"},Pl={class:"mb-3"},Nl={class:"text-sm text-gray-700 ml-6"},Rl={class:"mb-2"},Fl={class:"text-sm text-gray-700 ml-6"},Bl={class:"flex items-center mt-3 pt-2 border-t border-blue-200"},Hl={class:"text-xs text-gray-500"},Wl={key:1,class:"text-gray-400 text-sm"},Yl={key:4,class:"mt-4"},zl={class:"flex justify-between items-center mb-6"},ql={class:"text-lg font-medium text-gray-900"},Zl=["innerHTML"],Gl=["innerHTML"],Kl={key:0,class:"mt-1 text-xs p-1 rounded bg-red-50 border-l-2 border-red-500 text-red-700"},Jl={class:"mt-6 bg-white rounded-lg shadow p-4"},Xl={key:0},Ql={class:"font-medium text-gray-800 mb-2"},ei={class:"font-medium text-blue-800"},ti={class:"text-sm text-gray-600 mt-1"},si={key:1,class:"text-gray-500 text-sm"},ai={__name:"DailyStandups",props:{projectId:{type:Number,required:!0},users:{type:Array,default:()=>[]}},emits:["standupAdded"],setup(s,{emit:t}){const a=s,n=b("list"),o=b(!1),l=b(!1),m=b(""),d=b([]),c=b(""),u=De({startDate:"",endDate:"",search:"",userId:""}),h=y=>{const w=ue(y);return w.isValid()?{start:w.clone().startOf("month").format("YYYY-MM-DD"),end:w.clone().endOf("month").format("YYYY-MM-DD")}:(console.warn("getMonthRange received an invalid input, defaulting to current date:",y),{start:ue().startOf("month").format("YYYY-MM-DD"),end:ue().endOf("month").format("YYYY-MM-DD")})};let x=null;const T=()=>{clearTimeout(x),x=setTimeout(()=>{_()},500)},A=async()=>{l.value=!0,m.value="";try{const y=new URLSearchParams;u.startDate&&y.append("start_date",u.startDate),u.endDate&&y.append("end_date",u.endDate),u.search&&y.append("search",u.search),u.userId&&y.append("user_id",String(u.userId));const w=y.toString(),C=`/api/projects/${a.projectId}/sections/notes?type=standup${w?`&${w}`:""}`,W=await window.axios.get(C);d.value=W.data.filter(J=>J.type==="standup")}catch(y){console.error("Error fetching project standups:",y),m.value="Failed to load standups. Please try again."}finally{l.value=!1}},_=()=>{A()},S=()=>{u.search="",u.userId="",u.startDate="",u.endDate="",A()},p=()=>{c.value=ue(c.value).subtract(1,"month").format("YYYY-MM-DD")},f=()=>{c.value=ue(c.value).add(1,"month").format("YYYY-MM-DD")};ne(()=>c.value,y=>{if(n.value==="calendar"&&y){const w=h(y);u.startDate=w.start,u.endDate=w.end,A()}}),ne(()=>n.value,y=>{y==="calendar"?(u.search="",u.userId="",c.value=h(new Date).start):(u.startDate="",u.endDate="",A())});const k=F(()=>(d.value||[]).map(y=>{var W;if(!(y!=null&&y.created_at))return null;const w=ue(y.created_at);if(!w.isValid())return null;const C=O(y.content);return{start:w.format("YYYY-MM-DD HH:mm"),end:w.format("YYYY-MM-DD HH:mm"),title:`${((W=y.user)==null?void 0:W.name)||"Unknown"} - Standup`,content:`Yesterday: ${C.yesterday}
Today: ${C.today}
Blockers: ${C.blockers}`,class:"standup-event",standupData:y}}).filter(Boolean));be(()=>{A()});const M=F(()=>{if(!d.value)return[];let y=[...d.value];if(u.startDate&&(y=y.filter(w=>w.created_at&&ue(w.created_at).isSameOrAfter(u.startDate,"day"))),u.endDate&&(y=y.filter(w=>w.created_at&&ue(w.created_at).isSameOrBefore(u.endDate,"day"))),u.userId&&(y=y.filter(w=>w.user_id===parseInt(u.userId))),u.search){const w=u.search.toLowerCase();y=y.filter(C=>C.content&&C.content!=="[Encrypted content could not be decrypted]"&&C.content.toLowerCase().includes(w))}return y.sort((w,C)=>ue(C.created_at).valueOf()-ue(w.created_at).valueOf())}),I=y=>{const w=ue(y).day();return w>=1&&w<=5},E=y=>ue(y).isBefore(ue(),"day"),L=(y,w)=>ue(y).isSame(w,"day"),O=y=>{var V,R,Z,P;if(!y||typeof y!="string"||y==="[Encrypted content could not be decrypted]"||y.trim()==="")return{yesterday:"N/A",today:"N/A",blockers:"N/A",date:"N/A"};const w=((V=y.match(/\*\*Yesterday:\*\* ([^\n]+)/))==null?void 0:V[1].trim())||"Nothing",C=((R=y.match(/\*\*Today:\*\* ([^\n]+)/))==null?void 0:R[1].trim())||"Nothing",W=((Z=y.match(/\*\*Blockers:\*\* ([^\n]+)/))==null?void 0:Z[1].trim())||"None",J=((P=y.match(/\*\*Daily Standup - ([^*]+)\*\*/))==null?void 0:P[1].trim())||ue().format("L");return{yesterday:w,today:C,blockers:W,date:J}},$=F(()=>{const y={};return(d.value||[]).forEach(w=>{if(!(w!=null&&w.created_at))return;const C=ue(w.created_at).format("YYYY-MM-DD");y[C]||(y[C]=[]),y[C].push(w)}),y});return(y,w)=>(i(),r("div",hl,[e("div",gl,[w[11]||(w[11]=e("h4",{class:"text-lg font-semibold text-gray-900"},"Daily Standups",-1)),e("div",fl,[e("div",yl,[e("button",{type:"button",onClick:w[0]||(w[0]=C=>n.value="list"),class:te([n.value==="list"?"bg-indigo-100 text-indigo-700":"bg-white text-gray-700 hover:text-gray-500","px-4 py-2 text-sm font-medium rounded-l-md border border-gray-300 focus:z-10 focus:outline-none focus:ring-1 focus:ring-indigo-500"])},w[8]||(w[8]=[e("span",{class:"flex items-center"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 6h16M4 10h16M4 14h16M4 18h16"})]),q(" List ")],-1)]),2),e("button",{type:"button",onClick:w[1]||(w[1]=C=>n.value="calendar"),class:te([n.value==="calendar"?"bg-indigo-100 text-indigo-700":"bg-white text-gray-700 hover:text-gray-500","px-4 py-2 text-sm font-medium rounded-r-md border border-gray-300 focus:z-10 focus:outline-none focus:ring-1 focus:ring-indigo-500"])},w[9]||(w[9]=[e("span",{class:"flex items-center"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})]),q(" Calendar ")],-1)]),2)]),v(ce,{class:"bg-blue-600 hover:bg-blue-700 transition-colors",onClick:w[2]||(w[2]=C=>o.value=!0)},{default:B(()=>w[10]||(w[10]=[q(" Submit Standup ",-1)])),_:1,__:[10]})])]),n.value==="list"?(i(),r("div",bl,[e("div",_l,[e("div",null,[w[12]||(w[12]=e("label",{for:"standupStartDate",class:"block text-sm font-medium text-gray-700 mb-1"},"From Date",-1)),ve(e("input",{type:"date",id:"standupStartDate","onUpdate:modelValue":w[3]||(w[3]=C=>u.startDate=C),class:"mt-1 block w-full border-gray-300 focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md",onChange:_},null,544),[[we,u.startDate]])]),e("div",null,[w[13]||(w[13]=e("label",{for:"standupEndDate",class:"block text-sm font-medium text-gray-700 mb-1"},"To Date",-1)),ve(e("input",{type:"date",id:"standupEndDate","onUpdate:modelValue":w[4]||(w[4]=C=>u.endDate=C),class:"mt-1 block w-full border-gray-300 focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md",onChange:_},null,544),[[we,u.endDate]])]),e("div",null,[w[15]||(w[15]=e("label",{for:"standupUserFilter",class:"block text-sm font-medium text-gray-700 mb-1"},"User",-1)),ve(e("select",{id:"standupUserFilter","onUpdate:modelValue":w[5]||(w[5]=C=>u.userId=C),class:"mt-1 block w-full border-gray-300 focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md",onChange:_},[w[14]||(w[14]=e("option",{value:""},"All Users",-1)),(i(!0),r(X,null,ae(a.users,C=>(i(),r("option",{key:C.id,value:C.id},g(C.name),9,wl))),128))],544),[[qe,u.userId]])]),e("div",null,[w[17]||(w[17]=e("label",{for:"standupSearchFilter",class:"block text-sm font-medium text-gray-700 mb-1"},"Search Content",-1)),e("div",xl,[ve(e("input",{type:"text",id:"standupSearchFilter","onUpdate:modelValue":w[6]||(w[6]=C=>u.search=C),class:"focus:ring-indigo-500 focus:border-indigo-500 block w-full pr-10 sm:text-sm border-gray-300 rounded-md",placeholder:"Search in standup content...",onInput:T},null,544),[[we,u.search]]),w[16]||(w[16]=e("div",{class:"absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none"},[e("svg",{class:"h-5 w-5 text-gray-400",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},[e("path",{"fill-rule":"evenodd",d:"M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z","clip-rule":"evenodd"})])],-1))])])]),e("div",{class:"mt-3 flex justify-end"},[e("button",{type:"button",class:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",onClick:S}," Reset Filters ")])])):D("",!0),l.value?(i(),r("div",kl,"Loading standups...")):m.value?(i(),r("div",Dl,g(m.value),1)):n.value==="list"?(i(),r("div",Cl,[M.value.length?(i(),r("div",$l,[(i(!0),r(X,null,ae(M.value,C=>{var W,J;return i(),r("div",{key:C.id,class:"p-4 bg-blue-50 rounded-md shadow-sm hover:bg-blue-100 transition-colors border-l-4 border-blue-500"},[C.content==="[Encrypted content could not be decrypted]"?(i(),r("div",jl,[e("div",Tl,[e("p",El,[q(g(C.content),1),w[18]||(w[18]=e("span",{class:"text-xs text-red-400 block mt-1"},"(There was an issue decrypting this standup. Please contact an administrator.)",-1))]),e("div",Ml,[e("p",Sl,"Submitted by "+g(((W=C.user)==null?void 0:W.name)||"Unknown")+" on "+g(H(ue)(C.created_at).format("L")),1)])])])):(i(),r("div",Vl,[e("div",Al,[e("div",Il,[w[19]||(w[19]=e("h3",{class:"text-md font-bold text-gray-800"},"Daily Standup",-1)),e("span",Ll,g(O(C.content).date),1)]),e("div",Ol,[w[20]||(w[20]=e("div",{class:"flex items-center mb-1"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 text-blue-600 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})]),e("span",{class:"font-semibold text-sm text-gray-700"},"Yesterday:")],-1)),e("p",Ul,g(O(C.content).yesterday),1)]),e("div",Pl,[w[21]||(w[21]=e("div",{class:"flex items-center mb-1"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 text-green-600 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})]),e("span",{class:"font-semibold text-sm text-gray-700"},"Today:")],-1)),e("p",Nl,g(O(C.content).today),1)]),e("div",Rl,[w[22]||(w[22]=e("div",{class:"flex items-center mb-1"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 text-red-600 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})]),e("span",{class:"font-semibold text-sm text-gray-700"},"Blockers:")],-1)),e("p",Fl,g(O(C.content).blockers),1)]),e("div",Bl,[e("p",Hl,"Submitted by "+g(((J=C.user)==null?void 0:J.name)||"Unknown")+" on "+g(H(ue)(C.created_at).format("L")),1)])])]))])}),128))])):(i(),r("p",Wl,"No daily standups found for the selected criteria."))])):n.value==="calendar"?(i(),r("div",Yl,[e("div",zl,[e("button",{onClick:p,class:"p-2 rounded-full bg-gray-100 hover:bg-gray-200 transition-colors"},w[23]||(w[23]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])),e("h3",ql,g(c.value?H(ue)(c.value).format("MMMM YYYY"):"Loading..."),1),e("button",{onClick:f,class:"p-2 rounded-full bg-gray-100 hover:bg-gray-200 transition-colors"},w[24]||(w[24]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)]))]),v(H(pl),{class:"vuecal--blue-theme","active-view":"month",events:k.value,"selected-date":c.value,"hide-title-bar":"","disable-views":["week","day","years","year"],twelveHour:!0,"time-from":480,"time-to":1200,"time-step":30,"events-on-month-view":"short"},{event:B(({event:C})=>[e("div",{class:"vuecal__event-title",innerHTML:C.title},null,8,Zl),e("div",{class:"vuecal__event-content",innerHTML:C.content},null,8,Gl)]),"cell-content":B(({view:C,date:W})=>[C.id==="month"?(i(),r(X,{key:0},[W&&I(W)&&E(W)&&!k.value.some(J=>L(J.start,W))?(i(),r("div",Kl," No standups ")):D("",!0)],64)):D("",!0)]),_:1},8,["events","selected-date"]),w[26]||(w[26]=ms('<div class="mt-4 flex items-center space-x-4 text-sm"><div class="flex items-center"><span class="inline-block w-3 h-3 bg-blue-50 border-l-2 border-blue-500 mr-1"></span><span>Standup submitted</span></div><div class="flex items-center"><span class="inline-block w-3 h-3 bg-red-50 border-l-2 border-red-500 mr-1"></span><span>Missing standup</span></div></div>',1)),e("div",Jl,[w[25]||(w[25]=e("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"Standups Outside Current Month View",-1)),Object.entries($.value).some(([C])=>!H(ue)(C).isSame(c.value,"month"))?(i(),r("div",Xl,[(i(!0),r(X,null,ae(Object.entries($.value).filter(([C])=>!H(ue)(C).isSame(c.value,"month")).sort((C,W)=>H(ue)(C[0]).valueOf()-H(ue)(W[0]).valueOf()),([C,W])=>(i(),r("div",{key:C,class:"mb-4"},[e("div",Ql,g(H(ue)(C).format("dddd, MMMM Do YYYY")),1),(i(!0),r(X,null,ae(W,J=>{var V;return i(),r("div",{key:J.id,class:"p-2 mb-2 rounded bg-blue-50 border-l-2 border-blue-500"},[e("div",ei,g(((V=J.user)==null?void 0:V.name)||"Unknown"),1),e("div",ti,g(H(ue)(J.created_at).format("LT")),1)])}),128))]))),128))])):(i(),r("div",si,"No standups outside the current month view."))])])):D("",!0),v(Ct,{show:o.value,onClose:w[7]||(w[7]=C=>o.value=!1),onStandupAdded:A,projectId:s.projectId},null,8,["show","projectId"])]))}},li={class:"grid grid-cols-1 md:grid-cols-2 gap-8 mt-6"},ii={class:"space-y-6"},oi={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},ni={class:"flex items-center"},ri={class:"flex items-center"},di={class:"space-y-6 bg-gray-50 p-6 rounded-lg shadow-inner border border-gray-200"},ui={class:"space-y-4"},ci={class:"text-gray-900 font-medium break-words"},mi={class:"text-gray-900"},vi={key:0,class:"text-xs text-gray-500 mt-1"},pi={key:0},hi={class:"text-gray-900 whitespace-pre-wrap"},gi={key:1},fi={class:"flex flex-wrap gap-2"},yi={key:2},bi={class:"text-gray-900"},_i={class:"list-disc list-inside space-y-1 text-gray-900"},wi={key:0},xi={key:1},ki={key:2},Di={__name:"MeetingModal",props:{show:{type:Boolean,default:!1},projectId:{type:Number,required:!0},projectUsers:{type:Array,default:()=>[]},projectName:{type:String,default:"Project"}},emits:["close","saved"],setup(s,{emit:t}){const a=s,n=t,o=()=>Intl.DateTimeFormat().resolvedOptions().timeZone,l=["Africa/Cairo","Africa/Johannesburg","Africa/Lagos","America/Anchorage","America/Bogota","America/Chicago","America/Denver","America/Los_Angeles","America/Mexico_City","America/New_York","America/Phoenix","America/Sao_Paulo","America/Toronto","America/Vancouver","Asia/Dubai","Asia/Hong_Kong","Asia/Jerusalem","Asia/Kolkata","Asia/Seoul","Asia/Shanghai","Asia/Singapore","Asia/Tokyo","Australia/Melbourne","Australia/Perth","Australia/Sydney","Europe/Amsterdam","Europe/Berlin","Europe/Dublin","Europe/Istanbul","Europe/London","Europe/Madrid","Europe/Moscow","Europe/Paris","Europe/Rome","Pacific/Auckland","Pacific/Honolulu","UTC","GMT","Europe/Belfast","America/Adak","America/Boise","America/Detroit","America/Indianapolis","America/Juneau","America/Louisville","America/Menominee","America/Nome","America/Sitka","America/Yakutat","Asia/Karachi","Asia/Kolkata","Pacific/Auckland","Pacific/Chatham","Europe/Athens","Europe/Brussels","Europe/Budapest","Europe/Copenhagen","Europe/Helsinki","Europe/Lisbon","Europe/Oslo","Europe/Stockholm","Europe/Zurich","Europe/Vienna","Europe/Warsaw","Europe/Zurich","Europe/Sofia","Europe/Prague","Europe/Malta","Europe/Luxembourg","Europe/Kiev","Europe/Rome"].sort(),m=F(()=>l.map(I=>({value:I,label:I}))),d=F(()=>{const I=o(),E=l.includes(I);return console.log("DEBUG: Is detected timezone in list?",E,"Detected:",I),E?I:(console.log("DEBUG: Falling back to UTC for timezone as detected timezone not in list."),"UTC")}),c=De({summary:"",description:"",start_datetime:"",end_datetime:"",attendee_user_ids:[],location:"",with_google_meet:!0,timezone:d.value,enable_recording:!1}),u=F({get(){return c.summary?`${c.summary} - ${a.projectName}`:""},set(I){const E=` - ${a.projectName}`;I.endsWith(E)?c.summary=I.slice(0,-E.length):c.summary=I}}),h=()=>{c.summary="",c.description="",c.attendee_user_ids=[],c.location="",c.with_google_meet=!0,c.timezone=d.value,c.enable_recording=!1,T(),console.log("DEBUG: Form reset. Current timezone in form:",c.timezone)},x=I=>{const E=new Date(I),L=E.getFullYear(),O=String(E.getMonth()+1).padStart(2,"0"),$=String(E.getDate()).padStart(2,"0"),y=String(E.getHours()).padStart(2,"0"),w=String(E.getMinutes()).padStart(2,"0");return`${L}-${O}-${$}T${y}:${w}`},T=()=>{const I=new Date,E=new Date(I.getTime()+3600*1e3),L=new Date(I.getTime()+7200*1e3);c.start_datetime=x(E),c.end_datetime=x(L),console.log("DEBUG: Default times set. Start:",c.start_datetime,"End:",c.end_datetime)};T(),ne(()=>a.show,I=>{I&&h()},{immediate:!0});const A=I=>I?(console.log(I),I.replace("T"," ")+":00"):"",_=I=>{const E={...I};return E.summary=u.value,E.start_datetime=A(I.start_datetime),E.end_datetime=A(I.end_datetime),console.log(E),E},S=F(()=>`/api/projects/${a.projectId}/meetings`),p=I=>{n("saved",I)},f=I=>{console.error("DEBUG: MeetingModal submission error:",I)},k=F(()=>{if(!c.start_datetime||!c.end_datetime)return"";const I=new Date(c.start_datetime),E=new Date(c.end_datetime),L={weekday:"long",year:"numeric",month:"long",day:"numeric"},O={hour:"2-digit",minute:"2-digit"},$=I.toLocaleDateString(void 0,L),y=I.toLocaleTimeString(void 0,O),w=E.toLocaleTimeString(void 0,O);return I.toDateString()===E.toDateString()?`${$}, ${y} - ${w}`:`${$} ${y} - ${E.toLocaleDateString(void 0,L)} ${w}`}),M=F(()=>a.projectUsers.filter(I=>c.attendee_user_ids.includes(I.id)).map(I=>I.name));return(I,E)=>(i(),Q(Te,{show:s.show,title:"Schedule a Meeting","api-endpoint":S.value,"http-method":"post","form-data":c,"format-data-for-api":_,"submit-button-text":"Schedule Meeting","success-message":"Meeting scheduled successfully!",onClose:E[9]||(E[9]=L=>I.$emit("close")),onSubmitted:p,onError:f},{default:B(({errors:L})=>[e("div",li,[e("div",ii,[e("div",null,[v(G,{for:"summary",value:"Meeting Title"}),E[10]||(E[10]=e("p",{class:"mt-1 text-sm text-gray-500 mb-2"}," Enter a short, descriptive title for the meeting (e.g., Project Standup). The project name will be added automatically. ",-1)),v(re,{id:"summary",modelValue:c.summary,"onUpdate:modelValue":E[0]||(E[0]=O=>c.summary=O),type:"text",class:"mt-1 block w-full",placeholder:"e.g., Project Standup",required:""},null,8,["modelValue"]),v(ie,{message:L.summary?L.summary[0]:"",class:"mt-2"},null,8,["message"])]),e("div",null,[v(G,{for:"description",value:"Description"}),E[11]||(E[11]=e("p",{class:"mt-1 text-sm text-gray-500 mb-2"}," Enter a short, descriptive agenda of the meeting. ",-1)),ve(e("textarea",{id:"description","onUpdate:modelValue":E[1]||(E[1]=O=>c.description=O),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",rows:"3",placeholder:"Meeting agenda and details..."},null,512),[[we,c.description]]),v(ie,{message:L.description?L.description[0]:"",class:"mt-2"},null,8,["message"])]),e("div",oi,[e("div",null,[v(G,{for:"start_datetime",value:"Start Date & Time"}),v(re,{id:"start_datetime",modelValue:c.start_datetime,"onUpdate:modelValue":E[2]||(E[2]=O=>c.start_datetime=O),type:"datetime-local",class:"mt-1 block w-full",required:""},null,8,["modelValue"]),v(ie,{message:L.start_datetime?L.start_datetime[0]:"",class:"mt-2"},null,8,["message"])]),e("div",null,[v(G,{for:"end_datetime",value:"End Date & Time"}),v(re,{id:"end_datetime",modelValue:c.end_datetime,"onUpdate:modelValue":E[3]||(E[3]=O=>c.end_datetime=O),type:"datetime-local",class:"mt-1 block w-full",required:""},null,8,["modelValue"]),v(ie,{message:L.end_datetime?L.end_datetime[0]:"",class:"mt-2"},null,8,["message"])])]),e("div",null,[v(G,{for:"attendees",value:"Attendees"}),v(Oe,{id:"attendees",modelValue:c.attendee_user_ids,"onUpdate:modelValue":E[4]||(E[4]=O=>c.attendee_user_ids=O),options:a.projectUsers,"label-key":"name","track-by":"id",placeholder:"Select attendees",class:"mt-1"},null,8,["modelValue","options"]),E[12]||(E[12]=e("p",{class:"mt-1 text-sm text-gray-500"}," Select project members to invite to this meeting ",-1)),v(ie,{message:L.attendee_user_ids?L.attendee_user_ids[0]:"",class:"mt-2"},null,8,["message"])]),e("div",null,[v(G,{for:"location",value:"Location (Optional)"}),v(re,{id:"location",modelValue:c.location,"onUpdate:modelValue":E[5]||(E[5]=O=>c.location=O),type:"text",class:"mt-1 block w-full",placeholder:"Office, Conference Room, etc."},null,8,["modelValue"]),v(ie,{message:L.location?L.location[0]:"",class:"mt-2"},null,8,["message"])]),e("div",null,[v(G,{for:"timezone",value:"Timezone"}),v(me,{id:"timezone",modelValue:c.timezone,"onUpdate:modelValue":E[6]||(E[6]=O=>c.timezone=O),options:m.value,"value-key":"value","label-key":"label",placeholder:"Select timezone",class:"mt-1"},null,8,["modelValue","options"]),E[13]||(E[13]=e("p",{class:"mt-1 text-sm text-gray-500"}," Select your timezone for this meeting ",-1)),v(ie,{message:L.timezone?L.timezone[0]:"",class:"mt-2"},null,8,["message"])]),e("div",ni,[ve(e("input",{id:"with_google_meet","onUpdate:modelValue":E[7]||(E[7]=O=>c.with_google_meet=O),type:"checkbox",class:"h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"},null,512),[[at,c.with_google_meet]]),E[14]||(E[14]=e("label",{for:"with_google_meet",class:"ml-2 block text-sm text-gray-900"}," Create Google Meet video conference ",-1))]),e("div",ri,[ve(e("input",{id:"enable_recording","onUpdate:modelValue":E[8]||(E[8]=O=>c.enable_recording=O),type:"checkbox",class:"h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"},null,512),[[at,c.enable_recording]]),E[15]||(E[15]=e("label",{for:"enable_recording",class:"ml-2 block text-sm text-gray-900"}," Enable recording and transcript ",-1))])]),e("div",di,[E[22]||(E[22]=e("h4",{class:"text-xl font-bold text-gray-800"},"Meeting Preview",-1)),e("div",ui,[e("div",null,[E[16]||(E[16]=e("h5",{class:"font-semibold text-sm text-gray-600 mb-1"},"Title",-1)),e("p",ci,g(u.value||"Untitled Meeting"),1)]),e("div",null,[E[17]||(E[17]=e("h5",{class:"font-semibold text-sm text-gray-600 mb-1"},"Date & Time",-1)),e("p",mi,g(k.value||"No date and time selected."),1),c.timezone?(i(),r("p",vi,"Timezone: "+g(c.timezone),1)):D("",!0)]),c.description?(i(),r("div",pi,[E[18]||(E[18]=e("h5",{class:"font-semibold text-sm text-gray-600 mb-1"},"Description",-1)),e("p",hi,g(c.description),1)])):D("",!0),M.value.length>0?(i(),r("div",gi,[E[19]||(E[19]=e("h5",{class:"font-semibold text-sm text-gray-600 mb-1"},"Attendees",-1)),e("div",fi,[(i(!0),r(X,null,ae(M.value,O=>(i(),r("span",{key:O,class:"px-3 py-1 rounded-full text-xs font-medium bg-indigo-100 text-indigo-800"},g(O),1))),128))])])):D("",!0),c.location?(i(),r("div",yi,[E[20]||(E[20]=e("h5",{class:"font-semibold text-sm text-gray-600 mb-1"},"Location",-1)),e("p",bi,g(c.location),1)])):D("",!0),e("div",null,[E[21]||(E[21]=e("h5",{class:"font-semibold text-sm text-gray-600 mb-1"},"Options",-1)),e("ul",_i,[c.with_google_meet?(i(),r("li",wi,"Google Meet enabled")):D("",!0),c.enable_recording?(i(),r("li",xi,"Recording and transcript enabled")):D("",!0),!c.with_google_meet&&!c.enable_recording?(i(),r("li",ki,"No special options selected.")):D("",!0)])])])])])]),_:1},8,["show","api-endpoint","form-data"]))}},Ci=Me(Di,[["__scopeId","data-v-674b7e2a"]]),$i={class:"p-6"},ji={key:0,class:"mb-4 p-3 bg-green-100 text-green-800 rounded-md"},Ti={key:1,class:"mb-4 p-3 bg-red-100 text-red-800 rounded-md"},Ei={class:"mb-4"},Mi=["value"],Si={class:"mt-6 flex justify-end space-x-3"},Vi={__name:"ProjectMagicLinkModal",props:{show:{type:Boolean,default:!1},projectId:{type:Number,required:!0},projectClients:{type:Array,default:()=>[]}},emits:["close"],setup(s,{emit:t}){const a=s,n=t,o=b(!1),l=b(""),m=b(""),d=b(""),c=async()=>{var h,x;if(!l.value){d.value="Please select a client email";return}o.value=!0,m.value="",d.value="";try{const T=await window.axios.post(`/api/projects/${a.projectId}/magic-link`,{email:l.value});T.data.success?(m.value=T.data.message,l.value=""):d.value=T.data.message||"Failed to send magic link"}catch(T){console.error("Error sending magic link:",T),d.value=((x=(h=T.response)==null?void 0:h.data)==null?void 0:x.message)||"An error occurred while sending the magic link"}finally{o.value=!1}},u=()=>{l.value="",m.value="",d.value="",n("close")};return(h,x)=>(i(),Q(je,{show:s.show,onClose:u},{default:B(()=>[e("div",$i,[e("div",{class:"flex justify-between items-center mb-4"},[x[2]||(x[2]=e("h3",{class:"text-lg font-semibold text-gray-900"},"Send Magic Link to Client",-1)),e("button",{onClick:u,class:"text-gray-400 hover:text-gray-500"},x[1]||(x[1]=[e("svg",{class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),m.value?(i(),r("div",ji,g(m.value),1)):D("",!0),d.value?(i(),r("div",Ti,g(d.value),1)):D("",!0),e("div",Ei,[v(G,{for:"client-email",value:"Select Client"}),ve(e("select",{id:"client-email","onUpdate:modelValue":x[0]||(x[0]=T=>l.value=T),class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full"},[x[3]||(x[3]=e("option",{value:""},"Select a client",-1)),(i(!0),r(X,null,ae(s.projectClients,T=>(i(),r("option",{key:T.id,value:T.email},g(T.name)+" ("+g(T.email)+") ",9,Mi))),128))],512),[[qe,l.value]]),x[4]||(x[4]=e("p",{class:"mt-2 text-sm text-gray-500"}," The magic link will be sent to the selected client's email address. ",-1))]),e("div",Si,[v(fe,{onClick:u,type:"button"},{default:B(()=>x[5]||(x[5]=[q(" Cancel ",-1)])),_:1,__:[5]}),v(ce,{onClick:c,disabled:o.value||!l.value,class:"bg-purple-600 hover:bg-purple-700"},{default:B(()=>[q(g(o.value?"Sending...":"Send Magic Link"),1)]),_:1},8,["disabled"])])])]),_:1},8,["show"]))}},Ai={class:"mt-6 space-y-6"},Ii={class:"mt-2 flex space-x-4"},Li={class:"inline-flex items-center"},Oi={class:"inline-flex items-center"},Ui={key:0},Pi={key:1},Ni=["required"],Ri={__name:"ResourceModal",props:{show:{type:Boolean,default:!1},projectId:{type:Number,required:!0},resource:{type:Object,default:null}},emits:["close","saved"],setup(s,{emit:t}){const a=s,n=t,o=b({name:"",type:"link",url:"",file:null,description:""}),l=b(null),m=F(()=>a.resource?`/api/projects/${a.projectId}/resources/${a.resource.id}`:`/api/projects/${a.projectId}/resources`),d=F(()=>a.resource?"put":"post"),c=F(()=>a.resource?"Update Resource":"Add Resource"),u=F(()=>a.resource?"Resource updated successfully!":"Resource added successfully!");ne(()=>a.show,_=>{_&&(a.resource?o.value={name:a.resource.name,type:a.resource.type,url:a.resource.type==="link"?a.resource.url:"",file:null,description:a.resource.description||""}:o.value={name:"",type:"link",url:"",file:null,description:""},l.value&&(l.value.value=""))},{immediate:!0});const h=_=>{o.value.file=_.target.files[0]||null},x=_=>{const S=new FormData;return S.append("name",_.name||""),S.append("type",_.type||"link"),S.append("description",_.description||""),_.type==="link"?S.append("url",_.url||""):_.type==="file"&&_.file&&S.append("file",_.file),(d.value==="put"||d.value==="patch")&&S.append("_method","PUT"),S},T=_=>{n("saved",_.resource)},A=()=>{n("close")};return(_,S)=>(i(),Q(Te,{show:s.show,title:s.resource?"Edit Resource":"Add Resource","api-endpoint":m.value,"http-method":d.value,"form-data":o.value,"submit-button-text":c.value,"success-message":u.value,"format-data-for-api":x,onClose:A,onSubmitted:T},{default:B(({errors:p})=>[e("div",Ai,[e("div",null,[v(G,{for:"resource-type",value:"Resource Type"}),e("div",Ii,[e("label",Li,[ve(e("input",{type:"radio","onUpdate:modelValue":S[0]||(S[0]=f=>o.value.type=f),value:"link",class:"form-radio text-indigo-600"},null,512),[[ft,o.value.type]]),S[5]||(S[5]=e("span",{class:"ml-2 text-gray-700"},"Link",-1))]),e("label",Oi,[ve(e("input",{type:"radio","onUpdate:modelValue":S[1]||(S[1]=f=>o.value.type=f),value:"file",class:"form-radio text-indigo-600"},null,512),[[ft,o.value.type]]),S[6]||(S[6]=e("span",{class:"ml-2 text-gray-700"},"File",-1))])])]),e("div",null,[v(G,{for:"resource-name",value:"Name"}),v(re,{id:"resource-name",modelValue:o.value.name,"onUpdate:modelValue":S[2]||(S[2]=f=>o.value.name=f),type:"text",class:"mt-1 block w-full",placeholder:"Enter resource name",required:""},null,8,["modelValue"]),v(ie,{message:p.name?p.name[0]:"",class:"mt-2"},null,8,["message"])]),o.value.type==="link"?(i(),r("div",Ui,[v(G,{for:"resource-url",value:"URL"}),v(re,{id:"resource-url",modelValue:o.value.url,"onUpdate:modelValue":S[3]||(S[3]=f=>o.value.url=f),type:"url",class:"mt-1 block w-full",placeholder:"https://example.com",required:""},null,8,["modelValue"]),v(ie,{message:p.url?p.url[0]:"",class:"mt-2"},null,8,["message"])])):D("",!0),o.value.type==="file"?(i(),r("div",Pi,[v(G,{for:"resource-file",value:"File"}),e("input",{id:"resource-file",ref_key:"fileInputRef",ref:l,type:"file",class:"mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100",onChange:h,required:!s.resource||o.value.type==="file"},null,40,Ni),v(ie,{message:p.file?p.file[0]:"",class:"mt-2"},null,8,["message"])])):D("",!0),e("div",null,[v(G,{for:"resource-description",value:"Description (Optional)"}),ve(e("textarea",{id:"resource-description","onUpdate:modelValue":S[4]||(S[4]=f=>o.value.description=f),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",rows:"3",placeholder:"Enter a description for this resource"},null,512),[[we,o.value.description]]),v(ie,{message:p.description?p.description[0]:"",class:"mt-2"},null,8,["message"])])])]),_:1},8,["show","title","api-endpoint","http-method","form-data","submit-button-text","success-message"]))}},Fi=Me(Ri,[["__scopeId","data-v-f508dda8"]]),Bi={class:"flex flex-col space-y-6"},Hi={class:"grid grid-cols-1 sm:grid-cols-2 gap-6"},Wi={key:0},Yi={key:0,class:"text-xs text-gray-500 mt-1"},zi={key:0,class:"text-xs text-gray-500 mt-1"},qi={key:0},Zi={class:"grid grid-cols-1 sm:grid-cols-2 gap-6"},Gi={class:"mb-4"},Ki={key:0,class:"text-xs text-gray-500 mt-1"},Ji={key:0,class:"text-xs text-gray-500 mt-1"},Xi={class:"flex justify-between items-center mb-3"},Qi={key:0,class:"flex items-center"},eo={key:1},to={class:"bg-gray-100 p-4 rounded-lg shadow-inner min-h-[300px]"},so={key:0,class:"flex items-center justify-center h-full"},ao=["innerHTML"],lo={__name:"ComposeEmailModal",props:{show:{type:Boolean,default:!1},projectId:{type:Number,required:!1,default:null},clients:{type:Array,default:()=>[]}},emits:["close"],setup(s,{emit:t}){const a=s,n=t,o=b([]),l=b([]),m=b(!1),d=b([]),c=b(!1),u=b(""),h=b(!1),x=b({}),T=b({}),A=b(!1),_=De({template_id:null,template_data:{},project_id:a.projectId||null,client_ids:[],subject:"",greeting_name:"",custom_greeting_name:"",status:"pending_approval"});Xe(_.project_id);const S=F(()=>o.value.find(C=>C.id===_.template_id)),p=async C=>{if(!_.project_id){console.error("Cannot fetch source model data: No project selected");return}A.value=!0,T.value={};const W=new Set;C.placeholders.forEach(J=>{(J.is_repeatable||J.is_selectable)&&J.source_model&&W.add(J.source_model)});try{const J=Array.from(W).map(V=>{const R=V.split("\\").pop(),Z=`/api/projects/${_.project_id}/model-data/${R}`;return window.axios.get(Z).then(P=>{T.value[R]=P.data})});await Promise.all(J)}catch(J){console.error("Failed to fetch source model data:",J)}finally{A.value=!1}},f=async()=>{try{const C=await window.axios.get("/api/email-templates");o.value=C.data}catch(C){console.error("Failed to fetch email templates:",C)}},k=async()=>{if(!_.template_id||_.client_ids.length===0||!_.project_id){u.value='<p class="text-gray-500 italic">Select a project, template, and at least one recipient to see a preview.</p>';return}h.value=!0;try{const C=_.client_ids[0],W=typeof C=="object"?C.id:C,J=await window.axios.post(`/api/projects/${_.project_id}/email-preview`,{template_id:_.template_id,client_id:W,template_data:_.template_data});u.value=J.data.body_html,J.data.subject&&(_.subject=J.data.subject)}catch(C){console.error("Failed to fetch email preview:",C),u.value='<p class="text-red-500 italic">Error loading preview.</p>'}finally{h.value=!1}};ne(()=>a.show,C=>{C&&(Object.assign(_,{template_id:null,template_data:{},project_id:a.projectId||null,client_ids:[],subject:"",greeting_name:"",custom_greeting_name:"",status:"pending_approval"}),u.value="",x.value={},T.value={},f(),a.projectId||y())}),ne(S,C=>{_.template_data={},C&&C.placeholders&&(C.placeholders.forEach(W=>{W.is_dynamic?_.template_data[W.name]="":(W.is_repeatable||W.is_selectable)&&(W.is_repeatable?_.template_data[W.name]=[]:_.template_data[W.name]=null)}),p(C))});const M=async()=>{if(Array.isArray(_.client_ids)&&_.client_ids.length>0&&typeof _.client_ids[0]=="object"&&(_.client_ids=_.client_ids.map(C=>C.id)),!_.subject&&S.value&&(_.subject=S.value.subject||""),_.client_ids.length>0){const C=_.client_ids[0],J=(a.clients.length>0?a.clients:d.value).find(V=>V.id===C);J&&(_.greeting_name=J.name||"")}return console.log("Form data prepared:",JSON.stringify(_)),!0},I=()=>{n("close")},E=()=>{n("close")},L=F(()=>o.value.map(C=>({value:C.id,label:C.name}))),O=F(()=>S.value?S.value.placeholders.filter(C=>C.is_dynamic||C.is_repeatable||C.is_selectable):[]),$=F(()=>"/api/emails/templated"),y=async()=>{m.value=!0;try{const C=await window.axios.get("/api/projects-simplified");l.value=C.data}catch(C){console.error("Failed to fetch projects:",C)}finally{m.value=!1}},w=async C=>{if(C){c.value=!0,d.value=[];try{const W=await window.axios.get(`/api/projects/${C}/sections/clients?type=clients`);d.value=W.data}catch(W){console.error("Failed to fetch clients:",W)}finally{c.value=!1}}};return ne(()=>_.project_id,C=>{_.template_id=null,_.template_data={},_.client_ids=[],u.value="",C?w(C):d.value=[]}),be(()=>{f(),a.projectId||y()}),(C,W)=>(i(),Q(Te,{show:s.show,title:"Compose Email from Template","api-endpoint":$.value,"http-method":"post","form-data":_,"submit-button-text":"Submit for Approval","success-message":"Email submitted for approval successfully!",onClose:E,onSubmitted:I,"before-submit":M},{default:B(({errors:J})=>[e("div",Bi,[e("div",Hi,[a.projectId?D("",!0):(i(),r("div",Wi,[v(G,{for:"project",value:"Select Project"}),v(me,{id:"project",modelValue:_.project_id,"onUpdate:modelValue":W[0]||(W[0]=V=>_.project_id=V),options:l.value,placeholder:"Select a project","value-key":"id","label-key":"name","allow-empty":!0,class:"mt-1"},null,8,["modelValue","options"]),m.value?(i(),r("div",Yi," Loading projects... ")):D("",!0),v(ie,{message:J.project_id?J.project_id[0]:"",class:"mt-2"},null,8,["message"])])),e("div",null,[v(G,{for:"template",value:"Select Template"}),v(me,{id:"template",modelValue:_.template_id,"onUpdate:modelValue":W[1]||(W[1]=V=>_.template_id=V),options:L.value,placeholder:"Select a template","value-key":"value","label-key":"label","allow-empty":!0,class:"mt-1"},null,8,["modelValue","options"]),v(ie,{message:J.template_id?J.template_id[0]:"",class:"mt-2"},null,8,["message"])]),e("div",null,[v(G,{for:"client_ids",value:"Recipients"}),v(Oe,{id:"client_ids",modelValue:_.client_ids,"onUpdate:modelValue":W[2]||(W[2]=V=>_.client_ids=V),options:a.clients.length>0?a.clients:d.value,placeholder:"Select clients to send to","label-key":"name","track-by":"id","preserve-search":!0,"object-value":!0,class:"mt-1"},null,8,["modelValue","options"]),c.value?(i(),r("div",zi," Loading clients... ")):D("",!0),v(ie,{message:J.client_ids?J.client_ids[0]:"",class:"mt-2"},null,8,["message"])])]),S.value?(i(),r("div",qi,[W[3]||(W[3]=e("h4",{class:"text-md font-semibold text-gray-800 mb-3"},"Dynamic Placeholders",-1)),e("div",Zi,[(i(!0),r(X,null,ae(O.value,V=>(i(),r("div",{key:V.id},[e("div",Gi,[v(G,{for:V.name,value:V.name},null,8,["for","value"]),V.is_repeatable&&V.source_model?(i(),r(X,{key:0},[v(Oe,{id:V.name,modelValue:_.template_data[V.name],"onUpdate:modelValue":R=>_.template_data[V.name]=R,options:T.value[V.source_model.split("\\").pop()]||[],placeholder:`Select one or more ${V.name}`,"label-key":V.source_attribute,"track-by":"id",class:"mt-1"},null,8,["id","modelValue","onUpdate:modelValue","options","placeholder","label-key"]),A.value?(i(),r("div",Ki," Loading "+g(V.source_model.split("\\").pop())+"... ",1)):D("",!0)],64)):V.is_selectable&&V.source_model?(i(),r(X,{key:1},[v(me,{id:V.name,modelValue:_.template_data[V.name],"onUpdate:modelValue":R=>_.template_data[V.name]=R,options:T.value[V.source_model.split("\\").pop()]||[],placeholder:`Select a ${V.name}`,"value-key":V.trackBy??"id","label-key":V.source_attribute,"allow-empty":!0,class:"mt-1"},null,8,["id","modelValue","onUpdate:modelValue","options","placeholder","value-key","label-key"]),A.value?(i(),r("div",Ji," Loading "+g(V.source_model.split("\\").pop())+"... ",1)):D("",!0)],64)):V.is_dynamic&&V.is_link?(i(),Q(re,{key:2,id:V.name,type:"url",class:"mt-1 block w-full",modelValue:_.template_data[V.name],"onUpdate:modelValue":R=>_.template_data[V.name]=R,placeholder:"Enter URL"},null,8,["id","modelValue","onUpdate:modelValue"])):(i(),Q(re,{key:3,id:V.name,type:"text",class:"mt-1 block w-full",modelValue:_.template_data[V.name],"onUpdate:modelValue":R=>_.template_data[V.name]=R},null,8,["id","modelValue","onUpdate:modelValue"])),v(ie,{message:J[`template_data.${V.name}`]?J[`template_data.${V.name}`][0]:"",class:"mt-2"},null,8,["message"])])]))),128))])])):D("",!0),e("div",null,[e("div",Xi,[W[5]||(W[5]=e("h4",{class:"text-md font-semibold text-gray-800"},"Email Preview",-1)),v(ce,{onClick:k,disabled:!_.project_id||!_.template_id||_.client_ids.length===0||h.value,class:te({"opacity-50 cursor-not-allowed":!_.project_id||!_.template_id||_.client_ids.length===0||h.value})},{default:B(()=>[h.value?(i(),r("span",Qi,W[4]||(W[4]=[e("svg",{class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),q(" Loading... ",-1)]))):(i(),r("span",eo," Refresh Preview "))]),_:1},8,["disabled","class"])]),e("div",to,[h.value?(i(),r("div",so,W[6]||(W[6]=[e("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-500"},null,-1)]))):(i(),r("div",{key:1,innerHTML:u.value},null,8,ao))])])])]),_:1},8,["show","api-endpoint","form-data"]))}},io={class:"bg-white p-8 rounded-2xl shadow-xl border border-gray-200"},oo={class:"flex flex-col lg:flex-row justify-between lg:items-center mb-6 border-b pb-4 border-gray-200"},no={class:"flex-1"},ro={class:"text-3xl font-extrabold text-gray-900 tracking-tight"},uo={class:"mt-2 flex flex-wrap items-center gap-x-4 gap-y-2 text-sm text-gray-500"},co={class:"text-gray-600 font-medium"},mo={class:"flex items-center gap-2"},vo=["href"],po=["href"],ho=["href"],go={class:"mt-4 lg:mt-0 flex flex-wrap gap-2"},fo={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8"},yo={class:"col-span-1 md:col-span-2"},bo={class:"text-gray-600 text-base leading-relaxed"},_o={class:"mt-6 flex flex-wrap gap-2 items-center"},wo={class:"mt-6"},xo={key:0,class:"text-gray-500 text-sm"},ko={key:1,class:"text-gray-400 text-sm"},Do={key:2,class:"flex flex-wrap gap-3 items-center"},Co=["onClick"],$o={key:0,class:"resource-tooltip absolute left-1/2 bottom-full mb-2 w-64 z-10 -translate-x-1/2"},jo={class:"bg-white rounded-xl shadow-xl p-4 text-sm border border-gray-200"},To={class:"flex justify-between items-center mb-2"},Eo={class:"font-bold text-gray-900"},Mo={key:0,class:"text-gray-600 text-xs mb-2"},So=["href"],Vo={class:"flex justify-end space-x-2 mt-2 pt-2 border-t border-gray-100"},Ao=["onClick"],Io=["onClick"],Lo={class:"col-span-1 border-l border-gray-200 pl-8"},Oo={key:0,class:"text-gray-500 text-sm"},Uo={key:1,class:"text-gray-500 text-sm"},Po={key:2,class:"space-y-3 max-h-[300px] overflow-y-auto"},No={class:"font-medium text-gray-900 truncate"},Ro={class:"text-sm text-gray-600"},Fo={class:"flex space-x-2 mt-2"},Bo=["href"],Ho=["href"],Wo={class:"p-6"},Yo={key:0,class:"mb-4 p-4 bg-green-50 border border-green-200 text-green-700 rounded-md"},zo={key:1,class:"mb-4 p-4 bg-red-50 border border-red-200 text-red-700 rounded-md"},qo={class:"mb-4"},Zo={key:0,class:"text-gray-500 text-sm mt-1"},Go={key:1,class:"text-red-500 text-sm mt-1"},Ko={class:"flex justify-end mt-6"},Jo={__name:"ProjectGeneralInfoCard",props:{project:{type:Object,required:!0},projectId:{type:Number,required:!0},canManageProjects:{type:Boolean,required:!0},canEditProjects:{type:Boolean,required:!1},isSuperAdmin:{type:Boolean,required:!0}},emits:["openEditModal","openStandupModal","openMeetingModal","resourceSaved","openComposeModal"],setup(s,{emit:t}){const a=s,n=t,o=b(!1),l=b(null),m=b([]),d=b(!1),c=b(null),u=b(!1),h=b(!1),x=b(!1),T=b({client_ids:[]}),A=b({}),_=b(""),S=b([]),p=b(!1),f=b(""),k=b([]),M=b(!1),I=b("");Xe(a.projectId);const E=()=>{try{I.value=Intl.DateTimeFormat().resolvedOptions().timeZone}catch(Y){console.error("Error detecting user timezone:",Y),I.value="UTC"}},L=async()=>{M.value=!0;try{const Y=await window.axios.get(`/api/projects/${a.projectId}/meetings`);k.value=Y.data}catch(Y){console.error("Error fetching project meetings:",Y)}finally{M.value=!1}},O=Y=>{if(!Y)return"";try{const j={dateStyle:"medium",timeStyle:"short",timeZone:I.value};return new Date(Y).toLocaleString(void 0,j)}catch(j){return console.error("Error formatting meeting time:",j),new Date(Y).toLocaleString()}},$=async()=>{d.value=!0;try{const Y=await window.axios.get(`/api/projects/${a.projectId}/resources`);Y.data.success?m.value=Y.data.resources:console.error("Failed to fetch resources:",Y.data.message)}catch(Y){console.error("Error fetching resources:",Y)}finally{d.value=!1}},y=()=>{l.value=null,o.value=!0},w=Y=>{l.value=Y,o.value=!0},C=async Y=>{if(confirm("Are you sure you want to delete this resource?"))try{const j=await window.axios.delete(`/api/projects/${a.projectId}/resources/${Y}`);j.data.success?m.value=m.value.filter(U=>U.id!==Y):console.error("Failed to delete resource:",j.data.message)}catch(j){console.error("Error deleting resource:",j)}},W=Y=>{if(l.value){const j=m.value.findIndex(U=>U.id===Y.id);j!==-1&&(m.value[j]=Y)}else m.value.push(Y);n("resourceSaved",Y)},J=Y=>{c.value=c.value===Y?null:Y},V=()=>{c.value=null},R=Y=>{if(c.value!==null){const j=Y.target.closest(".resource-tooltip"),U=Y.target.closest(".resource-button");!j&&!U&&V()}};be(()=>{$(),E(),L(),document.addEventListener("click",R)}),vs(()=>{document.removeEventListener("click",R)});const Z=async()=>{var Y,j;p.value=!0,f.value="";try{const U=await window.axios.get(`/api/projects/${a.projectId}/sections/clients?type=clients`);S.value=U.data}catch(U){console.error("Failed to fetch project clients:",U),f.value=((j=(Y=U.response)==null?void 0:Y.data)==null?void 0:j.message)||"Failed to load client data."}finally{p.value=!1}},P=()=>{T.value.client_ids=[],A.value={},_.value="",h.value=!0,Z()},ee=()=>{u.value=!0,Z()},de=()=>{h.value=!1},xe=async()=>{if(A.value={},_.value="",x.value=!0,!T.value.client_ids||T.value.client_ids.length===0){A.value={client_ids:["Please select a client."]},x.value=!1;return}try{const Y=T.value.client_ids[0];if(!S.value.find(N=>N.id===Y)){A.value={client_ids:["Selected client does not have a valid email."]},x.value=!1;return}const U=await window.axios.post(`/api/projects/${a.projectId}/magic-link`,{client_id:Y});U.data.success&&(_.value=U.data.message,T.value.client_ids=[])}catch(Y){Y.response&&Y.response.status===422?A.value=Y.response.data.errors:Y.response&&Y.response.data.message?A.value={general:[Y.response.data.message]}:A.value={general:["An unexpected error occurred. Please try again."]}}finally{x.value=!1}};return(Y,j)=>{var U;return i(),r(X,null,[e("div",io,[e("div",oo,[e("div",no,[e("h2",ro,g(s.project.name),1),e("div",uo,[e("span",{class:te(["inline-flex items-center rounded-full px-3 py-0.5 text-xs font-semibold",{"bg-green-100 text-green-800":s.project.status==="active","bg-yellow-100 text-yellow-800":s.project.status==="on_hold","bg-blue-100 text-blue-800":s.project.status==="completed","bg-red-100 text-red-800":s.project.status==="archived"}])},g(((U=s.project.status)==null?void 0:U.replace("_"," ").toUpperCase())||"N/A"),3),j[11]||(j[11]=e("span",{class:"text-gray-600"},"|",-1)),e("span",co,g(s.project.project_type||"N/A"),1),j[12]||(j[12]=e("span",{class:"text-gray-600"},"|",-1)),e("div",mo,[s.project.website?(i(),r("a",{key:0,href:s.project.website,target:"_blank",class:"flex items-center text-sm text-indigo-600 hover:text-indigo-800 transition-colors",title:"Visit Website"},[v(H(zs),{class:"h-5 w-5 mr-1"}),j[8]||(j[8]=q(" Website ",-1))],8,vo)):D("",!0),s.project.social_media_link?(i(),r("a",{key:1,href:s.project.social_media_link,target:"_blank",class:"flex items-center text-sm text-indigo-600 hover:text-indigo-800 transition-colors",title:"Social Media"},[v(H(Gs),{class:"h-5 w-5 mr-1"}),j[9]||(j[9]=q(" Socials ",-1))],8,po)):D("",!0),s.project.google_drive_link?(i(),r("a",{key:2,href:s.project.google_drive_link,target:"_blank",class:"flex items-center text-sm text-indigo-600 hover:text-indigo-800 transition-colors",title:"Google Drive"},[v(H(Ws),{class:"h-5 w-5 mr-1"}),j[10]||(j[10]=q(" Drive ",-1))],8,ho)):D("",!0)])])]),e("div",go,[s.canEditProjects||s.isSuperAdmin?(i(),Q(ce,{key:0,onClick:j[0]||(j[0]=N=>Y.$inertia.visit("/projects/"+s.projectId+"/edit")),class:"bg-indigo-600 hover:bg-indigo-700 transition-colors"},{default:B(()=>[v(H($s),{class:"h-5 w-5 mr-2"}),j[13]||(j[13]=q(" Edit Project ",-1))]),_:1,__:[13]})):D("",!0),s.canManageProjects||s.isSuperAdmin?(i(),Q(fe,{key:1,onClick:j[1]||(j[1]=N=>n("openMeetingModal")),class:"bg-white border-gray-300 text-gray-700 hover:bg-gray-50"},{default:B(()=>[v(H(Bs),{class:"h-5 w-5 mr-2"}),j[14]||(j[14]=q(" Schedule Meeting ",-1))]),_:1,__:[14]})):D("",!0),v(fe,{onClick:j[2]||(j[2]=N=>n("openStandupModal")),class:"bg-white border-gray-300 text-gray-700 hover:bg-gray-50"},{default:B(()=>[v(H(Hs),{class:"h-5 w-5 mr-2"}),j[15]||(j[15]=q(" Daily Standup ",-1))]),_:1,__:[15]})])]),e("div",fo,[e("div",yo,[e("p",bo,g(s.project.description||"No description provided."),1),e("div",_o,[e("button",{onClick:y,class:"flex items-center p-2 rounded-full text-indigo-600 bg-indigo-50 hover:bg-indigo-100 transition-colors",title:"Add Resource"},[v(H(js),{class:"h-5 w-5"}),j[16]||(j[16]=e("span",{class:"ml-1 text-sm font-medium"},"Add Resource",-1))]),e("button",{onClick:P,class:"flex items-center p-2 rounded-full text-green-600 bg-green-50 hover:bg-green-100 transition-colors",title:"Share Project"},[v(H(Zs),{class:"h-5 w-5"}),j[17]||(j[17]=e("span",{class:"ml-1 text-sm font-medium"},"Share",-1))]),e("button",{onClick:ee,class:"flex items-center p-2 rounded-full text-blue-600 bg-blue-50 hover:bg-blue-100 transition-colors",title:"Compose Email"},[v(H(Ts),{class:"h-5 w-5"}),j[18]||(j[18]=e("span",{class:"ml-1 text-sm font-medium"},"Compose Email",-1))])]),e("div",wo,[j[22]||(j[22]=e("h5",{class:"text-sm font-semibold text-gray-500 uppercase tracking-wider mb-2"},"Dynamic Project Resources",-1)),d.value?(i(),r("div",xo,"Loading resources...")):m.value.length===0?(i(),r("div",ko,"No dynamic resources have been added.")):(i(),r("div",Do,[(i(!0),r(X,null,ae(m.value,N=>(i(),r("div",{key:N.id,class:"relative"},[e("button",{onClick:Ce(ye=>J(N.id),["prevent"]),class:"resource-button flex items-center p-2 bg-gray-100 rounded-full hover:bg-gray-200 transition-colors text-sm font-medium text-gray-700"},[v(H(qs),{class:"h-4 w-4 mr-1"}),q(" "+g(N.name),1)],8,Co),c.value===N.id?(i(),r("div",$o,[e("div",jo,[e("div",To,[e("h4",Eo,g(N.name),1),e("button",{onClick:Ce(V,["prevent"]),class:"text-gray-400 hover:text-gray-600"},j[19]||(j[19]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),N.description?(i(),r("p",Mo,g(N.description),1)):D("",!0),e("a",{href:N.url,target:"_blank",class:"mt-2 text-indigo-600 hover:text-indigo-800 text-sm font-medium flex items-center"},[v(H(Ys),{class:"h-4 w-4 mr-1"}),j[20]||(j[20]=q(" Open Resource ",-1))],8,So),e("div",Vo,[e("button",{onClick:Ce(ye=>w(N),["prevent"]),class:"p-1 text-gray-500 hover:text-indigo-600 transition-colors",title:"Edit"},[v(H(Ns),{class:"h-4 w-4"})],8,Ao),e("button",{onClick:Ce(ye=>C(N.id),["prevent"]),class:"p-1 text-gray-500 hover:text-red-600 transition-colors",title:"Delete"},[v(H(ss),{class:"h-4 w-4"})],8,Io)])]),j[21]||(j[21]=e("div",{class:"absolute left-1/2 bottom-0 transform translate-y-1/2 -translate-x-1/2 rotate-45 w-4 h-4 bg-white border-r border-b border-gray-200"},null,-1))])):D("",!0)]))),128))]))])]),e("div",Lo,[j[25]||(j[25]=e("h5",{class:"text-sm font-semibold text-gray-500 uppercase tracking-wider mb-2"},"Upcoming Meetings",-1)),M.value?(i(),r("div",Oo," Loading meetings... ")):k.value.length===0?(i(),r("div",Uo," No upcoming meetings scheduled. ")):(i(),r("div",Po,[(i(!0),r(X,null,ae(k.value,N=>(i(),r("div",{key:N.id,class:"p-3 bg-gray-50 rounded-lg border border-gray-200 hover:bg-gray-100 transition-colors"},[e("h5",No,g(N.summary),1),e("p",Ro,g(O(N.start_time)),1),e("div",Fo,[e("a",{href:N.google_event_link,target:"_blank",class:"text-blue-600 hover:text-blue-800",title:"View in Google Calendar"},j[23]||(j[23]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)]),8,Bo),N.google_meet_link?(i(),r("a",{key:0,href:N.google_meet_link,target:"_blank",class:"text-green-600 hover:text-green-800",title:"Join Google Meet"},j[24]||(j[24]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})],-1)]),8,Ho)):D("",!0)])]))),128))]))])])]),v(Fi,{show:o.value,"project-id":s.projectId,resource:l.value,onClose:j[3]||(j[3]=N=>o.value=!1),onSaved:W},null,8,["show","project-id","resource"]),v(je,{show:h.value,onClose:de},{default:B(()=>[e("div",Wo,[j[28]||(j[28]=e("h2",{class:"text-2xl font-bold text-gray-900 mb-4"}," Send Magic Link ",-1)),_.value?(i(),r("div",Yo,g(_.value),1)):D("",!0),A.value.general?(i(),r("div",zo,g(A.value.general[0]),1)):D("",!0),e("form",{onSubmit:Ce(xe,["prevent"])},[e("div",qo,[v(G,{for:"client",value:"Select Client"}),p.value?(i(),r("div",Zo,"Loading clients...")):f.value?(i(),r("div",Go,g(f.value),1)):(i(),Q(Oe,{key:2,id:"client",modelValue:T.value.client_ids,"onUpdate:modelValue":j[4]||(j[4]=N=>T.value.client_ids=N),options:S.value,placeholder:"Select a client","label-key":"name","track-by":"id",class:"mt-1"},null,8,["modelValue","options"])),v(ie,{message:A.value.client_ids?A.value.client_ids[0]:"",class:"mt-2"},null,8,["message"]),j[26]||(j[26]=e("p",{class:"mt-2 text-sm text-gray-500"}," Select a client to send them a magic link for project access. ",-1))]),e("div",Ko,[v(fe,{onClick:de,class:"mr-3"},{default:B(()=>j[27]||(j[27]=[q(" Cancel ",-1)])),_:1,__:[27]}),v(ce,{type:"submit",class:"bg-purple-600 hover:bg-purple-700 transition-colors",disabled:x.value},{default:B(()=>[q(g(x.value?"Sending...":"Send Magic Link"),1)]),_:1},8,["disabled"])])],32)])]),_:1},8,["show"]),v(lo,{show:u.value,title:"Compose New Email","api-endpoint":"/api/emails/templated","http-method":"post",clients:S.value,"submit-button-text":"Submit for Approval","success-message":"Email submitted for approval successfully!","project-id":s.projectId,onClose:j[5]||(j[5]=N=>u.value=!1),onSubmitted:j[6]||(j[6]=N=>u.value=!1),onError:j[7]||(j[7]=N=>console.error("Email submission error:",N))},null,8,["show","clients","project-id"])],64)}}},Xo=Me(Jo,[["__scopeId","data-v-daf16b92"]]),Qo={class:"grid grid-cols-2 sm:grid-cols-4 gap-4 mb-6"},en={class:"bg-white p-4 rounded-xl shadow-md hover:shadow-lg transition-shadow"},tn={class:"text-2xl font-bold text-indigo-600"},sn={class:"bg-white p-4 rounded-xl shadow-md hover:shadow-lg transition-shadow"},an={class:"text-2xl font-bold text-indigo-600"},ln={class:"bg-white p-4 rounded-xl shadow-md hover:shadow-lg transition-shadow"},on={class:"text-2xl font-bold text-indigo-600"},nn={class:"bg-white p-4 rounded-xl shadow-md hover:shadow-lg transition-shadow"},rn={class:"text-2xl font-bold text-indigo-600"},dn={__name:"ProjectStatsCards",props:{tasks:{type:Array,required:!0},emails:{type:Array,required:!0}},setup(s){const t=s,a=F(()=>t.tasks.filter(m=>m.status!=="Done").length),n=F(()=>t.emails.filter(m=>m.type==="received").length),o=F(()=>{const m=t.emails.filter(d=>d.status==="received"||d.type==="received");if(m.length>0){const d=[...m].sort((c,u)=>new Date(u.created_at)-new Date(c.created_at));return new Date(d[0].created_at).toLocaleDateString()}return"N/A"}),l=F(()=>{const m=t.tasks.filter(d=>d.status!=="Done");if(m.length>0){const d=m.filter(c=>c.due_date);if(d.length>0)return[...d].sort((u,h)=>new Date(u.due_date)-new Date(h.due_date))[0].due_date}return"N/A"});return(m,d)=>(i(),r("div",Qo,[e("div",en,[d[0]||(d[0]=e("h4",{class:"text-sm font-semibold text-gray-500 mb-1"},"Pending Tasks",-1)),e("p",tn,g(a.value),1)]),e("div",sn,[d[1]||(d[1]=e("h4",{class:"text-sm font-semibold text-gray-500 mb-1"},"Received Emails",-1)),e("p",an,g(n.value),1)]),e("div",ln,[d[2]||(d[2]=e("h4",{class:"text-sm font-semibold text-gray-500 mb-1"},"Last Email Received",-1)),e("p",on,g(o.value),1)]),e("div",nn,[d[3]||(d[3]=e("h4",{class:"text-sm font-semibold text-gray-500 mb-1"},"Next Task Deadline",-1)),e("p",rn,g(l.value),1)])]))}},un={class:"bg-white p-4 rounded-xl shadow-md mb-6"},cn={class:"border-b border-gray-200"},mn={__name:"ProjectTabsNavigation",props:{selectedTab:{type:String,default:null},canViewEmails:{type:Boolean,required:!0},canViewNotes:{type:Boolean,required:!0},canViewDeliverables:{type:Boolean,required:!0},canViewSeoReports:{type:Boolean,required:!0}},emits:["update:selectedTab"],setup(s,{expose:t,emit:a}){const n=b(null),o=s,l=a,m=F({get:()=>o.selectedTab,set:c=>l("update:selectedTab",c)});return t({scrollIntoView:c=>{n.value&&n.value.scrollIntoView(c)}}),(c,u)=>(i(),r("div",un,[e("div",cn,[e("nav",{class:"-mb-px flex space-x-8 overflow-x-auto",ref_key:"navElement",ref:n},[e("button",{onClick:u[0]||(u[0]=h=>m.value=null),class:te([m.value===null?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300","whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm"])}," Overview ",2),e("button",{onClick:u[1]||(u[1]=h=>m.value="tasks"),class:te([m.value==="tasks"?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300","whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm"])}," Project Tasks ",2),s.canViewEmails?(i(),r("button",{key:0,onClick:u[2]||(u[2]=h=>m.value="emails"),class:te([m.value==="emails"?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300","whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm"])}," Email Communication ",2)):D("",!0),s.canViewNotes?(i(),r("button",{key:1,onClick:u[3]||(u[3]=h=>m.value="notes"),class:te([m.value==="notes"?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300","whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm"])}," Notes ",2)):D("",!0),s.canViewNotes?(i(),r("button",{key:2,onClick:u[4]||(u[4]=h=>m.value="standups"),class:te([m.value==="standups"?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300","whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm"])}," Daily Standups ",2)):D("",!0),s.canViewDeliverables?(i(),r("button",{key:3,onClick:u[5]||(u[5]=h=>m.value="deliverables"),class:te([m.value==="deliverables"?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300","whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm"])}," Deliverables ",2)):D("",!0),s.canViewSeoReports?(i(),r("button",{key:4,onClick:u[6]||(u[6]=h=>m.value="seo-reports"),class:te([m.value==="seo-reports"?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300","whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm"])}," SEO Reports ",2)):D("",!0)],512)])]))}},vn={class:"space-y-4"},pn={key:0,class:"text-sm text-gray-500"},hn={class:"flex justify-between items-center"},gn={key:0,class:"text-sm text-gray-500"},fn="put",yn="Update Task",bn="Task updated successfully!",_n={__name:"EditTaskModal",props:{show:Boolean,projectId:Number,selectedTask:Object,projectUsers:Array,taskTypes:Array,milestones:Array,loadingTaskTypes:Boolean,loadingMilestones:Boolean},emits:["close","saved","open-add-milestone-modal"],setup(s,{emit:t}){const a=s,n=t,o=De({name:"",description:"",assigned_to_user_id:null,due_date:null,status:"To Do",task_type_id:null,milestone_id:null,priority:"medium",tags:[],tags_data:[]}),l=["To Do","In Progress","Done","Blocked","Archived"],m=[{value:"low",label:"Low"},{value:"medium",label:"Medium"},{value:"high",label:"High"}],d=F(()=>"Edit Task"),c=F(()=>{var S;return`/api/tasks/${(S=a.selectedTask)==null?void 0:S.id}`});ne(()=>[a.show,a.selectedTask],([S,p],[f,k]=[])=>{var M;if(S&&p){let I=null;if(p.milestone){const $=a.milestones.find(y=>y.name===p.milestone);$&&(I=$.id)}else p.milestone_id&&(I=p.milestone_id);let E=null;if(p.task_type){const $=a.taskTypes.find(y=>y.name===p.task_type);$&&(E=$.id)}else p.task_type_id&&(E=p.task_type_id);let L=null;if(p.assigned_to&&p.assigned_to!=="Unassigned"){const $=(M=a.projectUsers)==null?void 0:M.find(y=>y.name===p.assigned_to);$&&(L=$.id)}else p.assigned_to_id&&(L=p.assigned_to_id);let O=[];p.tags&&Array.isArray(p.tags)&&p.tags.length>0&&(typeof p.tags[0]=="string"?O=p.tags.map($=>({id:`new_${$.replace(/\s+/g,"-").toLowerCase()}_${Date.now()}`,name:$})):typeof p.tags[0]=="object"&&(O=p.tags)),Object.assign(o,{name:p.title||"",description:p.description||"",assigned_to_user_id:L,due_date:p.due_date||null,status:p.status||"To Do",task_type_id:E,milestone_id:I,priority:p.priority||"medium",tags:O.map($=>$.id),tags_data:O}),console.log("Task data loaded:",{taskId:p.id,title:p.title,originalTags:p.tags,processedTags:O,formTags:o.tags,formTagsData:o.tags_data})}else S||Object.assign(o,{name:"",description:"",assigned_to_user_id:null,due_date:null,status:"To Do",task_type_id:null,milestone_id:null,priority:"medium",tags:[],tags_data:[]})},{immediate:!0});const u=S=>{n("saved",S),n("close")},h=()=>{n("open-add-milestone-modal")},x=()=>{n("close")},T=F(()=>a.projectUsers.map(S=>({value:S.id,label:S.name}))),A=F(()=>a.taskTypes.map(S=>({value:S.id,label:S.name}))),_=F(()=>a.milestones.map(S=>({value:S.id,label:S.name})));return(S,p)=>(i(),Q(Te,{show:s.show,title:d.value,"api-endpoint":c.value,"http-method":fn,"form-data":o,"submit-button-text":yn,"success-message":bn,onClose:x,onSubmitted:u},{default:B(({errors:f})=>[e("div",vn,[e("div",null,[v(G,{for:"task-name",value:"Task Name"}),v(re,{id:"task-name",modelValue:o.name,"onUpdate:modelValue":p[0]||(p[0]=k=>o.name=k),type:"text",class:"mt-1 block w-full",placeholder:"Enter task name",required:""},null,8,["modelValue"]),v(ie,{message:f.name?f.name[0]:"",class:"mt-2"},null,8,["message"])]),e("div",null,[v(G,{for:"task-description",value:"Description"}),ve(e("textarea",{id:"task-description","onUpdate:modelValue":p[1]||(p[1]=k=>o.description=k),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",rows:"3",placeholder:"Enter task description"},null,512),[[we,o.description]]),v(ie,{message:f.description?f.description[0]:"",class:"mt-2"},null,8,["message"])]),e("div",null,[v(G,{for:"task-status",value:"Status"}),v(me,{id:"task-status",modelValue:o.status,"onUpdate:modelValue":p[2]||(p[2]=k=>o.status=k),options:l.map(k=>({value:k,label:k})),"value-key":"value","label-key":"label",placeholder:"Select status",class:"mt-1"},null,8,["modelValue","options"]),v(ie,{message:f.status?f.status[0]:"",class:"mt-2"},null,8,["message"])]),e("div",null,[v(G,{for:"task-priority",value:"Priority"}),v(me,{id:"task-priority",modelValue:o.priority,"onUpdate:modelValue":p[3]||(p[3]=k=>o.priority=k),options:m,"value-key":"value","label-key":"label",placeholder:"Select priority",class:"mt-1"},null,8,["modelValue"]),v(ie,{message:f.priority?f.priority[0]:"",class:"mt-2"},null,8,["message"])]),e("div",null,[v(G,{for:"task-due-date",value:"Due Date"}),v(re,{id:"task-due-date",modelValue:o.due_date,"onUpdate:modelValue":p[4]||(p[4]=k=>o.due_date=k),type:"date",class:"mt-1 block w-full"},null,8,["modelValue"]),v(ie,{message:f.due_date?f.due_date[0]:"",class:"mt-2"},null,8,["message"])]),e("div",null,[v(G,{for:"task-assigned-to",value:"Assigned To"}),v(me,{id:"task-assigned-to",modelValue:o.assigned_to_user_id,"onUpdate:modelValue":p[5]||(p[5]=k=>o.assigned_to_user_id=k),options:T.value,"value-key":"value","label-key":"label",placeholder:"Unassigned",class:"mt-1","allow-empty":!0},null,8,["modelValue","options"]),v(ie,{message:f.assigned_to_user_id?f.assigned_to_user_id[0]:"",class:"mt-2"},null,8,["message"])]),e("div",null,[v(G,{for:"task-type",value:"Task Type"}),s.loadingTaskTypes?(i(),r("div",pn,"Loading task types...")):(i(),Q(me,{key:1,id:"task-type",modelValue:o.task_type_id,"onUpdate:modelValue":p[6]||(p[6]=k=>o.task_type_id=k),options:A.value,"value-key":"value","label-key":"label",placeholder:"Select a task type",class:"mt-1","allow-empty":!0},null,8,["modelValue","options"])),v(ie,{message:f.task_type_id?f.task_type_id[0]:"",class:"mt-2"},null,8,["message"])]),e("div",null,[e("div",hn,[v(G,{for:"task-milestone",value:"Milestone"}),e("button",{type:"button",onClick:h,class:"text-sm text-indigo-600 hover:text-indigo-800"}," + Create New Milestone ")]),s.loadingMilestones?(i(),r("div",gn,"Loading milestones...")):(i(),Q(me,{key:1,id:"task-milestone",modelValue:o.milestone_id,"onUpdate:modelValue":p[7]||(p[7]=k=>o.milestone_id=k),options:_.value,"value-key":"value","label-key":"label",placeholder:"No milestone",class:"mt-1","allow-empty":!0},null,8,["modelValue","options"])),v(ie,{message:f.milestone_id?f.milestone_id[0]:"",class:"mt-2"},null,8,["message"])]),e("div",null,[v(as,{modelValue:o.tags,"onUpdate:modelValue":p[8]||(p[8]=k=>o.tags=k),initialTags:o.tags_data,label:"Tags",placeholder:"Search or add tags",error:f.tags?f.tags[0]:""},null,8,["modelValue","initialTags","error"])])])]),_:1},8,["show","title","api-endpoint","form-data"]))}},wn={class:"bg-white p-6 rounded-xl shadow-md hover:shadow-lg transition-shadow"},xn={class:"flex justify-between items-center mb-4"},kn={class:"flex gap-2"},Dn={key:0},Cn={key:1},$n={class:"mb-6 overflow-x-auto"},jn={key:0,class:"text-center text-gray-600 text-sm animate-pulse py-4"},Tn={key:1,class:"text-center py-4"},En={key:2,class:"relative py-8"},Mn={class:"relative flex justify-between"},Sn={key:0,class:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Vn={key:1,class:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},An={key:2,class:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},In={key:3,class:"w-2 h-2 bg-white rounded-full"},Ln={class:"absolute -top-8 transform -translate-x-1/2 left-1/2 w-32"},On=["title"],Un={class:"absolute top-8 transform -translate-x-1/2 left-1/2"},Pn={class:"text-xs text-gray-500 whitespace-nowrap"},Nn={class:"mb-6 bg-gray-50 p-4 rounded-lg"},Rn={class:"flex flex-wrap items-center gap-4"},Fn={class:"flex-1 min-w-[200px]"},Bn={class:"flex-1 min-w-[200px]"},Hn={class:"flex-1 min-w-[200px]"},Wn={class:"flex-1 min-w-[200px]"},Yn={key:0,class:"mt-3 text-sm text-gray-600"},zn={key:0,class:"text-red-600 font-medium"},qn={key:0,class:"text-center text-gray-600 text-sm animate-pulse py-4"},Zn={key:1,class:"text-center py-4"},Gn={class:"text-red-600 text-sm font-medium"},Kn={key:2,class:"overflow-x-auto"},Jn={key:3,class:"text-center py-4"},Xn={class:"p-6"},Qn={class:"mb-4"},er={class:"flex justify-end space-x-3"},tr={__name:"ProjectTasksTab",props:{projectId:{type:Number,required:!0},projectUsers:{type:Array,default:()=>[]},canManageProjects:{type:Boolean,required:!0},tasksFilter:{type:String,default:"all"}},emits:["tasksUpdated","openTaskDetailSidebar","open-create-task-modal","filter-changed"],setup(s,{emit:t}){const a=s,n=t,o=b([]),l=b(!0),m=b(""),d=b(!1),c=b(null),u=b(!1),h=b(!1),x=b(null),T=b(!1),A=b(null),_=b(""),S=b([]),p=b([]),f=b(!1),k=b(!1),M=De({status:"",assigned_to_user_id:null,milestone_id:null,due_date_range:""}),I=[{value:"",label:"All Statuses"},{value:"To Do",label:"To Do"},{value:"In Progress",label:"In Progress"},{value:"Done",label:"Done"},{value:"Blocked",label:"Blocked"},{value:"Archived",label:"Archived"}],E=F(()=>{const j=[{value:null,label:"All Users"},{value:-1,label:"Unassigned"}];return j.push(...a.projectUsers.map(U=>({value:U.id,label:U.name}))),j}),L=F(()=>{const j=[{value:null,label:"All Milestones"},{value:-1,label:"No Milestone"}];return j.push(...p.value.map(U=>({value:U.id,label:U.name}))),j}),O=[{value:"",label:"All Dates"},{value:"today",label:"Due Today"},{value:"this_week",label:"Due This Week"},{value:"next_week",label:"Due Next Week"},{value:"overdue",label:"Overdue"},{value:"no_date",label:"No Due Date"}],$=F(()=>!p.value||!p.value.length?[]:[...p.value].sort((j,U)=>j.completion_date?U.completion_date?new Date(j.completion_date)-new Date(U.completion_date):-1:1)),y=F(()=>o.value.length?(console.log("ProjectTasksTab: Tasks array:",o.value),o.value.filter(j=>{if(M.status&&j.status!==M.status)return!1;if(M.assigned_to_user_id!==null){const U=parseInt(M.assigned_to_user_id);if(U===-1){if(j.assigned_to!=="Unassigned"&&j.assigned_to_id!==null)return!1}else if(j.assigned_to_id!==U)return!1}if(M.milestone_id!==null){const U=parseInt(M.milestone_id);if(U===-1){if(j.milestone_id)return!1}else if(j.milestone_id!==U)return!1}if(M.due_date_range){const U=new Date;U.setHours(0,0,0,0);const N=j.due_date?new Date(j.due_date):null;switch(M.due_date_range){case"today":if(!N||N.toDateString()!==U.toDateString())return!1;break;case"this_week":{if(!N)return!1;const ye=new Date(U);if(ye.setDate(U.getDate()+(6-U.getDay())),N<U||N>ye)return!1;break}case"next_week":{if(!N)return!1;const ye=new Date(U);ye.setDate(U.getDate()+(7-U.getDay()));const Ne=new Date(ye);if(Ne.setDate(ye.getDate()+6),N<ye||N>Ne)return!1;break}case"overdue":{if(!N||N>=U)return!1;break}case"no_date":{if(N)return!1;break}}}return!0})):[]),w=()=>{M.status="",M.assigned_to_user_id=null,M.milestone_id=null,M.due_date_range=""},C=async()=>{l.value=!0,m.value="";try{const j=await os(a.projectId);console.log("ProjectTasksTab: Raw API response from fetchProjectTasks:",j),o.value=j,n("tasksUpdated",o.value)}catch(j){m.value="Failed to load tasks data.",console.error("Error fetching project tasks:",j),j.response&&j.response.data&&j.response.data.message&&(m.value=j.response.data.message)}finally{l.value=!1}},W=async j=>{await C()},J=async()=>{f.value=!0;try{const j=await window.axios.get("/api/task-types");S.value=j.data}catch(j){console.error("Error fetching task types:",j)}finally{f.value=!1}},V=async()=>{k.value=!0;try{const j=await window.axios.get(`/api/projects/${a.projectId}/milestones`);p.value=j.data}catch(j){console.error("Error fetching milestones:",j)}finally{k.value=!1}},R=()=>{n("open-create-task-modal")},Z=()=>{C()},P=j=>{console.log("ProjectTasksTab: Emitting openTaskDetailSidebar for taskId:",j,"projectId:",a.projectId),n("openTaskDetailSidebar",j,a.projectId,a.projectUsers)},ee=()=>{u.value=!0},de=j=>{p.value.push(j),C()},xe=()=>{C()},Y=async()=>{if(A.value){if(!_.value.trim()){ps("Please provide a reason for blocking the task");return}try{hs("Blocking task..."),await window.axios.post(`/api/tasks/${A.value.id}/block`,{reason:_.value}),Dt("Task blocked successfully"),T.value=!1,await C()}catch(j){console.error("Error blocking task:",j),lt("Failed to block task. Please try again.")}}};return be(()=>{C(),J(),V()}),ne(()=>a.projectUsers,()=>{}),ne(()=>a.taskTypes,()=>{}),ne(()=>a.milestones,()=>{}),ne(()=>a.tasksFilter,j=>{j==="due-overdue"?(new Date().setHours(0,0,0,0),M.status="",M.assigned_to_user_id=null,M.milestone_id=null,M.due_date_range="overdue"):j==="all"&&(M.status="",M.assigned_to_user_id=null,M.milestone_id=null,M.due_date_range=""),n("filter-changed",j)}),(j,U)=>(i(),r("div",wn,[e("div",xn,[U[11]||(U[11]=e("h4",{class:"text-lg font-semibold text-gray-900"},"Project Tasks",-1)),e("div",kn,[v(fe,{onClick:C,disabled:l.value,class:"text-indigo-600 hover:text-indigo-800"},{default:B(()=>[l.value?(i(),r("span",Cn,"Loading...")):(i(),r("span",Dn,"Refresh"))]),_:1},8,["disabled"]),s.canManageProjects?(i(),Q(ce,{key:0,class:"bg-indigo-600 hover:bg-indigo-700 transition-colors",onClick:R},{default:B(()=>U[10]||(U[10]=[q(" Add Task ",-1)])),_:1,__:[10]})):D("",!0)])]),e("div",$n,[k.value?(i(),r("div",jn," Loading milestones... ")):$.value.length?(i(),r("div",En,[U[16]||(U[16]=e("div",{class:"absolute h-1 bg-gray-200 top-1/2 left-0 right-0 transform -translate-y-1/2"},null,-1)),e("div",Mn,[(i(!0),r(X,null,ae($.value,(N,ye)=>(i(),r("div",{key:N.id,class:te(["flex flex-col items-center relative z-10",{"ml-4":ye===0,"mr-4":ye===$.value.length-1}])},[e("div",{class:te(["w-6 h-6 rounded-full shadow-lg flex items-center justify-center",{"bg-gray-300":N.status==="Not Started","bg-blue-500":N.status==="In Progress","bg-green-500":N.status==="Completed","bg-red-500":N.status==="Overdue"}])},[N.status==="Completed"?(i(),r("svg",Sn,U[13]||(U[13]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)]))):N.status==="In Progress"?(i(),r("svg",Vn,U[14]||(U[14]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 10V3L4 14h7v7l9-11h-7z"},null,-1)]))):N.status==="Overdue"?(i(),r("svg",An,U[15]||(U[15]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"},null,-1)]))):(i(),r("span",In))],2),e("div",Ln,[e("p",{class:"text-xs font-medium text-gray-700 text-center truncate",title:N.name},g(N.name),9,On)]),e("div",Un,[e("p",Pn,g(N.completion_date?new Date(N.completion_date).toLocaleDateString():"No date"),1)])],2))),128))])])):(i(),r("div",Tn,U[12]||(U[12]=[e("p",{class:"text-gray-400 text-sm"},"No milestones found for this project.",-1)])))]),e("div",Nn,[e("div",Rn,[e("div",Fn,[v(G,{for:"status-filter",value:"Status"}),v(me,{id:"status-filter",modelValue:M.status,"onUpdate:modelValue":U[0]||(U[0]=N=>M.status=N),options:I,"value-key":"value","label-key":"label",placeholder:"All Statuses",class:"mt-1"},null,8,["modelValue"])]),e("div",Bn,[v(G,{for:"assigned-filter",value:"Assigned To"}),v(me,{id:"assigned-filter",modelValue:M.assigned_to_user_id,"onUpdate:modelValue":U[1]||(U[1]=N=>M.assigned_to_user_id=N),options:E.value,"value-key":"value","label-key":"label",placeholder:"All Users",class:"mt-1"},null,8,["modelValue","options"])]),e("div",Hn,[v(G,{for:"milestone-filter",value:"Milestone"}),v(me,{id:"milestone-filter",modelValue:M.milestone_id,"onUpdate:modelValue":U[2]||(U[2]=N=>M.milestone_id=N),options:L.value,"value-key":"value","label-key":"label",placeholder:"All Milestones",class:"mt-1"},null,8,["modelValue","options"])]),e("div",Wn,[v(G,{for:"due-date-filter",value:"Due Date"}),v(me,{id:"due-date-filter",modelValue:M.due_date_range,"onUpdate:modelValue":U[3]||(U[3]=N=>M.due_date_range=N),options:O,"value-key":"value","label-key":"label",placeholder:"All Dates",class:"mt-1"},null,8,["modelValue"])]),e("div",{class:"flex items-end"},[e("button",{type:"button",onClick:w,class:"px-3 py-2 text-sm text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-md transition-colors"}," Clear Filters ")])]),Object.values(M).some(N=>N!==null&&N!=="")?(i(),r("div",Yn,[e("p",null,[q(" Showing "+g(y.value.length)+" of "+g(o.value.length)+" tasks ",1),y.value.length===0?(i(),r("span",zn," (No tasks match the current filters) ")):D("",!0)])])):D("",!0)]),l.value?(i(),r("div",qn," Loading tasks... ")):m.value?(i(),r("div",Zn,[e("p",Gn,g(m.value),1)])):o.value.length?(i(),r("div",Kn,[v($t,{tasks:y.value,"project-id":s.projectId,"show-project-column":!1,onTaskUpdated:W,onOpenTaskDetail:P},null,8,["tasks","project-id"])])):(i(),r("div",Jn,U[17]||(U[17]=[e("p",{class:"text-gray-400 text-sm"},"No tasks found for this project.",-1),e("p",{class:"text-gray-500 text-sm mt-2"},' Click the "Add Task" button to create a new task. ',-1)]))),v(_n,{show:d.value,"project-id":s.projectId,"selected-task":c.value,"project-users":s.projectUsers,"task-types":S.value,milestones:p.value,"loading-task-types":f.value,"loading-milestones":k.value,onClose:U[4]||(U[4]=N=>d.value=!1),onSaved:Z,onOpenAddMilestoneModal:ee},null,8,["show","project-id","selected-task","project-users","task-types","milestones","loading-task-types","loading-milestones"]),v(ls,{show:u.value,"project-id":s.projectId,onClose:U[5]||(U[5]=N=>u.value=!1),onSaved:de},null,8,["show","project-id"]),v(is,{show:h.value,"task-for-note":x.value,onClose:U[6]||(U[6]=N=>h.value=!1),onNoteAdded:xe},null,8,["show","task-for-note"]),v(je,{show:T.value,onClose:U[9]||(U[9]=N=>T.value=!1)},{default:B(()=>[e("div",Xn,[U[21]||(U[21]=e("h2",{class:"text-lg font-medium text-gray-900 mb-4"}," Block Task ",-1)),e("div",Qn,[U[18]||(U[18]=e("p",{class:"text-sm text-gray-600 mb-2"}," Please provide a reason for blocking this task: ",-1)),ve(e("textarea",{"onUpdate:modelValue":U[7]||(U[7]=N=>_.value=N),class:"w-full rounded-md shadow-sm border-gray-300 focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",rows:"3",placeholder:"Enter reason for blocking..."},null,512),[[we,_.value]])]),e("div",er,[v(fe,{onClick:U[8]||(U[8]=N=>T.value=!1)},{default:B(()=>U[19]||(U[19]=[q(" Cancel ",-1)])),_:1,__:[19]}),v(ce,{onClick:Y,disabled:!_.value.trim(),class:"bg-red-600 hover:bg-red-700"},{default:B(()=>U[20]||(U[20]=[q(" Block Task ",-1)])),_:1,__:[20]},8,["disabled"])])])]),_:1},8,["show"])]))}},sr={class:"p-6"},ar={key:0,class:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4",role:"alert"},lr={class:"block sm:inline"},ir={class:"mb-4"},or={class:"mb-6"},nr={class:"flex justify-end space-x-3"},rr={__name:"InsertLinkModal",props:{show:{type:Boolean,default:!1}},emits:["close","insert"],setup(s,{emit:t}){const a=t,n=b(""),o=b(""),l=b(""),m=()=>{if(!n.value.trim()){l.value="Link text cannot be empty.";return}let c=o.value.trim();!c.startsWith("http://")&&!c.startsWith("https://")&&(c="http://"+c);try{new URL(c)}catch{l.value="Please enter a valid URL (e.g., https://example.com or www.example.com).";return}const u=`[${n.value.trim()}] {${c}}`;a("insert",u),d()},d=()=>{n.value="",o.value="",l.value="",a("close")};return(c,u)=>(i(),Q(je,{show:s.show,onClose:d,"max-width":"md"},{default:B(()=>[e("div",sr,[u[4]||(u[4]=e("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"Insert Link",-1)),l.value?(i(),r("div",ar,[e("span",lr,g(l.value),1)])):D("",!0),e("div",ir,[v(G,{for:"link_text",value:"Link Text"}),v(re,{id:"link_text",type:"text",class:"mt-1 block w-full",modelValue:n.value,"onUpdate:modelValue":u[0]||(u[0]=h=>n.value=h),onKeyup:Le(m,["enter"])},null,8,["modelValue"])]),e("div",or,[v(G,{for:"link_url",value:"URL"}),v(re,{id:"link_url",type:"text",class:"mt-1 block w-full",modelValue:o.value,"onUpdate:modelValue":u[1]||(u[1]=h=>o.value=h),placeholder:"e.g., https://www.example.com",onKeyup:Le(m,["enter"])},null,8,["modelValue"])]),e("div",nr,[v(fe,{onClick:d},{default:B(()=>u[2]||(u[2]=[q("Cancel",-1)])),_:1,__:[2]}),v(ce,{onClick:m},{default:B(()=>u[3]||(u[3]=[q("Insert",-1)])),_:1,__:[3]})])])]),_:1},8,["show"]))}},dr={class:"p-6"},ur={key:0,class:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4",role:"alert"},cr={class:"block sm:inline"},mr={class:"mb-4"},vr={class:"mb-6"},pr={class:"flex justify-end space-x-3"},hr={__name:"InsertListModal",props:{show:{type:Boolean,default:!1}},emits:["close","insert"],setup(s,{emit:t}){const a=t,n=b(""),o=b("bullet"),l=b(""),m=()=>{const c=n.value.split(`
`).map(x=>x.trim()).filter(x=>x!=="");if(c.length===0){l.value="Please enter at least one list item.";return}const u=o.value==="bullet"?"ul":"ol";let h=`<${u}>`;c.forEach(x=>{h+=`<li>${x}</li>`}),h+=`</${u}>`,a("insert",h),d()},d=()=>{n.value="",o.value="bullet",l.value="",a("close")};return(c,u)=>(i(),Q(je,{show:s.show,onClose:d,"max-width":"md"},{default:B(()=>[e("div",dr,[u[5]||(u[5]=e("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"Insert List",-1)),l.value?(i(),r("div",ur,[e("span",cr,g(l.value),1)])):D("",!0),e("div",mr,[v(G,{for:"list_items",value:"List Items (one per line)"}),ve(e("textarea",{id:"list_items",rows:"6",class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full","onUpdate:modelValue":u[0]||(u[0]=h=>n.value=h),placeholder:"Enter each list item on a new line"},null,512),[[we,n.value]])]),e("div",vr,[v(G,{for:"list_type",value:"List Type"}),ve(e("select",{id:"list_type",class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full","onUpdate:modelValue":u[1]||(u[1]=h=>o.value=h)},u[2]||(u[2]=[e("option",{value:"bullet"},"Bulleted List",-1),e("option",{value:"numbered"},"Numbered List",-1)]),512),[[qe,o.value]])]),e("div",pr,[v(fe,{onClick:d},{default:B(()=>u[3]||(u[3]=[q("Cancel",-1)])),_:1,__:[3]}),v(ce,{onClick:m},{default:B(()=>u[4]||(u[4]=[q("Insert List",-1)])),_:1,__:[4]})])])]),_:1},8,["show"]))}},gr={key:0},fr={class:"mb-4"},yr={class:"mb-6"},br={class:"mb-2 flex justify-end space-x-2"},_r={key:0,class:"min-h-[300px] flex items-center justify-center bg-gray-50 rounded-md"},wr={key:1},xr={key:0,class:"text-red-500 mb-2"},kr={class:"mb-2 flex justify-end space-x-2"},Dr={key:1},Cr={class:"mb-6"},$r={__name:"EmailActionModal",props:{show:{type:Boolean,default:!1},title:{type:String,required:!0},apiEndpoint:{type:String,required:!0},httpMethod:{type:String,default:"post"},submitButtonText:{type:String,default:"Save"},successMessage:{type:String,default:"Operation successful!"},emailId:{type:Number,required:!1},projectId:{type:Number,required:!0}},emits:["close","submitted","error","fetchEmails"],setup(s,{emit:t}){const a=s,n=t,o=De({}),l=b(!1),m=b(!1),d=async()=>{if(a.emailId){m.value=!0;try{for(const w in o)delete o[w];if(a.title==="Reject Email"){Object.assign(o,{rejection_reason:""}),m.value=!1;return}const y=(await window.axios.get(`/api/emails/${a.emailId}/edit-content`)).data;y.body_html&&!y.body&&(y.body=y.body_html),Object.assign(o,y)}catch($){console.error("Failed to fetch email data:",$),n("error",$)}finally{m.value=!1}}};ne(()=>a.show,$=>{$&&a.emailId&&d()});const c=b(!1),u=b(!1),h=F(()=>o.body||""),{processedHtmlBody:x}=Mt(h),T=$=>{const y={...$};return a.title==="Edit and Approve Email"&&(y.body=x.value),y},A=()=>{console.log("EmailActionModal is closing"),n("close")},_=$=>{n("submitted",$)},S=$=>{n("error",$)},p=()=>{c.value=!0},f=$=>{o.body+=$,c.value=!1},k=()=>{u.value=!0},M=$=>{o.body+=$,u.value=!1},I=b({}),E=b(!1),L=async()=>{E.value=!0;try{console.log("Saving email with ID:",a.emailId),console.log("Email data:",{subject:o.subject,body:o.body}),await window.axios.post(`/api/emails/${a.emailId}/update`,{subject:o.subject,body:o.body}),console.log("Email saved successfully"),alert("Email saved successfully!"),E.value=!1,n("fetchEmails"),A()}catch($){E.value=!1,console.error("Error saving email:",$);let y="Failed to save email.";$.response&&$.response.data.message&&(y=$.response.data.message),I.value=y,alert(y)}},O=()=>{if(a.emailId){const $=`/emails/${a.emailId}/preview`;window.open($,"_blank")}else console.warn("Cannot preview email: Email ID not available.")};return($,y)=>(i(),r(X,null,[v(Te,{show:s.show,title:s.title,"api-endpoint":s.apiEndpoint,"http-method":s.httpMethod,"form-data":o,"submit-button-text":s.submitButtonText,"success-message":s.successMessage,"format-data-for-api":T,onClose:A,onSubmitted:_,onError:S,"max-width":"3xl"},{default:B(({errors:w})=>[s.title==="Edit and Approve Email"?(i(),r("div",gr,[e("div",fr,[v(G,{for:"edit_subject",value:"Subject"}),v(re,{id:"edit_subject",type:"text",class:"mt-1 block w-full",modelValue:o.subject,"onUpdate:modelValue":y[0]||(y[0]=C=>o.subject=C),required:""},null,8,["modelValue"]),v(ie,{message:w.subject?w.subject[0]:"",class:"mt-2"},null,8,["message"])]),e("div",yr,[e("div",br,[v(fe,{type:"button",onClick:k},{default:B(()=>y[5]||(y[5]=[q(" Insert List ",-1)])),_:1,__:[5]}),v(fe,{type:"button",onClick:p},{default:B(()=>y[6]||(y[6]=[q(" Insert Link ",-1)])),_:1,__:[6]})]),v(G,{for:"edit_body",value:"Email Body",class:"sr-only"}),l.value?(i(),r("div",_r,y[7]||(y[7]=[e("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-500"},null,-1)]))):(i(),r("div",wr,[h.value?D("",!0):(i(),r("div",xr,"Warning: Email body content is empty!")),v(Tt,{id:"edit_body",modelValue:o.body,"onUpdate:modelValue":y[1]||(y[1]=C=>o.body=C),value:h.value,placeholder:"Edit your email here...",height:"300px"},null,8,["modelValue","value"])])),v(ie,{message:w.body?w.body[0]:"",class:"mt-2"},null,8,["message"])]),e("div",kr,[v(ce,{type:"button",disabled:E.value,onClick:L},{default:B(()=>[q(g(E.value?"Saving...":"Save"),1)]),_:1},8,["disabled"]),v(fe,{type:"button",onClick:O},{default:B(()=>y[8]||(y[8]=[q(" Preview Email ",-1)])),_:1,__:[8]})])])):s.title==="Reject Email"?(i(),r("div",Dr,[e("div",Cr,[v(G,{for:"rejection_reason",value:"Rejection Reason"}),ve(e("textarea",{id:"rejection_reason",rows:"5",class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full","onUpdate:modelValue":y[2]||(y[2]=C=>o.rejection_reason=C),required:"",placeholder:"Please provide a reason for rejecting this email (minimum 10 characters)"},null,512),[[we,o.rejection_reason]]),v(ie,{message:w.rejection_reason?w.rejection_reason[0]:"",class:"mt-2"},null,8,["message"])])])):D("",!0)]),_:1},8,["show","title","api-endpoint","http-method","form-data","submit-button-text","success-message"]),v(rr,{show:c.value,onClose:y[3]||(y[3]=w=>c.value=!1),onInsert:f},null,8,["show"]),v(hr,{show:u.value,onClose:y[4]||(y[4]=w=>u.value=!1),onInsert:M},null,8,["show"])],64))}},jr=Me($r,[["__scopeId","data-v-d9b7301b"]]);function Tr(s){const t=Ue();return{userSignature:F(()=>{const n=t.value&&t.value.name?t.value.name:"",o=s.name??"",l="+61 456 639 389",m="ozeeweb.com.au",d="#1a73e8",c="#fbbc05",u="#1a202c",h="#4a5568",x="#e5e7eb",T="#f9fafb",A=`${window.location.origin}/logo.png`,_=`https://img.icons8.com/ios-filled/20/${d.substring(1)}/facebook-new.png`,S=`https://img.icons8.com/ios-filled/20/${d.substring(1)}/twitter.png`,p=`https://img.icons8.com/ios-filled/20/${d.substring(1)}/linkedin.png`,f=`https://img.icons8.com/ios-filled/20/${d.substring(1)}/instagram-new.png`;return`
            <div style="font-family: 'Inter', sans-serif; padding: 20px; border: 1px solid ${x}; margin-top: 30px; background-color: ${T}; border-radius: 8px; overflow: hidden; box-shadow: 0 0 0 3px ${c};">
                <table role="presentation" cellspacing="0" cellpadding="0" width="100%">
                    <tr>
                        <td style="vertical-align: middle;">
                            <p style="margin: 0; font-size: 18px; color: ${u};">Best Regards</p>
                            <p style="margin: 0; font-size: 18px; font-weight: bold; color: ${u};">${n}</p>
                            <p style="margin: 5px 0 5px 0; font-size: 14px; color: ${h};">${o}</p>
                            <p style="margin: 0 0 15px 0; font-size: 12px; color: ${h};">
                                Your website and social media are like your home, first impressions matter!
                            </p>
                            <table role="presentation" cellspacing="0" cellpadding="0">
                                <tr>
                                    <td style="padding-right: 15px;">
                                        <p style="margin: 0; font-size: 13px; color: ${h};">ð ${l}</p>
                                        <p style="margin: 5px 0 0 0; font-size: 13px; color: ${h};">ð <a href="https://${m}" target="_blank" style="color: ${d}; text-decoration: none;">${m}</a></p>
                                    </td>
                                </tr>
                            </table>
                            <div style="margin-top: 15px; text-align: left;">
                                <a href="https://www.facebook.com/yourprofile" target="_blank" style="display: inline-block; margin-right: 8px; color: ${d}; text-decoration: none;">
                                    <img src="${_}" alt="Facebook" style="vertical-align: middle;">
                                </a>
                                <a href="https://twitter.com/yourhandle" target="_blank" style="display: inline-block; margin-right: 8px; color: ${d}; text-decoration: none;">
                                    <img src="${S}" alt="Twitter" style="vertical-align: middle;">
                                </a>
                                <a href="https://www.linkedin.com/in/yourprofile" target="_blank" style="display: inline-block; margin-right: 8px; color: ${d}; text-decoration: none;">
                                    <img src="${p}" alt="LinkedIn" style="vertical-align: middle;">
                                </a>
                                <a href="https://www.instagram.com/yourprofile" target="_blank" style="display: inline-block; margin-right: 8px; color: ${d}; text-decoration: none;">
                                    <img src="${f}" alt="Instagram" style="vertical-align: middle;">
                                </a>
                            </div>
                        </td>
                        <td style="padding-left: 20px; vertical-align: middle; width: 120px; text-align: right;">
                            <img src="${A}" alt="Company Logo" width="100" style="display: block; border-radius: 8px; margin-left: auto;">
                        </td>
                    </tr>
                </table>

                <p style="margin-top: 25px; font-size: 12px; color: ${h}; text-align: center;">
                    Powered by MMS IT & Web Solutions PTY Ltd.
                </p>
                <p style="margin-top: 10px; font-style: italic; color: ${h}; text-align: center; font-size: 13px;">
                    Please consider the environment before printing this email.
                </p>
                <p style="margin-top: 10px; text-align: center; font-size: 13px;">
                    How did I do? <a href="https://www.example.com/review" target="_blank" style="color: ${d}; text-decoration: none; font-weight: bold;">Leave a review!</a>
                </p>
            </div>
        `})}}const Er={class:"mb-4"},Mr={key:0,class:"text-gray-500 text-sm"},Sr={key:1,class:"text-red-500 text-sm"},Vr={class:"mb-4"},Ar={class:"mb-6"},Ir={class:"mb-2 flex justify-end space-x-2"},Lr={class:"mb-4"},Or={key:0,class:"mt-2"},Ur={class:"text-gray-700 text-base mb-2"},Pr=["innerHTML"],Nr={class:"p-6"},Rr={key:0,class:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4",role:"alert"},Fr={class:"block sm:inline"},Br={class:"mb-4"},Hr={class:"mb-6"},Wr={class:"flex justify-end space-x-3"},Yr={class:"p-6"},zr={key:0,class:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4",role:"alert"},qr={class:"block sm:inline"},Zr={class:"mb-4"},Gr={class:"mb-6"},Kr={class:"flex justify-end space-x-3"},Jr={__name:"ComponseEmailModal",props:{show:{type:Boolean,default:!1},projectId:{type:Number,required:!0},userProjectRole:{type:Object,required:!0}},emits:["close","submitted","error"],setup(s,{emit:t}){const a=s,n=t,o=De({project_id:a.projectId,client_ids:[],subject:"",body:"",status:"pending_approval"}),l=b([]),m=b(!0),d=b(""),c=b(!1),u=b(""),h=b(""),x=b(""),T=b(!1),A=b(""),_=b("bullet"),S=b(""),p=b("full_name"),f=b(""),k=b([{value:"full_name",label:"Full Name"},{value:"first_name",label:"First Name"},{value:"last_name",label:"Last Name"},{value:"custom",label:"Custom"}]),{userSignature:M}=Tr(F(()=>a.userProjectRole)),I=F(()=>o.body||""),{processedHtmlBody:E}=Mt(I),L=F(()=>{if(o.client_ids&&o.client_ids.length>0){const Z=o.client_ids[0],P=l.value.find(ee=>ee.id===Z);if(P){const ee=P.name.split(" ").filter(Y=>Y.length>0),de=ee.length>0?ee[0]:"",xe=ee.length>1?ee[ee.length-1]:"";switch(p.value){case"full_name":return`Hi ${P.name},`;case"first_name":return`Hi ${de},`;case"last_name":return`Hi ${xe},`;case"custom":return`Hi ${f.value.trim()||"there"},`;default:return`Hi ${P.name},`}}}return"Hi there,"});ne(()=>a.show,Z=>{Z&&(Object.assign(o,{project_id:a.projectId,client_ids:[],subject:"",body:"",status:"pending_approval"}),p.value="full_name",f.value="",d.value="",R())},{immediate:!0});const O=Z=>{const P={...Z};return P.client_ids&&Array.isArray(P.client_ids)&&(P.client_ids=P.client_ids.map(ee=>({id:ee}))),P.body=E.value,P.greeting_name=L.value,P.custom_greeting_name=f.value.trim(),P.first_client_id=o.client_ids&&o.client_ids.length>0?o.client_ids[0]:null,P},$=()=>{n("close")},y=Z=>{n("submitted",Z)},w=Z=>{n("error",Z)},C=()=>{u.value="",h.value="",x.value="",c.value=!0},W=()=>{if(!u.value.trim()){x.value="Link text cannot be empty.";return}let Z=h.value.trim();!Z.startsWith("http://")&&!Z.startsWith("https://")&&(Z="http://"+Z);try{new URL(Z)}catch{x.value="Please enter a valid URL (e.g., https://example.com or www.example.com).";return}const P=`[${u.value.trim()}] {${Z}}`;o.body+=P,c.value=!1,u.value="",h.value="",x.value=""},J=()=>{A.value="",_.value="bullet",S.value="",T.value=!0},V=()=>{const Z=A.value.split(`
`).map(de=>de.trim()).filter(de=>de!=="");if(Z.length===0){S.value="Please enter at least one list item.";return}const P=_.value==="bullet"?"ul":"ol";let ee=`<${P}>`;Z.forEach(de=>{ee+=`<li>${de}</li>`}),ee+=`</${P}>`,o.body+=ee,T.value=!1,A.value="",S.value=""},R=async()=>{var Z,P;m.value=!0,d.value=null;try{const ee=await window.axios.get(`/api/projects/${a.projectId}/sections/clients?type=clients`);l.value=ee.data}catch(ee){console.error("Failed to fetch project clients:",ee),d.value=((P=(Z=ee.response)==null?void 0:Z.data)==null?void 0:P.message)||"Failed to load client data."}finally{m.value=!1}};return be(()=>{}),(Z,P)=>(i(),r(X,null,[v(Te,{show:s.show,title:"Compose New Email","api-endpoint":"/api/emails","http-method":"post","form-data":o,"submit-button-text":"Submit for Approval","success-message":"Email submitted for approval successfully!","format-data-for-api":O,onClose:$,onSubmitted:y,onError:w,"max-width":"3xl"},{default:B(({errors:ee})=>[e("div",Er,[v(G,{for:"client_ids",value:"To (Clients)"}),m.value?(i(),r("div",Mr,"Loading clients...")):d.value?(i(),r("div",Sr,g(d.value),1)):(i(),Q(Oe,{key:2,modelValue:o.client_ids,"onUpdate:modelValue":P[0]||(P[0]=de=>o.client_ids=de),options:l.value,placeholder:"Select one or more clients","label-key":"name","value-key":"id"},null,8,["modelValue","options"])),v(ie,{message:ee.client_ids?ee.client_ids[0]:"",class:"mt-2"},null,8,["message"])]),e("div",Vr,[v(G,{for:"subject",value:"Subject"}),v(re,{id:"subject",type:"text",class:"mt-1 block w-full",modelValue:o.subject,"onUpdate:modelValue":P[1]||(P[1]=de=>o.subject=de),required:""},null,8,["modelValue"]),v(ie,{message:ee.subject?ee.subject[0]:"",class:"mt-2"},null,8,["message"])]),e("div",Ar,[e("div",Ir,[v(fe,{type:"button",onClick:J},{default:B(()=>P[13]||(P[13]=[q(" Insert List ",-1)])),_:1,__:[13]}),v(fe,{type:"button",onClick:C},{default:B(()=>P[14]||(P[14]=[q(" Insert Link ",-1)])),_:1,__:[14]})]),e("div",Lr,[v(G,{for:"greeting_type",value:"Address Client By"}),v(me,{id:"greeting_type",modelValue:p.value,"onUpdate:modelValue":P[2]||(P[2]=de=>p.value=de),options:k.value,"value-key":"value","label-key":"label",class:"mt-1 block w-full"},null,8,["modelValue","options"]),p.value==="custom"?(i(),r("div",Or,[v(G,{for:"custom_greeting_name",value:"Custom Name"}),v(re,{id:"custom_greeting_name",type:"text",class:"mt-1 block w-full",modelValue:f.value,"onUpdate:modelValue":P[3]||(P[3]=de=>f.value=de),placeholder:"e.g., Azaan"},null,8,["modelValue"])])):D("",!0)]),e("p",Ur,g(L.value),1),v(G,{for:"body",value:"Email Body",class:"sr-only"}),v(Tt,{id:"body",modelValue:o.body,"onUpdate:modelValue":P[4]||(P[4]=de=>o.body=de),placeholder:"Compose your email here...",height:"300px"},null,8,["modelValue"]),v(ie,{message:ee.body?ee.body[0]:"",class:"mt-2"},null,8,["message"])]),H(M)?(i(),r("div",{key:0,class:"unselectable-signature",innerHTML:H(M)},null,8,Pr)):D("",!0)]),_:1},8,["show","form-data"]),v(je,{show:c.value,onClose:P[8]||(P[8]=ee=>c.value=!1),"max-width":"md"},{default:B(()=>[e("div",Nr,[P[17]||(P[17]=e("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"Insert Link",-1)),x.value?(i(),r("div",Rr,[e("span",Fr,g(x.value),1)])):D("",!0),e("div",Br,[v(G,{for:"link_text",value:"Link Text"}),v(re,{id:"link_text",type:"text",class:"mt-1 block w-full",modelValue:u.value,"onUpdate:modelValue":P[5]||(P[5]=ee=>u.value=ee),onKeyup:Le(W,["enter"])},null,8,["modelValue"])]),e("div",Hr,[v(G,{for:"link_url",value:"URL"}),v(re,{id:"link_url",type:"text",class:"mt-1 block w-full",modelValue:h.value,"onUpdate:modelValue":P[6]||(P[6]=ee=>h.value=ee),placeholder:"e.g., https://www.example.com",onKeyup:Le(W,["enter"])},null,8,["modelValue"])]),e("div",Wr,[v(fe,{onClick:P[7]||(P[7]=ee=>c.value=!1)},{default:B(()=>P[15]||(P[15]=[q("Cancel",-1)])),_:1,__:[15]}),v(ce,{onClick:W},{default:B(()=>P[16]||(P[16]=[q("Insert",-1)])),_:1,__:[16]})])])]),_:1},8,["show"]),v(je,{show:T.value,onClose:P[12]||(P[12]=ee=>T.value=!1),"max-width":"md"},{default:B(()=>[e("div",Yr,[P[21]||(P[21]=e("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"Insert List",-1)),S.value?(i(),r("div",zr,[e("span",qr,g(S.value),1)])):D("",!0),e("div",Zr,[v(G,{for:"list_items",value:"List Items (one per line)"}),ve(e("textarea",{id:"list_items",rows:"6",class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full","onUpdate:modelValue":P[9]||(P[9]=ee=>A.value=ee),placeholder:"Enter each list item on a new line"},null,512),[[we,A.value]])]),e("div",Gr,[v(G,{for:"list_type",value:"List Type"}),ve(e("select",{id:"list_type",class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full","onUpdate:modelValue":P[10]||(P[10]=ee=>_.value=ee)},P[18]||(P[18]=[e("option",{value:"bullet"},"Bulleted List",-1),e("option",{value:"numbered"},"Numbered List",-1)]),512),[[qe,_.value]])]),e("div",Kr,[v(fe,{onClick:P[11]||(P[11]=ee=>T.value=!1)},{default:B(()=>P[19]||(P[19]=[q("Cancel",-1)])),_:1,__:[19]}),v(ce,{onClick:V},{default:B(()=>P[20]||(P[20]=[q("Insert List",-1)])),_:1,__:[20]})])])]),_:1},8,["show"])],64))}},At=Me(Jr,[["__scopeId","data-v-70bf1503"]]),Xr={class:"mb-4"},Qr={class:"grid grid-cols-1 sm:grid-cols-2 gap-6 mt-4"},ed={key:2},td={key:0,class:"text-gray-500 text-sm mt-1"},sd={class:"mt-6"},ad={class:"flex justify-between items-center mb-3"},ld=["innerHTML"],id={__name:"EditTemplateEmailModal",props:{show:Boolean,title:String,apiEndpoint:String,httpMethod:{type:String,default:"post"},submitButtonText:String,successMessage:String,emailId:Number,projectId:Number,clientId:{type:Number,default:null}},emits:["close","submitted","error"],setup(s,{expose:t,emit:a}){const n=s,o=a,l=De({subject:"",template_id:null,template_data:{}}),m=b([]),d=b({}),c=b(!1),u=b(""),h=b(!1),x=F(()=>m.value.find(L=>L.id===l.template_id)),T=F(()=>x.value?x.value.placeholders.filter(L=>L.is_dynamic||L.is_repeatable||L.is_selectable):[]),A=async()=>{try{const L=await window.axios.get("/api/email-templates");m.value=L.data}catch(L){console.error("Failed to fetch email templates:",L)}},_=async L=>{if(!(!L||!L.placeholders)){c.value=!0,d.value={};try{const O=L.placeholders.filter(w=>(w.is_selectable||w.is_repeatable)&&w.source_model);if(O.length===0){c.value=!1;return}const $={};O.forEach(w=>{$[w.source_model]||($[w.source_model]=[]),$[w.source_model].push(w)});const y=Object.keys($).map(async w=>{try{const C=await window.axios.get(`/api/source-models/${encodeURIComponent(w)}`);$[w].forEach(W=>{d.value[W.name]=C.data.map(J=>({id:J.id,label:J[W.source_attribute]||J.name||`ID: ${J.id}`}))})}catch(C){console.error(`Failed to fetch data for model ${w}:`,C),$[w].forEach(W=>{d.value[W.name]=[]})}});await Promise.all(y)}catch(O){console.error("Error fetching source models data:",O)}finally{c.value=!1}}},S=async L=>{if(Object.assign(l,{subject:"",template_id:null,template_data:{}}),u.value="",d.value={},L.template_id){await A(),l.subject=L.subject,l.template_id=L.template_id,l.template_data=L.template_data||{};const O=m.value.find($=>$.id===l.template_id);O&&await _(O),f()}else console.error("This modal is only for template-based emails")};t({setData:S});const p=L=>{const O={...L};if(O.composition_type="template",typeof O.template_data=="object"&&O.template_data!==null){const $=m.value.find(y=>y.id===O.template_id);if($&&$.placeholders){const y={};$.placeholders.forEach(w=>{const C=w.name,W=O.template_data[C];W!=null&&(w.is_repeatable&&Array.isArray(W)||w.is_selectable,y[C]=W)}),O.template_data=y}}else if(typeof O.template_data=="string")try{O.template_data=JSON.parse(O.template_data)}catch($){console.error("Error parsing template_data:",$),O.template_data={}}else O.template_data={};return O},f=async()=>{h.value=!0;try{const L={},O=m.value.find(w=>w.id===l.template_id);O&&O.placeholders?O.placeholders.forEach(w=>{const C=w.name,W=l.template_data[C];W!=null&&(w.is_repeatable&&Array.isArray(W)||w.is_selectable,L[C]=W)}):Object.assign(L,l.template_data);const $={template_id:l.template_id,template_data:L};n.clientId&&($.client_id=n.clientId);const y=await window.axios.post(`/api/projects/${n.projectId}/email-preview`,$);u.value=y.data.body_html,l.subject=y.data.subject}catch(L){console.error("Error fetching preview:",L),u.value='<p class="text-red-500 italic">Error loading preview.</p>'}finally{h.value=!1}},k=()=>{o("close")},M=L=>{o("submitted",L)},I=L=>{o("error",L)};ne(()=>n.show,L=>{L&&n.emailId&&E()});const E=async()=>{if(n.emailId)try{const O=(await window.axios.get(`/api/emails/${n.emailId}/edit-content`)).data;if(!O.template_id){console.error("This email does not use a template"),o("close");return}await S(O)}catch(L){console.error("Failed to fetch email data:",L),o("error",L)}};return be(()=>{A()}),(L,O)=>(i(),Q(Te,{show:s.show,title:s.title,"api-endpoint":s.apiEndpoint,"http-method":s.httpMethod,"form-data":l,"submit-button-text":s.submitButtonText,"success-message":s.successMessage,"format-data-for-api":p,onClose:k,onSubmitted:M,onError:I,"max-width":"4xl"},{default:B(({errors:$})=>[e("div",Xr,[v(G,{for:"edit_subject",value:"Subject"}),v(re,{id:"edit_subject",type:"text",class:"mt-1 block w-full",modelValue:l.subject,"onUpdate:modelValue":O[0]||(O[0]=y=>l.subject=y),required:""},null,8,["modelValue"]),v(ie,{message:$.subject?$.subject[0]:"",class:"mt-2"},null,8,["message"])]),e("div",null,[O[2]||(O[2]=e("h4",{class:"text-md font-semibold text-gray-800 mb-3 border-b pb-2"},"Editing Template Fields",-1)),e("div",Qr,[(i(!0),r(X,null,ae(T.value,y=>(i(),r("div",{key:y.id},[v(G,{for:y.name,value:y.name},null,8,["for","value"]),y.is_dynamic&&!y.is_selectable&&!y.is_repeatable?(i(),Q(re,{key:0,type:"text",class:"mt-1 block w-full",modelValue:l.template_data[y.name],"onUpdate:modelValue":w=>l.template_data[y.name]=w},null,8,["modelValue","onUpdate:modelValue"])):y.is_selectable?(i(),Q(me,{key:1,id:y.name,modelValue:l.template_data[y.name],"onUpdate:modelValue":w=>l.template_data[y.name]=w,options:d.value[y.name]||[],"value-key":"id","label-key":"label",class:"mt-1 block w-full",disabled:c.value},null,8,["id","modelValue","onUpdate:modelValue","options","disabled"])):y.is_repeatable?(i(),r("div",ed,[c.value?(i(),r("div",td,"Loading options...")):(i(),Q(Oe,{key:1,modelValue:l.template_data[y.name],"onUpdate:modelValue":w=>l.template_data[y.name]=w,options:d.value[y.name]||[],placeholder:`Select ${y.name}`,"label-key":"label","value-key":"id",class:"mt-1"},null,8,["modelValue","onUpdate:modelValue","options","placeholder"]))])):(i(),Q(re,{key:3,type:"text",class:"mt-1 block w-full",modelValue:l.template_data[y.name],"onUpdate:modelValue":w=>l.template_data[y.name]=w},null,8,["modelValue","onUpdate:modelValue"])),v(ie,{message:$[`template_data.${y.name}`]?$[`template_data.${y.name}`][0]:"",class:"mt-2"},null,8,["message"])]))),128))]),e("div",sd,[e("div",ad,[O[1]||(O[1]=e("h4",{class:"text-md font-semibold text-gray-800"},"Email Preview",-1)),v(ce,{onClick:f,disabled:h.value},{default:B(()=>[q(g(h.value?"Loading...":"Refresh Preview"),1)]),_:1},8,["disabled"])]),e("div",{class:"bg-gray-100 p-4 rounded-lg shadow-inner min-h-[300px]",innerHTML:u.value},null,8,ld)])])]),_:1},8,["show","title","api-endpoint","http-method","form-data","submit-button-text","success-message"]))}},od={class:"p-6"},nd={key:0,class:"space-y-4"},rd={class:"border-b pb-4"},dd={class:"text-xl font-medium text-gray-900 mb-2"},ud={class:"grid grid-cols-2 gap-4 text-sm"},cd={class:"text-gray-600"},md={class:"text-gray-900"},vd={class:"text-gray-600 mt-1"},pd={class:"text-gray-600"},hd={class:"text-gray-900"},gd={class:"prose max-w-none"},fd=["innerHTML"],yd={class:"mt-6"},bd={class:"flex items-center justify-between"},_d={class:"flex items-center space-x-2"},wd={key:0,class:"text-gray-500 text-sm mt-2"},xd={key:1,class:"text-red-600 text-sm mt-2"},kd={key:2},Dd={key:0,class:"text-gray-500 text-sm mt-2"},Cd={key:1,class:"mt-3 space-y-2"},$d={class:"flex items-center space-x-3 min-w-0"},jd=["src"],Td={class:"min-w-0"},Ed={class:"text-sm font-medium text-gray-800 truncate"},Md={class:"text-xs text-gray-500 truncate"},Sd={class:"flex items-center space-x-3"},Vd=["href"],Ad=["href","download"],Id=["onClick"],Ld={key:0,class:"mt-4 p-4 bg-red-50 rounded-md"},Od={class:"text-red-700"},Ud={key:1,class:"mt-4 text-sm text-gray-600"},Pd={key:0},Nd={key:2,class:"mt-6 flex justify-end space-x-2"},Rd={__name:"EmailDetailsModal",props:{show:{type:Boolean,required:!0},email:{type:Object,required:!0},canApproveEmails:{type:Boolean,required:!0}},emits:["close","edit","reject","open-bulk-tasks"],setup(s,{emit:t}){const a=s,n=t,o=()=>{n("close")},l=()=>{n("edit",a.email)},m=()=>{n("reject",a.email)},d=()=>{n("open-bulk-tasks",a.email)},{canDo:c}=Xe(),u=c("delete_email_attachments"),h=b([]),x=b(!1),T=b(null),A=async()=>{var S;if((S=a.email)!=null&&S.id){x.value=!0,T.value=null;try{const{data:p}=await Je.get("/api/files",{params:{model_type:"App\\Models\\Email",model_id:a.email.id}});h.value=p}catch(p){T.value="Failed to load attachments",console.error(p)}finally{x.value=!1}}},_=async S=>{if(u.value)try{await Je.delete(`/api/files/${S}`),h.value=h.value.filter(p=>p.id!==S)}catch(p){console.error("Failed to delete attachment",p),alert("Failed to delete attachment")}};return ne(()=>a.show,S=>{S&&A()}),(S,p)=>(i(),Q(je,{show:s.show,onClose:o},{default:B(()=>{var f;return[e("div",od,[e("div",{class:"flex justify-between items-center mb-4"},[p[1]||(p[1]=e("h3",{class:"text-lg font-semibold text-gray-900"},"Email Details",-1)),e("button",{onClick:o,class:"text-gray-400 hover:text-gray-500"},p[0]||(p[0]=[e("svg",{class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),s.email?(i(),r("div",nd,[e("div",rd,[e("h4",dd,g(s.email.subject),1),e("div",ud,[e("div",null,[e("p",cd,[p[2]||(p[2]=q("From: ",-1)),e("span",md,g(((f=s.email.sender)==null?void 0:f.name)||"N/A"),1)]),e("p",vd,[p[3]||(p[3]=q("Status: ",-1)),e("span",{class:te({"px-2 py-1 rounded-full text-xs font-medium":!0,"bg-green-100 text-green-800":s.email.status==="sent","bg-yellow-100 text-yellow-800":s.email.status==="pending_approval","bg-red-100 text-red-800":s.email.status==="rejected","bg-gray-100 text-gray-800":s.email.status==="draft"})},g(s.email.status?s.email.status.replace("_"," ").toUpperCase():"N/A"),3)])]),e("div",null,[e("p",pd,[p[4]||(p[4]=q("Date: ",-1)),e("span",hd,g(new Date(s.email.created_at).toLocaleString()),1)])])])]),e("div",gd,[e("div",{innerHTML:s.email.body},null,8,fd)]),e("div",yd,[e("div",bd,[p[6]||(p[6]=e("h5",{class:"text-md font-semibold text-gray-800"},"Attachments",-1)),e("div",_d,[v(ce,{onClick:d,class:"bg-indigo-600 hover:bg-indigo-700"},{default:B(()=>p[5]||(p[5]=[q("Create Tasks",-1)])),_:1,__:[5]})])]),x.value?(i(),r("div",wd,"Loading attachments...")):T.value?(i(),r("div",xd,g(T.value),1)):(i(),r("div",kd,[h.value.length===0?(i(),r("div",Dd,"No attachments.")):(i(),r("ul",Cd,[(i(!0),r(X,null,ae(h.value,k=>(i(),r("li",{key:k.id,class:"flex items-center justify-between p-2 bg-gray-50 rounded border"},[e("div",$d,[k.thumbnail_url?(i(),r("img",{key:0,src:k.thumbnail_url,alt:"thumb",class:"h-10 w-10 object-cover rounded"},null,8,jd)):D("",!0),e("div",Td,[e("p",Ed,g(k.filename),1),e("p",Md,g(k.mime_type)+" â¢ "+g(Math.round((k.file_size||0)/1024))+" KB",1)])]),e("div",Sd,[k.path_url?(i(),r("a",{key:0,href:k.path_url,target:"_blank",rel:"noopener",class:"text-indigo-600 hover:text-indigo-800 text-sm"},"View",8,Vd)):D("",!0),k.path_url?(i(),r("a",{key:1,href:k.path_url,download:k.filename,class:"text-gray-600 hover:text-gray-800 text-sm"},"Download",8,Ad)):D("",!0),H(u)?(i(),r("button",{key:2,onClick:M=>_(k.id),class:"text-red-600 hover:text-red-800 text-sm"},"Delete",8,Id)):D("",!0)])]))),128))]))]))]),s.email.rejection_reason?(i(),r("div",Ld,[p[7]||(p[7]=e("h5",{class:"font-medium text-red-800"},"Rejection Reason:",-1)),e("p",Od,g(s.email.rejection_reason),1)])):D("",!0),s.email.approver?(i(),r("div",Ud,[e("p",null,"Approved/Rejected by: "+g(s.email.approver.name),1),s.email.sent_at?(i(),r("p",Pd,"Sent at: "+g(new Date(s.email.sent_at).toLocaleString()),1)):D("",!0)])):D("",!0),(s.email.status==="pending_approval"||s.email.status==="pending_approval_received")&&s.canApproveEmails?(i(),r("div",Nd,[v(ce,{onClick:l,class:"bg-blue-600 hover:bg-blue-700"},{default:B(()=>p[8]||(p[8]=[q("Edit & Approve",-1)])),_:1,__:[8]}),v(fe,{onClick:m,class:"text-red-600 hover:text-red-800"},{default:B(()=>p[9]||(p[9]=[q("Reject",-1)])),_:1,__:[9]})])):D("",!0)])):D("",!0)])]}),_:1},8,["show"]))}},Fd={key:0,class:"bg-white p-6 rounded-xl shadow-md hover:shadow-lg transition-shadow"},Bd={class:"flex justify-between items-center mb-4"},Hd={key:0,class:"flex gap-3"},Wd={key:1,class:"mt-2 bg-red-100 border border-red-400 text-red-700 px-4 py-2 rounded relative",role:"alert"},Yd={class:"block sm:inline"},zd={class:"mb-4 bg-gray-50 p-4 rounded-lg"},qd={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},Zd={class:"mt-1 relative rounded-md shadow-sm"},Gd={__name:"ProjectEmailsTab",props:{projectId:{type:Number,required:!0},canViewEmails:{type:Boolean,required:!0},canComposeEmails:{type:Boolean,required:!0},canApproveEmails:{type:Boolean,required:!0},userProjectRole:{type:Object,required:!0},openCompose:{type:Boolean,required:!1,default:!1}},emits:["emailsUpdated","resetOpenCompose"],setup(s,{emit:t}){const a=s,n=t,o=b([]),l=b(!0),m=b(""),d=b(null),c=b(!1),u=b(!1),h=b(""),x=b(""),T=b("post"),A=b(""),_=b(""),S=b(!1),p=b(!1),f=b(null),k=b(""),M=b(""),I=b(""),E=b(null);Ue();const L=De({type:"",startDate:"",endDate:"",search:""});let O=null;const $=()=>{C()},y=()=>{L.type="",L.startDate="",L.endDate="",L.search="",C()},w=()=>{clearTimeout(O),O=setTimeout(()=>{$()},500)},C=async()=>{l.value=!0,m.value="";try{const Y=new URLSearchParams;L.type&&Y.append("type",L.type),L.startDate&&Y.append("start_date",L.startDate),L.endDate&&Y.append("end_date",L.endDate),L.search&&Y.append("search",L.search);const j=Y.toString(),U=`/api/projects/${a.projectId}/emails-simplified${j?`?${j}`:""}`,N=await window.axios.get(U);o.value=N.data,n("emailsUpdated",o.value)}catch(Y){m.value="Failed to load email data.",console.error("Error fetching project emails:",Y)}finally{l.value=!1}},W=async Y=>{d.value=null,c.value=!0;try{const j=await window.axios.get(`/api/emails/${Y.id}`);d.value={...Y,subject:j.data.subject,body:j.data.body_html}}catch(j){console.error("Failed to fetch full email details:",j),d.value={subject:"Error",body:"Failed to load email content.",created_at:new Date().toISOString(),status:"error",sender:{name:"System"}}}},J=async Y=>{try{console.log("Opening email editor for email ID:",Y.id),d.value=Y;const U=(await window.axios.get(`/api/emails/${Y.id}/edit-content`)).data;U.template_id?(console.log("Opening template-based email editor for email ID:",Y.id),f.value=Y.id,k.value=`/api/emails/${Y.id}/edit-and-approve`,M.value="Approve & Send",I.value="Email updated and approved successfully!",E.value=U.client_id,p.value=!0,c.value=!1):(h.value="Edit and Approve Email",x.value=`/api/emails/${Y.id}/edit-and-approve`,T.value="post",A.value="Approve & Send",_.value="Email updated and approved successfully!",u.value=!0,c.value=!1)}catch(j){console.error("Failed to determine email type:",j),m.value="Failed to load email for editing."}},V=Y=>{d.value=Y,h.value="Reject Email",x.value=`/api/emails/${Y.id}/reject`,T.value="post",A.value="Reject Email",_.value="Email rejected successfully!",u.value=!0,c.value=!1},R=async Y=>{console.log("Form submitted successfully:",Y),await C(),u.value=!1},Z=()=>{u.value=!1},P=()=>{S.value=!1,n("resetOpenCompose")},ee=async Y=>{console.log("Compose email submitted successfully:",Y),await C(),S.value=!1,n("resetOpenCompose")},de=()=>{p.value=!1},xe=async Y=>{console.log("Template email edited and submitted successfully:",Y),await C(),p.value=!1};return ne(()=>a.openCompose,Y=>{console.log("Watcher triggered: openCompose changed to",Y),Y&&(console.log("Opening compose email modal"),S.value=!0)}),be(()=>{a.canViewEmails&&C(),a.openCompose&&(S.value=!0)}),(Y,j)=>{var U;return s.canViewEmails?(i(),r("div",Fd,[e("div",Bd,[j[10]||(j[10]=e("h4",{class:"text-lg font-semibold text-gray-900"},"Email Communication",-1)),s.canComposeEmails?(i(),r("div",Hd,[v(ce,{class:"bg-indigo-600 hover:bg-indigo-700 transition-colors",onClick:j[0]||(j[0]=N=>S.value=!0)},{default:B(()=>j[9]||(j[9]=[q(" Compose Email ",-1)])),_:1,__:[9]})])):D("",!0),m.value?(i(),r("div",Wd,[e("span",Yd,g(m.value),1)])):D("",!0)]),e("div",zd,[e("div",qd,[e("div",null,[v(G,{for:"typeFilter",value:"Type"}),ve(e("select",{id:"typeFilter","onUpdate:modelValue":j[1]||(j[1]=N=>L.type=N),class:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md",onChange:$},j[11]||(j[11]=[e("option",{value:""},"All Types",-1),e("option",{value:"sent"},"Sent",-1),e("option",{value:"received"},"Received",-1)]),544),[[qe,L.type]])]),e("div",null,[v(G,{for:"startDate",value:"From Date"}),v(re,{type:"date",id:"startDate",modelValue:L.startDate,"onUpdate:modelValue":j[2]||(j[2]=N=>L.startDate=N),class:"mt-1 block w-full",onChange:$},null,8,["modelValue"])]),e("div",null,[v(G,{for:"endDate",value:"To Date"}),v(re,{type:"date",id:"endDate",modelValue:L.endDate,"onUpdate:modelValue":j[3]||(j[3]=N=>L.endDate=N),class:"mt-1 block w-full",onChange:$},null,8,["modelValue"])]),e("div",null,[v(G,{for:"searchFilter",value:"Search Content"}),e("div",Zd,[v(re,{type:"text",id:"searchFilter",modelValue:L.search,"onUpdate:modelValue":j[4]||(j[4]=N=>L.search=N),class:"block w-full pr-10",placeholder:"Search in email content...",onInput:w},null,8,["modelValue"]),j[12]||(j[12]=e("div",{class:"absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none"},[e("svg",{class:"h-5 w-5 text-gray-400",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},[e("path",{"fill-rule":"evenodd",d:"M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z","clip-rule":"evenodd"})])],-1))])])]),e("div",{class:"mt-3 flex justify-end"},[e("button",{type:"button",class:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",onClick:y}," Reset Filters ")])]),v(Es,{emails:o.value,loading:l.value,error:m.value,onView:W},null,8,["emails","loading","error"]),v(Rd,{show:c.value,email:d.value,"can-approve-emails":s.canApproveEmails,onClose:j[5]||(j[5]=N=>c.value=!1),onEdit:J,onReject:V},null,8,["show","email","can-approve-emails"]),v(At,{show:S.value,"project-id":s.projectId,"user-project-role":s.userProjectRole,onClose:P,onSubmitted:ee,onError:j[6]||(j[6]=N=>console.error("ComposeEmailModal error:",N))},null,8,["show","project-id","user-project-role"]),v(jr,{show:u.value,title:h.value,"api-endpoint":x.value,"http-method":T.value,"submit-button-text":A.value,"success-message":_.value,"email-id":(U=d.value)==null?void 0:U.id,"project-id":s.projectId,onClose:Z,onSubmitted:R,onError:j[7]||(j[7]=N=>console.error("EmailActionModal error:",N)),onFetchEmails:C},null,8,["show","title","api-endpoint","http-method","submit-button-text","success-message","email-id","project-id"]),v(id,{show:p.value,title:"Edit Template Email","api-endpoint":k.value,"http-method":"post","submit-button-text":M.value,"success-message":I.value,"email-id":f.value,"project-id":s.projectId,"client-id":E.value,onClose:de,onSubmitted:xe,onError:j[8]||(j[8]=N=>console.error("EditTemplateEmailModal error:",N))},null,8,["show","api-endpoint","submit-button-text","success-message","email-id","project-id","client-id"])])):D("",!0)}}},Kd={key:0,class:"bg-white p-6 rounded-xl shadow-md hover:shadow-lg transition-shadow"},Jd={class:"flex justify-between items-center mb-4"},Xd={class:"flex gap-3"},Qd={class:"mb-4 bg-gray-50 p-4 rounded-lg"},eu={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},tu={class:"mt-1 relative rounded-md shadow-sm"},su={class:"mb-8 p-4 bg-blue-50 rounded-md"},au={class:"flex items-center"},lu={class:"text-sm text-blue-800"},iu={key:0,class:"text-center text-gray-600 text-sm animate-pulse py-4"},ou={key:1,class:"text-center text-red-600 text-sm font-medium py-4"},nu={key:2,class:"space-y-4"},ru={class:"flex justify-between"},du={class:"flex-grow"},uu={key:0,class:"text-xs text-red-400 block mt-1"},cu={class:"flex items-center mt-1"},mu={class:"text-xs text-gray-500"},vu={key:0,class:"ml-2 px-2 py-0.5 bg-indigo-100 text-indigo-800 text-xs rounded-full"},pu={key:0},hu={key:3,class:"text-gray-400 text-sm"},gu={class:"p-6"},fu={class:"flex justify-between items-center mb-4"},yu={key:0,class:"mb-4 p-3 bg-gray-100 rounded-md"},bu={class:"text-sm text-gray-700"},_u={class:"text-xs text-gray-500 mt-1"},wu={key:1,class:"mb-4"},xu={key:0,class:"text-center py-4"},ku={key:1,class:"space-y-3 max-h-60 overflow-y-auto"},Du={class:"text-sm text-gray-700"},Cu={class:"text-xs text-gray-500 mt-1"},$u={key:2,class:"text-center py-3"},ju={key:2,class:"mb-4"},Tu={key:0,class:"mt-2 text-sm text-red-600"},Eu={key:3,class:"mt-6 flex justify-end"},Mu={__name:"ProjectNotesTab",props:{projectId:{type:Number,required:!0},googleChatId:{type:String,default:null},canViewNotes:{type:Boolean,required:!0},canAddNotes:{type:Boolean,required:!0}},emits:["notesUpdated"],setup(s,{emit:t}){const a=s,n=t,o=b([]),l=b(!0),m=b(""),d=b(!1),c=b(!1),u=b(null),h=b(""),x=b(""),T=b([]),A=b(!1),_=De({startDate:"",endDate:"",search:""});let S=null;const p=async()=>{l.value=!0,m.value="";try{const O=new URLSearchParams;_.startDate&&O.append("start_date",_.startDate),_.endDate&&O.append("end_date",_.endDate),_.search&&O.append("search",_.search);const $=O.toString(),y=`/api/projects/${a.projectId}/notes${$?`?${$}`:""}`,w=await window.axios.get(y);o.value=w.data,n("notesUpdated",o.value)}catch(O){m.value="Failed to load notes data.",console.error("Error fetching project notes:",O)}finally{l.value=!1}},f=()=>{d.value=!0},k=async O=>{u.value=O,h.value="",x.value="",T.value=[],A.value=!0,c.value=!0;try{const $=await window.axios.get(`/api/projects/${a.projectId}/notes/${O.id}/replies`);$.data.success?T.value=$.data.replies:console.error("Failed to fetch replies:",$.data.message)}catch($){console.error("Error fetching replies:",$)}finally{A.value=!1}},M=async()=>{var O,$;if(!u.value||!h.value.trim()){x.value="Reply content is required";return}x.value="";try{const y=await window.axios.post(`/api/projects/${a.projectId}/notes/${u.value.id}/reply`,{content:h.value});if(y.data.success){h.value="",A.value=!0;const w=await window.axios.get(`/api/projects/${a.projectId}/notes/${u.value.id}/replies`);w.data.success&&(T.value=w.data.replies),A.value=!1,await p()}else x.value=y.data.message||"Failed to send reply"}catch(y){console.error("Error sending reply:",y),x.value=(($=(O=y.response)==null?void 0:O.data)==null?void 0:$.message)||"An error occurred while sending the reply"}},I=()=>{p()},E=()=>{_.startDate="",_.endDate="",_.search="",p()},L=()=>{clearTimeout(S),S=setTimeout(()=>{I()},500)};return be(()=>{a.canViewNotes&&p()}),(O,$)=>s.canViewNotes?(i(),r("div",Kd,[e("div",Jd,[$[10]||($[10]=e("h4",{class:"text-lg font-semibold text-gray-900"},"Project Notes",-1)),e("div",Xd,[s.canAddNotes?(i(),Q(ce,{key:0,class:"bg-indigo-600 hover:bg-indigo-700 transition-colors",onClick:f},{default:B(()=>$[9]||($[9]=[q(" Add Note ",-1)])),_:1,__:[9]})):D("",!0)])]),e("div",Qd,[e("div",eu,[e("div",null,[v(G,{for:"noteStartDate",value:"From Date"}),v(re,{type:"date",id:"noteStartDate",modelValue:_.startDate,"onUpdate:modelValue":$[0]||($[0]=y=>_.startDate=y),class:"mt-1 block w-full",onChange:I},null,8,["modelValue"])]),e("div",null,[v(G,{for:"noteEndDate",value:"To Date"}),v(re,{type:"date",id:"noteEndDate",modelValue:_.endDate,"onUpdate:modelValue":$[1]||($[1]=y=>_.endDate=y),class:"mt-1 block w-full",onChange:I},null,8,["modelValue"])]),e("div",null,[v(G,{for:"noteSearchFilter",value:"Search Content"}),e("div",tu,[v(re,{type:"text",id:"noteSearchFilter",modelValue:_.search,"onUpdate:modelValue":$[2]||($[2]=y=>_.search=y),class:"block w-full pr-10",placeholder:"Search in note content...",onInput:L},null,8,["modelValue"]),$[11]||($[11]=e("div",{class:"absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none"},[e("svg",{class:"h-5 w-5 text-gray-400",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},[e("path",{"fill-rule":"evenodd",d:"M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z","clip-rule":"evenodd"})])],-1))])])]),e("div",{class:"mt-3 flex justify-end"},[e("button",{type:"button",class:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",onClick:E}," Reset Filters ")])]),e("div",su,[e("div",au,[$[13]||($[13]=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 text-blue-600 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),e("p",lu,[$[12]||($[12]=q(" Daily Standups are now available in their own dedicated tab. ",-1)),e("button",{onClick:$[3]||($[3]=y=>O.$emit("changeTab","standups")),class:"text-blue-600 hover:text-blue-800 font-medium underline"}," Click here to view Daily Standups ")])])]),e("div",null,[$[15]||($[15]=e("h5",{class:"text-md font-semibold text-gray-900 mb-4 border-b pb-2"},"Notes",-1)),l.value?(i(),r("div",iu," Loading notes... ")):m.value?(i(),r("div",ou,g(m.value),1)):o.value.length?(i(),r("div",nu,[(i(!0),r(X,null,ae(o.value,y=>{var w;return i(),r("div",{key:y.id,class:"p-4 bg-gray-50 rounded-md shadow-sm hover:bg-gray-100 transition-colors"},[e("div",ru,[e("div",du,[e("p",{class:te(["text-sm",{"text-gray-700":y.content!=="[Encrypted content could not be decrypted]","text-red-500 italic":y.content==="[Encrypted content could not be decrypted]"}])},[q(g(y.content)+" ",1),y.content==="[Encrypted content could not be decrypted]"?(i(),r("span",uu," (There was an issue decrypting this note. Please contact an administrator.) ")):D("",!0)],2),e("div",cu,[e("p",mu,"Added by "+g(((w=y.user)==null?void 0:w.name)||"Unknown")+" on "+g(new Date(y.created_at).toLocaleDateString()),1),y.reply_count>0?(i(),r("span",vu,g(y.reply_count)+" "+g(y.reply_count===1?"reply":"replies"),1)):D("",!0)])]),s.googleChatId&&y.chat_message_id?(i(),r("div",pu,[v(fe,{class:"text-sm text-indigo-600 hover:text-indigo-800",onClick:C=>k(y)},{default:B(()=>$[14]||($[14]=[q(" View ",-1)])),_:2,__:[14]},1032,["onClick"])])):D("",!0)])])}),128))])):(i(),r("p",hu,"No notes available."))]),v(jt,{show:d.value,"project-id":s.projectId,onClose:$[4]||($[4]=y=>d.value=!1),onNoteAdded:p},null,8,["show","project-id"]),v(je,{show:c.value,onClose:$[8]||($[8]=y=>c.value=!1)},{default:B(()=>{var y;return[e("div",gu,[e("div",fu,[$[17]||($[17]=e("h3",{class:"text-lg font-semibold text-gray-900"},"Reply to Note",-1)),e("button",{onClick:$[5]||($[5]=w=>c.value=!1),class:"text-gray-400 hover:text-gray-500"},$[16]||($[16]=[e("svg",{class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),u.value?(i(),r("div",yu,[e("p",bu,g(u.value.content),1),e("p",_u,"Added by "+g(((y=u.value.user)==null?void 0:y.name)||"Unknown")+" on "+g(new Date(u.value.created_at).toLocaleDateString()),1)])):D("",!0),u.value?(i(),r("div",wu,[$[20]||($[20]=e("h4",{class:"text-sm font-medium text-gray-700 mb-2"},"Replies",-1)),A.value?(i(),r("div",xu,$[18]||($[18]=[e("p",{class:"text-gray-500 text-sm"},"Loading replies...",-1)]))):T.value.length?(i(),r("div",ku,[(i(!0),r(X,null,ae(T.value,w=>{var C;return i(),r("div",{key:w.id,class:"p-2 bg-gray-50 rounded border-l-2 border-indigo-300"},[e("p",Du,g(w.content),1),e("p",Cu,"Replied by "+g(((C=w.user)==null?void 0:C.name)||"Unknown")+" on "+g(new Date(w.created_at).toLocaleDateString()),1)])}),128))])):(i(),r("div",$u,$[19]||($[19]=[e("p",{class:"text-gray-500 text-sm"},"No replies yet. Be the first to reply!",-1)])))])):D("",!0),s.canAddNotes?(i(),r("div",ju,[v(G,{for:"reply-content",value:"Your Reply"}),ve(e("textarea",{id:"reply-content","onUpdate:modelValue":$[6]||($[6]=w=>h.value=w),class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm mt-1 block w-full h-32",placeholder:"Enter your reply..."},null,512),[[we,h.value]]),x.value?(i(),r("p",Tu,g(x.value),1)):D("",!0)])):D("",!0),s.canAddNotes?(i(),r("div",Eu,[v(fe,{onClick:$[7]||($[7]=w=>c.value=!1),class:"mr-2"},{default:B(()=>$[21]||($[21]=[q("Cancel",-1)])),_:1,__:[21]}),v(ce,{onClick:M},{default:B(()=>$[22]||($[22]=[q("Send Reply",-1)])),_:1,__:[22]})])):D("",!0)])]}),_:1},8,["show"])])):D("",!0)}},Su={class:"w-full"},Vu={key:0,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"},Au={key:1,class:"text-red-600 text-sm py-2 text-center"},Iu={key:2,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"},Lu={class:"p-4 bg-blue-100 rounded-lg shadow-sm transition-shadow hover:shadow-lg"},Ou={class:"text-2xl font-bold text-blue-900 mt-1"},Uu={class:"p-4 bg-green-100 rounded-lg shadow-sm transition-shadow hover:shadow-lg"},Pu={class:"text-2xl font-bold text-green-900 mt-1"},Nu={class:"p-4 bg-red-100 rounded-lg shadow-sm transition-shadow hover:shadow-lg"},Ru={class:"text-2xl font-bold mt-1"},Fu={key:3,class:"space-y-2 text-sm text-gray-700 mt-6 pt-4 border-t border-gray-200"},Bu={key:0},Hu={class:"text-gray-900 whitespace-pre-wrap"},Wu={key:4,class:"text-gray-400 text-sm mt-4 text-center"},Yu={__name:"ProjectFinancialsCard",props:{projectId:{type:Number,required:!0},canViewProjectServicesAndPayments:{type:Boolean,default:!1},canViewProjectTransactions:{type:Boolean,default:!1}},setup(s){const t=s,a=b(null),n=b([]),o=b(!0),l=b(null),m=ze,d=F(()=>{var A;if(!ge.value||Object.keys(ge.value).length===0)return 0;const T=parseFloat(((A=a.value)==null?void 0:A.total_amount)||0);return Ie(T,"USD",m.value)}),c=F(()=>!n.value.length||!ge.value||Object.keys(ge.value).length===0?0:n.value.filter(T=>T.type==="expense").reduce((T,A)=>T+Ie(parseFloat(A.amount||0),A.currency,m.value),0)),u=F(()=>!n.value.length||!ge.value||Object.keys(ge.value).length===0?0:n.value.filter(T=>T.type==="income").reduce((T,A)=>T+Ie(parseFloat(A.amount||0),A.currency,m.value),0)),h=F(()=>u.value-c.value),x=async()=>{var T,A;if(o.value=!0,l.value=null,n.value=[],!ge.value||Object.keys(ge.value).length===0){l.value="Currency rates not loaded. Please try again.",o.value=!1;return}if(!t.canViewProjectServicesAndPayments&&!t.canViewProjectTransactions){l.value="You don't have permission to view project financials.",o.value=!1;return}try{if(t.canViewProjectServicesAndPayments){const _=await window.axios.get(`/api/projects/${t.projectId}/sections/services-payment`);a.value=_.data}else a.value=null;if(t.canViewProjectTransactions){const _=await window.axios.get(`/api/projects/${t.projectId}/sections/transactions`);n.value=_.data}else n.value=[]}catch(_){console.error("Failed to fetch project financials:",_),l.value=((A=(T=_.response)==null?void 0:T.data)==null?void 0:A.message)||"Failed to load financial data."}finally{o.value=!1}};return ne([()=>t.canViewProjectServicesAndPayments,()=>t.canViewProjectTransactions,m,ge],(T,A)=>{t.projectId&&ge.value&&Object.keys(ge.value).length>0?x():t.projectId||(o.value=!0,l.value=null)},{immediate:!0,deep:!0}),(T,A)=>{var _,S;return i(),r("div",Su,[o.value?(i(),r("div",Vu,[(i(),r(X,null,ae(4,p=>e("div",{key:p,class:"p-4 bg-gray-100 rounded-lg animate-pulse h-24"},A[0]||(A[0]=[e("div",{class:"h-4 bg-gray-200 rounded w-1/2 mb-3"},null,-1),e("div",{class:"h-6 bg-gray-200 rounded w-3/4"},null,-1)]))),64))])):l.value?(i(),r("div",Au,[e("p",null,g(l.value),1)])):(i(),r("div",Iu,[e("div",Lu,[A[1]||(A[1]=e("p",{class:"text-sm font-medium text-blue-800"},"Contract Value",-1)),e("p",Ou,g(H(Ve)(d.value,H(m).value)),1)]),e("div",Uu,[A[2]||(A[2]=e("p",{class:"text-sm font-medium text-green-800"},"Total Income",-1)),e("p",Pu,g(H(Ve)(u.value,H(m))),1)]),e("div",Nu,[A[3]||(A[3]=e("p",{class:"text-sm font-medium text-red-800"},"Total Expenses",-1)),e("p",Ru,g(H(Ve)(c.value,H(m))),1)]),e("div",{class:te(["p-4 rounded-lg shadow-sm transition-shadow hover:shadow-lg",{"bg-green-100":h.value>=0,"bg-red-100":h.value<0}])},[e("p",{class:te(["text-sm font-medium",{"text-green-800":h.value>=0,"text-red-800":h.value<0}])},"Profit/Loss",2),e("p",{class:te(["text-2xl font-bold mt-1",{"text-green-900":h.value>=0,"text-red-900":h.value<0}])},g(H(Ve)(h.value,H(m))),3)],2)])),!o.value&&!l.value&&((_=a.value)!=null&&_.contract_details)?(i(),r("dl",Fu,[(S=a.value)!=null&&S.contract_details?(i(),r("div",Bu,[A[4]||(A[4]=e("dt",{class:"font-medium w-full block mt-2"},"Contract Details:",-1)),e("dd",Hu,g(a.value.contract_details),1)])):D("",!0)])):D("",!0),!o.value&&!l.value&&!a.value&&!n.value.length?(i(),r("p",Wu," No financial information available. ")):D("",!0)])}}},zu={class:"bg-white p-4 rounded-xl shadow-md transition-shadow hover:shadow-lg flex flex-col h-full"},qu={key:0,class:"flex-1 flex items-center justify-center"},Zu={key:1,class:"flex-1 flex items-center justify-center text-red-600 text-xs text-center"},Gu={key:2,class:"flex-1 flex flex-col overflow-hidden"},Ku={key:0,class:"flex-1 overflow-y-auto"},Ju={class:"p-2 bg-gray-50 rounded-lg flex items-center space-x-2"},Xu={class:"flex-shrink-0 bg-indigo-500 rounded-full h-8 w-8 flex items-center justify-center text-white font-medium text-xs"},Qu={class:"flex-1"},ec={class:"text-sm font-semibold text-gray-900 truncate"},tc={class:"text-xs text-gray-500 flex items-center mt-0.5"},sc={key:0,class:"flex items-center space-x-1 mr-2"},ac={key:1,class:"flex items-center space-x-1"},lc=["href"],ic={key:0,class:"mt-3"},oc={class:"space-y-1"},nc={class:"flex items-center space-x-2"},rc={class:"flex-shrink-0 bg-gray-300 rounded-full h-6 w-6 flex items-center justify-center text-white font-medium text-xs"},dc={class:"text-xs font-semibold text-gray-900"},uc={key:0,class:"text-xs text-gray-500"},cc=["href"],mc={key:1,class:"text-gray-400 text-xs flex-1 flex items-center justify-center text-center"},vc={__name:"ProjectClientsCard",props:{projectId:{type:Number,required:!0},canViewClientContacts:{type:Boolean,default:!1}},setup(s){const t=s,a=b([]),n=b(!0),o=b(null),l=async()=>{var m,d;if(n.value=!0,o.value=null,!t.canViewClientContacts){o.value="You don't have permission to view project clients.",n.value=!1;return}try{const c=await window.axios.get(`/api/projects/${t.projectId}/sections/clients?type=clients`);a.value=c.data}catch(c){console.error("Failed to fetch project clients:",c),o.value=((d=(m=c.response)==null?void 0:m.data)==null?void 0:d.message)||"Failed to load client data."}finally{n.value=!1}};return be(()=>{l()}),ne(()=>t.canViewClientContacts,()=>{l()}),(m,d)=>(i(),r("div",zu,[d[3]||(d[3]=e("h4",{class:"text-sm font-semibold text-gray-900 mb-3"},"Project Clients",-1)),n.value?(i(),r("div",qu,d[0]||(d[0]=[e("div",{class:"space-y-2 w-full"},[e("div",{class:"h-3 bg-gray-200 rounded animate-pulse w-3/4 mx-auto"}),e("div",{class:"h-3 bg-gray-200 rounded animate-pulse w-2/3 mx-auto"})],-1)]))):o.value?(i(),r("div",Zu,[e("p",null,g(o.value),1)])):(i(),r("div",Gu,[a.value.length?(i(),r("div",Ku,[(i(!0),r(X,null,ae(a.value,c=>(i(),r("div",{key:c.id,class:"space-y-3"},[e("div",Ju,[e("div",Xu,g(c.name.charAt(0).toUpperCase()),1),e("div",Qu,[e("p",ec,g(c.name),1),e("p",tc,[c.email?(i(),r("span",sc,[v(H(yt),{class:"h-3 w-3"}),e("span",null,g(c.email),1)])):D("",!0),c.phone?(i(),r("span",ac,[v(H(Rs),{class:"h-3 w-3"}),e("span",null,g(c.phone),1)])):D("",!0)])]),c.website?(i(),r("a",{key:0,href:c.website,target:"_blank",class:"text-indigo-600 hover:text-indigo-800 transition-colors"},[v(H(Ps),{class:"h-5 w-5"})],8,lc)):D("",!0)]),c.contacts&&c.contacts.length?(i(),r("div",ic,[d[1]||(d[1]=e("p",{class:"text-xs font-semibold text-gray-500 uppercase mb-2 ml-2"},"Client Contacts",-1)),e("ul",oc,[(i(!0),r(X,null,ae(c.contacts,u=>(i(),r("li",{key:u.id,class:"flex items-center justify-between p-2 bg-gray-100 rounded-lg"},[e("div",nc,[e("div",rc,g(u.name.charAt(0).toUpperCase()),1),e("div",null,[e("p",dc,g(u.name),1),u.role?(i(),r("p",uc,g(u.role),1)):D("",!0)])]),u.email?(i(),r("a",{key:0,href:"mailto:"+u.email,class:"text-gray-400 hover:text-indigo-600 transition-colors",title:"Email Contact"},[v(H(yt),{class:"h-4 w-4"})],8,cc)):D("",!0)]))),128))])])):D("",!0)]))),128))])):(i(),r("p",mc,d[2]||(d[2]=[q(" No clients assigned. ",-1),e("br",null,null,-1),q(" To view this card, please assign a client to the project. ",-1)])))]))]))}},pc={class:"bg-white p-4 rounded-xl shadow-md transition-shadow hover:shadow-lg flex flex-col h-full"},hc={key:0,class:"flex-1 flex items-center justify-center"},gc={key:1,class:"flex-1 flex items-center justify-center text-red-600 text-xs text-center"},fc={key:2,class:"flex-1 flex flex-col overflow-hidden"},yc={class:"flex items-center space-x-2 text-gray-500 mb-3"},bc={class:"text-xs font-semibold"},_c={key:0,class:"space-y-2 text-sm text-gray-700 flex-1 overflow-y-auto pr-2",style:{"max-height":"250px"}},wc={class:"flex items-center space-x-2"},xc={class:"flex-shrink-0 bg-indigo-500 rounded-full h-8 w-8 flex items-center justify-center text-white font-medium text-xs"},kc={class:"flex-1"},Dc={class:"text-gray-900 text-sm"},Cc={class:"text-xs text-gray-500"},$c={class:"flex-shrink-0 flex items-center space-x-2 ml-auto"},jc={class:"text-xs text-gray-500"},Tc={key:1,class:"text-gray-400 text-xs flex-1 flex items-center justify-center"},Ec={__name:"ProjectTeamCard",props:{projectId:{type:Number,required:!0},canViewUsers:{type:Boolean,default:!1}},setup(s){const t=s,a=Ue(),n=b([]),o=b(!0),l=b(null),m=async()=>{var u,h;if(o.value=!0,l.value=null,!t.canViewUsers){l.value="You don't have permission to view project team members.",o.value=!1,n.value=[];return}try{const x=await window.axios.get(`/api/projects/${t.projectId}/sections/users`);n.value=x.data.users||[]}catch(x){console.error("Failed to fetch project users:",x),l.value=((h=(u=x.response)==null?void 0:u.data)==null?void 0:h.message)||"Failed to load team data."}finally{o.value=!1}},d=u=>{if(!u.availabilities||u.availabilities.length===0)return"No availability submitted.";const h=u.availabilities[0];return h.is_available?h.time_slots&&h.time_slots.length>0?`Available: ${h.time_slots.map(T=>`${T.start_time}-${T.end_time}`).join(", ")}`:"Available: No specific slots.":`Not available: ${h.reason||"N/A"}`},c=u=>!u.availabilities||u.availabilities.length===0?null:u.availabilities[0].is_available?As:Fs;return be(()=>{m()}),ne([()=>t.canViewUsers,()=>a.value,()=>t.projectId],()=>{m()},{deep:!0}),(u,h)=>(i(),r("div",pc,[h[1]||(h[1]=e("h4",{class:"text-sm font-semibold text-gray-900 mb-3"},"Project Team",-1)),o.value?(i(),r("div",hc,h[0]||(h[0]=[e("div",{class:"space-y-2 w-full"},[e("div",{class:"h-3 bg-gray-200 rounded animate-pulse w-3/4 mx-auto"}),e("div",{class:"h-3 bg-gray-200 rounded animate-pulse w-2/3 mx-auto"})],-1)]))):l.value?(i(),r("div",gc,[e("p",null,g(l.value),1)])):(i(),r("div",fc,[e("div",yc,[v(H(Et),{class:"h-5 w-5"}),e("span",bc,g(n.value.length)+" Member(s)",1)]),n.value.length?(i(),r("ul",_c,[(i(!0),r(X,null,ae(n.value,x=>{var T;return i(),r("li",{key:x.id,class:"p-2 bg-gray-50 rounded-lg border border-gray-200 hover:bg-gray-100 transition-colors"},[e("div",wc,[e("div",xc,g(x.name.charAt(0).toUpperCase()),1),e("div",kc,[e("strong",Dc,g(x.name),1),e("p",Cc,g(((T=x.pivot)==null?void 0:T.role)||"N/A"),1)]),e("div",$c,[e("span",jc,g(d(x)),1),c(x)?(i(),Q(kt(c(x)),{key:0,class:te({"h-5 w-5":!0,"text-green-500":x.availabilities&&x.availabilities.length>0&&x.availabilities[0].is_available,"text-red-500":x.availabilities&&x.availabilities.length>0&&!x.availabilities[0].is_available})},null,8,["class"])):D("",!0)])])])}),128))])):(i(),r("p",Tc,"No team members assigned."))]))]))}},Mc={class:"bg-white p-4 rounded-xl shadow-md transition-shadow hover:shadow-lg flex flex-col h-full"},Sc={class:"flex items-center space-x-2 mb-3"},Vc={key:0,class:"flex-1 flex items-center justify-center"},Ac={key:1,class:"flex-1 flex items-center justify-center text-red-600 text-xs text-center"},Ic={key:2,class:"flex-1 flex flex-col overflow-hidden"},Lc={key:0,class:"space-y-2 text-xs"},Oc={class:"flex items-center space-x-2 text-gray-500 mb-3"},Uc={class:"text-xs font-semibold"},Pc={class:"flex flex-col p-2 bg-green-50 rounded-lg"},Nc={class:"text-gray-900 font-bold mt-1"},Rc={class:"flex flex-col p-2 bg-blue-50 rounded-lg"},Fc={class:"text-gray-900 font-bold mt-1"},Bc={class:"flex flex-col p-2 bg-indigo-50 rounded-lg"},Hc={class:"text-gray-900 font-bold mt-1"},Wc={class:"mt-4 pt-2 border-t border-gray-200"},Yc={class:"flex justify-between items-center text-xs text-gray-500 font-medium mb-1"},zc={class:"w-full bg-gray-200 rounded-full h-1.5"},qc={key:1,class:"flex-1 flex items-center justify-center text-gray-400 text-xs text-center"},Zc={key:0},Gc={key:1},Kc={key:2,class:"mt-4 text-right"},Jc={__name:"UserFinancialCard",props:{projectId:{type:Number,required:!0}},emits:["viewUserTransactions"],setup(s,{emit:t}){const a=s,n=t,o=Ue(),l=b(!0),m=b(null),d=b([]),c=ze,u=async()=>{var p,f;if(l.value=!0,m.value=null,!o.value||!o.value.id||!a.projectId){d.value=[],l.value=!1;return}if(!ge.value||Object.keys(ge.value).length===0){m.value="Currency rates not loaded. Please try again.",l.value=!1;return}try{const k=await window.axios.get(`/api/projects/${a.projectId}/sections/transactions?user_id=${o.value.id}`);d.value=k.data}catch(k){console.error("Failed to fetch user transactions for UserFinancialsCard:",k),m.value=((f=(p=k.response)==null?void 0:p.data)==null?void 0:f.message)||"Failed to load your financial data.",d.value=[]}finally{l.value=!1}},h=F(()=>!o.value||!o.value.id||!d.value.length||!ge.value||Object.keys(ge.value).length===0?0:d.value.filter(f=>f.type==="expense").reduce((f,k)=>f+Ie(parseFloat(k.amount||0),k.currency,c.value),0)),x=F(()=>!o.value||!o.value.id||!d.value.length||!ge.value||Object.keys(ge.value).length===0?0:d.value.filter(f=>f.type==="bonus").reduce((f,k)=>f+Ie(parseFloat(k.amount||0),k.currency,c.value),0)),T=F(()=>!o.value||!o.value.id||!d.value.length||!ge.value||Object.keys(ge.value).length===0?0:d.value.filter(f=>(f.type==="expense"||f.type==="bonus")&&f.is_paid===1).reduce((f,k)=>f+Ie(parseFloat(k.amount||0),k.currency,c.value),0)),A=F(()=>o.value&&(h.value>0||x.value>0||T.value>0)),_=F(()=>{const p=h.value+x.value;return p===0?0:Math.round(T.value/p*100)});be(()=>{u()}),ne([()=>o.value,()=>a.projectId,c,ge],()=>{u()},{deep:!0});const S=()=>{n("viewUserTransactions")};return(p,f)=>(i(),r("div",Mc,[e("div",Sc,[v(H(Us),{class:"h-5 w-5 text-gray-500"}),f[0]||(f[0]=e("h4",{class:"text-sm font-semibold text-gray-900"},"Your Financials",-1))]),l.value?(i(),r("div",Vc,f[1]||(f[1]=[e("div",{class:"space-y-2 w-full"},[e("div",{class:"h-3 bg-gray-200 rounded animate-pulse w-full"}),e("div",{class:"h-3 bg-gray-200 rounded animate-pulse w-5/6"})],-1)]))):m.value?(i(),r("div",Ac,[e("p",null,g(m.value),1)])):(i(),r("div",Ic,[A.value?(i(),r("div",Lc,[e("div",Oc,[v(H(Et),{class:"h-5 w-5"}),e("span",Uc,g(d.value.length)+" Transactions(s)",1)]),e("div",Pc,[f[2]||(f[2]=e("span",{class:"font-medium text-green-700"},"Agreed Amount",-1)),e("span",Nc,g(H(Ve)(h.value,H(c))),1)]),e("div",Rc,[f[3]||(f[3]=e("span",{class:"font-medium text-blue-700"},"Bonus Amount",-1)),e("span",Fc,g(H(Ve)(x.value,H(c))),1)]),e("div",Bc,[f[4]||(f[4]=e("span",{class:"font-medium text-indigo-700"},"Received Amount",-1)),e("span",Hc,g(H(Ve)(T.value,H(c))),1)]),e("div",Wc,[e("div",Yc,[f[5]||(f[5]=e("span",null,"Paid Progress",-1)),e("span",null,g(_.value)+"%",1)]),e("div",zc,[e("div",{class:"bg-indigo-600 h-1.5 rounded-full",style:_e({width:_.value+"%"})},null,4)])])])):(i(),r("div",qc,[H(o)?(i(),r("p",Gc," No financial data available for you on this project. ")):(i(),r("p",Zc," Sign in to view your financials. "))])),H(o)?(i(),r("div",Kc,[v(ce,{onClick:S,class:"text-xs"},{default:B(()=>f[6]||(f[6]=[q(" View Transactions ",-1)])),_:1,__:[6]})])):D("",!0)]))]))}},Xc={class:"p-4"},Qc={key:0,class:"text-center text-gray-600"},em={key:1,class:"text-red-600 text-sm py-2"},tm={key:2,class:"text-gray-500 text-center py-4"},sm={key:3,class:"overflow-x-auto"},am={class:"min-w-full divide-y divide-gray-200"},lm={class:"bg-white divide-y divide-gray-200"},im={class:"px-4 py-3 text-sm text-gray-900"},om={class:"px-4 py-3 text-sm text-gray-700"},nm={class:"px-4 py-3 text-sm text-right text-gray-900"},rm={class:"px-4 py-3 text-sm"},dm={class:"px-4 py-3 text-sm text-gray-700"},um={__name:"UserTransactionsModal",props:{show:{type:Boolean,default:!1},projectId:{type:Number,required:!0},projectName:{type:String,required:!1}},emits:["close"],setup(s,{emit:t}){const a=s,n=Ue(),o=b(!0),l=b(null),m=b([]);b("PKR");const d=(u,h="USD")=>isNaN(u)||u==null?"0.00":new Intl.NumberFormat("en-US",{style:"currency",currency:h,minimumFractionDigits:2,maximumFractionDigits:2}).format(u),c=async()=>{var u,h;if(o.value=!0,l.value=null,m.value=[],!n.value||!n.value.id||!a.projectId){l.value="User not authenticated or project ID missing.",o.value=!1;return}try{const x=await window.axios.get(`/api/projects/${a.projectId}/sections/transactions?user_id=${n.value.id}`);m.value=x.data}catch(x){console.error("Failed to fetch user-specific transactions for modal:",x),l.value=((h=(u=x.response)==null?void 0:u.data)==null?void 0:h.message)||"Failed to load transactions."}finally{o.value=!1}};return ne(()=>a.show,u=>{u&&c()},{immediate:!1}),ne([()=>{var u;return(u=n.value)==null?void 0:u.id},()=>a.projectId],(u,h)=>{a.show&&c()},{deep:!0}),F(()=>`Your Transactions for Project ${a.projectId}`),(u,h)=>(i(),Q(Te,{show:s.show,title:"Transactions for: "+s.projectName,"show-footer":!1,onClose:h[0]||(h[0]=x=>u.$emit("close")),"hide-submit-button":!0,"hide-cancel-button":!0,"api-endpoint":null,"form-data":"{}"},{default:B(({errors:x})=>[e("div",Xc,[o.value?(i(),r("div",Qc,h[1]||(h[1]=[e("div",{class:"space-y-3"},[e("div",{class:"h-4 bg-gray-200 rounded animate-pulse w-full"}),e("div",{class:"h-4 bg-gray-200 rounded animate-pulse w-5/6"}),e("div",{class:"h-4 bg-gray-200 rounded animate-pulse w-full"}),e("div",{class:"h-4 bg-gray-200 rounded animate-pulse w-2/3"})],-1)]))):l.value?(i(),r("div",em,[e("p",null,g(l.value),1)])):m.value.length===0?(i(),r("div",tm," No transactions found for you on this project. ")):(i(),r("div",sm,[e("table",am,[h[2]||(h[2]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Description"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Type"),e("th",{class:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"Amount"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Status"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Date")])],-1)),e("tbody",lm,[(i(!0),r(X,null,ae(m.value,T=>(i(),r("tr",{key:T.id,class:"hover:bg-gray-50 transition-colors"},[e("td",im,g(T.description),1),e("td",om,g(T.type),1),e("td",nm,g(d(T.amount,T.currency)),1),e("td",rm,[e("span",{class:te({"px-2 py-1 rounded-full text-xs font-medium":!0,"bg-green-100 text-green-800":T.is_paid===1,"bg-yellow-100 text-yellow-800":T.is_paid===0})},g(T.is_paid===1?"Paid":"Unpaid"),3)]),e("td",dm,g(new Date(T.created_at).toLocaleDateString()),1)]))),128))])])]))])]),_:1},8,["show","title"]))}},cm={class:"p-6 bg-white rounded-lg shadow-md min-h-[calc(100vh-6rem)]"},mm={class:"flex justify-between items-center mb-4"},vm={class:"mb-6 bg-gray-50 p-4 rounded-lg"},pm={class:"flex items-center gap-4"},hm={class:"flex-1 min-w-[200px]"},gm={key:0,class:"text-red-600 text-sm mt-2"},fm={key:1,class:"text-gray-600 text-sm mt-2 animate-pulse"},ym={key:2,class:"text-gray-500 text-sm mt-2"},bm={class:"mt-6"},_m={class:"flex justify-between items-center mb-3"},wm={class:"text-md font-medium text-gray-800"},xm={key:0},km={key:1},Dm={key:0,class:"text-center text-gray-600 text-sm animate-pulse py-8"},Cm={key:1,class:"text-center py-8"},$m={class:"text-red-600 text-sm font-medium"},jm={key:2,class:"text-center py-8"},Tm={class:"text-red-600 text-sm font-medium"},Em={key:3,class:"space-y-8"},Mm={class:"bg-gray-50 p-6 rounded-lg shadow-sm grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"},Sm={class:"flex flex-col items-center p-3 bg-white rounded-md shadow-xs"},Vm={class:"text-lg font-semibold text-gray-900"},Am={class:"flex flex-col items-center p-3 bg-white rounded-md shadow-xs"},Im={class:"text-lg font-semibold text-gray-900"},Lm={class:"flex flex-col items-center p-3 bg-white rounded-md shadow-xs"},Om={class:"text-lg font-semibold text-gray-900"},Um={class:"flex flex-col items-center p-3 bg-white rounded-md shadow-xs"},Pm={class:"text-lg font-semibold text-gray-900"},Nm={class:"flex flex-col items-center p-3 bg-white rounded-md shadow-xs"},Rm={class:"text-lg font-semibold text-gray-900"},Fm={class:"flex flex-col items-center p-3 bg-white rounded-md shadow-xs"},Bm={class:"text-lg font-semibold text-gray-900"},Hm={class:"flex flex-col items-center p-3 bg-white rounded-md shadow-xs"},Wm={class:"text-lg font-semibold text-gray-900"},Ym={class:"bg-white p-6 rounded-lg shadow-sm"},zm={class:"overflow-x-auto max-h-60"},qm={class:"min-w-full divide-y divide-gray-200"},Zm={class:"bg-white divide-y divide-gray-200"},Gm={class:"px-4 py-3 text-sm text-gray-900"},Km={class:"px-4 py-3 text-sm text-gray-700"},Jm={class:"px-4 py-3 text-sm text-gray-700"},Xm={key:0,class:"text-gray-500 text-sm py-2"},Qm={class:"bg-white p-6 rounded-lg shadow-sm"},ev={class:"overflow-x-auto max-h-60"},tv={class:"min-w-full divide-y divide-gray-200"},sv={class:"bg-white divide-y divide-gray-200"},av={class:"px-4 py-3 text-sm text-gray-900"},lv={class:"px-4 py-3 text-sm text-gray-700"},iv={class:"px-4 py-3 text-sm text-gray-700"},ov={class:"px-4 py-3 text-sm text-gray-700"},nv={class:"px-4 py-3 text-sm text-gray-700"},rv={key:0,class:"text-gray-500 text-sm py-2"},dv={class:"bg-white p-6 rounded-lg shadow-sm"},uv={class:"overflow-x-auto max-h-60"},cv={class:"min-w-full divide-y divide-gray-200"},mv={class:"bg-white divide-y divide-gray-200"},vv={class:"px-4 py-3 text-sm text-gray-900"},pv={class:"px-4 py-3 text-sm text-gray-700"},hv={key:0,class:"text-gray-500 text-sm py-2"},gv={class:"bg-white p-6 rounded-lg shadow-sm"},fv={class:"overflow-x-auto"},yv={class:"min-w-full divide-y divide-gray-200"},bv={class:"bg-white divide-y divide-gray-200"},_v={class:"px-4 py-3 text-sm text-gray-900"},wv={class:"px-4 py-3 text-sm text-gray-700"},xv={key:0,class:"text-gray-500 text-sm py-2"},kv={class:"bg-white p-6 rounded-lg shadow-sm"},Dv={class:"overflow-x-auto"},Cv={class:"min-w-full divide-y divide-gray-200"},$v={class:"bg-white divide-y divide-gray-200"},jv={class:"px-4 py-3 text-sm text-gray-900"},Tv={class:"px-4 py-3 text-sm text-gray-700"},Ev={key:0,class:"text-gray-500 text-sm py-2"},Mv={class:"bg-white p-6 rounded-lg shadow-sm"},Sv={class:"overflow-x-auto max-h-60"},Vv={class:"min-w-full divide-y divide-gray-200"},Av={class:"bg-white divide-y divide-gray-200"},Iv={class:"px-4 py-3 text-sm text-gray-900"},Lv={class:"px-4 py-3 text-sm text-gray-700"},Ov={key:0,class:"text-gray-500 text-sm py-2"},Uv={class:"bg-white p-6 rounded-lg shadow-sm grid grid-cols-1 md:grid-cols-2 gap-6"},Pv={key:0,class:"space-y-2"},Nv={class:"font-medium"},Rv={key:1,class:"text-gray-500 text-sm py-2"},Fv={key:0,class:"space-y-2"},Bv={class:"font-medium"},Hv={key:1,class:"text-gray-500 text-sm py-2"},Wv={key:4,class:"text-center py-8 text-gray-500"},Yv={__name:"SeoReportTab",props:{projectId:{type:[String,Number],required:!0},canCreateSeoReports:{type:Boolean,default:!1}},emits:["openCreateSeoReportModal"],setup(s,{emit:t}){const a=s,n=t,o=b([]),l=b(""),m=b(null),d=b(!0),c=b(!1),u=b(null),h=b(null),x=b(null),T=async()=>{d.value=!0,u.value=null;try{const V=await window.axios.get(`/api/projects/${a.projectId}/seo-reports/available-months`);o.value=V.data.map(R=>({value:R,label:new Date(R+"-01").toLocaleString("en-US",{year:"numeric",month:"long"})})),o.value.length>0&&(l.value=o.value[0].value)}catch(V){console.error("Error fetching available months:",V),u.value="Failed to load available report months."}finally{d.value=!1}},A=V=>{const Z=["clientName","reportingPeriod","authorityScoreValue","totalClicksValue","totalImpressionsValue","averagePositionValue","totalBacklinksValue","clicksImpressions","trafficSources","deviceUsage","countryPerformance","coreVitals","topQueries","keywordRankings","backlinks","zeroClickKeywords"].filter(P=>!(P in V));return Z.length>0?`Report data is missing expected top-level keys: ${Z.join(", ")}. Please ensure the JSON structure is correct.`:!V.clicksImpressions||!Array.isArray(V.clicksImpressions.labels)||!Array.isArray(V.clicksImpressions.clicks)?"clicksImpressions data is malformed.":!V.trafficSources||!Array.isArray(V.trafficSources.labels)||!Array.isArray(V.trafficSources.sessions)?"trafficSources data is malformed.":null},_=async()=>{if(!l.value){m.value=null,x.value=null;return}c.value=!0,h.value=null,x.value=null;try{const R=(await window.axios.get(`/api/projects/${a.projectId}/seo-reports/${l.value}`)).data,Z=A(R);Z?(x.value=Z,m.value=null):m.value=R}catch(V){console.error("Error fetching SEO report:",V),h.value="Failed to load SEO report for the selected month.",m.value=null,x.value=null}finally{c.value=!1}},S=(V=null)=>{n("openCreateSeoReportModal",V)},p=F(()=>{var V;return((V=m.value)==null?void 0:V.clientName)||"N/A"}),f=F(()=>{var V;return((V=m.value)==null?void 0:V.reportingPeriod)||"N/A"}),k=F(()=>{var V;return((V=m.value)==null?void 0:V.authorityScoreValue)||"N/A"}),M=F(()=>{var V;return((V=m.value)==null?void 0:V.totalClicksValue)||"N/A"}),I=F(()=>{var V;return((V=m.value)==null?void 0:V.totalImpressionsValue)||"N/A"}),E=F(()=>{var V;return((V=m.value)==null?void 0:V.averagePositionValue)||"N/A"}),L=F(()=>{var V;return((V=m.value)==null?void 0:V.totalBacklinksValue)||"N/A"}),O=F(()=>{var V;return((V=m.value)==null?void 0:V.clicksImpressions)||{labels:[],clicks:[],impressions:[]}}),$=F(()=>{var V;return((V=m.value)==null?void 0:V.trafficSources)||{labels:[],sessions:[],colors:[]}}),y=F(()=>{var V;return((V=m.value)==null?void 0:V.deviceUsage)||{labels:[],clicks:[],colors:[]}}),w=F(()=>{var V;return((V=m.value)==null?void 0:V.countryPerformance)||{labels:[],clicks:[]}}),C=F(()=>{var V;return((V=m.value)==null?void 0:V.coreVitals)||{mobile:{},desktop:{}}}),W=F(()=>{var V;return((V=m.value)==null?void 0:V.topQueries)||[]}),J=F(()=>{var V;return((V=m.value)==null?void 0:V.keywordRankings)||[]});return be(()=>{T()}),ne(()=>a.projectId,()=>{T()}),ne(l,V=>{V?_():(m.value=null,x.value=null)}),(V,R)=>(i(),r("div",cm,[e("div",mm,[R[4]||(R[4]=e("h4",{class:"text-lg font-semibold text-gray-900"},"SEO Reports",-1)),s.canCreateSeoReports?(i(),Q(ce,{key:0,onClick:R[0]||(R[0]=Z=>S()),class:"bg-indigo-600 hover:bg-indigo-700 transition-colors"},{default:B(()=>R[3]||(R[3]=[q(" Add New Report ",-1)])),_:1,__:[3]})):D("",!0)]),e("div",vm,[e("div",pm,[e("div",hm,[v(G,{for:"seo-report-month-filter",value:"Select Report Month"}),v(me,{id:"seo-report-month-filter",modelValue:l.value,"onUpdate:modelValue":R[1]||(R[1]=Z=>l.value=Z),options:o.value,"value-key":"value","label-key":"label",placeholder:"Select a month",disabled:d.value||o.value.length===0,class:"mt-1"},null,8,["modelValue","options","disabled"])])]),u.value?(i(),r("div",gm,g(u.value),1)):D("",!0),d.value?(i(),r("div",fm,"Loading available months...")):D("",!0),!d.value&&o.value.length===0?(i(),r("div",ym,"No SEO reports available for this project.")):D("",!0)]),e("div",bm,[e("div",_m,[e("h5",wm,[l.value?(i(),r("span",xm,"Report for "+g(new Date(l.value+"-01").toLocaleString("en-US",{year:"numeric",month:"long"})),1)):(i(),r("span",km,"Select a month to view report"))]),s.canCreateSeoReports&&m.value&&l.value?(i(),Q(ce,{key:0,onClick:R[2]||(R[2]=Z=>S({report_date:l.value,data:JSON.stringify(m.value,null,2)})),class:"bg-blue-500 hover:bg-blue-600 transition-colors text-sm py-1 px-3"},{default:B(()=>R[5]||(R[5]=[q(" Edit Report ",-1)])),_:1,__:[5]})):D("",!0)]),c.value?(i(),r("div",Dm," Loading SEO report data... ")):h.value?(i(),r("div",Cm,[e("p",$m,g(h.value),1)])):x.value?(i(),r("div",jm,[e("p",Tm,"Data Structure Error: "+g(x.value),1),R[6]||(R[6]=e("p",{class:"text-gray-500 text-sm mt-2"},"Please ensure the JSON data conforms to the expected format.",-1))])):m.value?(i(),r("div",Em,[e("div",Mm,[e("div",Sm,[R[7]||(R[7]=e("p",{class:"text-sm text-gray-500"},"Client Name",-1)),e("p",Vm,g(p.value),1)]),e("div",Am,[R[8]||(R[8]=e("p",{class:"text-sm text-gray-500"},"Reporting Period",-1)),e("p",Im,g(f.value),1)]),e("div",Lm,[R[9]||(R[9]=e("p",{class:"text-sm text-gray-500"},"Authority Score",-1)),e("p",Om,g(k.value),1)]),e("div",Um,[R[10]||(R[10]=e("p",{class:"text-sm text-gray-500"},"Total Clicks",-1)),e("p",Pm,g(M.value),1)]),e("div",Nm,[R[11]||(R[11]=e("p",{class:"text-sm text-gray-500"},"Total Impressions",-1)),e("p",Rm,g(I.value),1)]),e("div",Fm,[R[12]||(R[12]=e("p",{class:"text-sm text-gray-500"},"Average Position",-1)),e("p",Bm,g(E.value),1)]),e("div",Hm,[R[13]||(R[13]=e("p",{class:"text-sm text-gray-500"},"Total Backlinks",-1)),e("p",Wm,g(L.value),1)])]),e("div",Ym,[R[15]||(R[15]=e("h5",{class:"text-lg font-semibold text-gray-800 border-b pb-2 mb-4"},"Clicks & Impressions Trend",-1)),e("div",zm,[e("table",qm,[R[14]||(R[14]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Date"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Clicks"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Impressions")])],-1)),e("tbody",Zm,[(i(!0),r(X,null,ae(O.value.labels,(Z,P)=>(i(),r("tr",{key:P},[e("td",Gm,g(Z),1),e("td",Km,g(O.value.clicks[P]),1),e("td",Jm,g(O.value.impressions[P]),1)]))),128))])])]),O.value.labels.length?D("",!0):(i(),r("p",Xm,"No clicks and impressions data available."))]),e("div",Qm,[R[17]||(R[17]=e("h5",{class:"text-lg font-semibold text-gray-800 border-b pb-2 mb-4"},"Top Queries",-1)),e("div",ev,[e("table",tv,[R[16]||(R[16]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Query"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Clicks"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Impressions"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"CTR"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Position")])],-1)),e("tbody",sv,[(i(!0),r(X,null,ae(W.value,Z=>(i(),r("tr",{key:Z.query},[e("td",av,g(Z.query),1),e("td",lv,g(Z.clicks),1),e("td",iv,g(Z.impressions),1),e("td",ov,g(Z.ctr)+"%",1),e("td",nv,g(Z.position),1)]))),128))])])]),W.value.length?D("",!0):(i(),r("p",rv,"No top queries data available."))]),e("div",dv,[R[19]||(R[19]=e("h5",{class:"text-lg font-semibold text-gray-800 border-b pb-2 mb-4"},"Keyword Rankings",-1)),e("div",uv,[e("table",cv,[R[18]||(R[18]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Keyword"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Ranking")])],-1)),e("tbody",mv,[(i(!0),r(X,null,ae(J.value,Z=>(i(),r("tr",{key:Z.keyword},[e("td",vv,g(Z.keyword),1),e("td",pv,g(Z.ranking),1)]))),128))])])]),J.value.length?D("",!0):(i(),r("p",hv,"No keyword rankings data available."))]),e("div",gv,[R[21]||(R[21]=e("h5",{class:"text-lg font-semibold text-gray-800 border-b pb-2 mb-4"},"Traffic Sources",-1)),e("div",fv,[e("table",yv,[R[20]||(R[20]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Source"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Sessions")])],-1)),e("tbody",bv,[(i(!0),r(X,null,ae($.value.labels,(Z,P)=>(i(),r("tr",{key:Z},[e("td",_v,g(Z),1),e("td",wv,g($.value.sessions[P]),1)]))),128))])])]),$.value.labels.length?D("",!0):(i(),r("p",xv,"No traffic sources data available."))]),e("div",kv,[R[23]||(R[23]=e("h5",{class:"text-lg font-semibold text-gray-800 border-b pb-2 mb-4"},"Device Usage",-1)),e("div",Dv,[e("table",Cv,[R[22]||(R[22]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Device"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Clicks")])],-1)),e("tbody",$v,[(i(!0),r(X,null,ae(y.value.labels,(Z,P)=>(i(),r("tr",{key:Z},[e("td",jv,g(Z),1),e("td",Tv,g(y.value.clicks[P]),1)]))),128))])])]),y.value.labels.length?D("",!0):(i(),r("p",Ev,"No device usage data available."))]),e("div",Mv,[R[25]||(R[25]=e("h5",{class:"text-lg font-semibold text-gray-800 border-b pb-2 mb-4"},"Country Performance (Top 10)",-1)),e("div",Sv,[e("table",Vv,[R[24]||(R[24]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Country"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Clicks")])],-1)),e("tbody",Av,[(i(!0),r(X,null,ae(w.value.labels,Z=>(i(),r("tr",{key:Z},[e("td",Iv,g(Z),1),e("td",Lv,g(w.value.clicks[w.value.labels.indexOf(Z)]),1)]))),128))])])]),w.value.labels.length?D("",!0):(i(),r("p",Ov,"No country performance data available."))]),e("div",Uv,[e("div",null,[R[26]||(R[26]=e("h5",{class:"text-lg font-semibold text-gray-800 border-b pb-2 mb-4"},"Core Vitals (Mobile)",-1)),C.value.mobile&&C.value.mobile.labels&&C.value.mobile.labels.length?(i(),r("div",Pv,[(i(!0),r(X,null,ae(C.value.mobile.labels,(Z,P)=>(i(),r("div",{key:Z,class:"flex justify-between items-center text-sm text-gray-700"},[e("span",null,g(Z)+":",1),e("span",Nv,g(C.value.mobile.scores[P]),1)]))),128))])):(i(),r("p",Rv,"No mobile core vitals data available."))]),e("div",null,[R[27]||(R[27]=e("h5",{class:"text-lg font-semibold text-gray-800 border-b pb-2 mb-4"},"Core Vitals (Desktop)",-1)),C.value.desktop&&C.value.desktop.labels&&C.value.desktop.labels.length?(i(),r("div",Fv,[(i(!0),r(X,null,ae(C.value.desktop.labels,(Z,P)=>(i(),r("div",{key:Z,class:"flex justify-between items-center text-sm text-gray-700"},[e("span",null,g(Z)+":",1),e("span",Bv,g(C.value.desktop.scores[P]),1)]))),128))])):(i(),r("p",Hv,"No desktop core vitals data available."))])])])):(i(),r("div",Wv," No report data to display. Please select a month from the dropdown. "))])]))}},zv=Me(Yv,[["__scopeId","data-v-37cb2f02"]]),qv={class:"space-y-4"},Zv={key:0,class:"text-xs text-gray-500 mt-1 text-red-500"},Gv=["onBlur"],Kv={__name:"CreateSeoReportModal",props:{show:{type:Boolean,default:!1},projectId:{type:[String,Number],required:!0},initialData:{type:Object,default:null}},emits:["close","saved"],setup(s,{emit:t}){const a=s,n=t,o=De({report_date:"",data:""}),l=b(null);ne(()=>[a.show,a.initialData],([p,f])=>{p&&(f?Object.assign(o,{report_date:f.report_date||"",data:f.data||""}):Object.assign(o,{report_date:"",data:""}))},{immediate:!0});const m=p=>{let f=p.data;try{f=JSON.stringify(JSON.parse(p.data))}catch{console.warn("Provided data is not valid JSON, sending as plain string. Backend should validate.")}return{report_date:p.report_date,data:f}},d=F(()=>a.initialData?"Edit SEO Report":"Create New SEO Report"),c=F(()=>`/api/projects/${a.projectId}/seo-reports`),u=F(()=>"post"),h=F(()=>a.initialData?"Update Report":"Create Report"),x=F(()=>a.initialData?"SEO Report updated successfully!":"SEO Report created successfully!"),T=p=>{n("saved",p),n("close")},A=()=>{n("close")},_=()=>{try{const p=JSON.parse(o.data);o.data=JSON.stringify(p,null,2)}catch(p){console.error("Invalid JSON for pretty print:",p)}},S=p=>{if(o.data)try{JSON.parse(o.data),p.data&&p.data[0]==="The data field must be a valid JSON string."&&(p.data=[])}catch{(!p.data||p.data.length===0)&&(p.data=["The data field must be a valid JSON string."])}};return(p,f)=>(i(),Q(Te,{show:s.show,title:d.value,"api-endpoint":c.value,"http-method":u.value,"form-data":o,"submit-button-text":h.value,"success-message":x.value,"format-data-for-api":m,onClose:A,onSubmitted:T},{default:B(({errors:k})=>[e("div",qv,[e("div",null,[v(G,{for:"report_date",value:"Report Month (YYYY-MM)"}),v(re,{id:"report_date",modelValue:o.report_date,"onUpdate:modelValue":f[0]||(f[0]=M=>o.report_date=M),type:"text",class:"mt-1 block w-full",placeholder:"e.g., 2025-07",required:"",autofocus:"",pattern:"\\d{4}-\\d{2}",title:"Please enter a date in YYYY-MM format (e.g., 2025-07)",disabled:!!s.initialData},null,8,["modelValue","disabled"]),v(ie,{message:k.report_date?k.report_date[0]:"",class:"mt-2"},null,8,["message"]),f[2]||(f[2]=e("p",{class:"text-xs text-gray-500 mt-1"},"Enter the report month in YYYY-MM format (e.g., 2025-07).",-1)),s.initialData?(i(),r("p",Zv,"Note: Report month cannot be changed when editing.")):D("",!0)]),e("div",null,[v(G,{for:"report_data",value:"Report Data (JSON)"}),ve(e("textarea",{id:"report_data",ref_key:"jsonInputRef",ref:l,"onUpdate:modelValue":f[1]||(f[1]=M=>o.data=M),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 font-mono",rows:"10",placeholder:'Enter JSON data for the report, e.g., {"keywords_ranked": 150, "traffic": 1200, "rankings": {"keyword1": 5, "keyword2": 12}}',required:"",onBlur:M=>S(k)},null,40,Gv),[[we,o.data]]),v(ie,{message:k.data?k.data[0]:"",class:"mt-2"},null,8,["message"]),e("div",{class:"flex justify-end mt-2"},[e("button",{type:"button",onClick:_,class:"text-sm text-indigo-600 hover:text-indigo-800 font-medium"}," Format JSON ")])])])]),_:1},8,["show","title","api-endpoint","http-method","form-data","submit-button-text","success-message"]))}},Jv={key:0,class:"bg-amber-50 border-l-4 border-amber-500 p-4 mb-6 rounded-md shadow-md"},Xv={class:"flex items-center justify-between"},Qv={class:"flex items-center"},ep={class:"ml-3"},tp={class:"text-sm text-amber-800 font-medium"},sp={key:0},ap={key:1},lp={key:2},ip={__name:"ProjectTaskNotificationPrompt",props:{overdueTasks:{type:Number,required:!0},dueTodayTasks:{type:Number,required:!0}},emits:["view-tasks"],setup(s,{emit:t}){const a=s,n=t,o=F(()=>a.overdueTasks+a.dueTodayTasks),l=F(()=>o.value>0),m=()=>{n("view-tasks")};return(d,c)=>l.value?(i(),r("div",Jv,[e("div",Xv,[e("div",Qv,[c[0]||(c[0]=e("div",{class:"flex-shrink-0"},[e("svg",{class:"h-6 w-6 text-amber-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})])],-1)),e("div",ep,[e("p",tp,[s.overdueTasks>0&&s.dueTodayTasks>0?(i(),r("span",sp," This project has "+g(s.overdueTasks)+" overdue "+g(s.overdueTasks===1?"task":"tasks")+" and "+g(s.dueTodayTasks)+" "+g(s.dueTodayTasks===1?"task":"tasks")+" due today. ",1)):s.overdueTasks>0?(i(),r("span",ap," This project has "+g(s.overdueTasks)+" overdue "+g(s.overdueTasks===1?"task":"tasks")+" that require attention. ",1)):s.dueTodayTasks>0?(i(),r("span",lp," This project has "+g(s.dueTodayTasks)+" "+g(s.dueTodayTasks===1?"task":"tasks")+" due today. ",1)):D("",!0)])])]),e("div",null,[v(ce,{onClick:m,class:"px-4 py-2 text-sm bg-amber-600 hover:bg-amber-700 focus:ring-amber-500"},{default:B(()=>c[1]||(c[1]=[q(" View ",-1)])),_:1,__:[1]})])])])):D("",!0)}},op={class:"space-y-4"},np={key:0},rp=["disabled"],dp={key:0,class:"mt-4"},up=["src"],cp={class:"flex items-center"},mp="Create New Deliverable",vp="post",pp="Create Deliverable",hp="Deliverable created successfully!",gp={__name:"CreateDeliverableModal",props:{show:{type:Boolean,default:!1},projectId:{type:[String,Number],required:!0}},emits:["close","saved"],setup(s,{emit:t}){const a=s,n=t,o=De({title:"",description:"",type:"blog_post",content_url:"",content_url_type:null,attachment_file:null,is_visible_to_client:!0,initial_status:"pending_review"}),l=[{value:"blog_post",label:"Blog Post"},{value:"design_mockup",label:"Design Mockup"},{value:"social_media_post",label:"Social Media Post"},{value:"report",label:"Report"},{value:"contract_draft",label:"Contract Draft"},{value:"proposal",label:"Proposal"},{value:"other",label:"Other"}],m=[{value:"pending_review",label:"Pending Review (Requires Client Approval)"},{value:"for_information",label:"For Information Only (No Approval Needed)"}],d=[{value:null,label:"Select Type (if providing URL)"},{value:"google_doc",label:"Google Document (Doc, Sheet, Slide)"},{value:"pdf",label:"PDF Document"},{value:"image",label:"Image (JPG, PNG, GIF)"},{value:"video",label:"Video (YouTube, Vimeo, etc.)"},{value:"other",label:"Other Web Link"}],c=b(null),u=b(null);ne(()=>a.show,p=>{p&&(Object.assign(o,{title:"",description:"",type:"blog_post",content_url:"",content_url_type:null,attachment_file:null,is_visible_to_client:!0,initial_status:"pending_review"}),u.value=null,c.value&&(c.value.value=""))});const h=p=>{const f=p.target.files[0];if(f)if(o.attachment_file=f,o.content_url="",o.content_url_type=null,f.type.startsWith("image/")){const k=new FileReader;k.onload=M=>{u.value=M.target.result},k.readAsDataURL(f)}else u.value=null;else o.attachment_file=null,u.value=null},x=()=>{o.content_url?(o.attachment_file=null,u.value=null,c.value&&(c.value.value="")):o.content_url_type=null},T=p=>{const f=new FormData;return f.append("title",p.title),f.append("description",p.description||""),f.append("type",p.type),f.append("is_visible_to_client",p.is_visible_to_client?1:0),f.append("initial_status",p.initial_status),p.attachment_file?f.append("attachment_file",p.attachment_file):p.content_url&&(f.append("content_url",p.content_url),f.append("content_url_type",p.content_url_type||"")),f},A=F(()=>`/api/projects/${a.projectId}/deliverables`),_=p=>{n("saved",p),n("close")},S=()=>{n("close")};return(p,f)=>(i(),Q(Te,{show:s.show,title:mp,"api-endpoint":A.value,"http-method":vp,"form-data":o,"submit-button-text":pp,"success-message":hp,"format-data-for-api":T,onClose:S,onSubmitted:_},{default:B(({errors:k})=>[e("div",op,[e("div",null,[v(G,{for:"title",value:"Title"}),v(re,{id:"title",modelValue:o.title,"onUpdate:modelValue":f[0]||(f[0]=M=>o.title=M),type:"text",class:"mt-1 block w-full",required:"",autofocus:""},null,8,["modelValue"]),v(ie,{message:k.title?k.title[0]:"",class:"mt-2"},null,8,["message"])]),e("div",null,[v(G,{for:"description",value:"Description"}),ve(e("textarea",{id:"description","onUpdate:modelValue":f[1]||(f[1]=M=>o.description=M),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",rows:"3",placeholder:"Enter deliverable description"},null,512),[[we,o.description]]),v(ie,{message:k.description?k.description[0]:"",class:"mt-2"},null,8,["message"])]),e("div",null,[v(G,{for:"type",value:"Deliverable Type"}),v(me,{id:"type",modelValue:o.type,"onUpdate:modelValue":f[2]||(f[2]=M=>o.type=M),options:l,"value-key":"value","label-key":"label",placeholder:"Select a type",class:"mt-1 block w-full",required:""},null,8,["modelValue"]),v(ie,{message:k.type?k.type[0]:"",class:"mt-2"},null,8,["message"])]),e("div",null,[v(G,{for:"initial_status",value:"Initial Status"}),v(me,{id:"initial_status",modelValue:o.initial_status,"onUpdate:modelValue":f[3]||(f[3]=M=>o.initial_status=M),options:m,"value-key":"value","label-key":"label",class:"mt-1 block w-full",required:""},null,8,["modelValue"]),v(ie,{message:k.initial_status?k.initial_status[0]:"",class:"mt-2"},null,8,["message"])]),e("div",null,[v(G,{for:"content_url",value:"Content URL (for Google Docs, external links)"}),v(re,{id:"content_url",modelValue:o.content_url,"onUpdate:modelValue":f[4]||(f[4]=M=>o.content_url=M),type:"url",class:"mt-1 block w-full",disabled:!!o.attachment_file,onInput:x,placeholder:"e.g., https://docs.google.com/document/d/..."},null,8,["modelValue","disabled"]),f[7]||(f[7]=e("p",{class:"text-xs text-gray-500 mt-1"},"Leave empty if uploading a file below.",-1)),v(ie,{message:k.content_url?k.content_url[0]:"",class:"mt-2"},null,8,["message"])]),o.content_url&&!o.attachment_file?(i(),r("div",np,[v(G,{for:"content_url_type",value:"Type of Content URL"}),v(me,{id:"content_url_type",modelValue:o.content_url_type,"onUpdate:modelValue":f[5]||(f[5]=M=>o.content_url_type=M),options:d,"value-key":"value","label-key":"label",placeholder:"Select the type of content this URL links to",class:"mt-1 block w-full",required:""},null,8,["modelValue"]),v(ie,{message:k.content_url_type?k.content_url_type[0]:"",class:"mt-2"},null,8,["message"])])):D("",!0),e("div",null,[v(G,{for:"attachment_file",value:"Upload File (PDF, Image)"}),e("input",{id:"attachment_file",ref_key:"fileInput",ref:c,type:"file",onChange:h,class:"mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100",disabled:!!o.content_url,accept:"application/pdf,image/*"},null,40,rp),f[9]||(f[9]=e("p",{class:"text-xs text-gray-500 mt-1"},"Max 10MB. Leave empty if providing a URL above.",-1)),v(ie,{message:k.attachment_file?k.attachment_file[0]:"",class:"mt-2"},null,8,["message"]),u.value?(i(),r("div",dp,[f[8]||(f[8]=e("p",{class:"text-sm font-medium text-gray-700 mb-2"},"Image Preview:",-1)),e("img",{src:u.value,alt:"File Preview",class:"max-w-full h-auto rounded-lg shadow-md max-h-60 object-contain"},null,8,up)])):D("",!0)]),e("div",cp,[ve(e("input",{id:"is_visible_to_client",type:"checkbox","onUpdate:modelValue":f[6]||(f[6]=M=>o.is_visible_to_client=M),class:"rounded border-gray-300 text-indigo-600 shadow-sm focus:ring-indigo-500"},null,512),[[at,o.is_visible_to_client]]),v(G,{for:"is_visible_to_client",value:"Visible to Client",class:"ml-2"}),v(ie,{message:k.is_visible_to_client?k.is_visible_to_client[0]:"",class:"mt-2"},null,8,["message"])])])]),_:1},8,["show","api-endpoint","form-data"]))}};function fp(){return{formatDate:n=>n?new Date(n).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"",formatDateTime:n=>n?new Date(n).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"",timeAgo:n=>{if(!n)return"";const o=new Date(n),m=Math.floor((new Date-o)/1e3);let d=m/31536e3;return d>1?Math.floor(d)+" years ago":(d=m/2592e3,d>1?Math.floor(d)+" months ago":(d=m/86400,d>1?Math.floor(d)+" days ago":(d=m/3600,d>1?Math.floor(d)+" hours ago":(d=m/60,d>1?Math.floor(d)+" minutes ago":Math.floor(m)+" seconds ago"))))}}}const yp={class:"p-6 bg-white rounded-lg shadow-md min-h-[calc(100vh-6rem)]"},bp={class:"flex justify-between items-center mb-4"},_p={class:"flex gap-2"},wp={key:0},xp={key:1},kp={class:"mb-6 bg-gray-50 p-4 rounded-lg"},Dp={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4"},Cp={key:0,class:"mt-3 text-sm text-gray-600"},$p={key:0,class:"text-red-600 font-medium"},jp={key:0,class:"text-center text-gray-600 text-sm animate-pulse py-4"},Tp={key:1,class:"text-center py-4"},Ep={class:"text-red-600 text-sm font-medium"},Mp={key:2,class:"overflow-x-auto"},Sp={class:"min-w-full divide-y divide-gray-200"},Vp={class:"bg-white divide-y divide-gray-200"},Ap={class:"px-4 py-3 text-sm text-gray-900"},Ip={class:"px-4 py-3 text-sm text-gray-700 capitalize"},Lp={class:"px-4 py-3 text-sm text-gray-700"},Op={class:"px-4 py-3 text-sm text-gray-700"},Up={class:"px-4 py-3 text-sm text-gray-700"},Pp={class:"px-4 py-3 text-sm text-gray-700"},Np={class:"px-4 py-3 text-sm text-gray-700"},Rp={class:"px-4 py-3 text-right"},Fp={class:"flex justify-end space-x-2"},Bp=["onClick"],Hp={key:3,class:"text-center py-4"},Wp={__name:"ProjectDeliverableTab",props:{projectId:{type:[String,Number],required:!0},canCreateDeliverables:{type:Boolean,default:!1},canViewDeliverables:{type:Boolean,default:!1}},emits:["deliverablesUpdated","openDeliverableDetailSidebar"],setup(s,{emit:t}){const a=s,n=t,o=b([]),l=b(!0),m=b(null),d=b(!1),c=b({status:"",type:"",visibility:"",clientStatus:""}),u=[{value:"",label:"All Statuses"},{value:"pending_review",label:"Pending Review"},{value:"for_information",label:"For Information"},{value:"approved",label:"Approved"},{value:"revisions_requested",label:"Revisions Requested"},{value:"completed",label:"Completed"}],h=[{value:"",label:"All Types"},{value:"blog_post",label:"Blog Post"},{value:"design_mockup",label:"Design Mockup"},{value:"social_media_post",label:"Social Media Post"},{value:"report",label:"Report"},{value:"contract_draft",label:"Contract Draft"},{value:"proposal",label:"Proposal"},{value:"other",label:"Other"}],x=[{value:"",label:"All Visibility"},{value:"visible_to_client",label:"Visible to Client"},{value:"not_visible_to_client",label:"Not Visible to Client"}],T=[{value:"",label:"All Client Status"},{value:"read",label:"Read"},{value:"unread",label:"Unread"},{value:"approved",label:"Approved"},{value:"revisions_requested",label:"Revisions Requested"}],A=M=>{var E;if(!M.is_visible_to_client)return{status:"N/A",class:"bg-gray-100 text-gray-800"};const I=(E=M.client_interactions)==null?void 0:E[0];return I?I.approved_at?{status:"Approved",class:"bg-green-100 text-green-800"}:I.revisions_requested_at?{status:"Revisions Requested",class:"bg-yellow-100 text-yellow-800"}:I.rejected_at?{status:"Rejected",class:"bg-red-100 text-red-800"}:I.read_at?{status:`Read on ${new Date(I.read_at).toLocaleDateString()}`,class:"bg-blue-100 text-blue-800"}:{status:"Unread",class:"bg-red-100 text-red-800"}:{status:"Unread",class:"bg-red-100 text-red-800"}},_=F(()=>o.value.length?o.value.filter(M=>{const I=A(M);return!(c.value.status&&M.status!==c.value.status||c.value.type&&M.type!==c.value.type||c.value.visibility&&(c.value.visibility==="visible_to_client"&&!M.is_visible_to_client||c.value.visibility==="not_visible_to_client"&&M.is_visible_to_client)||c.value.clientStatus&&(c.value.clientStatus==="read"&&!I.status.startsWith("Read")||c.value.clientStatus==="unread"&&I.status!=="Unread"||c.value.clientStatus==="approved"&&I.status!=="Approved"||c.value.clientStatus==="revisions_requested"&&I.status!=="Revisions Requested"))}):[]),S=()=>{c.value.status="",c.value.type="",c.value.visibility="",c.value.clientStatus=""},p=async()=>{if(!a.canViewDeliverables){m.value="You do not have permission to view deliverables.",l.value=!1;return}l.value=!0,m.value=null;try{const M=await window.axios.get(route("projects.deliverables.index",a.projectId));o.value=M.data}catch(M){console.error("Error fetching deliverables:",M),m.value="Failed to load deliverables."}finally{l.value=!1}},f=()=>{p(),n("deliverablesUpdated")},k=M=>{n("openDeliverableDetailSidebar",M)};return be(()=>{p()}),ne(()=>a.projectId,()=>{p()}),(M,I)=>(i(),r("div",yp,[e("div",bp,[I[7]||(I[7]=e("h4",{class:"text-lg font-semibold text-gray-900"},"Project Deliverables & Approvals",-1)),e("div",_p,[v(fe,{onClick:p,disabled:l.value,class:"text-indigo-600 hover:text-indigo-800"},{default:B(()=>[l.value?(i(),r("span",xp,"Loading...")):(i(),r("span",wp,"Refresh"))]),_:1},8,["disabled"]),s.canCreateDeliverables?(i(),Q(ce,{key:0,onClick:I[0]||(I[0]=E=>d.value=!0),class:"bg-indigo-600 hover:bg-indigo-700 transition-colors"},{default:B(()=>I[6]||(I[6]=[q(" Add New Deliverable ",-1)])),_:1,__:[6]})):D("",!0)])]),e("div",kp,[e("div",Dp,[e("div",null,[v(G,{for:"deliverable-status-filter",value:"Status"}),v(me,{id:"deliverable-status-filter",modelValue:c.value.status,"onUpdate:modelValue":I[1]||(I[1]=E=>c.value.status=E),options:u,placeholder:"All Statuses",class:"mt-1"},null,8,["modelValue"])]),e("div",null,[v(G,{for:"deliverable-type-filter",value:"Type"}),v(me,{id:"deliverable-type-filter",modelValue:c.value.type,"onUpdate:modelValue":I[2]||(I[2]=E=>c.value.type=E),options:h,placeholder:"All Types",class:"mt-1"},null,8,["modelValue"])]),e("div",null,[v(G,{for:"deliverable-visibility-filter",value:"Visibility"}),v(me,{id:"deliverable-visibility-filter",modelValue:c.value.visibility,"onUpdate:modelValue":I[3]||(I[3]=E=>c.value.visibility=E),options:x,placeholder:"All Visibility",class:"mt-1"},null,8,["modelValue"])]),e("div",null,[v(G,{for:"deliverable-client-status-filter",value:"Client Status"}),v(me,{id:"deliverable-client-status-filter",modelValue:c.value.clientStatus,"onUpdate:modelValue":I[4]||(I[4]=E=>c.value.clientStatus=E),options:T,placeholder:"All Client Status",class:"mt-1"},null,8,["modelValue"])])]),e("div",{class:"flex justify-end mt-4"},[e("button",{type:"button",onClick:S,class:"px-3 py-2 text-sm text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-md transition-colors"}," Clear Filters ")]),Object.values(c.value).some(E=>E!==null&&E!=="")?(i(),r("div",Cp,[e("p",null,[q(" Showing "+g(_.value.length)+" of "+g(o.value.length)+" deliverables ",1),_.value.length===0?(i(),r("span",$p," (No deliverables match the current filters) ")):D("",!0)])])):D("",!0)]),l.value?(i(),r("div",jp," Loading deliverables... ")):m.value?(i(),r("div",Tp,[e("p",Ep,g(m.value),1)])):_.value.length?(i(),r("div",Mp,[e("table",Sp,[I[8]||(I[8]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Title"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Type"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Status"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Submitted By"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Submitted On"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Visibility"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Client Status"),q(),e("th",{class:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"Actions")])],-1)),e("tbody",Vp,[(i(!0),r(X,null,ae(_.value,E=>{var L;return i(),r("tr",{key:E.id,class:"hover:bg-gray-50 transition-colors"},[e("td",Ap,g(E.title),1),e("td",Ip,g(E.type.replace(/_/g," ")),1),e("td",Lp,[e("span",{class:te({"px-2 py-1 rounded-full text-xs font-medium":!0,"bg-yellow-100 text-yellow-800":E.status==="pending_review"||E.status==="revisions_requested","bg-green-100 text-green-800":E.status==="approved","bg-blue-100 text-blue-800":E.status==="completed","bg-gray-100 text-gray-800":E.status==="for_information"})},g(E.status.replace(/_/g," ").replace(/\b\w/g,O=>O.toUpperCase())),3)]),e("td",Op,g(((L=E.team_member)==null?void 0:L.name)||"Unknown"),1),e("td",Up,g(new Date(E.submitted_at).toLocaleDateString()),1),e("td",Pp,[e("span",{class:te({"px-2 py-1 rounded-full text-xs font-medium":!0,"bg-green-100 text-green-800":E.is_visible_to_client,"bg-red-100 text-red-800":!E.is_visible_to_client})},g(E.is_visible_to_client?"Visible":"Hidden"),3)]),e("td",Np,[e("span",{class:te(["px-2 py-1 rounded-full text-xs font-medium",A(E).class])},g(A(E).status),3)]),e("td",Rp,[e("div",Fp,[e("button",{onClick:O=>k(E.id),class:"text-purple-600 hover:text-purple-800 text-sm font-medium"}," View Details ",8,Bp)])])])}),128))])])])):(i(),r("div",Hp,I[9]||(I[9]=[e("p",{class:"text-gray-400 text-sm"},"No deliverables found for this project.",-1),e("p",{class:"text-gray-500 text-sm mt-2"},' Click the "Add New Deliverable" button to create one. ',-1)]))),v(gp,{show:d.value,"project-id":s.projectId,onClose:I[5]||(I[5]=E=>d.value=!1),onSaved:f},null,8,["show","project-id"])]))}},Yp=Me(Wp,[["__scopeId","data-v-40d67f52"]]),zp={key:0,class:"text-center py-8 text-gray-500"},qp={key:1,class:"text-center py-8 text-red-600"},Zp={key:2,class:"space-y-6"},Gp={class:"bg-gray-50 p-4 rounded-lg shadow-sm"},Kp={class:"text-xl font-bold text-gray-900 mb-2"},Jp={class:"flex items-center space-x-2 text-sm text-gray-600 mb-4"},Xp={class:"text-indigo-600 font-medium"},Qp={class:"text-gray-700"},e0={class:"text-gray-700 leading-relaxed"},t0={class:"mt-4 space-y-2 text-sm"},s0={key:0,class:"text-blue-600 hover:underline"},a0=["href"],l0={key:1,class:"text-blue-600 hover:underline"},i0=["href"],o0={key:2,class:"text-green-600 font-medium"},n0={class:"bg-white p-4 rounded-lg shadow-sm"},r0={key:0,class:"space-y-3"},d0={class:"font-semibold text-gray-800"},u0={class:"text-sm text-gray-700"},c0={class:"font-medium"},m0={key:0,class:"text-xs text-gray-500 ml-2"},v0={key:0,class:"text-sm text-gray-600 mt-1"},p0={key:1,class:"text-gray-500 text-sm py-2"},h0={class:"bg-white p-4 rounded-lg shadow-sm"},g0={class:"flex justify-between items-center mb-4 border-b pb-2"},f0={class:"space-y-3 mb-4"},y0={key:0,class:"space-y-3"},b0={class:"text-sm text-gray-700"},_0={class:"text-xs text-gray-500 mt-1"},w0={key:0},x0={key:1,class:"ml-2 text-gray-400"},k0={key:1,class:"text-gray-500 text-sm py-2"},D0={key:3,class:"text-center py-8 text-gray-500"},C0={__name:"DeliverableDetailSidebar",props:{projectId:{type:Number,required:!0},deliverableId:{type:Number,required:!0}},emits:["close","deliverable-updated"],setup(s,{emit:t}){const a=s,n=t,o=b(null),l=b(!0),m=b(""),{formatDateTime:d,timeAgo:c}=fp(),u=gs({comment_text:"",context:""}),h=async()=>{l.value=!0,m.value="";try{const p=await window.axios.get(route("projects.deliverables.show",{project:a.projectId,deliverable:a.deliverableId}));o.value=p.data}catch(p){m.value="Failed to load deliverable details.",console.error("Error fetching deliverable details:",p)}finally{l.value=!1}};ne(()=>a.deliverableId,p=>{p?h():o.value=null},{immediate:!0});const x=b(!1),T=async()=>{var p,f;if(o.value){x.value=!0,u.errors={};try{const k=await window.axios.post(`/api/projects/${a.projectId}/deliverables/${a.deliverableId}/comments`,{comment_text:u.comment_text,context:u.context});u.comment_text="",u.context="",h(),n("deliverable-updated")}catch(k){console.error("Error adding comment:",k),k.response&&k.response.status===422?u.errors=k.response.data.errors:console.error("Failed to add comment:",((f=(p=k.response)==null?void 0:p.data)==null?void 0:f.message)||k.message)}finally{x.value=!1}}},A=F(()=>o.value?{"bg-yellow-100 text-yellow-800":o.value.status==="pending_review"||o.value.status==="revisions_requested","bg-green-100 text-green-800":o.value.status==="approved","bg-blue-100 text-blue-800":o.value.status==="completed","bg-gray-100 text-gray-800":o.value.status==="for_information"}:""),_=p=>{let f="No Action Yet",k="";return p.approved_at?(f="Approved",k=d(p.approved_at)):p.revisions_requested_at?(f="Revisions Requested",k=d(p.revisions_requested_at)):p.rejected_at?(f="Rejected",k=d(p.rejected_at)):p.read_at&&(f="Read",k=d(p.read_at)),{status:f,timestamp:k}},S=p=>p.creator_type==="App\\Models\\Client"?"Client":p.creator_type==="App\\Models\\User"?"Team Member":"Unknown";return(p,f)=>{var k;return l.value?(i(),r("div",zp," Loading deliverable details... ")):m.value?(i(),r("div",qp,g(m.value),1)):o.value?(i(),r("div",Zp,[e("div",Gp,[e("h4",Kp,g(o.value.title),1),e("div",Jp,[e("span",{class:te(["px-2 py-1 rounded-full text-xs font-medium",A.value])},g(o.value.status.replace(/_/g," ").replace(/\b\w/g,M=>M.toUpperCase())),3),e("span",Xp," | "+g(o.value.type.replace(/_/g," "))+" | ",1),e("span",Qp," Submitted by: "+g(((k=o.value.team_member)==null?void 0:k.name)||"Unknown"),1)]),e("p",e0,g(o.value.description||"No description provided."),1),e("div",t0,[o.value.content_url?(i(),r("div",s0,[e("a",{href:o.value.content_url,target:"_blank",rel:"noopener noreferrer"},"View Content Link ("+g(o.value.mime_type||"Unknown Type")+")",9,a0)])):D("",!0),o.value.attachment_path?(i(),r("div",l0,[e("a",{href:o.value.attachment_path,target:"_blank",rel:"noopener noreferrer"},"View Attachment",8,i0)])):D("",!0),e("div",{class:te(o.value.is_visible_to_client?"text-green-600":"text-red-600")}," Visibility: "+g(o.value.is_visible_to_client?"Visible to Client":"Not Visible to Client"),3),o.value.overall_approved_at?(i(),r("div",o0," Overall Approved by Client on "+g(H(d)(o.value.overall_approved_at)),1)):D("",!0)])]),e("div",n0,[f[3]||(f[3]=e("h5",{class:"text-lg font-semibold text-gray-800 border-b pb-2 mb-4"},"Client Interactions",-1)),o.value.client_interactions&&o.value.client_interactions.length>0?(i(),r("div",r0,[(i(!0),r(X,null,ae(o.value.client_interactions,M=>{var I;return i(),r("div",{key:M.id,class:"p-3 bg-gray-50 rounded-md"},[e("p",d0,g(((I=M.client)==null?void 0:I.name)||"Unknown Client"),1),e("p",u0,[f[2]||(f[2]=q(" Status: ",-1)),e("span",c0,g(_(M).status),1),_(M).timestamp?(i(),r("span",m0," ("+g(_(M).timestamp)+") ",1)):D("",!0)]),M.feedback_text?(i(),r("p",v0,'Feedback: "'+g(M.feedback_text)+'"',1)):D("",!0)])}),128))])):(i(),r("div",p0,"No client interactions recorded yet."))]),e("div",h0,[e("div",g0,[f[5]||(f[5]=e("h5",{class:"text-lg font-semibold text-gray-800"},"Comments",-1)),v(ce,{onClick:T,disabled:H(u).processing,class:"bg-indigo-600 hover:bg-indigo-700 transition-colors"},{default:B(()=>f[4]||(f[4]=[q(" Add Comment ",-1)])),_:1,__:[4]},8,["disabled"])]),e("div",f0,[e("div",null,[v(G,{for:"new-comment-text",value:"New Comment",class:"sr-only"}),ve(e("textarea",{id:"new-comment-text","onUpdate:modelValue":f[0]||(f[0]=M=>H(u).comment_text=M),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",rows:"3",placeholder:"Type your comment here..."},null,512),[[we,H(u).comment_text]]),v(ie,{message:H(u).errors.comment_text,class:"mt-2"},null,8,["message"])]),e("div",null,[v(G,{for:"comment-context",value:"Context (Optional, e.g., 'Paragraph 2', 'Image 1')",class:"sr-only"}),v(re,{id:"comment-context",modelValue:H(u).context,"onUpdate:modelValue":f[1]||(f[1]=M=>H(u).context=M),type:"text",class:"mt-1 block w-full",placeholder:"Context (optional)"},null,8,["modelValue"]),v(ie,{message:H(u).errors.context,class:"mt-2"},null,8,["message"])])]),o.value.comments&&o.value.comments.length>0?(i(),r("div",y0,[(i(!0),r(X,null,ae(o.value.comments,M=>(i(),r("div",{key:M.id,class:"p-3 bg-gray-50 rounded-md"},[e("p",b0,g(M.content),1),e("p",_0,[q(" By "+g(M.creator_name||"Unknown")+" ("+g(S(M))+") ",1),M.created_at?(i(),r("span",w0,g(H(c)(M.created_at)),1)):D("",!0),M.context?(i(),r("span",x0,"("+g(M.context)+")",1)):D("",!0)])]))),128))])):(i(),r("div",k0,"No comments for this deliverable yet."))])])):(i(),r("div",D0," Select a deliverable to view details. "))}}},$0={key:0,class:"bg-white rounded-xl shadow-lg border border-gray-200 h-full flex flex-col relative"},j0={key:2,class:"h-full flex flex-col"},T0={class:"flex items-center justify-between p-4 sm:p-6 border-b border-gray-200"},E0={class:"flex px-4 sm:px-6 border-b border-gray-200"},M0={class:"flex-1 overflow-y-auto p-4 sm:p-6"},S0={key:0,class:"flex justify-center py-8"},V0={key:1,class:"bg-gray-50 p-4 sm:p-6 rounded-lg text-center text-sm"},A0={class:"text-gray-600"},I0={key:2,class:"space-y-3 sm:space-y-4"},L0=["onClick"],O0={class:"flex items-center space-x-2 sm:space-x-3"},U0={class:"p-1 rounded-full text-gray-500 hover:bg-gray-200 transition-colors"},P0={class:"text-sm sm:text-base font-medium text-gray-900"},N0={class:"flex items-center space-x-2"},R0={key:0,class:"text-xs font-medium text-gray-600"},F0={key:0,class:"mt-3 pl-6 sm:mt-4 sm:pl-8"},B0={key:0,class:"text-xs sm:text-sm text-gray-600 mb-2"},H0={class:"mt-2 flex items-center space-x-2 text-xs text-gray-500"},W0={key:0,class:"text-gray-700"},Y0={key:1,class:"text-gray-700"},z0={__name:"ProjectDeliverablesOverviewCard",props:{projectId:{type:[Number,String],required:!0},canViewProjectDeliverables:{type:Boolean,default:!0},isCollapsed:{type:Boolean,default:!1}},emits:["update:isCollapsed"],setup(s,{emit:t}){const a=s,n=t,o=b(a.isCollapsed);ne(()=>a.isCollapsed,p=>{o.value=p});const l=b([]),m=b(!0),d=b("in-progress"),c=b({}),u=F(()=>d.value==="in-progress"?l.value.filter(p=>p.status!=="completed"&&p.status!=="cancelled"):l.value.filter(p=>p.status==="completed"||p.status==="cancelled")),h=async()=>{if(a.canViewProjectDeliverables){m.value=!0;try{const p=await Je.get(`/api/projects/${a.projectId}/project-deliverables`);l.value=p.data}catch(p){console.error("Error fetching deliverables:",p),lt("Failed to load project deliverables.")}finally{m.value=!1}}};be(()=>{h()});const x=p=>{c.value[p]=!c.value[p]},T=p=>p?new Date(p).toLocaleDateString():"N/A",A=p=>!p||p.length===0?0:p.filter(f=>f.completed).length,_=(p,f)=>{const k=l.value.find(M=>M.id===p.id);k&&(k.details.checklist[f.index].completed=f.completed);try{const M={...p,details:{...p.details,checklist:k.details.checklist}};Je.put(`/api/project-deliverables/${p.id}`,M),Dt("Checklist item updated!")}catch(M){console.error("Error updating checklist item:",M),lt("Failed to update checklist item"),k&&(k.details.checklist[f.index].completed=!f.completed)}},S=()=>{o.value=!o.value,n("update:isCollapsed",o.value)};return(p,f)=>s.canViewProjectDeliverables?(i(),r("div",$0,[o.value?(i(),r("div",{key:0,onClick:S,class:"flex lg:hidden items-center p-4 cursor-pointer"},[f[2]||(f[2]=e("span",{class:"text-gray-600 font-bold text-lg flex-1"},"Project Deliverables",-1)),v(H(Is),{class:"h-5 w-5 text-gray-500"})])):D("",!0),o.value?(i(),r("div",{key:1,onClick:S,class:"hidden lg:flex items-center justify-center cursor-pointer p-2 h-full"},f[3]||(f[3]=[e("span",{class:"text-gray-600 font-bold text-lg",style:{"writing-mode":"vertical-rl","text-orientation":"mixed"}}," Project Deliverables ",-1)]))):(i(),r("div",j0,[e("div",T0,[f[4]||(f[4]=e("h3",{class:"text-lg sm:text-xl font-bold text-gray-900"},"Project Deliverables",-1)),e("button",{onClick:S,class:"p-1 rounded-full text-gray-500 hover:bg-gray-200 transition-colors"},[v(H(Ls),{class:"h-5 w-5"})])]),e("div",E0,[e("button",{onClick:f[0]||(f[0]=k=>d.value="in-progress"),class:te({"py-2 px-3 text-sm font-medium":!0,"text-indigo-600 border-b-2 border-indigo-600":d.value==="in-progress","text-gray-500 hover:text-gray-700":d.value!=="in-progress"})}," In Progress ",2),e("button",{onClick:f[1]||(f[1]=k=>d.value="completed"),class:te({"py-2 px-3 text-sm font-medium":!0,"text-indigo-600 border-b-2 border-indigo-600":d.value==="completed","text-gray-500 hover:text-gray-700":d.value!=="completed"})}," Completed ",2)]),e("div",M0,[m.value?(i(),r("div",S0,f[5]||(f[5]=[e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"},null,-1)]))):u.value.length===0?(i(),r("div",V0,[e("p",A0,"No "+g(d.value)+" deliverables found.",1)])):(i(),r("div",I0,[(i(!0),r(X,null,ae(u.value,k=>{var M,I,E;return i(),r("div",{key:k.id,class:"bg-gray-50 border border-gray-200 rounded-lg p-3 sm:p-4 shadow-sm hover:shadow-md transition-all duration-300"},[e("div",{class:"flex items-center justify-between cursor-pointer",onClick:L=>x(k.id)},[e("div",O0,[e("button",U0,[c.value[k.id]?(i(),Q(H(Os),{key:1,class:"h-4 w-4 sm:h-5 sm:w-5"})):(i(),Q(H(Vs),{key:0,class:"h-4 w-4 sm:h-5 sm:w-5"}))]),e("div",null,[e("h4",P0,g(k.name),1)])]),e("div",N0,[((I=(M=k.details)==null?void 0:M.checklist)==null?void 0:I.length)>0?(i(),r("span",R0,g(A(k.details.checklist))+" / "+g(k.details.checklist.length),1)):D("",!0),e("span",{class:te({"font-medium py-0.5 px-2 rounded-full text-white text-xs":!0,"bg-yellow-500":k.status==="pending","bg-blue-500":k.status==="in_progress","bg-green-500":k.status==="completed","bg-red-500":k.status==="cancelled"})},g(k.status.replace("_"," ").toUpperCase()),3)])],8,L0),c.value[k.id]?(i(),r("div",F0,[k.description?(i(),r("p",B0,g(k.description),1)):D("",!0),e("div",H0,[k.milestone?(i(),r("span",W0,[f[6]||(f[6]=e("span",{class:"font-semibold"},"Milestone:",-1)),q(" "+g(k.milestone.name),1)])):D("",!0),k.due_date?(i(),r("span",Y0,[f[7]||(f[7]=e("span",{class:"font-semibold"},"Due:",-1)),q(" "+g(T(k.due_date)),1)])):D("",!0)]),(E=k.details)!=null&&E.checklist&&k.details.checklist.length>0?(i(),Q(Ss,{key:1,items:k.details.checklist,"api-endpoint":`/api/project-deliverables/${k.id}`,title:null,"payload-transformer":L=>({details:{...k.details,checklist:L}}),onItemToggled:L=>_(k,L),density:"tight","container-class":"p-0 border-0 bg-transparent text-sm","title-class":"hidden"},null,8,["items","api-endpoint","payload-transformer","onItemToggled"])):D("",!0)])):D("",!0)])}),128))]))])]))])):D("",!0)}},q0={class:"py-8 max-w-full mx-auto px-4 sm:px-6 lg:px-8"},Z0={key:0,class:"flex items-center justify-center min-h-[50vh]"},G0={key:1,class:"text-center text-red-600 text-lg font-medium"},K0={key:2,class:"space-y-8"},J0={class:"flex flex-col lg:flex-row gap-6"},X0={class:"flex-1 space-y-6"},Q0={class:"flex justify-end items-center"},eh={class:"flex h-full w-full"},th={key:1,class:"transition-all duration-300 w-full relative"},sh={class:"grid grid-cols-3 gap-4"},ah={key:0},lh={key:0,class:"bg-white p-6 rounded-xl shadow-md hover:shadow-lg transition-shadow mb-6"},ih={class:"flex justify-between items-center mb-4"},oh={key:1,class:"bg-white p-6 rounded-xl shadow-md hover:shadow-lg transition-shadow mb-6"},nh={class:"flex justify-between items-center mb-4"},rh={key:2,class:"bg-white p-6 rounded-xl shadow-md hover:shadow-lg transition-shadow mb-6"},dh={class:"flex justify-between items-center mb-4"},uh={key:0,class:"text-gray-400 text-sm"},ch={key:1,class:"overflow-x-auto"},mh={class:"min-w-full divide-y divide-gray-200"},vh={class:"bg-white divide-y divide-gray-200"},ph={class:"px-4 py-3 text-sm text-gray-900"},hh={class:"px-4 py-3 text-sm text-gray-700"},gh={class:"px-4 py-3 text-sm text-gray-700"},fh={class:"px-4 py-3 text-sm text-gray-700"},yh={class:"px-4 py-3 text-sm text-gray-700"},bh={class:"px-4 py-3 text-right"},_h={key:3,class:"bg-white p-6 rounded-xl shadow-md hover:shadow-lg transition-shadow mb-6"},wh={class:"flex justify-between items-center mb-4"},xh={class:"flex items-center gap-4"},kh={key:0},Dh={key:0,class:"space-y-4"},Ch={class:"flex justify-between"},$h={class:"flex-grow"},jh={key:0,class:"text-xs text-red-400 block mt-1"},Th={class:"flex items-center mt-1"},Eh={class:"text-xs text-gray-500"},Mh={key:0,class:"ml-2 px-2 py-0.5 bg-indigo-100 text-indigo-800 text-xs rounded-full"},Sh={key:0},Vh={key:1,class:"text-gray-400 text-sm"},Ah={key:1,class:"p-4 text-gray-500"},Ih={__name:"Show",setup(s){const t=Ue(),a=fs().props.id,n=b({clients:[],users:[],notes:[],transactions:[],documents:[],meetings:[],tasks:[],emails:[],deliverables:[]}),o=b(!1),l=b(!1),m=b(25),d=b(!1),c=b(!0),u=b(""),h=b(!1),x=b(!1),T=b(!1),A=b(!1),_=b(!1),S=b(!1),p=b(!1),f=b(!1),k=b(!1),M=b(null),I=b(!1),E=b(null),L=[{value:"active",label:"Active"},{value:"completed",label:"Completed"},{value:"on_hold",label:"On Hold"},{value:"archived",label:"Archived"}],O=b(null),$=b(null),y=ys(n),{canDo:w,canView:C}=Xe(a),W=F(()=>{var se,z;return((z=(se=t.value)==null?void 0:se.role_data)==null?void 0:z.slug)==="super-admin"}),J=F(()=>w("manage_projects").value||W.value),V=F(()=>w("edit_projects").value||W.value),R=F(()=>C("emails").value),Z=F(()=>w("compose_emails").value),P=F(()=>w("approve_emails").value),ee=F(()=>C("project_notes").value),de=F(()=>w("add_project_notes").value),xe=F(()=>C("deliverables").value),Y=F(()=>w("create_deliverables").value),j=F(()=>C("seo_reports").value),U=F(()=>w("create_seo_reports").value),N=F(()=>C("client_contacts").value);F(()=>C("users").value);const ye=F(()=>C("project_financial",y).value),Ne=F(()=>C("project_transactions").value);F(()=>C("client_financial").value);const It=[{value:"PKR",label:"PKR"},{value:"AUD",label:"AUD"},{value:"INR",label:"INR"},{value:"USD",label:"USD"},{value:"EUR",label:"EUR"},{value:"GBP",label:"GBP"}],Re=b([]),Lt=b(null),Ze=b(null),Qe=b("all"),it=async()=>{try{Re.value=await us(a)}catch(se){console.error("Error fetching due and overdue tasks:",se)}},Ot=()=>{$.value="tasks",Qe.value="due-overdue",setTimeout(()=>{Ze.value&&Ze.value.scrollIntoView&&Ze.value.scrollIntoView({behavior:"smooth"})},100)},Ut=async()=>{await it()},ot=F(()=>n.value.notes?[...n.value.notes].filter(se=>se.type!=="standup").sort((se,z)=>new Date(z.created_at)-new Date(se.created_at)).slice(0,3):[]),nt=b([]),rt=async()=>{try{const se=await window.axios.get(`/api/projects/${a}/emails-simplified`,{params:{limit:5}});nt.value=se.data}catch(se){console.error("Error fetching latest emails:",se)}},$e=async()=>{c.value=!0,u.value="";try{const se=await window.axios.get(`/api/projects/${a}`);n.value=se.data,console.log("Full project data received (Show.vue main fetch):",n.value),o.value=n.value.deliverables&&n.value.deliverables.length>0,l.value=!o.value,await it(),R.value&&await rt()}catch(se){u.value="Failed to load project data.",console.error("Error fetching project data:",se),se.response&&(se.response.status===401||se.response.status===403)&&(u.value="You are not authorized to view this project or your session expired. Please log in.")}finally{c.value=!1}},Pt=se=>{n.value=se,h.value=!1,$e()},Nt=se=>{n.value.tasks=se},Rt=se=>{n.value.emails=se,R.value&&rt()},dt=se=>{n.value.notes=se},Ft=()=>{$e()},Bt=()=>{O.value&&O.value.fetchMeetings()},ut=()=>{$e()},Ht=se=>{$.value=se,Ds()},Wt=()=>{S.value=!0},Yt=()=>{p.value=!0,$.value="emails"},zt=async()=>{p.value=!1,await $e()},qt=()=>{p.value=!1},ct=()=>{l.value=!l.value},Zt=se=>{d.value=!0,document.addEventListener("mousemove",mt),document.addEventListener("mouseup",vt),se.preventDefault()},mt=se=>{if(!d.value)return;const z=document.documentElement.clientWidth,Fe=Math.min(Math.max(10,(1-se.clientX/z)*100),50);m.value=Fe},vt=()=>{d.value=!1,document.removeEventListener("mousemove",mt),document.removeEventListener("mouseup",vt),localStorage.setItem(`project_${a}_deliverables_width`,m.value)},pt=(se,z)=>{ks(se,z||a,n.value.users)};ne(bs,(se,z)=>{z.taskId&&!se.taskId&&$e()},{deep:!0});const Gt=se=>{E.value=se,I.value=!0},Kt=()=>{I.value=!1;const se=!!E.value;E.value=null,se&&$e()},Jt=()=>{f.value=!0},Xt=()=>{f.value=!1,$e()},Qt=(se=null)=>{M.value=se,k.value=!0},es=()=>{k.value=!1};return be(async()=>{console.log("Show.vue mounted, fetching initial data...");try{await _s(a),console.log("Project permissions fetched (includes global)")}catch(z){console.error(`Error fetching permissions for project ${a}:`,z)}const se=localStorage.getItem(`project_${a}_deliverables_width`);se!==null&&(m.value=parseFloat(se)),await Ms(),await $e()}),(se,z)=>(i(),r(X,null,[v(H(ws),{title:n.value.name||"Project Details"},null,8,["title"]),v(ds,null,{default:B(()=>{var Fe;return[e("div",q0,[c.value?(i(),r("div",Z0,z[25]||(z[25]=[e("div",{class:"flex flex-col items-center space-y-4"},[e("svg",{class:"animate-spin h-16 w-16 text-indigo-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]),e("p",{class:"text-lg text-gray-600 font-medium"},"Loading project details...")],-1)]))):u.value?(i(),r("div",G0,g(u.value),1)):(i(),r("div",K0,[e("div",J0,[e("div",X0,[v(Xo,{project:n.value,"project-id":H(a),"can-manage-projects":J.value,"is-super-admin":W.value,"can-edit-projects":V.value,onOpenEditModal:z[0]||(z[0]=K=>h.value=!0),onOpenStandupModal:z[1]||(z[1]=K=>T.value=!0),onOpenMeetingModal:z[2]||(z[2]=K=>x.value=!0),onOpenMagicLinkModal:z[3]||(z[3]=K=>_.value=!0),onResourceSaved:$e,onOpenComposeModal:Yt},null,8,["project","project-id","can-manage-projects","is-super-admin","can-edit-projects"]),v(dn,{tasks:n.value.tasks||[],emails:n.value.emails||[]},null,8,["tasks","emails"]),e("div",Q0,[v(me,{id:"display-currency-switcher",modelValue:H(ze),"onUpdate:modelValue":z[4]||(z[4]=K=>xs(ze)?ze.value=K:null),options:It,"value-key":"value","label-key":"label",class:"w-20",containerClasses:"max-w-[150px]"},null,8,["modelValue"])]),ye.value&&Ne.value?(i(),Q(Yu,{key:0,"project-id":H(a),"can-view-project-services-and-payments":ye.value,"can-view-project-transactions":Ne.value},null,8,["project-id","can-view-project-services-and-payments","can-view-project-transactions"])):D("",!0)]),xe.value?(i(),r("div",{key:0,class:te(["relative transition-all duration-300",{"w-full lg:flex-none":!l.value,"w-16":l.value}]),style:_e(l.value?"":`width: ${m.value}%`)},[e("div",eh,[l.value?(i(),r("div",{key:0,class:"w-16 h-full flex items-center justify-center bg-white rounded-xl shadow-lg border border-gray-200 cursor-pointer transition-all duration-300 transform hover:scale-105",onClick:ct},z[26]||(z[26]=[e("span",{class:"font-bold text-gray-500 text-sm",style:{"writing-mode":"vertical-rl","text-orientation":"sideways"}},"Project Deliverables",-1)]))):(i(),r("div",th,[e("div",{class:te(["absolute left-0 top-0 bottom-0 w-1 cursor-col-resize hover:bg-indigo-500 hover:w-1.5 z-10 transition-all",{"bg-indigo-500 w-1.5":d.value,"bg-gray-300":!d.value}]),onMousedown:Zt,title:"Drag to adjust width"},null,34),v(z0,{"project-id":H(a),"can-view-project-deliverables":xe.value,"is-collapsed":l.value,"onUpdate:isCollapsed":ct},null,8,["project-id","can-view-project-deliverables","is-collapsed"])]))])],6)):D("",!0)]),e("div",sh,[N.value?(i(),Q(vc,{key:0,"project-id":H(a),"can-view-client-contacts":N.value},null,8,["project-id","can-view-client-contacts"])):D("",!0),v(Ec,{"project-id":H(a),"can-view-users":!0},null,8,["project-id"]),v(Jc,{"project-id":H(a),onViewUserTransactions:Wt},null,8,["project-id"])]),v(mn,{ref_key:"navigationRef",ref:Ze,selectedTab:$.value,"onUpdate:selectedTab":z[5]||(z[5]=K=>$.value=K),"can-view-emails":R.value,"can-view-notes":ee.value,"can-view-deliverables":xe.value,"can-view-seo-reports":j.value},null,8,["selectedTab","can-view-emails","can-view-notes","can-view-deliverables","can-view-seo-reports"]),$.value===null?(i(),r("div",ah,[v(ip,{"overdue-tasks":Re.value.filter(K=>new Date(K.due_date)<new Date).length,"due-today-tasks":Re.value.filter(K=>new Date(K.due_date).toDateString()===new Date().toDateString()).length,onViewTasks:Ot},null,8,["overdue-tasks","due-today-tasks"]),Re.value.length>0?(i(),r("div",lh,[e("div",ih,[z[27]||(z[27]=e("h4",{class:"text-lg font-semibold text-gray-900"},"Due & Overdue Tasks",-1)),e("button",{onClick:z[6]||(z[6]=K=>$.value="tasks"),class:"text-sm text-indigo-600 hover:text-indigo-800 font-medium"}," View All Tasks â ")]),v($t,{tasks:Re.value,"project-id":H(a),"show-project-column":!1,onTaskUpdated:Ut,onOpenTaskDetail:pt},null,8,["tasks","project-id"])])):(i(),r("div",oh,[e("div",nh,[z[28]||(z[28]=e("h4",{class:"text-lg font-semibold text-gray-900"},"Due & Overdue Tasks",-1)),e("button",{onClick:z[7]||(z[7]=K=>$.value="tasks"),class:"text-sm text-indigo-600 hover:text-indigo-800 font-medium"}," View All Tasks â ")]),z[29]||(z[29]=e("p",{class:"text-gray-400 text-sm"},"No due or overdue tasks.",-1))])),R.value?(i(),r("div",rh,[e("div",dh,[z[30]||(z[30]=e("h4",{class:"text-lg font-semibold text-gray-900"},"Latest Emails",-1)),e("button",{onClick:z[8]||(z[8]=K=>$.value="emails"),class:"text-sm text-indigo-600 hover:text-indigo-800 font-medium"}," View All Emails â ")]),(Fe=n.value.emails)!=null&&Fe.length?(i(),r("div",ch,[e("table",mh,[z[32]||(z[32]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Subject"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"From"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Date"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Type"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Status"),e("th",{class:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"Actions")])],-1)),e("tbody",vh,[(i(!0),r(X,null,ae(nt.value,K=>{var Be;return i(),r("tr",{key:K.id,class:"hover:bg-gray-50 transition-colors"},[e("td",ph,g(K.subject),1),e("td",hh,g(((Be=K.sender)==null?void 0:Be.name)||"N/A"),1),e("td",gh,g(new Date(K.created_at).toLocaleDateString()),1),e("td",fh,[e("span",{class:te({"px-2 py-1 rounded-full text-xs font-medium":!0,"bg-blue-100 text-blue-800":K.type==="sent","bg-purple-100 text-purple-800":K.type==="received"})},g(K.type?K.type.toUpperCase():"N/A"),3)]),e("td",yh,[e("span",{class:te({"px-2 py-1 rounded-full text-xs font-medium":!0,"bg-green-100 text-green-800":K.status==="sent","bg-yellow-100 text-yellow-800":K.status==="pending_approval","bg-blue-200 text-blue-900":K.status==="pending_approval_received","bg-red-100 text-red-800":K.status==="rejected","bg-gray-100 text-gray-800":K.status==="draft"})},g(K.status.replace("_"," ").toUpperCase()),3)]),e("td",bh,[v(fe,{class:"text-indigo-600 hover:text-indigo-800",onClick:ts=>se.viewEmail(K)},{default:B(()=>z[31]||(z[31]=[q(" View ",-1)])),_:2,__:[31]},1032,["onClick"])])])}),128))])])])):(i(),r("div",uh,"No email communication found."))])):D("",!0),ee.value?(i(),r("div",_h,[e("div",wh,[z[34]||(z[34]=e("h4",{class:"text-lg font-semibold text-gray-900"},"Latest Notes",-1)),e("div",xh,[e("button",{onClick:z[9]||(z[9]=K=>$.value="notes"),class:"text-sm text-indigo-600 hover:text-indigo-800 font-medium"}," View All Notes â "),de.value?(i(),r("div",kh,[v(ce,{class:"bg-indigo-600 hover:bg-indigo-700 transition-colors",onClick:z[10]||(z[10]=K=>A.value=!0)},{default:B(()=>z[33]||(z[33]=[q(" Add Note ",-1)])),_:1,__:[33]})])):D("",!0)])]),ot.value.length?(i(),r("div",Dh,[(i(!0),r(X,null,ae(ot.value,K=>{var Be;return i(),r("div",{key:K.id,class:"p-4 bg-gray-50 rounded-md shadow-sm hover:bg-gray-100 transition-colors"},[e("div",Ch,[e("div",$h,[e("p",{class:te(["text-sm",{"text-gray-700":K.content!=="[Encrypted content could not be decrypted]","text-red-500 italic":K.content==="[Encrypted content could not be decrypted]"}])},[q(g(K.content)+" ",1),K.content==="[Encrypted content could not be decrypted]"?(i(),r("span",jh," (There was an issue decrypting this note. Please contact an administrator.) ")):D("",!0)],2),e("div",Th,[e("p",Eh,"Added by "+g(((Be=K.user)==null?void 0:Be.name)||"Unknown")+" on "+g(new Date(K.created_at).toLocaleDateString()),1),K.reply_count>0?(i(),r("span",Mh,g(K.reply_count)+" "+g(K.reply_count===1?"reply":"replies"),1)):D("",!0)])]),ee.value&&K.chat_message_id&&n.value.google_chat_id?(i(),r("div",Sh,[e("button",{onClick:z[11]||(z[11]=ts=>$.value="notes"),class:"text-sm text-indigo-600 hover:text-indigo-800 font-medium"}," View ")])):D("",!0)])])}),128))])):(i(),r("p",Vh,"No notes available."))])):D("",!0)])):D("",!0),$.value==="tasks"?(i(),Q(tr,{key:1,ref_key:"tasksTabRef",ref:Lt,"project-id":H(a),"project-users":n.value.users||[],"can-manage-projects":J.value,"tasks-filter":Qe.value,onTasksUpdated:Nt,onOpenTaskDetailSidebar:pt,onOpenCreateTaskModal:Jt,onFilterChanged:z[12]||(z[12]=K=>Qe.value=K)},null,8,["project-id","project-users","can-manage-projects","tasks-filter"])):D("",!0),$.value==="emails"?(i(),Q(Gd,{key:2,"project-id":H(a),"can-view-emails":R.value,"can-compose-emails":Z.value,"can-approve-emails":P.value,"user-project-role":H(y),"open-compose":p.value,onEmailsUpdated:Rt,onResetOpenCompose:z[13]||(z[13]=K=>p.value=!1)},null,8,["project-id","can-view-emails","can-compose-emails","can-approve-emails","user-project-role","open-compose"])):D("",!0),$.value==="standups"?(i(),Q(ai,{key:3,projectId:H(a),users:n.value.users||[],onStandupAdded:ut},null,8,["projectId","users"])):D("",!0),$.value==="notes"?(i(),Q(Mu,{key:4,"project-id":H(a),"google-chat-id":n.value.google_chat_id,"can-view-notes":ee.value,"can-add-notes":de.value,onNotesUpdated:dt,onChangeTab:Ht},null,8,["project-id","google-chat-id","can-view-notes","can-add-notes"])):D("",!0),$.value==="deliverables"?(i(),Q(Yp,{key:5,"project-id":H(a),"can-create-deliverables":Y.value,"can-view-deliverables":xe.value,onDeliverablesUpdated:Ft,onOpenDeliverableDetailSidebar:Gt},null,8,["project-id","can-create-deliverables","can-view-deliverables"])):D("",!0),$.value==="seo-reports"?(i(),Q(zv,{key:6,"project-id":H(a),"can-create-seo-reports":U.value,onOpenCreateSeoReportModal:Qt},null,8,["project-id","can-create-seo-reports"])):D("",!0)]))]),v(je,{show:h.value,onClose:z[15]||(z[15]=K=>h.value=!1)},{default:B(()=>[v(Cs,{show:h.value,project:n.value,statusOptions:L,clientRoleOptions:[],userRoleOptions:[],paymentTypeOptions:[],onClose:z[14]||(z[14]=K=>h.value=!1),onSubmit:Pt},null,8,["show","project"])]),_:1},8,["show"]),v(Ci,{show:x.value,"project-name":n.value.name,onClose:z[16]||(z[16]=K=>x.value=!1),onSaved:Bt,projectId:H(a),projectUsers:n.value.users||[]},null,8,["show","project-name","projectId","projectUsers"]),v(Ct,{show:T.value,onClose:z[17]||(z[17]=K=>T.value=!1),onStandupAdded:ut,projectId:H(a)},null,8,["show","projectId"]),v(jt,{show:A.value,"project-id":H(a),onClose:z[18]||(z[18]=K=>A.value=!1),onNoteAdded:dt},null,8,["show","project-id"]),v(Vi,{show:_.value,"project-id":H(a),"project-clients":n.value.clients||[],onClose:z[19]||(z[19]=K=>_.value=!1)},null,8,["show","project-id","project-clients"]),v(um,{show:S.value,"project-id":H(a),"project-name":n.value.name,onClose:z[20]||(z[20]=K=>S.value=!1)},null,8,["show","project-id","project-name"]),v(At,{show:p.value,"project-id":H(a),"user-project-role":H(y),onClose:qt,onSubmitted:zt,onError:z[21]||(z[21]=K=>console.error("Error composing email:",K))},null,8,["show","project-id","user-project-role"]),v(ns,{show:f.value,"project-id":H(a),onClose:z[22]||(z[22]=K=>f.value=!1),onSaved:Xt},null,8,["show","project-id"]),v(Kv,{"project-id":H(a),show:k.value,"initial-data":M.value,onClose:z[23]||(z[23]=K=>k.value=!1),onSaved:es},null,8,["project-id","show","initial-data"]),v(rs,{show:I.value,"onUpdate:show":z[24]||(z[24]=K=>I.value=K),title:E.value?"Deliverable Details":"Details",initialWidth:50},{content:B(()=>[E.value?(i(),Q(C0,{key:0,"project-id":H(a),"deliverable-id":E.value,onClose:Kt,onDeliverableUpdated:$e},null,8,["project-id","deliverable-id"])):I.value?(i(),r("div",Ah," No deliverable selected. ")):D("",!0)]),_:1},8,["show","title"])]}),_:1})],64))}},rg=Me(Ih,[["__scopeId","data-v-2f62d19f"]]);export{rg as default};
