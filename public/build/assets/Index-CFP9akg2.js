import{I as y,r as f,c,q as K,f as Y,e as q,g as G,o as n,w as M,b as t,a as r,t as i,m as H,i as h,x as J,y as Q,d as b,F as X,l as Z,j as P,p as w}from"./app-DgoxlfmD.js";import{_ as ee}from"./AuthenticatedLayout-DwO50zgs.js";import{S as x}from"./SelectDropdown-BGkfb8Hx.js";import"./PrimaryButton-zgMcW2MC.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./Modal-BCiLRIiA.js";import"./InputLabel-COBqFzzx.js";import"./InputError-CIdX9zEW.js";import"./SecondaryButton-BuoXjrUM.js";import"./TextInput-BP8dwQVo.js";import"./Checkbox-BH22w27k.js";import"./ApplicationLogo-Buegfz_-.js";import"./DangerButton-C3i_fLSb.js";import"./moment-BLMuvzoS.js";import"./NoticeboardModal-q6Pptenm.js";/* empty css                                                                       */const te={class:"py-8 bg-gray-50 min-h-screen"},se={class:"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8"},le={class:"bg-white shadow-xl rounded-2xl p-6"},oe={class:"mb-6 border-b pb-4"},ae={class:"flex flex-col sm:flex-row justify-between items-center mt-3 text-sm font-medium text-gray-500"},ne={class:"flex items-center space-x-2"},re={class:"text-2xl font-extrabold text-cyan-600"},ie={class:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-4 mb-6"},de={class:"col-span-1"},ce={class:"col-span-1"},ue={class:"col-span-1"},pe={class:"col-span-1"},me={key:0,class:"col-span-1"},ge={key:0,class:"flex justify-center items-center h-48"},fe={key:1},be={key:0,class:"text-center py-10 text-gray-500"},xe={key:1,class:"divide-y divide-gray-200"},ve={class:"flex-1 w-full sm:w-auto"},_e={class:"flex items-center space-x-2"},ye={class:"text-xs text-gray-500 font-mono"},he={key:0,class:"text-xs text-gray-400 font-medium"},we={class:"mt-1 font-medium text-gray-900 leading-snug"},je={class:"mt-2"},ke={class:"mt-3 sm:mt-0 text-right w-full sm:w-auto"},Ce={key:2,class:"mt-6 flex flex-col sm:flex-row items-center justify-between"},Ve={class:"text-sm text-gray-600 mb-2 sm:mb-0"},Me={class:"flex space-x-2"},Pe=["disabled"],Ae=["disabled"],qe={__name:"Index",setup(Fe){const u=y({loading:!1,error:null}),j=new Date,A=l=>l<10?"0"+l:""+l,m=f(`${j.getFullYear()}-${A(j.getMonth()+1)}`),p=f([]),o=y({current_page:1,per_page:20,total:0,last_page:1}),a=y({pointable_type:"",project_id:null,user_id:null,status:"paid"}),F=[{value:"Task",label:"Task"},{value:"Milestone",label:"Milestone"},{value:"Kudo",label:"Kudo"},{value:"ProjectNote",label:"Project Note"},{value:"Email",label:"Email"}],S=c(()=>[{value:null,label:"All Statuses"},{value:"paid",label:"Awarded"},{value:"pending",label:"Pending"},{value:"refunded",label:"Refunded"},{value:"cancelled",label:"Cancelled"},{value:"rejected",label:"Rejected"},{value:"consumed",label:"Consumed"},{value:"denied",label:"Denied"}]),k=f([]),D=c(()=>[{value:null,label:"All Projects"},...k.value]),C=f([]),T=c(()=>[{value:null,label:"Me"},...C.value]),N=c(()=>[{value:"",label:"All Types"},...F]),{canDo:O}=K(),v=c(()=>O("manage_projects").value),U=c(()=>p.value.reduce((l,e)=>l+(e.points_awarded||0),0)),z=async()=>{try{const[l,e]=await Promise.all([w.get("/api/projects-simplified"),v.value?w.get("/api/users"):Promise.resolve({data:[]})]);k.value=(l.data||[]).map(s=>({value:s.id,label:s.name})),C.value=(e.data||[]).map(s=>({value:s.id,label:s.name}))}catch(l){console.error("Failed to fetch filter options",l)}},B=()=>{const[l,e]=m.value.split("-");return{year:parseInt(l,10),month:parseInt(e,10)}},d=async()=>{const{year:l,month:e}=B();u.loading=!0,u.error=null;try{const s={year:l,month:e,page:o.current_page,per_page:o.per_page};a.pointable_type&&(s.pointable_type=a.pointable_type),a.project_id&&(s.project_id=a.project_id),v.value&&a.user_id&&(s.user_id=a.user_id),a.status&&(s.status=a.status);const _=await w.get("/api/points-ledger",{params:s});p.value=Array.isArray(_.data.data)?_.data.data:[],Object.assign(o,_.data.pagination||{})}catch(s){console.error("Failed to fetch points ledger",s),u.error="Failed to load ledger.",p.value=[]}finally{u.loading=!1}},I=()=>{o.current_page=1,d()},g=()=>{o.current_page=1,d()},L=()=>{a.pointable_type="",a.project_id=null,a.user_id=null,a.status="paid",o.current_page=1,d()},V=l=>{o.current_page=l,d()},R=()=>{o.current_page=1,d()},$=l=>new Date(l).toLocaleString(),E=l=>{switch(l){case"paid":return"Awarded";case"denied":return"Denied";default:return l}},W=l=>{const e="inline-block px-2 py-0.5 rounded-full text-xs capitalize ";switch(l){case"paid":return e+"bg-green-100 text-green-700";case"pending":return e+"bg-yellow-100 text-yellow-700";case"rejected":case"cancelled":case"denied":return e+"bg-red-100 text-red-700";default:return e+"bg-gray-100 text-gray-700"}};return Y(async()=>{await z(),await d()}),q(m,()=>{}),(l,e)=>(n(),G(ee,null,{header:M(()=>e[7]||(e[7]=[t("h2",{class:"font-semibold text-xl text-gray-800 leading-tight"},"My Points Ledger",-1)])),default:M(()=>[t("div",te,[t("div",se,[t("div",le,[t("div",oe,[e[10]||(e[10]=t("h3",{class:"text-lg font-bold text-gray-700"},"Points Summary",-1)),t("div",ae,[t("div",ne,[e[8]||(e[8]=t("span",{class:"text-sm"},"Total Points for selected month:",-1)),t("span",re,i(U.value),1)]),t("div",{class:"mt-4 sm:mt-0"},[t("button",{onClick:R,class:"inline-flex items-center px-4 py-2 bg-cyan-600 hover:bg-cyan-700 text-white font-semibold rounded-lg shadow-md transition-transform transform hover:scale-105"},e[9]||(e[9]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2",viewBox:"0 0 20 20",fill:"currentColor"},[t("path",{"fill-rule":"evenodd",d:"M4 2a1 1 0 011 1v2.128a8 8 0 109.11-1.353l-.924-.925a1 1 0 01.707-1.707L16 0h4v4l-2.062 2.062a10.001 10.001 0 01-14.864 1.353V3a1 1 0 011-1zm12 8a6 6 0 11-12 0 6 6 0 0112 0z","clip-rule":"evenodd"})],-1),H(" Refresh ",-1)]))])])]),t("div",ie,[t("div",de,[e[11]||(e[11]=t("label",{for:"month-select",class:"block text-sm font-medium text-gray-700 mb-1"},"Month",-1)),J(t("input",{type:"month",id:"month-select","onUpdate:modelValue":e[0]||(e[0]=s=>m.value=s),onChange:I,class:"w-full border-gray-300 rounded-lg shadow-sm focus:border-cyan-500 focus:ring-cyan-500"},null,544),[[Q,m.value]])]),t("div",ce,[e[12]||(e[12]=t("label",{for:"type-select",class:"block text-sm font-medium text-gray-700 mb-1"},"Type",-1)),b(x,{id:"type-select",options:N.value,modelValue:a.pointable_type,"onUpdate:modelValue":e[1]||(e[1]=s=>a.pointable_type=s),placeholder:"All Types",onChange:g,class:"w-full"},null,8,["options","modelValue"])]),t("div",ue,[e[13]||(e[13]=t("label",{for:"status-select",class:"block text-sm font-medium text-gray-700 mb-1"},"Status",-1)),b(x,{id:"status-select",options:S.value,modelValue:a.status,"onUpdate:modelValue":e[2]||(e[2]=s=>a.status=s),placeholder:"All Statuses",onChange:g,class:"w-full"},null,8,["options","modelValue"])]),t("div",pe,[e[14]||(e[14]=t("label",{for:"project-select",class:"block text-sm font-medium text-gray-700 mb-1"},"Project",-1)),b(x,{id:"project-select",options:D.value,modelValue:a.project_id,"onUpdate:modelValue":e[3]||(e[3]=s=>a.project_id=s),placeholder:"All Projects",onChange:g,class:"w-full"},null,8,["options","modelValue"])]),v.value?(n(),r("div",me,[e[15]||(e[15]=t("label",{for:"user-select",class:"block text-sm font-medium text-gray-700 mb-1"},"User",-1)),b(x,{id:"user-select",options:T.value,modelValue:a.user_id,"onUpdate:modelValue":e[4]||(e[4]=s=>a.user_id=s),placeholder:"Me",onChange:g,class:"w-full"},null,8,["options","modelValue"])])):h("",!0),t("div",{class:"col-span-1 flex items-end"},[t("button",{onClick:L,class:"w-full inline-flex items-center justify-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-cyan-500"}," Clear Filters ")])]),u.loading?(n(),r("div",ge,e[16]||(e[16]=[t("div",{class:"animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-cyan-500"},null,-1)]))):(n(),r("div",fe,[p.value.length===0?(n(),r("div",be,e[17]||(e[17]=[t("p",null,"No ledger entries found for the selected filters.",-1)]))):(n(),r("ul",xe,[(n(!0),r(X,null,Z(p.value,s=>(n(),r("li",{key:s.id,class:"py-4 px-3 sm:px-0 flex flex-col sm:flex-row items-start sm:items-center justify-between transition-all duration-200 hover:bg-gray-50 rounded-lg"},[t("div",ve,[t("div",_e,[t("span",ye,i($(s.created_at)),1),s.project?(n(),r("span",he," • "+i(s.project.name),1)):h("",!0)]),t("div",we,i(s.description||"—"),1),t("div",je,[t("span",{class:P([W(s.status),"font-semibold px-2 py-0.5 rounded-full text-xs capitalize"])},i(E(s.status)),3)])]),t("div",ke,[t("div",{class:P(["text-xl font-extrabold",s.points_awarded>=0?"text-green-600":"text-red-600"])},i(Math.round(s.points_awarded))+" pts ",3)])]))),128))])),o.total>o.per_page?(n(),r("div",Ce,[t("div",Ve,"Showing "+i(o.current_page*o.per_page-o.per_page+1)+" to "+i(Math.min(o.current_page*o.per_page,o.total))+" of "+i(o.total)+" entries",1),t("div",Me,[t("button",{disabled:o.current_page<=1,onClick:e[5]||(e[5]=s=>V(o.current_page-1)),class:"px-4 py-2 border rounded-md disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-100 transition-colors duration-200"}," Previous ",8,Pe),t("button",{disabled:o.current_page>=o.last_page,onClick:e[6]||(e[6]=s=>V(o.current_page+1)),class:"px-4 py-2 border rounded-md disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-100 transition-colors duration-200"}," Next ",8,Ae)])])):h("",!0)]))])])])]),_:1}))}};export{qe as default};
