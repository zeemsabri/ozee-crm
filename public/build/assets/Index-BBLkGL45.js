import{a as i,o as n,b as e,r as w,c as C,e as ue,g as J,w as K,i as A,d as p,H,t as g,I as Ge,J as Ce,m as U,j as Z,y as X,F as ee,l as oe,x as Xe,A as ht,u as c,n as wt,k as we,q as _t,f as kt,h as Ct,z as $t,K as Dt,L as ce,M as jt}from"./app-SqGcPtWR.js";import{B as ve,a as Mt,_ as St}from"./AuthenticatedLayout-fXnLTnWw.js";import{S as me}from"./SelectDropdown-CqneZTUc.js";import{P as ie}from"./PrimaryButton-ZwHmGBND.js";import{_ as Je}from"./SecondaryButton-CwsDALDU.js";import{c as Q,a as pe,d as At,f as W,b as Bt}from"./currency-CUMZtJY-.js";import{_ as te}from"./InputLabel-Bb8lo1WW.js";import{_ as le}from"./TextInput-CXH52_1a.js";import{_ as se}from"./InputError-CNTSKuH2.js";import{_ as Pt}from"./Modal-D6W0cgKy.js";import{r as _e,a as Tt}from"./PlusIcon-ETQRTJXW.js";import{r as Lt}from"./MagnifyingGlassIcon-Coczj8DE.js";import{a as ke,r as Vt}from"./PlusCircleIcon-Bx1G5SOZ.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./Checkbox-B0U4Q9FX.js";import"./ApplicationLogo-CF15OVda.js";import"./DangerButton-BhkV7ftf.js";import"./moment-BLMuvzoS.js";function ze(k,N){return n(),i("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9 12.75 11.25 15 15 9.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"})])}function Rt(k,N){return n(),i("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m19.5 8.25-7.5 7.5-7.5-7.5"})])}function Nt(k,N){return n(),i("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z"})])}function It(k,N){return n(),i("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"})])}function Ft(k,N){return n(),i("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M21 12a2.25 2.25 0 0 0-2.25-2.25H15a3 3 0 1 1-6 0H5.25A2.25 2.25 0 0 0 3 12m18 0v6a2.25 2.25 0 0 1-2.25 2.25H5.25A2.25 2.25 0 0 1 3 18v-6m18 0V9M3 12V9m18 0a2.25 2.25 0 0 0-2.25-2.25H5.25A2.25 2.25 0 0 0 3 9m18 0V6a2.25 2.25 0 0 0-2.25-2.25H5.25A2.25 2.25 0 0 0 3 6v3"})])}function Ut(k,N){return n(),i("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m9.75 9.75 4.5 4.5m0-4.5-4.5 4.5M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"})])}const Et={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},qt={key:0},Ot={class:"md:col-span-2"},Ze={__name:"MilestoneExpendableModal",props:{show:Boolean,title:String,milestone:Object,users:Object,currencyOptions:Array,isBudgetForm:{type:Boolean,default:!1},isUserSelectionRequired:{type:Boolean,default:!1},projectTotalBudget:Number,projectBudgetCurrency:String,milestoneStats:Object},emits:["close","submitted"],setup(k,{emit:N}){const l=k,R=N,o=w({}),b=w(""),j=w("post"),$=w(""),B=w(""),h=w({}),V=C(()=>{var M;return((Array.isArray((M=l.users)==null?void 0:M.users)?l.users.users:l.users)||[]).map(u=>({value:u.id,label:u.name}))});ue(()=>l.show,r=>{r&&l.milestone&&(h.value={},l.isBudgetForm?(o.value=l.milestone.budget?{...l.milestone.budget,amount:Number(l.milestone.budget.amount)}:{name:"Milestone Budget",description:"",amount:"",currency:"PKR"},b.value=l.milestone.budget?`/api/projects/${l.milestone.project_id}/expendables/${l.milestone.budget.id}`:`/api/projects/${l.milestone.project_id}/expendables`,j.value=l.milestone.budget?"put":"post",$.value=l.milestone.budget?"Update Budget":"Create Budget",B.value=l.milestone.budget?"Milestone budget updated successfully":"Milestone budget created successfully"):(o.value={name:"",description:"",amount:"",currency:"PKR",user_id:null},b.value=`/api/projects/${l.milestone.project_id}/expendables`,j.value="post",$.value="Create Contract",B.value="Contract created and sent for approval"))},{immediate:!0,deep:!0});const T=()=>{var u,y;h.value={};let r=!1;o.value.name||(h.value.name=["Name is required."],r=!0),(!o.value.amount||Number(o.value.amount)<=0)&&(h.value.amount=h.value.amount||[],h.value.amount.push("Amount must be a positive number."),r=!0),l.isUserSelectionRequired&&!o.value.user_id&&(h.value.user_id=["User selection is required for contracts."],r=!0),Q(Number(o.value.amount||0),o.value.currency,l.projectBudgetCurrency);const M=Q(Number(o.value.amount||0),o.value.currency,((u=l.milestone.budget)==null?void 0:u.currency)||"PKR");if(l.isBudgetForm){l.projectTotalBudget<=0&&(H("No project budget left. Ask a project admin to add more budget."),r=!0);const f=l.milestone.budget?Q(Number(l.milestone.budget.amount||0),l.milestone.budget.currency,l.projectBudgetCurrency):0;l.milestoneStats.approvedAmt+(M-f)>Q(l.projectTotalBudget,l.projectBudgetCurrency,((y=l.milestone.budget)==null?void 0:y.currency)||"PKR")&&(h.value.amount=["Cannot add more budget than the project's total expendable budget."],r=!0)}else M>l.milestoneStats.remaining&&(h.value.amount=["Cannot add a contract more than the remaining milestone budget."],r=!0);return!r},E=r=>({...r,amount:Number(r.amount||0),user_id:l.isBudgetForm?null:r.user_id,expendable_type:"Milestone",expendable_id:l.milestone.id}),I=r=>{R("submitted",r)},q=()=>{R("close")};return(r,M)=>(n(),J(ve,{show:k.show,title:k.title,"api-endpoint":b.value,"http-method":j.value,"form-data":o.value,"submit-button-text":$.value,"success-message":B.value,"format-data-for-api":E,"before-submit":T,onSubmitted:I,onClose:q},{default:K(({errors:u})=>{var y,f,F,S,m,v,Y,d,D,L;return[e("div",Et,[e("div",null,[p(te,{for:"name",value:"Name"}),p(le,{id:"name",modelValue:o.value.name,"onUpdate:modelValue":M[0]||(M[0]=O=>o.value.name=O),class:"mt-1 w-full",placeholder:"e.g., Asset Purchase"},null,8,["modelValue"]),p(se,{message:((y=h.value.name)==null?void 0:y[0])||((f=u.name)==null?void 0:f[0]),class:"mt-1"},null,8,["message"])]),e("div",null,[p(te,{for:"amount",value:"Amount"}),p(le,{id:"amount",type:"number",step:"0.01",modelValue:o.value.amount,"onUpdate:modelValue":M[1]||(M[1]=O=>o.value.amount=O),class:"mt-1 w-full"},null,8,["modelValue"]),p(se,{message:((F=h.value.amount)==null?void 0:F[0])||((S=u.amount)==null?void 0:S[0]),class:"mt-1"},null,8,["message"])]),e("div",null,[p(te,{for:"currency",value:"Currency"}),p(me,{id:"currency",modelValue:o.value.currency,"onUpdate:modelValue":M[2]||(M[2]=O=>o.value.currency=O),options:k.currencyOptions,"value-key":"value","label-key":"label",class:"mt-1 w-full"},null,8,["modelValue","options"]),p(se,{message:((m=h.value.currency)==null?void 0:m[0])||((v=u.currency)==null?void 0:v[0]),class:"mt-1"},null,8,["message"])]),k.isBudgetForm?A("",!0):(n(),i("div",qt,[p(te,{for:"user",value:"User"}),p(me,{id:"user",modelValue:o.value.user_id,"onUpdate:modelValue":M[3]||(M[3]=O=>o.value.user_id=O),options:V.value,"value-key":"value","label-key":"label",class:"mt-1 w-full",placeholder:"Select user"},null,8,["modelValue","options"]),p(se,{message:((Y=h.value.user_id)==null?void 0:Y[0])||((d=u.user_id)==null?void 0:d[0]),class:"mt-1"},null,8,["message"])])),e("div",Ot,[p(te,{for:"description",value:"Description (optional)"}),p(le,{id:"description",modelValue:o.value.description,"onUpdate:modelValue":M[4]||(M[4]=O=>o.value.description=O),class:"mt-1 w-full",placeholder:"Details"},null,8,["modelValue"]),p(se,{message:((D=h.value.description)==null?void 0:D[0])||((L=u.description)==null?void 0:L[0]),class:"mt-1"},null,8,["message"])])])]}),_:1},8,["show","title","api-endpoint","http-method","form-data","submit-button-text","success-message"]))}},Ht={class:"text-sm text-gray-600 mb-4"},Kt={class:"mt-2"},Yt={__name:"ReasonModal",props:{show:{type:Boolean,default:!1},title:{type:String,default:"Reason Required"},message:{type:String,required:!0},type:{type:String,default:"info",validator:k=>["info","warning"].includes(k)},apiEndpoint:{type:String,required:!0},httpMethod:{type:String,required:!0}},emits:["submitted","close"],setup(k,{emit:N}){const l=k,R=N,o=w({reason:""}),b=w({}),j=()=>!o.value.reason||!o.value.reason.trim()?(H("Reason is required."),b.value.reason=["Reason is required."],!1):(b.value={},!0),$=()=>{R("submitted")},B=()=>{R("close")};return ue(()=>l.show,h=>{h&&(o.value={reason:""},b.value={})}),(h,V)=>(n(),J(ve,{show:k.show,title:k.title,"api-endpoint":k.apiEndpoint,"http-method":k.httpMethod,"form-data":o.value,"submit-button-text":"Submit","success-message":"Operation successful!","before-submit":j,onClose:B,onSubmitted:$},{default:K(({errors:T})=>{var E,I;return[e("p",Ht,g(k.message),1),e("div",Kt,[p(te,{for:"reason-input",value:"Reason"}),p(le,{id:"reason-input",modelValue:o.value.reason,"onUpdate:modelValue":V[0]||(V[0]=q=>o.value.reason=q),class:"mt-1 block w-full",onKeyup:Ge($,["enter"])},null,8,["modelValue"]),p(se,{message:((E=T.reason)==null?void 0:E[0])||((I=b.value.reason)==null?void 0:I[0]),class:"mt-1"},null,8,["message"])])]}),_:1},8,["show","title","api-endpoint","http-method","form-data"]))}},zt={class:"space-y-4"},Zt={key:1,id:"final-task-list",class:"space-y-3"},Gt={class:"flex items-center justify-between"},Xt={class:"flex-1"},Jt=["onClick"],Qt={key:0,class:"mt-0.5 text-xs text-gray-600 truncate"},Wt=["id","value","onBlur","onKeyup"],es={class:"flex items-center space-x-2 ml-4"},ts=["onClick"],ss=["onClick"],os={key:0,class:"mt-4"},ns=["onUpdate:modelValue"],ls={class:"flex flex-col sm:flex-row sm:items-center space-y-2 sm:space-y-0 sm:space-x-4 text-xs text-gray-500 mt-2"},as={class:"flex items-center space-x-2"},rs=["onClick"],is=["onClick"],us=["value","onChange","min","max"],ds={class:"flex items-center space-x-2"},cs=["onClick"],ps=["onClick"],ms=["onClick"],vs={class:"flex justify-end space-x-3"},gs={__name:"BulkTaskModal",props:{show:{type:Boolean,default:!1},contractId:{type:Number,required:!0},completionDate:{type:String,required:!1,default:null}},emits:["close","tasks-submitted"],setup(k,{emit:N}){const l=k,R=N,o=Ce([]),b=w(""),j=w({show:!1,text:"",type:"success"}),$=new Date,B=new Date($);B.setDate($.getDate()+1);const h=w("");ue(()=>l.show,m=>{m||(o.splice(0,o.length),b.value="",h.value="",j.value={show:!1,text:"",type:"success"})});const V=()=>{h.value&&h.value.trim()!==""&&(o.push({name:h.value,dueDate:"",priority:"Medium",contract_id:l.contractId,description:"",isEditingName:!1,showDescription:!1}),h.value="",j.value.show=!1)},T=m=>{o.splice(m,1)},E=(m,v)=>{o[m].priority=v},I=(m,v)=>{const Y=new Date($.getFullYear(),$.getMonth(),$.getDate()),d=l.completionDate?new Date(l.completionDate):null,D=new Date(v);if(j.value.show=!1,d&&D>d){j.value={show:!0,text:"The selected due date is after the milestone completion date.",type:"error"},o[m].dueDate="";return}if(D<Y){j.value={show:!0,text:"The selected due date cannot be in the past.",type:"error"},o[m].dueDate="";return}o[m].dueDate=v},q=m=>{o[m].showDescription=!o[m].showDescription},r=m=>{o[m].isEditingName=!0,wt(()=>{document.getElementById(`task-name-input-${m}`).focus()})},M=(m,v)=>{v.trim()&&(o[m].name=v),o[m].isEditingName=!1},u=m=>({tasks:m}),y=C(()=>o.length===0||o.some(m=>!m.name.trim()||!m.dueDate||!m.priority)),f=m=>{console.log("Submitting tasks to API:",o),j.value={show:!0,text:"Tasks submitted successfully!",type:"success"},setTimeout(()=>{j.value.show=!1,R("tasks-submitted"),m()},1500)},F=C(()=>o),S=m=>{const v=l.completionDate?new Date(l.completionDate):null,Y=new Date($.getFullYear(),$.getMonth(),$.getDate()),d=new Date(m);return d>=Y&&(!v||d<=v)};return(m,v)=>(n(),J(ve,{show:k.show,title:"Create Tasks in Bulk","api-endpoint":"/api/tasks/bulk","http-method":"post","form-data":F.value,"format-data-for-api":u,"submit-button-text":"Create Tasks",onClose:v[1]||(v[1]=Y=>m.$emit("close")),onSubmitted:f},{default:K(({errors:Y})=>[e("div",zt,[j.value.show?(n(),i("div",{key:0,class:Z(["mb-4 p-4 rounded-lg transition-all duration-300 ease-in-out",{"bg-green-100 text-green-700 border border-green-200":j.value.type==="success","bg-red-100 text-red-700 border border-red-200":j.value.type==="error"}])},g(j.value.text),3)):A("",!0),e("form",{onSubmit:X(V,["prevent"]),class:"relative"},[p(le,{modelValue:h.value,"onUpdate:modelValue":v[0]||(v[0]=d=>h.value=d),id:"task-name-input",placeholder:"e.g., 'Finish project report'",class:"w-full p-4 pr-12 text-lg border border-gray-300 rounded-xl focus:ring-indigo-500 focus:border-indigo-500 shadow-sm transition-all duration-200 ease-in-out"},null,8,["modelValue"]),v[2]||(v[2]=e("button",{type:"submit",class:"absolute right-4 top-1/2 -translate-y-1/2 p-2 text-indigo-600 hover:text-indigo-800"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})])],-1))],32),v[8]||(v[8]=e("hr",{class:"my-6 border-gray-200"},null,-1)),o.length>0?(n(),i("div",Zt,[v[7]||(v[7]=e("h2",{class:"text-lg font-semibold text-gray-800"},"Tasks to Create:",-1)),(n(!0),i(ee,null,oe(o,(d,D)=>(n(),i("div",{key:D,class:"flex flex-col p-4 bg-gray-50 rounded-xl border border-gray-200 group transition-all duration-200 ease-in-out"},[e("div",Gt,[e("div",Xt,[d.isEditingName?(n(),i("input",{key:1,id:`task-name-input-${D}`,type:"text",value:d.name,onBlur:L=>M(D,L.target.value),onKeyup:Ge(L=>M(D,L.target.value),["enter"]),class:"text-sm font-semibold text-gray-800 w-full rounded-md border-gray-300 focus:ring-indigo-500 focus:border-indigo-500 shadow-sm"},null,40,Wt)):(n(),i(ee,{key:0},[e("p",{onClick:L=>r(D),class:"text-sm font-semibold text-gray-800 truncate cursor-pointer hover:underline"},g(d.name),9,Jt),d.description&&d.description.trim().length?(n(),i("p",Qt,g(d.description),1)):A("",!0)],64))]),e("div",es,[e("button",{type:"button",onClick:L=>q(D),class:Z(["p-1 rounded-full transition-all duration-200 ease-in-out",[d.showDescription||d.description&&d.description.trim().length?"text-indigo-600 hover:text-indigo-700":"text-gray-400 hover:text-indigo-500"]]),title:"Add description"},v[3]||(v[3]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",class:"h-5 w-5"},[e("path",{d:"M19.5 14.25h-15m15-5.25h-15M9 19.5H4.5A1.5 1.5 0 013 18V6a1.5 1.5 0 011.5-1.5H15L21 9v9a1.5 1.5 0 01-1.5 1.5H15"})],-1)]),10,ts),e("button",{type:"button",onClick:L=>T(D),class:"remove-final-task p-1 rounded-full text-red-500 opacity-0 group-hover:opacity-100 transition-all duration-200 ease-in-out"},v[4]||(v[4]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z","clip-rule":"evenodd"})],-1)]),8,ss)])]),d.showDescription?(n(),i("div",os,[Xe(e("textarea",{"onUpdate:modelValue":L=>d.description=L,rows:"2",placeholder:"Add an optional description...",class:"w-full rounded-md border-gray-300 focus:ring-indigo-500 focus:border-indigo-500 shadow-sm text-sm"},null,8,ns),[[ht,d.description]])])):A("",!0),e("div",ls,[e("div",as,[v[5]||(v[5]=e("span",{class:"font-medium"},"Due:",-1)),S(c($).toISOString().split("T")[0])?(n(),i("button",{key:0,type:"button",onClick:L=>I(D,c($).toISOString().split("T")[0]),class:Z(["px-2 py-0.5 rounded-full text-indigo-600 bg-indigo-100 text-xs hover:bg-indigo-200",{"bg-indigo-300 font-semibold":d.dueDate===c($).toISOString().split("T")[0]}])},"Today",10,rs)):A("",!0),S(c(B).toISOString().split("T")[0])?(n(),i("button",{key:1,type:"button",onClick:L=>I(D,c(B).toISOString().split("T")[0]),class:Z(["px-2 py-0.5 rounded-full text-indigo-600 bg-indigo-100 text-xs hover:bg-indigo-200",{"bg-indigo-300 font-semibold":d.dueDate===c(B).toISOString().split("T")[0]}])},"Tomorrow",10,is)):A("",!0),e("input",{type:"date",value:d.dueDate,onChange:L=>I(D,L.target.value),min:c($).toISOString().split("T")[0],max:k.completionDate,required:"",class:Z([d.dueDate?"border-gray-300":"border-red-300","p-1 rounded-lg border text-xs focus:ring-indigo-500 focus:border-indigo-500 shadow-sm transition-all duration-200 ease-in-out"])},null,42,us)]),e("div",ds,[v[6]||(v[6]=e("span",{class:"font-medium"},"Priority:",-1)),e("button",{type:"button",onClick:L=>E(D,"Low"),class:Z(["px-2 py-0.5 rounded-full text-gray-500 bg-gray-100 text-xs hover:bg-gray-200",{"bg-gray-200 font-semibold":d.priority==="Low"}])},"Low",10,cs),e("button",{type:"button",onClick:L=>E(D,"Medium"),class:Z(["px-2 py-0.5 rounded-full text-blue-600 bg-blue-100 text-xs hover:bg-blue-200",{"bg-blue-200 font-semibold":d.priority==="Medium"}])},"Medium",10,ps),e("button",{type:"button",onClick:L=>E(D,"High"),class:Z(["px-2 py-0.5 rounded-full text-red-600 bg-red-100 text-xs hover:bg-red-200",{"bg-red-200 font-semibold":d.priority==="High"}])},"High",10,ms)])])]))),128))])):A("",!0)])]),footer:K(({close:Y})=>[e("div",vs,[p(Je,{onClick:Y,type:"button"},{default:K(()=>v[9]||(v[9]=[U(" Cancel ",-1)])),_:2,__:[9]},1032,["onClick"]),p(ie,{type:"submit",disabled:y.value,class:Z({"opacity-50 cursor-not-allowed":y.value})},{default:K(()=>v[10]||(v[10]=[U(" Create Tasks ",-1)])),_:1,__:[10]},8,["disabled","class"])])]),_:1},8,["show","form-data"]))}},fs={class:"space-y-3"},bs={__name:"MilestoneCompletionDateModal",props:{show:{type:Boolean,default:!1},milestoneId:{type:[Number,String],required:!0},initialCompletionDate:{type:String,default:null}},emits:["close","updated"],setup(k,{emit:N}){const l=k,R=N,o=Ce({completion_date:l.initialCompletionDate||null}),b=Ce({completion_date:null});ue(()=>l.show,V=>{V&&(o.completion_date=l.initialCompletionDate||null,b.completion_date=null)});const j=C(()=>`/api/milestones/${l.milestoneId}`),$=()=>(b.completion_date=null,o.completion_date?!0:(b.completion_date=["Completion date is required."],!1)),B=V=>{R("updated",V),R("close")},h=()=>R("close");return(V,T)=>(n(),J(ve,{show:k.show,title:"Set Milestone Completion Date","api-endpoint":j.value,"http-method":"put","form-data":o,"submit-button-text":"Save Date","success-message":"Milestone updated","before-submit":$,onClose:h,onSubmitted:B},{default:K(({errors:E})=>{var I,q;return[e("div",fs,[T[1]||(T[1]=e("p",{class:"text-sm text-gray-600"}," This milestone does not have a completion date. Please set it to continue creating tasks for its contracts. ",-1)),e("div",null,[p(te,{for:"milestone-completion-date",value:"Completion Date"}),p(le,{id:"milestone-completion-date",modelValue:o.completion_date,"onUpdate:modelValue":T[0]||(T[0]=r=>o.completion_date=r),type:"date",class:"mt-1 block w-full",required:""},null,8,["modelValue"]),p(se,{message:((I=E.completion_date)==null?void 0:I[0])||((q=b.completion_date)==null?void 0:q[0]),class:"mt-1"},null,8,["message"])])])]}),_:1},8,["show","api-endpoint","form-data"]))}},xs={class:"mt-8 p-6 md:p-8 bg-white rounded-2xl shadow-xl space-y-8 font-sans"},ys={class:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 border-b pb-4"},hs={class:"flex-1"},ws={class:"text-xl font-bold text-gray-900"},_s={class:"text-sm text-gray-500 mt-1"},ks={key:0},Cs={class:"flex items-center gap-4 flex-shrink-0"},$s={class:"relative w-28 h-28"},Ds={class:"w-full h-full transform -rotate-90"},js=["stroke-dashoffset"],Ms=["stroke-dashoffset"],Ss={class:"absolute inset-0 flex items-center justify-center"},As={class:"text-2xl font-bold text-gray-900"},Bs={class:"space-y-8 px-4"},Ps={class:"relative w-full h-2 rounded-full bg-gray-200"},Ts={class:"absolute -top-6 left-1/2 -translate-x-1/2 text-xs font-medium text-indigo-700 w-max"},Ls={class:"relative w-full h-4 mt-4 -top-8"},Vs={class:"w-2 h-2 rounded-full bg-gray-400 shadow-sm z-10 group relative"},Rs={key:0,class:"absolute -top-1 -right-1 w-3 h-3 text-xs bg-gray-500 text-white rounded-full flex items-center justify-center font-bold"},Ns={class:"absolute top-full mt-2 w-max p-2 text-xs text-center text-white bg-gray-800 rounded-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none z-20"},Is={class:"font-bold border-b pb-1 mb-1"},Fs={class:"absolute top-full mt-2 w-max min-w-[70px]"},Us={class:"text-gray-500 text-xs truncate"},Es={__name:"ProjectProgressTimeline",props:{milestones:{type:Array,default:()=>[]},showTicks:{type:Boolean,default:!0},title:{type:String,default:"Project Progress & Timeline"},progressLabel:{type:String,default:"Project Progress"},timelineLabel:{type:String,default:"Timeline"}},setup(k){const N=k,l=C(()=>(N.milestones||[]).filter(u=>!!(u!=null&&u.completion_date))),R=C(()=>[...l.value].sort((u,y)=>{const f=new Date(u.completion_date),F=new Date(y.completion_date);return f-F})),o=C(()=>(N.milestones||[]).length),b=C(()=>(N.milestones||[]).filter(u=>((u==null?void 0:u.status)||"").toLowerCase()==="completed")),j=C(()=>(N.milestones||[]).filter(u=>((u==null?void 0:u.status)||"").toLowerCase()==="approved")),$=C(()=>b.value.length+j.value.length);C(()=>o.value?Math.round(b.value.length/o.value*100):0);const B=C(()=>o.value?Math.round(j.value.length/o.value*100):0),h=C(()=>o.value?Math.round($.value/o.value*100):0),V=C(()=>R.value.length?new Date(R.value[0].completion_date):null),T=C(()=>R.value.length?new Date(R.value[R.value.length-1].completion_date):null),E=C(()=>{if(!V.value||!T.value)return 0;const u=v=>new Date(v.getFullYear(),v.getMonth(),v.getDate(),12,0,0),y=u(V.value),f=u(T.value),F=u(new Date),S=f-y;if(S<=0)return 100;let m=(F-y)/S*100;return m<0&&(m=0),m>100&&(m=100),Math.round(m)}),I=u=>{const y=new Date,F=new Date(u)-y,S=Math.ceil(F/(1e3*60*60*24));return S===0?"Due Today":S>0?`${S} day${S===1?"":"s"} left`:`${Math.abs(S)} day${Math.abs(S)===1?"":"s"} overdue`},q=u=>{if(!V.value||!T.value)return 0;const y=new Date(V.value),f=new Date(T.value),F=new Date(u),S=f-y;return S<=0?100:(F-y)/S*100},r=C(()=>{const u={};return R.value.forEach(y=>{const f=new Date(y.completion_date).toLocaleDateString();u[f]||(u[f]={date:y.completion_date,milestones:[]}),u[f].milestones.push(y)}),Object.values(u)}),M=u=>{const y=Math.max(2,Math.min(98,u)),f=u<5?"0%":u>95?"-100%":"-50%";return{left:`${y}%`,transform:`translateX(${f})`}};return(u,y)=>(n(),i("div",xs,[e("header",ys,[e("div",hs,[e("h2",ws,g(k.title),1),e("p",_s,[U(g($.value)+" of "+g(o.value)+" milestones completed. ",1),V.value&&T.value?(n(),i("span",ks," Project timeline: "+g(new Date(V.value).toLocaleDateString())+" — "+g(new Date(T.value).toLocaleDateString())+". ",1)):A("",!0)])]),e("div",Cs,[e("div",$s,[(n(),i("svg",Ds,[y[0]||(y[0]=e("circle",{class:"text-gray-200","stroke-width":"8",stroke:"currentColor",fill:"transparent",r:"44",cx:"56",cy:"56"},null,-1)),e("circle",{class:"text-indigo-500","stroke-width":"8","stroke-dasharray":276.46,"stroke-dashoffset":276.46-276.46*h.value/100,"stroke-linecap":"round",stroke:"currentColor",fill:"transparent",r:"44",cx:"56",cy:"56",style:{transition:"stroke-dashoffset 0.5s ease-in-out"}},null,8,js),y[1]||(y[1]=e("circle",{class:"text-gray-300","stroke-width":"8",stroke:"currentColor",fill:"transparent",r:"32",cx:"56",cy:"56"},null,-1)),e("circle",{class:"text-green-500","stroke-width":"8","stroke-dasharray":201.06,"stroke-dashoffset":201.06-201.06*B.value/100,"stroke-linecap":"round",stroke:"currentColor",fill:"transparent",r:"32",cx:"56",cy:"56",style:{transition:"stroke-dashoffset 0.5s ease-in-out"}},null,8,Ms)])),e("div",Ss,[e("span",As,g(h.value)+"%",1)])])])]),e("div",Bs,[e("div",Ps,[e("div",{class:"h-full bg-indigo-500 rounded-full",style:we({width:E.value+"%"})},null,4),V.value&&T.value?(n(),i("div",{key:0,class:"absolute top-1/2 -translate-y-1/2",style:we({left:`calc(${E.value}% - 8px)`})},[e("div",Ts," Today: "+g(new Date().toLocaleDateString()),1),y[2]||(y[2]=e("div",{class:"w-4 h-4 rounded-full bg-indigo-700 border-2 border-white shadow-md transform scale-125 transition-transform duration-200",title:"Today"},null,-1))],4)):A("",!0)]),e("div",Ls,[(n(!0),i(ee,null,oe(r.value,(f,F)=>(n(),i("div",{key:F,class:"absolute top-0 flex flex-col items-center text-center",style:we(M(q(f.date)))},[e("div",Vs,[f.milestones.length>1?(n(),i("div",Rs,g(f.milestones.length),1)):A("",!0),e("div",Ns,[e("p",Is,g(new Date(f.date).toLocaleDateString()),1),(n(!0),i(ee,null,oe(f.milestones,S=>(n(),i("p",{key:S.id,class:"text-left text-gray-300"}," - "+g(S.name),1))),128))])]),e("div",Fs,[e("p",Us,g(new Date(f.date).toLocaleDateString()),1),e("p",{class:Z(["text-xs font-medium truncate",{"text-red-500":I(f.date).includes("overdue"),"text-gray-600":!I(f.date).includes("overdue")}])},g(I(f.date)),3)])],4))),128))])])]))}},qs={class:"flex flex-col md:flex-row items-start md:items-center justify-between gap-4"},Os={class:"flex items-center gap-3 w-full md:w-auto"},Hs={class:"flex-grow md:flex-grow-0 w-full md:w-64"},Ks={class:"w-24 md:w-32 flex-shrink-0"},Ys={class:"py-8"},zs={class:"max-w-7xl mx-auto sm:px-6 lg:px-8 space-y-6"},Zs={key:0},Gs={class:"bg-white rounded-xl p-6 shadow-sm"},Xs={class:"grid grid-cols-1 md:grid-cols-3 gap-6"},Js={class:"bg-green-50 rounded-lg p-5 shadow-sm flex flex-col justify-between"},Qs={class:"text-3xl font-bold text-green-900"},Ws={class:"bg-yellow-50 rounded-lg p-5 shadow-sm flex flex-col justify-between"},eo={class:"text-3xl font-bold text-yellow-900"},to={class:"bg-blue-50 rounded-lg p-5 shadow-sm flex flex-col justify-between"},so={class:"text-3xl font-bold text-blue-900"},oo={class:"bg-white rounded-xl shadow-sm p-6"},no={class:"flex flex-col sm:flex-row items-start sm:items-center justify-between border-b pb-4 mb-4"},lo={class:"flex items-center gap-2"},ao={class:"flex space-x-2 mt-2 sm:mt-0"},ro=["onClick"],io={key:0,class:"text-center text-gray-500 py-12"},uo={key:1},co={key:0,class:"text-center text-gray-500 py-12"},po={key:1,class:"text-center text-gray-500 py-12"},mo={key:2,class:"space-y-4"},vo=["onClick"],go={class:"flex-grow"},fo={class:"font-bold text-lg text-gray-900 mb-1"},bo={key:0,class:"text-sm text-gray-600"},xo={class:"mt-1 text-xs text-gray-500 flex items-center gap-2"},yo={key:0},ho={class:"font-medium text-gray-700"},wo={key:1},_o={class:"flex items-center gap-4 text-sm text-gray-700"},ko={class:"hidden sm:flex items-center gap-4"},Co={class:"inline-flex items-center gap-1 text-gray-600"},$o={class:"font-semibold text-gray-800"},Do={class:"inline-flex items-center gap-1 text-gray-600"},jo={class:"font-semibold text-green-700"},Mo={class:"inline-flex items-center gap-1 text-gray-600"},So={class:"font-semibold text-blue-700"},Ao=["onClick"],Bo={class:"flex items-center gap-2"},Po=["onClick"],To=["onClick"],Lo={class:"border-t border-gray-200 p-5 bg-white rounded-b-xl"},Vo={class:"mb-5"},Ro={class:"flex flex-wrap gap-2 text-xs"},No={class:"inline-flex items-center gap-1 px-2 py-1 rounded-full bg-gray-100 text-gray-700"},Io={class:"font-semibold"},Fo={class:"inline-flex items-center gap-1 px-2 py-1 rounded-full bg-slate-100 text-slate-700"},Uo={class:"font-semibold"},Eo={class:"inline-flex items-center gap-1 px-2 py-1 rounded-full bg-blue-100 text-blue-700"},qo={class:"font-semibold"},Oo={class:"inline-flex items-center gap-1 px-2 py-1 rounded-full bg-yellow-100 text-yellow-700"},Ho={class:"font-semibold"},Ko={class:"inline-flex items-center gap-1 px-2 py-1 rounded-full bg-orange-100 text-orange-700"},Yo={class:"font-semibold"},zo={class:"inline-flex items-center gap-1 px-2 py-1 rounded-full bg-green-100 text-green-700"},Zo={class:"font-semibold"},Go={class:"inline-flex items-center gap-1 px-2 py-1 rounded-full bg-red-100 text-red-700"},Xo={class:"font-semibold"},Jo={class:"flex justify-between items-center mb-4"},Qo={class:"flex items-center gap-2"},Wo={key:0,class:"text-center text-gray-500 text-sm py-4"},en={key:1,class:"space-y-2"},tn={class:"flex items-center gap-2"},sn={key:0,class:"text-gray-600 text-xs sm:text-sm"},on={class:"font-medium"},nn={class:"flex items-center gap-4 mt-2 sm:mt-0"},ln={class:"text-right"},an={class:"font-semibold"},rn={key:0,class:"text-gray-500 block text-xs"},un={class:"flex gap-1.5"},dn=["onClick"],cn=["onClick"],pn=["onClick"],mn=["onClick"],vn={class:"mt-6 pt-4 border-t border-gray-200 flex flex-col items-start gap-2"},gn={class:"flex flex-wrap items-center gap-3"},fn={key:0,class:"text-sm text-red-600"},bn={class:"p-6 bg-white rounded-lg shadow-xl"},xn={class:"flex items-center justify-between mb-4"},yn={key:0,class:"text-gray-500 text-center py-4"},hn={key:1},wn={key:0,class:"text-gray-500 text-center py-4"},_n={key:1,class:"space-y-3 max-h-96 overflow-y-auto pr-2"},kn={class:"text-sm text-gray-600 flex justify-between items-center mb-1"},Cn={class:"font-medium"},$n={class:"text-xs text-gray-400"},Dn={class:"mt-1 text-gray-800 text-sm whitespace-pre-line"},Kn={__name:"Index",setup(k){const N=w([]),l=w(null),R=w(!1),o=w("active"),b=w([]),j=w(!1),$=w(!1),B=w(!1),h=w(!1),V=w(!1),T=w([]),E=w(!1),I=w(!1),q=w(null),r=w(null),M=w(!1),u=w(null),y=w(null),f=w(null),F=[{value:"PKR",label:"PKR"},{value:"AUD",label:"AUD"},{value:"INR",label:"INR"},{value:"USD",label:"USD"},{value:"EUR",label:"EUR"},{value:"GBP",label:"GBP"}],{canDo:S}=_t();S("manage_project_financial");const m=S("approve_milestone_expendables"),v=S("approve_expendables"),Y=S("approve_milestones"),d=At,D=w(null),L=w("PKR"),O=w([]),Qe=[{id:"active",label:"Active Milestones"},{id:"completed",label:"Completed"},{id:"approved",label:"Approved"}],We=C(()=>(b.value||[]).filter(s=>!!s.completion_date)),ae=C(()=>[...We.value].sort((s,t)=>{const x=new Date(s.completion_date),P=new Date(t.completion_date);return x-P})),$e=C(()=>(b.value||[]).length),et=C(()=>(b.value||[]).filter(s=>{const t=(s.status||"").toLowerCase();return t==="completed"||t==="approved"}).length);C(()=>$e.value?Math.round(et.value/$e.value*100):0);const De=C(()=>ae.value.length?new Date(ae.value[0].completion_date):null),je=C(()=>ae.value.length?new Date(ae.value[ae.value.length-1].completion_date):null);C(()=>{if(!De.value||!je.value)return 0;const s=ne=>new Date(ne.getFullYear(),ne.getMonth(),ne.getDate(),12,0,0),t=s(De.value),x=s(je.value),P=s(new Date),z=x-t;if(z<=0)return 100;let G=(P-t)/z*100;return G<0&&(G=0),G>100&&(G=100),Math.round(G)});const Me=C(()=>b.value?o.value==="active"?b.value.filter(s=>s.status.toLowerCase()==="in progress"||s.status.toLowerCase()==="not started"||s.status.toLowerCase()==="pending"):o.value==="completed"?b.value.filter(s=>s.status.toLowerCase()==="completed"):o.value==="approved"?b.value.filter(s=>s.status.toLowerCase()==="approved"):b.value:[]),tt=C(()=>!b.value||!pe.value||Object.keys(pe.value).length===0?0:b.value.reduce((s,t)=>t.status.toLowerCase()!=="approved"?s+(t.expendable||[]).filter(x=>x.status==="Accepted").reduce((x,P)=>x+Q(parseFloat(P.amount??0),P.currency,d.value),0):s,0)),st=C(()=>!b.value||!pe.value||Object.keys(pe.value).length===0?0:b.value.reduce((s,t)=>s+(t.expendable||[]).filter(x=>x.status==="Pending Approval").reduce((x,P)=>x+Q(parseFloat(P.amount??0),P.currency,d.value),0),0)),ot=C(()=>{if(D.value==null)return W(0,d.value);const s=Q(parseFloat(D.value??0),L.value,d.value),t=b.value.reduce((x,P)=>x+(P.expendable||[]).filter(z=>z.status==="Accepted").reduce((z,G)=>z+Q(parseFloat(G.amount??0),G.currency,d.value),0),0);return W(s-t,d.value)});C(()=>{var t;return((Array.isArray((t=O.value)==null?void 0:t.users)?O.value.users:O.value)||[]).map(x=>({value:x.id,label:x.name}))});const re=s=>{if(!s)return{};const t=s.budget?Q(Number(s.budget.amount||0),s.budget.currency,d.value):0,x=(s.expendable||[]).filter(P=>P.status==="Accepted").reduce((P,z)=>P+Q(Number(z.amount||0),z.currency,d.value),0);return{budgetAmt:t,approvedAmt:x,remaining:t-x}},Se=s=>s?s.budget!==null:null,nt=(s,t)=>{if(!(!s||!t)){if(!s.completion_date){u.value=s,y.value=t.id,M.value=!0;return}r.value=s,q.value=t.id,I.value=!0}},lt=s=>{try{if(s&&s.id){const x=(b.value||[]).findIndex(P=>P.id===s.id);x!==-1&&(b.value[x]={...b.value[x],...s})}}catch(x){console.error("Failed to merge updated milestone",x)}const t=(b.value||[]).find(x=>{var P;return x.id===((s==null?void 0:s.id)||((P=u.value)==null?void 0:P.id))});r.value=t||s||u.value,q.value=y.value,M.value=!1,I.value=!0,u.value=null,y.value=null},at=async()=>{try{const{data:s}=await window.axios.get("/api/projects-simplified");N.value=(s||[]).map(t=>({value:t.id,label:t.name}))}catch(s){console.error(s),H("Failed to load projects")}},de=async()=>{if(l.value){R.value=!0;try{const{data:s}=await window.axios.get(`/api/projects/${l.value}/milestones-with-expendables`);b.value=(s||[]).map(t=>({...t,_collapsed:!0}))}catch(s){console.error(s),H("Failed to load milestones")}finally{R.value=!1}}},rt=async s=>{if(!s||!s.id){H("Invalid milestone selected.");return}r.value=s,V.value=!0,h.value=!0;try{const{data:t}=await window.axios.get(`/api/milestones/${s.id}/reasons`);T.value=Array.isArray(t)?t:[]}catch(t){console.error(t),H("Failed to load reasons")}finally{V.value=!1}},it=async()=>{if(l.value)try{const{data:s}=await window.axios.get(`/api/projects/${l.value}/sections/users?type=users`);O.value=s||[]}catch(s){console.error(s),H("Failed to load users")}},Ae=async()=>{if(l.value)try{const{data:s}=await window.axios.get(`/api/projects/${l.value}/expendable-budget`);D.value=Number(s.total_expendable_amount||0),L.value=s.currency}catch(s){console.error(s)}},ge=async()=>{if(!l.value){b.value=[],D.value=0,L.value="PKR";return}await Promise.all([de(),it(),Ae()])},fe=()=>{jt("Operation successful!"),B.value=!1,r.value=null,f.value=null,de()},ut=s=>{if(!s||!s.id){H("Invalid milestone selected.");return}r.value=s,j.value=!0},dt=s=>{if(!s||!s.id){H("Invalid milestone selected.");return}r.value=s,$.value=!0},ct=()=>{B.value=!1,r.value=null,f.value=null},pt=async s=>{if(!s||!s.id){H("Invalid milestone.");return}await ce("Mark this milestone as complete?")&&(r.value={...s,action:"complete",apiEndpoint:`/api/milestones/${s.id}/complete`,httpMethod:"post"},B.value=!0)},mt=async s=>{if(!s||!s.id){H("Invalid milestone.");return}await ce("Approve this completed milestone?")&&(r.value={...s,action:"approve",apiEndpoint:`/api/milestones/${s.id}/approve`,httpMethod:"post"},B.value=!0)},vt=async s=>{if(!s||!s.id){H("Invalid milestone.");return}await ce("Reject this completed milestone?")&&(r.value={...s,action:"reject",apiEndpoint:`/api/milestones/${s.id}/reject`,httpMethod:"post"},B.value=!0)},gt=async s=>{if(!s||!s.id){H("Invalid contract.");return}f.value={...s,action:"accept",apiEndpoint:`/api/projects/${l.value}/expendables/${s.id}/accept`,httpMethod:"post"},B.value=!0},ft=async s=>{if(!s||!s.id){H("Invalid contract.");return}f.value={...s,action:"reject",apiEndpoint:`/api/projects/${l.value}/expendables/${s.id}/reject`,httpMethod:"post"},B.value=!0},bt=async s=>{if(!s||!s.id){H("Invalid contract.");return}f.value={...s,action:"delete",apiEndpoint:`/api/projects/${l.value}/expendables/${s.id}`,httpMethod:"delete"},B.value=!0},xt=async s=>{if(!s||!s.id){H("Invalid milestone.");return}await ce("Reopen this milestone to move it back to active?")&&(r.value={...s,action:"reopen",apiEndpoint:`/api/milestones/${s.id}/reopen`,httpMethod:"post"},B.value=!0)},Be=s=>{s._collapsed=!s._collapsed},be=s=>!s||!Array.isArray(s.expendable)?!1:s.expendable.some(t=>((t==null?void 0:t.status)||"Pending Approval")==="Pending Approval"),xe=s=>!!(s&&Array.isArray(s.expendable)&&s.expendable.length>0),ye=s=>{try{if(!s)return null;const t=new Date(s),x=new Date,P=new Date(t.getFullYear(),t.getMonth(),t.getDate(),12,0,0),z=new Date(x.getFullYear(),x.getMonth(),x.getDate(),12,0,0),G=1440*60*1e3;return Math.round((P-z)/G)}catch{return null}},yt=s=>{const t=ye(s);return t===null?"":t<0?`Overdue by ${Math.abs(t)} day${Math.abs(t)===1?"":"s"}`:t===0?"Due today":`${t} day${t===1?"":"s"} remaining`};return kt(async()=>{const s=localStorage.getItem("displayCurrency");s&&(d.value=s),await Bt(),await at(),l.value&&await ge()}),ue(d,async s=>{s&&(localStorage.setItem("displayCurrency",s),l.value&&await Promise.all([Ae(),de()]))}),(s,t)=>(n(),J(St,null,{header:K(()=>[e("div",qs,[t[12]||(t[12]=e("h2",{class:"font-semibold text-2xl text-gray-800"},"Project Financials",-1)),e("div",Os,[e("button",{onClick:ge,class:"p-2 rounded-full text-gray-500 hover:bg-gray-100 transition-colors",title:"Refresh"},[p(c(ke),{class:"h-5 w-5"})]),e("div",Hs,[p(me,{id:"project-select",modelValue:l.value,"onUpdate:modelValue":[t[0]||(t[0]=x=>l.value=x),ge],options:N.value,placeholder:"Select a project"},null,8,["modelValue","options"])]),e("div",Ks,[p(me,{id:"expendables-display-currency",modelValue:c(d),"onUpdate:modelValue":t[1]||(t[1]=x=>Dt(d)?d.value=x:null),options:F,placeholder:"Currency"},null,8,["modelValue"])])])])]),default:K(()=>{var x,P,z,G,ne,Pe,Te,Le,Ve,Re,Ne,Ie,Fe,Ue,Ee,qe,Oe,He;return[p(c(Ct),{title:"Project Financials Dashboard"}),e("div",Ys,[e("div",zs,[l.value?(n(),i("section",Zs,[e("div",Gs,[t[19]||(t[19]=e("h3",{class:"text-xl font-semibold text-gray-900 mb-4"},"Financial Summary",-1)),e("div",Xs,[e("div",Js,[e("div",null,[t[13]||(t[13]=e("div",{class:"text-sm font-medium text-green-700 mb-1"},"Approved Contracts",-1)),e("div",Qs,g(c(W)(tt.value,c(d))),1)]),t[14]||(t[14]=e("p",{class:"text-xs text-green-600 mt-2"},"Total value of all accepted contracts.",-1))]),e("div",Ws,[e("div",null,[t[15]||(t[15]=e("div",{class:"text-sm font-medium text-yellow-700 mb-1"},"Pending Approval",-1)),e("div",eo,g(c(W)(st.value,c(d))),1)]),t[16]||(t[16]=e("p",{class:"text-xs text-yellow-600 mt-2"},"Contracts awaiting review and approval.",-1))]),e("div",to,[e("div",null,[t[17]||(t[17]=e("div",{class:"text-sm font-medium text-blue-700 mb-1"},"Remaining Project Budget",-1)),e("div",so,g(ot.value),1)]),t[18]||(t[18]=e("p",{class:"text-xs text-blue-600 mt-2"},"Budget available for new expenditures.",-1))])]),p(Es,{milestones:b.value},null,8,["milestones"])])])):A("",!0),e("section",oo,[e("div",no,[e("div",lo,[t[20]||(t[20]=e("h3",{class:"text-xl font-semibold text-gray-900"},"Project Milestones",-1)),l.value?(n(),i("button",{key:0,onClick:t[2]||(t[2]=a=>E.value=!0),class:"p-1.5 rounded-full text-white bg-indigo-600 hover:bg-indigo-700 disabled:opacity-50",title:"Add Milestone"},[p(c(_e),{class:"h-4 w-4"})])):A("",!0)]),e("div",ao,[(n(),i(ee,null,oe(Qe,a=>e("button",{key:a.id,onClick:_=>o.value=a.id,class:Z(["py-2 px-4 rounded-full text-sm font-medium transition",o.value===a.id?"bg-indigo-600 text-white shadow":"bg-gray-100 text-gray-700 hover:bg-gray-200"])},g(a.label),11,ro)),64))])]),l.value?(n(),i("div",uo,[R.value?(n(),i("div",co,[p(c(ke),{class:"animate-spin h-8 w-8 mx-auto mb-2 text-indigo-500"}),t[22]||(t[22]=e("p",null,"Loading milestones...",-1))])):Me.value.length?(n(),i("div",mo,[(n(!0),i(ee,null,oe(Me.value,a=>(n(),i("div",{key:a.id,class:"border border-gray-200 rounded-xl bg-gray-50 shadow-sm transition-all duration-300 hover:shadow-lg"},[e("div",{class:"p-5 flex items-center justify-between cursor-pointer",onClick:_=>Be(a)},[e("div",go,[e("div",fo,g(a.name),1),a.description?(n(),i("div",bo,g(a.description),1)):A("",!0),e("div",xo,[a.completion_date?(n(),i("span",yo,[t[24]||(t[24]=U(" Due by: ",-1)),e("span",ho,g(new Date(a.completion_date).toLocaleDateString()),1)])):(n(),i("span",wo,"No completion date")),a.completion_date?(n(),i("span",{key:2,class:Z([ye(a.completion_date)<0?"text-red-600":ye(a.completion_date)===0?"text-orange-600":"text-green-600"])}," • "+g(yt(a.completion_date)),3)):A("",!0)])]),e("div",_o,[e("div",ko,[e("span",Co,[p(c(Ft),{class:"h-4 w-4 text-gray-500"}),t[25]||(t[25]=U(" Budget: ",-1)),e("span",$o,g(c(W)(re(a).budgetAmt,c(d))),1)]),e("span",Do,[p(c(ze),{class:"h-4 w-4 text-green-600"}),t[26]||(t[26]=U(" Approved: ",-1)),e("span",jo,g(c(W)(re(a).approvedAmt,c(d))),1)]),e("span",Mo,[p(c(ke),{class:"h-4 w-4 text-blue-600"}),t[27]||(t[27]=U(" Remaining: ",-1)),e("span",So,g(c(W)(re(a).remaining,c(d))),1)])]),o.value==="active"?(n(),i("button",{key:0,onClick:X(_=>dt(a),["stop"]),class:"p-2 rounded-full text-gray-500 hover:text-blue-500 hover:bg-gray-100 transition-colors"},[Se(a)?(n(),J(c(Tt),{key:0,class:"h-5 w-5"})):(n(),J(c(Vt),{key:1,class:"h-5 w-5"}))],8,Ao)):A("",!0),e("div",Bo,[e("button",{onClick:X(_=>rt(a),["stop"]),class:"p-2 rounded-full text-blue-600 hover:bg-blue-100 transition-colors",title:"View reasons"},[p(c(Nt),{class:"h-5 w-5"})],8,Po),e("button",{onClick:X(_=>Be(a),["stop"]),class:"p-2 transition-transform duration-300"},[p(c(Rt),{class:Z(["h-6 w-6 text-gray-500",a._collapsed?"":"rotate-180"])},null,8,["class"])],8,To)])])],8,vo),Xe(e("div",Lo,[e("div",Vo,[t[35]||(t[35]=e("h5",{class:"text-sm font-semibold text-gray-800 mb-2"},"Task Stats",-1)),e("div",Ro,[e("span",No,[t[28]||(t[28]=U(" Total ",-1)),e("span",Io,g(a.tasks_total_count||0),1)]),e("span",Fo,[t[29]||(t[29]=U(" To Do ",-1)),e("span",Uo,g(a.tasks_todo_count||0),1)]),e("span",Eo,[t[30]||(t[30]=U(" In Progress ",-1)),e("span",qo,g(a.tasks_in_progress_count||0),1)]),e("span",Oo,[t[31]||(t[31]=U(" Paused ",-1)),e("span",Ho,g(a.tasks_paused_count||0),1)]),e("span",Ko,[t[32]||(t[32]=U(" Blocked ",-1)),e("span",Yo,g(a.tasks_blocked_count||0),1)]),e("span",zo,[t[33]||(t[33]=U(" Done ",-1)),e("span",Zo,g(a.tasks_done_count||0),1)]),e("span",Go,[t[34]||(t[34]=U(" Archived ",-1)),e("span",Xo,g(a.tasks_archived_count||0),1)])])]),e("div",Jo,[t[37]||(t[37]=e("h4",{class:"text-lg font-semibold text-gray-800"},"Contracts",-1)),e("div",Qo,[o.value==="active"?(n(),J(ie,{key:0,onClick:X(_=>ut(a),["stop"]),class:"flex items-center gap-1"},{default:K(()=>[p(c(_e),{class:"h-4 w-4"}),t[36]||(t[36]=U(" Add Contract ",-1))]),_:2,__:[36]},1032,["onClick"])):A("",!0)])]),!a.expendable||!a.expendable.length?(n(),i("div",Wo,"No contracts found.")):(n(),i("ul",en,[(n(!0),i(ee,null,oe(a.expendable||[],_=>{var Ke,Ye;return n(),i("li",{key:_.id,class:"flex flex-col sm:flex-row items-start sm:items-center justify-between text-sm gap-2 p-3 rounded-lg bg-gray-100 shadow-sm"},[e("div",tn,[e("span",{class:Z(["inline-block text-xs px-2 py-0.5 rounded-full font-medium",{"bg-gray-200 text-gray-700":_.status==="Pending Approval","bg-green-200 text-green-700":_.status==="Accepted","bg-red-200 text-red-700":_.status==="Rejected"}])},g(_.status||"Pending Approval"),3),_.user&&_.user.name?(n(),i("span",sn,g(_.user.name),1)):A("",!0),e("span",on,g(_.name),1)]),e("div",nn,[e("div",ln,[e("span",an,g(c(W)(c(Q)(parseFloat(_.amount??0),_.currency||c(d),c(d)),c(d))),1),_.currency&&((Ke=_.currency)==null?void 0:Ke.toUpperCase())!==((Ye=c(d))==null?void 0:Ye.toUpperCase())?(n(),i("span",rn," ("+g(c(W)(parseFloat(_.amount??0),_.currency))+") ",1)):A("",!0)]),e("div",un,[_.status==="Accepted"?(n(),i("button",{key:0,onClick:X(he=>nt(a,_),["stop"]),class:"p-1 rounded-full text-indigo-600 hover:bg-indigo-200 transition-colors",title:"Add tasks"},[p(c(_e),{class:"h-5 w-5"})],8,dn)):A("",!0),_.status==="Pending Approval"&&o.value!=="approved"?(n(),i(ee,{key:1},[c(m)||c(v)?(n(),i("button",{key:0,onClick:X(he=>gt(_),["stop"]),class:"p-1 rounded-full text-green-600 hover:bg-green-200 transition-colors",title:"Approve"},[p(c(ze),{class:"h-5 w-5"})],8,cn)):A("",!0),c(m)||c(v)?(n(),i("button",{key:1,onClick:X(he=>ft(_),["stop"]),class:"p-1 rounded-full text-red-600 hover:bg-red-200 transition-colors",title:"Reject"},[p(c(Ut),{class:"h-5 w-5"})],8,pn)):A("",!0)],64)):A("",!0),_.status==="Rejected"&&o.value!=="approved"?(n(),i("button",{key:2,onClick:X(he=>bt(_),["stop"]),class:"p-1 rounded-full text-red-600 hover:bg-red-200 transition-colors",title:"Delete"},[p(c(It),{class:"h-5 w-5"})],8,mn)):A("",!0)])])])}),128))])),e("div",vn,[e("div",gn,[a.status.toLowerCase()!=="completed"&&o.value==="active"?(n(),J(ie,{key:0,onClick:X(_=>pt(a),["stop"]),disabled:be(a)&&xe(a),title:be(a)&&xe(a)?"Approve or reject all contracts before completing the milestone.":""},{default:K(()=>t[38]||(t[38]=[U(" Mark Complete ",-1)])),_:2,__:[38]},1032,["onClick","disabled","title"])):a.status.toLowerCase()==="completed"&&o.value==="completed"&&c(Y)?(n(),J(ie,{key:1,onClick:X(_=>mt(a),["stop"]),class:"bg-green-600 hover:bg-green-700"},{default:K(()=>t[39]||(t[39]=[U("Approve Milestone",-1)])),_:2,__:[39]},1032,["onClick"])):A("",!0),a.status.toLowerCase()==="completed"&&o.value==="completed"&&c(Y)?(n(),J(ie,{key:2,onClick:X(_=>vt(a),["stop"]),class:"bg-red-600 hover:bg-red-700"},{default:K(()=>t[40]||(t[40]=[U("Reject Milestone",-1)])),_:2,__:[40]},1032,["onClick"])):a.status.toLowerCase()==="approved"&&o.value==="approved"&&c(Y)?(n(),J(Je,{key:3,onClick:X(_=>xt(a),["stop"])},{default:K(()=>t[41]||(t[41]=[U("Reopen Milestone",-1)])),_:2,__:[41]},1032,["onClick"])):A("",!0)]),a.status.toLowerCase()!=="completed"&&o.value==="active"&&be(a)&&xe(a)?(n(),i("p",fn," You have pending contracts. Approve or reject each contract before marking this milestone complete. ")):A("",!0)])],512),[[$t,!a._collapsed]])]))),128))])):(n(),i("div",po,t[23]||(t[23]=[e("p",null,"No milestones found for this project in the selected tab.",-1)])))])):(n(),i("div",io,[p(c(Lt),{class:"h-12 w-12 mx-auto mb-2 text-gray-400"}),t[21]||(t[21]=e("p",{class:"text-lg"},"Please select a project to view its milestones.",-1))]))])])]),p(Ze,{show:j.value,title:"Add New Contract",milestone:r.value,users:O.value,"currency-options":F,"is-user-selection-required":!0,onClose:t[3]||(t[3]=a=>j.value=!1),onSubmitted:fe,"project-total-budget":D.value,"project-budget-currency":L.value,"milestone-stats":re(r.value)},null,8,["show","milestone","users","project-total-budget","project-budget-currency","milestone-stats"]),p(Ze,{show:$.value,title:Se(r.value)?"Update Milestone Budget":"Add Milestone Budget",milestone:r.value,users:O.value,"currency-options":F,"is-budget-form":!0,"is-user-selection-required":!1,onClose:t[4]||(t[4]=a=>$.value=!1),onSubmitted:fe,"project-total-budget":D.value,"project-budget-currency":L.value,"milestone-stats":re(r.value)},null,8,["show","title","milestone","users","project-total-budget","project-budget-currency","milestone-stats"]),p(Yt,{show:B.value,title:((x=r.value)==null?void 0:x.action)==="approve"?"Approve Milestone":((P=r.value)==null?void 0:P.action)==="reject"?"Reject Milestone":((z=r.value)==null?void 0:z.action)==="reopen"?"Reopen Milestone":r.value?"Provide Milestone Review":((G=f.value)==null?void 0:G.action)==="accept"?"Approve Contract":((ne=f.value)==null?void 0:ne.action)==="reject"?"Reject Contract":"Delete Contract",message:((Pe=r.value)==null?void 0:Pe.action)==="approve"?"Please provide a reason for approving this milestone (required):":((Te=r.value)==null?void 0:Te.action)==="reject"?"Please provide a reason for rejecting this milestone (required):":((Le=r.value)==null?void 0:Le.action)==="reopen"?"Please provide a reason for reopening this milestone (required):":r.value?"Please provide a review explaining why this milestone is complete (required):":((Ve=f.value)==null?void 0:Ve.action)==="accept"?"Please provide a reason for approval (required):":((Re=f.value)==null?void 0:Re.action)==="reject"?"Please provide a reason for rejection (required):":"Provide a reason for deleting this rejected expendable (required):",type:((Ne=r.value)==null?void 0:Ne.action)==="reject"||((Ie=r.value)==null?void 0:Ie.action)==="reopen"?"warning":"info","api-endpoint":r.value?r.value.apiEndpoint:(Fe=f.value)==null?void 0:Fe.apiEndpoint,"http-method":r.value?r.value.httpMethod:(Ue=f.value)==null?void 0:Ue.httpMethod,onClose:ct,onSubmitted:fe},null,8,["show","title","message","type","api-endpoint","http-method"]),p(Mt,{show:E.value,"project-id":Number(l.value),onClose:t[5]||(t[5]=a=>E.value=!1),onSaved:t[6]||(t[6]=()=>{E.value=!1,de()}),"contract-id":q.value},null,8,["show","project-id","contract-id"]),p(Pt,{show:h.value,onClose:t[8]||(t[8]=()=>{h.value=!1,r.value=null,T.value=[]})},{default:K(()=>[e("div",bn,[e("div",xn,[t[43]||(t[43]=e("h3",{class:"text-lg font-semibold"},"Milestone Reasons",-1)),e("button",{class:"text-gray-500 hover:text-gray-700",onClick:t[7]||(t[7]=()=>{h.value=!1,r.value=null,T.value=[]})},t[42]||(t[42]=[e("svg",{class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),V.value?(n(),i("div",yn,"Loading...")):(n(),i("div",hn,[T.value.length?(n(),i("ul",_n,[(n(!0),i(ee,null,oe(T.value,a=>(n(),i("li",{key:a.id,class:"p-4 rounded-lg bg-gray-50 shadow-sm border border-gray-200"},[e("div",kn,[e("span",Cn,g(a.creator_name||"Unknown"),1),e("span",$n,g(new Date(a.created_at).toLocaleString()),1)]),e("div",Dn,g(a.content),1)]))),128))])):(n(),i("div",wn,"No reasons found."))]))])]),_:1},8,["show"]),p(gs,{show:I.value,"contract-id":Number(q.value),"completion-date":(Ee=r.value)!=null&&Ee.completion_date?String(r.value.completion_date).split("T")[0]:null,onClose:t[9]||(t[9]=()=>{I.value=!1,q.value=null}),onTasksSubmitted:t[10]||(t[10]=()=>{I.value=!1,q.value=null})},null,8,["show","contract-id","completion-date"]),p(bs,{show:M.value,"milestone-id":Number(((qe=u.value)==null?void 0:qe.id)||((Oe=r.value)==null?void 0:Oe.id)),"initial-completion-date":(He=u.value)!=null&&He.completion_date?String(u.value.completion_date).split("T")[0]:null,onClose:t[11]||(t[11]=()=>{M.value=!1,u.value=null}),onUpdated:lt},null,8,["show","milestone-id","initial-completion-date"])]}),_:1}))}};export{Kn as default};
