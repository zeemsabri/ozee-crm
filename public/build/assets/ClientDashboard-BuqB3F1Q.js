import Q from"./BaseModal-DmG2nvXh.js";import W from"./LoadingOverlay-v6QLEy_s.js";import X from"./Sidebar-DV-bUeUI.js";import Y from"./HomeSection-C2al4rxD.js";import Z from"./TicketsSection-CymxWTAZ.js";import _ from"./ApprovalsSection-DgWqy53C.js";import ee from"./DocumentsSection-7U-_Yg9C.js";import te from"./InvoicesSection-BEgmCpOM.js";import oe from"./AnnouncementsSection-BOX1ofrF.js";import ae from"./DeliverableViewerModal-Cb9SGxF7.js";import ne from"./ResourceSection-C8lie5wN.js";import ie from"./SEOReport-BtwgA0xT.js";import{_ as le}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as a,c as se,f as re,P as U,a as z,o as s,d as w,i as r,b,t as ce,g as d,k as ue}from"./app-BIPU-Uat.js";import"./auto-BIBwKD9g.js";import"./chart-DUfl3Dpl.js";import"./TicketNotesSidebar-Cm7aZxHr.js";import"./CreateTaskModal-Bfzvulgn.js";const de={class:"bg-gray-100 flex min-h-screen font-sans"},ve={key:0,class:"fixed inset-0 bg-red-100 bg-opacity-90 flex items-center justify-center z-50 p-4"},pe={class:"bg-white p-8 rounded-lg shadow-xl text-red-700 max-w-lg w-full text-center"},me={class:"mb-6 whitespace-pre-line"},he={__name:"ClientDashboard",props:{initialAuthToken:{type:String,default:""},projectId:{type:[String,Number],required:!0}},setup(n){const i=n,k=a(!0),P=a("client-user"),l=a("home"),x=a(!1),$=a(null),S=a(!1),v=a(!1),E=a(""),B=a(""),M=a([]),I=a(null),y=a([]),m=a([]),V=a([]),h=a([]),j=a([]),N=a([]),f=a([]),D=a([]),A=a(0),c=a(null),T=a({}),q=se(()=>({marginLeft:x.value?"16rem":"4rem"})),L=o=>{$.value=o,S.value=!0},g=async(o,e)=>{try{const t=await fetch(`/api/client-api/${o}`,{headers:{Authorization:`Bearer ${i.initialAuthToken}`,"Content-Type":"application/json",Accept:"application/json"}});if(!t.ok){const C=await t.json();throw new Error(C.message||`Failed to fetch data from ${o}.`)}const u=await t.json();e.value=u}catch(t){console.error(`Error fetching from ${o}:`,t),c.value=c.value?c.value+`
${t.message}`:t.message}},F=(o,e,t,u=null,C=null)=>{E.value=o,B.value=e,I.value=C;const O=[];t==="alert"?O.push({label:"OK",className:"bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700",onClick:()=>v.value=!1}):t==="confirm"&&O.push({label:"Cancel",className:"bg-gray-300 text-gray-800 py-2 px-4 rounded-lg hover:bg-gray-400",onClick:()=>v.value=!1},{label:"Confirm",className:"bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700",onClick:()=>{u&&u(),v.value=!1}}),M.value=O,v.value=!0},H=()=>{v.value=!1,I.value=null},p=async o=>{console.log("Simulating adding activity:",o);const e={id:Date.now(),description:o,date:new Date().toISOString()};y.value.unshift(e),y.value=y.value.slice(0,10)},K=async o=>{m.value.unshift(o),m.value.sort((e,t)=>new Date(t.date).getTime()-new Date(e.date).getTime())},R=async(o,e)=>{const t=f.value.findIndex(u=>u.id===o);t!==-1&&(f.value[t].status=e)},G=async o=>{console.log("Simulating adding document:",o),h.value.unshift(o),h.value.sort((e,t)=>new Date(t.uploadDate).getTime()-new Date(e.uploadDate).getTime())},J=async(o,e)=>{console.log(`Simulating updating invoice ${o} to ${e}`);const t=j.value.findIndex(u=>u.id===o);t!==-1&&(j.value[t].status=e)};return re(async()=>{if(k.value=!0,c.value=null,!i.initialAuthToken||!i.projectId){c.value="Authentication token or Project ID missing. Cannot load dashboard.",k.value=!1;return}await Promise.all([g(`project/${i.projectId}/tasks`,m),g(`project/${i.projectId}/documents`,h),g(`project/${i.projectId}/deliverables`,f),g(`project/${i.projectId}/shareable-resources?visible_to_client=true`,D),g(`project/${i.projectId}`,T)]);try{const o=await fetch(`/api/client-api/projects/${i.projectId}/seo-reports/count`,{headers:{Authorization:`Bearer ${i.initialAuthToken}`,Accept:"application/json"}});if(o.ok){const e=await o.json();A.value=e.count||0}else console.error("Error fetching SEO reports count"),A.value=0}catch(o){console.error("Error fetching SEO reports count:",o),A.value=0}k.value=!1}),U("modalService",{showModal:F}),U("activityService",{addActivity:p}),(o,e)=>(s(),z("div",de,[w(W,{isLoading:k.value},null,8,["isLoading"]),c.value?(s(),z("div",ve,[b("div",pe,[e[4]||(e[4]=b("h3",{class:"text-2xl font-bold mb-4"},"Error Loading Dashboard",-1)),b("p",me,ce(c.value),1),b("button",{onClick:e[0]||(e[0]=t=>c.value=null),class:"bg-red-600 text-white py-2 px-4 rounded-lg hover:bg-red-700"},"Dismiss")])])):r("",!0),w(X,{userId:P.value,activeSection:l.value,isExpanded:x.value,onSectionChange:e[1]||(e[1]=t=>l.value=t),"onUpdate:isExpanded":e[2]||(e[2]=t=>x.value=t)},null,8,["userId","activeSection","isExpanded"]),b("div",{class:"flex-1 p-8 overflow-y-auto main-content",style:ue(q.value)},[l.value==="home"?(s(),d(Y,{key:0,activities:y.value,tickets:m.value,approvals:V.value,documents:h.value,invoices:j.value,announcements:N.value,deliverables:f.value,shareableResources:D.value,"seo-reports-count":A.value,onOpenDeliverableViewer:L,"project-data":T.value},null,8,["activities","tickets","approvals","documents","invoices","announcements","deliverables","shareableResources","seo-reports-count","project-data"])):r("",!0),l.value==="seo"?(s(),d(ie,{key:1,"project-id":n.projectId,"initial-auth-token":n.initialAuthToken},null,8,["project-id","initial-auth-token"])):r("",!0),l.value==="tickets"?(s(),d(Z,{key:2,"project-id":n.projectId,"initial-auth-token":n.initialAuthToken,tickets:m.value,onAddTicket:K,onAddActivity:p},null,8,["project-id","initial-auth-token","tickets"])):r("",!0),l.value==="approvals"?(s(),d(_,{key:3,onOpenDeliverableViewer:L,deliverables:f.value,"initial-auth-token":n.initialAuthToken,"project-id":n.projectId,approvals:V.value,onUpdateApproval:R,onAddActivity:p},null,8,["deliverables","initial-auth-token","project-id","approvals"])):r("",!0),l.value==="documents"?(s(),d(ee,{key:4,"project-data":T.value,"project-id":n.projectId,"initial-auth-token":n.initialAuthToken,documents:h.value,onAddDocument:G,onAddActivity:p},null,8,["project-data","project-id","initial-auth-token","documents"])):r("",!0),l.value==="resources"?(s(),d(ne,{key:5,"project-id":n.projectId,"initial-auth-token":n.initialAuthToken,"shareable-resources":D.value,onAddActivity:p},null,8,["project-id","initial-auth-token","shareable-resources"])):r("",!0),l.value==="invoices"?(s(),d(te,{key:6,invoices:j.value,onUpdateInvoice:J,onAddActivity:p},null,8,["invoices"])):r("",!0),l.value==="announcements"?(s(),d(oe,{key:7,announcements:N.value},null,8,["announcements"])):r("",!0)],4),w(Q,{isOpen:v.value,title:E.value,message:B.value,buttons:M.value,children:I.value,onClose:H},null,8,["isOpen","title","message","buttons","children"]),w(ae,{isOpen:S.value,"onUpdate:isOpen":e[3]||(e[3]=t=>S.value=t),deliverable:$.value,initialAuthToken:n.initialAuthToken,projectId:n.projectId,onDeliverableActionSuccess:R},null,8,["isOpen","deliverable","initialAuthToken","projectId"])]))}},Me=le(he,[["__scopeId","data-v-8e026a08"]]);export{Me as default};
