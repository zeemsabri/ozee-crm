import{a as s,o as r,b as i,c,i as u,g as y,av as R,t as w,d as n,u as h,j as F,s as O,r as A,z as Z,f as G,aM as W,e as q,h as J,w as x,ai as K,F as S,l as Q,m as B,p as U}from"./app-DISKht3j.js";import{R as X,_ as Y}from"./AuthenticatedLayout-CY7h59sL.js";import ee from"./EmailFilters-BJV76lUD.js";import te from"./EmailList-jvMZ4IHZ.js";import{_ as oe,f as ie,m as re}from"./EmailDetailsContent-CBu8NeC1.js";import se from"./ComposeEmailContent-BMTmblxT.js";import ae from"./CustomComposeEmailContent-55qhB54K.js";import ne from"./EmailActionContent-CMZ_q-gN.js";import le from"./ReceivedEmailActionContent-Dmx-71NV.js";import de from"./CustomEmailApprovalContent-CDxW_E_q.js";import{a as me,b as ce,r as ue}from"./XCircleIcon-DV4OyrqY.js";import{r as pe,b as fe}from"./NoticeboardModal-CHL0kfK7.js";import{r as ve,a as be}from"./PaperAirplaneIcon-PCQkgDZW.js";import{r as ge}from"./ListBulletIcon-Dt3wEMUw.js";import"./PrimaryButton-angFb9vz.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./Modal-CVZ63Sco.js";import"./InputLabel-Z506aO7S.js";import"./InputError-C6KY5JMQ.js";import"./SecondaryButton-CVp2-APy.js";import"./TextInput-pYzuy-6l.js";import"./SelectDropdown-BxQFBrAw.js";/* empty css                                                                       */import"./Checkbox-CwiUiVvH.js";import"./ApplicationLogo-DgH39U2z.js";import"./DangerButton-Bs-aL8KU.js";import"./moment-BLMuvzoS.js";import"./EmailAttachmentsList-BzUu_g_s.js";import"./TrashIcon-a0Pa8mjE.js";import"./TaskCreationForm-CfXAZ_t0.js";import"./CustomMultiSelect-DaxDtG2o.js";import"./EmailEditor-DuRc-lD-.js";import"./EmailEditor.vue_vue_type_style_index_0_lang-BfTJQqtk.js";import"./useEmailSignature-wgWI-PWG.js";import"./useEmailTemplate-BizVh9Gt.js";function he(l,e){return r(),s("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[i("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M10.5 6h9.75M10.5 6a1.5 1.5 0 1 1-3 0m3 0a1.5 1.5 0 1 0-3 0M3.75 6H7.5m3 12h9.75m-9.75 0a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m-3.75 0H7.5m9-6h3.75m-3.75 0a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m-9.75 0h9.75"})])}function we(l,e){return r(),s("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[i("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15.75 19.5 8.25 12l7.5-7.5"})])}function xe(l,e){return r(),s("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[i("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m8.25 4.5 7.5 7.5-7.5 7.5"})])}function ye(l,e){return r(),s("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[i("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"})])}function _e(l,e){return r(),s("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[i("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M11.48 3.499a.562.562 0 0 1 1.04 0l2.125 5.111a.563.563 0 0 0 .475.345l5.518.442c.499.04.701.663.321.988l-4.204 3.602a.563.563 0 0 0-.182.557l1.285 5.385a.562.562 0 0 1-.84.61l-4.725-2.885a.562.562 0 0 0-.586 0L6.982 20.54a.562.562 0 0 1-.84-.61l1.285-5.386a.562.562 0 0 0-.182-.557l-4.204-3.602a.562.562 0 0 1 .321-.988l5.518-.442a.563.563 0 0 0 .475-.345L11.48 3.5Z"})])}const ke={class:"flex items-center"},Ee={class:"flex-1"},Ce={key:0,class:"font-bold"},$e={class:"text-sm"},je={__name:"Notification",props:{notification:Object},emits:["close"],setup(l,{emit:e}){const m=l,p=c(()=>{var d;switch((d=m.notification)==null?void 0:d.type){case"success":return"bg-green-100 text-green-700 border-green-200";case"error":return"bg-red-100 text-red-700 border-red-200";case"warning":return"bg-yellow-100 text-yellow-700 border-yellow-200";default:return"bg-gray-100 text-gray-700 border-gray-200"}}),f=c(()=>{var d;switch((d=m.notification)==null?void 0:d.type){case"success":return ue;case"error":return ce;case"warning":return pe;default:return me}});return(g,d)=>l.notification&&l.notification.message?(r(),s("div",{key:0,class:F(["fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 mx-auto mt-4 max-w-sm rounded-md border p-4 shadow-lg transition-all duration-300 ease-out z-[9999]",p.value]),role:"alert","aria-live":"polite"},[i("div",ke,[(r(),y(R(f.value),{class:"h-6 w-6 mr-3 flex-shrink-0"})),i("div",Ee,[l.notification.title?(r(),s("h4",Ce,w(l.notification.title),1)):u("",!0),i("p",$e,w(l.notification.message),1)]),i("button",{onClick:d[0]||(d[0]=E=>g.$emit("close")),class:"ml-auto -mr-1.5 p-1 rounded-md hover:bg-opacity-50","aria-label":"Close notification"},[n(h(fe),{class:"h-5 w-5"})])])],2)):u("",!0)}},Ae={class:"flex justify-between items-center"},Se={class:"flex items-center gap-2"},Be={class:"py-12"},Re={class:"max-w-8xl mx-auto sm:px-6 lg:px-8 h-[calc(100vh-200px)]"},Fe={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg h-full flex"},Me={key:0,class:"w-64 p-4 border-r border-gray-200 overflow-y-auto transform"},De={class:"flex-1 overflow-y-auto"},Ne={class:"flex items-center justify-start p-6 space-x-4"},Ie=["onClick"],Pe={key:0,class:"ml-2 px-2 py-0.5 text-xs font-semibold rounded-full bg-white text-gray-800"},He={class:"hidden sm:inline"},Te={class:"p-6"},Ve={key:0},ze={key:1},Le={key:2},Oe={key:3},Ze={key:4},Ge={key:5},jt={__name:"Index",setup(l){const e=O({sidebar:{show:!1,title:"",mode:null,loading:!1,data:null},filters:{type:"new",status:"",startDate:"",endDate:"",search:"",projectId:null,senderId:""},emails:[],loadingEmails:!1,emailError:null,pagination:{},counts:{new:0,"waiting-approval":0,sent:0,received:0,all:0}}),m=A(!1),p=A(null),{canDo:f}=Z();c(()=>f("view_emails").value),c(()=>f("approve_emails").value);const g=c(()=>f("compose_emails").value),d=c(()=>f("create_custom_emails").value),E=c(()=>[{type:"new",label:"New Emails",icon:_e},{type:"waiting-approval",label:"Waiting Approval",icon:ye},{type:"sent",label:"Sent",icon:ve},{type:"received",label:"Received",icon:be},{type:"all",label:"All Emails",icon:ge}]),M=c(()=>{var t;return e.sidebar.mode==="view-email"?((t=e.sidebar.data)==null?void 0:t.subject)||"Email Details":e.sidebar.mode==="compose"?"Compose New Email":e.sidebar.mode==="edit"?"Edit & Approve Template Email":e.sidebar.mode==="custom-edit"?"Edit & Approve Custom Email":e.sidebar.mode==="reject"?"Reject Email":e.sidebar.mode==="received-edit"?"Approve Received Email":"Inbox"}),_=async()=>{try{const t=await U.get("/api/inbox/counts");e.counts={...e.counts,"waiting-approval":t.data["waiting-approval"],received:t.data.received}}catch(t){console.error("Failed to fetch email counts:",t)}},D=()=>{e.sidebar.show=!0,e.sidebar.title="Compose New Email",e.sidebar.mode="compose",e.sidebar.data=null},N=async()=>{e.sidebar.show=!0,e.sidebar.title="Compose Custom Email",e.sidebar.mode="custom-compose",e.sidebar.data=null},I=async t=>{e.sidebar.loading=!0,e.sidebar.show=!0,e.sidebar.title="Email Details",e.sidebar.mode="view-email",e.sidebar.data=t;try{await re(t.id)}catch(o){console.error("Failed to mark email as read:",o)}finally{e.sidebar.loading=!1,v(),_()}},v=async(t=1)=>{e.loadingEmails=!0,e.emailError=null;try{const o=await ie(e.filters,t);e.emails=o.data,e.pagination={currentPage:o.current_page,lastPage:o.last_page,total:o.total},e.counts[e.filters.type]=o.total}catch(o){console.error("Error fetching emails:",o),e.emailError="Failed to load emails. Please try again."}finally{e.loadingEmails=!1}},P=t=>{v(t)},H=t=>{Object.assign(e.filters,t)},T=t=>{e.filters.type=t,t==="all"&&(e.filters.status="",e.filters.startDate="",e.filters.endDate="",e.filters.search="",e.filters.projectId=null,e.filters.senderId=""),t!=="waiting-approval"&&t!=="received"&&(e.counts[t]=0)},V=t=>{p.value=t,setTimeout(()=>{p.value=null},5e3)};G(()=>{W().fetchGlobalPermissions(),_()});const z=t=>{e.sidebar.show=!0,e.sidebar.data=t,t.type==="received"&&(t.status==="pending_approval_received"||t.status==="received")?(e.sidebar.mode="received-edit",e.sidebar.title="Approve Received Email"):t.template_id?(e.sidebar.mode="edit",e.sidebar.title="Edit & Approve Template Email"):(e.sidebar.mode="custom-edit",e.sidebar.title="Edit & Approve Custom Email")},L=t=>{e.sidebar.show=!0,e.sidebar.title="Reject Email",e.sidebar.mode="reject",e.sidebar.data=t},b=()=>{e.sidebar.show=!1,v(),_()};let C=null;return q(()=>e.filters,()=>{clearTimeout(C),C=setTimeout(()=>{v(1)},500)},{deep:!0,immediate:!0}),(t,o)=>(r(),s(S,null,[n(h(J),{title:"Inbox"}),n(Y,null,{header:x(()=>[i("div",Ae,[o[8]||(o[8]=i("h2",{class:"font-semibold text-xl text-gray-800 leading-tight"}," Inbox ",-1)),i("div",Se,[g.value?(r(),s("button",{key:0,onClick:D,class:"inline-flex items-center px-4 py-2 bg-indigo-600 border border-transparent rounded-md font-semibold text-xs text-white uppercase tracking-widest hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-25 transition"},o[6]||(o[6]=[i("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[i("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})],-1),B(" Compose Email ",-1)]))):u("",!0),d.value?(r(),s("button",{key:1,onClick:N,class:"inline-flex items-center px-4 py-2 bg-emerald-600 border border-transparent rounded-md font-semibold text-xs text-white uppercase tracking-widest hover:bg-emerald-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-emerald-500 disabled:opacity-25 transition"},o[7]||(o[7]=[i("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[i("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})],-1),B(" Custom Emails ",-1)]))):u("",!0)])])]),default:x(()=>[i("div",Be,[i("div",Re,[i("div",Fe,[n(K,{"enter-active-class":"transition-all duration-300 ease-out","leave-active-class":"transition-all duration-300 ease-in","enter-from-class":"-translate-x-full opacity-0","leave-to-class":"-translate-x-full opacity-0"},{default:x(()=>[m.value?(r(),s("div",Me,[o[9]||(o[9]=i("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"Advanced Filters",-1)),n(ee,{"initial-filters":e.filters,onChange:H},null,8,["initial-filters"])])):u("",!0)]),_:1}),i("div",De,[i("div",Ne,[(r(!0),s(S,null,Q(E.value,a=>(r(),s("button",{key:a.type,onClick:k=>T(a.type),class:F({"px-4 py-2 rounded-md font-medium text-sm transition-colors flex items-center space-x-2":!0,"text-white bg-indigo-600 hover:bg-indigo-700":e.filters.type===a.type,"text-gray-700 bg-white border border-gray-300 hover:bg-gray-100":e.filters.type!==a.type})},[(r(),y(R(a.icon),{class:"h-5 w-5"})),i("span",null,w(a.label),1),e.counts[a.type]>0?(r(),s("span",Pe,w(e.counts[a.type]),1)):u("",!0)],10,Ie))),128)),i("button",{onClick:o[0]||(o[0]=a=>m.value=!m.value),class:"px-4 py-2 rounded-md font-medium text-sm text-gray-700 bg-white border border-gray-300 hover:bg-gray-100 transition-colors flex items-center space-x-2"},[n(h(he),{class:"h-5 w-5"}),i("span",He,w(m.value?"Hide Filters":"Show Filters"),1),m.value?(r(),y(h(we),{key:1,class:"h-4 w-4"})):(r(),y(h(xe),{key:0,class:"h-4 w-4"}))]),i("button",{onClick:o[1]||(o[1]=a=>v(1)),class:"px-4 py-2 rounded-md font-medium text-sm text-gray-700 bg-white border border-gray-300 hover:bg-gray-100 transition-colors flex items-center space-x-2"},o[10]||(o[10]=[i("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[i("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1),i("span",{class:"hidden sm:inline"},"Refresh",-1)]))]),i("div",Te,[n(te,{emails:e.emails,loading:e.loadingEmails,error:e.emailError,pagination:e.pagination,onViewEmail:I,onChangePage:P,onRefresh:v,onShowNotification:V},null,8,["emails","loading","error","pagination"])])]),n(X,{show:e.sidebar.show,title:M.value,onClose:o[4]||(o[4]=a=>e.sidebar.show=!1),loading:e.sidebar.loading},{content:x(()=>{var a,k,$,j;return[e.sidebar.mode==="view-email"?(r(),s("div",Ve,[n(oe,{email:e.sidebar.data,"can-approve-emails":(a=e.sidebar.data)==null?void 0:a.can_approve,onEdit:z,onReject:L,onDeleted:b},null,8,["email","can-approve-emails"])])):e.sidebar.mode==="compose"?(r(),s("div",ze,[n(se,{"project-id":(j=($=(k=e.sidebar.data)==null?void 0:k.conversation)==null?void 0:$.project)==null?void 0:j.id,onSubmitted:b},null,8,["project-id"])])):e.sidebar.mode==="edit"||e.sidebar.mode==="reject"?(r(),s("div",Le,[n(ne,{email:e.sidebar.data,mode:e.sidebar.mode,onSubmitted:b},null,8,["email","mode"])])):e.sidebar.mode==="received-edit"?(r(),s("div",Oe,[n(le,{email:e.sidebar.data,onSubmitted:b,onError:o[2]||(o[2]=()=>console.log("Error from received-edit"))},null,8,["email"])])):e.sidebar.mode==="custom-edit"?(r(),s("div",Ze,[n(de,{email:e.sidebar.data,onSubmitted:b,onError:()=>{}},null,8,["email"])])):e.sidebar.mode==="custom-compose"?(r(),s("div",Ge,[n(ae,{"project-id":null,"user-project-role":{},onSubmitted:o[3]||(o[3]=()=>{b()}),onError:()=>{}})])):u("",!0)]}),_:1},8,["show","title","loading"])])])]),n(je,{notification:p.value,onClose:o[5]||(o[5]=a=>p.value=null)},null,8,["notification"])]),_:1})],64))}};export{jt as default};
