import{r as d,c as x,q as Z,f as ee,aK as te,a,o as r,d as i,u as V,h as se,w as f,b as t,m as p,t as u,j as B,y as L,F as N,l as oe,x as U,i as b,g as le,G as z,I as S,N as D}from"./app-BiOytpE3.js";import{_ as re}from"./AuthenticatedLayout-DNresLjS.js";import{D as ae}from"./DangerButton-BCGhqPOm.js";import{_ as H}from"./SecondaryButton-D5M_Erpa.js";import{_ as ie}from"./Modal-D1Igk1ma.js";import{_ as P}from"./InputLabel-qmyj_yOj.js";import{_ as ne}from"./TextInput-IXbIsRwW.js";import{S as $}from"./SelectDropdown-CyyaWJSZ.js";import"./PrimaryButton-dYCZ56-l.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./InputError-BmEkisOc.js";import"./Checkbox-DJCaPpRb.js";import"./ApplicationLogo-BAphCQ3T.js";import"./moment-BLMuvzoS.js";const de={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between py-4"},ue={key:0},ce={class:"py-6"},ve={class:"max-w-12xl mx-auto sm:px-6 lg:px-12"},pe={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg p-6"},me={key:0,class:"text-center py-4 text-gray-500 text-lg"},fe={key:1,class:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-md relative mb-4",role:"alert"},ge={class:"block sm:inline"},xe={key:2},be={class:"mb-6 border-b border-gray-200"},he={class:"flex flex-wrap -mb-px text-sm font-medium text-center"},we={class:"mr-2"},ye={class:"mr-2"},_e={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8"},ke={class:"bg-blue-50 p-6 rounded-lg shadow-sm border border-blue-200 flex items-center justify-between"},Ce={class:"text-3xl font-bold text-blue-900 mt-1"},je={class:"bg-green-50 p-6 rounded-lg shadow-sm border border-green-200 flex items-center justify-between"},Pe={class:"text-3xl font-bold text-green-900 mt-1"},Ae={class:"bg-yellow-50 p-6 rounded-lg shadow-sm border border-yellow-200 flex items-center justify-between"},Ve={class:"text-3xl font-bold text-yellow-900 mt-1"},Se={class:"bg-purple-50 p-6 rounded-lg shadow-sm border border-purple-200 flex items-center justify-between"},$e={class:"text-3xl font-bold text-purple-900 mt-1"},Ee={class:"mb-8 p-4 bg-gray-50 rounded-lg shadow-inner border border-gray-200"},Me={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"},Be={class:"mt-4 flex justify-end"},Ue={key:0,class:"p-6 bg-gray-50 rounded-lg text-gray-600 text-center border border-gray-200 shadow-sm"},De={key:1,class:"overflow-x-auto rounded-lg border border-gray-200 shadow-sm"},Fe={class:"min-w-full divide-y divide-gray-200"},Le={class:"bg-white divide-y divide-gray-200"},Ne={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},ze={class:"px-6 py-4 text-sm text-gray-600"},He={key:0},qe={key:1,class:"text-gray-400"},Oe={class:"px-6 py-4 whitespace-nowrap"},Te={class:"px-6 py-4 text-sm text-gray-600"},Ie={key:0},Ye={key:1,class:"text-gray-400"},Qe={class:"px-6 py-4 whitespace-nowrap text-sm font-medium"},Re={class:"flex items-center space-x-2"},Ge=["onClick"],Ke=["onClick"],Je={class:"p-6"},We={key:0,class:"mt-4 text-gray-800"},Xe={key:0},Ze={key:1,class:"text-red-600 text-sm mb-4"},et={class:"mt-6 flex justify-end"},gt={__name:"Index",setup(tt){const v=d([]),E=d(!0),n=d(""),m=d("active"),h=d(""),w=d(""),y=d(""),_=d(""),k=d(""),q=d([{value:"",label:"All Statuses"},{value:"active",label:"Active"},{value:"completed",label:"Completed"},{value:"paid",label:"Paid"},{value:"on-hold",label:"On Hold"},{value:"archived",label:"Archived"}]),O=x(()=>{const s=new Map;return v.value.forEach(e=>{var l;(l=e.clients)==null||l.forEach(o=>{s.has(o.id)||s.set(o.id,{value:o.id,label:o.name})})}),[{value:"",label:"All Clients"},...Array.from(s.values())]}),T=x(()=>{const s=new Map;return v.value.forEach(e=>{var l;(l=e.users)==null||l.forEach(o=>{s.has(o.id)||s.set(o.id,{value:o.id,label:o.name})})}),[{value:"",label:"All Users"},...Array.from(s.values())]}),I=x(()=>{const s=new Set;return v.value.forEach(e=>{e.source&&!s.has(e.source)&&s.add(e.source)}),[{value:"",label:"All Sources"},...Array.from(s).map(e=>({value:e,label:e}))]}),A=d(!1),g=d(null),{canDo:C,canView:Y}=Z(),Q=C("create_projects"),R=x(()=>Y("projects").value);C("manage_projects");const M=async()=>{E.value=!0,n.value="";try{const s=await window.axios.get("/api/projects?with_trashed=true");v.value=s.data}catch(s){n.value="Failed to load projects.",console.error("Error fetching initial data:",s),s.response&&(s.response.status===401||s.response.status===403)&&(n.value="You are not authorized to view this content or your session expired. Please log in.")}finally{E.value=!1}},F=x(()=>{let s=v.value;if(m.value==="active"?s=s.filter(e=>e.deleted_at===null):m.value==="archived"&&(s=s.filter(e=>e.deleted_at!==null)),h.value){const e=h.value.toLowerCase();s=s.filter(l=>l.name.toLowerCase().includes(e)||l.description&&l.description.toLowerCase().includes(e)||l.status&&l.status.toLowerCase().includes(e.replace(/_|-/g," "))||l.clients&&l.clients.some(o=>o.name.toLowerCase().includes(e))||l.users&&l.users.some(o=>o.name.toLowerCase().includes(e))||l.source&&l.source.toLowerCase().includes(e))}return w.value&&(s=s.filter(e=>e.status===w.value)),y.value&&(s=s.filter(e=>e.clients&&e.clients.some(l=>l.id===y.value))),_.value&&(s=s.filter(e=>e.users&&e.users.some(l=>l.id===_.value))),k.value&&(s=s.filter(e=>e.source===k.value)),s}),j=x(()=>{const s={total:v.value.length,active:0,completed:0,onHold:0,paid:0,archived:0};return v.value.forEach(e=>{e.status==="active"&&s.active++,e.status==="completed"&&s.completed++,(e.status==="on-hold"||e.status==="on_hold")&&s.onHold++,e.status==="paid"&&s.paid++,e.status==="archived"&&s.archived++}),s}),G=s=>{switch(s){case"active":return"bg-green-100 text-green-800";case"completed":return"bg-blue-100 text-blue-800";case"paid":return"bg-purple-100 text-purple-800";case"on-hold":case"on_hold":return"bg-red-100 text-red-800";case"archived":return"bg-gray-100 text-gray-800";default:return"bg-gray-100 text-gray-800"}},K=async s=>{var e,l;if(!C("delete_projects").value){S("You do not have permission to archive this project.");return}try{await window.axios.post(`/api/projects/${s.id}/archive`),await M(),D("Project archived successfully!")}catch(o){n.value=((l=(e=o.response)==null?void 0:e.data)==null?void 0:l.message)||"Failed to archive project.",console.error("Error archiving project:",o),S("Failed to archive project.")}},J=async s=>{var e,l;if(!C("delete_projects").value){S("You do not have permission to restore this project.");return}try{await window.axios.post(`/api/projects/${s.id}/restore`),await M(),D("Project restored successfully!")}catch(o){n.value=((l=(e=o.response)==null?void 0:e.data)==null?void 0:l.message)||"Failed to restore project.",console.error("Error restoring project:",o),S("Failed to restore project.")}},W=async()=>{var e,l,o;n.value="";const s=(e=g.value)==null?void 0:e.id;if(!s){n.value="Invalid project.";return}if(!C("delete_projects").value){n.value="You do not have permission to delete this project.";return}try{await window.axios.delete(`/api/projects/${s}`),v.value=v.value.filter(c=>c.id!==s),A.value=!1,g.value=null,D("Project deleted successfully!")}catch(c){n.value=((o=(l=c.response)==null?void 0:l.data)==null?void 0:o.message)||"Failed to delete project.",console.error("Error deleting project:",c)}},X=()=>{h.value="",w.value="",y.value="",_.value="",k.value=""};return ee(()=>{if(!R.value){window.location.href=route("dashboard");return}M()}),(s,e)=>{const l=te("permission");return r(),a(N,null,[i(V(se),{title:"Projects"}),i(re,null,{header:f(()=>[t("div",de,[e[10]||(e[10]=t("h2",{class:"font-bold text-3xl text-gray-800 leading-tight mb-2 sm:mb-0"}," Project Management ",-1)),V(Q)?(r(),a("div",ue,[i(V(z),{href:s.route("projects.create"),class:"inline-flex items-center px-4 py-2 bg-indigo-600 border border-transparent rounded-md font-semibold text-xs text-white uppercase tracking-widest hover:bg-indigo-700 active:bg-indigo-900 focus:outline-none focus:border-indigo-900 focus:ring ring-indigo-300 disabled:opacity-25 transition ease-in-out duration-150 shadow-md"},{default:f(()=>e[9]||(e[9]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 4v16m8-8H4"})],-1),p(" Create New Project ",-1)])),_:1,__:[9]},8,["href"])])):b("",!0)])]),default:f(()=>[t("div",ce,[t("div",ve,[t("div",pe,[E.value?(r(),a("div",me,e[11]||(e[11]=[t("svg",{class:"animate-spin h-8 w-8 text-indigo-500 mx-auto mb-3",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),p(" Loading projects and data... ",-1)]))):n.value?(r(),a("div",fe,[t("span",ge,u(n.value),1)])):(r(),a("div",xe,[t("div",be,[t("ul",he,[t("li",we,[t("a",{href:"#",onClick:e[0]||(e[0]=L(o=>m.value="active",["prevent"])),class:B(["inline-block p-4 rounded-t-lg border-b-2",m.value==="active"?"text-blue-600 border-blue-600 active":"border-transparent hover:text-gray-600 hover:border-gray-300"])}," Active Projects ",2)]),t("li",ye,[t("a",{href:"#",onClick:e[1]||(e[1]=L(o=>m.value="archived",["prevent"])),class:B(["inline-block p-4 rounded-t-lg border-b-2",m.value==="archived"?"text-blue-600 border-blue-600 active":"border-transparent hover:text-gray-600 hover:border-gray-300"])}," Archived Projects ",2)])])]),t("div",_e,[t("div",ke,[t("div",null,[e[12]||(e[12]=t("p",{class:"text-sm font-medium text-blue-700"},"Total Projects",-1)),t("p",Ce,u(j.value.total),1)]),e[13]||(e[13]=t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-10 w-10 text-blue-400 opacity-70",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9 17V7m-4 10h8a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})],-1))]),t("div",je,[t("div",null,[e[14]||(e[14]=t("p",{class:"text-sm font-medium text-green-700"},"Active Projects",-1)),t("p",Pe,u(j.value.active),1)]),e[15]||(e[15]=t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-10 w-10 text-green-400 opacity-70",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M5 13l4 4L19 7"})],-1))]),t("div",Ae,[t("div",null,[e[16]||(e[16]=t("p",{class:"text-sm font-medium text-yellow-700"},"On-Hold Projects",-1)),t("p",Ve,u(j.value.onHold),1)]),e[17]||(e[17]=t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-10 w-10 text-yellow-400 opacity-70",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1))]),t("div",Se,[t("div",null,[e[18]||(e[18]=t("p",{class:"text-sm font-medium text-purple-700"},"Completed/Paid",-1)),t("p",$e,u(j.value.completed+j.value.paid),1)]),e[19]||(e[19]=t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-10 w-10 text-purple-400 opacity-70",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1))])]),t("div",Ee,[e[21]||(e[21]=t("h4",{class:"text-lg font-semibold text-gray-700 mb-4"},"Filter Projects",-1)),t("div",Me,[t("div",null,[i(P,{for:"search-query",value:"Search",class:"mb-1"}),i(ne,{id:"search-query",type:"text",modelValue:h.value,"onUpdate:modelValue":e[2]||(e[2]=o=>h.value=o),placeholder:"Search by name, client, user...",class:"w-full"},null,8,["modelValue"])]),t("div",null,[i(P,{for:"filter-status",value:"Status",class:"mb-1"}),i($,{id:"filter-status",modelValue:w.value,"onUpdate:modelValue":e[3]||(e[3]=o=>w.value=o),options:q.value,"value-key":"value","label-key":"label",placeholder:"All Statuses",class:"w-full"},null,8,["modelValue","options"])]),t("div",null,[i(P,{for:"filter-client",value:"Client",class:"mb-1"}),i($,{id:"filter-client",modelValue:y.value,"onUpdate:modelValue":e[4]||(e[4]=o=>y.value=o),options:O.value,"value-key":"value","label-key":"label",placeholder:"All Clients",class:"w-full"},null,8,["modelValue","options"])]),t("div",null,[i(P,{for:"filter-user",value:"Assigned User",class:"mb-1"}),i($,{id:"filter-user",modelValue:_.value,"onUpdate:modelValue":e[5]||(e[5]=o=>_.value=o),options:T.value,"value-key":"value","label-key":"label",placeholder:"All Users",class:"w-full"},null,8,["modelValue","options"])]),t("div",null,[i(P,{for:"filter-source",value:"Source",class:"mb-1"}),i($,{id:"filter-source",modelValue:k.value,"onUpdate:modelValue":e[6]||(e[6]=o=>k.value=o),options:I.value,"value-key":"value","label-key":"label",placeholder:"All Sources",class:"w-full"},null,8,["modelValue","options"])])]),t("div",Be,[i(H,{onClick:X,class:"px-4 py-2"},{default:f(()=>e[20]||(e[20]=[p("Clear Filters",-1)])),_:1,__:[20]})])]),F.value.length===0?(r(),a("div",Ue," No projects found matching your criteria. ")):(r(),a("div",De,[t("table",Fe,[e[25]||(e[25]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Project Name"),t("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Clients"),t("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Status"),t("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Assigned Users"),t("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Actions")])],-1)),t("tbody",Le,[(r(!0),a(N,null,oe(F.value,o=>(r(),a("tr",{key:o.id},[t("td",Ne,u(o.name),1),t("td",ze,[o.clients&&o.clients.length?(r(),a("span",He,u(o.clients.map(c=>c.name).join(", ")),1)):(r(),a("span",qe,"None"))]),t("td",Oe,[t("span",{class:B(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full capitalize",G(o.status)])},u(o.status.replace("_"," ")),3)]),t("td",Te,[o.users&&o.users.length?(r(),a("span",Ie,u(o.users.map(c=>c.name).join(", ")),1)):(r(),a("span",Ye,"None"))]),t("td",Qe,[t("div",Re,[U((r(),le(V(z),{href:s.route("projects.edit",o.id),class:"inline-flex items-center px-3 py-1 border border-transparent text-xs leading-4 font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:border-indigo-700 focus:ring active:bg-indigo-700 transition ease-in-out duration-150"},{default:f(()=>e[22]||(e[22]=[p("Edit",-1)])),_:2,__:[22]},1032,["href"])),[[l,"manage_projects"]]),m.value==="active"?U((r(),a("button",{key:0,onClick:c=>K(o),class:"inline-flex items-center px-3 py-1 border border-transparent text-xs leading-4 font-medium rounded-md text-white bg-gray-600 hover:bg-gray-700 focus:outline-none focus:border-gray-700 focus:ring active:bg-gray-700 transition ease-in-out duration-150"},e[23]||(e[23]=[p(" Archive ",-1)]),8,Ge)),[[l,"delete_projects"]]):b("",!0),m.value==="archived"?U((r(),a("button",{key:1,onClick:c=>J(o),class:"inline-flex items-center px-3 py-1 border border-transparent text-xs leading-4 font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:border-green-700 focus:ring active:bg-green-700 transition ease-in-out duration-150"},e[24]||(e[24]=[p(" Restore ",-1)]),8,Ke)),[[l,"delete_projects"]]):b("",!0)])])]))),128))])])]))]))])])]),i(ie,{show:A.value,onClose:e[8]||(e[8]=o=>A.value=!1)},{default:f(()=>[t("div",Je,[e[29]||(e[29]=t("h2",{class:"text-lg font-medium text-gray-900"}," Are you sure you want to delete this project? ",-1)),e[30]||(e[30]=t("p",{class:"mt-1 text-sm text-gray-600"}," This action cannot be undone. All associated conversations and emails will also be deleted. ",-1)),g.value?(r(),a("div",We,[e[26]||(e[26]=t("strong",null,"Project:",-1)),p(" "+u(g.value.name)+" ",1),g.value.clients&&g.value.clients.length?(r(),a("span",Xe," (Clients: "+u(g.value.clients.map(o=>o.name).join(", "))+") ",1)):b("",!0)])):b("",!0),n.value?(r(),a("div",Ze,u(n.value),1)):b("",!0),t("div",et,[i(H,{onClick:e[7]||(e[7]=o=>A.value=!1)},{default:f(()=>e[27]||(e[27]=[p("Cancel",-1)])),_:1,__:[27]}),i(ae,{class:"ms-3",onClick:W},{default:f(()=>e[28]||(e[28]=[p("Delete Project",-1)])),_:1,__:[28]})])])]),_:1},8,["show"])]),_:1})],64)}}};export{gt as default};
