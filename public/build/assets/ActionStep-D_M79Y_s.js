import{u as ve}from"./workflowStore-Bea4wnAA.js";import be from"./StepCard-C9Wo82Q9.js";import g from"./DataTokenInserter-12kVosS6.js";import{S as z}from"./SelectDropdown-Tj0LL-lv.js";import{d as _,r as Q,w as F,b as ye,q as X,o as n,g as fe,a as l,c as u,m,F as v,k as w,t as f,f as c,u as D,j as h,n as ge,s as xe}from"./app-D7QPKPE4.js";import{_ as he}from"./RelationshipPathPicker-C8oFUzuf.js";import{C as _e}from"./clock-B100N6N7.js";import{T as L}from"./trash-Cog0gord.js";import{P as ke}from"./plus-DU_dcSEX.js";import"./createLucideIcon-Bev7MvDm.js";import"./check-DtaHoLJM.js";import"./x-2hL9HgOV.js";/* empty css                                                                       */import"./_plugin-vue_export-helper-DlAUqK2U.js";const we=["value"],Se=["value"],Ce={class:"mt-2 flex items-center gap-2 text-xs text-gray-600"},Ae={key:0,class:"flex items-center gap-2"},Ie=["value"],Ee={key:0,class:"space-y-4 mt-4 border-t pt-4"},Te={class:"flex items-center gap-2"},Re=["value"],De={class:"flex items-center gap-2"},Oe=["value"],Pe={class:"relative"},Me=["value"],Be={class:"absolute top-2 right-2"},Ue={class:"flex items-center gap-2"},Ne=["value"],Fe=["value"],Le={class:"block text-xs font-medium text-gray-600 mb-1"},qe={key:0},je={class:"flex items-center gap-2"},$e=["value"],He={key:0,class:"mb-2 text-[11px]"},Ve={class:"text-gray-600"},Ke={class:"px-1.5 py-0.5 rounded bg-amber-50 border border-amber-200 text-amber-700"},We={key:0},Ge={key:0,class:"mt-1 text-red-600"},Je={key:1,class:"space-y-2"},Ye={class:"flex items-center justify-between gap-2"},ze={class:"flex-1 flex items-center gap-2"},Qe=["value","onChange","disabled"],Xe=["value"],Ze={key:0,class:"text-[10px] px-1.5 py-0.5 rounded bg-amber-50 border border-amber-200 text-amber-700"},et=["onClick","title"],tt={class:"flex items-center gap-2 mt-2"},lt=["value","onChange"],ot=["value"],st=["value","onInput"],at=["value","onInput"],nt={class:"mt-1 text-[14px] text-gray-500"},rt={key:0,class:"mt-1 text-[11px] text-gray-500"},ut={class:"mt-3"},it={class:"flex items-center gap-2"},dt=["value"],pt={key:0},mt=["value"],ct=["value"],vt={key:0,class:"mt-1 text-[11px] text-gray-500"},bt={key:1},yt=["value"],ft={key:2},gt={class:"flex items-center gap-2"},xt=["value"],ht={class:"flex items-center gap-2"},_t=["value"],kt={class:"grid grid-cols-2 gap-4 mt-3"},wt=["value"],St=["value"],Ct={key:0,class:"mt-3"},At={class:"flex items-center gap-2"},It=["value"],Et={key:1,class:"grid grid-cols-2 gap-4 mt-3"},Tt={class:"flex items-center gap-2"},Rt=["value"],Dt={class:"flex items-center gap-2"},Ot=["value"],Pt={key:2,class:"grid grid-cols-2 gap-4 mt-3"},Mt=["value"],Bt={class:"flex items-center gap-2"},Ut=["value"],Nt={class:"mt-3"},Ft={class:"relative"},Lt=["value"],qt={class:"absolute top-2 right-2 bg-white rounded-md shadow-sm border border-gray-200"},jt={class:"mt-3"},$t=["value"],Ht={class:"mt-4 border-t pt-4"},Vt={class:"flex items-center justify-between mb-2"},Kt={key:0,class:"py-4 text-center border-2 border-dashed rounded-md bg-gray-50"},Wt={key:1,class:"space-y-2"},Gt={class:"flex items-center gap-2"},Jt=["value","onInput"],Yt=["value","onChange"],zt=["onClick"],Qt={key:0,class:"mt-2 ml-4 pl-2 border-l-2 border-gray-100 space-y-2"},Xt=["value","onInput"],Zt=["value","onChange"],el=["onClick"],tl=["onClick"],ll={key:5,class:"p-3 bg-blue-50 border-l-4 border-blue-400 text-blue-800 text-sm rounded-r-md"},fl={__name:"ActionStep",props:{step:{type:Object,required:!0},allStepsBefore:{type:Array,default:()=>[]},loopContextSchema:{type:Object,default:null}},emits:["update:step","delete"],setup(p,{emit:Z}){const k=p,O=Z,ee=ve(),I=_(()=>ee.automationSchema||[]),E=Q({});function q(o,e){return`${o||""}:${e||""}`}async function P(o,e){if(!o||!e)return null;const t=q(o,e);if(Array.isArray(E.value[t])&&E.value[t].length)return E.value[t];try{const{data:s}=await xe.get(`/api/value-dictionaries/${encodeURIComponent(o)}/${encodeURIComponent(e)}`);let i=null;if(Array.isArray(s)?i=s:s&&Array.isArray(s.values)&&(i=s.values),Array.isArray(i)&&i.length)return E.value[t]=i,i}catch{}return null}const te=[{value:"SEND_EMAIL",label:"Send Email"},{value:"PROCESS_EMAIL",label:"Process Email"},{value:"CREATE_RECORD",label:"Create Record"},{value:"UPDATE_RECORD",label:"Update Record"},{value:"SYNC_RELATIONSHIP",label:"Sync Relationship"},{value:"FETCH_API_DATA",label:"Fetch API Data"},{value:"CHECK_MILESTONE_COMPLETION",label:"Check for Milestone Completion & Update"}],a=_({get:()=>k.step.step_config||{},set:o=>O("update:step",{...k.step,step_config:o})});function d(o,e){a.value={...a.value,[o]:e}}function le(o){a.value={action_type:o}}function x(o,e){const t=a.value[o]||"";d(o,`${t}${e}`)}function j(o=null){const e={id:Date.now(),name:"",type:"Text"};if(o)o.schema=[...o.schema||[],e],d("responseStructure",[...a.value.responseStructure||[]]);else{const t=a.value.responseStructure||[];d("responseStructure",[...t,e])}}function $(o,e=null){if(e)e.schema=(e.schema||[]).filter(t=>t.id!==o),d("responseStructure",[...a.value.responseStructure||[]]);else{const t=a.value.responseStructure||[];d("responseStructure",t.filter(s=>s.id!==o))}}function M(o,e,t,s=null){const r=(s?s.schema||[]:a.value.responseStructure||[]).map(b=>{if(b.id!==o)return b;const y={...b,[e]:t};return e==="type"&&(t==="Array of Objects"||t==="Object")&&!y.schema&&(y.schema=[]),y});s?(s.schema=r,d("responseStructure",[...a.value.responseStructure||[]])):d("responseStructure",r)}_(()=>I.value.map(o=>o.name));const H=_(()=>(I.value||[]).map(o=>({label:o.name,value:o.name})));function T(o){if(!o||typeof o!="string")return"";let e=o.toLowerCase();if(e==="id")return"ID";e.endsWith("_id")&&(e=e.slice(0,-3)),e=e.replace(/[_-]+/g," ");let t=e.replace(/\b\w/g,s=>s.toUpperCase());return t=t.replace(/\bId\b/g,"ID").replace(/\bUrl\b/g,"URL"),t}const R=_(()=>{const o=a.value.target_model;if(!o)return null;let e=(I.value||[]).find(s=>s.name===o);if(e||(e=(I.value||[]).find(s=>s.full_class===o),e))return e;const t=typeof o=="string"?o.split("\\").pop().split("/").pop():o;return(I.value||[]).find(s=>s.name===t)||null}),B=_(()=>{const o=R.value;return o?(o.columns||[]).map(e=>typeof e=="string"?{name:e,label:T(e),is_required:!1,allowed_values:null,description:null,ui:null}:{name:e.name,label:e.label||T(e.name),is_required:!!e.is_required,allowed_values:e.allowed_values??null,description:e.description||null,ui:e.ui||null}):[]});function U(o){return B.value.find(e=>e.name===o)||null}function V(o){return typeof o=="string"&&o.endsWith("_type")}function oe(o){return typeof o=="string"&&o.endsWith("_id")}function se(o){const e=U(o.column);return oe(o.column)||V(o.column)&&((e==null?void 0:e.ui)==="morph_type"||Array.isArray(e==null?void 0:e.allowed_values))}function ae(o){return V(o.column)?"type":"id"}const S=_(()=>{var o;return((o=R.value)==null?void 0:o.required_on_create)||[]}),ne=_(()=>{var o;return((o=R.value)==null?void 0:o.defaults_on_create)||{}});function K(o){return S.value.includes(o)}function re(o){const e=ne.value||{},t=a.value.target_model,i=`{{trigger.${t?t.toLowerCase():""}.${o}}}`,r=(()=>{const y=(B.value||[]).find(ce=>ce.name===o);return!!(y&&Array.isArray(y.allowed_values)&&y.allowed_values.length>0)})();return a.value.action_type==="CREATE_RECORD"&&r?"":e[o]!==void 0&&e[o]!==null||o.endsWith("_id")?i:""}function W(){const o=S.value||[];if(!o.length)return;const e=Array.isArray(a.value.fields)?[...a.value.fields]:[],t=new Map;e.forEach(r=>{const b=r.column||r.field||r.name;b&&t.set(b,!0)});const s=[];for(const r of o)t.has(r)||s.push({column:r,value:re(r)});s.length&&d("fields",[...e,...s]);const i=a.value.target_model;if(i)for(const r of o)P(i,r)}function G(o){d("target_model",o),W()}F(()=>a.value.target_model,async(o,e)=>{if(o&&o!==e){W();const t=Array.isArray(a.value.fields)?a.value.fields:[];for(const s of t){const i=(s==null?void 0:s.column)||(s==null?void 0:s.field)||(s==null?void 0:s.name);i&&await P(o,i)}}}),F(()=>a.value.fields,async o=>{const e=a.value.target_model;if(!(!e||!Array.isArray(o)))for(const t of o){const s=(t==null?void 0:t.column)||(t==null?void 0:t.field)||(t==null?void 0:t.name);s&&await P(e,s)}},{deep:!0,immediate:!0}),ye(async()=>{(k.step.delay_minutes??0)>0&&(A.value=!0);const o=a.value.target_model,e=Array.isArray(a.value.fields)?a.value.fields:[];if(o)for(const t of e){const s=(t==null?void 0:t.column)||(t==null?void 0:t.field)||(t==null?void 0:t.name);s&&await P(o,s)}}),F(()=>k.step.delay_minutes,o=>{(o??0)>0&&!A.value&&(A.value=!0)});function ue(){const o=a.value.fields||[];d("fields",[...o,{column:"",value:""}])}function ie(o){const e=a.value.fields||[];d("fields",e.filter((t,s)=>s!==o))}function C(o,e,t){const i=[...a.value.fields||[]];i[o]={...i[o],[e]:t},d("fields",i)}function de(o,e){const s=(a.value.fields||[])[o].value||"";C(o,"value",s+e)}function J(o){var b;const e=a.value.target_model;if(!e||!o)return null;const t=o.column||o.field||o.name;if(!t)return null;const s=(b=(B.value||[]).find(y=>y.name===t))==null?void 0:b.allowed_values;if(Array.isArray(s)&&s.length)return s;const i=q(e,t),r=E.value[i];return Array.isArray(r)&&r.length?r:null}function pe(o){const e=J(o);return!(!e||!e.length||(o.value||"").toString().includes("{{"))}const Y=_(()=>{const o=S.value||[];if(!o.length)return[];const e=new Map;return(Array.isArray(a.value.fields)?a.value.fields:[]).forEach(s=>{const i=s.column||s.field||s.name,r=(s.value??"").toString().trim();i&&r&&e.set(i,!0)}),o.filter(s=>!e.has(s))});function N(o){var i,r,b;const e=Array.isArray(a.value.fields)?a.value.fields:[],t=((i=e[o])==null?void 0:i.column)||((r=e[o])==null?void 0:r.field)||((b=e[o])==null?void 0:b.name);return!t||!K(t)?!0:e.filter(y=>(y.column||y.field||y.name)===t).length>1}const A=Q(!1);function me(o){const e=Math.max(0,parseInt(o??0,10)||0);O("update:step",{...k.step,delay_minutes:e})}return(o,e)=>(n(),X(be,{icon:"âš™ï¸",title:k.step.name||"Perform an Action",onDelete:()=>O("delete"),"onUpdate:title":e[35]||(e[35]=t=>O("update:step",{...k.step,name:t}))},{default:fe(()=>[l("select",{value:a.value.action_type||"",onChange:e[0]||(e[0]=t=>le(t.target.value)),class:"p-2 border border-gray-300 rounded-md bg-white shadow-sm w-full text-sm"},[e[36]||(e[36]=l("option",{value:"",disabled:""},"Select an action...",-1)),(n(),u(v,null,w(te,t=>l("option",{key:t.value,value:t.value},f(t.label),9,Se)),64))],40,we),l("div",Ce,[l("button",{type:"button",onClick:e[1]||(e[1]=t=>A.value=!A.value),class:"p-1.5 rounded-md border text-gray-600 hover:bg-gray-50",title:"Set delay (minutes)"},[c(D(_e),{class:"w-4 h-4"})]),A.value?(n(),u("div",Ae,[e[37]||(e[37]=l("label",null,"Delay",-1)),l("input",{type:"number",min:"0",value:k.step.delay_minutes||0,onInput:e[2]||(e[2]=t=>me(t.target.value)),class:"w-20 p-1 border rounded"},null,40,Ie),e[38]||(e[38]=l("span",null,"minutes",-1))])):m("",!0)]),a.value.action_type?(n(),u("div",Ee,[a.value.action_type==="SEND_EMAIL"?(n(),u(v,{key:0},[l("div",null,[e[39]||(e[39]=l("label",{class:"block text-xs font-medium text-gray-600 mb-1"},"To",-1)),l("div",Te,[l("input",{type:"text",value:a.value.to||"",onInput:e[3]||(e[3]=t=>d("to",t.target.value)),class:"w-full p-2 border border-gray-300 rounded-md text-sm",placeholder:"e.g., {{trigger.email.sender}}"},null,40,Re),c(g,{"all-steps-before":p.allStepsBefore,"loop-context-schema":p.loopContextSchema,onInsert:e[4]||(e[4]=t=>x("to",t))},null,8,["all-steps-before","loop-context-schema"])])]),l("div",null,[e[40]||(e[40]=l("label",{class:"block text-xs font-medium text-gray-600 mb-1"},"Subject",-1)),l("div",De,[l("input",{type:"text",value:a.value.subject||"",onInput:e[5]||(e[5]=t=>d("subject",t.target.value)),class:"w-full p-2 border border-gray-300 rounded-md text-sm",placeholder:"e.g., AI says: {{step_2.category}}"},null,40,Oe),c(g,{"all-steps-before":p.allStepsBefore,"loop-context-schema":p.loopContextSchema,onInsert:e[6]||(e[6]=t=>x("subject",t))},null,8,["all-steps-before","loop-context-schema"])])]),l("div",null,[e[41]||(e[41]=l("label",{class:"block text-xs font-medium text-gray-600 mb-1"},"Body",-1)),l("div",Pe,[l("textarea",{rows:"5",value:a.value.body||"",onInput:e[7]||(e[7]=t=>d("body",t.target.value)),class:"w-full p-2 border border-gray-300 rounded-md text-sm"},null,40,Me),l("div",Be,[c(g,{"all-steps-before":p.allStepsBefore,"loop-context-schema":p.loopContextSchema,onInsert:e[8]||(e[8]=t=>x("body",t))},null,8,["all-steps-before","loop-context-schema"])])])])],64)):m("",!0),a.value.action_type==="PROCESS_EMAIL"?(n(),u(v,{key:1},[l("div",null,[e[42]||(e[42]=l("label",{class:"block text-xs font-medium text-gray-600 mb-1"},"Email ID",-1)),l("div",Ue,[l("input",{type:"text",value:a.value.email_id||"",onInput:e[9]||(e[9]=t=>d("email_id",t.target.value)),class:"w-full p-2 border border-gray-300 rounded-md text-sm",placeholder:"e.g., {{email.id}} or {{step_3.new_record_id}}"},null,40,Ne),c(g,{"all-steps-before":p.allStepsBefore,"loop-context-schema":p.loopContextSchema,onInsert:e[10]||(e[10]=t=>x("email_id",t))},null,8,["all-steps-before","loop-context-schema"])]),e[43]||(e[43]=l("p",{class:"mt-1 text-[11px] text-gray-500"}," Specify the ID of the email to process. Use the token inserter to select from available context data. ",-1))]),l("div",null,[e[44]||(e[44]=l("label",{class:"block text-xs font-medium text-gray-600 mb-1"},"Queue (Optional)",-1)),l("input",{type:"text",value:a.value.on_queue||"",onInput:e[11]||(e[11]=t=>d("on_queue",t.target.value)),class:"w-full p-2 border border-gray-300 rounded-md text-sm",placeholder:"e.g., emails, default"},null,40,Fe),e[45]||(e[45]=l("p",{class:"mt-1 text-[11px] text-gray-500"}," Optional queue name for processing the email. Leave blank to use default queue. ",-1))])],64)):m("",!0),a.value.action_type==="CREATE_RECORD"||a.value.action_type==="UPDATE_RECORD"?(n(),u(v,{key:2},[l("div",null,[l("label",Le,f(a.value.action_type==="CREATE_RECORD"?"Model to Create":"Model to Update"),1),c(z,{"model-value":a.value.target_model||"",options:H.value,placeholder:"Select model...","onUpdate:modelValue":G,class:"w-full"},null,8,["model-value","options"])]),a.value.action_type==="UPDATE_RECORD"?(n(),u("div",qe,[e[46]||(e[46]=l("label",{class:"block text-xs font-medium text-gray-600 mb-1"},"Record ID",-1)),l("div",je,[l("input",{type:"text",value:a.value.record_id||"",onInput:e[12]||(e[12]=t=>d("record_id",t.target.value)),class:"w-full p-2 border border-gray-300 rounded-md text-sm",placeholder:"e.g., {{trigger.task.id}}"},null,40,$e),c(g,{"all-steps-before":p.allStepsBefore,"loop-context-schema":p.loopContextSchema,onInsert:e[13]||(e[13]=t=>x("record_id",t))},null,8,["all-steps-before","loop-context-schema"])])])):m("",!0),l("div",null,[e[51]||(e[51]=l("div",{class:"mb-2"},[l("label",{class:"text-xs font-medium text-gray-600"},"Fields to set")],-1)),e[52]||(e[52]=l("div",{class:"mb-3 p-2 bg-blue-50 border-l-2 border-blue-400 text-[11px] text-gray-700"},[l("p",{class:"font-medium text-blue-800 mb-1"},"ðŸ’¡ Quick Tips:"),l("ul",{class:"space-y-0.5 ml-3"},[l("li",null,[h("â€¢ Use "),l("code",{class:"px-1 bg-white rounded"},"NOW()"),h(" for current timestamp (e.g., deleted_at, published_at)")]),l("li",null,[h("â€¢ Use "),l("code",{class:"px-1 bg-white rounded"},"TODAY()"),h(" for current date at midnight")]),l("li",null,[h("â€¢ Use "),l("code",{class:"px-1 bg-white rounded"},"NULL"),h(" to clear optional fields")]),l("li",null,[h("â€¢ Use the "),l("strong",null,"token inserter (âž•)"),h(" to access data from triggers & previous steps")])])],-1)),S.value.length?(n(),u("div",He,[l("span",Ve,"Required for "+f(a.value.target_model)+":",1),(n(!0),u(v,null,w(S.value,(t,s)=>(n(),u("span",{class:"ml-1",key:t},[l("span",Ke,f(T(t)),1),s<S.value.length-1?(n(),u("span",We,", ")):m("",!0)]))),128)),Y.value.length?(n(),u("div",Ge,"Missing: "+f(Y.value.map(T).join(", ")),1)):m("",!0)])):m("",!0),a.value.fields&&a.value.fields.length>0?(n(),u("div",Je,[(n(!0),u(v,null,w(a.value.fields,(t,s)=>{var i;return n(),u("div",{key:s,class:"p-2 border rounded-md bg-gray-50/50"},[l("div",Ye,[l("div",ze,[l("select",{value:t.column,onChange:r=>C(s,"column",r.target.value),class:"w-full p-2 border border-gray-300 rounded-md text-sm",disabled:!a.value.target_model},[e[47]||(e[47]=l("option",{value:"",disabled:""},"Field...",-1)),(n(!0),u(v,null,w(B.value,r=>(n(),u("option",{key:r.name,value:r.name},f(r.label),9,Xe))),128))],40,Qe),K(t.column)?(n(),u("span",Ze,"Required")):m("",!0)]),l("button",{onClick:r=>N(s)&&ie(s),class:ge([[N(s)?"text-gray-400 hover:text-red-500 hover:bg-red-50":"text-gray-300 cursor-not-allowed"],"p-1 rounded-full"]),title:N(s)?"Remove Field":"Cannot remove required field"},[c(D(L),{class:"w-4 h-4"})],10,et)]),l("div",tt,[a.value.target_model?(n(),u(v,{key:0},[pe(t)?(n(),u("select",{key:0,value:t.value||"",onChange:r=>C(s,"value",r.target.value),class:"w-full p-2 border border-gray-300 rounded-md text-sm"},[e[48]||(e[48]=l("option",{value:"",disabled:""},"Select value...",-1)),(n(!0),u(v,null,w(J(t)||[],r=>(n(),u("option",{key:r.value,value:r.value},f(r.label??r.value),9,ot))),128))],40,lt)):(n(),u("input",{key:1,value:t.value,onInput:r=>C(s,"value",r.target.value),type:"text",class:"w-full border rounded px-2 py-2 text-sm",placeholder:"Value..."},null,40,st))],64)):(n(),u("input",{key:1,value:t.value,onInput:r=>C(s,"value",r.target.value),type:"text",class:"w-full border rounded px-2 py-2 text-sm",placeholder:"Value..."},null,40,at)),c(g,{"all-steps-before":p.allStepsBefore,"loop-context-schema":p.loopContextSchema,onInsert:r=>de(s,r)},null,8,["all-steps-before","loop-context-schema","onInsert"]),se(t)?(n(),X(he,{key:2,mode:ae(t),"all-steps-before":p.allStepsBefore,value:t.value,onSelect:r=>C(s,"value",r)},null,8,["mode","all-steps-before","value","onSelect"])):m("",!0)]),l("p",nt,[e[49]||(e[49]=h("Selected Relationship: ",-1)),l("strong",null,f(t.value),1)]),(i=U(t.column))!=null&&i.description?(n(),u("p",rt,f(U(t.column).description),1)):m("",!0)])}),128))])):m("",!0),l("div",ut,[l("button",{onClick:ue,class:"w-full flex items-center justify-center gap-1 px-3 py-2 text-sm rounded-md bg-blue-50 hover:bg-blue-100 text-blue-700 border border-blue-200"},[c(D(ke),{class:"h-4 w-4"}),e[50]||(e[50]=h(" Add Field ",-1))])])])],64)):m("",!0),a.value.action_type==="SYNC_RELATIONSHIP"?(n(),u(v,{key:3},[l("div",null,[e[53]||(e[53]=l("label",{class:"block text-xs font-medium text-gray-600 mb-1"},"Target Model",-1)),c(z,{"model-value":a.value.target_model||"",options:H.value,placeholder:"Select model...","onUpdate:modelValue":G,class:"w-full"},null,8,["model-value","options"])]),l("div",null,[e[54]||(e[54]=l("label",{class:"block text-xs font-medium text-gray-600 mb-1"},"Record ID",-1)),l("div",it,[l("input",{type:"text",value:a.value.record_id||"",onInput:e[14]||(e[14]=t=>d("record_id",t.target.value)),class:"w-full p-2 border border-gray-300 rounded-md text-sm",placeholder:"e.g., {{trigger.task.id}}"},null,40,dt),c(g,{"all-steps-before":p.allStepsBefore,"loop-context-schema":p.loopContextSchema,onInsert:e[15]||(e[15]=t=>x("record_id",t))},null,8,["all-steps-before","loop-context-schema"])])]),R.value?(n(),u("div",pt,[e[56]||(e[56]=l("label",{class:"block text-xs font-medium text-gray-600 mb-1"},"Relationship",-1)),l("select",{value:a.value.relationship||"",onChange:e[16]||(e[16]=t=>d("relationship",t.target.value)),class:"w-full p-2 border border-gray-300 rounded-md text-sm bg-white shadow-sm"},[e[55]||(e[55]=l("option",{value:"",disabled:""},"Select relationship...",-1)),(n(!0),u(v,null,w(R.value.relationships.filter(t=>["BelongsToMany","MorphToMany"].includes(t.type)),t=>(n(),u("option",{key:t.name,value:t.name},f(T(t.name))+" ("+f(t.type)+") ",9,ct))),128))],40,mt),a.value.relationship?(n(),u("p",vt,' This will sync the many-to-many relationship "'+f(a.value.relationship)+'" on the selected '+f(a.value.target_model)+" record. ",1)):m("",!0)])):m("",!0),a.value.relationship?(n(),u("div",bt,[e[58]||(e[58]=l("label",{class:"block text-xs font-medium text-gray-600 mb-1"},"Sync Mode",-1)),l("select",{value:a.value.sync_mode||"sync",onChange:e[17]||(e[17]=t=>d("sync_mode",t.target.value)),class:"w-full p-2 border border-gray-300 rounded-md text-sm bg-white shadow-sm"},e[57]||(e[57]=[l("option",{value:"sync"},"Sync (Replace all with new IDs)",-1),l("option",{value:"attach"},"Attach (Add new IDs without removing existing)",-1),l("option",{value:"detach"},"Detach (Remove specified IDs)",-1)]),40,yt)])):m("",!0),a.value.relationship?(n(),u("div",ft,[e[59]||(e[59]=l("label",{class:"block text-xs font-medium text-gray-600 mb-1"},"Related Record IDs",-1)),l("div",gt,[l("input",{type:"text",value:a.value.related_ids||"",onInput:e[18]||(e[18]=t=>d("related_ids",t.target.value)),class:"w-full p-2 border border-gray-300 rounded-md text-sm",placeholder:"e.g., {{step_1.category_ids}} or 1,2,3"},null,40,xt),c(g,{"all-steps-before":p.allStepsBefore,"loop-context-schema":p.loopContextSchema,onInsert:e[19]||(e[19]=t=>x("related_ids",t))},null,8,["all-steps-before","loop-context-schema"])]),e[60]||(e[60]=l("p",{class:"mt-1 text-[11px] text-gray-500"}," Comma-separated list of IDs to sync/attach/detach. Can use tokens from previous steps. ",-1))])):m("",!0)],64)):m("",!0),a.value.action_type==="FETCH_API_DATA"?(n(),u(v,{key:4},[l("div",null,[e[61]||(e[61]=l("label",{class:"block text-xs font-medium text-gray-600 mb-1"},"API Endpoint URL",-1)),l("div",ht,[l("input",{type:"text",value:a.value.api_url||"",onInput:e[20]||(e[20]=t=>d("api_url",t.target.value)),class:"w-full p-2 border border-gray-300 rounded-md text-sm",placeholder:"https://api.example.com/v1/data"},null,40,_t),c(g,{"all-steps-before":p.allStepsBefore,"loop-context-schema":p.loopContextSchema,onInsert:e[21]||(e[21]=t=>x("api_url",t))},null,8,["all-steps-before","loop-context-schema"])])]),l("div",kt,[l("div",null,[e[63]||(e[63]=l("label",{class:"block text-xs font-medium text-gray-600 mb-1"},"HTTP Method",-1)),l("select",{value:a.value.api_method||"GET",onChange:e[22]||(e[22]=t=>d("api_method",t.target.value)),class:"w-full p-2 border border-gray-300 rounded-md bg-white shadow-sm text-sm"},e[62]||(e[62]=[l("option",{value:"GET"},"GET",-1),l("option",{value:"POST"},"POST",-1),l("option",{value:"PUT"},"PUT",-1),l("option",{value:"PATCH"},"PATCH",-1),l("option",{value:"DELETE"},"DELETE",-1)]),40,wt)]),l("div",null,[e[65]||(e[65]=l("label",{class:"block text-xs font-medium text-gray-600 mb-1"},"Authentication",-1)),l("select",{value:a.value.api_auth_type||"NONE",onChange:e[23]||(e[23]=t=>d("api_auth_type",t.target.value)),class:"w-full p-2 border border-gray-300 rounded-md bg-white shadow-sm text-sm"},e[64]||(e[64]=[l("option",{value:"NONE"},"None",-1),l("option",{value:"BEARER"},"Bearer Token",-1),l("option",{value:"BASIC"},"Basic Auth",-1),l("option",{value:"CUSTOM_HEADER"},"Custom Header",-1)]),40,St)])]),a.value.api_auth_type==="BEARER"?(n(),u("div",Ct,[e[66]||(e[66]=l("label",{class:"block text-xs font-medium text-gray-600 mb-1"},"Bearer Token",-1)),l("div",At,[l("input",{type:"text",value:a.value.api_auth_token||"",onInput:e[24]||(e[24]=t=>d("api_auth_token",t.target.value)),class:"w-full p-2 border border-gray-300 rounded-md text-sm",placeholder:"e.g. {{secrets.api_key}}"},null,40,It),c(g,{"all-steps-before":p.allStepsBefore,"loop-context-schema":p.loopContextSchema,onInsert:e[25]||(e[25]=t=>x("api_auth_token",t))},null,8,["all-steps-before","loop-context-schema"])])])):m("",!0),a.value.api_auth_type==="BASIC"?(n(),u("div",Et,[l("div",null,[e[67]||(e[67]=l("label",{class:"block text-xs font-medium text-gray-600 mb-1"},"Username",-1)),l("div",Tt,[l("input",{type:"text",value:a.value.api_auth_username||"",onInput:e[26]||(e[26]=t=>d("api_auth_username",t.target.value)),class:"w-full p-2 border border-gray-300 rounded-md text-sm",placeholder:"Username"},null,40,Rt)])]),l("div",null,[e[68]||(e[68]=l("label",{class:"block text-xs font-medium text-gray-600 mb-1"},"Password",-1)),l("div",Dt,[l("input",{type:"password",value:a.value.api_auth_password||"",onInput:e[27]||(e[27]=t=>d("api_auth_password",t.target.value)),class:"w-full p-2 border border-gray-300 rounded-md text-sm",placeholder:"Password"},null,40,Ot)])])])):m("",!0),a.value.api_auth_type==="CUSTOM_HEADER"?(n(),u("div",Pt,[l("div",null,[e[69]||(e[69]=l("label",{class:"block text-xs font-medium text-gray-600 mb-1"},"Header Name",-1)),l("input",{type:"text",value:a.value.api_auth_header_name||"",onInput:e[28]||(e[28]=t=>d("api_auth_header_name",t.target.value)),class:"w-full p-2 border border-gray-300 rounded-md text-sm",placeholder:"e.g. X-Api-Key"},null,40,Mt)]),l("div",null,[e[70]||(e[70]=l("label",{class:"block text-xs font-medium text-gray-600 mb-1"},"Header Value",-1)),l("div",Bt,[l("input",{type:"text",value:a.value.api_auth_header_value||"",onInput:e[29]||(e[29]=t=>d("api_auth_header_value",t.target.value)),class:"w-full p-2 border border-gray-300 rounded-md text-sm",placeholder:"Value"},null,40,Ut),c(g,{"all-steps-before":p.allStepsBefore,"loop-context-schema":p.loopContextSchema,onInsert:e[30]||(e[30]=t=>x("api_auth_header_value",t))},null,8,["all-steps-before","loop-context-schema"])])])])):m("",!0),l("div",Nt,[e[71]||(e[71]=l("label",{class:"block text-xs font-medium text-gray-600 mb-1"},"Payload / Parameters (JSON)",-1)),l("div",Ft,[l("textarea",{rows:"4",value:a.value.api_payload||"",onInput:e[31]||(e[31]=t=>d("api_payload",t.target.value)),class:"w-full p-2 border border-gray-300 rounded-md text-sm font-mono",placeholder:'{"key": "{{trigger.value}}", "id": 123}'},null,40,Lt),l("div",qt,[c(g,{"all-steps-before":p.allStepsBefore,"loop-context-schema":p.loopContextSchema,onInsert:e[32]||(e[32]=t=>x("api_payload",t))},null,8,["all-steps-before","loop-context-schema"])])]),e[72]||(e[72]=l("p",{class:"mt-1 text-[11px] text-gray-500"}," For GET/DELETE requests, these will be sent as query string parameters. For POST/PUT/PATCH, they will be sent as JSON body. Variables are supported! ",-1))]),l("div",jt,[e[73]||(e[73]=l("label",{class:"block text-xs font-medium text-gray-600 mb-1"},"Response Data Key (Optional)",-1)),l("input",{type:"text",value:a.value.api_response_key||"",onInput:e[33]||(e[33]=t=>d("api_response_key",t.target.value)),class:"w-full p-2 border border-gray-300 rounded-md text-sm",placeholder:"e.g. data.items"},null,40,$t),e[74]||(e[74]=l("p",{class:"mt-1 text-[11px] text-gray-500"}," Optional dot-notation path to extract specific data from the JSON response before saving to workflow context. Leave blank to return the whole response object. ",-1))]),l("div",Ht,[l("div",Vt,[e[75]||(e[75]=l("label",{class:"block text-xs font-bold text-gray-700 uppercase tracking-wider"},"Expected Response Structure",-1)),l("button",{type:"button",onClick:e[34]||(e[34]=t=>j()),class:"text-xs text-indigo-600 hover:text-indigo-800 font-semibold"}," + Add Field ")]),e[79]||(e[79]=l("p",{class:"text-[11px] text-gray-500 mb-3"}," Define fields to extract from the API response so they can be used in later steps or loops. ",-1)),a.value.responseStructure&&a.value.responseStructure.length?(n(),u("div",Wt,[(n(!0),u(v,null,w(a.value.responseStructure,t=>(n(),u("div",{key:t.id,class:"p-2 border rounded-md bg-white"},[l("div",Gt,[l("input",{type:"text",value:t.name,onInput:s=>M(t.id,"name",s.target.value),class:"flex-1 p-1 text-xs border rounded",placeholder:"Field name (e.g. tasks)"},null,40,Jt),l("select",{value:t.type,onChange:s=>M(t.id,"type",s.target.value),class:"w-32 p-1 text-xs border rounded"},e[77]||(e[77]=[l("option",null,"Text",-1),l("option",null,"Number",-1),l("option",null,"Boolean",-1),l("option",null,"Object",-1),l("option",null,"Array of Objects",-1)]),40,Yt),l("button",{type:"button",onClick:s=>$(t.id),class:"text-gray-400 hover:text-red-500"},[c(D(L),{class:"w-3 h-3"})],8,zt)]),t.type==="Object"||t.type==="Array of Objects"?(n(),u("div",Qt,[(n(!0),u(v,null,w(t.schema,s=>(n(),u("div",{key:s.id,class:"flex items-center gap-2"},[l("input",{type:"text",value:s.name,onInput:i=>M(s.id,"name",i.target.value,t),class:"flex-1 p-1 text-xs border rounded",placeholder:"Sub-field name"},null,40,Xt),l("select",{value:s.type,onChange:i=>M(s.id,"type",i.target.value,t),class:"w-24 p-1 text-xs border rounded"},e[78]||(e[78]=[l("option",null,"Text",-1),l("option",null,"Number",-1),l("option",null,"Boolean",-1)]),40,Zt),l("button",{type:"button",onClick:i=>$(s.id,t),class:"text-gray-400 hover:text-red-500"},[c(D(L),{class:"w-3 h-3"})],8,el)]))),128)),l("button",{type:"button",onClick:s=>j(t),class:"text-[10px] text-indigo-500 hover:text-indigo-700 font-semibold"}," + Add Sub-field ",8,tl)])):m("",!0)]))),128))])):(n(),u("div",Kt,e[76]||(e[76]=[l("p",{class:"text-xs text-gray-400 italic"},"No response fields defined yet.",-1)])))])],64)):m("",!0),a.value.action_type==="CHECK_MILESTONE_COMPLETION"?(n(),u("div",ll,e[80]||(e[80]=[l("p",{class:"font-semibold"},"This is a smart action.",-1),l("p",null,"It will automatically use the context from the trigger to check if all tasks in the milestone are complete. If so, it will mark the milestone as completed.",-1)]))):m("",!0)])):m("",!0)]),_:1},8,["title","onDelete"]))}};export{fl as default};
