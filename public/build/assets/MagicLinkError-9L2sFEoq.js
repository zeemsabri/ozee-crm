import{r as d,d as S,l as C,c,o as m,e as V,a as t,u as E,h as L,k as p,t as v,g as f,W as M,f as h,v as k,F as T,s as _}from"./app-ChNNGQpZ.js";const B={class:"min-h-screen flex flex-col items-center justify-center bg-slate-50 p-4"},U={class:"bg-white shadow-2xl rounded-2xl p-8 max-w-md w-full border border-slate-100"},j={class:"text-slate-600 mb-8 text-center"},A={key:0,class:"bg-emerald-50 text-emerald-700 p-4 rounded-xl mb-6 text-sm flex items-center gap-3 border border-emerald-100"},z={key:1,class:"bg-red-50 text-red-700 p-3 rounded-lg mb-6 text-xs font-medium border border-red-100"},F={class:"space-y-6"},q={key:0,class:"space-y-2"},D={class:"p-5 bg-slate-50 rounded-xl border border-slate-200"},Y={class:"space-y-4"},O=["disabled"],R={key:0,class:"p-2 bg-amber-50 text-amber-700 text-xs rounded-md border border-amber-100 flex items-center gap-2"},W=["disabled"],G=["disabled"],J={__name:"MagicLinkError",props:{message:{type:String,default:"Something went wrong with your magic link."},token:String,email:String,hasPin:Boolean},setup(w){const b=w,u=d(""),g=d(""),s=d(""),o=d(!1),x=d(""),r=d(0);let n=null;const I=a=>{r.value=a,n&&clearInterval(n),n=setInterval(()=>{r.value--,r.value<=0&&clearInterval(n)},1e3)};S(()=>{n&&clearInterval(n)});const y=C(()=>b.email||g.value),N=async()=>{var a,e,i;if(u.value.length<4){s.value="Please enter a valid PIN.";return}o.value=!0,s.value="";try{const l=await _.post("/api/client-api/verify-pin",{token:b.token,email:y.value,pin:u.value});l.data.success&&(localStorage.setItem("client_dashboard_token",l.data.auth_token),l.data.used_temporary_pin&&localStorage.setItem("client_used_temp_pin","true"),window.location.href=l.data.redirect_url)}catch(l){((a=l.response)==null?void 0:a.status)===429?(s.value="Too many attempts.",I(l.response.data.lockout_seconds)):s.value=((i=(e=l.response)==null?void 0:e.data)==null?void 0:i.message)||"Invalid credentials. Please attempt again."}finally{o.value=!1}},P=async()=>{const a=y.value;if(!a||!a.includes("@")){s.value="Please enter a valid email address.";return}o.value=!0,s.value="";try{(await _.post("/api/client-magic-link",{email:a})).data.success&&(x.value="Magic link and temporary PIN sent to your email. You can login with the temporary PIN below or click the magic link in your email.")}catch{s.value="An error occurred. Please try again."}finally{o.value=!1}};return(a,e)=>(m(),c(T,null,[V(E(L),{title:"Access Issue"}),t("div",B,[t("div",U,[e[7]||(e[7]=t("div",{class:"w-16 h-16 bg-red-50 rounded-full flex items-center justify-center mx-auto mb-6 text-red-500"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})])],-1)),e[8]||(e[8]=t("h1",{class:"text-2xl font-bold text-slate-900 mb-2 text-center"},"Access Issue",-1)),t("p",j,v(w.message),1),x.value?(m(),c("div",A,[e[2]||(e[2]=t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 shrink-0",viewBox:"0 0 20 20",fill:"currentColor"},[t("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z","clip-rule":"evenodd"})],-1)),f(" "+v(x.value),1)])):p("",!0),s.value?(m(),c("div",z,v(s.value),1)):p("",!0),t("div",F,[b.email?p("",!0):(m(),c("div",q,[e[3]||(e[3]=t("label",{class:"block text-sm font-semibold text-slate-700 uppercase tracking-wider"},"Confirm Your Email",-1)),h(t("input",{"onUpdate:modelValue":e[0]||(e[0]=i=>g.value=i),type:"email",placeholder:"your@email.com",class:"block w-full rounded-xl border-slate-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 py-3"},null,512),[[k,g.value]])])),t("div",D,[e[4]||(e[4]=t("label",{class:"block text-xs font-bold text-slate-500 uppercase tracking-widest mb-4"},"Instance Access via PIN",-1)),t("div",Y,[h(t("input",{"onUpdate:modelValue":e[1]||(e[1]=i=>u.value=i),type:"password",placeholder:"Enter PIN",maxlength:"6",disabled:r.value>0,class:"block w-full rounded-xl border-slate-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 text-center tracking-[0.5em] font-bold py-3 text-lg"},null,8,O),[[k,u.value]]),r.value>0?(m(),c("div",R," Try again in "+v(r.value)+"s ",1)):p("",!0),t("button",{onClick:N,disabled:o.value||u.value.length<4||r.value>0,class:"w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 rounded-xl transition duration-200 shadow-lg shadow-indigo-100 disabled:opacity-50"},v(o.value?"Verifying...":"Unlock Now"),9,W)])]),e[5]||(e[5]=M('<div class="relative"><div class="absolute inset-0 flex items-center"><div class="w-full border-t border-slate-100"></div></div><div class="relative flex justify-center text-xs"><span class="px-2 bg-white text-slate-400">OR</span></div></div>',1)),t("button",{onClick:P,disabled:o.value,class:"w-full bg-white border border-slate-200 hover:bg-slate-50 text-slate-700 font-semibold py-3 rounded-xl transition duration-200"}," Email Me a New Link ",8,G),e[6]||(e[6]=t("p",{class:"text-xs text-center text-slate-500"}," Check your email for your permanent PIN or request a magic link to receive a temporary PIN. ",-1))]),e[9]||(e[9]=t("p",{class:"mt-8 text-slate-400 text-xs text-center border-t border-slate-100 pt-6 leading-relaxed"},[f(" For security, permanent PINs can be set in your dashboard settings."),t("br"),f(" Need help? "),t("a",{href:"#",class:"text-indigo-500 font-medium"},"Contact Support")],-1))])])],64))}};export{J as default};
