import{r as l,d as te,G as se,c as o,o as n,a as e,f as V,t as r,w as ae,i as z,u as le,B as oe,z as ne,l as K,F as q,j as G,g as ie,v as re,n as de}from"./app-R-i7AP1m.js";import{_ as ue,c as ce}from"./NoticeboardModal-D2oFfQXU.js";const ve={class:"bg-white rounded-xl shadow-md p-6 mb-6"},me={class:"flex items-center justify-between mb-4"},xe={class:"flex-1"},pe={class:"text-5xl font-bold text-indigo-600"},ge={class:"flex-1 text-right"},he={class:"text-5xl font-bold text-gray-900"},ye={class:"bg-white rounded-xl shadow-md p-6 mb-6"},fe={class:"flex items-center space-x-2 mb-4"},_e={class:"space-y-3"},be=["value"],we={key:0,class:"text-xs text-gray-500"},ke={class:"bg-white rounded-xl shadow-md p-6 mb-6"},Ce={key:0,class:"text-sm text-gray-500"},Ae={key:1,class:"text-sm text-red-600"},Ne={key:2},Fe={key:0,class:"text-sm text-gray-500"},Ie={key:1,class:"space-y-3"},Le={class:"text-sm text-gray-800 font-semibold truncate"},Me={class:"text-xs text-gray-600 mt-1"},Se={class:"mt-2"},Te=["onClick"],Ve={key:2,class:"mt-3"},Pe={class:"bg-white rounded-xl shadow-md p-6 mb-6"},Ue={class:"flex items-center justify-between mb-3"},je={class:"flex items-center space-x-2"},Be={key:0,class:"text-sm text-gray-500"},$e={key:1,class:"text-sm text-red-600"},De={key:2,class:"space-y-2"},Ee={class:"flex items-center justify-between"},ze={class:"text-sm font-medium text-gray-900"},Ke={class:"text-xs text-gray-600 truncate max-w-xs"},qe=["href"],He={__name:"Sidebar",props:{checklistItems:Array,notes:String},emits:["add-checklist-item","remove-checklist-item","update-notes"],setup(Ge,{emit:W}){const P=W,g=l(null),N=l(!0),F=l(0),v=l(null),d=l([]),m=l(""),I=l(null),L=l(!1),i=l([]),x=l(!1),c=l(null),h=l(!1),y=l([]),f=l([]),M=l(!1),_=l(null),S=l("");te(async()=>{var t,s,a,p,T,B,$;try{const b=(t=se().props.auth)==null?void 0:t.user;x.value=!0;const[w,k,u,C,A]=await Promise.all([window.axios.get("/api/leaderboard/stats"),window.axios.get("/api/leaderboard/monthly"),window.axios.get("/api/user/workspace"),window.axios.get("/api/notices/unread"),window.axios.get("/api/shareable-resources",{params:{per_page:5,visible_to_team:!0}})]);console.log("fetching points"),console.log(w),F.value=((s=w==null?void 0:w.data)==null?void 0:s.userMonthlyPoints)??0;const D=Array.isArray((a=k==null?void 0:k.data)==null?void 0:a.leaderboard)?k.data.leaderboard:[];if(b&&D.length>0){const E=D.findIndex(ee=>String(ee.id)===String(b.id));v.value=E>=0?E+1:null}else v.value=null;d.value=Array.isArray((p=u==null?void 0:u.data)==null?void 0:p.checklist)?u.data.checklist:[],m.value=((T=u==null?void 0:u.data)==null?void 0:T.notes)??"",i.value=Array.isArray((B=C==null?void 0:C.data)==null?void 0:B.data)?C.data.data:[],c.value=null,f.value=Array.isArray(($=A==null?void 0:A.data)==null?void 0:$.data)?A.data.data:[]}catch(b){console.error("Failed to load leaderboard/workspace data",b),F.value=0,v.value=null,d.value=[],m.value="",i.value=[],c.value="Failed to load updates"}finally{N.value=!1,x.value=!1}});async function Y(){try{M.value=!0;const{data:t}=await window.axios.get("/api/shareable-resources",{params:{per_page:5,visible_to_team:!0,q:S.value||void 0}});f.value=Array.isArray(t==null?void 0:t.data)?t.data:[],_.value=null}catch(t){console.error("Failed to load resources",t),f.value=[],_.value="Failed to load resources"}finally{M.value=!1}}async function H(){try{await window.axios.put("/api/user/checklist",{items:d.value})}catch(t){console.error("Failed to save checklist",t)}}function J(t,s=140){return t?t.length<=s?t:t.slice(0,s).trim()+"…":""}async function U(){try{x.value=!0;const{data:t}=await window.axios.get("/api/notices/unread");i.value=Array.isArray(t==null?void 0:t.data)?t.data:[],c.value=null}catch(t){console.error("Failed to load updates",t),i.value=[],c.value="Failed to load updates"}finally{x.value=!1}}function O(t){y.value=[t],h.value=!0}function Q(){y.value=i.value.slice(),y.value.length&&(h.value=!0)}function X(){h.value=!1,U()}async function j(){var s,a;const t=(a=(s=g.value)==null?void 0:s.value)==null?void 0:a.trim();if(t){const p=[...d.value,{name:t,completed:!1}];d.value=p,P("add-checklist-item",t);try{await H()}catch{}g.value.value="",g.value.focus()}}function Z(t){d.value=t}function R(t){const s=t.target.value;m.value=s,P("update-notes",s),I.value&&clearTimeout(I.value),I.value=setTimeout(async()=>{try{L.value=!0,await window.axios.put("/api/user/notes",{text:m.value})}catch(a){console.error("Failed to update notes",a)}finally{L.value=!1}},600)}return(t,s)=>(n(),o("div",null,[e("div",ve,[s[4]||(s[4]=e("h3",{class:"text-xl font-semibold text-gray-900 mb-4"},"My Performance",-1)),e("div",me,[e("div",xe,[s[1]||(s[1]=e("p",{class:"text-sm text-gray-500"},"Total Points",-1)),e("span",pe,r(N.value?"—":F.value??0),1)]),e("div",ge,[s[2]||(s[2]=e("p",{class:"text-sm text-gray-500"},"Leaderboard Rank",-1)),e("span",he,r(N.value?"#":v.value?`#${v.value}`:"#-"),1)])]),V(le(oe),{href:t.route("leaderboard.index"),class:"block text-center text-indigo-600 text-sm font-medium mt-4 hover:underline transition-all-colors"},{default:ae(()=>s[3]||(s[3]=[z("View Leaderboard Details →",-1)])),_:1,__:[3]},8,["href"])]),e("div",ye,[s[5]||(s[5]=e("h3",{class:"text-xl font-semibold text-gray-900 mb-4"},"My Checklist",-1)),e("div",fe,[e("input",{ref_key:"newChecklistItemInput",ref:g,type:"text",class:"flex-1 p-2 border rounded-lg",placeholder:"Add a new checklist item...",onKeyup:ne(j,["enter"])},null,544),e("button",{onClick:j,class:"px-3 py-2 bg-indigo-600 text-white rounded-lg"},"Add")]),V(ue,{items:d.value,"api-endpoint":"/api/user/checklist",title:"","container-class":"mt-2","success-message":"Checklist updated","error-message":"Failed to update checklist","onUpdate:items":Z},null,8,["items"]),s[6]||(s[6]=e("h3",{class:"text-xl font-semibold text-gray-900 mb-4 mt-6"},"My Notes",-1)),e("div",_e,[e("textarea",{value:m.value,onInput:R,class:"w-full h-32 p-3 rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",placeholder:"Write your notes here..."},null,40,be),L.value?(n(),o("p",we,"Saving...")):K("",!0)])]),e("div",ke,[s[7]||(s[7]=e("h3",{class:"text-xl font-semibold text-gray-900 mb-4"},"Company Updates",-1)),x.value?(n(),o("div",Ce,"Loading updates...")):c.value?(n(),o("div",Ae,[z(r(c.value)+" ",1),e("button",{class:"ml-2 text-indigo-600 underline",onClick:U},"Retry")])):(n(),o("div",Ne,[!i.value||i.value.length===0?(n(),o("div",Fe," You're all caught up. No new updates. ")):(n(),o("ul",Ie,[(n(!0),o(q,null,G(i.value.slice(0,3),(a,p)=>(n(),o("li",{key:a.id,class:"p-3 bg-gray-50 rounded-lg"},[e("p",Le,r(a.title),1),e("p",Me,r(J(a.description,120)),1),e("div",Se,[e("button",{class:"text-indigo-600 text-xs font-medium hover:underline",onClick:T=>O(a)},"View",8,Te)])]))),128))])),i.value.length>3?(n(),o("div",Ve,[e("button",{class:"text-indigo-600 text-sm font-medium hover:underline",onClick:Q},"View all ("+r(i.value.length)+")",1)])):K("",!0)]))]),e("div",Pe,[e("div",Ue,[s[8]||(s[8]=e("h3",{class:"text-xl font-semibold text-gray-900"},"Latest Resources",-1)),e("div",je,[ie(e("input",{"onUpdate:modelValue":s[0]||(s[0]=a=>S.value=a),onInput:Y,type:"text",placeholder:"Search resources...",class:"p-2 border rounded-lg text-sm"},null,544),[[re,S.value]])])]),M.value?(n(),o("div",Be,"Loading resources...")):_.value?(n(),o("div",$e,r(_.value),1)):(n(),o("ul",De,[(n(!0),o(q,null,G(f.value,a=>(n(),o("li",{key:a.id,class:"p-3 bg-gray-50 rounded-lg"},[e("div",Ee,[e("div",null,[e("p",ze,r(a.title),1),e("p",Ke,[e("a",{href:a.url,target:"_blank",rel:"noopener",class:"text-indigo-600 hover:underline"},r(a.url),9,qe)])]),e("span",{class:de(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",a.type==="youtube"?"bg-red-100 text-red-800":a.type==="website"?"bg-blue-100 text-blue-800":a.type==="document"?"bg-green-100 text-green-800":a.type==="image"?"bg-purple-100 text-purple-800":"bg-gray-100 text-gray-800"])},r(a.type),3)])]))),128))]))]),V(ce,{show:h.value,"unread-notices":y.value,onClose:X},null,8,["show","unread-notices"])]))}};export{He as default};
