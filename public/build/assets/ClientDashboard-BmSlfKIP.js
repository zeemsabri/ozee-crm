import oe from"./BaseModal-BA-pVBX-.js";import ae from"./LoadingOverlay-BvK06W1z.js";import ne from"./Sidebar-B8YSkfEv.js";import ie from"./HomeSection-BbnLa5ev.js";import le from"./TicketsSection-D2QLGvZb.js";import re from"./ApprovalsSection-Cils8w16.js";import se from"./DocumentsSection-DceJ8UmB.js";import ce from"./InvoicesSection-W59Z5G1U.js";import ue from"./AnnouncementsSection-DjZ252hR.js";import de from"./DeliverableViewerModal-DDy_OrFG.js";import ve from"./PinSetupModal-7dCtN1AF.js";import pe from"./ResourceSection-ClzG9QK3.js";import me from"./SEOReport-oIYtaEP3.js";import{_ as he}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as a,c as E,f as fe,aQ as q,a as J,o as r,d as b,i as c,b as k,t as je,g as d,k as ge}from"./app-06bZY6Z_.js";import"./SelectDropdown-3qWSmFpy.js";/* empty css                                                                       */import"./auto-BIBwKD9g.js";import"./chart-DUfl3Dpl.js";import"./TicketNotesSidebar-UXMPjD3b.js";import"./CreateTaskModal-BlF0MCvZ.js";const be={},ke={class:"bg-gray-100 flex min-h-screen font-sans"},we={key:0,class:"fixed inset-0 bg-red-100 bg-opacity-90 flex items-center justify-center z-50 p-4"},ye={class:"bg-white p-8 rounded-lg shadow-xl text-red-700 max-w-lg w-full text-center"},Ae={class:"mb-6 whitespace-pre-line"},Se={__name:"ClientDashboard",props:{initialAuthToken:{type:String,default:""},projectId:{type:[String,Number],required:!0},clientProjects:{type:Array,default:()=>[]},clientHasPin:{type:Boolean,default:!1}},setup(n){const i=n,w=a(!1),B=a(i.clientHasPin),R=a(!1),v=a(!0),K=a("client-user"),l=a("home"),I=a(!1),U=a(null),T=a(!1),p=a(!1),M=a(""),N=a(""),V=a([]),x=a(null),y=a([]),f=a([]),z=a([]),j=a([]),A=a([]),L=a([]),g=a([]),D=a([]),P=a([]),S=a(0),s=a(null),$=a({}),Q=E(()=>Array.isArray(P.value)&&P.value.length>0),G=E(()=>{const o=import.meta&&be?"https://wireframe.ozeeweb.com.au":typeof window<"u"?window.location.origin:"",e=i.initialAuthToken||"";return o?`${o}/shared?token=${e}`:""}),X=E(()=>({marginLeft:I.value?"16rem":"4rem"})),H=o=>{U.value=o,T.value=!0},m=async(o,e)=>{try{const t=await fetch(`/api/client-api/${o}`,{headers:{Authorization:`Bearer ${i.initialAuthToken}`,"Content-Type":"application/json",Accept:"application/json"}});if(!t.ok){const C=await t.json();throw new Error(C.message||`Failed to fetch data from ${o}.`)}const u=await t.json();e.value=u}catch(t){console.error(`Error fetching from ${o}:`,t),s.value=s.value?s.value+`
${t.message}`:t.message}},Y=(o,e,t,u=null,C=null)=>{M.value=o,N.value=e,x.value=C;const O=[];t==="alert"?O.push({label:"OK",className:"bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700",onClick:()=>p.value=!1}):t==="confirm"&&O.push({label:"Cancel",className:"bg-gray-300 text-gray-800 py-2 px-4 rounded-lg hover:bg-gray-400",onClick:()=>p.value=!1},{label:"Confirm",className:"bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700",onClick:()=>{u&&u(),p.value=!1}}),V.value=O,p.value=!0},Z=()=>{p.value=!1,x.value=null},h=async o=>{console.log("Simulating adding activity:",o);const e={id:Date.now(),description:o,date:new Date().toISOString()};y.value.unshift(e),y.value=y.value.slice(0,10)},_=async o=>{f.value.unshift(o),f.value.sort((e,t)=>new Date(t.date).getTime()-new Date(e.date).getTime())},W=async(o,e)=>{const t=g.value.findIndex(u=>u.id===o);t!==-1&&(g.value[t].status=e)},ee=async o=>{console.log("Simulating adding document:",o),j.value.unshift(o),j.value.sort((e,t)=>new Date(t.uploadDate).getTime()-new Date(e.uploadDate).getTime())},te=async(o,e)=>{console.log(`Simulating updating invoice ${o} to ${e}`);const t=A.value.findIndex(u=>u.id===o);t!==-1&&(A.value[t].status=e)},F=async o=>{v.value=!0;try{const e=await fetch("/api/client-api/switch-project",{method:"POST",headers:{Authorization:`Bearer ${i.initialAuthToken}`,"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({token:i.initialAuthToken,project_id:o})});if(!e.ok){const t=await e.json();throw new Error(t.message||"Failed to switch project.")}window.location.reload()}catch(e){console.error("Error switching project:",e),s.value=e.message,v.value=!1}};return fe(async()=>{if(v.value=!0,s.value=null,!i.initialAuthToken||!i.projectId){s.value="Authentication token or Project ID missing. Cannot load dashboard.",v.value=!1;return}await Promise.all([m(`project/${i.projectId}/tasks`,f),m(`project/${i.projectId}/documents`,j),m(`project/${i.projectId}/deliverables`,g),m(`project/${i.projectId}/shareable-resources?visible_to_client=true`,D),m(`project/${i.projectId}/wireframes`,P),m(`project/${i.projectId}`,$)]);try{const e=await fetch(`/api/client-api/projects/${i.projectId}/seo-reports/count`,{headers:{Authorization:`Bearer ${i.initialAuthToken}`,Accept:"application/json"}});if(e.ok){const t=await e.json();S.value=t.count||0}else console.error("Error fetching SEO reports count"),S.value=0}catch(e){console.error("Error fetching SEO reports count:",e),S.value=0}v.value=!1,localStorage.getItem("client_used_temp_pin")==="true"?(localStorage.removeItem("client_used_temp_pin"),R.value=!0,setTimeout(()=>{w.value=!0},1e3)):B.value||setTimeout(()=>{w.value=!0},2e3)}),q("modalService",{showModal:Y}),q("activityService",{addActivity:h}),(o,e)=>(r(),J("div",ke,[b(ae,{isLoading:v.value},null,8,["isLoading"]),s.value?(r(),J("div",we,[k("div",ye,[e[6]||(e[6]=k("h3",{class:"text-2xl font-bold mb-4"},"Error Loading Dashboard",-1)),k("p",Ae,je(s.value),1),k("button",{onClick:e[0]||(e[0]=t=>s.value=null),class:"bg-red-600 text-white py-2 px-4 rounded-lg hover:bg-red-700"},"Dismiss")])])):c("",!0),b(ne,{userId:K.value,activeSection:l.value,isExpanded:I.value,hasWireframes:Q.value,wireframeShareUrl:G.value,clientProjects:n.clientProjects,currentProjectId:n.projectId,onSectionChange:e[1]||(e[1]=t=>l.value=t),"onUpdate:isExpanded":e[2]||(e[2]=t=>I.value=t),onSwitchProject:F},null,8,["userId","activeSection","isExpanded","hasWireframes","wireframeShareUrl","clientProjects","currentProjectId"]),k("div",{class:"flex-1 p-8 overflow-y-auto main-content",style:ge(X.value)},[l.value==="home"?(r(),d(ie,{key:0,activities:y.value,tickets:f.value,approvals:z.value,documents:j.value,invoices:A.value,announcements:L.value,deliverables:g.value,shareableResources:D.value,"seo-reports-count":S.value,clientProjects:n.clientProjects,currentProjectId:n.projectId,onOpenDeliverableViewer:H,onSwitchProject:F,"project-data":$.value},null,8,["activities","tickets","approvals","documents","invoices","announcements","deliverables","shareableResources","seo-reports-count","clientProjects","currentProjectId","project-data"])):c("",!0),l.value==="seo"?(r(),d(me,{key:1,"project-id":n.projectId,"initial-auth-token":n.initialAuthToken},null,8,["project-id","initial-auth-token"])):c("",!0),l.value==="tickets"?(r(),d(le,{key:2,"project-id":n.projectId,"initial-auth-token":n.initialAuthToken,tickets:f.value,onAddTicket:_,onAddActivity:h},null,8,["project-id","initial-auth-token","tickets"])):c("",!0),l.value==="approvals"?(r(),d(re,{key:3,onOpenDeliverableViewer:H,deliverables:g.value,"initial-auth-token":n.initialAuthToken,"project-id":n.projectId,approvals:z.value,onUpdateApproval:W,onAddActivity:h},null,8,["deliverables","initial-auth-token","project-id","approvals"])):c("",!0),l.value==="documents"?(r(),d(se,{key:4,"project-data":$.value,"project-id":n.projectId,"initial-auth-token":n.initialAuthToken,documents:j.value,onAddDocument:ee,onAddActivity:h},null,8,["project-data","project-id","initial-auth-token","documents"])):c("",!0),l.value==="resources"?(r(),d(pe,{key:5,"project-id":n.projectId,"initial-auth-token":n.initialAuthToken,"shareable-resources":D.value,onAddActivity:h},null,8,["project-id","initial-auth-token","shareable-resources"])):c("",!0),l.value==="invoices"?(r(),d(ce,{key:6,invoices:A.value,onUpdateInvoice:te,onAddActivity:h},null,8,["invoices"])):c("",!0),l.value==="announcements"?(r(),d(ue,{key:7,announcements:L.value},null,8,["announcements"])):c("",!0)],4),b(oe,{isOpen:p.value,title:M.value,message:N.value,buttons:V.value,children:x.value,onClose:Z},null,8,["isOpen","title","message","buttons","children"]),b(de,{isOpen:T.value,"onUpdate:isOpen":e[3]||(e[3]=t=>T.value=t),deliverable:U.value,initialAuthToken:n.initialAuthToken,projectId:n.projectId,onDeliverableActionSuccess:W},null,8,["isOpen","deliverable","initialAuthToken","projectId"]),b(ve,{isOpen:w.value,token:n.initialAuthToken,isReset:R.value,onClose:e[4]||(e[4]=t=>w.value=!1),onSuccess:e[5]||(e[5]=t=>B.value=!0)},null,8,["isOpen","token","isReset"])]))}},Je=he(Se,[["__scopeId","data-v-b9bd5d3c"]]);export{Je as default};
